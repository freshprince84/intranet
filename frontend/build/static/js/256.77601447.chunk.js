"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[256],{256:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Me});var r=a(5043),s=a(4117),i=a(5590),l=a(1923),n=a(1801),d=a(2415),o=a(8756),c=a(6981),m=a(6738),x=a(887),u=a(1909),g=a(4850),h=a(1663),p=a(8010),b=a(2302),y=a(2811),f=a(4129),v=a(7012),k=a(6238),j=a(2517),w=a(6018),N=a(6443),S=a(7591),A=a(1816),W=a(9422),T=a(579);const C=e=>{let{isOpen:t,onClose:a,onConfirm:i,userName:l}=e;const{t:n}=(0,s.Bd)(),o=new Date,c=(0,d.GP)(o,"yyyy-MM-dd"),m=(0,d.GP)(o,"HH:mm:ss"),[x,u]=(0,r.useState)(c),[g,h]=(0,r.useState)(m),[p,b]=(0,r.useState)(!1);return(0,T.jsx)(w.e,{appear:!0,show:t,as:r.Fragment,children:(0,T.jsxs)(N.lG,{as:"div",className:"relative z-10",onClose:a,children:[(0,T.jsx)(w.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,T.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,T.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,T.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,T.jsx)(w.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,T.jsxs)(N.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all",children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)(N.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 dark:text-white",children:n("teamWorktime.modal.stopTracking.title")}),(0,T.jsxs)("button",{type:"button",className:"bg-white dark:bg-gray-800 rounded-md text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:a,children:[(0,T.jsx)("span",{className:"sr-only",children:n("common.close")}),(0,T.jsx)(S.A,{className:"h-6 w-6","aria-hidden":"true"})]})]}),(0,T.jsx)("div",{className:"mt-2",children:(0,T.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("teamWorktime.modal.stopTracking.description",{userName:l})})}),(0,T.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:n("teamWorktime.modal.stopTracking.date")}),(0,T.jsx)("input",{type:"date",id:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",value:x,onChange:e=>u(e.target.value)})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:n("teamWorktime.modal.stopTracking.time")}),(0,T.jsx)("input",{type:"time",id:"time",step:"1",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",value:g,onChange:e=>h(e.target.value)})]})]}),(0,T.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,T.jsx)("button",{type:"button",className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:a,disabled:p,title:n("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{type:"button",className:"p-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{try{b(!0);const e="".concat(x,"T").concat(g);await i(e)}catch(e){console.error("Fehler beim Stoppen der Zeiterfassung:",e)}finally{b(!1)}},disabled:p,title:n(p?"teamWorktime.modal.stopTracking.stopping":"teamWorktime.modal.stopTracking.stop"),children:p?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})})]})]})})})})]})})};var D=a(9379),E=a(9248),I=a(5657);const M=e=>{let{isOpen:t,onClose:a,onSave:i,userName:l,entries:n,selectedDate:d}=e;const{t:o}=(0,s.Bd)(),{openSidepane:c,closeSidepane:m}=(0,I.N)(),[x,u]=(0,r.useState)([]),[g,h]=(0,r.useState)(!1),[p,b]=(0,r.useState)(null),[y,f]=(0,r.useState)(window.innerWidth<640),[v,k]=(0,r.useState)(window.innerWidth>1070);(0,r.useEffect)((()=>{const e=()=>{f(window.innerWidth<640),k(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?c():m(),()=>{m()})),[t,c,m]),(0,r.useEffect)((()=>{if(n&&n.length>0){const e=n.map((e=>{const t=e.startTime.split("T")[0],a=e.startTime.split("T")[1].substring(0,8),r=e.endTime?e.endTime.split("T")[1].substring(0,8):null,s="".concat(t,"T").concat(a.substring(0,5)),i=r?"".concat(e.endTime.split("T")[0],"T").concat(r.substring(0,5)):null;return(0,D.A)((0,D.A)({},e),{},{date:t,startTimeTime:a,endTimeTime:r,startDateTime:s,endDateTime:i,isDeleted:!1,isModified:!1})}));u(e)}else u([])}),[n]);const j=e=>{const t=e.filter((e=>!e.isDeleted));for(let a=0;a<t.length;a++){const e=t[a],r=e.startDateTime,s=e.endDateTime;if(s&&r>=s)return b("Eintrag ".concat(a+1,": Die Endzeit muss nach der Startzeit liegen.")),!1;for(let i=a+1;i<t.length;i++){const e=t[i],l=e.startDateTime,n=e.endDateTime;if(s&&n&&r<n&&s>l||s&&!n&&s>l||n&&!s&&n>r)return b("Es gibt eine \xdcberlappung zwischen Eintrag ".concat(a+1," und Eintrag ").concat(i+1,".")),!1}}return b(null),!0},w=async()=>{if(j(x))try{h(!0);const e=x.filter((e=>e.isModified||e.isDeleted)).map((e=>{const t=e.startDateTime?"".concat(e.startDateTime,":00"):"".concat(e.date,"T").concat(e.startTimeTime),a=e.endDateTime?"".concat(e.endDateTime,":00"):e.endTimeTime?"".concat(e.date,"T").concat(e.endTimeTime):null;return(0,D.A)((0,D.A)({},e),{},{startTime:t,endTime:a})}));e.length>0&&await i(e),a()}catch(p){console.error("Fehler beim Speichern der Zeiterfassungen:",p),b(o("teamWorktime.modal.editWorktimes.saveError"))}finally{h(!1)}},C=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsx)("div",{children:(0,T.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("teamWorktime.modal.editWorktimes.description",{userName:l,date:d.split("-").reverse().join(".")})})}),p&&(0,T.jsx)("div",{className:"p-2 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:p}),(0,T.jsx)("div",{children:(0,T.jsx)("div",{className:"overflow-x-auto border dark:border-gray-700 rounded-lg",children:(0,T.jsxs)("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",style:{tableLayout:"auto"},children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",style:{minWidth:"250px"},children:o("teamWorktime.modal.editWorktimes.columns.startTime")}),(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",style:{minWidth:"250px"},children:o("teamWorktime.modal.editWorktimes.columns.endTime")}),(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",style:{width:"80px"},children:o("common.actions")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===x.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:3,className:"px-4 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:o("teamWorktime.modal.editWorktimes.noEntries")})}):x.map(((e,t)=>(0,T.jsxs)("tr",{className:e.isDeleted?"bg-red-50 dark:bg-red-900":"",children:[(0,T.jsx)("td",{className:"px-4 py-3",style:{minWidth:"250px"},children:(0,T.jsx)("input",{type:"datetime-local",className:"w-full px-3 py-2 border ".concat(e.isDeleted?"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"," rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"),value:e.startDateTime,onChange:e=>((e,t)=>{const a=[...x];if(a[e].startDateTime!==t){const[r,s]=t.split("T"),i=s?"".concat(s,":00"):"00:00:00";a[e].date=r,a[e].startDateTime=t,a[e].startTimeTime=i,a[e].isModified=!0,u(a),j(a)}})(t,e.target.value),disabled:e.isDeleted,style:{minWidth:"230px"}})}),(0,T.jsx)("td",{className:"px-4 py-3",style:{minWidth:"250px"},children:(0,T.jsx)("input",{type:"datetime-local",className:"w-full px-3 py-2 border ".concat(e.isDeleted?"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"," rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"),value:e.endDateTime||"",onChange:e=>((e,t)=>{const a=[...x];if(a[e].endDateTime!==t){if(t){const[r,s]=t.split("T"),i=s?"".concat(s,":00"):"00:00:00";a[e].endDateTime=t,a[e].endTimeTime=i}else a[e].endDateTime=null,a[e].endTimeTime=null;a[e].isModified=!0,u(a),j(a)}})(t,e.target.value||null),disabled:e.isDeleted,style:{minWidth:"230px"}})}),(0,T.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:(0,T.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...x];t[e].isDeleted=!t[e].isDeleted,t[e].isModified=!0,u(t)})(t),className:"p-1 rounded ".concat(e.isDeleted?"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300":"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300"),title:e.isDeleted?o("teamWorktime.modal.editWorktimes.restore"):o("teamWorktime.modal.editWorktimes.markForDelete"),children:(0,T.jsx)(E.A,{className:"h-5 w-5"})})})]},e.id)))})]})})}),(0,T.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700",children:[(0,T.jsx)("button",{type:"button",className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:a,disabled:g,title:o("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{type:"button",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",onClick:w,disabled:g||Boolean(p),title:o(g?"common.saving":"common.save"),children:g?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})})]})]});return y?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.modal.editWorktimes.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4",children:C()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!v&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-lg w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.modal.editWorktimes.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:C()})]})]})};var q=a(4426),L=a(7829),F=a(9462),H=a(6400),P=a(2023),z=a(3800),O=a(1713);var R=a(8897),_=a(957),B=a(637),G=a(8018);const V=["name","startTime","duration","pauseTime","branch","actions"],U={name:["name"],startTime:["startTime"],duration:["duration"],pauseTime:["pauseTime"],branch:["branch"],actions:[]},Y={name:"name",startTime:"startTime",duration:"duration",pauseTime:"pauseTime",branch:"branch"},K="workcenter-table",J=e=>{let{activeUsers:t,allWorktimes:a,loading:i,selectedDate:w,onDateChange:N,onStopWorktime:S,onRefresh:A,showTodos:W=!1,showRequests:D=!1}=e;const{t:E}=(0,s.Bd)(),I=(0,r.useMemo)((()=>[{id:"name",label:E("teamWorktime.columns.name")},{id:"startTime",label:E("teamWorktime.columns.startTime")},{id:"duration",label:E("teamWorktime.columns.duration")},{id:"pauseTime",label:E("teamWorktime.columns.pauseTime")},{id:"branch",label:E("teamWorktime.columns.branch")},{id:"actions",label:E("teamWorktime.columns.actions")}]),[E]),[G,J]=(0,r.useState)(!1),[Z,Q]=(0,r.useState)(!1),[$,X]=(0,r.useState)(null),[ee,te]=(0,r.useState)(""),[ae,re]=(0,r.useState)(!1),[se,ie]=(0,r.useState)(null),[le,ne]=(0,r.useState)(!1),[de,oe]=(0,r.useState)(10),[ce,me]=(0,r.useState)([]),[xe,ue]=(0,r.useState)([]),[ge,he]=(0,r.useState)(E("teamWorktime.filters.active")),[pe,be]=(0,r.useState)(null),[ye,fe]=(0,r.useState)({}),[ve,ke]=(0,r.useState)({}),[je,we]=(0,r.useState)(new Set),[Ne,Se]=(0,r.useState)(!1),[Ae,We]=(0,r.useState)(!1),{hasPermission:Te}=(0,z.S)();(0,r.useEffect)((()=>{(async()=>{if(W&&w)try{Se(!0);const e=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_BY_USER,{params:{date:w}}),t={};e.data.forEach((e=>{t[e.userId]=e.todos})),fe(t)}catch(e){console.error("Fehler beim Laden der To-Dos:",e)}finally{Se(!1)}})()}),[W,w]),(0,r.useEffect)((()=>()=>{fe({}),ke({}),we(new Set)}),[]),(0,r.useEffect)((()=>{(async()=>{if(D&&w)try{We(!0);const e=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.REQUESTS_BY_USER,{params:{date:w}}),t={};e.data.forEach((e=>{t[e.userId]=e.requests})),ke(t)}catch(e){console.error("Fehler beim Laden der Requests:",e)}finally{We(!1)}})()}),[D,w]);const Ce=e=>{we((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},{settings:De,updateColumnOrder:Ee,updateHiddenColumns:Ie,isColumnVisible:Me,updateViewMode:qe,updateSortConfig:Le}=(0,P.F)("team_worktime_active",{defaultColumnOrder:V,defaultHiddenColumns:[],defaultViewMode:"cards"}),Fe=De.columnOrder,He=De.hiddenColumns,Pe=De.viewMode||"cards",ze=De.sortConfig||{key:"startTime",direction:"asc"},Oe=(0,r.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const a=U[e];a&&a.length>0&&t.push(...a)})),t})(De.columnOrder||V)),[De.columnOrder]),Re=(0,r.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(U[e]||[]).forEach((e=>t.add(e)))})),t})(De.hiddenColumns||[])),[De.hiddenColumns]),_e=(0,r.useMemo)((()=>new Set(Oe.filter((e=>!Re.has(e))))),[Oe,Re]);(0,r.useEffect)((()=>{document.querySelectorAll(".dashboard-workcenter-wrapper").forEach((e=>{"cards"===Pe?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[Pe]);const Be=e=>{X(e),J(!0)},Ge=()=>{J(!1),X(null)},Ve=e=>{X(e),Q(!0)},Ue=()=>{Q(!1),X(null)},Ye=e=>{ie(e)},Ke=(0,r.useCallback)((e=>{e.preventDefault()}),[]),Je=(0,r.useCallback)(((e,t)=>{if(e.preventDefault(),!se||se===t)return;const a=[...Fe],r=a.indexOf(se),s=a.indexOf(t);a.splice(r,1),a.splice(s,0,se),Ee(a)}),[se,Fe,Ee]),Ze=()=>{ie(null)},Qe=()=>ce.length,$e=(0,r.useMemo)((()=>{const e=[...a];t.filter((e=>e.startTime.split("T")[0]===w)).forEach((t=>{e.find((e=>e.id===t.id))||e.push(t)}));const r=e.reduce(((e,t)=>{const a=t.user.id;e[a]||(e[a]={user:t.user,branch:t.branch,entries:[],startTime:(0,O.IF)(t.startTime),endTime:t.endTime?(0,O.IF)(t.endTime):null,totalDuration:0,activeEntries:[],hasActiveWorktime:!1});const r=e[a];r.entries.push(t);const s=(0,O.IF)(t.startTime);if(s<r.startTime&&(r.startTime=s),t.endTime){const e=(0,O.IF)(t.endTime);(!r.endTime||e>r.endTime)&&(r.endTime=e)}else r.hasActiveWorktime=!0,r.activeEntries.push(t);if(t.endTime){const e=(0,O.IF)(t.endTime).getTime()-(0,O.IF)(t.startTime).getTime();r.totalDuration+=e}return e}),{});let s=Object.values(r).filter((e=>{if(!ee)return!0;const t=ee.toLowerCase();if(e.user.username.toLowerCase().includes(t))return!0;if(e.branch.name.toLowerCase().includes(t))return!0;return!!"".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase().includes(t)}));if(ce.length>0){const e={name:(e,t)=>{const a="".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase(),r=(t.value||"").toLowerCase();return"equals"===t.operator?a===r:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},branch:(e,t)=>{const a=e.branch.name.toLowerCase(),r=(t.value||"").toLowerCase();return"equals"===t.operator?a===r:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},hasActiveWorktime:(e,t)=>{if("equals"===t.operator){const a="true"===t.value||!0===t.value;return e.hasActiveWorktime===a}return null},duration:(e,t)=>{const a=60*parseInt(t.value||"0")*60*1e3;if("greaterThan"===t.operator)return e.totalDuration>a;if("lessThan"===t.operator)return e.totalDuration<a;if("equals"===t.operator){const t=18e5;return Math.abs(e.totalDuration-a)<=t}return null}},t=(e,t)=>{switch(t){case"name":return"".concat(e.user.firstName," ").concat(e.user.lastName);case"branch":return e.branch.name;case"hasActiveWorktime":return e.hasActiveWorktime;case"duration":return e.totalDuration;case"startTime":return e.startTime;case"endTime":return e.endTime;default:return e[t]}};s=(0,H.W5)(s,ce,xe,t,e)}const i=(e,t)=>{switch(t){case"name":return"".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase();case"startTime":return e.startTime.getTime();case"duration":return e.totalDuration;case"pauseTime":return e.endTime?e.endTime.getTime()-e.startTime.getTime()-e.totalDuration:0;case"branch":return e.branch.name.toLowerCase();default:return""}};return s.sort(((e,t)=>{if("table"===Pe&&ze.key){const a=i(e,ze.key),r=i(t,ze.key);let s=0;if("number"===typeof a&&"number"===typeof r)s=a-r;else{const e="string"===typeof a?a:String(a),t="string"===typeof r?r:String(r);s=e.localeCompare(t)}if(0!==s)return"asc"===ze.direction?s:-s}if("cards"===Pe&&0===ce.length&&ze.key){const a=i(e,ze.key),r=i(t,ze.key);let s=0;if("number"===typeof a&&"number"===typeof r)s=a-r;else{const e="string"===typeof a?a:String(a),t="string"===typeof r?r:String(r);s=e.localeCompare(t)}if(0!==s)return"asc"===ze.direction?s:-s}if("table"===Pe&&0===ce.length&&ze.key){const a=i(e,ze.key),r=i(t,ze.key);let s=0;if("number"===typeof a&&"number"===typeof r)s=a-r;else{const e="string"===typeof a?a:String(a),t="string"===typeof r?r:String(r);s=e.localeCompare(t)}if(0!==s)return"asc"===ze.direction?s:-s}return 0})),s}),[a,t,ee,ze,w,ce,xe,Pe,Oe,_e]),Xe=(e,t)=>{const a=(null===ze||void 0===ze?void 0:ze.key)===e;return(0,T.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer group relative",onClick:()=>(e=>{const t=ze.key===e&&"asc"===ze.direction?"desc":"asc";Le({key:e,direction:t})})(e),draggable:!0,onDragStart:()=>Ye(e),onDragOver:Ke,onDrop:t=>Je(t,e),onDragEnd:Ze,children:(0,T.jsxs)("div",{className:"flex items-center ".concat(se===e?"opacity-50":""),children:[(0,T.jsx)(u.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),t," ",a&&("asc"===ze.direction?"\u2191":"\u2193")]})},e)};r.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("Nicht authentifiziert");const t=(await l.A.get("".concat(n.Sn.SAVED_FILTERS.BY_TABLE(K)),{headers:{Authorization:"Bearer ".concat(e)}})).data||[],a=t.some((e=>"Aktive"===e.name||e.name===E("teamWorktime.filters.active")||"Active"===e.name||"Activo"===e.name)),r=t.some((e=>"Alle"===e.name||e.name===E("teamWorktime.filters.all")||"All"===e.name||"Todos"===e.name));if(!a){const t={tableId:K,name:E("teamWorktime.filters.active"),conditions:[{column:"hasActiveWorktime",operator:"equals",value:"true"}],operators:[]};await l.A.post("".concat(n.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})}if(!r){const t={tableId:K,name:E("teamWorktime.filters.all"),conditions:[],operators:[]};await l.A.post("".concat(n.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})}}catch(e){0}})()}),[E]);const et=(0,F.b)(),{loadFilters:tt}=et,at=r.useCallback(((e,t)=>{me(e),ue(t)}),[]),rt=r.useCallback((()=>{me([]),ue([]),he(""),be(null)}),[]),st=r.useCallback((async(e,t,a,r)=>{he(e),be(t),at(a,r)}),[at]);r.useEffect((()=>{(async()=>{const e=(await tt(K)).find((e=>"Aktive"===e.name||e.name===E("teamWorktime.filters.active")||"Active"===e.name||"Activo"===e.name));e&&await st(e.name,e.id,e.conditions,e.operators)})()}),[E,tt,st]);const it=(0,r.useMemo)((()=>{const e=new Date;e.setHours(0,0,0,0);const[t,a,r]=w.split("-").map(Number),s=new Date(t,a-1,r);return s.setHours(0,0,0,0),s.getTime()<e.getTime()}),[w]);return(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{const[e,t,a]=w.split("-").map(Number),r=new Date(e,t-1,a),s=(0,o.e)(r,1);N((0,d.GP)(s,"yyyy-MM-dd"))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("common.previousDay")})]}),(0,T.jsx)("div",{className:"relative w-[180px]",children:(0,T.jsx)("input",{type:"date",id:"date-select",className:"block w-full pl-3 pr-8 py-2 text-base border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:w,onChange:e=>N(e.target.value)})}),it&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{const[e,t,a]=w.split("-").map(Number),r=new Date(e,t-1,a),s=(0,c.f)(r,1);N((0,d.GP)(s,"yyyy-MM-dd"))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("common.nextDay")})]})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"text",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:E("common.searchPlaceholder"),value:ee,onChange:e=>te(e.target.value)}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsx)("button",{type:"button",className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Pe?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>qe("table"===Pe?"cards":"table"),children:"table"===Pe?(0,T.jsx)(g.A,{className:"h-5 w-5"}):(0,T.jsx)(h.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("table"===Pe?"common.viewAsCards":"common.viewAsTable")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsxs)("button",{type:"button",className:"p-2 rounded-md ".concat(Qe()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>re(!ae),children:[(0,T.jsx)(p.A,{className:"h-5 w-5"}),Qe()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",style:{position:"absolute",top:"-0.25rem",right:"-0.25rem"},children:Qe()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("common.showFilter")})]}),(0,T.jsx)("div",{className:"ml-1",children:(0,T.jsx)(R.A,{columns:"cards"===Pe?[{id:"name",label:E("teamWorktime.columns.name")},{id:"startTime",label:E("teamWorktime.columns.startTime")},{id:"duration",label:E("teamWorktime.columns.duration")},{id:"pauseTime",label:E("teamWorktime.columns.pauseTime")},{id:"branch",label:E("teamWorktime.columns.branch")}]:I,visibleColumns:"cards"===Pe?Array.from(_e):Fe.filter((e=>!He.includes(e))),columnOrder:"cards"===Pe?Oe:Fe,onToggleColumnVisibility:e=>{if("cards"===Pe){const t=Y[e];if(t){const e=He.includes(t)?He.filter((e=>e!==t)):[...He,t];Ie(e)}}else{const t=He.includes(e)?He.filter((t=>t!==e)):[...He,e];Ie(t)}},onMoveColumn:(e,t)=>{if("cards"===Pe){const a=[...Oe],r=a[e];a.splice(e,1),a.splice(t,0,r);const s=[],i=new Set;a.forEach((e=>{const t=Y[e];t&&!i.has(t)&&(i.add(t),s.push(t))})),I.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),Ee(s)}else{const a=[...Fe],r=a[e];a.splice(e,1),a.splice(t,0,r),Ee(a)}},mainSortConfig:ze,onMainSortChange:Le,showMainSort:!0,buttonTitle:E("cards"===Pe?"teamWorktime.sortAndDisplay":"teamWorktime.configureColumns"),modalTitle:E("cards"===Pe?"teamWorktime.sortAndDisplay":"teamWorktime.configureColumns")})})]})]}),ae&&(0,T.jsx)("div",{className:"cards"===Pe?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(q.A,{columns:[{id:"name",label:E("teamWorktime.columns.name")},{id:"branch",label:E("teamWorktime.columns.branch")},{id:"hasActiveWorktime",label:E("worktime.active")},{id:"duration",label:E("teamWorktime.columns.duration")}],onApply:at,onReset:rt,savedConditions:ce,savedOperators:xe,tableId:K})}),(0,T.jsx)("div",{className:"cards"===Pe?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:K,onSelectFilter:at,onReset:rt,activeFilterName:ge,selectedFilterId:pe,onFilterChange:st,defaultFilterName:"Aktive"})}),"table"===Pe?(0,T.jsx)("div",{className:"dashboard-workcenter-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 overflow-hidden -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,T.jsx)("tr",{children:Fe.filter((e=>!He.includes(e))).map((e=>{const t=I.find((t=>t.id===e));return t?"actions"===e?(0,T.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",draggable:!0,onDragStart:()=>Ye(e),onDragOver:Ke,onDrop:t=>Je(t,e),onDragEnd:Ze,children:t.label},e):Xe(e,t.label):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===$e.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:Fe.filter((e=>!He.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"Keine Zeiterfassungen gefunden"})}):$e.slice(0,de).map((e=>{const t=e.endTime?e.endTime.getTime()-e.startTime.getTime()-e.totalDuration:0,a=ye[e.user.id]||null,s=ve[e.user.id]||null,i=je.has(e.user.id),l=W&&a&&a.total>0||D&&s&&s.total>0;return(0,T.jsxs)(r.Fragment,{children:[(0,T.jsx)("tr",{children:Fe.filter((e=>!He.includes(e))).map((a=>"name"===a?(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"flex items-center",children:(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.user.firstName," ",e.user.lastName]}),(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.user.username})]})})},a):"startTime"===a?(0,T.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,d.GP)(e.startTime,"dd.MM.yyyy")}),(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,d.GP)(e.startTime,"HH:mm:ss")})]},a):"duration"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,m.m)(new Date(Date.now()-e.totalDuration),{locale:x.de,addSuffix:!1})})},a):"pauseTime"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t>0?(0,m.m)(new Date(Date.now()-t),{locale:x.de,addSuffix:!1}):"-"})},a):"branch"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},a):"actions"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,T.jsxs)("div",{className:"flex flex-row space-x-2 justify-end items-center",children:[e.hasActiveWorktime&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Be(e),className:"p-1 bg-red-600 text-white rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",children:(0,T.jsx)(b.A,{className:"h-5 w-5 text-white fill-white"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("teamWorktime.actions.stopTracking")})]}),Te("team_worktime_control","both","page")&&Te("team_worktime","both","table")&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ve(e),className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 edit-button",children:(0,T.jsx)(y.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("teamWorktime.actions.editWorktimes")})]})]})},a):null))}),(W||D)&&l&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:Fe.filter((e=>!He.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-3",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[W&&a&&a.total>0&&(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["To-Dos (",w,"): ",a.completed," erledigt | ",a.open," offen | ",a.inProgress," in Bearbeitung"]}),(0,T.jsx)("button",{onClick:()=>Ce(e.user.id),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:i?"Weniger anzeigen \u25b2":"Details anzeigen \u25bc"})]}),i&&a.details&&a.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:a.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"done"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"done"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,d.GP)(new Date(e.updatedAt),"HH:mm")]})]},e.id)))})]}),D&&s&&s.total>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Requests (",w,"): ",s.approved," genehmigt | ",s.pending," offen"]}),!W&&(0,T.jsx)("button",{onClick:()=>Ce(e.user.id),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:i?"Weniger anzeigen \u25b2":"Details anzeigen \u25bc"})]}),i&&s.details&&s.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:s.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"approved"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"approved"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,d.GP)(new Date(e.createdAt),"HH:mm")]})]},e.id)))})]})]})})})]},e.user.id)}))})]})}):(0,T.jsx)("div",{className:"dashboard-workcenter-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 -mx-3 sm:-mx-4 md:-mx-6",children:0===$e.length?(0,T.jsx)("div",{className:"text-center py-8 text-sm text-gray-500 dark:text-gray-400",children:"Keine Zeiterfassungen gefunden"}):(0,T.jsx)(B.A,{gap:"md",children:$e.slice(0,de).map((e=>{const t=e.endTime?e.endTime.getTime()-e.startTime.getTime()-e.totalDuration:0,a=ye[e.user.id]||null,r=ve[e.user.id]||null,s=je.has(e.user.id),i=W&&a&&a.total>0||D&&r&&r.total>0,l=[],n=[],o=[];_e.has("name")&&n.push({label:"Name",value:"".concat(e.user.firstName," ").concat(e.user.lastName," (").concat(e.user.username,")"),icon:(0,T.jsx)(f.A,{className:"h-4 w-4"})}),_e.has("startTime")&&n.push({label:"Startzeit",value:"".concat((0,d.GP)(e.startTime,"dd.MM.yyyy")," ").concat((0,d.GP)(e.startTime,"HH:mm:ss")),icon:(0,T.jsx)(v.A,{className:"h-4 w-4"})}),_e.has("duration")&&o.push({label:"Arbeitszeit",value:(0,m.m)(new Date(Date.now()-e.totalDuration),{locale:x.de,addSuffix:!1}),icon:(0,T.jsx)(v.A,{className:"h-4 w-4"})}),_e.has("pauseTime")&&o.push({label:"Pausen",value:t>0?(0,m.m)(new Date(Date.now()-t),{locale:x.de,addSuffix:!1}):"-",icon:(0,T.jsx)(v.A,{className:"h-4 w-4"})}),_e.has("branch")&&l.push({label:"Niederlassung",value:e.branch.name,icon:(0,T.jsx)(k.A,{className:"h-4 w-4"})});const c=(0,T.jsxs)("div",{className:"flex flex-row space-x-2 justify-end items-center",children:[e.hasActiveWorktime&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Be(e),className:"p-1 bg-red-600 text-white rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",children:(0,T.jsx)(b.A,{className:"h-5 w-5 text-white fill-white"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("teamWorktime.actions.stopTracking")})]}),Te("team_worktime_control","both","page")&&Te("team_worktime","both","table")&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ve(e),className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:(0,T.jsx)(y.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:E("teamWorktime.actions.editWorktimes")})]})]}),u=i?(0,T.jsxs)("div",{children:[W&&a&&a.total>0&&(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["To-Dos (",w,"): ",a.completed," erledigt | ",a.open," offen | ",a.inProgress," in Bearbeitung"]}),a.details&&a.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:a.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"done"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"done"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,d.GP)(new Date(e.updatedAt),"HH:mm")]})]},e.id)))})]}),D&&r&&r.total>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Requests (",w,"): ",r.approved," genehmigt | ",r.pending," offen"]}),r.details&&r.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:r.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"approved"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"approved"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,d.GP)(new Date(e.createdAt),"HH:mm")]})]},e.id)))})]})]}):null;return(0,T.jsxs)(_.A,{title:"".concat(e.user.firstName," ").concat(e.user.lastName),metadata:l,actions:c,expandable:u?{isExpanded:s,content:u,onToggle:()=>Ce(e.user.id)}:void 0,children:[n.length>0&&(0,T.jsx)("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 mb-3 sm:mb-4",children:n.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-600 dark:text-gray-400",children:[e.icon&&(0,T.jsx)("span",{className:"flex-shrink-0",children:e.icon}),(0,T.jsxs)("span",{className:"font-medium mr-1 whitespace-nowrap",children:[e.label,":"]}),(0,T.jsx)("span",{className:e.className||"text-gray-900 dark:text-white",children:(e.value,e.value)})]},t)))}),o.length>0&&(0,T.jsx)("div",{className:"flex flex-col gap-2 mb-3 sm:mb-4",children:o.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-600 dark:text-gray-400",children:[e.icon&&(0,T.jsx)("span",{className:"flex-shrink-0",children:e.icon}),(0,T.jsxs)("span",{className:"font-medium mr-1 whitespace-nowrap",children:[e.label,":"]}),(0,T.jsx)("span",{className:e.className||"text-gray-900 dark:text-white",children:(e.value,e.value)})]},t)))})]},e.user.id)}))})}),$e.length>de&&(0,T.jsx)("div",{className:"mt-4 flex justify-center",children:(0,T.jsx)("button",{className:"p-2 text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",onClick:()=>oe((e=>e+10)),title:"Mehr anzeigen (".concat($e.length-de," verbleibend)"),children:(0,T.jsx)(j.A,{className:"h-5 w-5"})})}),G&&$&&(0,T.jsx)(C,{isOpen:G,onClose:Ge,onConfirm:async e=>{if(!$)return;const t=$.activeEntries.length>0?$.activeEntries.reduce(((e,t)=>{const a=(0,O.IF)(e.startTime);return(0,O.IF)(t.startTime)>a?t:e}),$.activeEntries[0]):null;t?await S(t.user.id,e):await S($.user.id,e),Ge()},userName:"".concat($.user.firstName," ").concat($.user.lastName)}),$&&(0,T.jsx)(M,{isOpen:Z,onClose:Ue,onSave:async e=>{try{await(async e=>{try{const t=e.filter((e=>!e.isDeleted)),a=e.filter((e=>e.isDeleted)).map((e=>e.id)),r=t.map((e=>l.A.put("/worktime/".concat(e.id),{startTime:e.startTime,endTime:e.endTime}))),s=a.map((e=>l.A.delete("/worktime/".concat(e))));return await Promise.all([...r,...s]),{success:!0}}catch(t){throw console.error("Fehler beim Aktualisieren der Zeiterfassungen:",t),t}})(e),A(),alert(E("teamWorktime.messages.saveSuccess")),Ue()}catch(t){console.error("Fehler beim Aktualisieren der Zeiterfassungen:",t);let e=E("teamWorktime.messages.unknownError");t.response?401===t.response.status?e=E("teamWorktime.messages.unauthorized"):403===t.response.status?e=E("teamWorktime.messages.forbidden"):404===t.response.status?e=E("teamWorktime.messages.notFound"):500===t.response.status?e=E("teamWorktime.messages.serverError"):t.response.data&&t.response.data.message&&(e=t.response.data.message):e=t.request?E("teamWorktime.messages.noResponse"):t.message||E("teamWorktime.messages.error"),alert(E("teamWorktime.messages.saveError")+" "+e)}},userName:"".concat($.user.firstName," ").concat($.user.lastName),entries:$.entries,selectedDate:w})]})};var Z=a(1369),Q=a(3315),$=a(3332),X=a(2672);const ee="todo-analytics-table",te=["time","title","status","responsible","qualityControl","branch","createdBy","deletedAt"],ae=e=>{let{selectedDate:t}=e;const{t:a}=(0,s.Bd)(),{user:i}=(0,X.As)(),[o,c]=(0,r.useState)([]),[m,x]=(0,r.useState)(!1),[u,b]=(0,r.useState)(null),[y,w]=(0,r.useState)(""),[N,S]=(0,r.useState)([]),[W,C]=(0,r.useState)([]),[D,I]=(0,r.useState)(""),[M,H]=(0,r.useState)(null),[z,O]=(0,r.useState)(!1),{settings:R,isLoading:G,updateColumnOrder:V,updateHiddenColumns:U,toggleColumnVisibility:Y,isColumnVisible:K,updateViewMode:J}=(0,P.F)(ee,{defaultColumnOrder:te,defaultViewMode:"table"}),ae=(null===R||void 0===R?void 0:R.columnOrder)||te,re=(null===R||void 0===R?void 0:R.hiddenColumns)||[],se=ae.filter((e=>!re.includes(e))),ie=(null===R||void 0===R?void 0:R.viewMode)||"table",[le,ne]=(0,r.useState)(ie);(0,r.useEffect)((()=>{null!==R&&void 0!==R&&R.viewMode&&R.viewMode!==le&&ne(R.viewMode)}),[null===R||void 0===R?void 0:R.viewMode]);const[de,oe]=(0,r.useState)(new Set),ce=e=>{oe((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},[me,xe]=(0,r.useState)(null),[ue,ge]=(0,r.useState)(!1),[he,pe]=(0,r.useState)(!1),[be,ye]=(0,r.useState)(null),[fe,ve]=(0,r.useState)(!1),[ke,je]=(0,r.useState)(!1),[we,Ne]=(0,r.useState)(new Set),Se=(0,r.useMemo)((()=>[{id:"time",label:a("analytics.todo.columns.time")},{id:"title",label:a("analytics.todo.columns.title")},{id:"status",label:a("analytics.todo.columns.status")},{id:"responsible",label:a("analytics.todo.columns.responsible")},{id:"qualityControl",label:a("analytics.todo.columns.qualityControl")},{id:"branch",label:a("analytics.todo.columns.branch")},{id:"createdBy",label:a("analytics.todo.columns.createdBy",{defaultValue:"Erstellt von"})},{id:"deletedAt",label:a("analytics.todo.columns.deletedAt",{defaultValue:"Gel\xf6scht am"})}]),[a]),Ae=(0,r.useMemo)((()=>JSON.stringify(N)),[N]),We=(0,r.useMemo)((()=>JSON.stringify(W)),[W]);(0,r.useEffect)((()=>{const e=new AbortController;return(async()=>{try{x(!0),b(null);const a={};t?a.date=t:a.period="week",M?a.filterId=M:N.length>0&&(a.filterConditions=JSON.stringify({conditions:N,operators:W}));const r=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_CHRONOLOGICAL,{params:a,signal:e.signal});c(r.data||[])}catch(u){if("AbortError"===(null===u||void 0===u?void 0:u.name)||"CanceledError"===(null===u||void 0===u?void 0:u.name)||"ERR_CANCELED"===(null===u||void 0===u?void 0:u.code))return;console.error("Error loading todos:",u),b(a("analytics.todo.loadError"))}finally{e.signal.aborted||x(!1)}})(),()=>{e.abort()}}),[t,Ae,We,M,a]),(0,r.useEffect)((()=>{const e=new AbortController;return(async()=>{if(t&&he)try{ge(!0);const a=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_FREQUENCY,{params:{date:t},signal:e.signal});xe(a.data)}catch(u){"AbortError"!==u.name&&console.error("Error loading frequency analysis:",u)}finally{e.signal.aborted||ge(!1)}})(),()=>{e.abort()}}),[t,he]),(0,r.useEffect)((()=>{const e=new AbortController;return(async()=>{if(t&&ke)try{ve(!0);const a=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_SHIFTS,{params:{date:t},signal:e.signal});ye(a.data)}catch(u){"AbortError"!==u.name&&console.error("Error loading shift analysis:",u)}finally{e.signal.aborted||ve(!1)}})(),()=>{e.abort()}}),[t,ke]);const Te=(0,r.useCallback)(((e,t)=>{S(e),C(t),O(!1)}),[]),Ce=(0,r.useCallback)((()=>{S([]),C([]),I(""),H(null)}),[]),De=(0,r.useCallback)((async(e,t,a,r)=>{I(e),H(t),Te(a,r)}),[Te]),Ee=(0,F.b)(),{loadFilters:Ie}=Ee;(0,r.useEffect)((()=>{i&&(async()=>{if(!i)return;const e=await Ie(ee),t="".concat(i.firstName," ").concat(i.lastName).trim()||i.username,a=e.find((e=>e.name===t))||e.find((e=>"Alle"===e.name));a&&await De(a.name,a.id,a.conditions,a.operators)})()}),[Ie,De,i]);const Me=(0,r.useCallback)((()=>N.filter((e=>""!==e.column&&null!==e.value)).length),[N]),qe=e=>{switch(e){case"done":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"quality_control":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"open":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"improval":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Le=e=>({done:"Erledigt",in_progress:"In Bearbeitung",quality_control:"Qualit\xe4tskontrolle",open:"Offen",improval:"Nachbesserung"}[e]||e),Fe=(0,r.useMemo)((()=>{let e=[...o];if(y){const t=y.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)||e.responsible&&"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)))}return N.forEach(((t,a)=>{if(""===t.column||null===t.value)return;const r=t.operator||"equals",s=t.value;e=e.filter((e=>{switch(t.column){case"status":return"equals"!==r||e.status===s;case"title":return"contains"!==r||e.title.toLowerCase().includes(String(s).toLowerCase());default:return!0}}))})),e}),[o,y,N]),He=(0,r.useMemo)((()=>({total:Fe.length,done:Fe.filter((e=>"done"===e.status)).length,inProgress:Fe.filter((e=>"in_progress"===e.status)).length,open:Fe.filter((e=>"open"===e.status)).length,qualityControl:Fe.filter((e=>"quality_control"===e.status)).length,improval:Fe.filter((e=>"improval"===e.status)).length})),[Fe]);return u?(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:u}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 todo-analytics-wrapper",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)(Z.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,T.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:a("analytics.todo.title")})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,T.jsx)("input",{type:"text",placeholder:a("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:y,onChange:e=>w(e.target.value)}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===le?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>{const e="table"===le?"cards":"table";ne(e),J&&J(e)},children:"table"===le?(0,T.jsx)(g.A,{className:"h-5 w-5"}):(0,T.jsx)(h.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("table"===le?"common.viewAsCards":"common.viewAsTable")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsxs)("button",{className:"p-2 rounded-md ".concat(Me()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>O(!z),style:{position:"relative"},children:[(0,T.jsx)(p.A,{className:"h-5 w-5"}),Me()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:Me()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.filter")})]})]})]}),z&&(0,T.jsx)("div",{className:"cards"===le?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(q.A,{columns:Se,onApply:Te,onReset:Ce,savedConditions:N,savedOperators:W,tableId:ee})}),(0,T.jsx)("div",{className:"cards"===le?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:ee,onSelectFilter:Te,onReset:Ce,activeFilterName:D,selectedFilterId:M,onFilterChange:De,defaultFilterName:"Alle"})}),(0,T.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,T.jsx)("button",{onClick:()=>pe(!he),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"".concat(a("analytics.todo.frequencyAnalysis")," ").concat(a(he?"common.collapse":"common.expand")),children:(0,T.jsx)(Q.A,{className:"h-5 w-5 transition-transform ".concat(he?"rotate-180":"")})}),(0,T.jsx)("button",{onClick:()=>je(!ke),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"".concat(a("analytics.todo.shiftAnalysis")," ").concat(a(ke?"common.collapse":"common.expand")),children:(0,T.jsx)(v.A,{className:"h-5 w-5 transition-transform ".concat(ke?"rotate-180":"")})})]}),he&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(A.A,{className:"h-5 w-5"}),a("analytics.todo.frequencyAnalysis")]}),ue?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.todo.loadingAnalysis")})}):me?(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.frequency.totalTodos")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:me.summary.totalTasks})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:me.summary.completedTasks})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.todo.frequency.neverCompleted")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:me.summary.neverCompletedTasks})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.frequency.completionRate")}),(0,T.jsxs)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[me.summary.completionRate,"%"]})]})]}),me.userStats&&me.userStats.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.completionsPerUser")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.user")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.lastCompletion")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:me.userStats.slice(0,10).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):a("analytics.todo.unknown")}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.completedCount}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.lastCompletedAt?(0,d.GP)(new Date(e.lastCompletedAt),"HH:mm"):"-"})]},e.userId)))})]})})]}),me.taskStats&&me.taskStats.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.frequentCompleted")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.status")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.branch")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.completed")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:me.taskStats.slice(0,20).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 ".concat(e.neverCompleted?"bg-red-50 dark:bg-red-900/10":""),children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.title}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(qe(e.currentStatus)),children:Le(e.currentStatus)})}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.completedCount,"x ",e.neverCompleted&&(0,T.jsx)("span",{className:"text-red-600 dark:text-red-400",children:a("analytics.todo.never")})]})]},e.taskId)))})]})})]}),me.statusAverages&&Object.keys(me.statusAverages).length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.averageTimePerStatus")}),(0,T.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(me.statusAverages).map((e=>{let[t,a]=e;return(0,T.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:Le(t)}),(0,T.jsxs)("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[a.averageHours.toFixed(1),"h"]}),(0,T.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[a.taskCount," To-Do(s)"]})]},t)}))})]}),me.summary&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.statusDistribution")}),(0,T.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:(0,T.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,T.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,T.jsx)("span",{children:me.summary.totalTasks}),(0,T.jsx)("span",{children:Math.round(.75*me.summary.totalTasks)}),(0,T.jsx)("span",{children:Math.round(.5*me.summary.totalTasks)}),(0,T.jsx)("span",{children:Math.round(.25*me.summary.totalTasks)}),(0,T.jsx)("span",{children:"0"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex items-end justify-around gap-2 pr-8 pb-1",children:[(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-green-500 dark:bg-green-600 rounded-t",style:{height:"".concat(me.summary.completedTasks>0?me.summary.completedTasks/me.summary.totalTasks*100:0,"%"),minHeight:me.summary.completedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.completed"),": ").concat(me.summary.completedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:me.summary.completedTasks})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-yellow-500 dark:bg-yellow-600 rounded-t",style:{height:"".concat(me.summary.totalTasks-me.summary.completedTasks-me.summary.neverCompletedTasks>0?(me.summary.totalTasks-me.summary.completedTasks-me.summary.neverCompletedTasks)/me.summary.totalTasks*100:0,"%"),minHeight:me.summary.totalTasks-me.summary.completedTasks-me.summary.neverCompletedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.open"),": ").concat(me.summary.totalTasks-me.summary.completedTasks-me.summary.neverCompletedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("tasks.status.open")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:me.summary.totalTasks-me.summary.completedTasks-me.summary.neverCompletedTasks})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-red-500 dark:bg-red-600 rounded-t",style:{height:"".concat(me.summary.neverCompletedTasks>0?me.summary.neverCompletedTasks/me.summary.totalTasks*100:0,"%"),minHeight:me.summary.neverCompletedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.neverCompleted"),": ").concat(me.summary.neverCompletedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("analytics.todo.frequency.neverCompleted")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:me.summary.neverCompletedTasks})]})]})]})})]})]}):(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:a("analytics.todo.noData")})]}),ke&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(v.A,{className:"h-5 w-5"}),a("analytics.todo.shift.shiftBased")]}),fe?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.todo.loadingAnalysis")})}):be?(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.shift.totalShifts")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:be.summary.totalShifts})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.shift.todosInShifts")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:be.summary.totalTasksInShifts})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.shift.totalHours")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:be.summary.totalDurationHours||"0.00"})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.todo.shift.averageDuration")}),(0,T.jsxs)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[be.summary.averageDurationHours||"-","h"]})]}),(0,T.jsxs)("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800",children:[(0,T.jsx)("div",{className:"text-sm text-indigo-600 dark:text-indigo-400",children:a("analytics.todo.shift.averageTodosPerShift")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-indigo-700 dark:text-indigo-300",children:be.summary.totalShifts>0?(be.summary.totalTasksInShifts/be.summary.totalShifts).toFixed(1):"0"})]})]}),be.shifts&&be.shifts.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.shift.shiftsWithTodos")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.user")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.branch")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.time")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.duration")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:be.shifts.map((e=>{const t=we.has(e.workTimeId);return(0,T.jsxs)(r.Fragment,{children:[(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:[e.user.firstName," ",e.user.lastName]}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[(0,d.GP)(new Date(e.startTime),"HH:mm"),e.endTime&&" - ".concat((0,d.GP)(new Date(e.endTime),"HH:mm"))]}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.durationHours?"".concat(e.durationHours,"h"):a("worktime.running")}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("span",{children:e.linkedTasksCount}),e.linkedTasksCount>0&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>{return t=e.workTimeId,void Ne((e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a}));var t},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t?(0,T.jsx)($.A,{className:"h-4 w-4"}):(0,T.jsx)(j.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("analytics.todo.shift.showTodos")})]})]})})]}),t&&e.linkedTasksCount>0&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:5,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[(0,T.jsx)("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("analytics.todo.shift.linkedTasks")}),(0,T.jsx)("div",{className:"space-y-2",children:e.linkedTasks.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(qe(e.status)),children:Le(e.status)}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),e.responsible&&(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.responsible.firstName," ",e.responsible.lastName,")"]})]},e.id)))})]})})})]},e.workTimeId)}))})]})})]}),be.tasksWithShifts&&be.tasksWithShifts.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.shift.tasksWithShiftDistribution")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.status")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.totalShifts")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.totalTime")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:be.tasksWithShifts.slice(0,30).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.task.title}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(qe(e.task.status)),children:Le(e.task.status)})}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.shiftCount,"x"]}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.totalDurationHours,"h"]})]},e.task.id)))})]})})]})]}):(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:a("analytics.todo.noShiftData")})]}),(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("analytics.todo.stats.total")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:He.total})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:He.done})]}),(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.stats.inProgress")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:He.inProgress})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.stats.qualityControl")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:He.qualityControl})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("tasks.status.open")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:He.open})]}),(0,T.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800",children:[(0,T.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:a("tasks.status.improval")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:He.improval})]})]}),Fe.length>0&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(Q.A,{className:"h-5 w-5"}),a("analytics.todo.statusDistribution")]}),(0,T.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:(0,T.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,T.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,T.jsx)("span",{children:He.total}),(0,T.jsx)("span",{children:Math.round(.75*He.total)}),(0,T.jsx)("span",{children:Math.round(.5*He.total)}),(0,T.jsx)("span",{children:Math.round(.25*He.total)}),(0,T.jsx)("span",{children:"0"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex items-end justify-around gap-1 sm:gap-2 pr-8 pb-1",children:[(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-green-500 dark:bg-green-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(He.total>0?He.done/He.total*100:0,"%"),minHeight:He.done>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.completed"),": ").concat(He.done)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:He.done})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-blue-500 dark:bg-blue-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(He.total>0?He.inProgress/He.total*100:0,"%"),minHeight:He.inProgress>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.stats.inProgress"),": ").concat(He.inProgress)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.stats.inProgress")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:He.inProgress})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-purple-500 dark:bg-purple-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(He.total>0?He.qualityControl/He.total*100:0,"%"),minHeight:He.qualityControl>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.stats.qualityControl"),": ").concat(He.qualityControl)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.columns.qualityControl")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:He.qualityControl})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-yellow-500 dark:bg-yellow-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(He.total>0?He.open/He.total*100:0,"%"),minHeight:He.open>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.open"),": ").concat(He.open)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("tasks.status.open")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:He.open})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-red-500 dark:bg-red-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(He.total>0?He.improval/He.total*100:0,"%"),minHeight:He.improval>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.improval"),": ").concat(He.improval)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("tasks.status.improval")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:He.improval})]})]})]})})]}),m?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("common.loading")})}):"table"===le?(0,T.jsx)("div",{className:"overflow-x-auto",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsx)("tr",{children:ae.filter((e=>se.includes(e))).map((e=>{const t=Se.find((t=>t.id===e));return t?(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t.label},e):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:0===Fe.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:ae.filter((e=>se.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"Keine To-Dos f\xfcr dieses Datum gefunden"})}):Fe.map((e=>{const t=de.has(e.id),a=e.statusHistory&&e.statusHistory.length>0;return(0,T.jsxs)(r.Fragment,{children:[(0,T.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:ae.filter((e=>se.includes(e))).map((r=>{switch(r){case"time":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,d.GP)(new Date(e.updatedAt),"HH:mm")},r);case"title":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>ce(e.id),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t?(0,T.jsx)($.A,{className:"h-4 w-4"}):(0,T.jsx)(j.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Status-Historie anzeigen"})]}),(0,T.jsx)("span",{children:e.title})]})},r);case"status":return(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(qe(e.status)),children:Le(e.status)})},r);case"responsible":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):"-"},r);case"qualityControl":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"-"},r);case"branch":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},r);case"createdBy":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName):"-"},r);case"deletedAt":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.deletedAt?(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)(E.A,{className:"h-4 w-4 text-red-500"}),(0,T.jsx)("span",{children:(0,d.GP)(new Date(e.deletedAt),"dd.MM.yyyy HH:mm")}),e.deletedBy&&(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.deletedBy.firstName," ",e.deletedBy.lastName,")"]})]}):"-"},r);default:return null}}))}),t&&a&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:ae.filter((e=>se.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,T.jsx)(A.A,{className:"h-4 w-4"}),"Status-Wechsel"]}),(0,T.jsx)("div",{className:"space-y-2",children:e.statusHistory.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"font-medium",children:(0,d.GP)(new Date(e.changedAt),"HH:mm:ss")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(qe(e.oldStatus||"open")),children:Le(e.oldStatus||"open")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(qe(e.newStatus)),children:Le(e.newStatus)}),(0,T.jsx)("span",{className:"text-gray-400",children:"von"}),(0,T.jsxs)("span",{className:"font-medium",children:[e.user.firstName," ",e.user.lastName]})]},e.id)))})]})})})]},e.id)}))})]})}):(0,T.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:0===Fe.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,T.jsx)(Z.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,T.jsx)("div",{className:"text-sm",children:"Keine To-Dos gefunden"})]}):(0,T.jsx)(B.A,{children:Fe.map((e=>{const t=[];se.includes("branch")&&t.push({icon:(0,T.jsx)(k.A,{className:"h-4 w-4"}),label:"Niederlassung",value:e.branch.name,section:"left"}),se.includes("responsible")&&t.push({icon:(0,T.jsx)(f.A,{className:"h-4 w-4"}),label:"Verantwortlich",value:e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):"-",section:"main"}),se.includes("qualityControl")&&t.push({icon:(0,T.jsx)(f.A,{className:"h-4 w-4"}),label:"Qualit\xe4tskontrolle",value:e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"-",section:"main"}),se.includes("time")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:"Zeit",value:(0,d.GP)(new Date(e.updatedAt),"HH:mm"),section:"right"});const a=e.statusHistory&&e.statusHistory.length>0,r=de.has(e.id),s=a?(0,T.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[(0,T.jsx)(A.A,{className:"h-4 w-4"}),"Status-Wechsel"]}),(0,T.jsx)("div",{className:"space-y-2",children:e.statusHistory.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"font-medium",children:(0,d.GP)(new Date(e.changedAt),"HH:mm:ss")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(qe(e.oldStatus||"open")),children:Le(e.oldStatus||"open")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(qe(e.newStatus)),children:Le(e.newStatus)}),(0,T.jsx)("span",{className:"text-gray-400",children:"von"}),(0,T.jsxs)("span",{className:"font-medium",children:[e.user.firstName," ",e.user.lastName]})]},e.id)))})]}):null;return(0,T.jsx)(_.A,{title:(0,T.jsxs)("span",{children:[(0,T.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.id,":"]})," ",(0,T.jsx)("span",{children:e.title})]}),status:{label:Le(e.status),color:qe(e.status)},metadata:t,expandable:s?{isExpanded:r,content:s,onToggle:()=>ce(e.id)}:void 0},e.id)}))})})]})};var re=a(2704);const se="request-analytics-table",ie=["time","title","status","requester","responsible","branch","deletedAt"],le=e=>{let{selectedDate:t}=e;const{t:a}=(0,s.Bd)(),{user:i}=(0,X.As)(),[o,c]=(0,r.useState)([]),[m,x]=(0,r.useState)(!1),[u,b]=(0,r.useState)(null),[y,w]=(0,r.useState)(""),[N,S]=(0,r.useState)(new Set),[W,C]=(0,r.useState)([]),[D,I]=(0,r.useState)([]),[M,H]=(0,r.useState)(""),[z,O]=(0,r.useState)(null),[R,G]=(0,r.useState)(!1),{settings:V,isLoading:U,updateColumnOrder:Y,updateHiddenColumns:K,toggleColumnVisibility:J,isColumnVisible:Z,updateViewMode:Q}=(0,P.F)(se,{defaultColumnOrder:ie,defaultViewMode:"table"}),ee=(null===V||void 0===V?void 0:V.columnOrder)||ie,te=(null===V||void 0===V?void 0:V.hiddenColumns)||[],ae=ee.filter((e=>!te.includes(e))),le=(null===V||void 0===V?void 0:V.viewMode)||"table",[ne,de]=(0,r.useState)(le);(0,r.useEffect)((()=>{null!==V&&void 0!==V&&V.viewMode&&V.viewMode!==ne&&de(V.viewMode)}),[null===V||void 0===V?void 0:V.viewMode]);const oe=(0,r.useMemo)((()=>[{id:"time",label:a("analytics.request.columns.time")},{id:"title",label:a("analytics.request.columns.title")},{id:"status",label:a("analytics.request.columns.status")},{id:"requester",label:a("analytics.request.columns.requester")},{id:"responsible",label:a("analytics.request.columns.responsible")},{id:"branch",label:a("analytics.request.columns.branch")},{id:"deletedAt",label:a("analytics.request.columns.deletedAt",{defaultValue:"Gel\xf6scht am"})}]),[a]),ce=(0,r.useMemo)((()=>JSON.stringify(W)),[W]),me=(0,r.useMemo)((()=>JSON.stringify(D)),[D]);(0,r.useEffect)((()=>{const e=new AbortController;return(async()=>{try{x(!0),b(null);const a={};t?a.date=t:a.period="week",z?a.filterId=z:W.length>0&&(a.filterConditions=JSON.stringify({conditions:W,operators:D}));const r=await l.A.get(n.Sn.TEAM_WORKTIME.ANALYTICS.REQUESTS_CHRONOLOGICAL,{params:a,signal:e.signal});c(r.data||[])}catch(u){if("AbortError"===(null===u||void 0===u?void 0:u.name)||"CanceledError"===(null===u||void 0===u?void 0:u.name)||"ERR_CANCELED"===(null===u||void 0===u?void 0:u.code))return;console.error("Error loading requests:",u),b(a("analytics.request.loadError"))}finally{e.signal.aborted||x(!1)}})(),()=>{e.abort()}}),[t,ce,me,z,a]);const xe=(0,r.useCallback)(((e,t)=>{C(e),I(t),G(!1)}),[]),ue=(0,r.useCallback)((()=>{C([]),I([]),H(""),O(null)}),[]),ge=(0,r.useCallback)((async(e,t,a,r)=>{H(e),O(t),xe(a,r)}),[xe]),he=(0,F.b)(),{loadFilters:pe}=he;(0,r.useEffect)((()=>{i&&(async()=>{if(!i)return;const e=await pe(se),t="".concat(i.firstName," ").concat(i.lastName).trim()||i.username,a=e.find((e=>e.name===t))||e.find((e=>"Alle"===e.name));a&&await ge(a.name,a.id,a.conditions,a.operators)})()}),[pe,ge,i]);const be=(0,r.useCallback)((()=>W.filter((e=>""!==e.column&&null!==e.value)).length),[W]),ye=e=>{switch(e){case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"approval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"denied":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"to_improve":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},fe=e=>({approved:a("analytics.request.status.approved"),approval:a("analytics.request.status.approval"),denied:a("analytics.request.status.denied"),to_improve:a("analytics.request.status.to_improve")}[e]||e),ve=(0,r.useMemo)((()=>{let e=[...o];if(y){const t=y.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)||"".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase().includes(t)||"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)))}return W.forEach((t=>{if(""===t.column||null===t.value)return;const a=t.operator||"equals",r=t.value;e=e.filter((e=>{switch(t.column){case"status":return"equals"!==a||e.status===r;case"title":return"contains"!==a||e.title.toLowerCase().includes(String(r).toLowerCase());default:return!0}}))})),e}),[o,y,W]),ke=(0,r.useMemo)((()=>({total:ve.length,approved:ve.filter((e=>"approved"===e.status)).length,pending:ve.filter((e=>"approval"===e.status)).length,denied:ve.filter((e=>"denied"===e.status)).length,toImprove:ve.filter((e=>"to_improve"===e.status)).length})),[ve]);return u?(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:u}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 request-analytics-wrapper",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)(re.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,T.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:a("analytics.request.title")})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,T.jsx)("input",{type:"text",placeholder:a("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:y,onChange:e=>w(e.target.value)}),(0,T.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===ne?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>{const e="table"===ne?"cards":"table";de(e),Q&&Q(e)},title:a("table"===ne?"common.viewAsCards":"common.viewAsTable"),children:"table"===ne?(0,T.jsx)(g.A,{className:"h-5 w-5"}):(0,T.jsx)(h.A,{className:"h-5 w-5"})}),(0,T.jsxs)("button",{className:"p-2 rounded-md ".concat(be()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>G(!R),title:a("common.filter"),style:{position:"relative"},children:[(0,T.jsx)(p.A,{className:"h-5 w-5"}),be()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:be()})]})]})]}),R&&(0,T.jsx)("div",{className:"cards"===ne?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(q.A,{columns:oe,onApply:xe,onReset:ue,savedConditions:W,savedOperators:D,tableId:se})}),(0,T.jsx)("div",{className:"cards"===ne?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:se,onSelectFilter:xe,onReset:ue,activeFilterName:M,selectedFilterId:z,onFilterChange:ge,defaultFilterName:"Alle"})}),(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("analytics.request.stats.total")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:ke.total})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.request.status.approved")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:ke.approved})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.request.status.approval")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:ke.pending})]}),(0,T.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800",children:[(0,T.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:a("analytics.request.status.denied")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:ke.denied})]}),(0,T.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:[(0,T.jsx)("div",{className:"text-sm text-orange-600 dark:text-orange-400",children:a("analytics.request.status.to_improve")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:ke.toImprove})]})]}),m?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.request.loading")})}):"table"===ne?(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsx)("tr",{children:ee.filter((e=>ae.includes(e))).map((e=>{const t=oe.find((t=>t.id===e));return t?(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t.label},e):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:0===ve.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:ee.filter((e=>ae.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:a("analytics.request.noRequestsForDate")})}):ve.map((e=>{const t=N.has(e.id),a=e.statusHistory&&e.statusHistory.length>0;return(0,T.jsxs)(r.Fragment,{children:[(0,T.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:ee.filter((e=>ae.includes(e))).map((r=>{switch(r){case"time":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,d.GP)(new Date(e.createdAt),"HH:mm")},r);case"title":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>{return t=e.id,void S((e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a}));var t},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t?(0,T.jsx)($.A,{className:"h-4 w-4"}):(0,T.jsx)(j.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Status-Historie anzeigen"})]}),(0,T.jsx)("span",{children:e.title})]})},r);case"status":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(ye(e.status)),children:fe(e.status)})},r);case"requester":return(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.requester.firstName," ",e.requester.lastName]},r);case"responsible":return(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.responsible.firstName," ",e.responsible.lastName]},r);case"branch":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},r);case"deletedAt":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.deletedAt?(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)(E.A,{className:"h-4 w-4 text-red-500"}),(0,T.jsx)("span",{children:(0,d.GP)(new Date(e.deletedAt),"dd.MM.yyyy HH:mm")}),e.deletedBy&&(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.deletedBy.firstName," ",e.deletedBy.lastName,")"]})]}):"-"},r);default:return null}}))}),t&&a&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:ee.filter((e=>ae.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,T.jsx)(A.A,{className:"h-4 w-4"}),"Status-Wechsel"]}),(0,T.jsx)("div",{className:"space-y-2",children:e.statusHistory.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"font-medium",children:(0,d.GP)(new Date(e.changedAt),"HH:mm:ss")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(ye(e.oldStatus||"approval")),children:fe(e.oldStatus||"approval")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(ye(e.newStatus)),children:fe(e.newStatus)}),(0,T.jsx)("span",{className:"text-gray-400",children:"von"}),(0,T.jsxs)("span",{className:"font-medium",children:[e.user.firstName," ",e.user.lastName]})]},e.id)))})]})})})]},e.id)}))})]})}):(0,T.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:0===ve.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,T.jsx)(re.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,T.jsx)("div",{className:"text-sm",children:a("analytics.request.noRequests")})]}):(0,T.jsx)(B.A,{children:ve.map((e=>{const t=[];return ae.includes("branch")&&t.push({icon:(0,T.jsx)(k.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.branch"),value:e.branch.name,section:"left"}),ae.includes("requester")&&t.push({icon:(0,T.jsx)(f.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.requester"),value:"".concat(e.requester.firstName," ").concat(e.requester.lastName),section:"main"}),ae.includes("responsible")&&t.push({icon:(0,T.jsx)(f.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.responsible"),value:"".concat(e.responsible.firstName," ").concat(e.responsible.lastName),section:"main"}),ae.includes("time")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.time"),value:(0,d.GP)(new Date(e.createdAt),"HH:mm"),section:"right"}),(0,T.jsx)(_.A,{title:(0,T.jsxs)("span",{children:[(0,T.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.id,":"]})," ",(0,T.jsx)("span",{children:e.title})]}),status:{label:fe(e.status),color:ye(e.status)},metadata:t},e.id)}))})})]})};var ne=a(8662),de=a(7988),oe=a(1620),ce=a(8605),me=a(5637),xe=a(1821),ue=a(7285),ge=a(3805),he=a(4625),pe=a(7807);const be=e=>{let{isOpen:t,onClose:a,onShiftCreated:i,initialDate:o,initialBranchId:c,initialRoleId:m}=e;const{t:x}=(0,s.Bd)(),{user:u}=(0,X.As)(),{openSidepane:g,closeSidepane:h}=(0,I.N)(),[p,b]=(0,r.useState)(window.innerWidth>1070),[y,f]=(0,r.useState)(window.innerWidth<640),[v,k]=(0,r.useState)(""),[j,w]=(0,r.useState)(c||""),[C,D]=(0,r.useState)(m||""),[E,M]=(0,r.useState)(""),[q,L]=(0,r.useState)(o?(0,d.GP)(o,"yyyy-MM-dd"):(0,d.GP)(new Date,"yyyy-MM-dd")),[F,H]=(0,r.useState)(""),[P,z]=(0,r.useState)([]),[O,R]=(0,r.useState)([]),[_,B]=(0,r.useState)([]),[V,U]=(0,r.useState)([]),[Y,K]=(0,r.useState)(null),[J,Z]=(0,r.useState)(!1),[Q,$]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=()=>{f(window.innerWidth<640),b(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(g(),ee()):h(),()=>{h()})),[t,g,h]),(0,r.useEffect)((()=>{t&&j&&C&&te()}),[t,j,C]),(0,r.useEffect)((()=>{if(V.length>0&&""===j){const e=c&&V.find((e=>e.id===c))||V[0];w(e.id)}}),[V,j,c]),(0,r.useEffect)((()=>{if(_.length>0&&""===C){const e=m&&_.find((e=>e.id===m))||_[0];D(e.id)}}),[_,C,m]);const ee=async()=>{$(!0),K(null);try{if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void $(!1);const[e,t,a]=await Promise.all([l.A.get(n.Sn.BRANCHES.BASE),l.A.get(n.Sn.ROLES.BASE),l.A.get(n.Sn.USERS.DROPDOWN)]);U(e.data||[]),B(t.data||[]),R(a.data||[]),j&&C&&await te()}catch(a){var e,t;console.error("Fehler beim Laden der Daten:",a),K((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||x("teamWorktime.shifts.modal.errors.loadDataError"))}finally{$(!1)}},te=async()=>{if(j&&C)try{K(null);const e=await l.A.get(n.Sn.SHIFTS.TEMPLATES.BASE,{params:{branchId:Number(j),roleId:Number(C),includeInactive:!1}}),t=e.data.data||e.data||[];z(t),1!==t.length||v||k(t[0].id)}catch(a){var e,t;console.error("Fehler beim Laden der Templates:",a),K((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||x("teamWorktime.shifts.modal.errors.loadTemplatesError"))}},ae=async e=>{e.preventDefault(),K(null),Z(!0);try{if(!v||!j||!C||!q)return K(x("teamWorktime.shifts.modal.errors.fillRequiredFields")),void Z(!1);if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void Z(!1);const e={shiftTemplateId:Number(v),branchId:Number(j),roleId:Number(C),date:q,notes:F||null};E&&(e.userId=Number(E));const t=await l.A.post(n.Sn.SHIFTS.BASE,e);G.v.log("Schicht erfolgreich erstellt:",t.data),i(t.data.data||t.data),re()}catch(r){var t,a;console.error("Fehler beim Erstellen der Schicht:",r);const e=(null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||x("teamWorktime.shifts.modal.errors.createError");K(e)}finally{Z(!1)}},re=()=>{K(null),k(""),w(c||""),D(m||""),M(""),L(o?(0,d.GP)(o,"yyyy-MM-dd"):(0,d.GP)(new Date,"yyyy-MM-dd")),H(""),a()};P.find((e=>e.id===Number(v)));return y?(0,T.jsxs)(N.lG,{open:t,onClose:re,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:x("teamWorktime.shifts.modal.create.title")}),(0,T.jsx)("button",{onClick:re,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:ae,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[Y&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:Y}),Q?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:x("common.loading")}):(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectBranch")}),V.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.role")," *"]}),(0,T.jsxs)("select",{value:C,onChange:e=>{D(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectRole")}),_.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.template")," *"]}),(0,T.jsxs)("select",{value:v,onChange:e=>k(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!j||!C,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectTemplate")}),P.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.name," (",e.startTime," - ",e.endTime,")"]},e.id)))]}),(!j||!C)&&(0,T.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:x("teamWorktime.shifts.modal.create.selectBranchRoleFirst")})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.date")," *"]}),(0,T.jsx)("input",{type:"date",value:q,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.user")}),(0,T.jsxs)("select",{value:E,onChange:e=>M(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectUser")}),O.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.notes")}),(0,T.jsx)("textarea",{value:F,onChange:e=>H(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:x("teamWorktime.shifts.modal.create.notesPlaceholder")})]})]})]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:re,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:x("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:J||Q,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x(J?"common.saving":"common.save"),children:J?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x(J?"common.saving":"common.save")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!p&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:re,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:x("teamWorktime.shifts.modal.create.title")}),(0,T.jsx)("button",{onClick:re,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:ae,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Y&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:Y}),Q?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:x("common.loading")}):(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectBranch")}),V.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.role")," *"]}),(0,T.jsxs)("select",{value:C,onChange:e=>{D(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectRole")}),_.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.template")," *"]}),(0,T.jsxs)("select",{value:v,onChange:e=>k(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!j||!C,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectTemplate")}),P.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.name," (",e.startTime," - ",e.endTime,")"]},e.id)))]}),(!j||!C)&&(0,T.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:x("teamWorktime.shifts.modal.create.selectBranchRoleFirst")})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.date")," *"]}),(0,T.jsx)("input",{type:"date",value:q,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.user")}),(0,T.jsxs)("select",{value:E,onChange:e=>M(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectUser")}),O.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.notes")}),(0,T.jsx)("textarea",{value:F,onChange:e=>H(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:x("teamWorktime.shifts.modal.create.notesPlaceholder")})]})]})]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:re,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:x("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:J||Q,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x(J?"common.saving":"common.save"),children:J?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x(J?"common.saving":"common.save")})]})]})]})]})]})};var ye=a(6011);const fe=e=>{let{isOpen:t,onClose:a,onSwapRequestCreated:i,originalShift:o}=e;const{t:c}=(0,s.Bd)(),{user:m}=(0,X.As)(),{openSidepane:x,closeSidepane:u}=(0,I.N)(),[g,h]=(0,r.useState)(window.innerWidth>1070),[p,b]=(0,r.useState)(window.innerWidth<640),[y,f]=(0,r.useState)(""),[v,k]=(0,r.useState)(""),[j,w]=(0,r.useState)([]),[C,D]=(0,r.useState)(!1),[E,M]=(0,r.useState)(!1),[q,L]=(0,r.useState)(null),[F,H]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(x(),P()):(u(),f(""),k(""),L(null)),()=>{u()})),[t,x,u,o]);const P=async()=>{if(o){M(!0),L(null);try{var e;const t=new Date(o.date);t.setDate(t.getDate()-t.getDay()+1);const a=new Date(t);a.setDate(a.getDate()+6);const r=await l.A.get(n.Sn.SHIFTS.BASE,{params:{startDate:(0,d.GP)(t,"yyyy-MM-dd"),endDate:(0,d.GP)(a,"yyyy-MM-dd")}}),s=((null===(e=r.data)||void 0===e?void 0:e.data)||r.data||[]).filter((e=>e.id!==o.id&&null!==e.userId&&"cancelled"!==e.status&&"swapped"!==e.status&&e.roleId===o.roleId&&e.branchId===o.branchId));w(s)}catch(r){var t,a;console.error("Fehler beim Laden der verf\xfcgbaren Schichten:",r),L((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||c("teamWorktime.shifts.swap.errors.loadShiftsError"))}finally{M(!1)}}},z=async e=>{e.preventDefault(),L(null),H(!0);try{if(!y)return L(c("teamWorktime.shifts.swap.errors.selectTargetShift")),void H(!1);const e=await l.A.post(n.Sn.SHIFTS.SWAPS.BASE,{originalShiftId:o.id,targetShiftId:Number(y),message:v.trim()||null});if(e.data&&!1!==e.data.success)i(),a();else{var t;const a=(null===(t=e.data)||void 0===t?void 0:t.message)||c("teamWorktime.shifts.swap.errors.createError");L(a)}}catch(d){var r,s;console.error("Fehler beim Erstellen der Tausch-Anfrage:",d);const e=(null===(r=d.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||d.message||c("teamWorktime.shifts.swap.errors.createError");L(e)}finally{H(!1)}},O=()=>{L(null),f(""),k(""),a()},R=()=>{var e;return(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:c("teamWorktime.shifts.swap.form.yourShift")}),(0,T.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-400",children:[(0,T.jsx)("div",{children:(null===(e=o.shiftTemplate)||void 0===e?void 0:e.name)||c("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,d.GP)(new Date(o.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,d.GP)(new Date(o.startTime),"HH:mm")," - ",(0,d.GP)(new Date(o.endTime),"HH:mm")]}),o.branch&&(0,T.jsx)("div",{children:o.branch.name}),o.role&&(0,T.jsx)("div",{children:o.role.name})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[c("teamWorktime.shifts.swap.form.targetShift")," *"]}),E?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:c("common.loading")}):0===j.length?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:c("teamWorktime.shifts.swap.form.noShiftsAvailable")}):(0,T.jsxs)("select",{value:y,onChange:e=>f(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:c("teamWorktime.shifts.swap.form.selectTargetShift")}),j.map((e=>(0,T.jsxs)("option",{value:e.id,children:[(0,d.GP)(new Date(e.date),"dd.MM.yyyy")," - ",(0,d.GP)(new Date(e.startTime),"HH:mm")," - ",(0,d.GP)(new Date(e.endTime),"HH:mm"),e.user&&" (".concat(e.user.firstName," ").concat(e.user.lastName,")")]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("teamWorktime.shifts.swap.form.message")}),(0,T.jsx)("textarea",{value:v,onChange:e=>k(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:c("teamWorktime.shifts.swap.form.messagePlaceholder")})]})]})};return p?(0,T.jsxs)(N.lG,{open:t,onClose:O,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:c("teamWorktime.shifts.swap.title")}),(0,T.jsx)("button",{onClick:O,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:z,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[q&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:q}),R()]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:O,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:c("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:F||E||!y,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:c(F?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit"),children:F?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c(F?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!g&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:O,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:c("teamWorktime.shifts.swap.title")}),(0,T.jsx)("button",{onClick:O,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:z,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[q&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:q}),R()]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:O,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:c("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:F||E||!y,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:c(F?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit"),children:F?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c(F?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit")})]})]})]})]})]})},ve=e=>{let{isOpen:t,onClose:a,onShiftUpdated:i,onShiftDeleted:o,shift:c}=e;const{t:m}=(0,s.Bd)(),{user:x}=(0,X.As)(),{openSidepane:u,closeSidepane:g}=(0,I.N)(),[h,p]=(0,r.useState)(window.innerWidth>1070),[b,y]=(0,r.useState)(window.innerWidth<640),[f,v]=(0,r.useState)(c.shiftTemplateId),[k,j]=(0,r.useState)(c.branchId),[w,C]=(0,r.useState)(c.roleId),[D,M]=(0,r.useState)(c.userId||""),[q,L]=(0,r.useState)((0,d.GP)(new Date(c.date),"yyyy-MM-dd")),[F,H]=(0,r.useState)(c.notes||""),[P,z]=(0,r.useState)(c.status),[O,R]=(0,r.useState)([]),[_,B]=(0,r.useState)([]),[V,U]=(0,r.useState)([]),[Y,K]=(0,r.useState)([]),[J,Z]=(0,r.useState)(null),[Q,$]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(!1),[ae,re]=(0,r.useState)(!1),[se,ie]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=()=>{y(window.innerWidth<640),p(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(u(),v(c.shiftTemplateId),j(c.branchId),C(c.roleId),M(c.userId||""),L((0,d.GP)(new Date(c.date),"yyyy-MM-dd")),H(c.notes||""),z(c.status),Z(null),le()):(g(),re(!1)),()=>{g()})),[t,c,u,g]),(0,r.useEffect)((()=>{t&&k&&w&&ne()}),[t,k,w]);const le=async()=>{te(!0),Z(null);try{if(!localStorage.getItem("token"))return Z("Nicht authentifiziert"),void te(!1);const[e,t,a]=await Promise.all([l.A.get(n.Sn.BRANCHES.BASE),l.A.get(n.Sn.ROLES.BASE),l.A.get(n.Sn.USERS.DROPDOWN)]);K(e.data||[]),U(t.data||[]),B(a.data||[]),k&&w&&await ne()}catch(a){var e,t;console.error("Fehler beim Laden der Daten:",a),Z((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.loadDataError"))}finally{te(!1)}},ne=async()=>{if(k&&w)try{Z(null);const e=await l.A.get(n.Sn.SHIFTS.TEMPLATES.BASE,{params:{branchId:Number(k),roleId:Number(w),includeInactive:!0}}),t=e.data.data||e.data||[];R(t)}catch(a){var e,t;console.error("Fehler beim Laden der Templates:",a),Z((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.loadTemplatesError"))}},de=async e=>{e.preventDefault(),Z(null),$(!0);try{if(!f||!k||!w||!q)return Z(m("teamWorktime.shifts.modal.errors.fillRequiredFields")),void $(!1);if(!localStorage.getItem("token"))return Z("Nicht authentifiziert"),void $(!1);const e={userId:D?Number(D):null,date:q,notes:F||null,status:P},t=await l.A.put(n.Sn.SHIFTS.BY_ID(c.id),e);G.v.log("Schicht erfolgreich aktualisiert:",t.data),i(t.data.data||t.data),ce()}catch(r){var t,a;console.error("Fehler beim Aktualisieren der Schicht:",r);const e=(null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||m("teamWorktime.shifts.modal.errors.updateError");Z(e)}finally{$(!1)}},oe=async()=>{Z(null),$(!0);try{if(!localStorage.getItem("token"))return Z("Nicht authentifiziert"),void $(!1);await l.A.delete(n.Sn.SHIFTS.BY_ID(c.id)),G.v.log("Schicht erfolgreich gel\xf6scht"),o(c.id),ce()}catch(a){var e,t;console.error("Fehler beim L\xf6schen der Schicht:",a);const r=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.deleteError");Z(r)}finally{$(!1),re(!1)}},ce=()=>{Z(null),re(!1),a()},me=()=>{var e,t,a;return(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.branch")}),(0,T.jsx)("input",{type:"text",value:(null===(e=Y.find((e=>e.id===k)))||void 0===e?void 0:e.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.role")}),(0,T.jsx)("input",{type:"text",value:(null===(t=V.find((e=>e.id===w)))||void 0===t?void 0:t.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.template")}),(0,T.jsx)("input",{type:"text",value:(null===(a=c.shiftTemplate)||void 0===a?void 0:a.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.modal.edit.date")," *"]}),(0,T.jsx)("input",{type:"date",value:q,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.user")}),(0,T.jsxs)("select",{value:D,onChange:e=>M(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:m("teamWorktime.shifts.modal.edit.selectUser")}),_.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.modal.edit.status")," *"]}),(0,T.jsxs)("select",{value:P,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"scheduled",children:m("teamWorktime.shifts.status.scheduled")}),(0,T.jsx)("option",{value:"confirmed",children:m("teamWorktime.shifts.status.confirmed")}),(0,T.jsx)("option",{value:"cancelled",children:m("teamWorktime.shifts.status.cancelled")}),(0,T.jsx)("option",{value:"swapped",children:m("teamWorktime.shifts.status.swapped")})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.notes")}),(0,T.jsx)("textarea",{value:F,onChange:e=>H(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:m("teamWorktime.shifts.modal.edit.notesPlaceholder")})]}),c.userId===(null===x||void 0===x?void 0:x.id)&&"cancelled"!==c.status&&"swapped"!==c.status&&(0,T.jsx)("div",{className:"pt-4 border-t dark:border-gray-700",children:(0,T.jsxs)("button",{type:"button",onClick:()=>ie(!0),className:"w-full px-4 py-2 text-sm font-medium text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center justify-center gap-2",children:[(0,T.jsx)(ye.A,{className:"h-5 w-5"}),m("teamWorktime.shifts.actions.swap")]})}),(0,T.jsx)("div",{className:"pt-4 border-t dark:border-gray-700",children:(0,T.jsx)("button",{type:"button",onClick:()=>re(!0),className:"w-full p-2 text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md hover:bg-red-100 dark:hover:bg-red-900/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 flex items-center justify-center",title:m("teamWorktime.shifts.modal.edit.delete"),children:(0,T.jsx)(E.A,{className:"h-5 w-5"})})}),ae&&(0,T.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[(0,T.jsx)("p",{className:"text-sm text-red-700 dark:text-red-400 mb-3",children:m("teamWorktime.shifts.modal.edit.deleteConfirm")}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{type:"button",onClick:oe,disabled:Q,className:"flex-1 p-2 text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",title:m("common.yes"),children:(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{type:"button",onClick:()=>re(!1),className:"flex-1 p-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",title:m("common.no"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})})]})]})]})};return b?(0,T.jsxs)(N.lG,{open:t,onClose:ce,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.modal.edit.title")}),(0,T.jsx)("button",{onClick:ce,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:de,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[J&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:J}),ee?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):me()]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:ce,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Q||ee,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(Q?"common.saving":"common.save"),children:Q?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(Q?"common.saving":"common.save")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!h&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:ce,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.modal.edit.title")}),(0,T.jsx)("button",{onClick:ce,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:de,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[J&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:J}),ee?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):me()]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:ce,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Q||ee,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(Q?"common.saving":"common.save"),children:Q?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(Q?"common.saving":"common.save")})]})]})]})]}),c.userId===(null===x||void 0===x?void 0:x.id)&&(0,T.jsx)(fe,{isOpen:se,onClose:()=>ie(!1),onSwapRequestCreated:()=>{ie(!1),i(c)},originalShift:c})]})};var ke=a(9399),je=a(4538);const we=e=>{let{isOpen:t,onClose:a,onPlanGenerated:i,initialStartDate:o,initialEndDate:c}=e;const{t:m}=(0,s.Bd)(),{openSidepane:x,closeSidepane:u}=(0,I.N)(),[g,h]=(0,r.useState)(window.innerWidth>1070),[p,b]=(0,r.useState)(window.innerWidth<640),[y,f]=(0,r.useState)(o?(0,d.GP)(o,"yyyy-MM-dd"):(0,d.GP)((0,oe.k)(new Date,{weekStartsOn:1}),"yyyy-MM-dd")),[v,k]=(0,r.useState)(c?(0,d.GP)(c,"yyyy-MM-dd"):(0,d.GP)((0,ce.$)(new Date,{weekStartsOn:1}),"yyyy-MM-dd")),[j,w]=(0,r.useState)(""),[C,D]=(0,r.useState)([]),[E,M]=(0,r.useState)([]),[q,L]=(0,r.useState)([]),[F,H]=(0,r.useState)(null),[P,z]=(0,r.useState)(!1),[O,R]=(0,r.useState)(!1),[_,B]=(0,r.useState)(!1),[G,V]=(0,r.useState)(null),[U,Y]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(x(),K(),V(null),Y(!1)):u(),()=>{u()})),[t,x,u]),(0,r.useEffect)((()=>{t&&j?J():(L([]),D([]))}),[t,j]),(0,r.useEffect)((()=>{E.length>0&&""===j&&w(E[0].id)}),[E,j]);const K=async()=>{R(!0),H(null);try{if(!localStorage.getItem("token"))return H("Nicht authentifiziert"),void R(!1);const e=await l.A.get(n.Sn.BRANCHES.BASE);M(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der Branches:",a),H((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.generate.errors.loadBranchesError"))}finally{R(!1)}},J=async()=>{if(j)try{H(null);const e=(await l.A.get(n.Sn.ROLES.BASE)).data||[];L(e)}catch(a){var e,t;console.error("Fehler beim Laden der Rollen:",a),H((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.generate.errors.loadRolesError"))}},Z=()=>{C.length===q.length?D([]):D(q.map((e=>e.id)))},Q=async e=>{e.preventDefault(),H(null),B(!0),V(null),Y(!1);try{if(!y||!v||!j)return H(m("teamWorktime.shifts.generate.errors.fillRequiredFields")),void B(!1);const e=new Date(y),t=new Date(v);if(isNaN(e.getTime())||isNaN(t.getTime()))return H(m("teamWorktime.shifts.generate.errors.invalidDates")),void B(!1);if(e>=t)return H(m("teamWorktime.shifts.generate.errors.startDateAfterEndDate")),void B(!1);if(!localStorage.getItem("token"))return H("Nicht authentifiziert"),void B(!1);const a={startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0],branchId:Number(j)};C.length>0&&(a.roleIds=C);const r=await l.A.post(n.Sn.SHIFTS.GENERATE,a),s=r.data.data||r.data;V(s),Y(!0),i()}catch(r){var t,a;console.error("Fehler beim Generieren des Schichtplans:",r);const e=(null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||m("teamWorktime.shifts.generate.errors.generateError");H(e)}finally{B(!1)}},$=()=>{H(null),V(null),Y(!1),D([]),a()},X=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.startDate")," *"]}),(0,T.jsx)("input",{type:"date",value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.endDate")," *"]}),(0,T.jsx)("input",{type:"date",value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),D([])},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:m("teamWorktime.shifts.generate.form.selectBranch")}),E.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:m("teamWorktime.shifts.generate.form.roles")}),q.length>0&&(0,T.jsx)("button",{type:"button",onClick:Z,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:C.length===q.length?m("teamWorktime.shifts.generate.form.deselectAll"):m("teamWorktime.shifts.generate.form.selectAll")})]}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:m("teamWorktime.shifts.generate.form.rolesHint")}),j?0===q.length?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:m("teamWorktime.shifts.generate.form.noRolesAvailable")}):(0,T.jsx)("div",{className:"max-h-48 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 space-y-2",children:q.map((e=>(0,T.jsxs)("label",{className:"flex items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[(0,T.jsx)("input",{type:"checkbox",checked:C.includes(e.id),onChange:()=>{return t=e.id,void D((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))}):(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:m("teamWorktime.shifts.generate.form.selectBranchFirst")})]})]}),ee=()=>G?(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-3",children:m("teamWorktime.shifts.generate.result.summary")}),(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-blue-700 dark:text-blue-400",children:m("teamWorktime.shifts.generate.result.total")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-blue-900 dark:text-blue-300",children:G.summary.total})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-green-700 dark:text-green-400",children:m("teamWorktime.shifts.generate.result.assigned")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-green-900 dark:text-green-300",children:G.summary.assigned})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-orange-700 dark:text-orange-400",children:m("teamWorktime.shifts.generate.result.unassigned")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-orange-900 dark:text-orange-300",children:G.summary.unassigned})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-red-700 dark:text-red-400",children:m("teamWorktime.shifts.generate.result.conflicts")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-red-900 dark:text-red-300",children:G.summary.conflicts})]})]})]}),G.conflicts&&G.conflicts.length>0&&(0,T.jsxs)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md",children:[(0,T.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,T.jsx)(ke.A,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),(0,T.jsxs)("h3",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-300",children:[m("teamWorktime.shifts.generate.result.conflictsTitle")," (",G.conflicts.length,")"]})]}),(0,T.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-1",children:G.conflicts.map(((e,t)=>(0,T.jsxs)("div",{className:"text-xs text-yellow-800 dark:text-yellow-400",children:[(0,d.GP)(new Date(e.date),"dd.MM.yyyy"),": ",e.reason]},t)))})]}),0===G.summary.conflicts&&0===G.summary.unassigned&&(0,T.jsx)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)(je.A,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),(0,T.jsx)("span",{className:"text-sm font-medium text-green-900 dark:text-green-300",children:m("teamWorktime.shifts.generate.result.success")})]})})]}):null;return p?(0,T.jsxs)(N.lG,{open:t,onClose:$,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.generate.title")}),(0,T.jsx)("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:Q,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[F&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:F}),U&&G?ee():O?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):X()]}),(0,T.jsx)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:U?(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",title:m("common.close"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.close")})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:_||O,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(_?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate"),children:_?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(_?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate")})]})]})})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!g&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:$,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.generate.title")}),(0,T.jsx)("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:Q,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[F&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:F}),U&&G?ee():O?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):X()]}),(0,T.jsx)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:U?(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",title:m("common.close"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.close")})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:_||O,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(_?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate"),children:_?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(_?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate")})]})]})})]})]})]})};var Ne=a(7098);const Se=e=>{let{isOpen:t,onClose:a,onSwapRequestUpdated:i}=e;const{t:o}=(0,s.Bd)(),{user:c}=(0,X.As)(),{openSidepane:m,closeSidepane:x}=(0,I.N)(),[u,g]=(0,r.useState)(window.innerWidth>1070),[h,p]=(0,r.useState)(window.innerWidth<640),[b,y]=(0,r.useState)([]),[f,v]=(0,r.useState)(!1),[k,j]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[D,E]=(0,r.useState)("all");(0,r.useEffect)((()=>{const e=()=>{p(window.innerWidth<640),g(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(m(),M()):x(),()=>{x()})),[t,m,x]);const M=async()=>{v(!0),j(null);try{var e;const t=await l.A.get(n.Sn.SHIFTS.SWAPS.BASE,{params:null!==c&&void 0!==c&&c.id?{userId:c.id}:{}}),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];y(Array.isArray(a)?a:[])}catch(r){var t,a;console.error("Fehler beim Laden der Tausch-Anfragen:",r),j((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||o("teamWorktime.shifts.swapList.errors.loadError"))}finally{v(!1)}},q=b.filter((e=>"all"===D||e.status===D)),L=q.filter((e=>e.requestedBy===(null===c||void 0===c?void 0:c.id))),F=q.filter((e=>e.requestedFrom===(null===c||void 0===c?void 0:c.id))),H=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},P=e=>{switch(e){case"pending":return o("teamWorktime.shifts.swapList.status.pending");case"approved":return o("teamWorktime.shifts.swapList.status.approved");case"rejected":return o("teamWorktime.shifts.swapList.status.rejected");default:return e}},z=(e,t)=>{var a,r;return(0,T.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg mb-4",children:[(0,T.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(H(e.status)),children:P(e.status)}),(0,T.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,d.GP)(new Date(e.createdAt),"dd.MM.yyyy HH:mm")})]}),t?(0,T.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[e.requester.firstName," ",e.requester.lastName]})," ",o("teamWorktime.shifts.swapList.wantsToSwap")]}):(0,T.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[o("teamWorktime.shifts.swapList.youRequestedSwap")," ",(0,T.jsxs)("span",{className:"font-medium",children:[e.requestee.firstName," ",e.requestee.lastName]})]})]})}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,T.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h4",{className:"text-xs font-semibold text-blue-900 dark:text-blue-300 mb-1",children:o(t?"teamWorktime.shifts.swapList.theirShift":"teamWorktime.shifts.swapList.yourShift")}),(0,T.jsxs)("div",{className:"text-xs text-blue-800 dark:text-blue-400",children:[(0,T.jsx)("div",{children:(null===(a=e.originalShift.shiftTemplate)||void 0===a?void 0:a.name)||o("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,d.GP)(new Date(e.originalShift.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,d.GP)(new Date(e.originalShift.startTime),"HH:mm")," - ",(0,d.GP)(new Date(e.originalShift.endTime),"HH:mm")]}),e.originalShift.branch&&(0,T.jsx)("div",{children:e.originalShift.branch.name})]})]}),(0,T.jsxs)("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[(0,T.jsx)("h4",{className:"text-xs font-semibold text-green-900 dark:text-green-300 mb-1",children:o(t?"teamWorktime.shifts.swapList.theirShift":"teamWorktime.shifts.swapList.yourShift")}),(0,T.jsxs)("div",{className:"text-xs text-green-800 dark:text-green-400",children:[(0,T.jsx)("div",{children:(null===(r=e.targetShift.shiftTemplate)||void 0===r?void 0:r.name)||o("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,d.GP)(new Date(e.targetShift.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,d.GP)(new Date(e.targetShift.startTime),"HH:mm")," - ",(0,d.GP)(new Date(e.targetShift.endTime),"HH:mm")]}),e.targetShift.branch&&(0,T.jsx)("div",{children:e.targetShift.branch.name})]})]})]}),e.message&&(0,T.jsxs)("div",{className:"mb-3 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm text-gray-700 dark:text-gray-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[o("teamWorktime.shifts.swapList.message"),":"]})," ",e.message]}),e.responseMessage&&(0,T.jsxs)("div",{className:"mb-3 p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-sm text-blue-700 dark:text-blue-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[o("teamWorktime.shifts.swapList.response"),":"]})," ",e.responseMessage]}),t&&"pending"===e.status&&(0,T.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,T.jsx)("button",{onClick:()=>(async e=>{if(c){C(e.id),j(null);try{await l.A.put(n.Sn.SHIFTS.SWAPS.APPROVE(e.id),{responseMessage:null}),await M(),i()}catch(r){var t,a;console.error("Fehler beim Genehmigen der Tausch-Anfrage:",r),j((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||o("teamWorktime.shifts.swapList.errors.approveError"))}finally{C(null)}}})(e),disabled:w===e.id,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===e.id?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A.A,{className:"h-4 w-4 animate-spin"}),o("teamWorktime.shifts.swapList.approving")]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(W.A,{className:"h-4 w-4"}),o("teamWorktime.shifts.swapList.approve")]})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(c){C(e.id),j(null);try{await l.A.put(n.Sn.SHIFTS.SWAPS.REJECT(e.id),{responseMessage:null}),await M(),i()}catch(r){var t,a;console.error("Fehler beim Ablehnen der Tausch-Anfrage:",r),j((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||o("teamWorktime.shifts.swapList.errors.rejectError"))}finally{C(null)}}})(e),disabled:w===e.id,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===e.id?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A.A,{className:"h-4 w-4 animate-spin"}),o("teamWorktime.shifts.swapList.rejecting")]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Ne.A,{className:"h-4 w-4"}),o("teamWorktime.shifts.swapList.reject")]})})]})]},e.id)},O=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>E("all"),className:"px-3 py-1 text-sm rounded-md ".concat("all"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.all")}),(0,T.jsx)("button",{onClick:()=>E("pending"),className:"px-3 py-1 text-sm rounded-md ".concat("pending"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.pending")}),(0,T.jsx)("button",{onClick:()=>E("approved"),className:"px-3 py-1 text-sm rounded-md ".concat("approved"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.approved")}),(0,T.jsx)("button",{onClick:()=>E("rejected"),className:"px-3 py-1 text-sm rounded-md ".concat("rejected"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.rejected")})]}),k&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:k}),f?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:o("common.loading")}):(0,T.jsxs)(T.Fragment,{children:[F.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:[o("teamWorktime.shifts.swapList.receivedRequests")," (",F.length,")"]}),F.map((e=>z(e,!0)))]}),L.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:[o("teamWorktime.shifts.swapList.yourRequests")," (",L.length,")"]}),L.map((e=>z(e,!1)))]}),0===q.length&&(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("teamWorktime.shifts.swapList.noRequests")})]})]});return h?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.shifts.swapList.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:O()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!u&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.shifts.swapList.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:O()})]})]})},Ae=e=>{let{isOpen:t,onClose:a}=e;const{t:i}=(0,s.Bd)(),{openSidepane:d,closeSidepane:o}=(0,I.N)(),[c,m]=(0,r.useState)(window.innerWidth>1070),[x,u]=(0,r.useState)(window.innerWidth<640),[g,h]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[f,v]=(0,r.useState)([]),[k,j]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),[M,q]=(0,r.useState)(null),[L,F]=(0,r.useState)(!1),[H,P]=(0,r.useState)(null),[z,O]=(0,r.useState)({name:"",roleId:"",branchId:"",startTime:"",endTime:"",duration:"",isActive:!0});(0,r.useEffect)((()=>{const e=()=>{u(window.innerWidth<640),m(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(d(),R()):(o(),F(!1),P(null),_()),()=>{o()})),[t,d,o]);const R=async()=>{C(!0),q(null);try{var e;const[t,a,r]=await Promise.all([l.A.get(n.Sn.SHIFTS.TEMPLATES.BASE,{params:{includeInactive:!0}}),l.A.get(n.Sn.ROLES.BASE),l.A.get(n.Sn.BRANCHES.BASE)]);h((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[]),b(a.data||[]),v(r.data||[])}catch(r){var t,a;console.error("Fehler beim Laden der Daten:",r),q((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.templates.errors.loadError"))}finally{C(!1)}},_=()=>{O({name:"",roleId:"",branchId:"",startTime:"",endTime:"",duration:"",isActive:!0}),P(null)},B=async e=>{e.preventDefault(),q(null),j(!0);try{if(!z.name||!z.roleId||!z.branchId||!z.startTime||!z.endTime)return q(i("teamWorktime.shifts.templates.errors.fillRequiredFields")),void j(!1);const e={name:z.name.trim(),roleId:Number(z.roleId),branchId:Number(z.branchId),startTime:z.startTime,endTime:z.endTime,duration:z.duration?Number(z.duration):null,isActive:z.isActive};H?await l.A.put(n.Sn.SHIFTS.TEMPLATES.BY_ID(H.id),e):await l.A.post(n.Sn.SHIFTS.TEMPLATES.BASE,e),await R(),F(!1),_()}catch(r){var t,a;console.error("Fehler beim Speichern des Templates:",r),q((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.templates.errors.saveError"))}finally{j(!1)}},G=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[M&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:M}),L?(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i(H?"teamWorktime.shifts.templates.editTitle":"teamWorktime.shifts.templates.createTitle")}),(0,T.jsx)("button",{onClick:()=>{F(!1),_()},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.name")," *"]}),(0,T.jsx)("input",{type:"text",value:z.name,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.branch")," *"]}),(0,T.jsxs)("select",{value:z.branchId,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{branchId:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!!H,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.templates.form.selectBranch")}),f.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.role")," *"]}),(0,T.jsxs)("select",{value:z.roleId,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{roleId:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!!H,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.templates.form.selectRole")}),p.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.startTime")," *"]}),(0,T.jsx)("input",{type:"time",value:z.startTime,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.endTime")," *"]}),(0,T.jsx)("input",{type:"time",value:z.endTime,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.templates.form.duration")}),(0,T.jsx)("input",{type:"number",value:z.duration,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{duration:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:i("teamWorktime.shifts.templates.form.durationPlaceholder"),min:"0"})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"checkbox",id:"isActive",checked:z.isActive,onChange:e=>O((0,D.A)((0,D.A)({},z),{},{isActive:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("teamWorktime.shifts.templates.form.isActive")})]}),(0,T.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{F(!1),_()},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:k,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:i(k?"common.saving":"common.save"),children:k?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i(k?"common.saving":"common.save")})]})]})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:()=>F(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,T.jsx)(ne.A,{className:"h-5 w-5"})})]}),w?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:i("common.loading")}):0===g.length?(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i("teamWorktime.shifts.templates.noTemplates")}):(0,T.jsx)("div",{className:"space-y-2",children:g.map((e=>{var t,a;return(0,T.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg flex items-center justify-between",children:[(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),!e.isActive&&(0,T.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:i("teamWorktime.shifts.templates.inactive")})]}),(0,T.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[null===(t=e.branch)||void 0===t?void 0:t.name," - ",null===(a=e.role)||void 0===a?void 0:a.name]}),(0,T.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:[e.startTime," - ",e.endTime,e.duration&&" (".concat(e.duration," ").concat(i("teamWorktime.shifts.templates.minutes"),")")]})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>(e=>{P(e),O({name:e.name,roleId:e.roleId,branchId:e.branchId,startTime:e.startTime,endTime:e.endTime,duration:e.duration||"",isActive:e.isActive}),F(!0)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:(0,T.jsx)(y.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(i("teamWorktime.shifts.templates.deleteConfirm"))){q(null),j(!0);try{await l.A.delete(n.Sn.SHIFTS.TEMPLATES.BY_ID(e)),await R()}catch(r){var t,a;console.error("Fehler beim L\xf6schen des Templates:",r),q((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.templates.errors.deleteError"))}finally{j(!1)}}})(e.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:(0,T.jsx)(E.A,{className:"h-5 w-5"})})]})]},e.id)}))})]})]});return x?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:G()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!c&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:G()})]})]})},We=e=>{let{isOpen:t,onClose:a}=e;const{t:i}=(0,s.Bd)(),{user:o}=(0,X.As)(),{hasPermission:c}=(0,z.S)(),{openSidepane:m,closeSidepane:x}=(0,I.N)(),[u,g]=(0,r.useState)(window.innerWidth>1070),[h,p]=(0,r.useState)(window.innerWidth<640),b=c("availability_management","write","page"),[f,v]=(0,r.useState)([]),[k,j]=(0,r.useState)([]),[w,C]=(0,r.useState)([]),[M,q]=(0,r.useState)([]),[L,F]=(0,r.useState)(null),[H,P]=(0,r.useState)(!1),[O,R]=(0,r.useState)(!1),[_,B]=(0,r.useState)(null),[G,V]=(0,r.useState)(!1),[U,Y]=(0,r.useState)(null),[K,J]=(0,r.useState)({userId:null,branchId:"",roleId:"",dayOfWeek:"",startTime:"",endTime:"",startDate:"",endDate:"",type:"available",priority:5,notes:"",isActive:!0}),Z=[{value:"",label:i("teamWorktime.shifts.availabilities.form.allDays")},{value:0,label:i("teamWorktime.shifts.availabilities.form.sunday")},{value:1,label:i("teamWorktime.shifts.availabilities.form.monday")},{value:2,label:i("teamWorktime.shifts.availabilities.form.tuesday")},{value:3,label:i("teamWorktime.shifts.availabilities.form.wednesday")},{value:4,label:i("teamWorktime.shifts.availabilities.form.thursday")},{value:5,label:i("teamWorktime.shifts.availabilities.form.friday")},{value:6,label:i("teamWorktime.shifts.availabilities.form.saturday")}];(0,r.useEffect)((()=>{const e=()=>{p(window.innerWidth<640),g(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?(m(),Q()):(x(),V(!1),Y(null),$(),F(null)),()=>{x()})),[t,m,x,L,b]);const Q=async()=>{R(!0),B(null);try{var e;if(b)try{const e=await l.A.get(n.Sn.USERS.DROPDOWN);q(e.data||[])}catch(r){console.error("Fehler beim Laden der User:",r)}const t={includeInactive:!0};b&&L?t.userId=L:b&&!L||null!==o&&void 0!==o&&o.id&&(t.userId=o.id);const[a,s,i]=await Promise.all([l.A.get(n.Sn.SHIFTS.AVAILABILITIES.BASE,{params:t}),l.A.get(n.Sn.ROLES.BASE),l.A.get(n.Sn.BRANCHES.BASE)]);v((null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[]),j(s.data||[]),C(i.data||[])}catch(r){var t,a;console.error("Fehler beim Laden der Daten:",r),B((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.availabilities.errors.loadError"))}finally{R(!1)}},$=()=>{J({userId:null,branchId:"",roleId:"",dayOfWeek:"",startTime:"",endTime:"",startDate:"",endDate:"",type:"available",priority:5,notes:"",isActive:!0}),Y(null)},ee=async e=>{e.preventDefault(),B(null),P(!0);try{const e={branchId:K.branchId?Number(K.branchId):null,roleId:K.roleId?Number(K.roleId):null,dayOfWeek:""===K.dayOfWeek||null===K.dayOfWeek?null:Number(K.dayOfWeek),startTime:K.startTime||null,endTime:K.endTime||null,startDate:K.startDate||null,endDate:K.endDate||null,type:K.type,priority:K.priority,notes:K.notes.trim()||null,isActive:K.isActive};b&&K.userId&&(e.userId=K.userId),U?await l.A.put(n.Sn.SHIFTS.AVAILABILITIES.BY_ID(U.id),e):await l.A.post(n.Sn.SHIFTS.AVAILABILITIES.BASE,e),await Q(),V(!1),$()}catch(r){var t,a;console.error("Fehler beim Speichern der Verf\xfcgbarkeit:",r),B((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.availabilities.errors.saveError"))}finally{P(!1)}},te=e=>{if(null===e)return i("teamWorktime.shifts.availabilities.form.allDays");return[i("teamWorktime.shifts.availabilities.form.sunday"),i("teamWorktime.shifts.availabilities.form.monday"),i("teamWorktime.shifts.availabilities.form.tuesday"),i("teamWorktime.shifts.availabilities.form.wednesday"),i("teamWorktime.shifts.availabilities.form.thursday"),i("teamWorktime.shifts.availabilities.form.friday"),i("teamWorktime.shifts.availabilities.form.saturday")][e]},ae=e=>{switch(e){case"available":return i("teamWorktime.shifts.availabilities.type.available");case"preferred":return i("teamWorktime.shifts.availabilities.type.preferred");case"unavailable":return i("teamWorktime.shifts.availabilities.type.unavailable");default:return e}},re=e=>{switch(e){case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"preferred":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"unavailable":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},se=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[_&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:_}),b&&!G&&(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("teamWorktime.shifts.availabilities.filter.user")}),(0,T.jsxs)("select",{value:L||"",onChange:e=>{const t=e.target.value?parseInt(e.target.value,10):null;F(t)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.filter.allUsers")}),M.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),G?(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i(U?"teamWorktime.shifts.availabilities.editTitle":"teamWorktime.shifts.availabilities.createTitle")}),(0,T.jsx)("button",{onClick:()=>{V(!1),$()},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:ee,className:"space-y-4",children:[b&&(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.user")}),(0,T.jsxs)("select",{value:K.userId||"",onChange:e=>J((0,D.A)((0,D.A)({},K),{},{userId:e.target.value?Number(e.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!!U,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectUser")}),M.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]}),U&&(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.userReadOnly")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.branch")}),(0,T.jsxs)("select",{value:K.branchId,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{branchId:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectBranch")}),w.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.role")}),(0,T.jsxs)("select",{value:K.roleId,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{roleId:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectRole")}),k.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.dayOfWeek")}),(0,T.jsx)("select",{value:null===K.dayOfWeek?"":K.dayOfWeek,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{dayOfWeek:""===e.target.value?null:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Z.map((e=>(0,T.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.startTime")}),(0,T.jsx)("input",{type:"time",value:K.startTime,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.startTimeHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.endTime")}),(0,T.jsx)("input",{type:"time",value:K.endTime,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.endTimeHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.startDate")}),(0,T.jsx)("input",{type:"date",value:K.startDate,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{startDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.startDateHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.endDate")}),(0,T.jsx)("input",{type:"date",value:K.endDate,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{endDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.endDateHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.type")}),(0,T.jsxs)("select",{value:K.type,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"available",children:i("teamWorktime.shifts.availabilities.type.available")}),(0,T.jsx)("option",{value:"preferred",children:i("teamWorktime.shifts.availabilities.type.preferred")}),(0,T.jsx)("option",{value:"unavailable",children:i("teamWorktime.shifts.availabilities.type.unavailable")})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.availabilities.form.priority")," (1-10)"]}),(0,T.jsx)("input",{type:"number",value:K.priority,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{priority:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"10"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.notes")}),(0,T.jsx)("textarea",{value:K.notes,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{notes:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:i("teamWorktime.shifts.availabilities.form.notesPlaceholder")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"checkbox",id:"isActive",checked:K.isActive,onChange:e=>J((0,D.A)((0,D.A)({},K),{},{isActive:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("teamWorktime.shifts.availabilities.form.isActive")})]}),(0,T.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{V(!1),$()},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:H,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:i(H?"common.saving":"common.save"),children:H?(0,T.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i(H?"common.saving":"common.save")})]})]})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:()=>V(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,T.jsx)(ne.A,{className:"h-5 w-5"})})]}),O?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:i("common.loading")}):0===f.length?(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i("teamWorktime.shifts.availabilities.noAvailabilities")}):(0,T.jsx)("div",{className:"space-y-2",children:f.map((e=>(0,T.jsx)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:(0,T.jsxs)("div",{className:"flex items-start justify-between",children:[(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(re(e.type)),children:ae(e.type)}),!e.isActive&&(0,T.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:i("teamWorktime.shifts.availabilities.inactive")}),e.priority&&(0,T.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i("teamWorktime.shifts.availabilities.priority"),": ",e.priority]})]}),(0,T.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[e.user&&b&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.userLabel"),":"]})," ",e.user.firstName," ",e.user.lastName]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.dayOfWeek"),":"]})," ",te(e.dayOfWeek)]}),e.startTime&&e.endTime&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.startTime")," - ",i("teamWorktime.shifts.availabilities.form.endTime"),":"]})," ",e.startTime," - ",e.endTime]}),e.startDate&&e.endDate&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.startDate")," - ",i("teamWorktime.shifts.availabilities.form.endDate"),":"]})," ",(0,d.GP)(new Date(e.startDate),"dd.MM.yyyy")," - ",(0,d.GP)(new Date(e.endDate),"dd.MM.yyyy")]}),e.branch&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.branch"),":"]})," ",e.branch.name]}),e.role&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.role"),":"]})," ",e.role.name]}),e.notes&&(0,T.jsx)("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700 rounded text-xs",children:e.notes})]})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>(e=>{Y(e),J({userId:e.userId,branchId:e.branchId||"",roleId:e.roleId||"",dayOfWeek:null!==e.dayOfWeek?e.dayOfWeek:"",startTime:e.startTime||"",endTime:e.endTime||"",startDate:e.startDate?(0,d.GP)(new Date(e.startDate),"yyyy-MM-dd"):"",endDate:e.endDate?(0,d.GP)(new Date(e.endDate),"yyyy-MM-dd"):"",type:e.type,priority:e.priority,notes:e.notes||"",isActive:e.isActive}),V(!0)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:(0,T.jsx)(y.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(i("teamWorktime.shifts.availabilities.deleteConfirm"))){B(null),P(!0);try{await l.A.delete(n.Sn.SHIFTS.AVAILABILITIES.BY_ID(e)),await Q()}catch(r){var t,a;console.error("Fehler beim L\xf6schen der Verf\xfcgbarkeit:",r),B((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message||i("teamWorktime.shifts.availabilities.errors.deleteError"))}finally{P(!1)}}})(e.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:(0,T.jsx)(E.A,{className:"h-5 w-5"})})]})]})},e.id)))})]})]});return h?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:se()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!u&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:se()})]})]})},Te=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1","#14b8a6","#a855f7","#eab308","#22c55e","#64748b"],Ce={scheduled:"#3b82f6",confirmed:"#10b981",cancelled:"#ef4444",swapped:"#f59e0b"};function De(e){return e?Te[e%Te.length]:"#64748b"}function Ee(e){return Ce[e]||"#64748b"}const Ie=e=>{let{selectedDate:t}=e;const{t:a}=(0,s.Bd)(),{user:i}=(0,X.As)(),[o,c]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[u,h]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[f,v]=(0,r.useState)(new Date),[k,j]=(0,r.useState)("timeGridWeek"),w=(0,r.useRef)(null),N=(0,r.useRef)(!1),[W,C]=(0,r.useState)(!1),[D,E]=(0,r.useState)([]),[I,M]=(0,r.useState)([]),[q,L]=(0,r.useState)([]),[F,H]=(0,r.useState)([]),[P,z]=(0,r.useState)([]),[O,R]=(0,r.useState)([]),[_,B]=(0,r.useState)([]),[V,U]=(0,r.useState)(!1),[Y,K]=(0,r.useState)(!1),[J,Z]=(0,r.useState)(!1),[Q,$]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(!1),[ae,re]=(0,r.useState)(!1),[se,ie]=(0,r.useState)(null),[le,ye]=(0,r.useState)(void 0),fe=(0,r.useCallback)((async e=>{try{h(!0),y(null);const r=(0,oe.k)(e,{weekStartsOn:1}),s=(0,ce.$)(e,{weekStartsOn:1}),i=n.Sn.SHIFTS.BASE,o={startDate:(0,d.GP)(r,"yyyy-MM-dd"),endDate:(0,d.GP)(s,"yyyy-MM-dd")};G.v.log("[ShiftPlanner] Fetching shifts from:",i),G.v.log("[ShiftPlanner] Params:",o),G.v.log("[ShiftPlanner] Full URL:","".concat(l.A.defaults.baseURL).concat(i));const c=await l.A.get(i,{params:o});if(G.v.log("[ShiftPlanner] Response status:",c.status),G.v.log("[ShiftPlanner] Response data:",c.data),c.data&&!1!==c.data.success){const e=c.data.data||c.data||[],t=Array.isArray(e)?e:[];x(t),G.v.log("[ShiftPlanner] Loaded shifts:",t.length)}else{var t;const e=(null===(t=c.data)||void 0===t?void 0:t.message)||a("teamWorktime.shifts.messages.loadError");console.error("[ShiftPlanner] Error in response:",e),y(e)}}catch(b){var r,s,i,o,c;if(console.error("[ShiftPlanner] Fehler beim Laden der Schichten:",b),console.error("[ShiftPlanner] Error details:",{message:b.message,response:b.response,status:null===(r=b.response)||void 0===r?void 0:r.status,statusText:null===(s=b.response)||void 0===s?void 0:s.statusText,data:null===(i=b.response)||void 0===i?void 0:i.data,url:null===(o=b.config)||void 0===o?void 0:o.url,baseURL:null===(c=b.config)||void 0===c?void 0:c.baseURL,fullURL:b.config?"".concat(b.config.baseURL).concat(b.config.url):"unknown"}),b.response){const t=b.response.status,r=b.response.data;var m;if(404===t)console.error("[ShiftPlanner] 404 - Route nicht gefunden. URL:",null===(m=b.config)||void 0===m?void 0:m.url),y(a("teamWorktime.shifts.messages.routeNotFound"));else if(401===t)console.error("[ShiftPlanner] 401 - Nicht authentifiziert"),y(a("teamWorktime.shifts.messages.unauthorized"));else if(403===t)console.error("[ShiftPlanner] 403 - Keine Berechtigung"),y(a("teamWorktime.shifts.messages.forbidden"));else{const s=(null===r||void 0===r?void 0:r.message)||b.message||a("teamWorktime.shifts.messages.loadError");console.error("[ShiftPlanner] Anderer Fehler:",t,s),y(s)}}else b.request?(console.error("[ShiftPlanner] Keine Response erhalten. Request:",b.request),y(a("teamWorktime.shifts.messages.loadError")+" (Keine Verbindung zum Server)")):(console.error("[ShiftPlanner] Fehler beim Setup der Request:",b.message),y(b.message||a("teamWorktime.shifts.messages.loadError")))}finally{h(!1)}}),[a]);(0,r.useEffect)((()=>{fe(f)}),[f,fe]),(0,r.useEffect)((()=>{(async()=>{try{const[e,t,a]=await Promise.all([l.A.get(n.Sn.BRANCHES.BASE),l.A.get(n.Sn.ROLES.BASE),l.A.get(n.Sn.USERS.DROPDOWN)]);z(e.data||[]),R(t.data||[]),B(a.data||[])}catch(e){console.error("Fehler beim Laden der Filter-Daten:",e)}})()}),[]),(0,r.useEffect)((()=>{let e=[...m];D.length>0&&(e=e.filter((e=>D.includes(e.branchId)))),I.length>0&&(e=e.filter((e=>I.includes(e.roleId)))),q.length>0&&(e=e.filter((e=>q.includes(e.status)))),F.length>0&&(e=e.filter((e=>e.userId&&F.includes(e.userId)))),c(e)}),[m,D,I,q,F]);const ke=(0,oe.k)(f,{weekStartsOn:1}),je=(0,ce.$)(f,{weekStartsOn:1}),Ne=(0,r.useMemo)((()=>o.map((e=>{var t,a;const r=new Date(e.startTime),s=new Date(e.endTime),i=De(e.branchId),l=Ee(e.status);return{id:e.id.toString(),title:e.user?"".concat((null===(t=e.shiftTemplate)||void 0===t?void 0:t.name)||"Schicht"," - ").concat(e.user.firstName," ").concat(e.user.lastName):"".concat((null===(a=e.shiftTemplate)||void 0===a?void 0:a.name)||"Schicht"," - Nicht zugewiesen"),start:r.toISOString(),end:s.toISOString(),backgroundColor:i,borderColor:l,borderWidth:3,textColor:"#ffffff",extendedProps:{shift:e}}}))),[o]),Te=()=>D.length+I.length+q.length+F.length,Ce=[{value:"scheduled",label:a("teamWorktime.shifts.status.scheduled")},{value:"confirmed",label:a("teamWorktime.shifts.status.confirmed")},{value:"cancelled",label:a("teamWorktime.shifts.status.cancelled")},{value:"swapped",label:a("teamWorktime.shifts.status.swapped")}];return(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsx)("div",{className:"flex items-center",children:(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{ye(f),U(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":a("teamWorktime.shifts.actions.add"),children:(0,T.jsx)(ne.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.actions.add")})]})}),(0,T.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v((0,me.k)(f,1))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.previousDay")})]}),(0,T.jsxs)("div",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white px-2 sm:px-3",children:[(0,d.GP)(ke,"dd.MM.yyyy")," - ",(0,d.GP)(je,"dd.MM.yyyy")]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v((0,xe.J)(f,1))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.nextDay")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v(new Date)},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)(de.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.today")})]})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsxs)("button",{type:"button",onClick:()=>C(!W),className:"p-2 rounded-md ".concat(Te()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"," focus:outline-none focus:ring-2 focus:ring-blue-500 relative"),children:[(0,T.jsx)(p.A,{className:"h-5 w-5"}),Te()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:Te()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.filter")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>re(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.availabilities.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>te(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.templates.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>$(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.swapList.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{Z(!0)},className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.actions.generate")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>fe(f),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.refresh")})]})]})]}),b&&(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:b}),!u&&o.length>0&&(()=>{const e=new Map,t=new Map;o.forEach((r=>{if(r.branch&&!e.has(r.branch.id)&&e.set(r.branch.id,{id:r.branch.id,name:r.branch.name,color:De(r.branch.id)}),!t.has(r.status)){const e={scheduled:a("teamWorktime.shifts.status.scheduled"),confirmed:a("teamWorktime.shifts.status.confirmed"),cancelled:a("teamWorktime.shifts.status.cancelled"),swapped:a("teamWorktime.shifts.status.swapped")};t.set(r.status,{status:r.status,label:e[r.status]||r.status,color:Ee(r.status)})}}));const r=Array.from(e.values()),s=Array.from(t.values());return 0===r.length&&0===s.length?null:(0,T.jsx)("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,T.jsxs)("div",{className:"flex flex-wrap gap-6",children:[r.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:a("teamWorktime.shifts.legend.branches")}),(0,T.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color}}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.name})]},e.id)))})]}),s.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:a("teamWorktime.shifts.legend.statuses")}),(0,T.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-4 h-4 rounded border-2",style:{backgroundColor:"transparent",borderColor:e.color}}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.label})]},e.status)))})]})]})})})(),u?(0,T.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,T.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:a("teamWorktime.shifts.messages.loading")})}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:[(0,T.jsx)("div",{className:"flex justify-end mb-4",children:(0,T.jsxs)("div",{className:"inline-flex rounded-md shadow-sm gap-1",role:"group",children:[(0,T.jsx)("button",{onClick:()=>{var e;j("timeGridWeek"),null===(e=w.current)||void 0===e||e.getApi().changeView("timeGridWeek")},className:"p-2 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat("timeGridWeek"===k?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"),title:a("common.week","Woche"),children:(0,T.jsx)(de.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>{var e;j("dayGridMonth"),null===(e=w.current)||void 0===e||e.getApi().changeView("dayGridMonth")},className:"p-2 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat("dayGridMonth"===k?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"),title:a("common.month","Monat"),children:(0,T.jsx)(g.A,{className:"h-5 w-5"})})]})}),W&&(0,T.jsx)("div",{className:"mb-4 px-3 sm:px-4 md:px-6",children:(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a("teamWorktime.shifts.filters.title")}),(0,T.jsx)("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-5 w-5"})})]}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.branch")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:P.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:t=>{t.target.checked?E([...D,e.id]):E(D.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.role")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:O.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:I.includes(e.id),onChange:t=>{t.target.checked?M([...I,e.id]):M(I.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.status")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:Ce.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:q.includes(e.value),onChange:t=>{t.target.checked?L([...q,e.value]):L(q.filter((t=>t!==e.value)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.label})]},e.value)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.user")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:_.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:F.includes(e.id),onChange:t=>{t.target.checked?H([...F,e.id]):H(F.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.firstName," ",e.lastName]})]},e.id)))})]})]}),(0,T.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,T.jsx)("button",{onClick:()=>{E([]),M([]),L([]),H([])},className:"px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:a("teamWorktime.shifts.filters.reset")}),(0,T.jsx)("button",{onClick:()=>C(!1),className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:a("common.apply")})]})]})}),(0,T.jsx)("div",{className:"fullcalendar-container",children:(0,T.jsx)(ue.A,{ref:w,plugins:[ge.A,he.A,pe.Ay],initialView:k,initialDate:f,headerToolbar:{left:"prev,next today",center:"title",right:""},locale:"de",firstDay:1,weekNumbers:!0,weekNumberCalculation:"ISO",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",slotDuration:"01:00:00",slotLabelInterval:"01:00:00",allDaySlot:!1,height:"auto",events:Ne,eventClick:e=>{const t=e.event.extendedProps.shift;G.v.log("Shift clicked:",t),ie(t),K(!0)},dateClick:e=>{G.v.log("Date clicked:",e.date),ye(e.date),U(!0)},datesSet:e=>{var t;const a=null===(t=w.current)||void 0===t?void 0:t.getApi().view.type;if(a&&a!==k&&j(a),"timeGridWeek"===a&&!N.current){const t=(0,oe.k)(e.start,{weekStartsOn:1}),a=(0,oe.k)(f,{weekStartsOn:1});t.getTime()!==a.getTime()&&v(e.start)}N.current=!1},eventDisplay:"block",eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClassNames:"cursor-pointer",eventContent:e=>{var t;const r=e.event.extendedProps.shift;return(0,T.jsxs)("div",{className:"p-1 text-xs",children:[(0,T.jsx)("div",{className:"font-semibold truncate",children:(null===(t=r.shiftTemplate)||void 0===t?void 0:t.name)||"Schicht"}),r.user&&(0,T.jsxs)("div",{className:"truncate text-gray-600 dark:text-gray-300",children:[r.user.firstName," ",r.user.lastName]}),!r.user&&(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:a("teamWorktime.shifts.legend.unassigned")})]})}})}),(0,T.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4 text-sm",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.scheduled")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.confirmed")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.cancelled")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-orange-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.swapped")})]})]})]}),(0,T.jsx)(be,{isOpen:V,onClose:()=>{U(!1),ye(void 0)},onShiftCreated:e=>{c((t=>[...t,e])),fe(f)},initialDate:le}),se&&(0,T.jsx)(ve,{isOpen:Y,onClose:()=>{K(!1),ie(null)},onShiftUpdated:e=>{c((t=>t.map((t=>t.id===e.id?e:t)))),fe(f)},onShiftDeleted:e=>{c((t=>t.filter((t=>t.id!==e)))),fe(f)},shift:se}),(0,T.jsx)(we,{isOpen:J,onClose:()=>Z(!1),onPlanGenerated:()=>{fe(f)},initialStartDate:(0,oe.k)(f,{weekStartsOn:1}),initialEndDate:(0,ce.$)(f,{weekStartsOn:1})}),(0,T.jsx)(Se,{isOpen:Q,onClose:()=>$(!1),onSwapRequestUpdated:()=>{fe(f)}}),(0,T.jsx)(Ae,{isOpen:ee,onClose:()=>te(!1)}),(0,T.jsx)(We,{isOpen:ae,onClose:()=>re(!1)})]})},Me=()=>{const{t:e}=(0,s.Bd)(),{hasPermission:t}=(0,z.S)(),a=t("team_worktime_control","read","page"),o=t("team_worktime","read","table"),c=a&&o,[m,x]=(0,r.useState)([]),[u,g]=(0,r.useState)([]),[h,p]=(0,r.useState)((0,d.GP)(new Date,"yyyy-MM-dd")),[b,y]=(0,r.useState)("worktimes"),[f,v]=(0,r.useState)(!1),[k,j]=(0,r.useState)(null);(0,r.useEffect)((()=>()=>{x([]),g([])}),[]);const w=(0,r.useCallback)((async()=>{try{v(!0),j(null);const e=await l.A.get(n.Sn.TEAM_WORKTIME.ACTIVE);x(e.data)}catch(k){var t,a,r;console.error("Fehler beim Laden der aktiven Benutzer:",k);let l=e("teamWorktime.messages.loadActiveUsersError");if(k.response){var s;const t=k.response.status,a=null===(s=k.response.data)||void 0===s?void 0:s.message;403===t?l=a||e("teamWorktime.permissions.insufficientShort"):401===t?l=e("teamWorktime.messages.unauthorized",{defaultValue:"Nicht autorisiert"}):500===t?l=e("teamWorktime.messages.serverError",{defaultValue:"Serverfehler"}):a&&(l=a)}else k.message&&(l=k.message);j(l),console.error("Fehlerdetails:",{status:null===(t=k.response)||void 0===t?void 0:t.status,statusText:null===(a=k.response)||void 0===a?void 0:a.statusText,data:null===(r=k.response)||void 0===r?void 0:r.data,message:k.message})}finally{v(!1)}}),[]),N=(0,r.useCallback)((async()=>{try{v(!0),j(null);const e=await l.A.get("".concat(n.Sn.TEAM_WORKTIME.USER_DAY,"?date=").concat(h));g(e.data)}catch(k){console.error("Fehler beim Laden der Zeiterfassungen:",k),j(e("teamWorktime.messages.loadWorktimesError"))}finally{v(!1)}}),[h]);return(0,r.useEffect)((()=>{if(!c)return void j(e("teamWorktime.permissions.insufficientDetails"));w(),N();let t=null;const a=()=>{t||(t=setInterval((()=>{document.hidden||w()}),3e4))},r=()=>{t&&(clearInterval(t),t=null)};document.hidden||a();const s=()=>{document.hidden?r():(w(),a())};return document.addEventListener("visibilitychange",s),()=>{r(),document.removeEventListener("visibilitychange",s)}}),[w,N,c]),(0,r.useEffect)((()=>{N()}),[h,N]),(0,T.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,T.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,T.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,T.jsxs)("div",{className:"flex items-center pl-2 sm:pl-0",children:[(0,T.jsx)(i.A,{className:"h-6 w-6 text-gray-900 dark:text-white mr-2"}),(0,T.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:e("teamWorktime.title")})]})}),!c&&(0,T.jsxs)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:[(0,T.jsx)("p",{className:"font-medium mb-2",children:e("teamWorktime.permissions.insufficient")}),(0,T.jsxs)("ul",{className:"list-disc list-inside text-sm space-y-1",children:[!a&&(0,T.jsx)("li",{children:e("teamWorktime.permissions.missingPage")}),!o&&(0,T.jsx)("li",{children:e("teamWorktime.permissions.missingTable")})]}),(0,T.jsx)("p",{className:"text-sm mt-2",children:e("teamWorktime.permissions.contactAdmin")})]}),k&&(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:k}),(0,T.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,T.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,T.jsx)("button",{onClick:()=>y("worktimes"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("worktimes"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.worktimes")}),(0,T.jsx)("button",{onClick:()=>y("shifts"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("shifts"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.shifts")}),(0,T.jsx)("button",{onClick:()=>y("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("todos"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.todos")}),(0,T.jsx)("button",{onClick:()=>y("requests"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("requests"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.requests")})]})}),"worktimes"===b&&(0,T.jsx)(J,{activeUsers:m,allWorktimes:u,loading:f,selectedDate:h,onDateChange:p,onStopWorktime:async(t,a)=>{try{v(!0),j(null),await l.A.post(n.Sn.TEAM_WORKTIME.STOP_USER,{userId:t,endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())}),w()}catch(k){console.error("Fehler beim Stoppen der Benutzer-Zeiterfassung:",k),j(e("teamWorktime.messages.stopWorktimeError"))}finally{v(!1)}},onRefresh:w,showTodos:!0,showRequests:!0}),"shifts"===b&&(0,T.jsx)(Ie,{selectedDate:h}),"todos"===b&&(0,T.jsx)(ae,{}),"requests"===b&&(0,T.jsx)(le,{})]})})})}},6400:(e,t,a)=>{a.d(t,{Ac:()=>x,J1:()=>m,W5:()=>c});var r=a(1620),s=a(8605),i=a(4912),l=a(3695),n=a(8621),d=a(7744);const o=(e,t)=>{const{operator:a,value:r}=t;if(void 0===r)return console.error("evaluateCondition: value ist undefined",t),!1;if(null==e&&null==r)return"equals"===a;if(null==e||null==r)return"notEquals"===a;let s="",i="";try{const t=null==e?"":"string"===typeof e?e:String(e);if("string"!==typeof t)return!1;const a=t.toLowerCase();if(void 0===a||null===a||"string"!==typeof a)return!1;s=a;const l=null==r?"":"string"===typeof r?r:String(r);if("string"!==typeof l)return!1;const n=l.toLowerCase();if(void 0===n||null===n||"string"!==typeof n)return!1;i=n}catch(l){return!1}if("string"!==typeof s||"string"!==typeof i||void 0===s||void 0===i||null===s||null===i)return!1;switch(a){case"equals":return s===i;case"notEquals":return s!==i;case"contains":return s.includes(i);case"startsWith":return s.startsWith(i);case"endsWith":if(void 0===s||null===s)return console.error("endsWith: strField ist undefined/null",{strField:s,strValue:i,fieldValue:e,value:r,condition:t}),!1;if(void 0===i||null===i)return console.error("endsWith: strValue ist undefined/null",{strField:s,strValue:i,fieldValue:e,value:r,condition:t}),!1;if("string"!==typeof s)return console.error("endsWith: strField ist kein String",{strField:s,typeof:typeof s,strValue:i,fieldValue:e,value:r,condition:t}),!1;if("string"!==typeof i)return console.error("endsWith: strValue ist kein String",{strField:s,strValue:i,typeof:typeof i,fieldValue:e,value:r,condition:t}),!1;try{return s.endsWith(i)}catch(l){return console.error("endsWith: Fehler bei endsWith-Aufruf",l,{strField:s,strValue:i,fieldValue:e,value:r,condition:t}),!1}case"before":case"after":{const t=new Date(e),s=new Date(r);return!isNaN(t.getTime())&&!isNaN(s.getTime())&&("before"===a?t<s:t>s)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),s=parseFloat(String(r));return!isNaN(t)&&!isNaN(s)&&("greaterThan"===a?t>s:t<s)}default:return!0}},c=(e,t,a,r,s)=>0===t.length?e:e.filter((e=>{let i=!0;for(let l=0;l<t.length;l++){const n=t[l];let d=!1;if(s&&s[n.column]){const t=s[n.column](e,n);if(null!==t)d=t;else{const t=r(e,n.column);d=o(t,n)}}else{const t=r(e,n.column);d=o(t,n)}if(0===l)i=d;else{i="AND"===(a[l-1]||"AND")?i&&d:i||d}}return i})),m=(e,t)=>{if(!e)return!1;const a=new Date(e);if(isNaN(a.getTime()))return!1;const o=a.getUTCFullYear(),c=a.getUTCMonth(),m=a.getUTCDate(),x=new Date(o,c,m);try{if("__THIS_WEEK__"===t.value){if("equals"===t.operator){const e=(0,r.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const t=(0,s.$)(new Date,{weekStartsOn:1});return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,r.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const a=(0,s.$)(new Date,{weekStartsOn:1});return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}if("__THIS_MONTH__"===t.value){if("equals"===t.operator){const e=(0,i.w)(new Date);e.setHours(0,0,0,0);const t=(0,l.p)(new Date);return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,i.w)(new Date);e.setHours(0,0,0,0);const a=(0,l.p)(new Date);return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}if("__THIS_YEAR__"===t.value){if("equals"===t.operator){const e=(0,n.D)(new Date);e.setHours(0,0,0,0);const t=(0,d.Q)(new Date);return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,n.D)(new Date);e.setHours(0,0,0,0);const a=(0,d.Q)(new Date);return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}let e;if("__TODAY__"===t.value){const t=new Date;t.setHours(0,0,0,0),e=t}else if("__WEEK_START__"===t.value){const t=(0,r.k)(new Date,{weekStartsOn:1});t.setHours(0,0,0,0),e=t}else if("__WEEK_END__"===t.value){const t=(0,s.$)(new Date,{weekStartsOn:1});t.setHours(23,59,59,999),e=t}else if("__MONTH_START__"===t.value){const t=(0,i.w)(new Date);t.setHours(0,0,0,0),e=t}else if("__MONTH_END__"===t.value){const t=(0,l.p)(new Date);t.setHours(23,59,59,999),e=t}else if("__YEAR_START__"===t.value){const t=(0,n.D)(new Date);t.setHours(0,0,0,0),e=t}else if("__YEAR_END__"===t.value){const t=(0,d.Q)(new Date);t.setHours(23,59,59,999),e=t}else{const a=new Date(t.value);if(isNaN(a.getTime()))return!1;const r=a.getUTCFullYear(),s=a.getUTCMonth(),i=a.getUTCDate();e=new Date(r,s,i)}switch(t.operator){case"equals":return x.getTime()===e.getTime();case"before":return x<e;case"after":return x>e;default:return!0}}catch(u){return console.error("[evaluateDateCondition] Error with placeholder ".concat(t.value,":"),u),!1}},x=(e,t,a,r)=>{const s=a.value||"";if(s.startsWith("user-")){const t=parseInt(s.replace("user-",""),10);if(isNaN(t))return!1;const r=e===t;return"notEquals"===a.operator?!r:r}if(s.startsWith("role-")){const e=parseInt(s.replace("role-",""),10);if(isNaN(e))return!1;const r=t===e;return"notEquals"===a.operator?!r:r}if(""===s)return!0;if(void 0!==r){const e=r.toLowerCase(),t=s.toLowerCase();if("equals"===a.operator)return e===t;if("notEquals"===a.operator)return e!==t;if("contains"===a.operator)return e.includes(t)}return!1}}}]);
//# sourceMappingURL=256.77601447.chunk.js.map