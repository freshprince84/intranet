"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[354],{1713:(e,t,r)=>{r.d(t,{DW:()=>j,I5:()=>g,IF:()=>y,M9:()=>f,P0:()=>d,Pg:()=>v,VY:()=>x,Yq:()=>i,_2:()=>m,c$:()=>w,fU:()=>c,h4:()=>b,lK:()=>p,pg:()=>u,uT:()=>h,vv:()=>k});var n=r(4653),a=r(9837),l=r(1620),s=r(6981),o=r(887);const i=e=>{if(!e)return"-";try{const t=e.split("-");if(3!==t.length)return"-";const r=parseInt(t[0]),n=parseInt(t[1])-1,a=parseInt(t[2]);return new Date(r,n,a,12,0,0).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Fehler beim Formatieren des Datums:",t),"-"}},c=e=>{if(!e)return"-";try{const t=(0,n.H)(e),r=t.getUTCHours().toString().padStart(2,"0"),a=t.getUTCMinutes().toString().padStart(2,"0");return"".concat(r,":").concat(a)}catch(t){return console.error("Fehler beim Formatieren der Zeit f\xfcr ".concat(e,":"),t),"-"}},d=(e,t)=>{if(!e||!t)return"-";try{const r=e.endsWith("Z")?e.substring(0,e.length-1):e,n=t.endsWith("Z")?t.substring(0,t.length-1):t,a=new Date(r),l=new Date(n).getTime()-a.getTime(),s=Math.floor(l/6e4),o=Math.floor(s/60),i=s%60;return"".concat(o,"h ").concat(i,"m")}catch(r){return console.error("Fehler bei der Dauerberechnung:",r),"-"}},u=e=>{try{const t=parseInt(e.substring(0,4)),r=parseInt(e.substring(6)),n=new Date(Date.UTC(t,0,1,12,0,0)).getUTCDay(),s=n<=4?4-n:11-n,i=new Date(Date.UTC(t,0,1+s,12,0,0)),c=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+7*(r-1),12,0,0)),d=new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()-3,12,0,0)),u=(0,a.GP)(d,"yyyy-MM-dd");if(console.log("Konvertierte Woche ".concat(e," zu Datum: ").concat(u," (Wochentag: ").concat((0,a.GP)(d,"EEEE",{locale:o.de}),")")),"Montag"!==(0,a.GP)(d,"EEEE",{locale:o.de})){console.warn("Berechnetes Datum ist kein Montag! Korrigiere...");const e=(0,l.k)(d,{weekStartsOn:1});return(0,a.GP)(e,"yyyy-MM-dd")}return u}catch(t){console.error("Fehler beim Konvertieren des Wochendatums:",t);const e=(0,l.k)(new Date,{weekStartsOn:1});return(0,a.GP)(e,"yyyy-MM-dd")}},h=(e,t)=>{try{if(!e||!e.startTime)return!1;return e.startTime.split("T")[0]===t}catch(r){return console.error("Fehler beim Pr\xfcfen der Relevanz eines Worktime-Eintrags:",r),!1}},m=e=>{if(!e)return[];const t=new Date(e),r=[];for(let n=0;n<7;n++){const e=(0,s.f)(t,n),l={date:(0,a.GP)(e,"yyyy-MM-dd"),day:(0,a.GP)(e,"EEEE",{locale:o.de})};r.push(l)}return r},g=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Fehler beim Formatieren des Datums und der Zeit:",t),"-"}},f=e=>{try{let t,r,n;if(!e.includes("-Q"))throw new Error("Ung\xfcltiges Quinzena-Format");{const a=e.split("-Q"),l=a[0];if(n=parseInt(a[1]),l.includes("-")){const e=l.split("-");t=parseInt(e[0]),r=parseInt(e[1])}else t=parseInt(l),r=Math.ceil(n/2)}const l=1===n?1:16,s=new Date(Date.UTC(t,r-1,l,12,0,0));return(0,a.GP)(s,"yyyy-MM-dd")}catch(t){console.error("Fehler beim Konvertieren der Quinzena:",t);const e=(0,l.k)(new Date,{weekStartsOn:1});return(0,a.GP)(e,"yyyy-MM-dd")}},p=e=>{if(!e)return[];const t=new Date(e),r=t.getFullYear(),n=t.getMonth();let l;if(1===t.getDate())l=15;else{l=new Date(r,n+1,0).getDate()-15}const i=[];for(let c=0;c<l;c++){const e=(0,s.f)(t,c),r={date:(0,a.GP)(e,"yyyy-MM-dd"),day:(0,a.GP)(e,"EEEE",{locale:o.de})};i.push(r)}return i},x=()=>{const e=new Date;return(e=>{try{const t=new Date(e+"T12:00:00"),r=t.getFullYear(),n=t.getMonth()+1,a=t.getDate()<=15?1:2;return"".concat(r,"-").concat(String(n).padStart(2,"0"),"-Q").concat(a)}catch(t){console.error("Fehler beim Berechnen der Quinzena:",t);const e=new Date,r=e.getFullYear(),n=e.getMonth()+1;return"".concat(r,"-").concat(String(n).padStart(2,"0"),"-Q1")}})((0,a.GP)(e,"yyyy-MM-dd"))},y=e=>{const t=new Date(e);return new Date(t.getTime()+6e4*t.getTimezoneOffset())},w=e=>{try{const t=e.reduce(((e,t)=>{if(!t.endTime)return e;const r=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,n=t.endTime.endsWith("Z")?t.endTime.substring(0,t.endTime.length-1):t.endTime,a=new Date(r),l=new Date(n).getTime()-a.getTime();return e+Math.floor(l/6e4)}),0),r=Math.floor(t/60),n=t%60;return"".concat(r,"h ").concat(n,"m")}catch(t){return console.error("Fehler bei der Formatierung der Gesamtdauer:",t),"0h 0m"}},k=e=>!!(e.invoiceItems&&e.invoiceItems.length>0),b=e=>{if(!e.invoiceItems||0===e.invoiceItems.length)return null;return e.invoiceItems[0].invoice},v=e=>({DRAFT:"Entwurf",SENT:"Gesendet",PAID:"Bezahlt",OVERDUE:"\xdcberf\xe4llig",CANCELLED:"Storniert"}[e]||e),j=e=>({DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",SENT:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",CANCELLED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}[e]||"bg-gray-100 text-gray-800")},6896:(e,t,r)=>{r.d(t,{A:()=>a});r(5043);var n=r(579);const a=e=>{let{content:t,className:r="",maxHeight:a="150px",temporaryAttachments:l=[],showImagePreview:s=!1,onlyAttachments:o=!1,attachmentMetadata:i=[]}=e;const c=()=>[...Array.from(t.matchAll(/!\[(.*?)\]\((.*?)\)/g)).map((e=>({type:"image",alt:e[1],url:e[2],isTemporary:"wird nach dem Erstellen hochgeladen"===e[2]}))),...Array.from(t.matchAll(/\[(.*?)\]\((.*?)\)/g)).filter((e=>!e[0].startsWith("!"))).map((e=>({type:"link",alt:e[1],url:e[2],isTemporary:"wird nach dem Erstellen hochgeladen"===e[2]})))].reduce(((e,t)=>{const r="".concat(t.type,"-").concat(t.alt,"-").concat(t.url);return e.some((e=>"".concat(e.type,"-").concat(e.alt,"-").concat(e.url)===r))||e.push(t),e}),[]),d=e=>{const t=l.find((t=>t.fileName===e));return null!==t&&void 0!==t&&t.file?URL.createObjectURL(t.file):null},u=(e,t)=>{const r=e.replace(/^(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]|\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|\uD83E[\uDC00-\uDDFF])+/,"").trim();let n=i.find((t=>t.fileName===e));if(n||r===e||(n=i.find((e=>e.fileName===r))),n||(n=i.find((t=>t.fileName.toLowerCase()===e.toLowerCase()))),n||r===e||(n=i.find((e=>e.fileName.toLowerCase()===r.toLowerCase()))),!n&&t&&i.length>0){let e=t.match(/\/(?:tasks|requests)\/\d+\/attachments\/(\d+)/);if(e){const t=parseInt(e[1],10);n=i.find((e=>e.id===t))}if(!n&&(e=t.match(/\/cerebro\/media\/(\d+)\/file/),e)){const t=parseInt(e[1],10);n=i.find((e=>e.id===t))}}return n};if(o){const e=(()=>{const e=c();console.log("\ud83d\udce6 renderInlineAttachments aufgerufen:",{contentLength:t.length,attachmentsFound:e.length,attachmentMetadataCount:i.length,attachmentMetadata:i});const r=e.filter((e=>{let t=e.url;if(e.isTemporary){const r=d(e.alt);r&&(t=r)}return t&&"wird nach dem Erstellen hochgeladen"!==t}));if(0===r.length)return null;const a=r.map(((e,t)=>{var r,a,l;let s=u(e.alt,e.url);if(!s&&e.url){let t=e.url.match(/\/attachments\/(\d+)/);if(t){const e=parseInt(t[1]);s=i.find((t=>t.id===e))}if(!s&&(t=e.url.match(/\/cerebro\/media\/(\d+)\/file/),t)){const e=parseInt(t[1]);s=i.find((t=>t.id===e))}}const o=s&&(null===(r=e.url)||void 0===r?void 0:r.includes("/cerebro/media/"));let c="";if(c=null!==(a=s)&&void 0!==a&&a.url?s.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(c=t)}if(!c||"wird nach dem Erstellen hochgeladen"===c)return null;const h=e.alt.toLowerCase();let m=!1,g=!1;if(console.log("\ud83d\udd0d Attachment Debug:",{alt:e.alt,fileName:h,url:c,metadata:s,attachmentType:e.type}),null!==(l=s)&&void 0!==l&&l.fileType&&(m=s.fileType.startsWith("image/"),g="application/pdf"===s.fileType,console.log("\u2705 Metadaten gefunden:",{fileType:s.fileType,isImage:m,isPdf:g})),s||"image"!==e.type||(m=!0),!s){const e=c&&c.toLowerCase().endsWith(".pdf"),t=c&&c.match(/\.pdf(\?|$)/i),r=h.endsWith(".pdf"),n=c&&(c.includes("/api/requests/attachments/")||c.includes("/api/tasks/attachments/"))&&r,a=c&&c.includes("/cerebro/media/")&&r;g=e||t||r||n||a,console.log("\ud83d\udd0d PDF-Erkennung (ohne Metadaten):",{urlEndsWithPdf:e,urlMatchesPdf:t,fileNameEndsWithPdf:r,isApiAttachmentPdf:n,isPdf:g})}console.log("\ud83d\udcc4 Finale Entscheidung:",{isImage:m,isPdf:g,isExternalLink:c&&c.match(/^https?:\/\//)&&!m&&!g});const f=c&&c.match(/^https?:\/\//)&&!m&&!g;return o?(0,n.jsxs)("div",{className:"p-3 flex items-center border rounded-lg bg-gray-50 dark:bg-gray-700/50",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,n.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.alt})]},t):(0,n.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:m?(0,n.jsx)("div",{children:(0,n.jsx)("img",{src:c,alt:e.alt,className:"w-full h-auto max-h-96 object-contain",style:{display:"block"}})}):g?(0,n.jsxs)("div",{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,n.jsx)("span",{className:"text-sm font-medium dark:text-gray-200",children:e.alt}),(0,n.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-blue-600 dark:text-blue-400 hover:underline text-sm",children:"\xd6ffnen"})]}),(0,n.jsx)("iframe",{src:"".concat(c,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:e.alt})]}):f?(0,n.jsxs)("div",{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,n.jsx)("span",{className:"text-sm font-medium dark:text-gray-200 flex-grow",children:e.alt||c}),(0,n.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 dark:text-blue-400 hover:underline text-sm",children:"\xd6ffnen"})]}),(0,n.jsx)("iframe",{src:c,className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:e.alt||"Web-Vorschau",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms"})]}):(0,n.jsxs)("div",{className:"p-3 flex items-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,n.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.alt})]})},t)})).filter((e=>null!==e));return 0===a.length?null:(0,n.jsx)("div",{className:"flex flex-col gap-3 mt-2",children:a})})();return e?(0,n.jsx)("div",{className:r,children:e}):(0,n.jsx)("div",{className:r})}if(s){const e={};"none"===a?e.overflowY="visible":(e.maxHeight="150px"!==a?a:"100%",e.overflowY="auto");const l=c().filter((e=>{let t=u(e.alt,e.url);let r="";if(r=null!==t&&void 0!==t&&t.url?t.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(r=t)}if(!r||"wird nach dem Erstellen hochgeladen"===r)return!1;let n=!1,a=!1;if(null!==t&&void 0!==t&&t.fileType)n=t.fileType.startsWith("image/"),a="application/pdf"===t.fileType;else if("image"===e.type)n=!0;else{const t=/\.(jpg|jpeg|png|gif|webp|svg|bmp)(\?|$)/i;n=t.test(e.alt)||t.test(r)}return n&&!a}));let s=t;const o=/!\[([^\]]*)\]\(([^)]+)\)/g,i=/\[([^\]]+)\]\(([^)]+)\)/g;s=s.replace(o,(()=>"")),s=s.replace(/\n{3,}/g,"\n\n").trim(),s=s.replace(i,((e,t,r)=>e.startsWith("![")?e:"".concat(t," [Link]")));const h=()=>{if(0===l.length)return null;const e=l.reduce(((e,t)=>{const r="".concat(t.alt,"-").concat(t.url||"");return e.some((e=>"".concat(e.alt,"-").concat(e.url||"")===r))||e.push(t),e}),[]);return(0,n.jsx)("div",{className:"flex flex-col gap-3 mt-2",children:e.map(((e,t)=>{let r=u(e.alt,e.url),a="";if(a=null!==r&&void 0!==r&&r.url?r.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(a=t)}return a&&"wird nach dem Erstellen hochgeladen"!==a?(0,n.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,n.jsx)("img",{src:a,alt:e.alt,className:"w-full h-auto max-h-96 object-contain",style:{display:"block"}})},"img-".concat(e.alt,"-").concat(a,"-").concat(t)):null})).filter((e=>null!==e))})};return(0,n.jsxs)("div",{className:"markdown-preview ".concat(r," dark:text-gray-200"),style:e,children:[s&&(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:s.replace(/\n/g,"<br/>")}}),h()]})}return(0,n.jsx)("div",{className:"markdown-preview ".concat(r),children:(()=>{const e=c();return 0===e.length?null:(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.map(((e,t)=>{let r=e.url;if(e.isTemporary){const t=d(e.alt);t&&(r=t)}return(0,n.jsxs)("div",{className:"group relative",children:[(0,n.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded px-2 py-1 text-sm flex items-center dark:text-gray-200",children:[(0,n.jsx)("span",{className:"mr-1",children:"image"===e.type?(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),e.alt]}),r&&"wird nach dem Erstellen hochgeladen"!==r&&(0,n.jsx)("div",{className:"hidden group-hover:block absolute z-10 bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-lg p-2 rounded-md -bottom-2 left-1/2 transform -translate-x-1/2 translate-y-full max-w-xs",children:"image"===e.type?(0,n.jsx)("img",{src:r,alt:e.alt,className:"max-w-full border rounded dark:border-gray-700",style:{maxHeight:"200px",objectFit:"contain"}}):r.match(/^(https?:\/\/|blob:)/)?(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,n.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.alt})]}):(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,n.jsx)("span",{className:"dark:text-gray-200",children:e.alt})]})})]},t)}))})})()})}}}]);
//# sourceMappingURL=354.273b2770.chunk.js.map