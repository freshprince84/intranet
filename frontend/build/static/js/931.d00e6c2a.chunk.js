"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[931],{7931:(e,t,a)=>{a.r(t),a.d(t,{default:()=>We});var r=a(5043),s=a(4117),n=a(2760),l=a(7504),i=a(4129),o=a(8153),d=a(7459),c=a(9379),m=a(6443),u=a(542),g=a(8662),x=a(6009),b=a(2704),h=a(6238),p=a(7591),y=a(9422),f=a(7855),v=a(6768),k=a(9743),j=a(1923),w=a(1801),N=a(6287),A=a(4538),S=a(2811),C=a(7012),z=a(7988),R=a(4791),D=a(1816),E=a(2672),L=a(5657),F=a(579);const T=e=>{let{isOpen:t,onClose:a,onCertificateCreated:l,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:u}=(0,E.As)(),{isHR:g,isAdmin:x,loading:h}=(0,n.S)(),{openSidepane:v,closeSidepane:k}=(0,L.N)(),{showMessage:N}=(0,f.A)(),[A,S]=(0,r.useState)(window.innerWidth<640),[C,R]=(0,r.useState)(window.innerWidth>1070),[T,I]=(0,r.useState)("data"),[P,_]=(0,r.useState)(!1),[O,B]=(0,r.useState)(null),[q,V]=(0,r.useState)(null),[U,M]=(0,r.useState)((new Date).toISOString().split("T")[0]),[G,W]=(0,r.useState)("employment"),[H,K]=(0,r.useState)(null),[J,Y]=(0,r.useState)(null),[Z,X]=(0,r.useState)(!1),[$,Q]=(0,r.useState)([]),[ee,te]=(0,r.useState)(null),[ae,re]=(0,r.useState)(!1),se=(0,r.useRef)(null);(0,r.useEffect)((()=>{h||g()||x()||(N("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse erstellen","error"),a())}),[g,x,h,a,N]),(0,r.useEffect)((()=>{const e=()=>{S(window.innerWidth<640),R(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(t?(v(),le(),ne()):k(),()=>{k()})),[t,v,k]);const ne=async()=>{try{const e=(await j.A.get(w.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentCertificate&&t.push({type:"employmentCertificate",version:e.employmentCertificate.version,path:e.employmentCertificate.path}),Q(t),t.length>0&&(te(t[0].type),re(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},le=async()=>{try{const[e,t]=await Promise.all([j.A.get(w.Sn.USERS.BY_ID(o)),j.A.get(w.Sn.LIFECYCLE.BY_USER(o))]),a=e.data,r=t.data.lifecycle,s={firstName:a.firstName||"",lastName:a.lastName||"",identificationNumber:a.identificationNumber||null,contractStartDate:(null===r||void 0===r?void 0:r.contractStartDate)||null,contractEndDate:(null===r||void 0===r?void 0:r.contractEndDate)||null,contractType:(null===r||void 0===r?void 0:r.contractType)||null,salary:a.salary||null,position:null};V(s),U&&U!==(new Date).toISOString().split("T")[0]||M((new Date).toISOString().split("T")[0])}catch(e){console.error("Fehler beim Laden der User-Daten:",e),B("Fehler beim Laden der Daten")}};(0,r.useEffect)((()=>()=>{J&&URL.revokeObjectURL(J)}),[J]);return g()||x()?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(!C||A)&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,F.jsxs)(m.lG.Panel,{className:"\n            ".concat(A?"w-full h-full":"w-[600px]","\n            ").concat(A?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(A?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),style:{animation:A?"none":"slideIn 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94)"},children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,F.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis erstellen"})]}),(0,F.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,F.jsx)("div",{className:"mb-4",children:(0,F.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,F.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,F.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,F.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,F.jsx)("button",{type:"button",onClick:()=>I("data"),className:"".concat("data"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Daten"}),(0,F.jsx)("button",{type:"button",onClick:()=>I("text"),className:"".concat("text"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),O&&(0,F.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:O})}),"data"===T&&(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,F.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,F.jsx)("div",{className:"space-y-2 text-sm",children:q&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,F.jsxs)("span",{className:"dark:text-white",children:[q.firstName," ",q.lastName]})]}),q.identificationNumber&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(b.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,F.jsx)("span",{className:"dark:text-white",children:q.identificationNumber})]}),q.contractStartDate&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(z.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Eintrittsdatum:"}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(q.contractStartDate).toLocaleDateString("de-DE")})]}),q.contractEndDate&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(z.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Austrittsdatum:"}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(q.contractEndDate).toLocaleDateString("de-DE")})]})]})})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Ausstellungsdatum ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"date",value:U,onChange:e=>{const t=e.target.value;M(t),t&&new Date(t)>new Date?B("Ausstellungsdatum darf nicht in der Zukunft liegen"):B(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&U&&new Date(U)>new Date||O&&!U?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!(U&&!(U&&new Date(U)>new Date))||void 0,"aria-describedby":!U||U&&new Date(U)>new Date?"issueDate-error":void 0}),O&&(!U||U&&new Date(U)>new Date)&&(0,F.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O}),!O&&(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Zertifikat-Typ ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("select",{value:G,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0,children:[(0,F.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,F.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,F.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]})]}),"text"===T&&(0,F.jsxs)("div",{className:"space-y-4",children:[$.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,F.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,F.jsx)("input",{type:"checkbox",checked:ae,onChange:e=>{re(e.target.checked),e.target.checked&&H&&(K(null),J&&(URL.revokeObjectURL(J),Y(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,F.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),ae&&(0,F.jsx)("select",{value:ee||"",onChange:e=>te(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:$.map((e=>(0,F.jsxs)("option",{value:e.type,children:["Arbeitszeugnis (Version ",e.version,")"]},e.type)))})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[ae?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!ae&&(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,F.jsx)("input",{ref:se,type:"file",accept:".pdf",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if("application/pdf"!==a.type)return void N("Nur PDF-Dateien sind erlaubt","error");if(a.size>10485760)return void N("Datei ist zu gro\xdf (max. 10MB)","error");K(a),re(!1);const e=URL.createObjectURL(a);Y(e)}},className:"hidden"}),H?(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,F.jsx)("p",{className:"text-sm font-medium dark:text-white",children:H.name}),(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(H.size/1024/1024).toFixed(2)," MB"]}),(0,F.jsx)("button",{type:"button",onClick:()=>{K(null),J&&(URL.revokeObjectURL(J),Y(null)),se.current&&(se.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=se.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,F.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),J&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,F.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,F.jsx)("iframe",{src:"".concat(J,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!ae&&!H)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!U)return"Bitte geben Sie ein Ausstellungsdatum an";const e=new Date(U);return isNaN(e.getTime())?"Ung\xfcltiges Ausstellungsdatum":e>new Date?"Ausstellungsdatum darf nicht in der Zukunft liegen":null})();if(t)return B(t),void N(t,"error");_(!0),B(null);try{let e,t=null,r=null;if(ae&&ee&&!H){const e=$.find((e=>e.type===ee));e&&(t=e.type,r=e.version)}else{if(!H)return N("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(H.name)}const s={certificateType:G,issueDate:new Date(U),pdfPath:e,templateUsed:t,templateVersion:r};await j.A.post(w.Sn.LIFECYCLE.CERTIFICATES(o),s),N("Arbeitszeugnis erfolgreich erstellt","success"),l(),a(),J&&(URL.revokeObjectURL(J),Y(null)),K(null),M((new Date).toISOString().split("T")[0]),se.current&&(se.current.value="")}catch(n){var r,s;console.error("Fehler beim Erstellen des Arbeitszeugnisses:",n),B((null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitszeugnisses"),N("Fehler beim Erstellen des Arbeitszeugnisses","error")}finally{_(!1)}},disabled:P||!H&&!ae,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:P?"Wird erstellt...":"Erstellen",children:P?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})})]}):null};var I=a(2683);const P=e=>{let{isOpen:t,onClose:a,onContractCreated:l,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:u}=(0,E.As)(),{isHR:g,isAdmin:x,loading:h}=(0,n.S)(),{openSidepane:v,closeSidepane:k}=(0,L.N)(),{showMessage:N}=(0,f.A)(),[A,S]=(0,r.useState)(window.innerWidth<640),[C,z]=(0,r.useState)(window.innerWidth>1070),[R,T]=(0,r.useState)("data"),[P,_]=(0,r.useState)(!1),[O,B]=(0,r.useState)(null),[q,V]=(0,r.useState)(null),[U,M]=(0,r.useState)("employment"),[G,W]=(0,r.useState)((new Date).toISOString().split("T")[0]),[H,K]=(0,r.useState)(""),[J,Y]=(0,r.useState)(""),[Z,X]=(0,r.useState)(""),[$,Q]=(0,r.useState)(""),[ee,te]=(0,r.useState)(null),[ae,re]=(0,r.useState)(null),[se,ne]=(0,r.useState)([]),[le,ie]=(0,r.useState)(null),[oe,de]=(0,r.useState)(!1),ce=(0,r.useRef)(null);(0,r.useEffect)((()=>{h||g()||x()||(N("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge erstellen","error"),a())}),[g,x,h,a,N]),(0,r.useEffect)((()=>{const e=()=>{S(window.innerWidth<640),z(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(t?(v(),ue(),me()):k(),()=>{k()})),[t,v,k]);const me=async()=>{try{const e=(await j.A.get(w.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentContract&&t.push({type:"employmentContract",version:e.employmentContract.version,path:e.employmentContract.path}),ne(t),t.length>0&&(ie(t[0].type),de(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},ue=async()=>{try{const[e,t]=await Promise.all([j.A.get(w.Sn.USERS.BY_ID(o)),j.A.get(w.Sn.LIFECYCLE.BY_USER(o))]),a=e.data,r=t.data.lifecycle,s={firstName:a.firstName||"",lastName:a.lastName||"",identificationNumber:a.identificationNumber||null,contractStartDate:(null===r||void 0===r?void 0:r.contractStartDate)||null,contractEndDate:(null===r||void 0===r?void 0:r.contractEndDate)||null,contractType:(null===r||void 0===r?void 0:r.contractType)||null,salary:a.salary||null,position:null};V(s),s.contractStartDate&&W(new Date(s.contractStartDate).toISOString().split("T")[0]),s.contractEndDate&&K(new Date(s.contractEndDate).toISOString().split("T")[0]),s.salary&&Y(s.salary.toString()),s.contractType&&M(s.contractType)}catch(e){console.error("Fehler beim Laden der User-Daten:",e),B("Fehler beim Laden der Daten")}};(0,r.useEffect)((()=>()=>{ae&&URL.revokeObjectURL(ae)}),[ae]);return g()||x()?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(!C||A)&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,F.jsxs)(m.lG.Panel,{className:"\n            ".concat(A?"w-full h-full":"w-[600px]","\n            ").concat(A?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(A?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,F.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag erstellen"})]}),(0,F.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,F.jsx)("div",{className:"mb-4",children:(0,F.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,F.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,F.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,F.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,F.jsx)("button",{type:"button",onClick:()=>T("data"),className:"".concat("data"===R?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Vertragsdaten"}),(0,F.jsx)("button",{type:"button",onClick:()=>T("text"),className:"".concat("text"===R?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),O&&(0,F.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:O})}),"data"===R&&(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,F.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,F.jsx)("div",{className:"space-y-2 text-sm",children:q&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,F.jsxs)("span",{className:"dark:text-white",children:[q.firstName," ",q.lastName]})]}),q.identificationNumber&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(b.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,F.jsx)("span",{className:"dark:text-white",children:q.identificationNumber})]})]})})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("select",{value:U,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,F.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,F.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"date",value:G,onChange:e=>{W(e.target.value),B(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&!G?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!G,"aria-describedby":G?void 0:"startDate-error"}),O&&!G&&(0,F.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,F.jsx)("input",{type:"date",value:H,onChange:e=>{K(e.target.value),e.target.value&&G&&new Date(e.target.value)<new Date(G)?B("Enddatum muss nach dem Startdatum liegen"):B(null)},min:G||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&H&&G&&new Date(H)<new Date(G)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(H&&G&&new Date(H)<new Date(G))||void 0,"aria-describedby":H&&G&&new Date(H)<new Date(G)?"endDate-error":void 0}),O&&H&&G&&new Date(H)<new Date(G)&&(0,F.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,F.jsx)("input",{type:"text",value:$,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(I.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,F.jsx)("input",{type:"number",value:J,onChange:e=>{const t=e.target.value;Y(t),t&&parseFloat(t)<0?B("Gehalt darf nicht negativ sein"):B(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&J&&parseFloat(J)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(J&&parseFloat(J)<0)||void 0,"aria-describedby":J&&parseFloat(J)<0?"salary-error":void 0})]}),O&&J&&parseFloat(J)<0&&(0,F.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,F.jsx)("input",{type:"number",value:Z,onChange:e=>{const t=e.target.value;X(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?B("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):B(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!Z||!(parseFloat(Z)<0||parseFloat(Z)>168))||void 0,"aria-describedby":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"workingHours-error":void 0}),O&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)&&(0,F.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]})]}),"text"===R&&(0,F.jsxs)("div",{className:"space-y-4",children:[se.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,F.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,F.jsx)("input",{type:"checkbox",checked:oe,onChange:e=>{de(e.target.checked),e.target.checked&&ee&&(te(null),ae&&(URL.revokeObjectURL(ae),re(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,F.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),oe&&(0,F.jsx)("select",{value:le||"",onChange:e=>ie(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:se.map((e=>(0,F.jsxs)("option",{value:e.type,children:["Arbeitsvertrag (Version ",e.version,")"]},e.type)))})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[oe?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!oe&&(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,F.jsx)("input",{ref:ce,type:"file",accept:".pdf",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if("application/pdf"!==a.type)return void N("Nur PDF-Dateien sind erlaubt","error");if(a.size>10485760)return void N("Datei ist zu gro\xdf (max. 10MB)","error");te(a),de(!1);const e=URL.createObjectURL(a);re(e)}},className:"hidden"}),ee?(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,F.jsx)("p",{className:"text-sm font-medium dark:text-white",children:ee.name}),(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(ee.size/1024/1024).toFixed(2)," MB"]}),(0,F.jsx)("button",{type:"button",onClick:()=>{te(null),ae&&(URL.revokeObjectURL(ae),re(null)),ce.current&&(ce.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ce.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,F.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),ae&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,F.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,F.jsx)("iframe",{src:"".concat(ae,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!oe&&!ee)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!G)return"Bitte geben Sie ein Startdatum an";const e=new Date(G);if(isNaN(e.getTime()))return"Ung\xfcltiges Startdatum";if(H){const t=new Date(H);if(isNaN(t.getTime()))return"Ung\xfcltiges Enddatum";if(t<e)return"Enddatum muss nach dem Startdatum liegen"}return J&&parseFloat(J)<0?"Gehalt darf nicht negativ sein":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen":null})();if(t)return B(t),void N(t,"error");_(!0),B(null);try{let e,t=null,r=null;if(oe&&le&&!ee){const e=se.find((e=>e.type===le));e&&(t=e.type,r=e.version)}else{if(!ee)return N("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(ee.name)}const s={contractType:U,startDate:new Date(G),endDate:H?new Date(H):null,salary:J?parseFloat(J):null,workingHours:Z?parseFloat(Z):null,position:$||null,pdfPath:e,templateUsed:t,templateVersion:r};await j.A.post(w.Sn.LIFECYCLE.CONTRACTS(o),s),N("Arbeitsvertrag erfolgreich erstellt","success"),l(),a(),ae&&(URL.revokeObjectURL(ae),re(null)),te(null),W((new Date).toISOString().split("T")[0]),K(""),Y(""),X(""),Q(""),ce.current&&(ce.current.value="")}catch(n){var r,s;console.error("Fehler beim Erstellen des Arbeitsvertrags:",n),B((null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitsvertrags"),N("Fehler beim Erstellen des Arbeitsvertrags","error")}finally{_(!1)}},disabled:P||!ee&&!oe||!G,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:P?"Wird erstellt...":"Erstellen",children:P?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})})]}):null},_=e=>{let{isOpen:t,onClose:a,onCertificateUpdated:l,userId:i,certificate:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:g}=(0,n.S)(),{openSidepane:x,closeSidepane:h}=(0,L.N)(),{showMessage:v}=(0,f.A)(),[k,N]=(0,r.useState)(window.innerWidth<640),[A,S]=(0,r.useState)(window.innerWidth>1070),[C,z]=(0,r.useState)(!1),[R,E]=(0,r.useState)(null),[T,I]=(0,r.useState)(o.issueDate?new Date(o.issueDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[P,_]=(0,r.useState)(o.certificateType||"employment"),[O,B]=(0,r.useState)(null),[q,V]=(0,r.useState)(null),[U,M]=(0,r.useState)(null),G=(0,r.useRef)(null);(0,r.useEffect)((()=>{g||c()||u()||(v("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse bearbeiten","error"),a())}),[c,u,g,a,v]),(0,r.useEffect)((()=>{const e=()=>{N(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(t?(x(),o.id&&M(w.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id))):h(),()=>{h()})),[t,x,h,o.id,i]),(0,r.useEffect)((()=>()=>{q&&URL.revokeObjectURL(q)}),[q]);const W=async e=>{e.preventDefault(),z(!0),E(null);try{const e={issueDate:new Date(T),certificateType:P};O&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(O.name),e.templateVersion=o.templateVersion||"1.0"),await j.A.put(w.Sn.LIFECYCLE.CERTIFICATE(i,o.id),e),v("Arbeitszeugnis erfolgreich aktualisiert","success"),l(),a(),q&&(URL.revokeObjectURL(q),V(null)),B(null),G.current&&(G.current.value="")}catch(s){var t,r;console.error("Fehler beim Aktualisieren des Arbeitszeugnisses:",s),E((null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Fehler beim Aktualisieren des Arbeitszeugnisses"),v("Fehler beim Aktualisieren des Arbeitszeugnisses","error")}finally{z(!1)}};return c()||u()?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(!A||k)&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,F.jsxs)(m.lG.Panel,{className:"\n            ".concat(k?"w-full h-full":"w-[600px]","\n            ").concat(k?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(k?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,F.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis bearbeiten"})]}),(0,F.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[R&&(0,F.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:R})}),(0,F.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausstellungsdatum"}),(0,F.jsx)("input",{type:"date",value:T,onChange:e=>{const t=e.target.value;I(t),t&&new Date(t)>new Date?E("Ausstellungsdatum darf nicht in der Zukunft liegen"):E(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(R&&T&&new Date(T)>new Date?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(T&&new Date(T)>new Date)||void 0,"aria-describedby":T&&new Date(T)>new Date?"issueDate-error":void 0}),R&&T&&new Date(T)>new Date&&(0,F.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:R}),!R&&(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zertifikat-Typ"}),(0,F.jsxs)("select",{value:P,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,F.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,F.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,F.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,F.jsx)("input",{ref:G,type:"file",accept:".pdf",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if("application/pdf"!==a.type)return void v("Nur PDF-Dateien sind erlaubt","error");if(a.size>10485760)return void v("Datei ist zu gro\xdf (max. 10MB)","error");B(a);const e=URL.createObjectURL(a);V(e),M(null)}},className:"hidden"}),O?(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,F.jsx)("p",{className:"text-sm font-medium dark:text-white",children:O.name}),(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(O.size/1024/1024).toFixed(2)," MB"]}),(0,F.jsx)("button",{type:"button",onClick:()=>{B(null),q&&(URL.revokeObjectURL(q),V(null)),M(w.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id)),G.current&&(G.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,F.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(q||U)&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,F.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,F.jsx)("iframe",{src:"".concat(q||U).concat(q?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,F.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,F.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,F.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"button",onClick:W,disabled:C,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})})]}):null},O=e=>{let{isOpen:t,onClose:a,onContractUpdated:l,userId:i,contract:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:g}=(0,n.S)(),{openSidepane:x,closeSidepane:h}=(0,L.N)(),{showMessage:v}=(0,f.A)(),[k,N]=(0,r.useState)(window.innerWidth<640),[A,S]=(0,r.useState)(window.innerWidth>1070),[C,z]=(0,r.useState)(!1),[R,E]=(0,r.useState)(null),[T,P]=(0,r.useState)(o.contractType||"employment"),[_,O]=(0,r.useState)(o.startDate?new Date(o.startDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[B,q]=(0,r.useState)(o.endDate?new Date(o.endDate).toISOString().split("T")[0]:""),[V,U]=(0,r.useState)(o.salary?o.salary.toString():""),[M,G]=(0,r.useState)(o.workingHours?o.workingHours.toString():""),[W,H]=(0,r.useState)(o.position||""),[K,J]=(0,r.useState)(null),[Y,Z]=(0,r.useState)(null),[X,$]=(0,r.useState)(null),Q=(0,r.useRef)(null);(0,r.useEffect)((()=>{g||c()||u()||(v("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge bearbeiten","error"),a())}),[c,u,g,a,v]),(0,r.useEffect)((()=>{const e=()=>{N(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(t?(x(),o.id&&$(w.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id))):h(),()=>{h()})),[t,x,h,o.id,i]),(0,r.useEffect)((()=>()=>{Y&&URL.revokeObjectURL(Y)}),[Y]);const ee=async e=>{if(e.preventDefault(),_){z(!0),E(null);try{const e={contractType:T,startDate:new Date(_),endDate:B?new Date(B):null,salary:V?parseFloat(V):null,workingHours:M?parseFloat(M):null,position:W||null};K&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(K.name),e.templateVersion=o.templateVersion||"1.0"),await j.A.put(w.Sn.LIFECYCLE.CONTRACT(i,o.id),e),v("Arbeitsvertrag erfolgreich aktualisiert","success"),l(),a(),Y&&(URL.revokeObjectURL(Y),Z(null)),J(null),Q.current&&(Q.current.value="")}catch(s){var t,r;console.error("Fehler beim Aktualisieren des Arbeitsvertrags:",s),E((null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Fehler beim Aktualisieren des Arbeitsvertrags"),v("Fehler beim Aktualisieren des Arbeitsvertrags","error")}finally{z(!1)}}else v("Bitte geben Sie ein Startdatum an","error")};return c()||u()?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(!A||k)&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,F.jsxs)(m.lG.Panel,{className:"\n            ".concat(k?"w-full h-full":"w-[600px]","\n            ").concat(k?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(k?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,F.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag bearbeiten"})]}),(0,F.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[R&&(0,F.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:R})}),(0,F.jsxs)("form",{onSubmit:ee,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("select",{value:T,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,F.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,F.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"date",value:_,onChange:e=>{const t=e.target.value;O(t),B&&t&&new Date(B)<new Date(t)?E("Enddatum muss nach dem Startdatum liegen"):E(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(R&&!_?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!_||void 0,"aria-describedby":_?void 0:"startDate-error"}),R&&!_&&(0,F.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:R})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,F.jsx)("input",{type:"date",value:B,onChange:e=>{const t=e.target.value;q(t),t&&_&&new Date(t)<new Date(_)?E("Enddatum muss nach dem Startdatum liegen"):E(null)},min:_||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(R&&B&&_&&new Date(B)<new Date(_)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(B&&_&&new Date(B)<new Date(_))||void 0,"aria-describedby":B&&_&&new Date(B)<new Date(_)?"endDate-error":void 0}),R&&B&&_&&new Date(B)<new Date(_)&&(0,F.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:R})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,F.jsx)("input",{type:"text",value:W,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(I.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,F.jsx)("input",{type:"number",value:V,onChange:e=>{const t=e.target.value;U(t),t&&parseFloat(t)<0?E("Gehalt darf nicht negativ sein"):E(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(R&&V&&parseFloat(V)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(V&&parseFloat(V)<0)||void 0,"aria-describedby":V&&parseFloat(V)<0?"salary-error":void 0})]}),R&&V&&parseFloat(V)<0&&(0,F.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:R})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,F.jsx)("input",{type:"number",value:M,onChange:e=>{const t=e.target.value;G(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?E("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):E(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(R&&M&&(parseFloat(M)<0||parseFloat(M)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!M||!(parseFloat(M)<0||parseFloat(M)>168))||void 0,"aria-describedby":M&&(parseFloat(M)<0||parseFloat(M)>168)?"workingHours-error":void 0}),R&&M&&(parseFloat(M)<0||parseFloat(M)>168)&&(0,F.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:R}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,F.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,F.jsx)("input",{ref:Q,type:"file",accept:".pdf",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if("application/pdf"!==a.type)return void v("Nur PDF-Dateien sind erlaubt","error");if(a.size>10485760)return void v("Datei ist zu gro\xdf (max. 10MB)","error");J(a);const e=URL.createObjectURL(a);Z(e),$(null)}},className:"hidden"}),K?(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,F.jsx)("p",{className:"text-sm font-medium dark:text-white",children:K.name}),(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(K.size/1024/1024).toFixed(2)," MB"]}),(0,F.jsx)("button",{type:"button",onClick:()=>{J(null),Y&&(URL.revokeObjectURL(Y),Z(null)),$(w.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id)),Q.current&&(Q.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,F.jsxs)("div",{children:[(0,F.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,F.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(Y||X)&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,F.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,F.jsx)("iframe",{src:"".concat(Y||X).concat(Y?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,F.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,F.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,F.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"button",onClick:ee,disabled:C||!_,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})})]}):null};var B=a(7098);const q=e=>{let{userId:t,lifecycleId:a,onUpdate:l}=e;const{t:i}=(0,s.Bd)(),{isLegal:o,isAdmin:d,loading:m}=(0,n.S)(),{showMessage:u}=(0,f.A)(),[g,x]=(0,r.useState)({arl:null,eps:null,pension:null,caja:null}),[h,y]=(0,r.useState)(!0),[v,k]=(0,r.useState)(null),[N,z]=(0,r.useState)({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),[R,E]=(0,r.useState)(!1),L=(0,r.useRef)(!1),T=(0,r.useRef)(null),I=(0,r.useCallback)((async()=>{T.current&&T.current.abort();const e=new AbortController;T.current=e,L.current=!0,y(!0);try{const a=["arl","eps","pension","caja"].map((async a=>{if(e.signal.aborted)return{type:a,registration:null};try{return{type:a,registration:(await j.A.get(w.Sn.LIFECYCLE.SOCIAL_SECURITY(t,a),{timeout:5e3,signal:e.signal})).data}}catch(n){var r,s;return"AbortError"===n.name||"CanceledError"===n.name||e.signal.aborted||404===(null===(r=n.response)||void 0===r?void 0:r.status)?{type:a,registration:null}:"ERR_NETWORK"===n.code||"ECONNABORTED"===n.code||null!==(s=n.message)&&void 0!==s&&s.includes("ERR_INSUFFICIENT_RESOURCES")?(console.warn("Network error loading ".concat(a,", treating as not found")),{type:a,registration:null}):(console.error("Error loading ".concat(a,":"),n),{type:a,registration:null})}})),r=await Promise.all(a);if(e.signal.aborted)return;const s={arl:null,eps:null,pension:null,caja:null};r.forEach((e=>{let{type:t,registration:a}=e;a&&(s[t]={id:a.id||0,registrationType:t,registrationNumber:a.number||a.registrationNumber||null,provider:a.provider||null,registrationDate:a.registeredAt||a.registrationDate||null,status:a.status||"pending",notes:a.notes||null,completedAt:a.completedAt||null})})),x(s)}catch(a){if("AbortError"===a.name||"CanceledError"===a.name||e.signal.aborted)return;console.error("Error loading registrations:",a),u(i("socialSecurity.loadError"),"error")}finally{y(!1),L.current=!1}}),[t,i,u]);(0,r.useEffect)((()=>{if(m)return;if((o()||d())&&t&&a){if(!L.current)return I(),()=>{T.current&&T.current.abort(),L.current=!1}}else y(!1)}),[t,a,m]);const P=()=>{k(null),z({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""})},_=async()=>{if(v)if(m)u(i("common.loading",{defaultValue:"Berechtigungen werden geladen..."}),"warning");else if(o()||d()){E(!0);try{await j.A.put(w.Sn.LIFECYCLE.SOCIAL_SECURITY(t,v),{status:N.status,number:N.registrationNumber||void 0,provider:N.provider||void 0,registrationDate:N.registrationDate?new Date(N.registrationDate).toISOString():void 0,notes:N.notes||void 0}),u("Sozialversicherung erfolgreich aktualisiert","success"),k(null),await new Promise((e=>setTimeout(e,200))),await I(),l&&"function"===typeof l&&l()}catch(r){var e,a;console.error("Error updating social security:",r),u((null===(e=r.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||i("socialSecurity.updateError"),"error")}finally{E(!1)}}else u(i("lifecycle.noPermission",{defaultValue:"Keine Berechtigung - nur Legal oder Admin"}),"error")},O=e=>{switch(e){case"registered":return(0,F.jsx)(A.A,{className:"h-5 w-5 text-green-500"});case"pending":return(0,F.jsx)(C.A,{className:"h-5 w-5 text-yellow-500"});case"failed":return(0,F.jsx)(B.A,{className:"h-5 w-5 text-red-500"});case"not_required":return(0,F.jsx)(A.A,{className:"h-5 w-5 text-gray-400"});case"deregistered":return(0,F.jsx)(B.A,{className:"h-5 w-5 text-gray-400"});default:return(0,F.jsx)(C.A,{className:"h-5 w-5 text-gray-400"})}},q=e=>{const t="lifecycle.socialSecurityStatus.".concat(e);return i(t)||e},V=e=>({arl:"ARL (Risiko-Arbeit)",eps:"EPS (Gesundheit)",pension:"Pension",caja:"Caja de Compensaci\xf3n"}[e]);if(m)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,F.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(!o()&&!d())return null;if(h)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,F.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});return(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,F.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 mr-2"}),i("lifecycle.socialSecurity",{defaultValue:"Sozialversicherungen"})]})}),(0,F.jsx)("div",{className:"space-y-4",children:["arl","eps","pension","caja"].map((e=>{const t=g[e],a=v===e;return(0,F.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:a?(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)("h4",{className:"font-medium dark:text-white uppercase mb-3",children:i("socialSecurity.editType",{type:V(e)})}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("socialSecurity.status")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("select",{value:N.status,onChange:e=>z((0,c.A)((0,c.A)({},N),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"not_required",children:"Nicht erforderlich"}),(0,F.jsx)("option",{value:"pending",children:"Ausstehend"}),(0,F.jsx)("option",{value:"registered",children:"Registriert"}),(0,F.jsx)("option",{value:"failed",children:"Fehlgeschlagen"}),(0,F.jsx)("option",{value:"deregistered",children:"Abgemeldet"})]})]}),"registered"===N.status&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationNumber")}),(0,F.jsx)("input",{type:"text",value:N.registrationNumber,onChange:e=>z((0,c.A)((0,c.A)({},N),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 123456789"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.provider")}),(0,F.jsx)("input",{type:"text",value:N.provider,onChange:e=>z((0,c.A)((0,c.A)({},N),{},{provider:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. ARL Sura, EPS Sanitas"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationDate")}),(0,F.jsx)("input",{type:"date",value:N.registrationDate,onChange:e=>z((0,c.A)((0,c.A)({},N),{},{registrationDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.notes")}),(0,F.jsx)("textarea",{value:N.notes,onChange:e=>z((0,c.A)((0,c.A)({},N),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",rows:3,placeholder:i("socialSecurity.additionalInfo")})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,F.jsx)("button",{onClick:P,disabled:R,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:i("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:_,disabled:R,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(R?"common.saving":"common.save"),children:R?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(A.A,{className:"h-5 w-5"})})]})]}):(0,F.jsxs)("div",{className:"flex items-start justify-between",children:[(0,F.jsxs)("div",{className:"flex items-start space-x-3 flex-1",children:[O((null===t||void 0===t?void 0:t.status)||"pending"),(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,F.jsx)("h4",{className:"font-medium dark:text-white uppercase",children:V(e)}),(0,F.jsx)("span",{className:"text-sm font-medium dark:text-white",children:q((null===t||void 0===t?void 0:t.status)||"pending")})]}),t&&(0,F.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[t.provider&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.provider"),":"]})," ",t.provider]}),t.registrationNumber&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.number"),":"]})," ",t.registrationNumber]}),t.registrationDate&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.registrationDate"),":"]})," ",new Date(t.registrationDate).toLocaleDateString("de-DE")]}),t.notes&&(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.notes"),":"]}),(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t.notes})]}),t.completedAt&&(0,F.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[i("socialSecurity.completedAt")," ",new Date(t.completedAt).toLocaleDateString("de-DE")]})]}),!t&&(0,F.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("socialSecurity.notRegistered")})]})]}),(0,F.jsx)("button",{onClick:()=>(e=>{const t=g[e];z(t?{status:t.status,registrationNumber:t.registrationNumber||"",provider:t.provider||"",registrationDate:t.registrationDate?new Date(t.registrationDate).toISOString().split("T")[0]:"",notes:t.notes||""}:{status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),k(e)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition ml-4",title:i("lifecycle.edit",{defaultValue:"Bearbeiten"}),children:(0,F.jsx)(S.A,{className:"h-5 w-5"})})]})},e)}))})]})};var V=a(9399);const U=e=>{let{isOpen:t,onClose:a,onOffboardingStarted:n,userId:l,userName:i}=e;const{t:o}=(0,s.Bd)(),{openSidepane:d,closeSidepane:u}=(0,L.N)(),{showMessage:g}=(0,f.A)(),[x,b]=(0,r.useState)(window.innerWidth<640),[h,y]=(0,r.useState)(window.innerWidth>1070),[v,k]=(0,r.useState)(!1),[A,S]=(0,r.useState)(null),[C,R]=(0,r.useState)(""),[E,T]=(0,r.useState)(""),[I,P]=(0,r.useState)({});(0,r.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),y(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>{if(t){d();const e=(new Date).toISOString().split("T")[0];R(e),T(""),S(null),P({})}else u();return()=>{u()}}),[t,d,u]);const _=async e=>{if(e.preventDefault(),(()=>{const e={};if(C){const t=new Date(C);(new Date).setHours(0,0,0,0);const a=new Date;a.setFullYear(a.getFullYear()+1),t>a&&(e.exitDate=o("lifecycle.offboarding.exitDateTooFar",{defaultValue:"Austrittsdatum darf nicht mehr als 1 Jahr in der Zukunft liegen"}))}else e.exitDate=o("lifecycle.offboarding.exitDateRequired",{defaultValue:"Austrittsdatum ist erforderlich"});return E&&0!==E.trim().length?E.trim().length<10&&(e.exitReason=o("lifecycle.offboarding.exitReasonTooShort",{defaultValue:"Austrittsgrund muss mindestens 10 Zeichen lang sein"})):e.exitReason=o("lifecycle.offboarding.exitReasonRequired",{defaultValue:"Austrittsgrund ist erforderlich"}),P(e),0===Object.keys(e).length})()){k(!0),S(null);try{await j.A.put(w.Sn.LIFECYCLE.STATUS(l),{status:"offboarding",exitDate:C,exitReason:E.trim()}),g(o("lifecycle.offboarding.started",{defaultValue:"Offboarding erfolgreich gestartet"}),"success"),n(),a()}catch(s){var t,r;console.error("Fehler beim Starten des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||o("lifecycle.offboarding.startError",{defaultValue:"Fehler beim Starten des Offboarding"});S(e),g(e,"error")}finally{k(!1)}}},O=()=>(0,F.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,F.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:(0,F.jsxs)("div",{className:"flex items-start",children:[(0,F.jsx)(V.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5 mr-3 flex-shrink-0"}),(0,F.jsxs)("div",{className:"text-sm text-orange-800 dark:text-orange-200",children:[(0,F.jsx)("p",{className:"font-medium mb-1",children:o("lifecycle.offboarding.warningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,F.jsx)("p",{children:o("lifecycle.offboarding.warningText",{defaultValue:"Durch das Starten des Offboarding-Prozesses werden automatisch Tasks erstellt. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})]})]})}),(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("lifecycle.offboarding.user",{defaultValue:"Mitarbeiter"})}),(0,F.jsx)("p",{className:"font-medium dark:text-white",children:i})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"exitDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitDate",{defaultValue:"Austrittsdatum"})," *"]}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,F.jsx)(z.A,{className:"h-5 w-5 text-gray-400"})}),(0,F.jsx)("input",{type:"date",id:"exitDate",value:C,onChange:e=>{R(e.target.value),I.exitDate&&P((e=>(0,c.A)((0,c.A)({},e),{},{exitDate:void 0})))},className:"block w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitDate?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),required:!0})]}),I.exitDate&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitDate}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitDateHint",{defaultValue:"Das Datum, an dem der Mitarbeiter die Organisation verl\xe4sst"})})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"exitReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitReason",{defaultValue:"Austrittsgrund"})," *"]}),(0,F.jsx)("textarea",{id:"exitReason",value:E,onChange:e=>{T(e.target.value),I.exitReason&&P((e=>(0,c.A)((0,c.A)({},e),{},{exitReason:void 0})))},rows:4,className:"block w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitReason?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),placeholder:o("lifecycle.offboarding.exitReasonPlaceholder",{defaultValue:"z.B. K\xfcndigung, Vertragsende, etc."}),required:!0}),I.exitReason&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitReason}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitReasonHint",{defaultValue:"Mindestens 10 Zeichen. Beschreiben Sie den Grund f\xfcr den Austritt."})})]}),A&&(0,F.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,F.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:A})}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,F.jsx)("button",{type:"button",onClick:a,disabled:v,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:o("common.cancel",{defaultValue:"Abbrechen"}),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed",title:v?o("common.saving",{defaultValue:"Speichern..."}):o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"}),children:v?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(N.A,{className:"h-5 w-5"})})]})]});return t?x?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,F.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsx)("div",{className:"p-4",children:O()})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!h&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,F.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:O()})]})]}):null},M=e=>{let{isOpen:t,onClose:a,onOffboardingCompleted:n,userId:l,userName:i,offboardingTasks:o}=e;const{t:d}=(0,s.Bd)(),{openSidepane:c,closeSidepane:u}=(0,L.N)(),{showMessage:g}=(0,f.A)(),[x,b]=(0,r.useState)(window.innerWidth<640),[h,y]=(0,r.useState)(window.innerWidth>1070),[v,k]=(0,r.useState)(!1),[N,S]=(0,r.useState)(null),[C,z]=(0,r.useState)(""),R=o.filter((e=>"done"===e.status)),E=o.length>0&&R.length===o.length,T=i.trim().toLowerCase();(0,r.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),y(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(t?(c(),z(""),S(null)):u(),()=>{u()})),[t,c,u]);const I=async e=>{if(e.preventDefault(),C.trim().toLowerCase()===T||(S(d("lifecycle.offboarding.complete.confirmTextMismatch",{defaultValue:"Best\xe4tigungstext stimmt nicht \xfcberein"})),0)){k(!0),S(null);try{await j.A.put(w.Sn.LIFECYCLE.STATUS(l),{status:"archived"}),g(d("lifecycle.offboarding.complete.success",{defaultValue:"Offboarding erfolgreich abgeschlossen"}),"success"),n(),a()}catch(s){var t,r;console.error("Fehler beim Abschlie\xdfen des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||d("lifecycle.offboarding.complete.error",{defaultValue:"Fehler beim Abschlie\xdfen des Offboarding"});S(e),g(e,"error")}finally{k(!1)}}},P=()=>(0,F.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md flex items-center space-x-3",children:[(0,F.jsx)(A.A,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),(0,F.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[d("lifecycle.offboarding.complete.user",{defaultValue:"Mitarbeiter"}),": ",i]})]}),o.length>0&&(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-md",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:d("lifecycle.offboarding.complete.tasksStatus",{defaultValue:"Status der Offboarding-Aufgaben"})}),(0,F.jsx)("div",{className:"space-y-2",children:o.map((e=>{const t="done"===e.status;return(0,F.jsxs)("div",{className:"flex items-center space-x-2 text-sm ".concat(t?"text-green-700 dark:text-green-300":"text-orange-700 dark:text-orange-300"),children:[t?(0,F.jsx)(A.A,{className:"h-4 w-4 flex-shrink-0"}):(0,F.jsx)(V.A,{className:"h-4 w-4 flex-shrink-0"}),(0,F.jsx)("span",{children:e.title}),(0,F.jsx)("span",{className:"ml-auto text-xs",children:"(".concat(t?d("common.done",{defaultValue:"Abgeschlossen"}):d("common.open",{defaultValue:"Offen"}),")")})]},e.id)}))})]}),!E&&o.length>0&&(0,F.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 p-4",children:(0,F.jsxs)("div",{className:"flex",children:[(0,F.jsx)("div",{className:"flex-shrink-0",children:(0,F.jsx)(V.A,{className:"h-5 w-5 text-orange-400","aria-hidden":"true"})}),(0,F.jsxs)("div",{className:"ml-3",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:d("lifecycle.offboarding.complete.warningTitle",{defaultValue:"Nicht alle Aufgaben abgeschlossen"})}),(0,F.jsx)("div",{className:"mt-2 text-sm text-orange-700 dark:text-orange-200",children:(0,F.jsx)("p",{children:d("lifecycle.offboarding.complete.warningText",{defaultValue:"Es sind noch nicht alle Offboarding-Aufgaben abgeschlossen. Sie k\xf6nnen das Offboarding trotzdem abschlie\xdfen, aber es wird empfohlen, alle Aufgaben zuerst zu erledigen."})})})]})]})}),E&&(0,F.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 p-4",children:(0,F.jsxs)("div",{className:"flex",children:[(0,F.jsx)("div",{className:"flex-shrink-0",children:(0,F.jsx)(A.A,{className:"h-5 w-5 text-green-400","aria-hidden":"true"})}),(0,F.jsxs)("div",{className:"ml-3",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:d("lifecycle.offboarding.complete.allTasksCompleted",{defaultValue:"Alle Aufgaben abgeschlossen"})}),(0,F.jsx)("div",{className:"mt-2 text-sm text-green-700 dark:text-green-200",children:(0,F.jsx)("p",{children:d("lifecycle.offboarding.complete.allTasksCompletedText",{defaultValue:"Alle Offboarding-Aufgaben sind abgeschlossen. Sie k\xf6nnen das Offboarding jetzt abschlie\xdfen."})})})]})]})}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"confirmText",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("lifecycle.offboarding.complete.confirmLabel",{userName:i})||'Best\xe4tigen Sie durch Eingabe des Namens: "'.concat(i,'"')," *"]}),(0,F.jsx)("input",{type:"text",id:"confirmText",value:C,onChange:e=>{z(e.target.value),S(null)},className:"w-full px-3 py-2 border ".concat(N&&N.includes("Best\xe4tigung")?"border-red-500":"border-gray-300"," dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"),placeholder:i,required:!0}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:d("lifecycle.offboarding.complete.confirmHint",{defaultValue:"Geben Sie den vollst\xe4ndigen Namen des Mitarbeiters ein, um das Offboarding abzuschlie\xdfen"})})]}),(0,F.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsxs)("div",{className:"flex",children:[(0,F.jsx)("div",{className:"flex-shrink-0",children:(0,F.jsx)(V.A,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),(0,F.jsxs)("div",{className:"ml-3",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:d("lifecycle.offboarding.complete.finalWarningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,F.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-200",children:(0,F.jsx)("p",{children:d("lifecycle.offboarding.complete.finalWarningText",{defaultValue:"Durch das Abschlie\xdfen des Offboarding wird der Mitarbeiter archiviert. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})})]})]})}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,F.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:v,title:d("common.cancel",{defaultValue:"Abbrechen"}),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",className:"p-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:v||C.trim().toLowerCase()!==T,title:v?d("common.saving",{defaultValue:"Speichern..."}):d("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"}),children:v?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(A.A,{className:"h-5 w-5"})})]})]});return t?x?(0,F.jsxs)(m.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,F.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]})}),(0,F.jsxs)("div",{className:"p-6",children:[N&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:N}),P()]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!h&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,F.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[N&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:N}),P()]})]})]}):null},G=e=>{var t;let{userId:a,userName:l}=e;const{t:o}=(0,s.Bd)(),{isHR:d,isAdmin:c}=(0,n.S)(),{showMessage:m}=(0,f.A)(),[u,x]=(0,r.useState)(null),[p,y]=(0,r.useState)([]),[v,k]=(0,r.useState)([]),[D,E]=(0,r.useState)([]),[L,I]=(0,r.useState)(!0),[B,V]=(0,r.useState)(null),[G,W]=(0,r.useState)(!1),[H,K]=(0,r.useState)(!1),[J,Y]=(0,r.useState)(null),[Z,X]=(0,r.useState)(null),[$,Q]=(0,r.useState)(null),[ee,te]=(0,r.useState)(null),[ae,re]=(0,r.useState)(!1),[se,ne]=(0,r.useState)(!1),[le,ie]=(0,r.useState)(!1),[oe,de]=(0,r.useState)(""),[ce,me]=(0,r.useState)(""),ue=(0,r.useRef)(!1),ge=(0,r.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!ue.current||e)try{var t,r,s,n,l,i;ue.current=!0,I(!0);const[e,o,d,c]=await Promise.all([j.A.get(w.Sn.LIFECYCLE.BY_USER(a)),j.A.get(w.Sn.LIFECYCLE.CERTIFICATES(a)),j.A.get(w.Sn.LIFECYCLE.CONTRACTS(a)),j.A.get(w.Sn.TASKS.BY_USER(a)).catch((()=>({data:[]})))]);x(e.data),y((null===(t=o.data)||void 0===t?void 0:t.certificates)||[]),k((null===(r=d.data)||void 0===r?void 0:r.contracts)||[]);const m=c.data||[],u=["Crear certificado laboral","Realizar liquidaci\xf3n final","Desafiliar de seguridad social"],g=m.filter((e=>u.includes(e.title)));E(g),"onboarding"===(null===(s=e.data)||void 0===s||null===(n=s.lifecycle)||void 0===n?void 0:n.status)&&100===(null===(l=e.data)||void 0===l||null===(i=l.progress)||void 0===i?void 0:i.percent)&&setTimeout((()=>{ge()}),1e3),V(null)}catch(c){var o,d;console.error("Fehler beim Laden der Lebenszyklus-Daten:",c),V((null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.message)||"Fehler beim Laden der Daten"),m("Fehler beim Laden der Daten","error")}finally{I(!1),ue.current=!1}else setTimeout((()=>{ue.current||ge(!0)}),500)}),[a]);(0,r.useEffect)((()=>{ue.current=!1,ge()}),[ge]);const xe=()=>{null!==u&&void 0!==u&&u.lifecycle&&(de(u.lifecycle.contractStartDate?new Date(u.lifecycle.contractStartDate).toISOString().split("T")[0]:""),me(u.lifecycle.contractEndDate?new Date(u.lifecycle.contractEndDate).toISOString().split("T")[0]:""),ie(!0))},be=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"});if(L)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,F.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(B)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,F.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,F.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:B})})});if(!u)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:o("lifecycle.noData",{defaultValue:"Keine Lebenszyklus-Daten verf\xfcgbar"})})});(null===(t=u.lifecycle)||void 0===t?void 0:t.socialSecurityRegistrations)||u.socialSecurityRegistrations;const{lifecycle:he,progress:pe}=u;return(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,F.jsx)(h.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.statusTitle")]}),(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a={onboarding:{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",labelKey:"lifecycle.status.onboarding"},active:{color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",labelKey:"lifecycle.status.active"},contract_change:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",labelKey:"lifecycle.status.contract_change"},offboarding:{color:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",labelKey:"lifecycle.status.offboarding"},archived:{color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",labelKey:"lifecycle.status.archived"}}[e]||{color:"bg-gray-100 text-gray-800",labelKey:e};return(0,F.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(a.color," ").concat(t?"cursor-pointer hover:opacity-80":""),children:o(a.labelKey)||e})}(he.status),(d()||c())&&"active"===he.status&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>re(!0),className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:(0,F.jsx)(N.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"})})]}),(d()||c())&&"offboarding"===he.status&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>ne(!0),className:"p-2 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,F.jsx)(A.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"})})]})]})]}),(0,F.jsxs)("div",{className:"space-y-2 text-sm",children:[he.onboardingStartedAt&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingStarted")}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.onboardingStartedAt).toLocaleDateString("de-DE")})]}),he.onboardingCompletedAt&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingCompleted")}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.onboardingCompletedAt).toLocaleDateString("de-DE")})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractStart")}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[he.contractStartDate?(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.contractStartDate).toLocaleDateString("de-DE")}):(0,F.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>xe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",children:(0,F.jsx)(S.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit",{defaultValue:"Bearbeiten"})})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractEnd")}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[he.contractEndDate?(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.contractEndDate).toLocaleDateString("de-DE")}):(0,F.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>xe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",children:(0,F.jsx)(S.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit",{defaultValue:"Bearbeiten"})})]})]})]}),he.offboardingStartedAt&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboardingStarted")}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.offboardingStartedAt).toLocaleDateString("de-DE")})]}),he.exitDate&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitDate")}),(0,F.jsx)("span",{className:"dark:text-white",children:new Date(he.exitDate).toLocaleDateString("de-DE")})]}),he.exitReason&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitReason")}),(0,F.jsx)("span",{className:"dark:text-white",children:he.exitReason})]})]})]}),"onboarding"===he.status&&(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.progressTitle")}),(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.progressSteps",{completed:pe.completed,total:pe.total})}),(0,F.jsxs)("span",{className:"font-medium dark:text-white",children:[pe.percent,"%"]})]}),(0,F.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,F.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(pe.percent,"%")}})})]})]}),"offboarding"===he.status&&(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.offboarding.progressTitle",{defaultValue:"Offboarding-Fortschritt"})}),(0,F.jsxs)("div",{className:"space-y-4",children:[(()=>{const e=D.filter((e=>"done"===e.status)).length,t=D.length||3,a=t>0?Math.round(e/t*100):0;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboarding.progressSteps",{completed:e,total:t})||"".concat(e," von ").concat(t," Schritten abgeschlossen")}),(0,F.jsxs)("span",{className:"font-medium dark:text-white",children:[a,"%"]})]}),(0,F.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,F.jsx)("div",{className:"bg-orange-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(a,"%")}})})]})})(),D.length>0&&(0,F.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("lifecycle.offboarding.tasksTitle",{defaultValue:"Offboarding-Aufgaben"})}),D.map((e=>{const t="done"===e.status;return(0,F.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border ".concat(t?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[t?(0,F.jsx)(A.A,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):(0,F.jsx)(C.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 flex-shrink-0"}),(0,F.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,F.jsx)("p",{className:"text-sm font-medium ".concat(t?"text-green-800 dark:text-green-200":"text-gray-800 dark:text-gray-200"),children:e.title}),e.description&&(0,F.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 truncate",children:e.description})]})]}),(0,F.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(t?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200"),children:t?o("common.done",{defaultValue:"Abgeschlossen"}):o("common.open",{defaultValue:"Offen"})})]},e.id)}))]})]})]}),(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.certificates")]}),(d()||c())&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>W(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":o("lifecycle.createCertificate"),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.createCertificate")})]})]}),0===p.length?(0,F.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,F.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,F.jsx)("p",{children:o("lifecycle.noCertificates")})]}):(0,F.jsx)("div",{className:"space-y-4",children:p.map((e=>(0,F.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,F.jsxs)("div",{className:"flex items-start justify-between",children:[(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,F.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.certificate"),"employment"!==e.certificateType&&" (".concat(e.certificateType,")")]}),e.isLatest&&(0,F.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,F.jsx)(A.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,F.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(z.A,{className:"h-4 w-4"}),(0,F.jsxs)("span",{children:[o("lifecycle.issuedOn")," ",be(e.issueDate)]})]}),e.generatedByUser&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(i.A,{className:"h-4 w-4"}),(0,F.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>Y(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",children:(0,F.jsx)(S.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>(async e=>{Q(e);try{const t=await j.A.get(w.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(a,e),{responseType:"blob"}),r=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download="arbeitszeugnis-".concat(e,".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),m("Arbeitszeugnis erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitszeugnisses","error")}finally{Q(null)}})(e.id),disabled:$===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",children:$===e.id?(0,F.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,F.jsx)(R.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.download")})]})]})]})},e.id)))})]}),(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center mb-4",children:[(d()||c())&&(0,F.jsxs)("div",{className:"relative group mr-3",children:[(0,F.jsx)("button",{onClick:()=>K(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":o("lifecycle.createContract"),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.createContract")})]}),(0,F.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.contracts")]})]}),0===v.length?(0,F.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,F.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,F.jsx)("p",{children:o("lifecycle.noContracts")})]}):(0,F.jsx)("div",{className:"space-y-4",children:v.map((e=>(0,F.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,F.jsxs)("div",{className:"flex items-start justify-between",children:[(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,F.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.contract"),"employment"!==e.contractType&&" (".concat(e.contractType,")")]}),e.isLatest&&(0,F.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,F.jsx)(A.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,F.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(z.A,{className:"h-4 w-4"}),(0,F.jsxs)("span",{children:[be(e.startDate),e.endDate&&" - ".concat(be(e.endDate))]})]}),e.position&&(0,F.jsxs)("div",{children:[o("lifecycle.position")," ",e.position]}),e.salary&&(0,F.jsxs)("div",{children:[o("lifecycle.salary")," ",e.salary.toLocaleString("de-DE",{style:"currency",currency:"EUR"})]}),e.workingHours&&(0,F.jsxs)("div",{children:[o("lifecycle.workingHours")," ",e.workingHours,"h/Woche"]}),e.generatedByUser&&(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(i.A,{className:"h-4 w-4"}),(0,F.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>X(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",children:(0,F.jsx)(S.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>(async e=>{te(e);try{const t=await j.A.get(w.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(a,e),{responseType:"blob"}),r=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download="arbeitsvertrag-".concat(e,".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),m("Arbeitsvertrag erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitsvertrags","error")}finally{te(null)}})(e.id),disabled:ee===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",children:ee===e.id?(0,F.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,F.jsx)(R.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.download")})]})]})]})},e.id)))})]}),(null===u||void 0===u?void 0:u.lifecycle)&&(0,F.jsx)(q,{userId:a,lifecycleId:u.lifecycle.id,onUpdate:()=>ge(!0)}),(0,F.jsx)(T,{isOpen:G,onClose:()=>W(!1),onCertificateCreated:()=>{ge(),W(!1)},userId:a,userName:l}),(0,F.jsx)(P,{isOpen:H,onClose:()=>K(!1),onContractCreated:()=>{ge(),K(!1)},userId:a,userName:l}),J&&(0,F.jsx)(_,{isOpen:!!J,onClose:()=>Y(null),onCertificateUpdated:()=>{ge(),Y(null)},userId:a,certificate:J}),Z&&(0,F.jsx)(O,{isOpen:!!Z,onClose:()=>X(null),onContractUpdated:()=>{ge(),X(null)},userId:a,contract:Z}),(0,F.jsx)(U,{isOpen:ae,onClose:()=>re(!1),onOffboardingStarted:()=>{ge(),re(!1)},userId:a,userName:l}),(0,F.jsx)(M,{isOpen:se,onClose:()=>ne(!1),onOffboardingCompleted:()=>{ge(),ne(!1)},userId:a,userName:l,offboardingTasks:D}),le&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[(0,F.jsx)("h2",{className:"text-xl font-semibold dark:text-white mb-4",children:o("lifecycle.editContractDates",{defaultValue:"Vertragsdaten bearbeiten"})}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractStart",{defaultValue:"Vertragsbeginn"})," *"]}),(0,F.jsx)("input",{type:"date",value:oe,onChange:e=>de(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractEnd",{defaultValue:"Vertragsende"})," (optional)"]}),(0,F.jsx)("input",{type:"date",value:ce,onChange:e=>me(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.contractEndHint",{defaultValue:"Nur bei befristeten Vertr\xe4gen ausf\xfcllen"})})]})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,F.jsx)("button",{onClick:()=>ie(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:o("common.cancel",{defaultValue:"Abbrechen"})}),(0,F.jsx)("button",{onClick:async()=>{try{await j.A.put(w.Sn.LIFECYCLE.STATUS(a),{status:(null===u||void 0===u?void 0:u.lifecycle.status)||"active",contractStartDate:oe||null,contractEndDate:ce||null}),m("Vertragsdaten erfolgreich aktualisiert","success"),ie(!1),ge()}catch(e){console.error("Fehler beim Speichern der Vertragsdaten:",e),m("Fehler beim Speichern der Vertragsdaten","error")}},disabled:!oe,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o("common.save",{defaultValue:"Speichern"})})]})]})})]})},W=[{code:"tiempo_completo",name:"Tiempo Completo (>21 Tage/Monat)"},{code:"tiempo_parcial_7",name:"Tiempo Parcial (\u22647 Tage/Monat)"},{code:"tiempo_parcial_14",name:"Tiempo Parcial (\u226414 Tage/Monat)"},{code:"tiempo_parcial_21",name:"Tiempo Parcial (\u226421 Tage/Monat)"},{code:"prestacion_de_servicios",name:"Prestaci\xf3n de Servicios"},{code:"externo",name:"Externo"}],H=e=>{let{onError:t}=e;const{t:a}=(0,s.Bd)(),l=[{code:"CO",name:a("countries.CO")},{code:"CH",name:a("countries.CH")},{code:"DE",name:a("countries.DE")},{code:"AT",name:a("countries.AT")}],i=[{code:"CH",name:a("countries.CH")},{code:"CO",name:a("countries.CO")}],j=[{code:"es",name:a("languages.es")},{code:"de",name:a("languages.de")},{code:"en",name:a("languages.en")}],[w,N]=(0,r.useState)([]),[A,S]=(0,r.useState)(null),[C,z]=(0,r.useState)({}),[R,D]=(0,r.useState)(!1),[E,T]=(0,r.useState)([]),[I,P]=(0,r.useState)(0),[_,O]=(0,r.useState)(!1),[B,q]=(0,r.useState)(null),{showMessage:V}=(0,f.A)(),{isAdmin:U}=(0,n.S)(),[M,H]=(0,r.useState)([]),[K,J]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)([]),[X,$]=(0,r.useState)(!1),[Q,ee]=(0,r.useState)([]),[te,ae]=(0,r.useState)("details"),[re,se]=(0,r.useState)("active"),[ne,le]=(0,r.useState)(!1),[ie,oe]=(0,r.useState)(window.innerWidth<640),[de,ce]=(0,r.useState)(window.innerWidth>1070),{openSidepane:me,closeSidepane:ue}=(0,L.N)(),[ge,xe]=(0,r.useState)(!1),[be,he]=(0,r.useState)({email:"",password:"",firstName:"",lastName:""});(0,r.useEffect)((()=>{const e=()=>{oe(window.innerWidth<640),ce(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(ne?me():ue(),()=>{ue()})),[ne,me,ue]);const[pe,ye]=(0,r.useState)([]);(0,r.useEffect)((()=>{fe()}),[]);const fe=async()=>{try{const e=await u.i$.getAll();ye(e.data),ve("active",e.data)}catch(e){je(e)}},ve=function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe).filter((t=>{const a=void 0===t.active||t.active;return"active"===e?a:!a})).sort(((e,t)=>{const a=(e.username||"").toLowerCase(),r=(t.username||"").toLowerCase(),s=(e.firstName||"").toLowerCase(),n=(t.firstName||"").toLowerCase();return a!==r?a.localeCompare(r):s.localeCompare(n)}));N(t)};(0,r.useEffect)((()=>{pe.length>0&&ve(re,pe)}),[re]);const ke=async e=>{try{if(!e||isNaN(e))return void S(null);console.log("Lade Benutzerdetails f\xfcr ID:",e);const t=await u.i$.getById(e),a=(0,c.A)((0,c.A)({},t.data),{},{active:void 0===t.data.active||t.data.active,birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});let r=[];t.data.roles&&Array.isArray(t.data.roles)?(console.log("Rollenstruktur (Typ):",typeof t.data.roles,"L\xe4nge:",t.data.roles.length),t.data.roles.length>0&&t.data.roles[0].role?(r=t.data.roles.map((e=>e.role.id)),console.log("Extrahierte Rollen-IDs aus verschachtelter Struktur:",r)):t.data.roles.length>0&&("number"===typeof t.data.roles[0]?r=t.data.roles:t.data.roles[0].roleId?r=t.data.roles.map((e=>e.roleId)):t.data.roles[0].id&&(r=t.data.roles.map((e=>e.id))))):console.warn("Rollen fehlen oder sind kein Array:",t.data.roles),0===r.length&&t.data.role&&(console.log("Versuche Rollen aus role-Eigenschaft zu extrahieren:",t.data.role),Array.isArray(t.data.role)?r=t.data.role.map((e=>e.id)):"object"===typeof t.data.role&&null!==t.data.role&&(r=[t.data.role.id])),console.log("Endg\xfcltige extrahierte Rollen-IDs:",r);let s=[];t.data.branches&&Array.isArray(t.data.branches)?(console.log("Branches-Struktur (Typ):",typeof t.data.branches,"L\xe4nge:",t.data.branches.length),t.data.branches.length>0&&t.data.branches[0].branch?(s=t.data.branches.map((e=>e.branch.id)),console.log("Extrahierte Branch-IDs aus verschachtelter Struktur:",s)):t.data.branches.length>0&&("number"===typeof t.data.branches[0]?s=t.data.branches:t.data.branches[0].branchId?s=t.data.branches.map((e=>e.branchId)):t.data.branches[0].id&&(s=t.data.branches.map((e=>e.id))))):console.warn("Branches fehlen oder sind kein Array:",t.data.branches),console.log("Endg\xfcltige extrahierte Branch-IDs:",s),S(a),z(a),T(r),ee(s),0===M.length&&await(async()=>{try{J(!0);const t=[{id:1,name:"admin",description:"Administrator mit allen Rechten",permissions:[]},{id:2,name:"user",description:"Standardbenutzer",permissions:[]},{id:999,name:"hamburger",description:"Hamburger-Rolle f\xfcr neue Benutzer",permissions:[]}];try{const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(H(e.data),console.log("".concat(e.data.length," Rollen erfolgreich geladen"))):(console.warn("Keine Rollen vom Server erhalten, verwende Fallback"),H(t))}catch(e){console.warn("Fehler beim Laden der Rollen, verwende Fallback:",e),H(t)}}finally{J(!1)}})(),0===Y.length&&await(async()=>{try{$(!0);try{const e=await u.H_.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(Z(e.data),console.log("".concat(e.data.length," Branches erfolgreich geladen"))):(console.warn("Keine Branches vom Server erhalten"),Z([]))}catch(e){console.warn("Fehler beim Laden der Branches:",e),Z([])}}finally{$(!1)}})()}catch(t){console.error("Fehler beim Laden der Benutzerdetails:",t),je(t)}},je=e=>{var a,r;let s="Ein Fehler ist aufgetreten";null!==(a=e.response)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&r.message?s=e.response.data.message:e instanceof Error&&(s=e.message),!s.includes("Ung\xfcltige Rollen-ID")||A?t(s):console.warn("Fehler unterdr\xfcckt, da kein Benutzer ausgew\xe4hlt ist:",s)},we=e=>{const{name:t,value:a,type:r}=e.target;let s=a;"number"===r&&(s=""===a?null:Number(a)),z((0,c.A)((0,c.A)({},C),{},{[t]:s})),D(!0)},Ne=async e=>{if(e&&A)if(1===e&&1===A.id&&E.includes(e))V("Die Admin-Rolle kann vom Admin-Benutzer nicht entfernt werden","warning");else try{console.log("Toggle Rolle:",e,"f\xfcr Benutzer:",A.id),console.log("Aktuelle ausgew\xe4hlte Rollen:",E);const t=E.includes(e),a=t?E.filter((t=>t!==e)):[...E,e];console.log("Neue ausgew\xe4hlte Rollen:",a),T(a),console.log("Sende Rollenaktualisierung an API:",{userId:A.id,roleIds:a});const r=await u.i$.updateRoles(A.id,a);console.log("API-Antwort bei Rollenaktualisierung:",r.data),await ke(A.id),V(t?"Rolle erfolgreich entfernt":"Rolle erfolgreich zugewiesen","success")}catch(t){console.error("Fehler beim Aktualisieren der Rollen:",t),ke(A.id),je(t),V("Fehler beim Aktualisieren der Rollen","error")}},Ae=async e=>{if(e&&A)try{console.log("Toggle Branch:",e,"f\xfcr Benutzer:",A.id),console.log("Aktuelle ausgew\xe4hlte Branches:",Q);const t=Q.includes(e),a=t?Q.filter((t=>t!==e)):[...Q,e];console.log("Neue ausgew\xe4hlte Branches:",a),ee(a),console.log("Sende Branch-Aktualisierung an API:",{userId:A.id,branchIds:a});const r=await u.i$.updateBranches(A.id,a);console.log("API-Antwort bei Branch-Aktualisierung:",r.data),await ke(A.id),V(t?"Branch erfolgreich entfernt":"Branch erfolgreich zugewiesen","success")}catch(t){console.error("Fehler beim Aktualisieren der Branches:",t),ke(A.id),je(t),V("Fehler beim Aktualisieren der Branches","error")}};(0,r.useEffect)((()=>{A&&(z((0,c.A)((0,c.A)({},A),{},{birthday:A.birthday?new Date(A.birthday).toISOString().split("T")[0]:null})),D(!1))}),[A]);const Se=e=>{const{name:t,value:a}=e.target;he((0,c.A)((0,c.A)({},be),{},{[t]:a}))},Ce=async e=>{if(e.preventDefault(),be.email&&be.password&&be.firstName&&be.lastName)if(be.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/))try{const e=await u.i$.create(be);if(e.data){const t=(0,c.A)((0,c.A)({},e.data),{},{active:void 0===e.data.active||e.data.active});ye((e=>[t,...e])),"active"===re&&t.active&&N((e=>[t,...e]))}V("Benutzer erfolgreich erstellt","success"),le(!1),he({email:"",password:"",firstName:"",lastName:""})}catch(s){var a,r;await fe();const e=(null===(a=s.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||"Fehler beim Erstellen des Benutzers";V(e,"error"),t(e)}else V("Ung\xfcltiges E-Mail-Format","error");else V("Bitte f\xfcllen Sie alle Felder aus","error")};return(0,F.jsxs)("div",{className:"container mx-auto px-4 pb-6",children:[(0,F.jsx)("div",{className:"mb-6",children:(0,F.jsxs)("div",{className:"flex items-start gap-4",children:[(0,F.jsx)("div",{className:"flex items-center pt-8",children:U()&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>le(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":a("users.create"),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("users.create")})]})}),(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,F.jsx)("button",{type:"button",onClick:()=>se("active"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("active"===re?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:a("users.active")}),(0,F.jsx)("button",{type:"button",onClick:()=>se("inactive"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("inactive"===re?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:a("users.inactive")})]}),(0,F.jsxs)("select",{id:"userSelect",onChange:e=>{const t=parseInt(e.target.value,10);t&&!isNaN(t)?ke(t):(S(null),z({}),T([]))},className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",children:[(0,F.jsxs)("option",{value:"",children:["-- ",a("common.select")," --"]}),w.map((e=>(0,F.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.username,")"]},e.id)))]})]})]})}),A&&(0,F.jsx)("div",{children:(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 mb-6",children:[(0,F.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,F.jsxs)("nav",{className:"flex -mb-px",children:[(0,F.jsxs)("button",{onClick:()=>ae("details"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("details"===te?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,F.jsx)(x.A,{className:"h-5 w-5 inline mr-2"}),a("users.title")]}),(0,F.jsxs)("button",{onClick:()=>ae("documents"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("documents"===te?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,F.jsx)(b.A,{className:"h-5 w-5 inline mr-2"}),a("profile.documents")]}),(0,F.jsxs)("button",{onClick:()=>ae("roles"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("roles"===te?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,F.jsx)(o.A,{className:"h-5 w-5 inline mr-2"}),a("roles.title")]}),(0,F.jsxs)("button",{onClick:()=>ae("branches"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("branches"===te?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,F.jsx)(d.A,{className:"h-5 w-5 inline mr-2"}),a("branches.title")||"Niederlassungen"]}),(0,F.jsxs)("button",{onClick:()=>ae("lifecycle"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("lifecycle"===te?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,F.jsx)(h.A,{className:"h-5 w-5 inline mr-2"}),a("lifecycle.tabTitle")]})]})}),"details"===te&&(0,F.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!A||!A.id)return t("Kein Benutzer ausgew\xe4hlt"),void V("Kein Benutzer ausgew\xe4hlt","error");try{var a,r;if(null===(a=C.username)||void 0===a||!a.trim())throw new Error("Benutzername ist erforderlich");if(null===(r=C.email)||void 0===r||!r.trim())throw new Error("E-Mail ist erforderlich");const e={username:C.username,email:C.email,bankDetails:C.bankDetails||null,gender:C.gender||null,phoneNumber:C.phoneNumber||null,language:C.language||null,hourlyRate:null===C.hourlyRate||void 0===C.hourlyRate||""===C.hourlyRate?null:"string"===typeof C.hourlyRate?C.hourlyRate:C.hourlyRate.toString(),monthlySalary:null===C.monthlySalary||void 0===C.monthlySalary||""===C.monthlySalary?null:"string"===typeof C.monthlySalary?parseFloat(C.monthlySalary):C.monthlySalary,payrollCountry:C.payrollCountry||null,contractType:C.contractType||null};console.log("Sende Daten zum Server:",e);const t=await u.i$.update(A.id,e);if(t.data){const e=(0,c.A)((0,c.A)({},t.data),{},{birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});S(e),z((0,c.A)((0,c.A)({},e),{},{birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null})),ye((t=>t.map((t=>t.id===e.id?e:t)))),ve(re,pe.map((t=>t.id===e.id?e:t))),V("Benutzerprofil erfolgreich aktualisiert","success"),D(!1)}}catch(o){var s,n;if(console.error("Fehler beim Speichern der Benutzerdaten:",o),await fe(),400===(null===(s=o.response)||void 0===s?void 0:s.status)){var l,i;const e="Validierungsfehler: ".concat((null===(l=o.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.message)||"Bitte \xfcberpr\xfcfe die eingegebenen Daten");t(e),V(e,"error")}else 404===(null===(n=o.response)||void 0===n?void 0:n.status)?(t("Benutzer wurde nicht gefunden"),V("Benutzer wurde nicht gefunden","error")):je(o)}},className:"p-6",children:[(0,F.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.username")}),(0,F.jsx)("input",{type:"text",name:"username",value:C.username||"",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.email")}),(0,F.jsx)("input",{type:"email",name:"email",value:C.email||"",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("profile.language")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("select",{name:"language",value:C.language||"es",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0,children:j.map((e=>(0,F.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),A&&(0,F.jsx)("div",{className:"sm:col-span-2",children:(0,F.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-1",children:a("profile.identificationDocument")||"Identifikationsdokument"}),(0,F.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:a("profile.uploadDocumentHint")||"Bitte laden Sie das Identifikationsdokument (C\xe9dula oder Pasaporte) hoch. Die Felder werden automatisch ausgef\xfcllt."})]}),!ge&&(0,F.jsxs)("button",{type:"button",onClick:()=>xe(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 inline mr-2"}),a("profile.uploadDocument")||"Dokument hochladen"]})]}),ge&&(0,F.jsx)("div",{className:"mt-4",children:(0,F.jsx)(k.A,{userId:A.id,onDocumentSaved:async()=>{xe(!1),await ke(A.id),V("Dokument erfolgreich hochgeladen. Felder werden automatisch ausgef\xfcllt.","success")},onCancel:()=>xe(!1)})})]})}),A.identificationDocuments&&A.identificationDocuments.length>0&&(0,F.jsx)(F.Fragment,{children:(e=>{const t=A.identificationDocuments[0];return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.firstName")}),(0,F.jsx)("input",{type:"text",value:A.firstName||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.lastName")}),(0,F.jsx)("input",{type:"text",value:A.lastName||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.birthday")}),(0,F.jsx)("input",{type:"text",value:A.birthday?new Date(A.birthday).toISOString().split("T")[0]:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.country")}),(0,F.jsx)("input",{type:"text",value:A.country?(null===(e=l.find((e=>e.code===A.country)))||void 0===e?void 0:e.name)||A.country:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.gender")}),(0,F.jsxs)("select",{name:"gender",value:C.gender||"",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"",children:a("profile.selectGender")}),(0,F.jsx)("option",{value:"male",children:a("profile.genderMale")}),(0,F.jsx)("option",{value:"female",children:a("profile.genderFemale")}),(0,F.jsx)("option",{value:"other",children:a("profile.genderOther")})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.identificationType")}),(0,F.jsx)("input",{type:"text",value:t.documentType?{passport:a("identificationDocuments.types.passport"),national_id:a("identificationDocuments.types.national_id"),driving_license:a("identificationDocuments.types.driving_license"),residence_permit:a("identificationDocuments.types.residence_permit"),work_permit:a("identificationDocuments.types.work_permit"),tax_id:a("identificationDocuments.types.tax_id"),social_security:a("identificationDocuments.types.social_security")}[t.documentType]||t.documentType:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.identificationNumber")}),(0,F.jsx)("input",{type:"text",value:A.identificationNumber||t.documentNumber||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),t.issueDate&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.identificationIssueDate")||"Ausstellungsdatum"}),(0,F.jsx)("input",{type:"text",value:new Date(t.issueDate).toISOString().split("T")[0],disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),t.expiryDate&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.identificationExpiryDate")}),(0,F.jsx)("input",{type:"text",value:new Date(t.expiryDate).toISOString().split("T")[0],disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]})]})})()}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.phoneNumber")}),(0,F.jsx)("input",{type:"tel",name:"phoneNumber",value:C.phoneNumber||"",onChange:we,placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a("profile.phoneNumberHint")})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("profile.bankDetails")}),(0,F.jsx)("input",{type:"text",name:"bankDetails",value:C.bankDetails||"",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("users.form.payrollSettings")}),(0,F.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.payrollCountry")}),(0,F.jsx)("select",{name:"payrollCountry",value:C.payrollCountry||A.payrollCountry||"CH",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:i.map((e=>(0,F.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),("CO"===C.payrollCountry||"CO"===A.payrollCountry&&!C.payrollCountry)&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("users.form.contractType")}),(0,F.jsxs)("select",{name:"contractType",value:C.contractType||"",onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"",children:"Bitte ausw\xe4hlen"}),W.map((e=>(0,F.jsx)("option",{value:e.code,children:e.name},e.code)))]})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("users.form.hourlyRate")," (","CH"===(C.payrollCountry||A.payrollCountry)?"CHF":"COP",")"]}),(0,F.jsx)("input",{type:"number",name:"hourlyRate",min:"0",step:"CH"===(C.payrollCountry||A.payrollCountry)?"0.05":"1",value:null===C.hourlyRate||void 0===C.hourlyRate?"":C.hourlyRate,onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"CH"===(C.payrollCountry||A.payrollCountry)?"z.B. 45.00":"z.B. 50000"})]}),("CO"===C.payrollCountry||"CO"===A.payrollCountry)&&"servicios_externos"!==C.contractType&&"servicios_externos"!==A.contractType&&(C.contractType||A.contractType)&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("users.form.monthlySalary")," (COP)"]}),(0,F.jsx)("input",{type:"number",name:"monthlySalary",min:"0",step:"1000",value:null===C.monthlySalary||void 0===C.monthlySalary?"":C.monthlySalary,onChange:we,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 3500000"})]})]})]}),R&&(0,F.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>{A&&z((0,c.A)((0,c.A)({},A),{},{birthday:A.birthday?new Date(A.birthday).toISOString().split("T")[0]:null})),D(!1)},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.cancel")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.save")})]})]}),(0,F.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[void 0!==A.active&&(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(A.active?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"),children:A.active?a("users.active"):a("users.inactive")}),U()&&(0,F.jsx)("button",{onClick:async()=>{if(!A||!A.id)return void V("Kein Benutzer ausgew\xe4hlt","error");const e=parseInt(localStorage.getItem("userId")||"0",10);if(A.id!==e)try{const e=void 0===A.active||A.active,t=!e;console.log("Toggle active:",{currentActiveStatus:e,newActiveStatus:t,selectedUser:A,selectedUserActive:A.active,userId:A.id});const a={active:t};console.log("Sending update payload:",a,"Type of active:",typeof t);const r=await u.i$.update(A.id,a);if(console.log("Update response:",r.data),r.data){const e=(0,c.A)((0,c.A)({},r.data),{},{active:void 0===r.data.active||r.data.active,birthday:r.data.birthday?new Date(r.data.birthday).toISOString().split("T")[0]:null});console.log("Updated user data:",e),S(e),z((0,c.A)((0,c.A)({},e),{},{birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null})),ye((t=>t.map((t=>t.id===e.id?e:t)))),ve(re,pe.map((t=>t.id===e.id?e:t))),await fe(),V(t?"Benutzer erfolgreich aktiviert":"Benutzer erfolgreich deaktiviert","success")}}catch(t){console.error("Fehler beim Aktivieren/Deaktivieren des Benutzers:",t),je(t),await fe()}else V("Du kannst dich nicht selbst deaktivieren","warning")},className:"relative group flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(A.active?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/20 dark:text-green-400 dark:hover:bg-green-900/30"),children:A.active?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(p.A,{className:"h-5 w-5"}),a("users.deactivate")]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(y.A,{className:"h-5 w-5"}),a("users.activate")]})})]})]}),"documents"===te&&(0,F.jsx)("div",{className:"p-6",children:(0,F.jsx)(v.A,{userId:A.id,isAdmin:!0})}),"roles"===te&&(0,F.jsx)("div",{className:"p-6",children:K?(0,F.jsxs)("div",{className:"mt-4 mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("roleAssignment.title")}),(0,F.jsx)("p",{className:"dark:text-gray-300",children:a("roleAssignment.loading")})]}):M.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("roleAssignment.title")}),E.some((e=>!M.some((t=>t.id===e))))&&(0,F.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,F.jsx)("p",{className:"font-bold",children:a("roleAssignment.unknownRolesWarning")}),(0,F.jsx)("p",{children:a("roleAssignment.unknownRolesMessage",{ids:E.filter((e=>!M.some((t=>t.id===e)))).join(", ")})}),(0,F.jsx)("p",{className:"mt-2 text-sm",children:a("roleAssignment.availableRoleIds",{ids:M.map((e=>e.id)).join(", ")})})]}),(0,F.jsxs)("div",{className:"mb-4",children:[(0,F.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("roleAssignment.currentRoles")}),0===E.length?(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:a("roleAssignment.noRolesAssigned")}):(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[M.filter((e=>E.includes(e.id))).map((e=>{const t=1===e.id&&A&&1===A.id;return(0,F.jsx)("div",{className:"border rounded-lg p-4 ".concat(t?"border-green-500 bg-green-50 dark:bg-green-900/20 dark:border-green-700 cursor-not-allowed":"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 cursor-pointer"),onClick:()=>!t&&Ne(e.id),children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("h4",{className:"font-medium flex items-center dark:text-white",children:[e.name,t&&(0,F.jsx)("span",{className:"ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded-full",children:a("roleAssignment.fixed")})]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,F.jsxs)("div",{className:"flex items-center ".concat(t?"text-gray-400 dark:text-gray-500":"text-blue-600 dark:text-blue-400"),children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a(t?"roleAssignment.fixedAssigned":"roleAssignment.remove")}),(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,F.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},e.id)})),E.filter((e=>!M.some((t=>t.id===e)))).map((e=>(0,F.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h4",{className:"font-medium",children:a("roleAssignment.unknownRole",{id:e})}),(0,F.jsx)("p",{className:"text-sm text-orange-600",children:a("roleAssignment.unknownRoleDescription")})]}),(0,F.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a("roleAssignment.remove")}),(0,F.jsx)("button",{onClick:()=>Ne(e),className:"focus:outline-none",children:(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,F.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},"unknown-".concat(e))))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("roleAssignment.availableRoles")}),0===M.filter((e=>!E.includes(e.id))).length?(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:a("roleAssignment.noRolesAvailable")}):(0,F.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.filter((e=>!E.includes(e.id))).map((e=>(0,F.jsx)("div",{className:"border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50",onClick:()=>Ne(e.id),children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h4",{className:"font-medium",children:e.name}),(0,F.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,F.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600",children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a("roleAssignment.add")}),(0,F.jsx)(g.A,{className:"h-5 w-5"})]})]})},e.id)))})]})]})}),"branches"===te&&(0,F.jsxs)("div",{className:"p-6",children:[X?(0,F.jsxs)("div",{className:"mt-4 mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("branchAssignment.title")||"Niederlassungszuweisung"}),(0,F.jsx)("p",{className:"dark:text-gray-300",children:a("branchAssignment.loading")||"Lade Niederlassungen..."})]}):Y.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("branchAssignment.title")||"Niederlassungszuweisung"}),Q.some((e=>!Y.some((t=>t.id===e))))&&(0,F.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,F.jsx)("p",{className:"font-bold",children:a("branchAssignment.unknownBranchesWarning")||"Unbekannte Niederlassungen zugewiesen"}),(0,F.jsx)("p",{children:a("branchAssignment.unknownBranchesMessage",{ids:Q.filter((e=>!Y.some((t=>t.id===e)))).join(", ")})||"Die folgenden Niederlassungs-IDs sind zugewiesen, aber nicht verf\xfcgbar: ".concat(Q.filter((e=>!Y.some((t=>t.id===e)))).join(", "))}),(0,F.jsx)("p",{className:"mt-2 text-sm",children:a("branchAssignment.availableBranchIds",{ids:Y.map((e=>e.id)).join(", ")})||"Verf\xfcgbare Niederlassungs-IDs: ".concat(Y.map((e=>e.id)).join(", "))})]}),(0,F.jsxs)("div",{className:"mb-4",children:[(0,F.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("branchAssignment.currentBranches")||"Aktuell zugewiesene Niederlassungen"}),0===Q.length?(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:a("branchAssignment.noBranchesAssigned")||"Keine Niederlassungen zugewiesen"}):(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Y.filter((e=>Q.includes(e.id))).map((e=>(0,F.jsx)("div",{className:"border border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 rounded-lg p-4 cursor-pointer",onClick:()=>Ae(e.id),children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsx)("div",{children:(0,F.jsx)("h4",{className:"font-medium dark:text-white",children:e.name})}),(0,F.jsxs)("div",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a("branchAssignment.remove")||"Entfernen"}),(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,F.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},e.id))),Q.filter((e=>!Y.some((t=>t.id===e)))).map((e=>(0,F.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h4",{className:"font-medium",children:a("branchAssignment.unknownBranch",{id:e})||"Unbekannte Niederlassung (ID: ".concat(e,")")}),(0,F.jsx)("p",{className:"text-sm text-orange-600",children:a("branchAssignment.unknownBranchDescription")||"Diese Niederlassung existiert nicht mehr oder ist nicht verf\xfcgbar."})]}),(0,F.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a("branchAssignment.remove")||"Entfernen"}),(0,F.jsx)("button",{onClick:()=>Ae(e),className:"focus:outline-none",children:(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,F.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},"unknown-".concat(e))))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("branchAssignment.availableBranches")||"Verf\xfcgbare Niederlassungen"}),0===Y.filter((e=>!Q.includes(e.id))).length?(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:a("branchAssignment.noBranchesAvailable")||"Keine weiteren Niederlassungen verf\xfcgbar"}):(0,F.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.filter((e=>!Q.includes(e.id))).map((e=>(0,F.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20",onClick:()=>Ae(e.id),children:(0,F.jsxs)("div",{className:"flex justify-between items-center",children:[(0,F.jsx)("div",{children:(0,F.jsx)("h4",{className:"font-medium dark:text-white",children:e.name})}),(0,F.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600 dark:hover:text-blue-400",children:[(0,F.jsx)("span",{className:"mr-2 text-sm",children:a("branchAssignment.add")||"Hinzuf\xfcgen"}),(0,F.jsx)(g.A,{className:"h-5 w-5"})]})]})},e.id)))})]})]}),!X&&0===Y.length&&(0,F.jsxs)("div",{className:"mt-4 mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:a("branchAssignment.title")||"Niederlassungszuweisung"}),(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:a("branchAssignment.noBranchesFound")||"Keine Niederlassungen gefunden"})]})]}),"lifecycle"===te&&A&&(0,F.jsx)("div",{className:"p-6",children:(0,F.jsx)(G,{userId:A.id,userName:"".concat(A.firstName," ").concat(A.lastName)},"lifecycle-".concat(A.id,"-").concat(I))})]})}),ne&&(0,F.jsx)(F.Fragment,{children:ie?(0,F.jsxs)(m.lG,{open:ne,onClose:()=>le(!1),className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:a("organisation.createUser.title")}),(0,F.jsx)("button",{onClick:()=>le(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]})}),(0,F.jsxs)("form",{onSubmit:Ce,className:"p-6",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.email")," *"]}),(0,F.jsx)("input",{type:"email",name:"email",value:be.email,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.password")," *"]}),(0,F.jsx)("input",{type:"password",name:"password",value:be.password,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.firstName")," *"]}),(0,F.jsx)("input",{type:"text",name:"firstName",value:be.firstName,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.lastName")," *"]}),(0,F.jsx)("input",{type:"text",name:"lastName",value:be.lastName,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,F.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>le(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.cancel")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("organisation.createUser.create")})]})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[ne&&!de&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:ne?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(ne?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:ne?"auto":"none"},"aria-hidden":!ne,role:"dialog","aria-modal":ne,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:a("organisation.createUser.title")}),(0,F.jsx)("button",{onClick:()=>le(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsx)("div",{className:"flex flex-col flex-1 min-h-0",children:(0,F.jsxs)("form",{onSubmit:Ce,className:"flex flex-col flex-1 min-h-0",children:[(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0 space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.email")," *"]}),(0,F.jsx)("input",{type:"email",name:"email",value:be.email,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.password")," *"]}),(0,F.jsx)("input",{type:"password",name:"password",value:be.password,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.firstName")," *"]}),(0,F.jsx)("input",{type:"text",name:"firstName",value:be.firstName,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a("organisation.createUser.lastName")," *"]}),(0,F.jsx)("input",{type:"text",name:"lastName",value:be.lastName,onChange:Se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,F.jsxs)("div",{className:"flex justify-end gap-3 border-t dark:border-gray-700 pt-4 px-4 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>le(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.cancel")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("organisation.createUser.create")})]})]})]})})]})]})})]})};var K=a(3744),J=a(9248),Y=a(2517),Z=a(8010),X=a(4426),$=a(7829),Q=a(6507),ee=a(5365);const te=["dashboard","worktracker","cerebro","settings","profile"],ae=["dashboard","worktracker","consultations","team_worktime_control","payroll","organization_management","cerebro","settings","profile"],re=["requests","tasks","users","roles","organization","organization_join_requests","organization_users","team_worktime","worktime","clients","consultation_invoices","branches","notifications","settings","monthly_reports"],se=["database_reset_table","database_logs","invoice_create","invoice_download","invoice_mark_paid","invoice_settings","todo_create","todo_edit","todo_delete","task_create","task_edit","task_delete","user_create","user_edit","user_delete","role_assign","role_create","role_edit","role_delete","organization_create","organization_edit","organization_delete","worktime_start","worktime_stop","worktime_edit","worktime_delete","cerebro","consultation_start","consultation_stop","consultation_edit","client_create","client_edit","client_delete","settings_system","settings_notifications","settings_profile","payroll_generate","payroll_export","payroll_edit"],ne={requests:"dashboard",tasks:"worktracker",users:"organization_management",roles:"organization_management",organization:"organization_management",organization_join_requests:"organization_management",organization_users:"organization_management",team_worktime:"team_worktime_control",worktime:"worktracker",clients:"consultations",consultation_invoices:"consultations",branches:"settings",notifications:"general",settings:"settings",monthly_reports:"consultations"},le={database_reset_table:"settings",database_logs:"settings",invoice_create:"consultations",invoice_download:"consultations",invoice_mark_paid:"consultations",invoice_settings:"consultations",todo_create:"worktracker",todo_edit:"worktracker",todo_delete:"worktracker",task_create:"worktracker",task_edit:"worktracker",task_delete:"worktracker",user_create:"organization_management",user_edit:"organization_management",user_delete:"organization_management",role_assign:"organization_management",role_create:"organization_management",role_edit:"organization_management",role_delete:"organization_management",organization_create:"organization_management",organization_edit:"organization_management",organization_delete:"organization_management",worktime_start:"worktracker",worktime_stop:"worktracker",worktime_edit:"worktracker",worktime_delete:"worktracker",cerebro:"cerebro",consultation_start:"consultations",consultation_stop:"consultations",consultation_edit:"consultations",client_create:"consultations",client_edit:"consultations",client_delete:"consultations",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",payroll_generate:"payroll",payroll_export:"payroll",payroll_edit:"payroll"},ie={worktime_start:"worktime",worktime_stop:"worktime",worktime_edit:"worktime",worktime_delete:"worktime",task_create:"tasks",task_edit:"tasks",task_delete:"tasks",todo_create:"tasks",todo_edit:"tasks",todo_delete:"tasks",client_create:"clients",client_edit:"clients",client_delete:"clients",consultation_start:"clients",consultation_stop:"clients",consultation_edit:"clients",invoice_create:"consultation_invoices",invoice_download:"consultation_invoices",invoice_mark_paid:"consultation_invoices",invoice_settings:"consultation_invoices",user_create:"users",user_edit:"users",user_delete:"users",role_assign:"roles",role_create:"roles",role_edit:"roles",role_delete:"roles",organization_create:"organization",organization_edit:"organization",organization_delete:"organization",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",database_reset_table:null,database_logs:null,cerebro:null,payroll_generate:null,payroll_export:null,payroll_edit:null},oe="roles-table",de=[1,2,999],ce=["Admin","User","Hamburger"],me=(e,t)=>!!de.includes(e)||!(!t||!ce.includes(t)),ue=e=>{let{role:t,onEdit:a,onDelete:r,onCopy:n,canEdit:l,canDelete:i,canCopy:o}=e;const{t:d}=(0,s.Bd)();return(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:[(0,F.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,F.jsxs)("div",{className:"flex space-x-2",children:[o&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>n(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,F.jsx)(K.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.copy")})]}),l&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>a(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,F.jsx)(S.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.edit")})]}),i&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>r(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",children:(0,F.jsx)(J.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.delete")})]})]})]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description||d("roles.noDescription")}),(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.allBranches?(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",children:d("roles.form.allBranches")||"Alle Branches"}):t.branches&&t.branches.length>0?(0,F.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",children:[t.branches.length," ",d("roles.form.specificBranches")||"Branches"]}):(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:d("roles.form.noBranches")||"Keine Branches"})})}),(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:[d("roles.permissions"),":"]}),(0,F.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.permissions.filter((e=>"none"!==e.accessLevel)).slice(0,8).map((e=>(0,F.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:[e.entity,": ",e.accessLevel]},"".concat(e.entity,"-").concat(e.entityType)))),t.permissions.filter((e=>"none"!==e.accessLevel)).length>8&&(0,F.jsxs)("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:["+",t.permissions.filter((e=>"none"!==e.accessLevel)).length-8," ",d("common.showMore")]})]})]})]})},ge=e=>{let{onRolesChange:t,onError:a,readOnly:l=!1}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,r.useState)(!1),[x,b]=(0,r.useState)(null),[h,f]=(0,r.useState)([]),[v,k]=(0,r.useState)(!0),N=(0,r.useMemo)((()=>({dashboard:i("roles.pages.dashboard"),worktracker:i("roles.pages.worktracker"),consultations:i("roles.pages.consultations"),team_worktime_control:i("roles.pages.team_worktime_control"),payroll:i("roles.pages.payroll"),organization_management:i("roles.pages.organization_management"),cerebro:i("roles.pages.cerebro"),settings:i("roles.pages.settings"),profile:i("roles.pages.profile")})),[i]),A=(0,r.useMemo)((()=>({tasks:i("roles.tables.tasks"),worktime:i("roles.tables.worktime"),users:i("roles.tables.users"),roles:i("roles.tables.roles"),organization:i("roles.tables.organization"),organization_join_requests:i("roles.tables.organization_join_requests"),organization_users:i("roles.tables.organization_users"),clients:i("roles.tables.clients"),consultation_invoices:i("roles.tables.consultation_invoices"),requests:i("roles.tables.requests"),team_worktime:i("roles.tables.team_worktime"),settings:i("roles.tables.settings"),notifications:i("roles.tables.notifications"),branches:i("roles.tables.branches"),monthly_reports:i("roles.tables.monthly_reports")})),[i]),S=(0,r.useMemo)((()=>({worktime_start:i("roles.buttons.worktime_start"),worktime_stop:i("roles.buttons.worktime_stop"),worktime_edit:i("roles.buttons.worktime_edit"),worktime_delete:i("roles.buttons.worktime_delete"),task_create:i("roles.buttons.task_create"),task_edit:i("roles.buttons.task_edit"),task_delete:i("roles.buttons.task_delete"),todo_create:i("roles.buttons.todo_create"),todo_edit:i("roles.buttons.todo_edit"),todo_delete:i("roles.buttons.todo_delete"),client_create:i("roles.buttons.client_create"),client_edit:i("roles.buttons.client_edit"),client_delete:i("roles.buttons.client_delete"),consultation_start:i("roles.buttons.consultation_start"),consultation_stop:i("roles.buttons.consultation_stop"),consultation_edit:i("roles.buttons.consultation_edit"),invoice_create:i("roles.buttons.invoice_create"),invoice_download:i("roles.buttons.invoice_download"),invoice_mark_paid:i("roles.buttons.invoice_mark_paid"),invoice_settings:i("roles.buttons.invoice_settings"),user_create:i("roles.buttons.user_create"),user_edit:i("roles.buttons.user_edit"),user_delete:i("roles.buttons.user_delete"),role_assign:i("roles.buttons.role_assign"),role_create:i("roles.buttons.role_create"),role_edit:i("roles.buttons.role_edit"),role_delete:i("roles.buttons.role_delete"),organization_create:i("roles.buttons.organization_create"),organization_edit:i("roles.buttons.organization_edit"),organization_delete:i("roles.buttons.organization_delete"),settings_system:i("roles.buttons.settings_system"),settings_notifications:i("roles.buttons.settings_notifications"),settings_profile:i("roles.buttons.settings_profile"),database_reset_table:i("roles.buttons.database_reset_table"),database_logs:i("roles.buttons.database_logs"),payroll_generate:i("roles.buttons.payroll_generate"),payroll_export:i("roles.buttons.payroll_export"),payroll_edit:i("roles.buttons.payroll_edit"),cerebro:i("roles.buttons.cerebro")})),[i]),[C,z]=(0,r.useState)({name:"",description:"",permissions:[...ae.map((e=>({entity:e,entityType:"page",accessLevel:"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...se.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]}),[R,D]=(0,r.useState)(null),{hasPermission:E}=(0,n.S)(),[T,I]=(0,r.useState)(""),[P,_]=(0,r.useState)(!1),[O,B]=(0,r.useState)(!0),[q,V]=(0,r.useState)([]),[U,M]=(0,r.useState)([]),[G,W]=(0,r.useState)(!1),[H,K]=(0,r.useState)([]),[J,de]=(0,r.useState)([]),[ce,ge]=(0,r.useState)("Alle"),[xe,be]=(0,r.useState)(null),[he,pe]=(0,r.useState)(window.innerWidth<640),[ye,fe]=(0,r.useState)(window.innerWidth>1070),{openSidepane:ve,closeSidepane:ke}=(0,L.N)(),{handleError:je,handleValidationError:we}=(0,Q.qz)(),[Ne,Ae]=(0,r.useState)(!1),[Se,Ce]=(0,r.useState)(null),[ze,Re]=(0,r.useState)(10);(0,r.useEffect)((()=>{const e=()=>{pe(window.innerWidth<640),fe(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(o?ve():ke(),()=>{ke()})),[o,ve,ke]);const De=(0,r.useCallback)((async()=>{W(!0);try{const e=await u.H_.getAll();M(e.data)}catch(R){console.error("Fehler beim Laden der Branches:",R)}finally{W(!1)}}),[]),Ee=(0,r.useCallback)((async()=>{k(!0),console.log("DEBUGAUSGABE: Hole Rollen vom Server...");try{const e=await u.Zj.getAll();console.log("DEBUGAUSGABE: Rollen erfolgreich geholt:",e.data),f(e.data),D(null)}catch(R){console.error("DEBUGAUSGABE: Fehler beim Abrufen der Rollen:",R),je(R,{component:"RoleManagementTab",action:"fetchRoles"}),a&&a("Fehler beim Laden der Rollen")}finally{k(!1)}}),[je,a]);(0,r.useEffect)((()=>{Ee()}),[Ee]),(0,r.useEffect)((()=>{o&&De()}),[o,De]);const Le=async e=>{if(e.preventDefault(),D(null),O||0!==q.length)if(C.name){if(x){const e=C.permissions.map((e=>"page"===e.entityType&&te.includes(e.entity)?(0,c.A)((0,c.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));if(!x.id||isNaN(x.id))return console.warn("DEBUGAUSGABE: Ung\xfcltige Rollen-ID erkannt, Bearbeitung abgebrochen"),void je("Ung\xfcltige Rollen-ID, Bearbeitung abgebrochen",{component:"RoleManagementTab",roleId:x.id});if(me(x.id,x.name))return console.warn("DEBUGAUSGABE: Versuch, gesch\xfctzte Rolle mit ID ".concat(x.id," zu bearbeiten")),je({message:"Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",name:"PermissionError"},{component:"RoleManagementTab",roleId:x.id,category:ee.h.PERMISSION}),void d(!1);if(!h.some((e=>e.id===x.id)))return console.error("DEBUGAUSGABE: Rolle mit ID ".concat(x.id," existiert nicht in der aktuellen Liste")),je("Rolle mit ID ".concat(x.id," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:x.id}),d(!1),void await Ee();console.log("DEBUGAUSGABE: Bearbeite Rolle mit ID ".concat(x.id));try{console.log("DEBUGAUSGABE: Sende Aktualisierung an API:",{name:C.name,description:C.description,permissions:e});const t={name:C.name,description:C.description,permissions:e,allBranches:O,branchIds:O?[]:q};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.update");const a=await u.Zj.update(x.id,t);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.update"),console.log("DEBUGAUSGABE: API-Antwort bei Rollenaktualisierung:",a),await Ee()}catch(a){return console.error("DEBUGAUSGABE: Fehler bei Rollenaktualisierung:",a),void(a.response?a.response.data.meta&&"Record to update not found."===a.response.data.meta.cause?(je("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:x.id}),d(!1),await Ee()):je(a.response.data.message||"Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:x.id}):je("Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:x.id}))}}else try{const e=C.permissions.map((e=>"page"===e.entityType&&te.includes(e.entity)?(0,c.A)((0,c.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));console.log("DEBUGAUSGABE: Sende Daten an API f\xfcr neue Rolle:",{name:C.name,description:C.description,permissions:e});const t={name:C.name,description:C.description,permissions:e,allBranches:O,branchIds:O?[]:q};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.create");const a=await u.Zj.create(t);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.create"),console.log("DEBUGAUSGABE: API-Antwort beim Erstellen der Rolle:",a),await Ee()}catch(r){return console.error("DEBUGAUSGABE: Fehler bei API-Anfrage zum Erstellen der Rolle:",r),void(r.response?je(r.response.data.message||"Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}):je("Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}))}t&&t(),d(!1),Pe()}else we("Rollenname darf nicht leer sein",{name:"Rollenname ist erforderlich"});else je(i("roles.form.branchSelectionRequired")||'Bitte w\xe4hlen Sie mindestens eine Branch aus oder aktivieren Sie "F\xfcr alle Branches g\xfcltig"',{component:"RoleManagementTab"})},Fe=async e=>{if(!e||isNaN(e))return console.warn("Ung\xfcltige Rollen-ID erkannt, L\xf6schvorgang abgebrochen"),void je("Ung\xfcltige Rollen-ID, L\xf6schvorgang abgebrochen",{component:"RoleManagementTab",roleId:e});const a=h.find((t=>t.id===e));if(a&&me(e,a.name))return console.warn("Versuch, gesch\xfctzte Rolle mit ID ".concat(e," (").concat(a.name,") zu l\xf6schen")),void je("Gesch\xfctzte Systemrollen k\xf6nnen nicht gel\xf6scht werden",{component:"RoleManagementTab",roleId:e});if(window.confirm("M\xf6chten Sie diese Rolle wirklich l\xf6schen?"))try{console.log("Starte L\xf6schvorgang f\xfcr Rolle mit ID ".concat(e));if(!h.some((t=>t.id===e)))return console.error("Rolle mit ID ".concat(e," existiert nicht in der aktuellen Liste")),je("Rolle mit ID ".concat(e," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:e}),void await Ee();console.log("Sende L\xf6schanfrage an API");try{const t=await u.Zj.delete(e);console.log("API-Antwort beim L\xf6schen der Rolle:",t),await Ee(),console.log("Rollenliste nach L\xf6schen aktualisiert")}catch(r){return console.error("API-Fehler beim L\xf6schen der Rolle:",r),void(r.response?(console.error("API-Fehlerdaten:",r.response.data),r.response.data.meta&&"Record to delete does not exist."===r.response.data.meta.cause?(je("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:e}),await Ee()):je(r.response.data.message||i("roleManagement.deleteError"),{component:"RoleManagementTab",roleId:e})):je(i("roleManagement.networkError"),{component:"RoleManagementTab",roleId:e}))}console.log("Rolle erfolgreich gel\xf6scht"),t&&t()}catch(s){console.error(i("roleManagement.unhandledError"),s),je(s);try{await Ee()}catch(n){console.error("Fehler beim Aktualisieren der Rollenliste nach fehlgeschlagenem L\xf6schvorgang:",n)}}},Te=async e=>{try{if(!e||!e.id)return void je("Ung\xfcltige Rolle zum Kopieren",{component:"RoleManagementTab"});const a={name:"".concat(e.name,"-Kopie"),description:e.description||"",permissions:e.permissions.filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})))};console.log("DEBUGAUSGABE: Kopiere Rolle:",e.name,"mit Daten:",a);const r=await u.Zj.create(a);console.log("DEBUGAUSGABE: Rolle erfolgreich kopiert:",r.data),f((e=>[r.data,...e])),Ie(r.data),t&&t()}catch(a){console.error("DEBUGAUSGABE: Fehler beim Kopieren der Rolle:",a),je(a,{component:"RoleManagementTab",roleId:e.id})}},Ie=async e=>{if(me(e.id,e.name))return void je("Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",{component:"RoleManagementTab",roleId:e.id});const t=[...ae.map((e=>({entity:e,entityType:"page",accessLevel:te.includes(e)?"both":"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...se.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))];if(e.permissions.forEach((e=>{const a=t.findIndex((t=>t.entity===e.entity&&t.entityType===e.entityType));-1!==a&&("page"===e.entityType&&te.includes(e.entity)?t[a].accessLevel="both":t[a].accessLevel=e.accessLevel)})),z({name:e.name,description:e.description||"",permissions:t}),e.id)try{var a;const t=(await u.Zj.getRoleBranches(e.id)).data;B(t.allBranches||!1),V((null===(a=t.branches)||void 0===a?void 0:a.map((e=>e.id)))||[])}catch(R){console.error("Fehler beim Laden der Branch-Zuweisungen:",R),B(!0),V([])}b(e),d(!0)},Pe=()=>{b(null),B(!0),V([]),z({name:"",description:"",permissions:[...ae.map((e=>({entity:e,entityType:"page",accessLevel:te.includes(e)?"both":"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...se.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]})},_e=e=>{const t=[...C.permissions];C.permissions.filter((e=>"page"===e.entityType&&!te.includes(e.entity))).forEach((a=>{const r=C.permissions.indexOf(a);t[r]=(0,c.A)((0,c.A)({},a),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},Oe=e=>{const t=[...C.permissions];C.permissions.filter((e=>"table"===e.entityType)).forEach((a=>{const r=C.permissions.indexOf(a);t[r]=(0,c.A)((0,c.A)({},a),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},Be=e=>{const t=[...C.permissions];C.permissions.filter((e=>"button"===e.entityType)).forEach((a=>{const r=C.permissions.indexOf(a);t[r]=(0,c.A)((0,c.A)({},a),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},qe=()=>H.length,Ve=(0,r.useMemo)((()=>h.filter((e=>{if(T){const t=T.toLowerCase();if(!(e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)))return!1}if(H.length>0){let t=H.length>0;for(let a=0;a<H.length;a++){const r=H[a];let s=!1;switch(r.column){case"name":"equals"===r.operator?s=e.name.toLowerCase()===(r.value||"").toLowerCase():"contains"===r.operator?s=e.name.toLowerCase().includes((r.value||"").toLowerCase()):"startsWith"===r.operator&&(s=e.name.toLowerCase().startsWith((r.value||"").toLowerCase()));break;case"description":if(!e.description){s=!1;break}"equals"===r.operator?s=e.description.toLowerCase()===(r.value||"").toLowerCase():"contains"===r.operator?s=e.description.toLowerCase().includes((r.value||"").toLowerCase()):"startsWith"===r.operator&&(s=e.description.toLowerCase().startsWith((r.value||"").toLowerCase()));break;case"permissions":const t=r.value,a=e.permissions.filter((e=>e.accessLevel===t)).length;("greaterThan"===r.operator||"equals"===r.operator)&&(s=a>0)}if(0===a)t=s;else{t="AND"===J[a-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.localeCompare(t.name)))),[h,T,H,J]);(0,r.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(oe))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:oe,name:"Alle",conditions:[],operators:[]};await j.A.post(w.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Rollen erstellt")}}catch(R){console.error("Fehler beim Erstellen der Standard-Filter:",R)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{try{const e=await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(oe)),t=e.data.find((e=>"Alle"===e.name));t&&(ge("Alle"),be(t.id),Ue(t.conditions,t.operators))}catch(R){console.error("Fehler beim Setzen des initialen Filters:",R)}})()}),[]);const Ue=(e,t)=>{K(e),de(t)},Me=()=>{K([]),de([]),ge(""),be(null)};return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("div",{className:"flex items-center",children:!l&&E("roles","write","table")&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>d(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":i("roles.createRole"),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.createRole")})]})}),(0,F.jsx)("div",{}),(0,F.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,F.jsx)("input",{type:"text",placeholder:"Suchen...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:T,onChange:e=>I(e.target.value)}),(0,F.jsxs)("div",{className:"relative group ml-1",children:[(0,F.jsxs)("button",{className:"p-2 rounded-md ".concat(qe()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"),onClick:()=>_(!P),children:[(0,F.jsx)(Z.A,{className:"w-5 h-5"}),qe()>0&&(0,F.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:qe()})]}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Filter"})]})]})]}),P&&(0,F.jsx)(X.A,{columns:[{id:"name",label:"Name"},{id:"description",label:"Beschreibung"},{id:"permissions",label:"Berechtigungen"}],onApply:Ue,onReset:Me,savedConditions:H,savedOperators:J,tableId:oe}),(0,F.jsx)($.A,{tableId:oe,onSelectFilter:Ue,onReset:Me,activeFilterName:ce,selectedFilterId:xe,onFilterChange:(e,t,a,r)=>{ge(e),be(t),Ue(a,r)},defaultFilterName:"Alle"}),v?(0,F.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===h.length?(0,F.jsx)("div",{className:"p-4 bg-gray-50 rounded text-center",children:(0,F.jsx)("p",{children:"Keine Rollen gefunden. Erstellen Sie eine neue Rolle mit dem Button oben."})}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"space-y-4",children:Ve.slice(0,ze).map((e=>(0,F.jsx)(ue,{role:e,onEdit:Ie,onDelete:Fe,onCopy:Te,canEdit:!l&&E("roles","write","table")&&!me(e.id,e.name),canDelete:!l&&E("roles","write","table")&&!me(e.id,e.name),canCopy:!l&&E("roles","write","table")&&me(e.id,e.name)},e.id)))}),Ve.length>ze&&(0,F.jsx)("div",{className:"mt-4 flex justify-center",children:(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{className:"p-2 text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>Re((e=>e+10)),children:(0,F.jsx)(Y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Mehr anzeigen (".concat(Ve.length-ze," verbleibend)")})]})})]})]}),o&&(0,F.jsx)(F.Fragment,{children:he?(0,F.jsxs)(m.lG,{open:o,onClose:()=>d(!1),className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,F.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i(x?"roles.editRole":"roles.createRole")}),(0,F.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]})}),(0,F.jsxs)("form",{onSubmit:Le,className:"flex flex-col flex-1 min-h-0",children:[(0,F.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,F.jsxs)("div",{className:"p-6 space-y-5",children:[(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,F.jsx)("input",{type:"text",value:C.name,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Beschreibung"}),(0,F.jsx)("input",{type:"text",value:C.description,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.branchAssignment")||"Branch-Zuweisung"}),(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",checked:O,onChange:e=>{B(e.target.checked),e.target.checked&&V([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("roles.form.allBranches")||"F\xfcr alle Branches g\xfcltig"})]}),!O&&(0,F.jsxs)("div",{className:"ml-6",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.specificBranches")||"Spezifische Branches:"}),G?(0,F.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Branches..."}):0===U.length?(0,F.jsx)("div",{className:"text-sm text-gray-500",children:"Keine Branches verf\xfcgbar"}):(0,F.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:U.map((e=>(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",checked:q.includes(e.id),onChange:t=>{t.target.checked?V([...q,e.id]):V(q.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]})]})]}),(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.detailedPermissions")}),(0,F.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>_e("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:i("roles.form.pagesChecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.activateAllPages")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>_e("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:i("roles.form.pagesUnchecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.deactivateAllPages")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Oe("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",children:i("roles.form.tablesChecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.activateAllTables")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Oe("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:i("roles.form.tablesUnchecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.deactivateAllTables")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Be("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",children:i("roles.form.buttonsChecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.activateAllButtons")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Be("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:i("roles.form.buttonsUnchecked")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.form.deactivateAllButtons")})]})]})]}),(0,F.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600",children:C.permissions.filter((e=>"page"===e.entityType)).map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel;return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:N[e.entity]||e.entity}),(0,F.jsxs)("label",{className:"inline-flex items-center ".concat(te.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,disabled:te.includes(e.entity),onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-11 h-6 ".concat(te.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"," peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"),children:te.includes(e.entity)&&(0,F.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),C.permissions.filter((t=>"table"===t.entityType&&ne[t.entity]===e.entity)).sort(((e,t)=>{const a=A[e.entity]||e.entity,r=A[t.entity]||t.entity,s=["users","roles","organization"],n=s.indexOf(e.entity),l=s.indexOf(t.entity);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:a.localeCompare(r)})).map(((t,a)=>{const r=C.permissions.indexOf(t),s="both"===t.accessLevel,n=t.entity,l=A[n]||n,o=C.permissions.filter((t=>"button"===t.entityType&&le[t.entity]===e.entity&&ie[t.entity]===n&&!("tasks"===n&&t.entity.startsWith("todo_")))).sort(((e,t)=>{const a=S[e.entity]||e.entity,r=S[t.entity]||t.entity,s=[i("roleManagement.buttonOrder.start"),i("roleManagement.buttonOrder.stop"),i("roleManagement.buttonOrder.create"),i("roleManagement.buttonOrder.edit"),i("roleManagement.buttonOrder.delete")],n=s.indexOf(a),l=s.indexOf(r);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:a.localeCompare(r)}));return(0,F.jsxs)("div",{className:"mt-3",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,F.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...C.permissions];e[r]=(0,c.A)((0,c.A)({},t),{},{accessLevel:s?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:e}))}}),(0,F.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),o.map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,F.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,F.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-".concat(e.entity,"-").concat(t))}))]},"table-permission-".concat(n,"-").concat(a))})),C.permissions.filter((t=>"button"===t.entityType&&le[t.entity]===e.entity&&!ie[t.entity])).sort(((e,t)=>{const a=S[e.entity]||e.entity,r=S[t.entity]||t.entity;return a.localeCompare(r)})).map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,F.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,F.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-".concat(e.entity,"-").concat(t))}))]},"permission-page-".concat(e.entity,"-").concat(t))}))})]})]})}),(0,F.jsxs)("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-end gap-2 border-t dark:border-gray-600 flex-shrink-0",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x?"Aktualisieren":"Erstellen"})]})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[o&&!ye&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:o?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(o?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:o?"auto":"none"},"aria-hidden":!o,role:"dialog","aria-modal":o,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:x?"Rolle bearbeiten":"Neue Rolle erstellen"}),(0,F.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,F.jsxs)("form",{onSubmit:Le,className:"space-y-5",children:[(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.name")}),(0,F.jsx)("input",{type:"text",value:C.name,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.description")}),(0,F.jsx)("input",{type:"text",value:C.description,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Detaillierte Berechtigungen"}),(0,F.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>_e("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:"Seiten \u2713"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Seiten aktivieren"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>_e("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:"Seiten \u2717"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Seiten deaktivieren"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Oe("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",children:"Tabellen \u2713"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Tabellen aktivieren"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Oe("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:"Tabellen \u2717"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Tabellen deaktivieren"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Be("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",children:"Buttons \u2713"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Buttons aktivieren"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>Be("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",children:"Buttons \u2717"}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Alle Buttons deaktivieren"})]})]})]}),(0,F.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600 max-h-[60vh]",children:C.permissions.filter((e=>"page"===e.entityType)).map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel;return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:N[e.entity]||e.entity}),(0,F.jsxs)("label",{className:"inline-flex items-center ".concat(te.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,disabled:te.includes(e.entity),onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-11 h-6 ".concat(te.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"," peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"),children:te.includes(e.entity)&&(0,F.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),C.permissions.filter((t=>"table"===t.entityType&&ne[t.entity]===e.entity)).sort(((e,t)=>{const a=A[e.entity]||e.entity,r=A[t.entity]||t.entity;return a.localeCompare(r)})).map(((t,a)=>{const r=C.permissions.indexOf(t),s="both"===t.accessLevel,n=t.entity,l=A[n]||n,o=C.permissions.filter((t=>"button"===t.entityType&&le[t.entity]===e.entity&&ie[t.entity]===n&&!("tasks"===n&&t.entity.startsWith("todo_")))).sort(((e,t)=>{const a=S[e.entity]||e.entity,r=S[t.entity]||t.entity,s=[i("roleManagement.buttonOrder.start"),i("roleManagement.buttonOrder.stop"),i("roleManagement.buttonOrder.create"),i("roleManagement.buttonOrder.edit"),i("roleManagement.buttonOrder.delete")],n=s.indexOf(a),l=s.indexOf(r);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:a.localeCompare(r)}));return(0,F.jsxs)("div",{className:"mt-3",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,F.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...C.permissions];e[r]=(0,c.A)((0,c.A)({},t),{},{accessLevel:s?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:e}))}}),(0,F.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),o.map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,F.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,F.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-desktop-".concat(e.entity,"-").concat(t))}))]},"table-permission-desktop-".concat(n,"-").concat(a))})),C.permissions.filter((t=>"button"===t.entityType&&le[t.entity]===e.entity&&!ie[t.entity])).sort(((e,t)=>{const a=S[e.entity]||e.entity,r=S[t.entity]||t.entity;return a.localeCompare(r)})).map(((e,t)=>{const a=C.permissions.indexOf(e),r="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,F.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,F.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,F.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:r,onChange:()=>{const t=[...C.permissions];t[a]=(0,c.A)((0,c.A)({},e),{},{accessLevel:r?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,F.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-desktop-".concat(e.entity,"-").concat(t))}))]},"permission-page-desktop-".concat(e.entity,"-").concat(t))}))})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x?"Aktualisieren":"Erstellen"})]})]})]})})]})]})})]})},xe=e=>{let{branch:t,onEdit:a,onDelete:r,canEdit:n,canDelete:l}=e;const{t:i}=(0,s.Bd)();return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:(0,F.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,F.jsxs)("div",{className:"flex space-x-2",children:[n&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>a(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,F.jsx)(S.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.edit",{defaultValue:"Bearbeiten"})})]}),l&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>r(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",children:(0,F.jsx)(J.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.delete",{defaultValue:"L\xf6schen"})})]})]})]})})},be="branches-table",he=e=>{let{onError:t}=e;const{t:a}=(0,s.Bd)(),[l,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),[u,x]=(0,r.useState)([]),[b,h]=(0,r.useState)(!0),[f,v]=(0,r.useState)({name:"",whatsappSettings:{provider:"whatsapp-business-api",apiKey:"",apiSecret:"",phoneNumberId:"",ai:{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}}}),[k,N]=(0,r.useState)({}),[A,S]=(0,r.useState)(""),[C,z]=(0,r.useState)(!1),[R,D]=(0,r.useState)([]),[E,T]=(0,r.useState)([]),[I,P]=(0,r.useState)(""),[_,O]=(0,r.useState)(null),[B,q]=(0,r.useState)(10),{hasPermission:V}=(0,n.S)(),{openSidepane:U,closeSidepane:M}=(0,L.N)(),G=V("branches","write","table"),W=V("branches","write","table"),H=V("branches","write","table"),K=(0,r.useCallback)((async()=>{h(!0);try{const e=await j.A.get(w.Sn.BRANCHES.BASE);x(e.data)}catch(s){var e,r;console.error("Fehler beim Laden der Niederlassungen:",s);const n=(null===(e=s.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||a("branches.loadError");t(n)}finally{h(!1)}}),[t]);(0,r.useEffect)((()=>{K()}),[K]),(0,r.useEffect)((()=>(l?U():M(),()=>{M()})),[l,U,M]);const J=()=>{v({name:"",whatsappSettings:{provider:"whatsapp-business-api",apiKey:"",apiSecret:"",phoneNumberId:"",ai:{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}}}),d(null)},Y=async e=>{d(e);const t=e.whatsappSettings||{};v({name:e.name,whatsappSettings:{provider:t.provider||"whatsapp-business-api",apiKey:t.apiKey||"",apiSecret:t.apiSecret||"",phoneNumberId:t.phoneNumberId||"",ai:t.ai||{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}}}),i(!0)},Q=()=>{i(!1),J()},ee=async e=>{if(e.preventDefault(),f.name.trim())try{o?await j.A.put(w.Sn.BRANCHES.UPDATE(o.id),{name:f.name.trim(),whatsappSettings:f.whatsappSettings}):await j.A.post(w.Sn.BRANCHES.CREATE,{name:f.name.trim()}),await K(),Q()}catch(n){var r,s;console.error("Fehler beim Speichern der Niederlassung:",n);const e=(null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||a("branches.saveError");t(e)}else t(a("branches.nameRequired"))},te=async e=>{if(window.confirm(a("branches.deleteConfirm",{defaultValue:"M\xf6chten Sie diese Niederlassung wirklich l\xf6schen?"})))try{await j.A.delete(w.Sn.BRANCHES.DELETE(e)),await K()}catch(n){var r,s;console.error("Fehler beim L\xf6schen der Niederlassung:",n);const e=(null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||a("branches.deleteError");t(e)}},ae=()=>R.length,re=(0,r.useMemo)((()=>u.filter((e=>{if(A){const t=A.toLowerCase();if(!e.name.toLowerCase().includes(t))return!1}if(R.length>0){let t=R.length>0;for(let a=0;a<R.length;a++){const r=R[a];let s=!1;if("name"===r.column)"equals"===r.operator?s=e.name.toLowerCase()===(r.value||"").toLowerCase():"contains"===r.operator?s=e.name.toLowerCase().includes((r.value||"").toLowerCase()):"startsWith"===r.operator&&(s=e.name.toLowerCase().startsWith((r.value||"").toLowerCase()));if(0===a)t=s;else{t="AND"===E[a-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.localeCompare(t.name)))),[u,A,R,E]),se=(e,t)=>{D(e),T(t)},ne=()=>{D([]),T([]),P(""),O(null)};(0,r.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error(a("common.notAuthenticated"));const e=(await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(be))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:be,name:"Alle",conditions:[],operators:[]};await j.A.post(w.Sn.SAVED_FILTERS.BASE,e),console.log(a("branches.filterCreated"))}}catch(e){console.error(a("branches.createStandardFiltersError"),e)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{try{const e=await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(be)),t=e.data.find((e=>"Alle"===e.name));t&&(P("Alle"),O(t.id),se(t.conditions,t.operators))}catch(e){console.error(a("branches.setInitialFilterError"),e)}})()}),[]);const[le,ie]=(0,r.useState)(window.innerWidth<640);return(0,r.useEffect)((()=>{const e=()=>{ie(window.innerWidth<640)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("div",{className:"flex items-center",children:G&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>{J(),i(!0)},className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":a("branches.create",{defaultValue:"Neue Niederlassung"}),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("branches.create",{defaultValue:"Neue Niederlassung"})})]})}),(0,F.jsx)("div",{}),(0,F.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,F.jsx)("input",{type:"text",placeholder:a("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:A,onChange:e=>S(e.target.value)}),(0,F.jsxs)("div",{className:"relative group ml-1",children:[(0,F.jsxs)("button",{className:"p-2 rounded-md ".concat(ae()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"," relative"),onClick:()=>z(!C),children:[(0,F.jsx)(Z.A,{className:"w-5 h-5"}),ae()>0&&(0,F.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:ae()})]}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.filter",{defaultValue:"Filter"})})]})]})]}),C&&(0,F.jsx)(X.A,{columns:[{id:"name",label:a("branches.name",{defaultValue:"Name"})}],onApply:se,onReset:ne,savedConditions:R,savedOperators:E,tableId:be}),(0,F.jsx)($.A,{tableId:be,onSelectFilter:se,onReset:ne,activeFilterName:I,selectedFilterId:_,onFilterChange:(e,t,a,r)=>{P(e),O(t),se(a,r)},defaultFilterName:"Alle"}),b?(0,F.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===re.length?(0,F.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded text-center",children:(0,F.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:a("branches.noBranches",{defaultValue:"Keine Niederlassungen gefunden. Erstellen Sie eine neue Niederlassung mit dem Button oben."})})}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"space-y-4",children:re.slice(0,B).map((e=>(0,F.jsx)(xe,{branch:e,onEdit:Y,onDelete:te,canEdit:W,canDelete:H},e.id)))}),re.length>B&&(0,F.jsx)("div",{className:"mt-4 flex justify-center",children:(0,F.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>q((e=>e+10)),children:[a("common.showMore",{defaultValue:"Mehr anzeigen"})," (",re.length-B," ",a("common.remaining",{defaultValue:"verbleibend"}),")"]})})]})]}),l&&(0,F.jsx)(F.Fragment,{children:le?(0,F.jsxs)(m.lG,{open:l,onClose:Q,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o?a("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):a("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,F.jsx)("button",{onClick:Q,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]})}),(0,F.jsxs)("form",{onSubmit:ee,className:"p-6 space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("branches.name",{defaultValue:"Name"})}),(0,F.jsx)("input",{type:"text",value:f.name,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]}),o&&(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"WhatsApp Settings"}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappProvider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Provider"}),(0,F.jsxs)("select",{id:"whatsappProvider",value:f.whatsappSettings.provider,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{provider:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"twilio",children:"Twilio"}),(0,F.jsx)("option",{value:"whatsapp-business-api",children:"WhatsApp Business API"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappApiKey",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key / Access Token"}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("input",{type:k.whatsappApiKey?"text":"password",id:"whatsappApiKey",value:f.whatsappSettings.apiKey,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{apiKey:e.target.value})})),placeholder:"API Key / Access Token",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,F.jsx)("button",{type:"button",onClick:()=>N((e=>(0,c.A)((0,c.A)({},e),{},{whatsappApiKey:!e.whatsappApiKey}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiKey?(0,F.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,F.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number ID"}),(0,F.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",value:f.whatsappSettings.phoneNumberId,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{phoneNumberId:e.target.value})})),placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"KI-Konfiguration (AI)"}),(0,F.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",checked:f.whatsappSettings.ai.enabled,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,F.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:f.whatsappSettings.ai.enabled?"Aktiviert":"Deaktiviert"})]})]}),f.whatsappSettings.ai.enabled&&(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiModel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Modell"}),(0,F.jsxs)("select",{id:"aiModel",value:f.whatsappSettings.ai.model,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{model:e.target.value})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,F.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,F.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiSystemPrompt",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"System Prompt"}),(0,F.jsx)("textarea",{id:"aiSystemPrompt",value:f.whatsappSettings.ai.systemPrompt,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{systemPrompt:e.target.value})})})),rows:4,placeholder:"Du bist ein hilfreicher Assistent f\xfcr...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Regeln (eine pro Zeile)"}),(0,F.jsx)("textarea",{value:f.whatsappSettings.ai.rules.join("\n"),onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{rules:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:3,placeholder:"Antworte immer auf Spanisch\nSei freundlich und professionell",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quellen/URLs (eine pro Zeile)"}),(0,F.jsx)("textarea",{value:f.whatsappSettings.ai.sources.join("\n"),onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{sources:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:2,placeholder:"https://wiki.example.com/manila-procedures\nhttps://wiki.example.com/faq",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"aiTemperature",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Temperature (",f.whatsappSettings.ai.temperature,")"]}),(0,F.jsx)("input",{type:"range",id:"aiTemperature",min:"0",max:"2",step:"0.1",value:f.whatsappSettings.ai.temperature,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{temperature:parseFloat(e.target.value)})})})),className:"mt-1 block w-full"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiMaxTokens",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Tokens"}),(0,F.jsx)("input",{type:"number",id:"aiMaxTokens",min:"100",max:"4000",step:"100",value:f.whatsappSettings.ai.maxTokens,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{maxTokens:parseInt(e.target.value)||500})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:Q,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.cancel",{defaultValue:"Abbrechen"})})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o?a("common.update",{defaultValue:"Aktualisieren"}):a("common.create",{defaultValue:"Erstellen"})})]})]})]})]})})]}):(0,F.jsxs)("div",{className:"fixed inset-y-0 right-0 w-full sm:w-96 bg-white dark:bg-gray-800 shadow-xl z-50 flex flex-col",children:[(0,F.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o?a("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):a("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,F.jsx)("button",{onClick:Q,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]})}),(0,F.jsxs)("form",{onSubmit:ee,className:"flex flex-col flex-1 min-h-0",children:[(0,F.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,F.jsxs)("div",{className:"p-6 space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("branches.name",{defaultValue:"Name"})}),(0,F.jsx)("input",{type:"text",value:f.name,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]}),o&&(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"WhatsApp Settings"}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappProvider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Provider"}),(0,F.jsxs)("select",{id:"whatsappProvider",value:f.whatsappSettings.provider,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{provider:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"twilio",children:"Twilio"}),(0,F.jsx)("option",{value:"whatsapp-business-api",children:"WhatsApp Business API"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappApiKey",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key / Access Token"}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("input",{type:k.whatsappApiKey?"text":"password",id:"whatsappApiKey",value:f.whatsappSettings.apiKey,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{apiKey:e.target.value})})),placeholder:"API Key / Access Token",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,F.jsx)("button",{type:"button",onClick:()=>N((e=>(0,c.A)((0,c.A)({},e),{},{whatsappApiKey:!e.whatsappApiKey}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiKey?(0,F.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,F.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number ID"}),(0,F.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",value:f.whatsappSettings.phoneNumberId,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{phoneNumberId:e.target.value})})),placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"KI-Konfiguration (AI)"}),(0,F.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,F.jsx)("input",{type:"checkbox",checked:f.whatsappSettings.ai.enabled,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,F.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:f.whatsappSettings.ai.enabled?"Aktiviert":"Deaktiviert"})]})]}),f.whatsappSettings.ai.enabled&&(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiModelDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Modell"}),(0,F.jsxs)("select",{id:"aiModelDesktop",value:f.whatsappSettings.ai.model,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{model:e.target.value})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,F.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,F.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiSystemPromptDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"System Prompt"}),(0,F.jsx)("textarea",{id:"aiSystemPromptDesktop",value:f.whatsappSettings.ai.systemPrompt,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{systemPrompt:e.target.value})})})),rows:4,placeholder:"Du bist ein hilfreicher Assistent f\xfcr...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Regeln (eine pro Zeile)"}),(0,F.jsx)("textarea",{value:f.whatsappSettings.ai.rules.join("\n"),onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{rules:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:3,placeholder:"Antworte immer auf Spanisch\nSei freundlich und professionell",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quellen/URLs (eine pro Zeile)"}),(0,F.jsx)("textarea",{value:f.whatsappSettings.ai.sources.join("\n"),onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{sources:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:2,placeholder:"https://wiki.example.com/manila-procedures\nhttps://wiki.example.com/faq",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"aiTemperatureDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Temperature (",f.whatsappSettings.ai.temperature,")"]}),(0,F.jsx)("input",{type:"range",id:"aiTemperatureDesktop",min:"0",max:"2",step:"0.1",value:f.whatsappSettings.ai.temperature,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{temperature:parseFloat(e.target.value)})})})),className:"mt-1 block w-full"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"aiMaxTokensDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Tokens"}),(0,F.jsx)("input",{type:"number",id:"aiMaxTokensDesktop",min:"100",max:"4000",step:"100",value:f.whatsappSettings.ai.maxTokens,onChange:e=>v((0,c.A)((0,c.A)({},f),{},{whatsappSettings:(0,c.A)((0,c.A)({},f.whatsappSettings),{},{ai:(0,c.A)((0,c.A)({},f.whatsappSettings.ai),{},{maxTokens:parseInt(e.target.value)||500})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]})]})]})}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2 px-6 pb-6 border-t dark:border-gray-700",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"button",onClick:Q,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.cancel",{defaultValue:"Abbrechen"})})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,F.jsx)(y.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o?a("common.update",{defaultValue:"Aktualisieren"}):a("common.create",{defaultValue:"Erstellen"})})]})]})]})]})})]})};var pe=a(7629),ye=a(8682),fe=a(3315),ve=a(8673),ke=a(2395);const je=e=>{let{isOpen:t,onClose:a,onSuccess:n}=e;const{t:l}=(0,s.Bd)(),[i,o]=(0,r.useState)({name:"",displayName:"",domain:""}),[d,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)({}),[b,h]=(0,r.useState)(window.innerWidth<640),[v,k]=(0,r.useState)(window.innerWidth>1070),{openSidepane:j,closeSidepane:w}=(0,L.N)(),{showMessage:N}=(0,f.A)(),{fetchCurrentUser:A}=(0,E.As)();(0,r.useEffect)((()=>{const e=()=>{h(window.innerWidth<640),k(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?j():w(),()=>{w()})),[t,j,w]);const S=e=>{const{name:t,value:a}=e.target;o((e=>(0,c.A)((0,c.A)({},e),{},{[t]:a}))),g[t]&&x((e=>(0,c.A)((0,c.A)({},e),{},{[t]:""})))},C=async e=>{if(e.preventDefault(),(()=>{const e={};return i.name.trim()||(e.name=l("organization.create.nameRequired")),i.displayName.trim()||(e.displayName=l("organization.create.displayNameRequired")),x(e),0===Object.keys(e).length})())try{u(!0),await ve.h.createOrganization(i),x({}),N(l("organization.create.createSuccess"),"success"),await A(),o({name:"",displayName:"",domain:""}),a(),n&&n()}catch(s){var t,r;const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("organization.create.createError");N(e,"error"),x({submit:e})}finally{u(!1)}else N(l("joinRequest.fillRequired"),"error")},z=()=>{o({name:"",displayName:"",domain:""}),x({}),a()};return b?(0,F.jsxs)(m.lG,{open:t,onClose:z,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:l("organization.create.title")}),(0,F.jsx)("button",{onClick:z,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:C,className:"p-4",children:[g.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:g.submit}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.name")}),(0,F.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.displayName")}),(0,F.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.displayName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.displayName})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.domain")}),(0,F.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:z,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("joinRequest.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!v&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:z,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("organization.create.title")}),(0,F.jsx)("button",{onClick:z,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[g.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:g.submit}),(0,F.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.name")}),(0,F.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.displayName")}),(0,F.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.displayName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.displayName})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.domain")}),(0,F.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:z,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})]})]})},we=e=>{let{isOpen:t,onClose:a,onSuccess:n}=e;const{t:l}=(0,s.Bd)(),[i,o]=(0,r.useState)({organizationName:"",message:""}),[d,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),[b,h]=(0,r.useState)({}),[v,k]=(0,r.useState)(window.innerWidth<640),[j,w]=(0,r.useState)(window.innerWidth>1070),{openSidepane:N,closeSidepane:A}=(0,L.N)(),[S,C]=(0,r.useState)([]),[z,R]=(0,r.useState)(!1),[E,T]=(0,r.useState)(null),I=(0,r.useRef)(null),P=(0,r.useRef)(null),{showMessage:_}=(0,f.A)();(0,r.useEffect)((()=>{const e=()=>{k(window.innerWidth<640),w(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?N():A(),()=>{A()})),[t,N,A]),(0,r.useEffect)((()=>{const e=e=>{P.current&&!P.current.contains(e.target)&&R(!1)};return z&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[z]);const O=e=>{const t=e.target.value;o((e=>(0,c.A)((0,c.A)({},e),{},{organizationName:t}))),T(null),b.organizationName&&h((e=>(0,c.A)((0,c.A)({},e),{},{organizationName:""}))),I.current&&clearTimeout(I.current),I.current=setTimeout((()=>{(async e=>{if(e.length<2)return C([]),void R(!1);try{x(!0);const t=await ve.h.searchOrganizations(e);C(t),R(!0)}catch(t){console.error("Fehler bei der Organisationen-Suche:",t),C([])}finally{x(!1)}})(t)}),300)},B=e=>{T(e),o((t=>(0,c.A)((0,c.A)({},t),{},{organizationName:e.name}))),R(!1),C([])},q=e=>{o((t=>(0,c.A)((0,c.A)({},t),{},{message:e.target.value}))),b.message&&h((e=>(0,c.A)((0,c.A)({},e),{},{message:""})))},V=async e=>{if(e.preventDefault(),(()=>{const e={};return i.organizationName.trim()?E||(e.organizationName=l("organization.join.selectFromList")):e.organizationName=l("organization.join.nameRequired"),h(e),0===Object.keys(e).length})())try{u(!0),await ve.h.createJoinRequest(i),h({}),_(l("organization.join.sendSuccess"),"success"),o({organizationName:"",message:""}),T(null),C([]),a(),n&&n()}catch(s){var t,r;const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("organization.join.sendError");_(e,"error"),h({submit:e})}finally{u(!1)}else _(l("joinRequest.fillRequired"),"error")},U=()=>{o({organizationName:"",message:""}),T(null),C([]),h({}),R(!1),I.current&&clearTimeout(I.current),a()};return v?(0,F.jsxs)(m.lG,{open:t,onClose:U,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:l("organization.join.title")}),(0,F.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:V,className:"p-4",children:[b.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"relative",ref:P,children:[(0,F.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.search")}),(0,F.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:O,placeholder:l("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),z&&(S.length>0||g)&&(0,F.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:g?(0,F.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.searching")}):S.length>0?S.map((e=>(0,F.jsxs)("button",{type:"button",onClick:()=>B(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,F.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,F.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,F.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.noOrganizations")})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.message")}),(0,F.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:q,rows:3,placeholder:l("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("joinRequest.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.join.sending":"organization.join.send"),children:d?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!j&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:U,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("organization.join.title")}),(0,F.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[b.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,F.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,F.jsxs)("div",{className:"relative",ref:P,children:[(0,F.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.search")}),(0,F.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:O,placeholder:l("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),z&&(S.length>0||g)&&(0,F.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:g?(0,F.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.searching")}):S.length>0?S.map((e=>(0,F.jsxs)("button",{type:"button",onClick:()=>B(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,F.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,F.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,F.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.noOrganizations")})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.message")}),(0,F.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:q,rows:3,placeholder:l("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.join.sending":"organization.join.send"),children:d?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})]})]})};var Ne=a(5648);const Ae=e=>{let{organization:t,onSave:a}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,r.useState)([]),[d,m]=(0,r.useState)({}),[g,x]=(0,r.useState)(!1),[b,h]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1);(0,r.useEffect)((()=>{t&&(k(),N())}),[t]);const k=async()=>{v(!0);try{const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&o(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),l(n("lifecycle.loadRolesError",{defaultValue:"Fehler beim Laden der Rollen"}),"error")}finally{v(!1)}},N=async()=>{x(!0);try{const e=await j.A.get(w.Sn.ORGANIZATION_LIFECYCLE.LIFECYCLE_ROLES);m(e.data.lifecycleRoles||{})}catch(r){var e,t,a;if(console.error("Fehler beim Laden der Lebenszyklus-Rollen:",r),404!==(null===(e=r.response)||void 0===e?void 0:e.status))l((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("lifecycle.loadLifecycleRolesError",{defaultValue:"Fehler beim Laden der Konfiguration"}),"error")}finally{x(!1)}};return g&&!d?(0,F.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,F.jsx)(D.A,{className:"h-6 w-6 animate-spin text-gray-400"})}):(0,F.jsx)("div",{className:"space-y-6",children:(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:n("organization.lifecycleRoles.title",{defaultValue:"Lebenszyklus-Rollen"})}),(0,F.jsx)("button",{onClick:()=>{const e=i.find((e=>e.name.toLowerCase().includes("admin")||e.name.toLowerCase().includes("administrator"))),t=i.find((e=>e.name.toLowerCase().includes("hr")||e.name.toLowerCase().includes("human"))),a=i.find((e=>"derecho"===e.name.toLowerCase()||e.name.toLowerCase().includes("legal")));m((0,c.A)((0,c.A)({},d),{},{adminRoleId:(null===e||void 0===e?void 0:e.id)||null,hrRoleId:(null===t||void 0===t?void 0:t.id)||null,legalRoleId:(null===a||void 0===a?void 0:a.id)||null})),l(n("lifecycle.standardRolesAssigned",{defaultValue:"Standard-Rollen zugewiesen"}),"success")},className:"px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:n("lifecycle.assignStandardRoles",{defaultValue:"Standard-Rollen zuweisen"})})]}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.admin",{defaultValue:"Admin-Rolle"})}),(0,F.jsxs)("select",{value:d.adminRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{adminRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[(0,F.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,F.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.hr",{defaultValue:"HR-Rolle"})}),(0,F.jsxs)("select",{value:d.hrRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{hrRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[(0,F.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,F.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.legal",{defaultValue:"Legal-Rolle"})}),(0,F.jsxs)("select",{value:d.legalRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{legalRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[(0,F.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,F.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,F.jsx)("div",{className:"mt-6 flex justify-end",children:(0,F.jsx)("button",{onClick:async()=>{h(!0);try{const e=e=>null===e||void 0===e||0===e?null:Number(e);await j.A.put(w.Sn.ORGANIZATION_LIFECYCLE.LIFECYCLE_ROLES,{adminRoleId:e(d.adminRoleId),hrRoleId:e(d.hrRoleId),legalRoleId:e(d.legalRoleId),employeeRoleIds:(d.employeeRoleIds||[]).map(e).filter((e=>null!==e))}),l(n("lifecycle.rolesSaved",{defaultValue:"Rollen-Konfiguration erfolgreich gespeichert"}),"success"),a&&a()}catch(r){var e,t;console.error("Fehler beim Speichern:",r),l((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n("lifecycle.saveError",{defaultValue:"Fehler beim Speichern"}),"error")}finally{h(!1)}},disabled:b||p,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:b?n("common.saving",{defaultValue:"Speichere..."}):n("common.save",{defaultValue:"Speichern"}),children:b?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})})]})})},Se=e=>{let{organization:t,onUpload:a}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)("certificate"),[b,h]=(0,r.useState)(""),[p,y]=(0,r.useState)(""),[v,k]=(0,r.useState)("400"),[N,A]=(0,r.useState)("100"),[S,C]=(0,r.useState)("1"),z=r.useRef(null);(0,r.useEffect)((()=>{t&&R()}),[t]);const R=async()=>{c(!0);try{const e=(await j.A.get(w.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_SIGNATURES)).data.documentSignatures||{},t=[];e.employmentCertificate&&t.push({type:"certificate",signerName:e.employmentCertificate.signerName,signerPosition:e.employmentCertificate.signerPosition,path:e.employmentCertificate.path,position:e.employmentCertificate.position}),e.employmentContract&&t.push({type:"contract",signerName:e.employmentContract.signerName,signerPosition:e.employmentContract.signerPosition,path:e.employmentContract.path,position:e.employmentContract.position}),o(t)}catch(r){var e,t,a;if(console.error("Fehler beim Laden der Signaturen:",r),404!==(null===(e=r.response)||void 0===e?void 0:e.status))l((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("lifecycle.loadSignaturesError",{defaultValue:"Fehler beim Laden der Signaturen"}),"error");o([])}finally{c(!1)}};return d?(0,F.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin text-gray-400"})}):(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-4",children:(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("lifecycle.signatureType",{defaultValue:"Signatur-Typ"})}),(0,F.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,F.jsx)("option",{value:"certificate",children:n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"})}),(0,F.jsx)("option",{value:"contract",children:n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"})})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("lifecycle.signerName",{defaultValue:"Name des Unterzeichners"})," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"text",value:b,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:n("lifecycle.signerNamePlaceholder",{defaultValue:"z.B. Stefan Bossart"})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("lifecycle.signerPosition",{defaultValue:"Position"})}),(0,F.jsx)("input",{type:"text",value:p,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:n("lifecycle.signerPositionPlaceholder",{defaultValue:"z.B. Gesch\xe4ftsf\xfchrer"})})]}),(0,F.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:n("lifecycle.signaturePosition",{defaultValue:"Signatur-Position im PDF"})}),(0,F.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionX",{defaultValue:"X (horizontal)"})}),(0,F.jsx)("input",{type:"number",value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"400",min:"0"}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionXHint",{defaultValue:"0 = links"})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionY",{defaultValue:"Y (vertikal)"})}),(0,F.jsx)("input",{type:"number",value:N,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"100",min:"0"}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionYHint",{defaultValue:"0 = unten"})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionPage",{defaultValue:"Seite"})}),(0,F.jsx)("input",{type:"number",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"1",min:"1"}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionPageHint",{defaultValue:"Seitennummer"})})]})]}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:n("lifecycle.signaturePositionHint",{defaultValue:"Koordinaten in PDF-Punkten (1 Punkt = 1/72 Zoll). A4: 595 x 842 Punkte. Standard: X=400, Y=100, Seite=1"})})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("lifecycle.signatureFile",{defaultValue:"Signatur-Datei"})," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[(0,F.jsx)("input",{ref:z,type:"file",accept:"image/jpeg,image/png,image/gif,application/pdf",onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(["image/jpeg","image/png","image/gif","application/pdf"].includes(r.type))if(b.trim()){u(!0);try{const e=new FormData;e.append("file",r),e.append("type","certificate"===g?"employmentCertificate":"employmentContract"),e.append("signerName",b),p&&e.append("signerPosition",p),e.append("positionX",v||"400"),e.append("positionY",N||"100"),e.append("page",S||"1");const t=await j.A.post(w.Sn.ORGANIZATION_LIFECYCLE.UPLOAD_SIGNATURE,e,{headers:{"Content-Type":"multipart/form-data"}});l(t.data.message||n("lifecycle.signatureUploaded",{defaultValue:"Signatur erfolgreich hochgeladen"}),"success"),h(""),y(""),k("400"),A("100"),C("1"),R(),a()}catch(o){var s,i;console.error("Fehler beim Hochladen:",o),l((null===(s=o.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||n("lifecycle.uploadError",{defaultValue:"Fehler beim Hochladen"}),"error")}finally{u(!1),z.current&&(z.current.value="")}}else l(n("lifecycle.signerNameRequired",{defaultValue:"Name des Unterzeichners ist erforderlich"}),"error");else l(n("lifecycle.onlyImageOrPdfAllowed",{defaultValue:"Nur Bilder (JPEG, PNG, GIF) oder PDF-Dateien sind erlaubt"}),"error")},className:"hidden"}),(0,F.jsx)("button",{onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},disabled:m||!b.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?(0,F.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,F.jsx)(D.A,{className:"h-4 w-4 animate-spin"}),(0,F.jsx)("span",{children:n("common.uploading",{defaultValue:"Lade hoch..."})})]}):n("lifecycle.selectSignatureFile",{defaultValue:"Datei ausw\xe4hlen"})}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:n("lifecycle.signatureFileHint",{defaultValue:"JPEG, PNG, GIF oder PDF (max. 5MB)"})})]})]})]})}),i.length>0&&(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("lifecycle.uploadedSignatures",{defaultValue:"Hochgeladene Signaturen"})}),i.map((e=>(0,F.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{className:"font-medium dark:text-white",children:"certificate"===e.type?n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"}):n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"})}),(0,F.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.signerName,e.signerPosition&&" - ".concat(e.signerPosition)]}),e.position&&(0,F.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[n("lifecycle.position",{defaultValue:"Position"}),": X=",e.position.x,", Y=",e.position.y,", ",n("lifecycle.page",{defaultValue:"Seite"})," ",e.position.page]})]}),(0,F.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(n("lifecycle.deleteSignatureConfirm",{defaultValue:"Signatur wirklich l\xf6schen?"})))try{const t=(await j.A.get(w.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};if(t.documentSignatures){const a="certificate"===e?"employmentCertificate":"employmentContract";delete t.documentSignatures[a],await j.A.put(w.Sn.ORGANIZATIONS.CURRENT,{settings:t})}l(n("lifecycle.signatureDeleted",{defaultValue:"Signatur erfolgreich gel\xf6scht"}),"success"),R()}catch(r){var t,a;console.error("Fehler beim L\xf6schen:",r),l((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("lifecycle.deleteError",{defaultValue:"Fehler beim L\xf6schen"}),"error")}})(e.type),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-md",title:n("common.delete",{defaultValue:"L\xf6schen"}),children:(0,F.jsx)(J.A,{className:"h-5 w-5"})})]},e.type)))]})]})},Ce=e=>{let{organization:t,onSave:a}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,r.useState)("certificate"),[d,m]=(0,r.useState)({}),[u,g]=(0,r.useState)(!1),[x,b]=(0,r.useState)(!1),h=["userName","organizationName","currentDate","identificationNumber","startDate","endDate"],p=["userName","organizationName","currentDate","identificationNumber","startDate","endDate","position","salary","workingHours"];(0,r.useEffect)((()=>{t&&v()}),[t,i]);const v=async()=>{try{var e;const a=null===t||void 0===t?void 0:t.settings,r=null===a||void 0===a||null===(e=a.documentTemplates)||void 0===e?void 0:e["certificate"===i?"employmentCertificate":"employmentContract"],s=(null===r||void 0===r?void 0:r.fields)||{},n=50,l=20;let o=841.89-n-30;const d={},c="certificate"===i?h:p,u={userName:{x:n,y:o,fontSize:14},organizationName:{x:n,y:o-l,fontSize:12},currentDate:{x:n,y:o-2*l,fontSize:12},identificationNumber:{x:n,y:o-3*l,fontSize:12},startDate:{x:n,y:o-4*l,fontSize:12},endDate:{x:n,y:o-5*l,fontSize:12}};"contract"===i&&(u.position={x:n,y:o-6*l,fontSize:12},u.salary={x:n,y:o-7*l,fontSize:12},u.workingHours={x:n,y:o-8*l,fontSize:12}),c.forEach((e=>{d[e]=s[e]||u[e]||{x:n,y:o,fontSize:"userName"===e?14:12}})),m(d)}catch(a){console.error("Fehler beim Laden der Felder:",a)}},k=(e,t,a)=>{m((r=>(0,c.A)((0,c.A)({},r),{},{[e]:(0,c.A)((0,c.A)({},r[e]),{},{[t]:"fontSize"===t?parseFloat(a)||12:parseFloat(a)||0})})))},N="certificate"===i?h:p,A={userName:n("lifecycle.fieldUserName",{defaultValue:"Benutzername"}),organizationName:n("lifecycle.fieldOrganizationName",{defaultValue:"Organisationsname"}),currentDate:n("lifecycle.fieldCurrentDate",{defaultValue:"Aktuelles Datum"}),identificationNumber:n("lifecycle.fieldIdentificationNumber",{defaultValue:"Ausweisnummer"}),startDate:n("lifecycle.fieldStartDate",{defaultValue:"Startdatum"}),endDate:n("lifecycle.fieldEndDate",{defaultValue:"Enddatum"}),position:n("lifecycle.fieldPosition",{defaultValue:"Position"}),salary:n("lifecycle.fieldSalary",{defaultValue:"Gehalt"}),workingHours:n("lifecycle.fieldWorkingHours",{defaultValue:"Arbeitsstunden"})};return(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:n("organization.fieldPositions",{defaultValue:"Feld-Positionen konfigurieren"})}),(0,F.jsx)("div",{className:"flex items-center space-x-2",children:(0,F.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",children:[(0,F.jsx)("option",{value:"certificate",children:n("lifecycle.certificate",{defaultValue:"Certificado Laboral"})}),(0,F.jsx)("option",{value:"contract",children:n("lifecycle.contract",{defaultValue:"Contrato de Trabajo"})})]})})]}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[(0,F.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium mb-1",children:n("lifecycle.fieldPositionsInfo",{defaultValue:"Konfigurieren Sie die Positionen der Felder im Template-PDF."})}),(0,F.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:n("lifecycle.fieldPositionsHint",{defaultValue:"Koordinaten in PDF-Punkten. A4: 595 x 842 Punkte. Y=0 ist unten, Y=842 ist oben. X=0 ist links, X=595 ist rechts."})})]}),(0,F.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N.map((e=>{var t,a,r;return(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[(0,F.jsx)("div",{className:"font-medium text-sm dark:text-white mb-2",children:A[e]||e}),(0,F.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"X"}),(0,F.jsx)("input",{type:"number",value:(null===(t=d[e])||void 0===t?void 0:t.x)||0,onChange:t=>k(e,"x",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"0"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Y"}),(0,F.jsx)("input",{type:"number",value:(null===(a=d[e])||void 0===a?void 0:a.y)||0,onChange:t=>k(e,"y",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"0"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.fontSize",{defaultValue:"Schriftgr\xf6\xdfe"})}),(0,F.jsx)("input",{type:"number",value:(null===(r=d[e])||void 0===r?void 0:r.fontSize)||12,onChange:t=>k(e,"fontSize",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"8",max:"72"})]})]})]},e)}))}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[(0,F.jsx)("button",{onClick:async()=>{if(window.confirm(n("lifecycle.resetFieldPositionsConfirm",{defaultValue:"Positionen auf Standardwerte zur\xfccksetzen?"}))){const e=50,t=20;let a=841.89-e-30;const r={userName:{x:e,y:a,fontSize:14},organizationName:{x:e,y:a-t,fontSize:12},currentDate:{x:e,y:a-2*t,fontSize:12},identificationNumber:{x:e,y:a-3*t,fontSize:12},startDate:{x:e,y:a-4*t,fontSize:12},endDate:{x:e,y:a-5*t,fontSize:12}};"contract"===i&&(r.position={x:e,y:a-6*t,fontSize:12},r.salary={x:e,y:a-7*t,fontSize:12},r.workingHours={x:e,y:a-8*t,fontSize:12});const s={};("certificate"===i?h:p).forEach((t=>{s[t]=r[t]||{x:e,y:a,fontSize:"userName"===t?14:12}})),m(s)}},className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white",title:n("common.reset",{defaultValue:"Zur\xfccksetzen"}),children:(0,F.jsx)(D.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:async()=>{b(!0);try{const e=(await j.A.get(w.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};e.documentTemplates||(e.documentTemplates={});const t="certificate"===i?"employmentCertificate":"employmentContract";e.documentTemplates[t]||(e.documentTemplates[t]={}),e.documentTemplates[t].fields=d,await ve.h.updateOrganization({settings:e}),l(n("lifecycle.fieldPositionsSaved",{defaultValue:"Feld-Positionen erfolgreich gespeichert"}),"success"),a&&a()}catch(r){var e,t;console.error("Fehler beim Speichern:",r),l((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n("lifecycle.saveError",{defaultValue:"Fehler beim Speichern"}),"error")}finally{b(!1)}},disabled:x,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-700 dark:hover:bg-blue-800",title:x?n("common.saving",{defaultValue:"Speichern..."}):n("common.save",{defaultValue:"Speichern"}),children:x?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})},ze=e=>{let{organization:t,onSave:a}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)("certificate"),v=r.useRef(null);(0,r.useEffect)((()=>{t&&k()}),[t]);const k=async()=>{c(!0);try{const e=(await j.A.get(w.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentCertificate&&t.push({name:"Arbeitszeugnis",type:"certificate",filePath:e.employmentCertificate.path,version:e.employmentCertificate.version}),e.employmentContract&&t.push({name:"Arbeitsvertrag",type:"contract",filePath:e.employmentContract.path,version:e.employmentContract.version}),o(t)}catch(r){var e,t,a;if(console.error("Fehler beim Laden der Templates:",r),404!==(null===(e=r.response)||void 0===e?void 0:e.status))l((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("lifecycle.loadTemplatesError",{defaultValue:"Fehler beim Laden der Templates"}),"error");o([])}finally{c(!1)}};return d?(0,F.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,F.jsx)(D.A,{className:"h-6 w-6 animate-spin text-gray-400"})}):(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 mr-2"}),n("organization.documentTemplates",{defaultValue:"Dokumenten-Templates"})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsxs)("select",{value:p,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",children:[(0,F.jsx)("option",{value:"certificate",children:"Arbeitszeugnis"}),(0,F.jsx)("option",{value:"contract",children:"Arbeitsvertrag"})]}),(0,F.jsx)("button",{onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},disabled:x,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x?n("common.uploading",{defaultValue:"Lade hoch..."}):n("lifecycle.uploadTemplate",{defaultValue:"Template hochladen"}),children:x?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(g.A,{className:"h-5 w-5"})})]}),(0,F.jsx)("input",{ref:v,type:"file",accept:".pdf",onChange:async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a)if("application/pdf"===a.type){h(!0);try{const e=new FormData;e.append("file",a),e.append("type","certificate"===p?"employmentCertificate":"employmentContract");const t=await j.A.post(w.Sn.ORGANIZATION_LIFECYCLE.UPLOAD_TEMPLATE,e,{headers:{"Content-Type":"multipart/form-data"}});l(t.data.message||n("lifecycle.templateUploaded",{defaultValue:"Template erfolgreich hochgeladen"}),"success"),k()}catch(i){var r,s;console.error("Fehler beim Hochladen:",i),l((null===(r=i.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||n("lifecycle.uploadError",{defaultValue:"Fehler beim Hochladen"}),"error")}finally{h(!1),v.current&&(v.current.value="")}}else l(n("lifecycle.onlyPdfAllowed",{defaultValue:"Nur PDF-Dateien sind erlaubt"}),"error")},className:"hidden"})]}),0===i.length?(0,F.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,F.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,F.jsx)("p",{children:n("lifecycle.noTemplates",{defaultValue:"Keine Templates vorhanden"})}),(0,F.jsx)("p",{className:"text-sm mt-2",children:n("lifecycle.uploadFirstTemplate",{defaultValue:"Laden Sie Ihr erstes Template hoch"})})]}):(0,F.jsx)("div",{className:"space-y-2",children:i.map((e=>(0,F.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{className:"font-medium dark:text-white",children:e.name}),(0,F.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["certificate"===e.type?n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"}):n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"}),e.version&&" - Version ".concat(e.version)]}),e.filePath&&(0,F.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:e.filePath})]}),(0,F.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(n("lifecycle.deleteTemplateConfirm",{defaultValue:"Template wirklich l\xf6schen?"})))try{const t=(await j.A.get(w.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};if(t.documentTemplates){const a="certificate"===e?"employmentCertificate":"employmentContract";delete t.documentTemplates[a],await j.A.put(w.Sn.ORGANIZATIONS.CURRENT,{settings:t})}l(n("lifecycle.templateDeleted",{defaultValue:"Template erfolgreich gel\xf6scht"}),"success"),k()}catch(r){var t,a;console.error("Fehler beim L\xf6schen:",r),l((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("lifecycle.deleteError",{defaultValue:"Fehler beim L\xf6schen"}),"error")}})(e.type),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-md",title:n("common.delete",{defaultValue:"L\xf6schen"}),children:(0,F.jsx)(J.A,{className:"h-5 w-5"})})]},e.type)))})]}),(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,F.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,F.jsx)(b.A,{className:"h-5 w-5 mr-2"}),n("organization.documentSignatures",{defaultValue:"Dokumenten-Signaturen"})]})}),(0,F.jsx)(Se,{organization:t,onUpload:k})]}),(0,F.jsx)(Ce,{organization:t,onSave:a})]})},Re=e=>{let{organization:t,onSave:a}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)({smtpHost:"",smtpPort:"587",smtpUser:"",smtpPass:"",smtpFromEmail:"",smtpFromName:""}),[u,g]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(null!==t&&void 0!==t&&t.settings){var e;const a=t.settings;m({smtpHost:a.smtpHost||"",smtpPort:(null===(e=a.smtpPort)||void 0===e?void 0:e.toString())||"587",smtpUser:a.smtpUser||"",smtpPass:a.smtpPass||"",smtpFromEmail:a.smtpFromEmail||(null!==t&&void 0!==t&&t.domain?"noreply@".concat(t.domain):""),smtpFromName:a.smtpFromName||(null===t||void 0===t?void 0:t.displayName)||""})}}),[t]);const x=e=>{const{name:t,value:a}=e.target;m((e=>(0,c.A)((0,c.A)({},e),{},{[t]:a})))};return(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,F.jsx)(ye.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("organization.smtp.title")})]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:n("organization.smtp.description")}),(0,F.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d.smtpHost&&d.smtpUser&&d.smtpPass)try{o(!0);const e=(0,c.A)((0,c.A)({},(null===t||void 0===t?void 0:t.settings)||{}),{},{smtpHost:d.smtpHost,smtpPort:parseInt(d.smtpPort)||587,smtpUser:d.smtpUser,smtpPass:d.smtpPass,smtpFromEmail:d.smtpFromEmail,smtpFromName:d.smtpFromName});await ve.h.updateOrganization({settings:e}),l(n("organization.smtp.saveSuccess"),"success"),a&&a()}catch(i){var r,s;const e=(null===(r=i.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||n("organization.smtp.saveError");l(e,"error")}finally{o(!1)}else l(n("organization.smtp.requiredFields"),"error")},className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"smtpHost",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.host")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"text",id:"smtpHost",name:"smtpHost",value:d.smtpHost,onChange:x,placeholder:"smtp.example.com",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.hostHint")})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"smtpPort",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.port")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"number",id:"smtpPort",name:"smtpPort",value:d.smtpPort,onChange:x,placeholder:"587",required:!0,min:"1",max:"65535",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.portHint")})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"smtpUser",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.user")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsx)("input",{type:"text",id:"smtpUser",name:"smtpUser",value:d.smtpUser,onChange:x,placeholder:"noreply@example.com",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.userHint")})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:"smtpPass",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.password")," ",(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("input",{type:u?"text":"password",id:"smtpPass",name:"smtpPass",value:d.smtpPass,onChange:x,placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,F.jsx)("button",{type:"button",onClick:()=>g(!u),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:u?(0,F.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,F.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.passwordHint")})]}),(0,F.jsxs)("div",{className:"border-t pt-4",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:n("organization.smtp.fromSettings")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"smtpFromEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.smtp.fromEmail")}),(0,F.jsx)("input",{type:"email",id:"smtpFromEmail",name:"smtpFromEmail",value:d.smtpFromEmail,onChange:x,placeholder:"noreply@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.fromEmailHint")})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"smtpFromName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.smtp.fromName")}),(0,F.jsx)("input",{type:"text",id:"smtpFromName",name:"smtpFromName",value:d.smtpFromName,onChange:x,placeholder:(null===t||void 0===t?void 0:t.displayName)||"Intranet",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.fromNameHint")})]})]})]}),(0,F.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4",children:[(0,F.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:(0,F.jsx)("strong",{children:n("organization.smtp.infoTitle")})}),(0,F.jsxs)("ul",{className:"mt-2 text-sm text-blue-700 dark:text-blue-300 list-disc list-inside space-y-1",children:[(0,F.jsx)("li",{children:n("organization.smtp.info1")}),(0,F.jsx)("li",{children:n("organization.smtp.info2")}),(0,F.jsx)("li",{children:n("organization.smtp.info3")})]})]}),(0,F.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,F.jsx)("button",{type:"button",onClick:()=>{m({smtpHost:"",smtpPort:"587",smtpUser:"",smtpPass:"",smtpFromEmail:null!==t&&void 0!==t&&t.domain?"noreply@".concat(t.domain):"",smtpFromName:(null===t||void 0===t?void 0:t.displayName)||""})},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",title:n("organization.smtp.clear"),children:(0,F.jsx)(D.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(i?"organization.saving":"common.save"),children:i?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})};var De=a(6693);const Ee={lobbyPms:["app.lobbypms.com"],ttlock:["open.ttlock.com","euopen.ttlock.com","api.sciener.com"],sire:["api.sire.gov.co"],boldPayment:["api.bold.co","sandbox.bold.co"]},Le=(e,t)=>{if(!e||"string"!==typeof e)return!1;try{const a=new URL(e);return Ee[t].some((e=>a.hostname===e||!!a.hostname.endsWith(".".concat(e))))}catch(a){return!1}},Fe=e=>{let{organization:t,onSave:a}=e;const{t:l}=(0,s.Bd)(),{showMessage:i}=(0,f.A)(),{canManageOrganization:o,loading:d}=(0,n.S)(),[m,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)({lobbyPmsApiKey:"",lobbyPmsPropertyId:"",lobbyPmsSyncEnabled:!1,lobbyPmsAutoCreateTasks:!1,lobbyPmsLateCheckInThreshold:"22:00",ttlockClientId:"",ttlockClientSecret:"",ttlockApiUrl:"https://open.ttlock.com",ttlockUsername:"",ttlockPassword:"",ttlockPasscodeType:"auto",sireApiUrl:"",sireApiKey:"",sireApiSecret:"",sireEnabled:!1,sireAutoRegisterOnCheckIn:!1,sirePropertyCode:"",boldPaymentApiKey:"",boldPaymentMerchantId:"",boldPaymentEnvironment:"sandbox",whatsappProvider:"twilio",whatsappApiKey:"",whatsappApiSecret:"",whatsappPhoneNumberId:""}),[b,h]=(0,r.useState)({});(0,r.useEffect)((()=>{if(null!==t&&void 0!==t&&t.settings){const e=t.settings,a=e.lobbyPms||{},r=e.doorSystem||{},s=e.sire||{},n=e.boldPayment||{},l=e.whatsapp||{};x({lobbyPmsApiKey:a.apiKey||"",lobbyPmsPropertyId:a.propertyId||"",lobbyPmsSyncEnabled:a.syncEnabled||!1,lobbyPmsAutoCreateTasks:a.autoCreateTasks||!1,lobbyPmsLateCheckInThreshold:a.lateCheckInThreshold||"22:00",ttlockClientId:r.clientId||"",ttlockClientSecret:r.clientSecret||"",ttlockApiUrl:r.apiUrl||"https://open.ttlock.com",ttlockUsername:r.username||"",ttlockPassword:"",ttlockPasscodeType:r.passcodeType||"auto",sireApiUrl:s.apiUrl||"",sireApiKey:s.apiKey||"",sireApiSecret:s.apiSecret||"",sireEnabled:s.enabled||!1,sireAutoRegisterOnCheckIn:s.autoRegisterOnCheckIn||!1,sirePropertyCode:s.propertyCode||"",boldPaymentApiKey:n.apiKey||"",boldPaymentMerchantId:n.merchantId||"",boldPaymentEnvironment:n.environment||"sandbox",whatsappProvider:l.provider||"twilio",whatsappApiKey:l.apiKey||"",whatsappApiSecret:l.apiSecret||"",whatsappPhoneNumberId:l.phoneNumberId||""})}}),[t]);const p=e=>{const{name:t,value:a,type:r}=e.target,s=e.target.checked;x((e=>(0,c.A)((0,c.A)({},e),{},{[t]:"checkbox"===r?s:a})))},v=e=>{let{name:t,value:a,onChange:r,placeholder:s,label:n,required:l=!1}=e;const i=b[t]||!1;return(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n," ",l&&(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("input",{type:i?"text":"password",id:t,name:t,value:a,onChange:r,placeholder:s||"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:l,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,F.jsx)("button",{type:"button",onClick:()=>{return e=t,void h((t=>(0,c.A)((0,c.A)({},t),{},{[e]:!t[e]})));var e},className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:i?(0,F.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,F.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]})};return d?(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)(D.A,{className:"h-6 w-6 animate-spin text-gray-400"}),(0,F.jsx)("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:l("common.loadingPermissions")})]}):o()?(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,F.jsx)(De.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("organization.api.title")})]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:l("organization.api.description")}),(0,F.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!g.lobbyPmsSyncEnabled||g.lobbyPmsApiKey)if(!g.ttlockApiUrl||Le(g.ttlockApiUrl,"ttlock"))if(!g.sireApiUrl||Le(g.sireApiUrl,"sire"))if(!g.lobbyPmsLateCheckInThreshold||/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(g.lobbyPmsLateCheckInThreshold))try{u(!0);const e=(null===t||void 0===t?void 0:t.settings)||{},r=(0,c.A)((0,c.A)({},e),{},{lobbyPms:(0,c.A)((0,c.A)({},e.lobbyPms),{},{apiUrl:"https://app.lobbypms.com/api",apiKey:g.lobbyPmsApiKey||void 0,propertyId:g.lobbyPmsPropertyId||void 0,syncEnabled:g.lobbyPmsSyncEnabled,autoCreateTasks:g.lobbyPmsAutoCreateTasks,lateCheckInThreshold:g.lobbyPmsLateCheckInThreshold||void 0}),doorSystem:(0,c.A)((0,c.A)({},e.doorSystem),{},{provider:"ttlock",apiUrl:g.ttlockApiUrl||void 0,clientId:g.ttlockClientId||void 0,clientSecret:g.ttlockClientSecret||void 0,username:g.ttlockUsername||void 0,password:g.ttlockPassword||void 0,passcodeType:g.ttlockPasscodeType||"auto"}),sire:(0,c.A)((0,c.A)({},e.sire),{},{apiUrl:g.sireApiUrl||void 0,apiKey:g.sireApiKey||void 0,apiSecret:g.sireApiSecret||void 0,enabled:g.sireEnabled,autoRegisterOnCheckIn:g.sireAutoRegisterOnCheckIn,propertyCode:g.sirePropertyCode||void 0}),boldPayment:(0,c.A)((0,c.A)({},e.boldPayment),{},{apiKey:g.boldPaymentApiKey||void 0,merchantId:g.boldPaymentMerchantId||void 0,environment:g.boldPaymentEnvironment}),whatsapp:(0,c.A)((0,c.A)({},e.whatsapp),{},{provider:g.whatsappProvider,apiKey:g.whatsappApiKey||void 0,apiSecret:g.whatsappApiSecret||void 0,phoneNumberId:g.whatsappPhoneNumberId||void 0})});await ve.h.updateOrganization({settings:r}),i(l("organization.api.saveSuccess"),"success"),a&&a()}catch(s){var r;console.error("Error saving API settings:",s);let e=l("organization.api.saveError");if(null!==(r=s.response)&&void 0!==r&&r.data){const t=s.response.data;if(t.message&&(e=t.message),t.errors&&Array.isArray(t.errors)){const a=t.errors.map((e=>{var t;return"".concat((null===(t=e.path)||void 0===t?void 0:t.join("."))||"",": ").concat(e.message||"")})).filter((e=>e)).join(", ");a&&(e+=" (".concat(a,")")),t.errors.length>0&&"string"===typeof t.errors[0]&&(e=t.errors.join(", "))}}else s.message&&(e=s.message);i(e,"error")}finally{u(!1)}else i(l("organization.api.validation.invalidTimeFormat"),"error");else i(l("organization.api.validation.invalidUrl"),"error");else i(l("organization.api.validation.invalidUrl"),"error");else i(l("organization.api.validation.apiKeyRequired"),"error")},className:"space-y-6",children:[(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.lobbyPms.title")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)(v,{name:"lobbyPmsApiKey",value:g.lobbyPmsApiKey,onChange:p,label:l("organization.api.lobbyPms.apiKey"),placeholder:"API Token"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"lobbyPmsPropertyId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.lobbyPms.propertyId")}),(0,F.jsx)("input",{type:"text",id:"lobbyPmsPropertyId",name:"lobbyPmsPropertyId",value:g.lobbyPmsPropertyId,onChange:p,placeholder:"Property ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",name:"lobbyPmsSyncEnabled",checked:g.lobbyPmsSyncEnabled,onChange:p,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.lobbyPms.syncEnabled")})]}),(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",name:"lobbyPmsAutoCreateTasks",checked:g.lobbyPmsAutoCreateTasks,onChange:p,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.lobbyPms.autoCreateTasks")})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"lobbyPmsLateCheckInThreshold",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.lobbyPms.lateCheckInThreshold")}),(0,F.jsx)("input",{type:"time",id:"lobbyPmsLateCheckInThreshold",name:"lobbyPmsLateCheckInThreshold",value:g.lobbyPmsLateCheckInThreshold,onChange:p,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.ttlock.title")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"ttlockApiUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.apiUrl")}),(0,F.jsx)("input",{type:"text",id:"ttlockApiUrl",name:"ttlockApiUrl",value:g.ttlockApiUrl,onChange:p,placeholder:"https://open.ttlock.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"ttlockClientId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.clientId")}),(0,F.jsx)("input",{type:"text",id:"ttlockClientId",name:"ttlockClientId",value:g.ttlockClientId,onChange:p,placeholder:"Client ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsx)(v,{name:"ttlockClientSecret",value:g.ttlockClientSecret,onChange:p,label:l("organization.api.ttlock.clientSecret"),placeholder:"Client Secret"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"ttlockUsername",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.username")}),(0,F.jsx)("input",{type:"text",id:"ttlockUsername",name:"ttlockUsername",value:g.ttlockUsername,onChange:p,placeholder:"TTLock App Username (z.B. +573024498991)",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("organization.api.ttlock.usernameHint")})]}),(0,F.jsx)(v,{name:"ttlockPassword",value:g.ttlockPassword,onChange:p,label:l("organization.api.ttlock.password"),placeholder:"TTLock App Password"}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2",children:l("organization.api.ttlock.passwordHint")}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"ttlockPasscodeType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.passcodeType")}),(0,F.jsxs)("select",{id:"ttlockPasscodeType",name:"ttlockPasscodeType",value:g.ttlockPasscodeType,onChange:p,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"auto",children:l("organization.api.ttlock.passcodeTypeAuto")}),(0,F.jsx)("option",{value:"custom",children:l("organization.api.ttlock.passcodeTypeCustom")})]}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("organization.api.ttlock.passcodeTypeHint")})]})]})]}),(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.sire.title")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"sireApiUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.sire.apiUrl")}),(0,F.jsx)("input",{type:"text",id:"sireApiUrl",name:"sireApiUrl",value:g.sireApiUrl,onChange:p,placeholder:"https://api.sire.gov.co",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsx)(v,{name:"sireApiKey",value:g.sireApiKey,onChange:p,label:l("organization.api.sire.apiKey"),placeholder:"API Key"}),(0,F.jsx)(v,{name:"sireApiSecret",value:g.sireApiSecret,onChange:p,label:l("organization.api.sire.apiSecret"),placeholder:"API Secret"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"sirePropertyCode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.sire.propertyCode")}),(0,F.jsx)("input",{type:"text",id:"sirePropertyCode",name:"sirePropertyCode",value:g.sirePropertyCode,onChange:p,placeholder:"Property Code",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",name:"sireEnabled",checked:g.sireEnabled,onChange:p,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.sire.enabled")})]}),(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",name:"sireAutoRegisterOnCheckIn",checked:g.sireAutoRegisterOnCheckIn,onChange:p,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.sire.autoRegisterOnCheckIn")})]})]})]})]}),(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.boldPayment.title")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)(v,{name:"boldPaymentApiKey",value:g.boldPaymentApiKey,onChange:p,label:l("organization.api.boldPayment.apiKey"),placeholder:"API Key"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"boldPaymentMerchantId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.boldPayment.merchantId")}),(0,F.jsx)("input",{type:"text",id:"boldPaymentMerchantId",name:"boldPaymentMerchantId",value:g.boldPaymentMerchantId,onChange:p,placeholder:"Merchant ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"boldPaymentEnvironment",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.boldPayment.environment")}),(0,F.jsxs)("select",{id:"boldPaymentEnvironment",name:"boldPaymentEnvironment",value:g.boldPaymentEnvironment,onChange:p,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"sandbox",children:l("organization.api.boldPayment.sandbox")}),(0,F.jsx)("option",{value:"production",children:l("organization.api.boldPayment.production")})]})]})]})]}),(0,F.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.whatsapp.title")}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappProvider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.whatsapp.provider")}),(0,F.jsxs)("select",{id:"whatsappProvider",name:"whatsappProvider",value:g.whatsappProvider,onChange:p,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"twilio",children:l("organization.api.whatsapp.providerTwilio")}),(0,F.jsx)("option",{value:"whatsapp-business-api",children:l("organization.api.whatsapp.providerBusinessApi")})]})]}),(0,F.jsx)(v,{name:"whatsappApiKey",value:g.whatsappApiKey,onChange:p,label:l("organization.api.whatsapp.apiKey"),placeholder:"API Key / Access Token"}),(0,F.jsx)(v,{name:"whatsappApiSecret",value:g.whatsappApiSecret,onChange:p,label:l("organization.api.whatsapp.apiSecret"),placeholder:"API Secret (optional)"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.whatsapp.phoneNumberId")}),(0,F.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",name:"whatsappPhoneNumberId",value:g.whatsappPhoneNumberId,onChange:p,placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,F.jsx)("button",{type:"button",onClick:()=>{x({lobbyPmsApiKey:"",lobbyPmsPropertyId:"",lobbyPmsSyncEnabled:!1,lobbyPmsAutoCreateTasks:!1,lobbyPmsLateCheckInThreshold:"22:00",ttlockClientId:"",ttlockClientSecret:"",ttlockApiUrl:"https://open.ttlock.com",ttlockUsername:"",ttlockPassword:"",ttlockPasscodeType:"auto",sireApiUrl:"",sireApiKey:"",sireApiSecret:"",sireEnabled:!1,sireAutoRegisterOnCheckIn:!1,sirePropertyCode:"",boldPaymentApiKey:"",boldPaymentMerchantId:"",boldPaymentEnvironment:"sandbox",whatsappProvider:"twilio",whatsappApiKey:"",whatsappApiSecret:"",whatsappPhoneNumberId:""})},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",title:l("organization.api.clear"),children:(0,F.jsx)(D.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:m,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(m?"organization.saving":"common.save"),children:m?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]}):(0,F.jsx)("div",{className:"text-center py-8",children:(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:l("organization.api.noPermission")})})},Te=e=>{let{isOpen:t,onClose:a,onSuccess:n,organization:l}=e;const{t:i}=(0,s.Bd)(),{fetchCurrentUser:o}=(0,E.As)(),[d,u]=(0,r.useState)({displayName:"",domain:"",logo:"",country:null,nit:null,settings:{}}),[g,x]=(0,r.useState)(""),[b,h]=(0,r.useState)(""),[v,k]=(0,r.useState)(!1),[j,w]=(0,r.useState)({}),[N,A]=(0,r.useState)(window.innerWidth<640),[S,C]=(0,r.useState)(window.innerWidth>1070),{openSidepane:z,closeSidepane:R}=(0,L.N)(),{showMessage:T}=(0,f.A)(),{organizationLanguage:I,setOrganizationLanguage:P}=(0,Ne.o)(),[_,O]=(0,r.useState)(""),[B,q]=(0,r.useState)(!1),[V,U]=(0,r.useState)("general"),[M,G]=(0,r.useState)(null),[W,H]=(0,r.useState)(null),K=[{code:"CO",name:i("countries.CO")},{code:"CH",name:i("countries.CH")},{code:"DE",name:i("countries.DE")},{code:"AT",name:i("countries.AT")}];(0,r.useEffect)((()=>{if(t&&l){const e=l.settings||{};u({displayName:l.displayName||"",domain:l.domain||"",logo:l.logo||"",country:l.country||null,nit:l.nit||null,settings:e}),x(l.country||""),h(l.nit||""),l.logo?H(l.logo):H(null),G(null);(async()=>{try{const e=await ve.h.getOrganizationLanguage();O(e.language||"")}catch(e){console.error(i("organization.loadLanguageError"),e),O("")}})()}}),[t,l,i]),(0,r.useEffect)((()=>{const e=()=>{A(window.innerWidth<640),C(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?z():R(),()=>{R()})),[t,z,R]);const J=e=>{const{name:t,value:a}=e.target;"country"===t?(x(a),u((e=>(0,c.A)((0,c.A)({},e),{},{country:a||null}))),"CO"!==a&&(h(""),u((e=>(0,c.A)((0,c.A)({},e),{},{nit:null}))))):"nit"===t?(h(a),u((e=>(0,c.A)((0,c.A)({},e),{},{nit:a||null})))):u((e=>(0,c.A)((0,c.A)({},e),{},{[t]:a}))),j[t]&&w((e=>(0,c.A)((0,c.A)({},e),{},{[t]:""})))},Y=e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.match("image/(png|jpeg|jpg)"))return void T(i("organization.logoInvalidType")||"Nur PNG und JPEG Dateien sind erlaubt","error");if(a.size>5242880)return void T(i("organization.logoTooLarge")||"Logo darf maximal 5MB gro\xdf sein","error");G(a);const r=new FileReader;r.onloadend=()=>{const e=r.result;H(e),u((t=>(0,c.A)((0,c.A)({},t),{},{logo:e})))},r.readAsDataURL(a)},Z=async e=>{e.preventDefault();try{k(!0),w({}),await ve.h.updateOrganization(d),T(i("organization.updateSuccess"),"success");try{await o()}catch(s){console.error("Fehler beim Neuladen der User-Daten:",s)}a(),n&&n()}catch(l){var t,r;const e=(null===(t=l.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||i("organization.updateError");T(e,"error"),w({submit:e})}finally{k(!1)}},X=()=>{if(l){const e=l.settings||{};u({displayName:l.displayName||"",domain:l.domain||"",logo:l.logo||"",country:l.country||null,nit:l.nit||null,settings:e}),x(l.country||""),h(l.nit||"")}w({}),a()};return N?(0,F.jsxs)(m.lG,{open:t,onClose:X,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,F.jsx)("button",{onClick:X,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:Z,className:"p-4",children:[j.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:j.submit}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,F.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:d.displayName||"",onChange:J,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(j.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),j.displayName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:j.displayName})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,F.jsx)("input",{type:"text",id:"domain",name:"domain",value:d.domain||"",onChange:J,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"logo-mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logo")||"Logo"}),(0,F.jsx)("input",{type:"file",id:"logo-mobile",name:"logo",accept:"image/png,image/jpeg,image/jpg",onChange:Y,className:"mt-1 block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300 dark:hover:file:bg-blue-800"}),W&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("img",{src:W,alt:"Logo Preview",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})}),d.logo&&!W&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("img",{src:d.logo,alt:"Current Logo",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})})]}),(0,F.jsxs)("div",{className:"border-t pt-4",children:[(0,F.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,F.jsxs)("select",{id:"country",name:"country",value:g,onChange:J,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"",children:i("organization.selectCountry")}),K.map((e=>(0,F.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),(0,F.jsxs)("div",{className:"border-t pt-4",children:[(0,F.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,F.jsxs)("select",{id:"organizationLanguage",value:_||I||"",onChange:async e=>{const t=e.target.value;if(O(t),t&&t!==I){q(!0);try{await P(t),T(i("common.save"),"success")}catch(a){console.error(i("organization.saveLanguageError"),a),T(i("worktime.messages.orgLanguageError"),"error")}finally{q(!1)}}},disabled:B||v,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,F.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,F.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,F.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,F.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:X,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(v?"organization.saving":"common.save"),children:v?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!S&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:X,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,F.jsx)("button",{onClick:X,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,F.jsxs)("nav",{className:"-mb-px flex space-x-4 px-4","aria-label":"Tabs",children:[(0,F.jsx)("button",{type:"button",onClick:()=>U("general"),className:"".concat("general"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.general")}),(0,F.jsx)("button",{type:"button",onClick:()=>U("roles"),className:"".concat("roles"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.roles")}),(0,F.jsx)("button",{type:"button",onClick:()=>U("documents"),className:"".concat("documents"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.documents")}),(0,F.jsx)("button",{type:"button",onClick:()=>U("smtp"),className:"".concat("smtp"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.smtp")}),"CO"===g&&(0,F.jsx)("button",{type:"button",onClick:()=>U("api"),className:"".concat("api"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.api")})]})}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[j.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:j.submit}),"general"===V&&(0,F.jsxs)("form",{onSubmit:Z,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,F.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:d.displayName||"",onChange:J,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(j.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),j.displayName&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:j.displayName})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,F.jsx)("input",{type:"text",id:"domain",name:"domain",value:d.domain||"",onChange:J,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logo")||"Logo"}),(0,F.jsx)("input",{type:"file",id:"logo",name:"logo",accept:"image/png,image/jpeg,image/jpg",onChange:Y,className:"mt-1 block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300 dark:hover:file:bg-blue-800"}),W&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("img",{src:W,alt:"Logo Preview",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})}),d.logo&&!W&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("img",{src:d.logo,alt:"Current Logo",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})})]}),(0,F.jsxs)("div",{className:"border-t pt-4",children:[(0,F.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,F.jsxs)("select",{id:"country",name:"country",value:g,onChange:J,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,F.jsx)("option",{value:"",children:i("organization.selectCountry")}),K.map((e=>(0,F.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),"CO"===g&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"nit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.nit")}),(0,F.jsx)("input",{type:"text",id:"nit",name:"nit",value:b,onChange:J,placeholder:i("organization.nitDescription"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:i("organization.nitDescription")})]}),(0,F.jsxs)("div",{className:"border-t pt-4",children:[(0,F.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,F.jsxs)("select",{id:"organizationLanguage",value:_||I||"",onChange:async e=>{const t=e.target.value;if(O(t),t&&t!==I){q(!0);try{await P(t),T(i("common.save"),"success")}catch(a){console.error("Fehler beim Speichern der Organisation-Sprache:",a),T(i("worktime.messages.orgLanguageError"),"error")}finally{q(!1)}}},disabled:B||v,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,F.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,F.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,F.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,F.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:X,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(v?"organization.saving":"common.save"),children:v?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(y.A,{className:"h-5 w-5"})})]})]}),"roles"===V&&(0,F.jsx)(Ae,{organization:l,onSave:()=>{n&&n()}}),"documents"===V&&(0,F.jsx)(ze,{organization:l,onSave:()=>{n&&n()}}),"smtp"===V&&(0,F.jsx)(Re,{organization:l,onSave:()=>{n&&n()}}),"api"===V&&"CO"===g&&(0,F.jsx)(Fe,{organization:l,onSave:()=>{n&&n()}})]})]})]})},Ie=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Pe=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},_e="my-join-requests-table",Oe=()=>{const{t:e}=(0,s.Bd)(),[t,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),[i,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[u,g]=(0,r.useState)([]),[x,b]=(0,r.useState)([]),[h,y]=(0,r.useState)(""),{showMessage:v}=(0,f.A)(),k=(0,r.useRef)(!0),[N,A]=(0,r.useState)(null),[S,C]=(0,r.useState)("Alle"),[z,R]=(0,r.useState)(null);(0,r.useEffect)((()=>()=>{k.current=!1}),[]),(0,r.useEffect)((()=>{console.log("MyJoinRequestsList: useEffect called - component mounted"),console.log("MyJoinRequestsList: Resetting state on mount to prevent data leaks"),a([]),o(null),l(!0);let t=!0;return(async()=>{if(!t)return void console.log("MyJoinRequestsList: Component unmounted, skipping fetch");console.log("MyJoinRequestsList: Starting fetch");const r=setTimeout((()=>{t&&(console.error("Request timeout after 10 seconds"),o("Anfrage dauert zu lange. Bitte Seite neu laden."),l(!1))}),1e4);try{console.log("MyJoinRequestsList: Setting loading to true"),l(!0),o(null),console.log("MyJoinRequestsList: Fetching my join requests from:",w.Sn.ORGANIZATIONS.MY_JOIN_REQUESTS);const e=await ve.h.getMyJoinRequests();if(console.log("MyJoinRequestsList: Received requests:",e),console.log("MyJoinRequestsList: Requests type:",typeof e),console.log("MyJoinRequestsList: Requests isArray:",Array.isArray(e)),console.log("MyJoinRequestsList: Requests length:",(null===e||void 0===e?void 0:e.length)||0),!Array.isArray(e))throw console.error("\u274c MyJoinRequestsList: Response is not an array!",e),new Error("Ung\xfcltige Antwort vom Server");clearTimeout(r),t?(console.log("MyJoinRequestsList: Setting joinRequests state"),a(e),console.log("MyJoinRequestsList: State updated with",e.length,"requests")):(console.log("MyJoinRequestsList: Component was unmounted, but setting state anyway"),a(e))}catch(c){var s,n,i,d;if(clearTimeout(r),!t)return void console.log("MyJoinRequestsList: Component unmounted during error, skipping error handling");console.error("MyJoinRequestsList: Error fetching my join requests:",c),console.error("MyJoinRequestsList: Error response:",c.response),console.error("MyJoinRequestsList: Error status:",null===(s=c.response)||void 0===s?void 0:s.status),console.error("MyJoinRequestsList: Error data:",null===(n=c.response)||void 0===n?void 0:n.data);const a=(null===(i=c.response)||void 0===i||null===(d=i.data)||void 0===d?void 0:d.message)||c.message||e("myJoinRequests.loadError");o(a),setTimeout((()=>{v(a,"error")}),0)}finally{t?(console.log("MyJoinRequestsList: Setting loading to false"),l(!1)):(console.log("MyJoinRequestsList: Component unmounted, but setting loading to false anyway"),l(!1))}})(),()=>{console.log("MyJoinRequestsList: useEffect cleanup - component unmounting"),t=!1,k.current=!1,a([]),o(null)}}),[]);const E=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=(e,t)=>{g(e),b(t)},T=()=>{g([]),b([]),C(""),R(null)},I=()=>u.length;(0,r.useEffect)((()=>{(async()=>{try{const e=await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(_e)),t=e.data.find((e=>"Alle"===e.name));t&&(C("Alle"),R(t.id),L(t.conditions,t.operators))}catch(i){console.error("Fehler beim Setzen des initialen Filters:",i)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(_e))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:_e,name:"Alle",conditions:[],operators:[]};await j.A.post(w.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Meine Beitrittsanfragen erstellt")}}catch(i){console.error("Fehler beim Erstellen der Standard-Filter:",i)}})()}),[]);const P=(0,r.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var a;const r=(e.organization.displayName||e.organization.name||"").toLowerCase(),s=(null===(a=e.message)||void 0===a?void 0:a.toLowerCase())||"";return r.includes(t)||s.includes(t)}))}return u.length>0&&(e=u.reduce(((e,t,a)=>{if(!t.column||null===t.value||""===t.value)return e;const r=t.operator,s=t.value;return e.filter((e=>{var a;switch(t.column){case"organization":const t=(e.organization.displayName||e.organization.name||"").toLowerCase(),n=String(s).toLowerCase();return"contains"===r?t.includes(n):"equals"===r?t===n:"startsWith"===r&&t.startsWith(n);case"message":const l=(null===(a=e.message)||void 0===a?void 0:a.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===r?l.includes(i):"equals"===r?l===i:"startsWith"===r&&l.startsWith(i);case"status":return"equals"===r&&e.status===s;default:return!0}}))}),e)),e}),[t,h,u,x]);return(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("myJoinRequests.title")}),(0,F.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,F.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>y(e.target.value)}),(0,F.jsxs)("button",{className:"p-2 rounded-md border ".concat(I()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>m(!d),title:e("common.filter"),children:[(0,F.jsx)(Z.A,{className:"h-5 w-5"}),I()>0&&(0,F.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:I()})]})]})]}),d&&(0,F.jsx)("div",{className:"mb-4",children:(0,F.jsx)(X.A,{columns:[{id:"organization",label:e("myJoinRequests.filter.organization",{defaultValue:"Organisation"})},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:L,onReset:T,savedConditions:u,savedOperators:x,tableId:_e})}),(0,F.jsx)($.A,{tableId:_e,onSelectFilter:L,onReset:T,activeFilterName:S,selectedFilterId:z,onFilterChange:(e,t,a,r)=>{C(e),R(t),L(a,r)},defaultFilterName:"Alle"}),i&&(0,F.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:i}),n?(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("myJoinRequests.loading")})]}):0===t.length?(0,F.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("myJoinRequests.noRequests")}):(0,F.jsx)("div",{className:"space-y-4",children:P.map((t=>(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsx)("div",{className:"flex items-start justify-between",children:(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.organization.displayName||t.organization.name}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:E(t.createdAt)})]}),(0,F.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(Ie(t.status)),children:Pe(t.status,e)})]}),t.message&&(0,F.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,F.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,F.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,F.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,F.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,F.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),t.processor&&(0,F.jsxs)("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e("myJoinRequests.processedBy"),": ",t.processor.firstName," ",t.processor.lastName,t.processedAt&&" - ".concat(E(t.processedAt))]}),"pending"===t.status&&(0,F.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,F.jsx)("button",{onClick:()=>(async t=>{if(window.confirm(e("myJoinRequests.confirmWithdraw")))try{A(t),await ve.h.withdrawJoinRequest(t),a((e=>e.map((e=>e.id===t?(0,c.A)((0,c.A)({},e),{},{status:"withdrawn",processedAt:(new Date).toISOString()}):e)))),v(e("myJoinRequests.withdrawSuccess"),"success")}catch(n){var r,s;const t=(null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||e("myJoinRequests.withdrawError");v(t,"error")}finally{A(null)}})(t.id),disabled:N===t.id,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md dark:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:N===t.id?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(D.A,{className:"h-4 w-4 mr-1 animate-spin"}),e("myJoinRequests.withdrawing")]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(p.A,{className:"h-4 w-4 mr-1"}),e("myJoinRequests.withdraw")]})})})]})})},t.id)))})]})},Be=()=>{const[e,t]=(0,r.useState)(null),[a,i]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),[m,u]=(0,r.useState)(!1),[x,b]=(0,r.useState)(null),[p,y]=(0,r.useState)(!1),[v,k]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),{canViewOrganization:N,canManageOrganization:A,loading:C}=(0,n.S)(),{showMessage:z}=(0,f.A)(),{t:R}=(0,s.Bd)(),{refreshOrganization:D}=(0,ke.Z)(),E=(0,r.useCallback)((async()=>{try{c(!0),b(null);const e=await ve.h.getCurrentOrganization();t(e);try{u(!0);const e=await ve.h.getOrganizationStats();i(e)}catch(l){console.error("Fehler beim Laden der Statistiken:",l)}finally{u(!1)}}catch(o){var e,a,r;if(404===(null===(e=o.response)||void 0===e?void 0:e.status)&&!1===(null===(a=o.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.hasOrganization))b(R("organization.notFound")),t(null),z(R("organization.notFound"),"info");else{var s,n;const e=(null===(s=o.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||R("organization.loadError");b(e),z(e,"error")}}finally{c(!1)}}),[]),L=(0,r.useRef)(!1);(0,r.useEffect)((()=>{if(C)return;if(L.current)return;N()?(L.current=!0,E()):(b(R("organization.noPermission")),c(!1),L.current=!0)}),[C]);if(C)return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingPermissions")})]})});if(!N())return(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,F.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:R("organization.noPermission")})});return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)("div",{className:"flex items-center mb-4 sm:mb-4",children:(0,F.jsxs)("div",{className:"flex items-center","data-onboarding":"organization-buttons",children:[(0,F.jsx)("button",{onClick:()=>y(!0),"data-onboarding":"create-organization-button",className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:R("organization.createOrganization"),"aria-label":R("organization.createOrganization"),children:(0,F.jsx)(g.A,{className:"h-4 w-4"})}),(0,F.jsx)("button",{onClick:()=>k(!0),"data-onboarding":"join-organization-button",className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center ml-2",style:{width:"30.19px",height:"30.19px"},title:R("organization.joinOrganization"),"aria-label":R("organization.joinOrganization"),children:(0,F.jsx)(pe.A,{className:"h-4 w-4"})})]})}),d?(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingOrganization")})]}):(0,F.jsxs)(F.Fragment,{children:[x&&(0,F.jsx)("div",{className:"mb-4 p-4 border rounded ".concat(e?"bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300":"bg-blue-50 dark:bg-blue-900/30 border-blue-400 dark:border-blue-700 text-blue-700 dark:text-blue-300"),children:(0,F.jsxs)("div",{className:"flex items-start",children:[(0,F.jsx)("div",{className:"flex-shrink-0",children:e?(0,F.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"\u26a0\ufe0f"}):(0,F.jsx)(l.A,{className:"h-5 w-5"})}),(0,F.jsxs)("div",{className:"ml-3 flex-1",children:[(0,F.jsx)("p",{className:"font-medium",children:x}),!e&&(0,F.jsx)("p",{className:"mt-2 text-sm",children:R("organization.createOrJoinHint")})]})]})}),e?(0,F.jsx)(F.Fragment,{children:(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsx)("div",{className:"flex items-start justify-between",children:(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[(0,F.jsx)(h.A,{className:"h-5 w-5 mr-2"}),e.displayName||e.name]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.domain||R("organization.noDomain")})]}),A()&&(0,F.jsx)("button",{onClick:()=>w(!0),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:R("organization.edit.title"),children:(0,F.jsx)(S.A,{className:"h-5 w-5"})})]}),(0,F.jsx)("div",{className:"space-y-3",children:e.subscriptionPlan&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[R("organization.subscriptionPlan"),":"]}),(0,F.jsx)("span",{className:"ml-2 text-sm text-gray-900 dark:text-white capitalize",children:e.subscriptionPlan})]})}),a&&(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:R("organization.statistics")}),m?(0,F.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),(0,F.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:R("common.loadingStatistics")})]}):(0,F.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3",children:(0,F.jsx)(l.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,F.jsxs)("div",{className:"ml-4",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.users")}),(0,F.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[a.currentUsers," / ",a.maxUsers]}),void 0!==a.utilizationPercent&&(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.utilizationPercent,"% ",R("organization.utilizationPercent")]})]})]})}),(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"flex-shrink-0 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3",children:(0,F.jsx)(o.A,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,F.jsxs)("div",{className:"ml-4",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.roles")}),(0,F.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:a._count.roles})]})]})}),(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3",children:(0,F.jsx)(ye.A,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),(0,F.jsxs)("div",{className:"ml-4",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.joinRequests")}),(0,F.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:a._count.joinRequests})]})]})}),void 0!==a._count.invitations&&(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"flex-shrink-0 bg-green-100 dark:bg-green-900/30 rounded-lg p-3",children:(0,F.jsx)(ye.A,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,F.jsxs)("div",{className:"ml-4",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.invitations")}),(0,F.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:a._count.invitations})]})]})}),void 0!==a.utilizationPercent&&(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"flex-shrink-0 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-3",children:(0,F.jsx)(fe.A,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),(0,F.jsxs)("div",{className:"ml-4",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.utilization")}),(0,F.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[a.utilizationPercent,"%"]}),(0,F.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.availableSlots," ",R("organization.availableSlots")]})]})]})})]})]})})]})})})}):(0,F.jsxs)("div",{className:"text-center py-8",children:[(0,F.jsx)(l.A,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:R("organization.notFound")}),(0,F.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:R("organization.createOrJoinHint")})]})]})]}),(0,F.jsx)(Oe,{}),(0,F.jsx)(je,{isOpen:p,onClose:()=>y(!1),onSuccess:()=>{E()}}),(0,F.jsx)(we,{isOpen:v,onClose:()=>k(!1),onSuccess:()=>{E()}}),(0,F.jsx)(Te,{isOpen:j,onClose:()=>w(!1),onSuccess:()=>{E(),D()},organization:e})]})},qe=e=>{let{isOpen:t,onClose:a,joinRequest:n,onSuccess:l}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,r.useState)("approve"),[g,x]=(0,r.useState)(null),[b,h]=(0,r.useState)(""),[v,k]=(0,r.useState)([]),[j,w]=(0,r.useState)(!1),[N,A]=(0,r.useState)(!1),[S,C]=(0,r.useState)({}),[z,R]=(0,r.useState)(window.innerWidth<640),[E,T]=(0,r.useState)(window.innerWidth>1070),{openSidepane:I,closeSidepane:P}=(0,L.N)(),{showMessage:_}=(0,f.A)();(0,r.useEffect)((()=>{const e=()=>{R(window.innerWidth<640),T(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?I():P(),()=>{P()})),[t,I,P]),(0,r.useEffect)((()=>{t&&n&&(d("approve"),x(null),h(""),C({}),n.organizationId&&O())}),[t,n]);const O=async()=>{try{w(!0);const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&k(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),_(i("joinRequest.loadRolesError"),"error")}finally{w(!1)}},q=async e=>{if(e.preventDefault(),(()=>{const e={};return"approve"!==o||g||(e.roleId=i("joinRequest.selectRoleError")),C(e),0===Object.keys(e).length})()){if(n)try{A(!0);const e={action:o,response:b.trim()||void 0,roleId:"approve"===o&&g||void 0};await ve.h.processJoinRequest(n.id,e),_(i("approve"===o?"joinRequest.approveSuccess":"joinRequest.rejectSuccess"),"success"),d("approve"),x(null),h(""),C({}),a(),l()}catch(s){var t,r;const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||i("joinRequest.processError");_(e,"error"),C({submit:e})}finally{A(!1)}}else _(i("joinRequest.fillRequired"),"error")},V=()=>{d("approve"),x(null),h(""),C({}),a()};return n?z?(0,F.jsxs)(m.lG,{open:t,onClose:V,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,F.jsx)("button",{onClick:V,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:q,className:"p-4",children:[S.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,F.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,F.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[n.requester.firstName," ",n.requester.lastName]}),(0,F.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.requester.email}),n.message&&(0,F.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,F.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,F.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.message})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,F.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,F.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,F.jsxs)("div",{className:"flex items-center py-2",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,F.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,F.jsxs)("select",{id:"roleId",value:g||"",onChange:e=>{x(Number(e.target.value)||null),S.roleId&&C((e=>(0,c.A)((0,c.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,F.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),v.map((e=>(0,F.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,F.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:V,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("joinRequest.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:N,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:i(N?"approve"===o?"joinRequest.approving":"joinRequest.rejecting":"approve"===o?"joinRequest.approve":"joinRequest.reject"),children:N?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,F.jsx)(y.A,{className:"h-5 w-5"}):(0,F.jsx)(B.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!E&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:V,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,F.jsx)("button",{onClick:V,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(p.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[S.submit&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,F.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,F.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,F.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,F.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[n.requester.firstName," ",n.requester.lastName]}),(0,F.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.requester.email}),n.message&&(0,F.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,F.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,F.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.message})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,F.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,F.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,F.jsxs)("label",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,F.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,F.jsxs)("div",{className:"flex items-center py-2",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,F.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,F.jsxs)("select",{id:"roleId",value:g||"",onChange:e=>{x(Number(e.target.value)||null),S.roleId&&C((e=>(0,c.A)((0,c.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,F.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),v.map((e=>(0,F.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,F.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:V,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,F.jsx)(p.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:N,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:N?"approve"===o?"Genehmige...":"Lehne ab...":"approve"===o?"Genehmigen":"Ablehnen",children:N?(0,F.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,F.jsx)(y.A,{className:"h-5 w-5"}):(0,F.jsx)(B.A,{className:"h-5 w-5"})})]})]})]})]})]}):null},Ve=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Ue=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},Me="join-requests-table",Ge=()=>{const{t:e}=(0,s.Bd)(),[t,a]=(0,r.useState)([]),[l,i]=(0,r.useState)(!0),[o,d]=(0,r.useState)(null),[c,m]=(0,r.useState)(!1),[u,g]=(0,r.useState)([]),[x,b]=(0,r.useState)([]),[h,p]=(0,r.useState)(""),[y,v]=(0,r.useState)(!1),[k,N]=(0,r.useState)(null),[A,C]=(0,r.useState)("Alle"),[z,R]=(0,r.useState)(null),{canViewJoinRequests:D,canManageJoinRequests:E,loading:L}=(0,n.S)(),{showMessage:T}=(0,f.A)(),I=(0,r.useRef)(!0),P=(0,r.useRef)(!1);(0,r.useEffect)((()=>{console.log("[JoinRequestsList] permissionsLoading ge\xe4ndert:",L)}),[L]),(0,r.useEffect)((()=>(console.log("[JoinRequestsList] Component mounted, reset hasInitialLoadRef"),P.current=!1,I.current=!0,()=>{console.log("[JoinRequestsList] Component unmounting"),I.current=!1})),[]),(0,r.useEffect)((()=>{if(console.log("[JoinRequestsList] useEffect triggered",{permissionsLoading:L,hasInitialLoad:P.current,joinRequestsCount:t.length}),L)return void console.log("[JoinRequestsList] Warte auf Berechtigungen...");const r=D();if(console.log("[JoinRequestsList] Berechtigung gepr\xfcft:",r),!r)return console.log("[JoinRequestsList] Keine Berechtigung zum Anzeigen"),d(e("joinRequestsList.noPermission")),i(!1),void(P.current=!0);if(P.current)return void console.log("[JoinRequestsList] Bereits geladen, \xfcberspringe Fetch");console.log("[JoinRequestsList] Starte Fetch der Join Requests...");(async()=>{if(I.current)try{console.log("[JoinRequestsList] Setze loading auf true"),i(!0),d(null),console.log("[JoinRequestsList] Rufe organizationService.getJoinRequests() auf..."),console.log("[JoinRequestsList] API Endpoint:",w.Sn.ORGANIZATIONS.JOIN_REQUESTS);const e=await ve.h.getJoinRequests();if(console.log("[JoinRequestsList] Antwort erhalten:",e),console.log("[JoinRequestsList] Antwort Typ:",typeof e),console.log("[JoinRequestsList] Ist Array:",Array.isArray(e)),console.log("[JoinRequestsList] Ist null/undefined:",null===e||void 0===e),!I.current)return void console.log("[JoinRequestsList] Component w\xe4hrend Request unmounted");if(null===e||void 0===e)throw console.error("[JoinRequestsList] \u274c Antwort ist null oder undefined!"),new Error("Ung\xfcltige Antwort vom Server: Antwort ist null oder undefined");if(!Array.isArray(e))throw console.error("[JoinRequestsList] \u274c Antwort ist kein Array!",e),new Error("Ung\xfcltige Antwort vom Server: Erwartetes Array, erhalten: "+typeof e);console.log("[JoinRequestsList] \u2705 Setze",e.length,"Join Requests"),a(e),d(null),P.current=!0}catch(l){var t,r,s,n;if(console.error("[JoinRequestsList] \u274c Fehler beim Laden:",l),console.error("[JoinRequestsList] Fehler Details:",{message:l.message,response:l.response,status:null===(t=l.response)||void 0===t?void 0:t.status,data:null===(r=l.response)||void 0===r?void 0:r.data,stack:l.stack}),!I.current)return void console.log("[JoinRequestsList] Component w\xe4hrend Error-Handling unmounted");const a=(null===(s=l.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||l.message||e("joinRequestsList.loadError",{defaultValue:"Fehler beim Laden der Beitrittsanfragen"});console.log("[JoinRequestsList] Zeige Fehlermeldung:",a),d(a),setTimeout((()=>{T(a,"error")}),0)}finally{I.current&&(console.log("[JoinRequestsList] Setze loading auf false"),i(!1))}else console.log("[JoinRequestsList] Component unmounted, breche ab")})()}),[L]);const _=(e,t)=>{g(e),b(t)},O=()=>{g([]),b([]),C(""),R(null)},B=()=>u.length;(0,r.useEffect)((()=>{(async()=>{try{const e=await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(Me)),t=e.data.find((e=>"Alle"===e.name));t&&(C("Alle"),R(t.id),_(t.conditions,t.operators))}catch(o){console.error("Fehler beim Setzen des initialen Filters:",o)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await j.A.get(w.Sn.SAVED_FILTERS.BY_TABLE(Me))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:Me,name:"Alle",conditions:[],operators:[]};await j.A.post(w.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Join Requests erstellt")}}catch(o){console.error("Fehler beim Erstellen der Standard-Filter:",o)}})()}),[]);const q=(0,r.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var a,r;const s="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),n=(null===(a=e.requester.email)||void 0===a?void 0:a.toLowerCase())||"",l=(null===(r=e.message)||void 0===r?void 0:r.toLowerCase())||"";return s.includes(t)||n.includes(t)||l.includes(t)}))}return u.length>0&&(e=u.reduce(((e,t,a)=>{if(!t.column||null===t.value||""===t.value)return e;const r=t.operator,s=t.value;return e.filter((e=>{var a,n;switch(t.column){case"requester":const t="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),l=(null===(a=e.requester.email)||void 0===a?void 0:a.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===r?t.includes(i)||l.includes(i):"equals"===r?t===i||l===i:"startsWith"===r&&(t.startsWith(i)||l.startsWith(i));case"message":const o=(null===(n=e.message)||void 0===n?void 0:n.toLowerCase())||"",d=String(s).toLowerCase();return"contains"===r?o.includes(d):"equals"===r?o===d:"startsWith"===r&&o.startsWith(d);case"status":return"equals"===r&&e.status===s;default:return!0}}))}),e)),e}),[t,h,u,x]);return L?(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loadingPermissions")})]})}):D()?(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 sm:p-6 mb-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-4",children:[(0,F.jsxs)("h2",{className:"text-xl sm:text-xl font-semibold flex items-center dark:text-white",children:[(0,F.jsx)(pe.A,{className:"h-6 w-6 sm:h-6 sm:w-6 mr-2 sm:mr-2"}),e("joinRequestsList.title")]}),(0,F.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,F.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>p(e.target.value)}),(0,F.jsxs)("button",{className:"p-2 rounded-md border ".concat(B()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>m(!c),title:e("common.filter"),children:[(0,F.jsx)(Z.A,{className:"h-5 w-5"}),B()>0&&(0,F.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:B()})]})]})]}),c&&(0,F.jsx)("div",{className:"mb-4",children:(0,F.jsx)(X.A,{columns:[{id:"requester",label:e("joinRequestsList.filter.requester")},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:_,onReset:O,savedConditions:u,savedOperators:x,tableId:Me})}),(0,F.jsx)($.A,{tableId:Me,onSelectFilter:_,onReset:O,activeFilterName:A,selectedFilterId:z,onFilterChange:(e,t,a,r)=>{C(e),R(t),_(a,r)},defaultFilterName:"Alle"}),o&&(0,F.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:o}),l?(0,F.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,F.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loading")})]}):0===q.length?(0,F.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:0===t.length?e("joinRequestsList.noRequests"):e("joinRequestsList.noMatching")}):(0,F.jsx)("div",{className:"space-y-4",children:q.map((t=>(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,F.jsx)("div",{className:"flex items-start justify-between",children:(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.requester.firstName," ",t.requester.lastName]}),(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.requester.email})]}),(0,F.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(Ve(t.status)),children:Ue(t.status,e)})]}),t.message&&(0,F.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,F.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,F.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,F.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,F.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,F.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),"pending"===t.status&&E()&&(0,F.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,F.jsxs)("button",{onClick:()=>(t=>{if(!E()){const t=e("joinRequestsList.noPermissionEdit");return d(t),void T(t,"error")}N(t),v(!0)})(t),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center",children:[(0,F.jsx)(S.A,{className:"h-4 w-4 mr-1"}),e("joinRequestsList.edit")]})})]})})},t.id)))}),(0,F.jsx)(qe,{isOpen:y,onClose:()=>{v(!1),N(null)},joinRequest:k,onSuccess:async()=>{P.current=!1;try{i(!0);const e=await ve.h.getJoinRequests();a(e),d(null),P.current=!0}catch(r){var e,t;const a=(null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Laden der Beitrittsanfragen";d(a),P.current=!0}finally{i(!1)}}})]}):(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,F.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("joinRequestsList.noPermission")})})},We=()=>{const{t:e}=(0,s.Bd)(),[t,a]=(0,r.useState)(!1),[c,m]=(0,r.useState)(null),{showMessage:u}=(0,f.A)(),{isAdmin:g,hasPermission:x,canViewOrganization:b,loading:h}=(0,n.S)(),p=x("organization_management","read","page"),y=x("users","read","table"),v=x("roles","read","table"),k=x("branches","read","table"),j=b(),[w,N]=(0,r.useState)("users"),A=(0,r.useRef)(!1);(0,r.useEffect)((()=>{if(!h&&!A.current){let e="organization";y?e="users":v?e="roles":k?e="branches":j&&(e="organization"),N(e),A.current=!0}}),[h,y,v,k,j]);const S=e=>{("users"!==e||y)&&("roles"!==e||v)&&("branches"!==e||k)&&("organization"!==e||j)&&(N(e),m(null))},C=t=>{var a,r;let s=e("errors.unknownError");null!==(a=t.response)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&r.message?s=t.response.data.message:t instanceof Error&&(s=t.message),m(s),u(s,"error")};return p?(0,F.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,F.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center mb-6",children:[(0,F.jsx)(l.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,F.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("organisation.title")})]}),(0,F.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,F.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,F.jsxs)("button",{className:"".concat("users"===w&&y?"border-blue-500 text-blue-600 dark:text-blue-400":y?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>y&&S("users"),disabled:!y,children:[(0,F.jsx)(i.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.users"),!y&&(0,F.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),(0,F.jsxs)("button",{className:"".concat("roles"===w&&v?"border-blue-500 text-blue-600 dark:text-blue-400":v?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>v&&S("roles"),disabled:!v,children:[(0,F.jsx)(o.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.roles"),!v&&(0,F.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),(0,F.jsxs)("button",{className:"".concat("branches"===w&&k?"border-blue-500 text-blue-600 dark:text-blue-400":k?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>k&&S("branches"),disabled:!k,children:[(0,F.jsx)(d.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.branches",{defaultValue:"Niederlassungen"}),!k&&(0,F.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),j&&(0,F.jsxs)("button",{className:"".concat("organization"===w?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center"),onClick:()=>S("organization"),children:[(0,F.jsx)(l.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.organization")]})]})}),c&&(0,F.jsxs)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded mb-4",children:[(0,F.jsx)("p",{className:"font-bold",children:e("organisation.error")}),(0,F.jsx)("p",{children:c})]}),t&&(0,F.jsx)("div",{className:"p-4 dark:text-gray-300",children:e("organisation.loading")}),(0,F.jsx)("div",{className:"mt-6",children:"users"===w?y?(0,F.jsx)(H,{onError:C}):(0,F.jsx)("div",{className:"p-8 text-center",children:(0,F.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,F.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,F.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.users")})]})}):"roles"===w?v?(0,F.jsx)(ge,{onError:C}):(0,F.jsx)("div",{className:"p-8 text-center",children:(0,F.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,F.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,F.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.roles")})]})}):"branches"===w?k?(0,F.jsx)(he,{onError:C}):(0,F.jsx)("div",{className:"p-8 text-center",children:(0,F.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,F.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,F.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.branches",{defaultValue:"Niederlassungs-Verwaltung ist eine PRO-Funktion"})})]})}):"organization"===w&&j?(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsx)(Be,{}),(0,F.jsx)(Ge,{})]}):(0,F.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("organisation.noPermissionForPage")})})]})})}):(0,F.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("organisation.noPermission")})}}}]);
//# sourceMappingURL=931.d00e6c2a.chunk.js.map