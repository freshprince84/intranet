"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[170],{170:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ne});var a=r(5043),s=r(4117),n=r(2760),l=r(7504),o=r(7012),i=r(2302),d=r(8662),c=r(45);const u=["title","titleId"];function m(e,t){let{title:r,titleId:s}=e,n=(0,c.A)(e,u);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const h=a.forwardRef(m);var x=r(9422),g=r(1801),b=r(1923),y=r(1713),p=r(2672),f=r(7952),v=r(7488),k=r(6443),w=r(7591),j=r(7449),N=r(2811),C=r(9248);const S=async e=>{try{return(await b.A.delete(g.Sn.CLIENTS.BY_ID(e))).data}catch(t){throw console.error("Fehler beim L\xf6schen des Clients:",t),t}},A=async()=>{try{return(await b.A.get(g.Sn.CLIENTS.RECENT)).data}catch(e){throw console.error("Fehler beim Laden der zuletzt beratenen Clients:",e),e}};var T=r(9379),E=r(1816),F=r(7855),D=r(5657),R=r(579);const L=e=>{let{isOpen:t,onClose:r,onClientUpdated:n,onClientDeleted:l,client:o}=e;const{t:i}=(0,s.Bd)(),{showMessage:d}=(0,F.A)(),{openSidepane:c,closeSidepane:u}=(0,D.N)(),[m,h]=(0,a.useState)(window.innerWidth>1070),[y,p]=(0,a.useState)({name:"",company:"",email:"",phone:"",address:"",notes:"",isActive:!0}),[f,v]=(0,a.useState)({}),[j,N]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1),[I,_]=(0,a.useState)(window.innerWidth<640);(0,a.useEffect)((()=>{t&&o&&(p({name:o.name||"",company:o.company||"",email:o.email||"",phone:o.phone||"",address:o.address||"",notes:o.notes||"",isActive:void 0===o.isActive||o.isActive}),L(!1),v({}))}),[t,o]),(0,a.useEffect)((()=>{const e=()=>{_(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?c():u(),()=>{u()})),[t,c,u]);const M=async e=>{if(e.preventDefault(),(()=>{const e={};return y.name.trim()||(e.name="Name ist erforderlich"),y.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),v(e),0===Object.keys(e).length})()&&o)try{N(!0);const e=await(async(e,t)=>{try{return(await b.A.put(g.Sn.CLIENTS.BY_ID(e),t)).data}catch(r){throw console.error("Fehler beim Aktualisieren des Clients:",r),r}})(o.id,{name:y.name,company:y.company||void 0,email:y.email||void 0,phone:y.phone||void 0,address:y.address||void 0,notes:y.notes||void 0,isActive:y.isActive});d(i("client.updateSuccess",{defaultValue:"Client erfolgreich aktualisiert"}),"success"),null===n||void 0===n||n(e)}catch(a){var t,r;d((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||i("client.updateError",{defaultValue:"Fehler beim Aktualisieren des Clients"}),"error")}finally{N(!1)}},O=async()=>{if(A){if(o)try{N(!0),await S(o.id),d(i("client.deleteSuccess",{defaultValue:"Client erfolgreich gel\xf6scht"}),"success"),null===l||void 0===l||l(o.id),r()}catch(m){var e,t,a,s,n,c,u;const r=(null===(e=m.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||i("client.deleteError",{defaultValue:"Fehler beim L\xf6schen des Clients"}),l=null===(a=m.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.details,o=null===(n=m.response)||void 0===n||null===(c=n.data)||void 0===c?void 0:c.suggestion;if(409===(null===(u=m.response)||void 0===u?void 0:u.status)&&l){const e=Object.entries(l).filter((e=>{let[t,r]=e;return r>0})).map((e=>{let[t,r]=e;const a="workTimes"===t?"client.workTimes":"consultationInvoices"===t?"client.consultationInvoices":"client.monthlyReports";return"".concat(r," ").concat(i(a,{defaultValue:"workTimes"===t?"Zeiteintr\xe4ge":"consultationInvoices"===t?"Rechnungen":"Monatsberichte"}))})).join(", ");d("".concat(r,". ").concat(i("client.links",{defaultValue:"Verkn\xfcpfungen"}),": ").concat(e,". ").concat(o||""),"error")}else d(r,"error");L(!1)}finally{N(!1)}}else L(!0)},B=e=>{const{name:t,value:r,type:a}=e.target,s=e.target.checked;p((e=>(0,T.A)((0,T.A)({},e),{},{[t]:"checkbox"===a?s:r}))),f[t]&&v((e=>(0,T.A)((0,T.A)({},e),{},{[t]:""})))},P=()=>{L(!1),v({}),r()};return o?I?(0,R.jsxs)(k.lG,{open:t,onClose:P,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsxs)(k.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,R.jsx)(k.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,R.jsx)("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("form",{onSubmit:M,className:"p-4",children:[(0,R.jsxs)("div",{className:"space-y-4",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,R.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:y.name,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.name&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.name})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,R.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:y.company,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,R.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:y.email,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.email&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.email})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,R.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:y.phone,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,R.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:y.address,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,R.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:y.notes,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("input",{type:"checkbox",id:"isActive_mobile",name:"isActive",checked:y.isActive,onChange:B,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,R.jsx)("label",{htmlFor:"isActive_mobile",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]})]}),(0,R.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,R.jsxs)("button",{type:"button",onClick:O,disabled:j,className:"inline-flex items-center px-4 py-2 border ".concat(A?"border-red-300 text-red-700 bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-red-900/20":"border-red-300 text-red-700 bg-white hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-gray-700 dark:hover:bg-gray-600"," text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,R.jsx)(C.A,{className:"h-5 w-5 mr-2"}),A?"Wirklich l\xf6schen?":"L\xf6schen"]}),(0,R.jsxs)("div",{className:"flex space-x-3",children:[(0,R.jsx)("button",{type:"button",onClick:P,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:j?"Speichere...":"Speichern",children:j?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(x.A,{className:"h-5 w-5"})})]})]})]})]})})]}):(0,R.jsxs)(R.Fragment,{children:[t&&!m&&(0,R.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:P,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,R.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,R.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,R.jsx)("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(f).length>0&&(0,R.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(f).map(((e,t)=>(0,R.jsx)("p",{children:e},t)))}),(0,R.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,R.jsx)("input",{type:"text",id:"name",name:"name",value:y.name,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.name&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.name})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,R.jsx)("input",{type:"text",id:"company",name:"company",value:y.company,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,R.jsx)("input",{type:"email",id:"email",name:"email",value:y.email,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.email&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.email})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,R.jsx)("input",{type:"tel",id:"phone",name:"phone",value:y.phone,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,R.jsx)("input",{type:"text",id:"address",name:"address",value:y.address,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,R.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:y.notes,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("input",{type:"checkbox",id:"isActive",name:"isActive",checked:y.isActive,onChange:B,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,R.jsx)("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]}),(0,R.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,R.jsx)("button",{type:"button",onClick:O,disabled:j,className:"p-2 rounded-md ".concat(A?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"," disabled:opacity-50 disabled:cursor-not-allowed"),title:A?"L\xf6schen best\xe4tigen":"Client l\xf6schen",children:A?(0,R.jsx)(x.A,{className:"h-5 w-5"}):(0,R.jsx)(C.A,{className:"h-5 w-5"})}),(0,R.jsxs)("div",{className:"flex gap-2",children:[(0,R.jsx)("button",{type:"button",onClick:P,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:j?"Speichere...":"Speichern",children:j?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(x.A,{className:"h-5 w-5"})})]})]})]})]})]})]}):null},I=e=>{let{isOpen:t,onClose:r,onSelect:n,onCreateNew:l}=e;const{t:o}=(0,s.Bd)(),[i,c]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[h,x]=(0,a.useState)(""),[y,p]=(0,a.useState)(!0),[f,A]=(0,a.useState)(null),[T,E]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t&&F()}),[t]),(0,a.useEffect)((()=>{if(h){const e=i.filter((e=>e.name.toLowerCase().includes(h.toLowerCase())||e.company&&e.company.toLowerCase().includes(h.toLowerCase())||e.email&&e.email.toLowerCase().includes(h.toLowerCase())));m(e)}else m(i)}),[h,i]);const F=async()=>{try{p(!0);const e=await b.A.get(g.Sn.CLIENTS.BASE);c(e.data),m(e.data)}catch(e){}finally{p(!1)}};return(0,R.jsxs)(k.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsx)(k.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,R.jsxs)("div",{className:"p-6",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,R.jsx)(k.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Client ausw\xe4hlen"}),(0,R.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"relative mb-4",children:[(0,R.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,R.jsx)(j.A,{className:"h-5 w-5 text-gray-400"})}),(0,R.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Client suchen...",autoFocus:!0})]}),(0,R.jsx)("div",{className:"max-h-96 overflow-y-auto",children:y?(0,R.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"Lade Clients..."}):0===u.length?(0,R.jsxs)("div",{className:"text-center py-8",children:[(0,R.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:h?"Keine Clients gefunden":"Noch keine Clients vorhanden"}),(0,R.jsxs)("button",{onClick:l,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,R.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Neuen Client anlegen"]})]}):(0,R.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:u.map((e=>(0,R.jsx)("li",{children:(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("button",{onClick:()=>n(e),className:"flex-1 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-left transition-colors",children:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),e.company&&(0,R.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.company}),e.email&&(0,R.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),(0,R.jsxs)("div",{className:"flex items-center space-x-2 px-2",children:[(0,R.jsx)("button",{onClick:t=>((e,t)=>{t.stopPropagation(),A(e),E(!0)})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:"Client bearbeiten",children:(0,R.jsx)(N.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{onClick:t=>(async(e,t)=>{if(t.stopPropagation(),window.confirm(o("client.deleteConfirm",{name:e.name})))try{await S(e.id),v.oR.success(o("client.deleteSuccess")),F()}catch(s){var r,a;v.oR.error((null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||o("client.deleteError"))}})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:o("client.deleteTitle"),children:(0,R.jsx)(C.A,{className:"h-5 w-5"})})]})]})},e.id)))})}),u.length>0&&(0,R.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,R.jsxs)("button",{onClick:l,className:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,R.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Neuen Client anlegen"]})})]})})}),f&&(0,R.jsx)(L,{isOpen:T,onClose:()=>{E(!1),A(null)},onClientUpdated:e=>{const t=i.findIndex((t=>t.id===e.id));if(-1!==t){const r=[...i];r[t]=e,c(r),m(r)}E(!1),A(null)},onClientDeleted:e=>{F(),E(!1),A(null)},client:f})]})},_=e=>{let{isOpen:t,onClose:r,onSave:n}=e;const{t:l}=(0,s.Bd)(),{showMessage:o}=(0,F.A)(),{openSidepane:i,closeSidepane:d}=(0,D.N)(),[c,u]=(0,a.useState)(window.innerWidth>1070),[m,h]=(0,a.useState)({name:"",company:"",email:"",phone:"",address:"",notes:""}),[y,p]=(0,a.useState)({}),[f,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(window.innerWidth<640),C=async e=>{if(e.preventDefault(),(()=>{const e={};return m.name.trim()||(e.name="Name ist erforderlich"),m.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),p(e),0===Object.keys(e).length})())try{v(!0);const e=await b.A.post(g.Sn.CLIENTS.BASE,(0,T.A)((0,T.A)({},m),{},{company:m.company||null,email:m.email||null,phone:m.phone||null,address:m.address||null,notes:m.notes||null}));o(l("client.createSuccess",{defaultValue:"Client erfolgreich angelegt"}),"success"),n(e.data),h({name:"",company:"",email:"",phone:"",address:"",notes:""})}catch(a){var t,r;o((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("client.createError",{defaultValue:"Fehler beim Anlegen des Clients"}),"error")}finally{v(!1)}};(0,a.useEffect)((()=>{const e=()=>{N(window.innerWidth<640),u(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?i():d(),()=>{d()})),[t,i,d]);const S=e=>{const{name:t,value:r}=e.target;h((e=>(0,T.A)((0,T.A)({},e),{},{[t]:r}))),y[t]&&p((e=>(0,T.A)((0,T.A)({},e),{},{[t]:""})))},A=()=>{h({name:"",company:"",email:"",phone:"",address:"",notes:""}),p({}),r()};return j?(0,R.jsxs)(k.lG,{open:t,onClose:A,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsxs)(k.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,R.jsx)(k.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,R.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("form",{onSubmit:C,className:"p-4",children:[(0,R.jsxs)("div",{className:"space-y-4",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,R.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:m.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.name&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.name})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,R.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:m.company,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,R.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:m.email,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.email&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,R.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:m.phone,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,R.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:m.address,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,R.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:m.notes,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,R.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,R.jsx)("button",{type:"button",onClick:A,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",disabled:f,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:f?"Speichere...":"Speichern",children:f?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(x.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,R.jsxs)(R.Fragment,{children:[t&&!c&&(0,R.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:A,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,R.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,R.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,R.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(y).length>0&&(0,R.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(y).map(((e,t)=>(0,R.jsx)("p",{children:e},t)))}),(0,R.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,R.jsx)("input",{type:"text",id:"name",name:"name",value:m.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.name&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.name})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,R.jsx)("input",{type:"text",id:"company",name:"company",value:m.company,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,R.jsx)("input",{type:"email",id:"email",name:"email",value:m.email,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.email&&(0,R.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,R.jsx)("input",{type:"tel",id:"phone",name:"phone",value:m.phone,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,R.jsx)("input",{type:"text",id:"address",name:"address",value:m.address,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,R.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:m.notes,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,R.jsx)("button",{type:"button",onClick:A,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",disabled:f,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:f?"Speichere...":"Speichern",children:f?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(x.A,{className:"h-5 w-5"})})]})]})]})]})]})},M=async e=>{try{return(await b.A.post(g.Sn.CONSULTATIONS.START,e)).data}catch(t){throw console.error("Fehler beim Starten der Beratung:",t),t}},O=async e=>{try{return(await b.A.post(g.Sn.CONSULTATIONS.STOP,e)).data}catch(t){throw console.error("Fehler beim Stoppen der Beratung:",t),t}},B=async(e,t)=>{try{return(await b.A.patch(g.Sn.CONSULTATIONS.UPDATE_NOTES(e),t)).data}catch(r){throw console.error("Fehler beim Aktualisieren der Notizen:",r),r}},P=e=>"isPlaceholder"in e&&!0===e.isPlaceholder,W=e=>{var t,r;let{onConsultationChange:n,onConsultationStarted:c}=e;const{t:u}=(0,s.Bd)(),{user:m}=(0,p.As)(),{selectedBranch:k}=(0,f.O)(),[w,j]=(0,a.useState)(null),[N,C]=(0,a.useState)(!0),[S,T]=(0,a.useState)(!1),[E,F]=(0,a.useState)(!1),[D,L]=(0,a.useState)(!1),[W,z]=(0,a.useState)(null),[U,V]=(0,a.useState)([]),[G,Y]=(0,a.useState)(""),[H,Z]=(0,a.useState)(null),K=(0,a.useRef)(null),[q,Q]=(0,a.useState)(3),[$,J]=(0,a.useState)(0),X=(0,a.useRef)(null),[ee,te]=(0,a.useState)(!1),[re,ae]=(0,a.useState)(""),[se,ne]=(0,a.useState)("");(0,a.useEffect)((()=>{le(),oe()}),[]);const le=async()=>{try{const e=await b.A.get(g.Sn.WORKTIME.ACTIVE);e.data&&e.data.clientId&&(j(e.data),Y(e.data.notes||""))}catch(e){}finally{C(!1)}},oe=async()=>{try{console.log("=== FRONTEND: loadRecentClients() called ===");const e=await A();console.log("=== FRONTEND: received clients:",e),V(e||[])}catch(e){console.error("=== FRONTEND: loadRecentClients() ERROR ===",e)}},ie=async(e,t)=>{if(k)try{var r;T(!0);const a=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),s=await M({branchId:k,clientId:e,notes:t||"",startTime:a.toISOString()});j(s),Y(t||""),z(null),F(!1),Z(e),window.dispatchEvent(new CustomEvent("consultationChanged")),oe(),null===n||void 0===n||n(s),c&&null!==(r=s.client)&&void 0!==r&&r.name&&c(s.client.name),v.oR.success(u("consultations.started"))}catch(a){console.error("Fehler beim Starten der Beratung:",a),v.oR.error(u("consultations.startError"))}finally{T(!1)}else v.oR.error(u("consultations.selectBranch"))},de=async()=>{if(w)try{await B(w.id,{notes:G})}catch(e){}};(0,a.useEffect)((()=>{if(!w||!G)return;const e=setTimeout((()=>{de()}),3e4);return()=>clearTimeout(e)}),[G,w]),(0,a.useEffect)((()=>{const e=()=>{oe()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[]);const ce=(0,a.useMemo)((()=>0===U.length?85:U.reduce(((e,t)=>e+(6*t.name.length+24)),0)/U.length),[U]),ue=(0,a.useCallback)((()=>{if(!K.current||0===U.length)return;const e=K.current.clientWidth;if(Math.abs(e-$)<40)return;J(e);const t=e-32-(e<768?8:20)-12,r=Math.max(1,Math.floor(t/ce));Q(Math.min(r,U.length))}),[U,ce,$]),me=(0,a.useCallback)((()=>{X.current&&clearTimeout(X.current),X.current=setTimeout((()=>{ue()}),150)}),[ue]);(0,a.useEffect)((()=>{if(!K.current)return;const e=new ResizeObserver(me);return e.observe(K.current),window.addEventListener("resize",me),()=>{e.disconnect(),window.removeEventListener("resize",me),X.current&&clearTimeout(X.current)}}),[me]),(0,a.useLayoutEffect)((()=>{ue()}),[ue]);const he=0===U.length&&N,xe=(0,a.useMemo)((()=>he?Array(3).fill(null).map(((e,t)=>({id:"placeholder-".concat(t),name:"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",isPlaceholder:!0,status:void 0,lastConsultationDate:void 0}))):[]),[he]),ge=he?xe:U,be=he?xe.length:q,ye=(0,a.useMemo)((()=>{if(he||!H)return ge;const e=ge.find((e=>e.id===H));if(!e)return ge;return[e,...ge.filter((e=>e.id!==H))]}),[ge,H,he]);return N?(0,R.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:(0,R.jsxs)("div",{className:"animate-pulse",children:[(0,R.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),(0,R.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),(0,R.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"})]})}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,R.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center pl-2 sm:pl-0",children:[(0,R.jsx)(l.A,{className:"h-6 w-6 mr-2 sm:h-6 sm:w-6 sm:mr-2"}),u("consultations.trackerTitle")]}),w&&(0,R.jsxs)("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[(0,R.jsx)(o.A,{className:"h-5 w-5 mr-2 animate-pulse"}),(0,R.jsxs)("span",{className:"font-medium",children:[(0,y.P0)(w.startTime,null)," - ",null===(t=w.client)||void 0===t?void 0:t.name]})]})]}),w?(0,R.jsxs)("div",{className:"space-y-4",children:[(0,R.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,R.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:u("consultations.activeWith")}),(0,R.jsx)("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:null===(r=w.client)||void 0===r?void 0:r.name}),(0,R.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[u("consultations.startedAt"),": ",(0,y.fU)(w.startTime)]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:u("consultations.notesForConsultation")}),(0,R.jsx)("textarea",{value:G,onChange:e=>Y(e.target.value),onBlur:de,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:u("consultations.notesPlaceholder")})]}),(0,R.jsxs)("button",{onClick:async()=>{try{const e=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),t=await O({endTime:e.toISOString(),notes:G||void 0});j(null),Y(""),v.oR.success(u("consultations.stopped")),oe(),null===n||void 0===n||n(t),console.log("\ud83d\uded1 ConsultationTracker: Sending consultationChanged event (stop)"),window.dispatchEvent(new CustomEvent("consultationChanged"))}catch(r){var e,t;v.oR.error((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||u("consultations.stopError"))}},className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[(0,R.jsx)(i.A,{className:"h-5 w-5 mr-2"}),u("consultations.stop")]})]}):(0,R.jsxs)("div",{className:"space-y-4",children:[ye.length>0&&!ee&&(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:ye.some((e=>!P(e)&&"planned"===e.status))?u("consultations.recentAndPlanned"):u("consultations.recent")}),(0,R.jsxs)("div",{ref:K,className:"flex items-center gap-0.5 md:gap-6",children:[(0,R.jsx)("button",{onClick:()=>L(!0),disabled:he,className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center flex-shrink-0 ".concat(he?"opacity-50 cursor-not-allowed":""),style:{width:"30.19px",height:"30.19px"},title:u("consultations.createClient"),"aria-label":u("consultations.createClient"),children:(0,R.jsx)(d.A,{className:"h-4 w-4"})}),(0,R.jsx)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:ye.slice(0,be).map(((e,t)=>{!P(e)&&e.status;const r=!P(e)&&"planned"===e.status;return(0,R.jsxs)("button",{onClick:()=>!P(e)&&ie(Number(e.id),G),disabled:P(e),className:"inline-flex items-center px-3 py-2 rounded-full text-sm font-medium flex-shrink-0 transition-colors ".concat(P(e)?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 animate-pulse cursor-default":r?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 hover:bg-blue-200 dark:hover:bg-blue-900/50 cursor-pointer border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer"),title:P(e)?u("common.loading"):r?u("consultations.plannedWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""}):u("consultations.startWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE"):""}),children:[r&&!P(e)&&(0,R.jsx)("svg",{className:"h-3 w-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,R.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,R.jsx)("span",{className:"truncate max-w-[120px]",children:P(e)?(0,R.jsx)("span",{className:"inline-block w-16 h-4 bg-gray-300 dark:bg-gray-500 rounded animate-pulse"}):e.name})]},e.id)}))})]})]}),(0,R.jsxs)("div",{className:"flex gap-6",children:[(0,R.jsx)("button",{onClick:()=>F(!0),className:"w-2/3 flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:u("consultations.start"),children:(0,R.jsx)(h,{className:"h-5 w-5"})}),(0,R.jsx)("button",{onClick:()=>{te(!ee),z(null),ae(""),ne(""),Y("")},className:"w-1/3 flex items-center justify-center px-4 py-3 border text-base font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(ee?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"),title:u("consultations.plan"),children:(0,R.jsx)(o.A,{className:"h-5 w-5"})})]}),ee&&(0,R.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:[(0,R.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:u("consultations.planConsultation")}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("consultations.columns.client")}),W?(0,R.jsxs)("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2",children:[(0,R.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:W.name}),(0,R.jsx)("button",{onClick:()=>F(!0),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:u("consultations.change")})]}):(0,R.jsx)("button",{onClick:()=>F(!0),className:"w-full text-left bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700",children:u("consultations.selectClientPlaceholder")})]}),(0,R.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("consultations.columns.startTime")}),(0,R.jsx)("input",{type:"datetime-local",value:re,onChange:e=>ae(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("consultations.columns.endTime")}),(0,R.jsx)("input",{type:"datetime-local",value:se,onChange:e=>ne(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("consultations.columns.notes")}),(0,R.jsx)("textarea",{value:G,onChange:e=>Y(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",rows:2,placeholder:u("consultations.optionalNotes")})]}),(0,R.jsx)("div",{className:"flex justify-end",children:(0,R.jsx)("button",{onClick:async()=>{if(W)if(re&&se)if(k)try{T(!0);const e=new Date(re),t=new Date(e.getTime()-6e4*e.getTimezoneOffset()),r=new Date(se),a=new Date(r.getTime()-6e4*r.getTimezoneOffset()),s=(await M({branchId:k,clientId:W.id,notes:G||"",startTime:t.toISOString()}),await O({endTime:a.toISOString(),notes:G||""}));te(!1),ae(""),ne(""),Y(""),z(null),Z(W.id),console.log("\ud83d\ude80 ConsultationTracker: Sending consultationChanged event (start)"),window.dispatchEvent(new CustomEvent("consultationChanged")),oe(),null===n||void 0===n||n(s),c&&W.name&&c(W.name),v.oR.success(u("consultations.manualSaveSuccess"))}catch(e){console.error("Fehler beim Erfassen der Beratung:",e),v.oR.error(u("consultations.manualSaveError"))}finally{T(!1)}else v.oR.error(u("consultations.selectBranch"));else v.oR.error("Bitte geben Sie Start- und Endzeit an");else v.oR.error("Bitte w\xe4hlen Sie einen Client aus")},disabled:!W||!re||!se,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:u("consultations.saveConsultation"),children:(0,R.jsx)(x.A,{className:"h-5 w-5"})})})]})]})]}),(0,R.jsx)(I,{isOpen:E,onClose:()=>F(!1),onSelect:e=>{z(e),F(!1),ee||ie(e.id,G)},onCreateNew:()=>{F(!1),L(!0)}}),(0,R.jsx)(_,{isOpen:D,onClose:()=>L(!1),onSave:e=>{L(!1),z(e),oe()}})]})};var z=r(8010),U=r(2704),V=r(3315),G=r(9670),Y=r(3216);const H=e=>{let{isOpen:t,onClose:r,consultationId:n,onTaskLinked:l}=e;const{t:o}=(0,s.Bd)(),[i,d]=(0,a.useState)([]),[c,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(""),[x,y]=(0,a.useState)(!0),[p,f]=(0,a.useState)(null);(0,a.useEffect)((()=>{t&&N()}),[t]),(0,a.useEffect)((()=>{if(m){const e=i.filter((e=>e.title.toLowerCase().includes(m.toLowerCase())));u(e)}else u(i)}),[m,i]);const N=async()=>{try{y(!0);const e=(await b.A.get(g.Sn.TASKS.BASE)).data.filter((e=>"open"===e.status||"in_progress"===e.status));d(e),u(e)}catch(e){v.oR.error(o("consultations.linkTask.loadError"))}finally{y(!1)}};return(0,R.jsxs)(k.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsx)(k.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,R.jsxs)("div",{className:"p-6",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,R.jsx)(k.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("consultations.linkTask.title")}),(0,R.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"relative mb-4",children:[(0,R.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,R.jsx)(j.A,{className:"h-5 w-5 text-gray-400"})}),(0,R.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:o("consultations.linkTask.searchPlaceholder"),autoFocus:!0})]}),(0,R.jsx)("div",{className:"max-h-96 overflow-y-auto",children:x?(0,R.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:o("common.loading")}):0===c.length?(0,R.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("consultations.linkTask.noTasksFound")}):(0,R.jsx)("div",{className:"space-y-2",children:c.map((e=>(0,R.jsxs)("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",children:[(0,R.jsx)("input",{type:"radio",name:"task",value:e.id,checked:p===e.id,onChange:()=>f(e.id),className:"mr-3"}),(0,R.jsxs)("div",{className:"flex-1",children:[(0,R.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),e.responsible&&(0,R.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o("tasks.columns.responsible"),": ",e.responsible.firstName," ",e.responsible.lastName]})]}),(0,R.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("open"===e.status?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"),children:"open"===e.status?o("tasks.status.open"):o("tasks.status.in_progress")})]},e.id)))})}),(0,R.jsxs)("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[(0,R.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{onClick:async()=>{if(p)try{await b.A.post(g.Sn.CONSULTATIONS.LINK_TASK(n),{taskId:p}),v.oR.success(o("consultations.linkTask.success")),l(),r()}catch(a){var e,t;v.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||o("consultations.linkTask.error"))}else v.oR.error(o("consultations.linkTask.selectTask"))},disabled:!p,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:o("consultations.linkTask.link"),children:(0,R.jsx)(G.A,{className:"h-5 w-5"})})]})]})})})]})};var Z=r(4426),K=r(7829),q=r(6400),Q=r(9837),$=r(887),J=r(4538),X=r(8416),ee=r(9531);const te=e=>{let{isOpen:t,onClose:r,invoiceId:n,invoiceNumber:l,totalAmount:o,clientName:i}=e;const{t:d}=(0,s.Bd)(),{showMessage:c}=(0,F.A)(),[u,m]=(0,a.useState)(!1);return t?(0,R.jsxs)(k.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsx)(k.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,R.jsxs)("div",{className:"p-6",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)(J.A,{className:"h-8 w-8 text-green-500 mr-3"}),(0,R.jsx)(k.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellt"})]}),(0,R.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"space-y-4",children:[(0,R.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,R.jsx)("h3",{className:"font-medium text-green-800 dark:text-green-200 mb-2",children:"Rechnung erfolgreich erstellt"}),(0,R.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-300 space-y-1",children:[(0,R.jsxs)("p",{children:[(0,R.jsx)("strong",{children:"Rechnungsnummer:"})," ",l]}),(0,R.jsxs)("p",{children:[(0,R.jsx)("strong",{children:"Kunde:"})," ",i]}),(0,R.jsxs)("p",{children:[(0,R.jsx)("strong",{children:"Betrag:"})," CHF ",o]})]})]}),(0,R.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,R.jsx)("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"N\xe4chste Schritte"}),(0,R.jsxs)("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,R.jsx)("li",{children:"\u2022 PDF herunterladen und an Kunde senden"}),(0,R.jsx)("li",{children:"\u2022 Beratungen sind nun als abgerechnet markiert"}),(0,R.jsx)("li",{children:"\u2022 Rechnung in der Rechnungsverwaltung verwalten"})]})]})]}),(0,R.jsxs)("div",{className:"mt-6 flex flex-col space-y-3",children:[(0,R.jsx)("button",{onClick:async()=>{try{m(!0);const e=await b.A.get(g.Sn.CONSULTATION_INVOICES.GENERATE_PDF(n),{responseType:"blob",headers:{Accept:"application/pdf"}}),t=new Blob([e.data],{type:"application/pdf"}),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="Rechnung_".concat(l,".pdf"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),c(d("invoice.downloadSuccess",{defaultValue:"PDF erfolgreich heruntergeladen"}),"success")}catch(r){var e,t;console.error("Fehler beim Download der PDF:",r),c((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("invoice.downloadError",{defaultValue:"Fehler beim Download der PDF"}),"error")}finally{m(!1)}},disabled:u,className:"w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"PDF wird generiert..."]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(X.A,{className:"h-5 w-5 mr-2"}),"PDF herunterladen"]})}),(0,R.jsxs)("button",{onClick:()=>{c(d("invoice.invoiceManagementPhase5",{defaultValue:"Rechnungsverwaltung wird in Phase 5 implementiert"}),"info"),r()},className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,R.jsx)(ee.A,{className:"h-5 w-5 mr-2"}),"Zur Rechnungsverwaltung"]}),(0,R.jsx)("button",{onClick:r,className:"w-full px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Schlie\xdfen"})]})]})})})]}):null},re=e=>{let{isOpen:t,onClose:r,consultations:s,onInvoiceCreated:l}=e;const{t:o}=useTranslation(),{showMessage:i}=(0,F.A)(),{hasPermission:d}=(0,n.S)(),[c,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(null),[f,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)({issueDate:(0,Q.GP)(new Date,"yyyy-MM-dd"),dueDate:(0,Q.GP)(new Date(Date.now()+2592e6),"yyyy-MM-dd"),hourlyRate:0,vatRate:0,notes:""}),C=d("invoice_create","write","button"),S=(0,a.useCallback)((async()=>{try{u(!0);const e=(await b.A.get(g.Sn.INVOICE_SETTINGS.BASE)).data;h(e),N((t=>(0,T.A)((0,T.A)({},t),{},{hourlyRate:e.defaultHourlyRate||0,vatRate:e.defaultVatRate||0})))}catch(t){var e;console.error("Fehler beim Laden der Rechnungseinstellungen:",t),404===(null===(e=t.response)||void 0===e?void 0:e.status)?i(o("invoice.settingsNotConfigured",{defaultValue:"Bitte konfigurieren Sie zuerst Ihre Rechnungseinstellungen"}),"error"):i(o("invoice.loadSettingsError",{defaultValue:"Fehler beim Laden der Rechnungseinstellungen"}),"error")}finally{u(!1)}}),[]);if((0,a.useEffect)((()=>{t&&S()}),[t,S]),!C)return(0,R.jsxs)(k.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsx)(k.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:(0,R.jsxs)("div",{className:"text-center",children:[(0,R.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Keine Berechtigung"}),(0,R.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Sie haben keine Berechtigung, Rechnungen zu erstellen."}),(0,R.jsx)("button",{onClick:r,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Schlie\xdfen"})]})})})]});const A=e=>{const{name:t,value:r}=e.target;N((e=>(0,T.A)((0,T.A)({},e),{},{[t]:r})))},D=s.reduce(((e,t)=>{if(t.endTime){const r=(0,y.P0)(t.startTime,t.endTime);return e+parseFloat(r.replace("h","").replace(",","."))}return e}),0),L=D*j.hourlyRate,I=j.vatRate>0?L*j.vatRate/100:0,_=L+I;return t?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(k.lG,{open:t&&!f,onClose:r,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsx)(k.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,R.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!m)return void i(o("invoice.settingsNotLoaded",{defaultValue:"Rechnungseinstellungen konnten nicht geladen werden"}),"error");if(0===s.length)return void i(o("invoice.noConsultations",{defaultValue:"Keine Beratungen zum Abrechnen vorhanden"}),"error");const t=[...new Set(s.map((e=>e.clientId)))];if(t.length>1)return void i(o("invoice.differentClients",{defaultValue:"Alle Beratungen m\xfcssen den gleichen Kunden haben"}),"error");const r=t[0];if(r)try{var a,n;u(!0);const e=(await b.A.post(g.Sn.CONSULTATION_INVOICES.CREATE_FROM_CONSULTATIONS,{consultationIds:s.map((e=>e.id)),clientId:r,issueDate:j.issueDate,dueDate:j.dueDate,hourlyRate:j.hourlyRate,vatRate:j.vatRate||0,notes:j.notes})).data,t=(null===(a=s[0])||void 0===a||null===(n=a.client)||void 0===n?void 0:n.name)||"Unbekannt";p({id:e.id,invoiceNumber:e.invoiceNumber,total:e.total,clientName:t}),v(!0),l(e.id)}catch(h){var d,c;i((null===(d=h.response)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.message)||o("invoice.createError",{defaultValue:"Fehler beim Erstellen der Rechnung"}),"error")}finally{u(!1)}else i(o("invoice.noValidClient",{defaultValue:"Kein g\xfcltiger Kunde in den Beratungen gefunden"}),"error")},className:"p-6",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,R.jsx)(k.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellen"}),(0,R.jsx)("button",{type:"button",onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,R.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,R.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Zu verrechnende Beratungen"}),(0,R.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:s.map((e=>{var t;return(0,R.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,R.jsx)("div",{children:(0,R.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[null===(t=e.client)||void 0===t?void 0:t.name," - ",(0,y.fU)(e.startTime)]})}),(0,R.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:(0,y.P0)(e.startTime,e.endTime)})]},e.id)}))}),(0,R.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 flex justify-between text-sm font-medium",children:[(0,R.jsx)("span",{children:"Gesamtdauer:"}),(0,R.jsxs)("span",{children:[D.toFixed(2),"h"]})]})]}),(0,R.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rechnungsdatum"}),(0,R.jsx)("input",{type:"date",name:"issueDate",value:j.issueDate,onChange:A,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"F\xe4lligkeitsdatum"}),(0,R.jsx)("input",{type:"date",name:"dueDate",value:j.dueDate,onChange:A,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stundensatz (CHF)"}),(0,R.jsx)("input",{type:"number",name:"hourlyRate",value:j.hourlyRate,onChange:A,step:"0.01",min:"0",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"MwSt.-Satz (%)"}),(0,R.jsx)("input",{type:"number",name:"vatRate",value:j.vatRate,onChange:A,step:"0.1",min:"0",max:"100",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,R.jsxs)("div",{className:"mb-6",children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zus\xe4tzliche Notizen"}),(0,R.jsx)("textarea",{name:"notes",value:j.notes,onChange:A,rows:3,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Optionale Notizen zur Rechnung..."})]}),(0,R.jsxs)("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,R.jsx)("h3",{className:"font-medium text-blue-800 dark:text-blue-200 mb-3",children:"Kosten\xfcbersicht"}),(0,R.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,R.jsxs)("div",{className:"flex justify-between",children:[(0,R.jsxs)("span",{children:["Beratungszeit (",D.toFixed(2),"h \xd7 CHF ",j.hourlyRate,"):"]}),(0,R.jsxs)("span",{children:["CHF ",L.toFixed(2)]})]}),j.vatRate>0&&(0,R.jsxs)("div",{className:"flex justify-between",children:[(0,R.jsxs)("span",{children:["MwSt. (",j.vatRate,"%):"]}),(0,R.jsxs)("span",{children:["CHF ",I.toFixed(2)]})]}),(0,R.jsxs)("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between font-medium",children:[(0,R.jsx)("span",{children:"Gesamtbetrag:"}),(0,R.jsxs)("span",{children:["CHF ",_.toFixed(2)]})]})]})]}),(0,R.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,R.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel"),children:(0,R.jsx)(w.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",disabled:c||!m||0===D,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:c?"Erstelle Rechnung...":"Rechnung erstellen",children:c?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(U.A,{className:"h-5 w-5"})})]})]})})})]}),f&&x&&(0,R.jsx)(te,{isOpen:f,onClose:()=>{v(!1),p(null),r()},invoiceId:x.id,invoiceNumber:x.invoiceNumber,totalAmount:Number(x.total).toFixed(2),clientName:x.clientName})]}):null},ae="consultations-table",se=(0,a.forwardRef)(((e,t)=>{let{onConsultationChange:r}=e;const{t:l}=(0,s.Bd)(),{hasPermission:i}=(0,n.S)(),d=(0,Y.Zp)(),[c,u]=(0,a.useState)([]),[m,h]=(0,a.useState)([]),[p,f]=(0,a.useState)(!0),[k,j]=(0,a.useState)(null),[N,S]=(0,a.useState)(""),[E,F]=(0,a.useState)(!1),[D,L]=(0,a.useState)([]),[I,_]=(0,a.useState)([]),[M,O]=(0,a.useState)(null),[P,W]=(0,a.useState)(""),[J,X]=(0,a.useState)(null),[ee,te]=(0,a.useState)(null),[se,ne]=(0,a.useState)(""),[le,oe]=(0,a.useState)(!1),[ie,de]=(0,a.useState)(null),[ce,ue]=(0,a.useState)(l("consultations.filters.today")),[me,he]=(0,a.useState)(null),[xe,ge]=(0,a.useState)(!1),be=async()=>{try{f(!0);const e=await(async(e,t,r)=>{try{const a=new URLSearchParams;e&&a.append("clientId",e.toString()),t&&a.append("from",t),r&&a.append("to",r);const s=a.toString()?"".concat(g.Sn.CONSULTATIONS.BASE,"?").concat(a):g.Sn.CONSULTATIONS.BASE;return(await b.A.get(s)).data}catch(k){throw console.error("Fehler beim Laden der Beratungen:",k),k}})();u(e||[]),j(null)}catch(k){console.error("Fehler beim Laden der Beratungen:",k),j(l("consultations.loadError"))}finally{f(!1)}};(0,a.useImperativeHandle)(t,(()=>({refresh:be,addConsultation:e=>{u((t=>[e,...t]))},updateConsultation:e=>{u((t=>t.map((t=>t.id===e.id?e:t))))},removeConsultation:e=>{u((t=>t.filter((t=>t.id!==e))))},activateClientFilter:ye}))),(0,a.useEffect)((()=>{be(),(async()=>{try{const e=await A();h(e||[])}catch(k){}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await b.A.get(g.Sn.SAVED_FILTERS.BY_TABLE(ae)),t=e.data.find((e=>"Heute"===e.name));t&&(ue(l("consultations.filters.today")),he(t.id),pe(t.conditions,t.operators))}catch(k){console.error("Fehler beim Setzen des initialen Filters:",k)}})()}),[]);const ye=async e=>{try{const t=await b.A.get(g.Sn.SAVED_FILTERS.BY_TABLE(ae));let r=t.data.find((t=>t.name===e));if(!r){const t={tableId:ae,name:e,conditions:[{column:"client",operator:"equals",value:e}],operators:[]};r=(await b.A.post(g.Sn.SAVED_FILTERS.BASE,t)).data,window.refreshSavedFilters&&window.refreshSavedFilters()}r&&(ue(e),he(r.id),pe(r.conditions,r.operators))}catch(k){console.error("Fehler beim Erstellen/Aktivieren des Client-Filters:",k)}};(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return;const e=(await b.A.get(g.Sn.SAVED_FILTERS.BY_TABLE(ae))).data,t=e.find((e=>"Alle"===e.name));if(t)try{await b.A.delete(g.Sn.SAVED_FILTERS.BY_ID(t.id)),console.log('Veralteter "Alle" Filter gel\xf6scht')}catch(k){console.error('Fehler beim L\xf6schen des "Alle" Filters:',k)}const r=e.find((e=>"Diese Woche"===e.name));if(r)try{await b.A.delete(g.Sn.SAVED_FILTERS.BY_ID(r.id)),console.log('Veralteter "Diese Woche" Filter gel\xf6scht')}catch(k){console.error('Fehler beim L\xf6schen des "Diese Woche" Filters:',k)}const a=e.some((e=>"Archiv"===e.name)),s=e.some((e=>"Heute"===e.name)),n=e.some((e=>"Woche"===e.name)),o=e.some((e=>"Nicht abgerechnet"===e.name));if(!a){const e=(new Date).toISOString().split("T")[0],t={tableId:ae,name:"Archiv",conditions:[{column:"startTime",operator:"before",value:e}],operators:[]};try{await b.A.post(g.Sn.SAVED_FILTERS.BASE,t)}catch(k){console.error("Fehler beim Erstellen des Archiv-Filters:",k)}}if(!s){const e={tableId:ae,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]};try{await b.A.post(g.Sn.SAVED_FILTERS.BASE,e)}catch(k){console.error("Fehler beim Erstellen des Heute-Filters:",k)}}if(!n){const e={tableId:ae,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]};try{await b.A.post(g.Sn.SAVED_FILTERS.BASE,e)}catch(k){console.error("Fehler beim Erstellen des Woche-Filters:",k)}}if(!o){const e={tableId:ae,name:l("consultations.filters.unbilled"),conditions:[{column:"invoiceStatus",operator:"equals",value:"nicht abgerechnet"}],operators:[]};try{await b.A.post(g.Sn.SAVED_FILTERS.BASE,e)}catch(k){console.error("Fehler beim Erstellen des Nicht abgerechnet-Filters:",k)}}}catch(k){console.error("Fehler beim Erstellen der Standard-Filter:",k)}})()}),[]),(0,a.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{try{const e=(await b.A.get(g.Sn.SAVED_FILTERS.BY_TABLE(ae))).data,t=e.find((e=>"Heute"===e.name));if(t&&t.conditions.length>0){const e=t.conditions[0];e.value&&"__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)&&(console.log("Aktualisiere Heute-Filter mit dynamischem Marker..."),await b.A.post(g.Sn.SAVED_FILTERS.BASE,{tableId:ae,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]}))}const r=e.find((e=>"Woche"===e.name));if(r&&r.conditions.length>=2){const e=r.conditions[0],t=r.conditions[1];("__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)||"__WEEK_FROM_TODAY__"!==t.value&&/^\d{4}-\d{2}-\d{2}$/.test(t.value))&&(console.log("Aktualisiere Woche-Filter mit dynamischen Markern..."),await b.A.post(g.Sn.SAVED_FILTERS.BASE,{tableId:ae,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]}))}}catch(k){console.error("Fehler beim Aktualisieren bestehender Filter:",k)}})()}),1e3);return()=>clearTimeout(e)}),[]),(0,a.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{if(0!==m.length)try{if(!localStorage.getItem("token"))return;const e=(await b.A.get(g.Sn.SAVED_FILTERS.BY_TABLE(ae))).data,t=e.filter((e=>![l("consultations.filters.archive"),l("consultations.filters.today"),l("consultations.filters.week")].includes(e.name))),r=m.map((e=>e.name));for(const a of t)if(!r.includes(a.name))try{await b.A.delete(g.Sn.SAVED_FILTERS.BY_ID(a.id)),console.log("Veralteter Client-Filter gel\xf6scht: ".concat(a.name))}catch(k){console.error("Fehler beim L\xf6schen des veralteten Client-Filters ".concat(a.name,":"),k)}for(const a of m){const t=a.name;if(!e.some((e=>e.name===t))){const e={tableId:ae,name:t,conditions:[{column:"client",operator:"equals",value:a.name}],operators:[]};await b.A.post(g.Sn.SAVED_FILTERS.BASE,e),console.log("Neuer Client-Filter erstellt: ".concat(t))}}}catch(k){console.error("Fehler beim Aktualisieren der Client-Filter:",k)}})()}),500);return()=>clearTimeout(e)}),[m]);const pe=(e,t)=>{L(e),_(t)},fe=()=>{L([]),_([])},ve=()=>D.length,ke=e=>{(async(e,t)=>{try{await B(e,{notes:t}),u((r=>r.map((r=>r.id===e?(0,T.A)((0,T.A)({},r),{},{notes:t}):r)))),v.oR.success(l("consultations.notesUpdated"))}catch(k){console.error("Fehler beim Aktualisieren der Notizen:",k),v.oR.error(l("consultations.notesUpdateError"))}})(e,P),O(null)},we=()=>{O(null),W("")},je=(e,t)=>{X(e.id),te(t);const r="startTime"===t?e.startTime:e.endTime;if(r){const e=new Date(r),t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),s=String(e.getUTCDate()).padStart(2,"0"),n=String(e.getUTCHours()).padStart(2,"0"),l=String(e.getUTCMinutes()).padStart(2,"0"),o="".concat(t,"-").concat(a,"-").concat(s,"T").concat(n,":").concat(l);console.log("\ud83d\udd27 DEBUG handleTimeEdit (KORRIGIERT):"),console.log("- DB Zeit (UTC):",r),console.log("- Extrahierte UTC-Komponenten:","".concat(n,":").concat(l)),console.log("- inputValue f\xfcr datetime-local:",o),ne(o)}},Ne=async e=>{if(ee&&se)try{const t="".concat(se,":00.000Z");console.log("\ud83d\udd27 DEBUG handleTimeSave (REFACTORED):"),console.log("- editingTimeValue (Input):",se),console.log("- timeString f\xfcr API (UTC):",t),console.log("- editingTimeType:",ee);await(async(e,t)=>{try{return(await b.A.put("".concat(g.Sn.WORKTIME.BASE,"/").concat(e),t)).data}catch(k){throw console.error("Fehler beim Aktualisieren der Zeit:",k),k}})(e,{[ee]:t});u((r=>r.map((r=>r.id===e?(0,T.A)((0,T.A)({},r),{},{[ee]:t}):r)))),v.oR.success(l("consultations.timeUpdated")),X(null),te(null),ne("")}catch(k){var t,r;console.error("Fehler beim Aktualisieren der Zeit:",k),v.oR.error("".concat(l("consultations.timeUpdateError"),": ").concat((null===(t=k.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||k.message))}},Ce=()=>{X(null),te(null),ne("")},Se=async e=>{if(window.confirm(l("consultations.confirmDelete")))try{await(async e=>{try{return(await b.A.delete(g.Sn.CONSULTATIONS.BY_ID(e))).data}catch(k){throw console.error("Fehler beim L\xf6schen der Beratung:",k),k}})(e),u((t=>t.filter((t=>t.id!==e)))),v.oR.success(l("consultations.deleteSuccess")),null===r||void 0===r||r()}catch(k){var t,a;console.error("Fehler beim L\xf6schen der Beratung:",k);const r=(null===(t=k.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||l("consultations.deleteError");v.oR.error(r)}},Ae=(0,a.useCallback)((e=>{let t=e;if(N){const e=N.toLowerCase();t=t.filter((t=>{var r,a,s,n,l;return(null===(r=t.client)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(s=t.notes)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(n=t.branch)||void 0===n||null===(l=n.name)||void 0===l?void 0:l.toLowerCase().includes(e))}))}if(D.length>0){const e={client:(e,t)=>{var r,a;const s=(null===(r=e.client)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase())||"",n=(t.value||"").toLowerCase();return"contains"===t.operator?s.includes(n):"equals"===t.operator?s===n:"startsWith"===t.operator?s.startsWith(n):"endsWith"===t.operator?s.endsWith(n):null},branch:(e,t)=>{var r,a;const s=(null===(r=e.branch)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase())||"",n=(t.value||"").toLowerCase();return"contains"===t.operator?s.includes(n):"equals"===t.operator?s===n:"startsWith"===t.operator?s.startsWith(n):"endsWith"===t.operator?s.endsWith(n):null},notes:(e,t)=>{var r;const a=(null===(r=e.notes)||void 0===r?void 0:r.toLowerCase())||"",s=(t.value||"").toLowerCase();return"contains"===t.operator?a.includes(s):"equals"===t.operator?a===s:"startsWith"===t.operator?a.startsWith(s):"endsWith"===t.operator?a.endsWith(s):null},startTime:(e,t)=>(0,q.J1)(e.startTime,t),duration:(e,t)=>{const r=Te(e.startTime,e.endTime),a=60*Number(t.value);return"greater_than"===t.operator?r>a:"less_than"===t.operator?r<a:"equals"===t.operator?Math.abs(r-a)<30:null},invoiceStatus:(e,t)=>{const r=(0,y.vv)(e),a=Re(e),s=String(t.value).toLowerCase();if("abgerechnet"===s||"invoiced"===s||"ja"===s)return r||a;if("nicht abgerechnet"===s||"not invoiced"===s||"nein"===s)return!r&&!a;if("einzelrechnung"===s||"invoice"===s)return r;if("monatsbericht"===s||"monthly report"===s)return a;if(r){const t=(0,y.h4)(e);return(t?(0,y.Pg)(t.status).toLowerCase():"").includes(s)}if(a){const t=Le(e);if(t){return("GENERATED"===t.status?"erstellt":"SENT"===t.status?"gesendet":"archiviert").includes(s)}return!1}return!1}},r=(e,t)=>{var r,a;switch(t){case"client":return(null===(r=e.client)||void 0===r?void 0:r.name)||"";case"branch":return(null===(a=e.branch)||void 0===a?void 0:a.name)||"";case"notes":return e.notes||"";case"startTime":return e.startTime;case"duration":return Te(e.startTime,e.endTime);case"invoiceStatus":{const t=(0,y.vv)(e),r=Re(e);return t?"invoiced":r?"monthly_report":"not_invoiced"}default:return e[t]}};t=(0,q.W5)(t,D,I,r,e)}return t}),[c,N,D,I]),Te=(e,t)=>{if(!t)return 0;const r=new Date(e);return(new Date(t).getTime()-r.getTime())/6e4},Ee=(0,a.useMemo)((()=>Ae(c).sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime()))),[c,D,I]),Fe=(0,a.useMemo)((()=>(0,y.c$)(Ee)),[Ee]),De=(0,a.useMemo)((()=>(e=>{const t=[];return e.forEach(((r,a)=>{const s=new Date(r.startTime),n=(0,Q.GP)(s,"yyyy-MM-dd",{locale:$.de}),o=s.getUTCHours();if(a>0){const r=new Date(e[a-1].startTime);n!==(0,Q.GP)(r,"yyyy-MM-dd",{locale:$.de})&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Q.GP)(s,"EEE, dd.MM.",{locale:$.de}),position:a})}else 0===a&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Q.GP)(s,"EEE, dd.MM.",{locale:$.de}),position:a});if(a>0){const r=new Date(e[a-1].startTime),s=r.getUTCHours();n===(0,Q.GP)(r,"yyyy-MM-dd",{locale:$.de})&&s<12&&o>=12&&t.push({id:"midday-".concat(n),type:"midday",date:n,label:l("consultations.midday"),position:a})}})),t})(Ee)),[Ee]),Re=e=>null!==e.monthlyReportId&&void 0!==e.monthlyReportId,Le=e=>e.monthlyReport,Ie=e=>{const t=e?"/payroll?tab=monthly-reports&reportId=".concat(e):"/payroll?tab=monthly-reports";d(t)},_e=e=>{const t=e?"/payroll?tab=invoices&invoiceId=".concat(e):"/payroll?tab=invoices";d(t)},Me=e=>{d("/worktracker?editTask=".concat(e))};return p?(0,R.jsx)("div",{className:"p-4",children:l("common.loading")}):k?(0,R.jsx)("div",{className:"p-4 text-red-600",children:k}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,R.jsxs)("div",{className:"flex items-center mb-6 justify-between px-2 sm:px-0",children:[(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)(o.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,R.jsxs)("div",{children:[(0,R.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:l("consultations.listTitle")}),(0,R.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[l("consultations.count",{count:Ee.length})," - ",l("consultations.total"),": ",Fe]})]})]}),(0,R.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,R.jsx)("input",{type:"text",placeholder:l("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:N,onChange:e=>S(e.target.value)}),(0,R.jsxs)("div",{className:"relative group ml-1",children:[(0,R.jsxs)("button",{className:"p-2 rounded-md ".concat(ve()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>F(!E),children:[(0,R.jsx)(z.A,{className:"h-5 w-5"}),ve()>0&&(0,R.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:ve()})]}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.advancedFilters")})]}),(()=>{if(!i("invoice_create","write","button"))return!1;if(!(Ee.length>0))return!1;if(!(D.length>0||""!==N.trim()))return!1;if(!Ee.every((e=>e.endTime)))return!1;return!Ee.some((e=>(0,y.vv)(e)))})()&&(0,R.jsxs)("div",{className:"relative group ml-2",children:[(0,R.jsx)("button",{onClick:()=>{ge(!0)},className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors",children:(0,R.jsx)(U.A,{className:"h-5 w-5"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.createInvoiceFromFiltered")})]})]})]}),E&&(0,R.jsx)("div",{className:"px-2 sm:px-0",children:(0,R.jsx)(Z.A,{columns:[{id:"client",label:l("consultations.columns.client")},{id:"branch",label:l("consultations.columns.branch")},{id:"notes",label:l("consultations.columns.notes")},{id:"startTime",label:l("consultations.columns.date")},{id:"duration",label:l("consultations.columns.durationHours")},{id:"invoiceStatus",label:l("consultations.columns.invoiceStatus")}],onApply:pe,onReset:fe,savedConditions:D,savedOperators:I,tableId:ae})}),(0,R.jsx)("div",{className:"px-2 sm:px-0",children:(0,R.jsx)(K.A,{tableId:ae,onSelectFilter:pe,onReset:fe,activeFilterName:ce,selectedFilterId:me,onFilterChange:(e,t,r,a)=>{ue(e),he(t),pe(r,a)}})}),(0,R.jsx)("div",{className:"space-y-0.5 sm:space-y-1",children:0===Ee.length?(0,R.jsxs)("div",{className:"text-center py-12 px-2 sm:px-0",children:[(0,R.jsx)(o.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:l("consultations.noConsultationsFound")}),(0,R.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:N||D.length>0?l("consultations.tryOtherFilters"):l("consultations.noConsultationsYet")})]})]}):Ee.map(((e,t)=>{var r,a;const s=De.find((e=>"day"===e.type&&e.position===t)),n=De.find((e=>"midday"===e.type&&e.position===t));return(0,R.jsxs)("div",{className:"relative",children:[s&&(0,R.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 dark:bg-blue-400 border-2 border-white dark:border-gray-800"}),(0,R.jsx)("div",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:s.label})]}),(0,R.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-200 dark:bg-gray-600"})]}),n&&(0,R.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 dark:bg-gray-500"}),(0,R.jsx)("div",{className:"ml-3 text-xs text-gray-500 dark:text-gray-400",children:n.label})]}),(0,R.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-300 dark:bg-gray-600"})]}),(0,R.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg md:border md:border-gray-200 md:dark:border-gray-700 hover:shadow-md transition-shadow",children:(0,R.jsx)("div",{className:"p-4",children:(0,R.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,R.jsxs)("div",{className:"col-span-1 space-y-3",children:[(0,R.jsx)("div",{className:"flex items-center space-x-2",children:(0,R.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,R.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:null===(r=e.client)||void 0===r?void 0:r.name}),(null===(a=e.client)||void 0===a?void 0:a.company)&&(0,R.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.client.company})]})}),(()=>{const t=(e=>{const t=(0,y.vv)(e),r=Re(e);if(t){const t=(0,y.h4)(e);return{type:"invoice",status:l("consultations.invoice"),info:t}}if(r){const t=Le(e);return{type:"monthly",status:l("consultations.monthlyReport"),info:t}}return null})(e);if(t){if("invoice"===t.type)return(0,R.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,R.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,R.jsx)(U.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,R.jsx)("button",{onClick:()=>{var e;return _e(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.invoice")})]}),t.info&&"invoiceNumber"in t.info&&(0,R.jsx)("div",{className:"flex items-center space-x-1",children:(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>{var e;return _e(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium hover:opacity-80 cursor-pointer ".concat((0,y.DW)(t.info.status)),children:(0,y.Pg)(t.info.status)}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Rechnung ".concat(t.info.invoiceNumber," vom ").concat((0,Q.GP)(new Date(t.info.issueDate),"dd.MM.yyyy",{locale:$.de}))})]})})]});if("monthly"===t.type)return(0,R.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,R.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,R.jsx)(V.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,R.jsx)("button",{onClick:()=>{var e;return Ie(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.monthlyReport")})]}),t.info&&"reportNumber"in t.info&&(0,R.jsx)("div",{className:"flex items-center space-x-1",children:(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>{var e;return Ie(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 hover:opacity-80 cursor-pointer",children:"GENERATED"===t.info.status?l("analytics.monthlyReports.status.generated"):"SENT"===t.info.status?l("analytics.monthlyReports.status.sent"):l("analytics.monthlyReports.status.archived")}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Monatsbericht ".concat(t.info.reportNumber)})]})})]})}return null})(),(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.time")}),(0,R.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:J===e.id&&"startTime"===ee||J===e.id&&"endTime"===ee?(0,R.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,R.jsx)("input",{type:"datetime-local",value:se,onChange:e=>ne(e.target.value),className:"text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full"}),(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>Ne(e.id),className:"p-0.5 text-green-600 hover:text-green-700",children:(0,R.jsx)("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.save")})]}),(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:Ce,className:"p-0.5 text-red-600 hover:text-red-700",children:(0,R.jsx)(w.A,{className:"h-3 w-3"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.cancel")})]})]}):(0,R.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,R.jsx)("button",{onClick:()=>je(e,"startTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,y.fU)(e.startTime)}),(0,R.jsx)("span",{className:"text-gray-400",children:"-"}),e.endTime?(0,R.jsx)("button",{onClick:()=>je(e,"endTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,y.fU)(e.endTime)}):(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-1 animate-pulse"}),(0,R.jsx)("span",{className:"text-green-600 dark:text-green-400 text-xs",children:l("consultations.active")})]})]})})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.duration")}),(0,R.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(0,y.P0)(e.startTime,e.endTime)})]}),e.taskLinks&&e.taskLinks.length>0&&(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.tasks",{count:e.taskLinks.length})}),(0,R.jsxs)("div",{className:"space-y-1",children:[e.taskLinks.slice(0,2).map((e=>(0,R.jsxs)("button",{onClick:()=>Me(e.task.id),className:"flex items-center text-xs text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 rounded px-2 py-1 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors cursor-pointer w-full text-left",children:[(0,R.jsx)(G.A,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,R.jsx)("span",{className:"truncate",children:e.task.title})]},e.id))),e.taskLinks.length>2&&(0,R.jsx)("button",{onClick:()=>{e.taskLinks&&e.taskLinks.length>0&&Me(e.taskLinks[0].task.id)},className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 cursor-pointer",children:l("consultations.moreTasks",{count:e.taskLinks.length-2})})]})]})]}),(0,R.jsxs)("div",{className:"col-span-2 relative",children:[(0,R.jsxs)("div",{className:"absolute top-0 right-0 flex items-center space-x-1 z-10",children:[i("consultations","write")&&(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>{return t=e.id,de(t),void oe(!0);var t},className:"p-1 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded",children:(0,R.jsx)(G.A,{className:"h-4 w-4"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.linkTask")})]}),i("consultations","write")&&e.endTime&&(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>Se(e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded",children:(0,R.jsx)(C.A,{className:"h-4 w-4"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.delete")})]})]}),(0,R.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:l("consultations.columns.notes")}),M===e.id?(0,R.jsxs)("div",{className:"space-y-2",children:[(0,R.jsx)("textarea",{value:P,onChange:e=>W(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm resize-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:l("consultations.notesPlaceholder")}),(0,R.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:we,className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,R.jsx)(w.A,{className:"h-4 w-4"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.cancel")})]}),(0,R.jsxs)("div",{className:"relative group",children:[(0,R.jsx)("button",{onClick:()=>ke(e.id),className:"p-1.5 bg-blue-600 text-white hover:bg-blue-700 rounded-md",children:(0,R.jsx)(x.A,{className:"h-4 w-4"})}),(0,R.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.save")})]})]})]}):(0,R.jsx)("div",{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded p-2 min-h-[60px] border border-dashed border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors",onClick:()=>(e=>{O(e.id),W(e.notes||"")})(e),children:e.notes?(0,R.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap leading-relaxed",children:e.notes}):(0,R.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,R.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:l("consultations.addNotes")})})})]})]})})})]},e.id)}))})]}),le&&ie&&(0,R.jsx)(H,{isOpen:le,onClose:()=>{oe(!1),de(null)},consultationId:ie,onTaskLinked:e=>{be(),null===r||void 0===r||r()}}),xe&&(0,R.jsx)(re,{isOpen:xe,onClose:()=>ge(!1),consultations:Ee,onInvoiceCreated:e=>{ge(!1),be(),v.oR.success(l("consultations.invoiceCreated"))}})]})})),ne=()=>{const{t:e}=(0,s.Bd)(),{hasPermission:t}=(0,n.S)(),r=(0,a.useRef)(null),l=(0,a.useCallback)((e=>{var t,a,s,n,l;e&&e.id?e.endTime?null===(t=r.current)||void 0===t||null===(a=t.updateConsultation)||void 0===a||a.call(t,e):null===(s=r.current)||void 0===s||null===(n=s.addConsultation)||void 0===n||n.call(s,e):null===(l=r.current)||void 0===l||l.refresh()}),[]),o=(0,a.useCallback)((e=>{var t,a,s;null===(t=r.current)||void 0===t||t.refresh(),null===(a=r.current)||void 0===a||null===(s=a.activateClientFilter)||void 0===s||s.call(a,e)}),[]);return t("consultations","read")?(0,R.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,R.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,R.jsxs)("div",{className:"space-y-6",children:[(0,R.jsx)(W,{onConsultationChange:l,onConsultationStarted:o}),(0,R.jsx)(se,{ref:r,onConsultationChange:l})]})})}):(0,R.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,R.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:(0,R.jsx)("div",{className:"flex",children:(0,R.jsxs)("div",{className:"ml-3",children:[(0,R.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:e("consultations.noPermission")}),(0,R.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(0,R.jsx)("p",{children:e("consultations.noPermissionMessage")})})]})})})})}},1713:(e,t,r)=>{r.d(t,{DW:()=>j,I5:()=>x,IF:()=>p,M9:()=>g,P0:()=>c,Pg:()=>w,VY:()=>y,Yq:()=>i,_2:()=>h,c$:()=>f,fU:()=>d,h4:()=>k,lK:()=>b,pg:()=>u,uT:()=>m,vv:()=>v});var a=r(4653),s=r(9837),n=r(1620),l=r(6981),o=r(887);const i=e=>{if(!e)return"-";try{const t=e.split("-");if(3!==t.length)return"-";const r=parseInt(t[0]),a=parseInt(t[1])-1,s=parseInt(t[2]);return new Date(r,a,s,12,0,0).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Fehler beim Formatieren des Datums:",t),"-"}},d=e=>{if(!e)return"-";try{const t=(0,a.H)(e),r=t.getUTCHours().toString().padStart(2,"0"),s=t.getUTCMinutes().toString().padStart(2,"0");return"".concat(r,":").concat(s)}catch(t){return console.error("Fehler beim Formatieren der Zeit f\xfcr ".concat(e,":"),t),"-"}},c=(e,t)=>{if(!e||!t)return"-";try{const r=e.endsWith("Z")?e.substring(0,e.length-1):e,a=t.endsWith("Z")?t.substring(0,t.length-1):t,s=new Date(r),n=new Date(a).getTime()-s.getTime(),l=Math.floor(n/6e4),o=Math.floor(l/60),i=l%60;return"".concat(o,"h ").concat(i,"m")}catch(r){return console.error("Fehler bei der Dauerberechnung:",r),"-"}},u=e=>{try{const t=parseInt(e.substring(0,4)),r=parseInt(e.substring(6)),a=new Date(Date.UTC(t,0,1,12,0,0)).getUTCDay(),l=a<=4?4-a:11-a,i=new Date(Date.UTC(t,0,1+l,12,0,0)),d=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+7*(r-1),12,0,0)),c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()-3,12,0,0)),u=(0,s.GP)(c,"yyyy-MM-dd");if(console.log("Konvertierte Woche ".concat(e," zu Datum: ").concat(u," (Wochentag: ").concat((0,s.GP)(c,"EEEE",{locale:o.de}),")")),"Montag"!==(0,s.GP)(c,"EEEE",{locale:o.de})){console.warn("Berechnetes Datum ist kein Montag! Korrigiere...");const e=(0,n.k)(c,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}return u}catch(t){console.error("Fehler beim Konvertieren des Wochendatums:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},m=(e,t)=>{try{if(!e||!e.startTime)return!1;return e.startTime.split("T")[0]===t}catch(r){return console.error("Fehler beim Pr\xfcfen der Relevanz eines Worktime-Eintrags:",r),!1}},h=e=>{if(!e)return[];const t=new Date(e),r=[];for(let a=0;a<7;a++){const e=(0,l.f)(t,a),n={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};r.push(n)}return r},x=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Fehler beim Formatieren des Datums und der Zeit:",t),"-"}},g=e=>{try{let t,r,a;if(!e.includes("-Q"))throw new Error("Ung\xfcltiges Quinzena-Format");{const s=e.split("-Q"),n=s[0];if(a=parseInt(s[1]),n.includes("-")){const e=n.split("-");t=parseInt(e[0]),r=parseInt(e[1])}else t=parseInt(n),r=Math.ceil(a/2)}const n=1===a?1:16,l=new Date(Date.UTC(t,r-1,n,12,0,0));return(0,s.GP)(l,"yyyy-MM-dd")}catch(t){console.error("Fehler beim Konvertieren der Quinzena:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},b=e=>{if(!e)return[];const t=new Date(e),r=t.getFullYear(),a=t.getMonth();let n;if(1===t.getDate())n=15;else{n=new Date(r,a+1,0).getDate()-15}const i=[];for(let d=0;d<n;d++){const e=(0,l.f)(t,d),r={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};i.push(r)}return i},y=()=>{const e=new Date;return(e=>{try{const t=new Date(e+"T12:00:00"),r=t.getFullYear(),a=t.getMonth()+1,s=t.getDate()<=15?1:2;return"".concat(r,"-").concat(String(a).padStart(2,"0"),"-Q").concat(s)}catch(t){console.error("Fehler beim Berechnen der Quinzena:",t);const e=new Date,r=e.getFullYear(),a=e.getMonth()+1;return"".concat(r,"-").concat(String(a).padStart(2,"0"),"-Q1")}})((0,s.GP)(e,"yyyy-MM-dd"))},p=e=>{const t=new Date(e);return new Date(t.getTime()+6e4*t.getTimezoneOffset())},f=e=>{try{const t=e.reduce(((e,t)=>{if(!t.endTime)return e;const r=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,a=t.endTime.endsWith("Z")?t.endTime.substring(0,t.endTime.length-1):t.endTime,s=new Date(r),n=new Date(a).getTime()-s.getTime();return e+Math.floor(n/6e4)}),0),r=Math.floor(t/60),a=t%60;return"".concat(r,"h ").concat(a,"m")}catch(t){return console.error("Fehler bei der Formatierung der Gesamtdauer:",t),"0h 0m"}},v=e=>!!(e.invoiceItems&&e.invoiceItems.length>0),k=e=>{if(!e.invoiceItems||0===e.invoiceItems.length)return null;return e.invoiceItems[0].invoice},w=e=>({DRAFT:"Entwurf",SENT:"Gesendet",PAID:"Bezahlt",OVERDUE:"\xdcberf\xe4llig",CANCELLED:"Storniert"}[e]||e),j=e=>({DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",SENT:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",CANCELLED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}[e]||"bg-gray-100 text-gray-800")},2302:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const o=s.forwardRef(l)},2704:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=s.forwardRef(l)},3315:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const o=s.forwardRef(l)},4538:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const o=s.forwardRef(l)},6400:(e,t,r)=>{r.d(t,{Ac:()=>l,J1:()=>n,W5:()=>s,hw:()=>o});const a=(e,t)=>{const{operator:r,value:a}=t;if(null==e&&null==a)return"equals"===r;if(null==e||null==a)return"notEquals"===r;const s=String(e).toLowerCase(),n=String(a).toLowerCase();switch(r){case"equals":return s===n;case"notEquals":return s!==n;case"contains":return s.includes(n);case"startsWith":return s.startsWith(n);case"endsWith":return s.endsWith(n);case"before":case"after":{const t=new Date(e),s=new Date(a);return!isNaN(t.getTime())&&!isNaN(s.getTime())&&("before"===r?t<s:t>s)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),s=parseFloat(String(a));return!isNaN(t)&&!isNaN(s)&&("greaterThan"===r?t>s:t<s)}default:return!0}},s=(e,t,r,s,n)=>0===t.length?e:e.filter((e=>{let l=!0;for(let o=0;o<t.length;o++){const i=t[o];let d=!1;if(n&&n[i.column]){const t=n[i.column](e,i);if(null!==t)d=t;else{const t=s(e,i.column);d=a(t,i)}}else{const t=s(e,i.column);d=a(t,i)}if(0===o)l=d;else{l="AND"===(r[o-1]||"AND")?l&&d:l||d}}return l})),n=(e,t)=>{if(!e)return!1;const r=new Date(e);if(isNaN(r.getTime()))return!1;let a;if("__TODAY__"===t.value){const e=new Date;e.setHours(0,0,0,0),a=e}else if(a=new Date(t.value),isNaN(a.getTime()))return!1;const s=new Date(r);s.setHours(0,0,0,0);const n=new Date(a);switch(n.setHours(0,0,0,0),t.operator){case"equals":return s.getTime()===n.getTime();case"before":return s<n;case"after":return s>n;default:return!0}},l=(e,t,r,a)=>{const s=r.value||"";if(s.startsWith("user-")){const t=parseInt(s.replace("user-",""),10);if(isNaN(t))return!1;const a=e===t;return"notEquals"===r.operator?!a:a}if(s.startsWith("role-")){const e=parseInt(s.replace("role-",""),10);if(isNaN(e))return!1;const a=t===e;return"notEquals"===r.operator?!a:a}if(""===s)return!0;if(void 0!==a){const e=a.toLowerCase(),t=s.toLowerCase();if("equals"===r.operator)return e===t;if("notEquals"===r.operator)return e!==t;if("contains"===r.operator)return e.includes(t)}return!1},o=(e,t,r,a,s,n)=>{const l=a.value||"";if(l.startsWith("user-")){const t=parseInt(l.replace("user-",""),10);if(isNaN(t))return!1;const s=e===t||r===t;return"notEquals"===a.operator?!s:s}if(l.startsWith("role-")){const e=parseInt(l.replace("role-",""),10);if(isNaN(e))return!1;const r=t===e;return"notEquals"===a.operator?!r:r}if(""===l)return!0;const o=l.toLowerCase();return"equals"===a.operator?(null===s||void 0===s?void 0:s.toLowerCase())===o||(null===n||void 0===n?void 0:n.toLowerCase())===o:"notEquals"===a.operator?(null===s||void 0===s?void 0:s.toLowerCase())!==o&&(null===n||void 0===n?void 0:n.toLowerCase())!==o:"contains"===a.operator&&((null===s||void 0===s?void 0:s.toLowerCase().includes(o))||(null===n||void 0===n?void 0:n.toLowerCase().includes(o)))}},7012:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const o=s.forwardRef(l)},7449:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const o=s.forwardRef(l)},8416:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=s.forwardRef(l)},9670:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(45),s=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"}))}const o=s.forwardRef(l)}}]);
//# sourceMappingURL=170.bf060074.chunk.js.map