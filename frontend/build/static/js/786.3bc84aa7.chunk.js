"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[786],{542:(e,t,r)=>{r.d(t,{Ay:()=>l,H_:()=>c,Zj:()=>d,i$:()=>o});var a=r(1923),n=r(1801),s=r(8018);s.v.log("DEBUGAUSGABE API-Client: API_URL ist:",n.H$);const i=a.A;i.interceptors.request.use((e=>{var t;const r="".concat(e.baseURL).concat(e.url);s.v.log("DEBUGAUSGABE API-Client: Vollst\xe4ndige Request URL:",r),s.v.log("DEBUGAUSGABE API-Client: Request-Methode:",null===(t=e.method)||void 0===t?void 0:t.toUpperCase()),s.v.log("DEBUGAUSGABE API-Client: Request-Headers:",e.headers),s.v.log("DEBUGAUSGABE API-Client: Request-Daten:",e.data);const a=localStorage.getItem("token");return s.v.log("DEBUGAUSGABE API-Client: Token vorhanden:",!!a),e}),(e=>(s.v.error("DEBUGAUSGABE API-Client: Fehler im Request Interceptor:",e),Promise.reject(e)))),i.interceptors.response.use((e=>(s.v.log("DEBUGAUSGABE API-Client: Response erhalten:",e.status,e.config.url),e)),(e=>(s.v.error("DEBUGAUSGABE API-Client: Fehler im Response Interceptor:",e.message),e.response?(s.v.error("DEBUGAUSGABE API-Client: Response Status:",e.response.status),s.v.error("DEBUGAUSGABE API-Client: Response Daten:",e.response.data)):s.v.error("DEBUGAUSGABE API-Client: Keine Response erhalten"),Promise.reject(e))));const o={getAll:()=>i.get("/users"),getById:e=>i.get("/users/".concat(e)),create:e=>{s.v.log("DEBUGAUSGABE API-Client: userApi.create wird aufgerufen mit Daten:",e);try{return i.post("/users",e).then((e=>(s.v.log("DEBUGAUSGABE API-Client: userApi.create Antwort:",e),e))).catch((e=>{throw s.v.error("DEBUGAUSGABE API-Client: userApi.create Fehler:",e.response||e),e}))}catch(t){throw s.v.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in userApi.create:",t),t}},update:(e,t)=>i.put("/users/".concat(e),t),updateRoles:(e,t)=>i.put("/users/".concat(e,"/roles"),{roleIds:t}),updateBranches:(e,t)=>i.put("/users/".concat(e,"/branches"),{branchIds:t})},d={getAll:e=>{s.v.log("DEBUGAUSGABE API-Client: roleApi.getAll wird aufgerufen",e?"mit branchId=".concat(e):"");const t=e?"/roles?branchId=".concat(e):"/roles";return i.get(t).then((e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.getAll erfolgreich:",e.data.length,"Rollen geladen"),e))).catch((e=>{throw s.v.error("DEBUGAUSGABE API-Client: roleApi.getAll Fehler:",e.message),e}))},getById:e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.getById(".concat(e,") wird aufgerufen")),i.get("/roles/".concat(e))),create:e=>{s.v.log("DEBUGAUSGABE API-Client: roleApi.create wird aufgerufen mit Daten:",e);try{return i.post("/roles",e).then((e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.create Antwort:",e),e))).catch((e=>{throw s.v.error("DEBUGAUSGABE API-Client: roleApi.create Fehler:",e.response||e),e}))}catch(t){throw s.v.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.create:",t),t}},update:(e,t)=>{s.v.log("DEBUGAUSGABE API-Client: roleApi.update f\xfcr ID ".concat(e," wird aufgerufen mit Daten:"),t);try{return i.put("/roles/".concat(e),t).then((e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.update Antwort:",e),e))).catch((e=>{throw s.v.error("DEBUGAUSGABE API-Client: roleApi.update Fehler:",e.response||e),e}))}catch(r){throw s.v.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.update:",r),r}},delete:e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.delete(".concat(e,") wird aufgerufen")),i.delete("/roles/".concat(e))),getRoleBranches:e=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.getRoleBranches(".concat(e,") wird aufgerufen")),i.get("/roles/".concat(e,"/branches"))),updateRoleBranches:(e,t)=>(s.v.log("DEBUGAUSGABE API-Client: roleApi.updateRoleBranches(".concat(e,") wird aufgerufen mit:"),t),i.put("/roles/".concat(e,"/branches"),t))},c={getAll:e=>{const t=e?"/branches?roleId=".concat(e):"/branches";return i.get(t)},getById:e=>i.get("/branches/".concat(e)),getUserBranches:()=>i.get("/branches/user"),switchBranch:e=>i.put("/branches/switch",{branchId:e}),create:e=>i.post("/branches",e),update:(e,t)=>i.put("/branches/".concat(e),t),delete:e=>i.delete("/branches/".concat(e))},l=i},595:(e,t,r)=>{r.d(t,{A:()=>I});var a=r(9379),n=r(5043),s=r(4117),i=r(542),o=r(1801);const d=async(e,t)=>{try{return(await i.Ay.post(o.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){throw console.error("Fehler beim Hinzuf\xfcgen des Dokuments:",r),r}},c=async(e,t)=>{try{return(await i.Ay.put(o.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){throw console.error("Fehler beim Aktualisieren des Dokuments:",r),r}};var l=r(7855);const u=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768;var m=r(7591),p=r(2965),g=r(1816),h=r(9422),y=r(579);const x=e=>{let{onCapture:t,onCancel:r}=e;const{t:a}=(0,s.Bd)(),[i,o]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[l,x]=(0,n.useState)(null),b=(0,n.useRef)(null),f=(0,n.useRef)(null),w=async()=>{try{x(null);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});o(e),b.current&&(b.current.srcObject=e)}catch(l){console.error("Fehler beim Zugriff auf die Kamera:",l),x(a("camera.accessError"))}},v=()=>{i&&(i.getTracks().forEach((e=>e.stop())),o(null))};return(0,n.useEffect)((()=>(u()&&w(),()=>{v()})),[]),u()?(0,y.jsxs)("div",{className:"camera-capture p-2 dark:bg-gray-800",children:[(0,y.jsx)("canvas",{ref:f,className:"hidden"}),l&&(0,y.jsxs)("div",{className:"error bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:[(0,y.jsx)("p",{children:l}),(0,y.jsxs)("div",{className:"relative group mt-2",children:[(0,y.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,y.jsx)(m.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("camera.back")})]})]}),l||d?!l&&d?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"preview-container mb-4 rounded overflow-hidden border border-gray-300 dark:border-gray-700",children:(0,y.jsx)("img",{src:d,alt:"Aufgenommenes Dokument",className:"w-full h-auto"})}),(0,y.jsxs)("div",{className:"flex justify-between",children:[(0,y.jsxs)("div",{className:"relative group",children:[(0,y.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:()=>{c(null),w()},children:(0,y.jsx)(g.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Neu aufnehmen"})]}),(0,y.jsxs)("div",{className:"relative group",children:[(0,y.jsx)("button",{className:"p-2 bg-green-500 dark:bg-green-600 text-white rounded-md hover:bg-green-600 dark:hover:bg-green-700",onClick:()=>{d&&t(d)},children:(0,y.jsx)(h.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Verwenden"})]})]})]}):null:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"video-container mb-4 rounded overflow-hidden border border-gray-300 dark:border-gray-700",children:(0,y.jsx)("video",{ref:b,autoPlay:!0,playsInline:!0,className:"w-full h-auto"})}),(0,y.jsxs)("div",{className:"flex justify-between",children:[(0,y.jsxs)("div",{className:"relative group",children:[(0,y.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,y.jsx)(m.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,y.jsxs)("div",{className:"relative group",children:[(0,y.jsx)("button",{className:"p-2 bg-blue-500 dark:bg-blue-600 text-white rounded-md hover:bg-blue-600 dark:hover:bg-blue-700",onClick:()=>{if(b.current&&f.current){const e=f.current,t=b.current;e.width=t.videoWidth,e.height=t.videoHeight;const r=e.getContext("2d");if(r){r.drawImage(t,0,0);const a=e.toDataURL("image/jpeg",.9);c(a),v()}}},children:(0,y.jsx)(p.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Foto aufnehmen"})]})]})]})]}):(0,y.jsxs)("div",{className:"p-4 text-center dark:bg-gray-800 dark:text-white",children:[(0,y.jsx)("p",{className:"mb-4",children:a("camera.onlyMobile")}),(0,y.jsxs)("div",{className:"relative group",children:[(0,y.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,y.jsx)(m.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("camera.back")})]})]})};var b=r(2882),f=r(2704),w=r(8018);const v=e=>{let{userId:t,document:r,onDocumentSaved:v,onCancel:A}=e;const{t:D}=(0,s.Bd)(),[N,k]=(0,n.useState)((null===r||void 0===r?void 0:r.documentType)||""),[j,C]=(0,n.useState)((null===r||void 0===r?void 0:r.documentNumber)||""),[E,I]=(0,n.useState)(null!==r&&void 0!==r&&r.issueDate?r.issueDate.substring(0,10):""),[S,U]=(0,n.useState)(null!==r&&void 0!==r&&r.expiryDate?r.expiryDate.substring(0,10):""),[B,T]=(0,n.useState)((null===r||void 0===r?void 0:r.issuingCountry)||""),[F,G]=(0,n.useState)((null===r||void 0===r?void 0:r.issuingAuthority)||""),[R,P]=(0,n.useState)(null),[_,O]=(0,n.useState)(null),[L,M]=(0,n.useState)(!1),[V,W]=(0,n.useState)(!1),[z,H]=(0,n.useState)(!1),[q,Y]=(0,n.useState)(null),[K,$]=(0,n.useState)(null),{showMessage:Z}=(0,l.A)(),J=[{value:"passport",label:D("identificationDocuments.types.passport")},{value:"national_id",label:D("identificationDocuments.types.national_id")}],Q=async e=>{O(e),M(!1),P(null);try{H(!0),Y(null);const t=await(0,b.C)(e);if(t.documentType){const e="passport"===t.documentType||"pass"===t.documentType?"passport":"national_id"===t.documentType||"id"===t.documentType||"cedula_colombia"===t.documentType?"national_id":t.documentType;k(e)}t.documentNumber&&C(t.documentNumber),t.issueDate&&I(t.issueDate),t.expiryDate&&U(t.expiryDate),t.issuingCountry&&T(t.issuingCountry),t.issuingAuthority&&G(t.issuingAuthority);const r={firstName:t.firstName,lastName:t.lastName,birthday:t.birthday,gender:t.gender,country:t.issuingCountry||t.country};$(r),Z(D("identificationDocuments.form.recognitionSuccess"),"success")}catch(t){console.error("Fehler bei der automatischen Erkennung:",t),Y(t.message)}finally{H(!1)}},X=()=>{M(!1)};return L?(0,y.jsx)(x,{onCapture:Q,onCancel:X}):(0,y.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),N&&j&&B){W(!0);try{if(r){if(R){const e=new FormData;j&&e.append("documentNumber",j),E&&e.append("issueDate",E),S&&e.append("expiryDate",S),B&&e.append("issuingCountry",B),F&&e.append("issuingAuthority",F),e.append("documentFile",R),await c(r.id,e)}else if(_)await(async(e,t,r)=>{try{return(await i.Ay.put(o.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e),(0,a.A)((0,a.A)({},r),{},{imageData:t}))).data}catch(n){throw console.error("Fehler beim Aktualisieren des Dokuments mit Kamera:",n),n}})(r.id,_,{documentNumber:j,issuingCountry:B,issueDate:E,expiryDate:S,issuingAuthority:F});else{const e=new FormData;j&&e.append("documentNumber",j),E&&e.append("issueDate",E),S&&e.append("expiryDate",S),B&&e.append("issuingCountry",B),F&&e.append("issuingAuthority",F),await c(r.id,e)}Z(D("identificationDocuments.form.updateSuccess"),"success")}else{if(R){const e=new FormData;e.append("documentType",N),e.append("documentNumber",j),e.append("issuingCountry",B),E&&e.append("issueDate",E),S&&e.append("expiryDate",S),F&&e.append("issuingAuthority",F),K&&(K.firstName&&e.append("firstName",K.firstName),K.lastName&&e.append("lastName",K.lastName),K.birthday&&e.append("birthday",K.birthday),K.gender&&e.append("gender",K.gender),K.country&&e.append("country",K.country)),e.append("documentFile",R),await d(t,e)}else if(_)await(async(e,t,r)=>{try{return(await i.Ay.post(o.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e),(0,a.A)((0,a.A)({},r),{},{imageData:t}))).data}catch(n){throw console.error("Fehler beim Hinzuf\xfcgen des Dokuments mit Kamera:",n),n}})(t,_,{documentType:N,documentNumber:j,issuingCountry:B,issueDate:E,expiryDate:S,issuingAuthority:F,firstName:null===K||void 0===K?void 0:K.firstName,lastName:null===K||void 0===K?void 0:K.lastName,birthday:null===K||void 0===K?void 0:K.birthday,gender:null===K||void 0===K?void 0:K.gender,country:null===K||void 0===K?void 0:K.country});else{const e=new FormData;e.append("documentType",N),e.append("documentNumber",j),e.append("issuingCountry",B),E&&e.append("issueDate",E),S&&e.append("expiryDate",S),F&&e.append("issuingAuthority",F),await d(t,e)}Z(D("identificationDocuments.form.createSuccess"),"success"),v()}}catch(l){var n,s;Z(D("identificationDocuments.form.error",{error:(null===(n=l.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.error)||D("common.error")}),"error")}finally{W(!1)}}else Z(D("identificationDocuments.form.fillRequiredFields"),"error")},className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("label",{htmlFor:"documentType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[D("identificationDocuments.form.documentType")," ",(0,y.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,y.jsxs)("select",{id:"documentType",value:N,onChange:e=>k(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0,children:[(0,y.jsx)("option",{value:"",children:D("identificationDocuments.form.selectDocumentType")}),J.map((e=>(0,y.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("label",{htmlFor:"documentNumber",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[D("identificationDocuments.form.documentNumber")," ",(0,y.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,y.jsx)("input",{type:"text",id:"documentNumber",value:j,onChange:e=>C(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("label",{htmlFor:"issuingCountry",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[D("identificationDocuments.form.issuingCountry")," ",(0,y.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,y.jsx)("input",{type:"text",id:"issuingCountry",value:B,onChange:e=>T(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"issuingAuthority",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:D("identificationDocuments.form.issuingAuthority")}),(0,y.jsx)("input",{type:"text",id:"issuingAuthority",value:F,onChange:e=>G(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"issueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:D("identificationDocuments.form.issueDate")}),(0,y.jsx)("input",{type:"date",id:"issueDate",value:E,onChange:e=>I(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"expiryDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:D("identificationDocuments.form.expiryDate")}),(0,y.jsx)("input",{type:"date",id:"expiryDate",value:S,onChange:e=>U(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:D("identificationDocuments.form.documentImage")}),(0,y.jsxs)("div",{className:"mt-1 flex items-center space-x-2",children:[(0,y.jsxs)("label",{className:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer",children:[(0,y.jsx)(f.A,{className:"h-5 w-5 mr-2 text-gray-500 dark:text-gray-400"}),D("identificationDocuments.form.uploadFile"),(0,y.jsx)("input",{type:"file",className:"sr-only",onChange:async e=>{if(e.target.files&&e.target.files.length>0){const r=e.target.files[0];P(r),O(null);try{H(!0),Y(null);const e=await new Promise(((e,t)=>{const a=new FileReader;a.onload=()=>e(a.result),a.onerror=t,a.readAsDataURL(r)})),t=await(0,b.C)(e);if(t.documentType){const e="passport"===t.documentType||"pass"===t.documentType?"passport":"national_id"===t.documentType||"id"===t.documentType||"cedula_colombia"===t.documentType?"national_id":t.documentType;k(e)}t.documentNumber&&C(t.documentNumber),t.issueDate&&I(t.issueDate),t.expiryDate&&U(t.expiryDate),t.issuingCountry&&T(t.issuingCountry),t.issuingAuthority&&G(t.issuingAuthority);const a={firstName:t.firstName,lastName:t.lastName,birthday:t.birthday,gender:t.gender,country:t.issuingCountry||t.country};$(a),Z(D("identificationDocuments.form.recognitionSuccess"),"success")}catch(t){console.error("Fehler bei der automatischen Erkennung:",t),Y(t.message)}finally{H(!1)}}},accept:"image/*"})]}),u()&&(0,y.jsxs)("button",{type:"button",onClick:()=>M(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,y.jsx)(p.A,{className:"h-5 w-5 mr-2 text-gray-500 dark:text-gray-400"}),D("identificationDocuments.form.takePhoto")]}),(0,y.jsx)("button",{type:"button",onClick:async()=>{try{if(H(!0),Y(null),!R&&!_)throw new Error(D("identificationDocuments.form.noDocumentUploaded"));let e=null;if(R?e=await new Promise(((e,t)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=t,r.readAsDataURL(R)})):_&&(e=_),!e)throw new Error(D("identificationDocuments.form.noImageData"));const t=await(0,b.C)(e);if(w.v.log("Erkannte Daten:",t),t.documentType){const e="passport"===t.documentType||"pass"===t.documentType?"passport":"national_id"===t.documentType||"id"===t.documentType||"cedula_colombia"===t.documentType?"national_id":t.documentType;k(e)}t.documentNumber&&C(t.documentNumber),t.issueDate&&I(t.issueDate),t.expiryDate&&U(t.expiryDate),t.issuingCountry&&T(t.issuingCountry),t.issuingAuthority&&G(t.issuingAuthority);const r={firstName:t.firstName,lastName:t.lastName,birthday:t.birthday,gender:t.gender,country:t.issuingCountry||t.country};$(r),Z(D("identificationDocuments.form.recognitionSuccess"),"success")}catch(e){console.error("Fehler bei der automatischen Erkennung:",e),Y(e.message),Z(D("identificationDocuments.form.recognitionError",{error:e.message}),"error")}finally{H(!1)}},disabled:z||!R&&!_,className:"inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium ".concat(z||!R&&!_?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500 border-gray-300 dark:border-gray-700 cursor-not-allowed":"border-blue-300 dark:border-blue-700 text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50"),children:z?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(g.A,{className:"h-5 w-5 mr-2 animate-spin"}),D("identificationDocuments.form.recognitionRunning")]}):D("identificationDocuments.form.autoRecognize")})]}),R&&(0,y.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:D("identificationDocuments.form.selectedFile",{name:R.name})}),_&&(0,y.jsxs)("div",{className:"mt-2",children:[(0,y.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:D("identificationDocuments.form.capturedImage")}),(0,y.jsx)("img",{src:_,alt:D("identificationDocuments.form.capturedDocument"),className:"max-h-40 border dark:border-gray-700 rounded"})]}),q&&(0,y.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:D("identificationDocuments.form.recognitionErrorLabel",{error:q})})]}),(0,y.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,y.jsx)("button",{type:"button",onClick:A,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:D("common.cancel"),children:(0,y.jsx)(m.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V,title:D(V?"common.saving":r?"identificationDocuments.form.update":"common.save"),children:V?(0,y.jsx)(g.A,{className:"h-5 w-5 animate-spin"}):(0,y.jsx)(h.A,{className:"h-5 w-5"})})]})]})};var A=r(2672),D=r(1923),N=r(4791),k=r(8662),j=r(9531),C=r(2811),E=r(9248);const I=(0,n.forwardRef)(((e,t)=>{let{userId:r,isAdmin:d=!1}=e;const{t:c}=(0,s.Bd)(),[u,p]=(0,n.useState)([]),[g,x]=(0,n.useState)(!0),[b,f]=(0,n.useState)(null),[w,I]=(0,n.useState)(!1),[S,U]=(0,n.useState)(null),[B,T]=(0,n.useState)(null),[F,G]=(0,n.useState)(null),[R,P]=(0,n.useState)({}),[_,O]=(0,n.useState)({}),[L,M]=(0,n.useState)({}),V=(0,n.useRef)({}),{showMessage:W}=(0,l.A)(),{user:z}=(0,A.As)(),H=async()=>{x(!0);try{const e=await(async e=>{try{return(await i.Ay.get(o.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e))).data}catch(b){throw console.error("Fehler beim Abrufen der Identifikationsdokumente:",b),b}})(r);p(e),f(null)}catch(e){f(e.message||c("identificationDocuments.loadError")),W(c("identificationDocuments.loadError"),"error")}finally{x(!1)}};(0,n.useEffect)((()=>{r&&H()}),[r]),(0,n.useEffect)((()=>{r&&H()}),[]),(0,n.useImperativeHandle)(t,(()=>({loadDocuments:H}))),(0,n.useEffect)((()=>{V.current=R}),[R]),(0,n.useEffect)((()=>()=>{Object.values(V.current).forEach((e=>{window.URL.revokeObjectURL(e)}))}),[]);const q=async e=>{if(window.confirm(c("identificationDocuments.deleteConfirm")))try{await(async e=>{try{await i.Ay.delete(o.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e))}catch(b){throw console.error("Fehler beim L\xf6schen des Dokuments:",b),b}})(e),W(c("identificationDocuments.deleteSuccess"),"success"),H()}catch(t){W("".concat(c("identificationDocuments.deleteError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}},Y=async e=>{if(z)try{await(async(e,t)=>{try{await i.Ay.post(o.Sn.IDENTIFICATION_DOCUMENTS.VERIFY(e),{adminId:t})}catch(b){throw console.error("Fehler bei der Verifizierung des Dokuments:",b),b}})(e,z.id),W(c("identificationDocuments.verifySuccess"),"success"),H()}catch(t){W("".concat(c("identificationDocuments.verifyError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}else W(c("identificationDocuments.notAuthenticated"),"error")},K=async e=>{R[e]||await(async e=>{try{O((t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0})));const t=await D.A.get("".concat(o.Sn.IDENTIFICATION_DOCUMENTS.DOWNLOAD(e),"?preview=true"),{responseType:"blob"}),r=t.headers["content-type"]||"application/pdf",n=new Blob([t.data],{type:r}),s=window.URL.createObjectURL(n);P((t=>(0,a.A)((0,a.A)({},t),{},{[e]:s}))),M((t=>(0,a.A)((0,a.A)({},t),{},{[e]:r})))}catch(t){console.error("Fehler beim Laden der Dokument-Vorschau:",t),W(c("identificationDocuments.previewError",{defaultValue:"Vorschau konnte nicht geladen werden"}),"error")}finally{O((t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1})))}})(e),T(e)},$=async e=>{G(e);try{const t=await D.A.get(o.Sn.IDENTIFICATION_DOCUMENTS.DOWNLOAD(e),{responseType:"blob"}),r=t.headers["content-type"]||"application/pdf",a=new Blob([t.data],{type:r}),n=window.URL.createObjectURL(a),s=document.createElement("a");s.href=n;const i=t.headers["content-disposition"];let d="document-".concat(e);if(i){const e=i.match(/filename="?(.+)"?/i);e&&(d=decodeURIComponent(e[1]))}d.includes(".")||("application/pdf"===r?d+=".pdf":r.startsWith("image/jpeg")?d+=".jpg":r.startsWith("image/png")&&(d+=".png")),s.download=d,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n),W(c("identificationDocuments.downloadSuccess",{defaultValue:"Dokument erfolgreich heruntergeladen"}),"success")}catch(t){W("".concat(c("identificationDocuments.downloadError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}finally{G(null)}},Z=e=>({passport:c("identificationDocuments.types.passport"),national_id:c("identificationDocuments.types.national_id"),driving_license:c("identificationDocuments.types.driving_license"),residence_permit:c("identificationDocuments.types.residence_permit"),work_permit:c("identificationDocuments.types.work_permit"),tax_id:c("identificationDocuments.types.tax_id"),social_security:c("identificationDocuments.types.social_security")}[e]||e),J=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE")}catch(t){return e}};if(w)return(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-medium mb-4",children:c("identificationDocuments.addDocument")}),(0,y.jsx)(v,{userId:r,onDocumentSaved:()=>{I(!1),H()},onCancel:()=>I(!1)})]});if(S)return(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-medium mb-4",children:c("identificationDocuments.editDocument")}),(0,y.jsx)(v,{userId:r,document:S,onDocumentSaved:()=>{U(null),H()},onCancel:()=>U(null)})]});if(null!==B){const e=u.find((e=>e.id===B)),t=R[B],r=_[B],n=(L[B]||"application/pdf").startsWith("image/");return(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,y.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,y.jsx)("h3",{className:"text-lg font-medium",children:e?Z(e.documentType):c("identificationDocuments.viewDocument",{defaultValue:"Dokument anzeigen"})}),(0,y.jsxs)("div",{className:"flex space-x-2",children:[(0,y.jsx)("button",{onClick:()=>$(B),className:"p-2 rounded-md text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20",disabled:F===B,title:c("identificationDocuments.actions.download",{defaultValue:"Herunterladen"}),children:F===B?(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):(0,y.jsx)(N.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>{T(null),setTimeout((()=>{R[B]&&(window.URL.revokeObjectURL(R[B]),P((e=>{const t=(0,a.A)({},e);return delete t[B],t})),M((e=>{const t=(0,a.A)({},e);return delete t[B],t})))}),1e3)},className:"p-2 rounded-md text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",title:c("common.close",{defaultValue:"Schlie\xdfen"}),children:(0,y.jsx)(m.A,{className:"h-5 w-5"})})]})]}),(0,y.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:r?(0,y.jsx)("div",{className:"flex justify-center items-center",style:{height:"400px"},children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t?n?(0,y.jsx)("div",{className:"flex justify-center items-center",style:{maxHeight:"80vh"},children:(0,y.jsx)("img",{src:t,alt:e?Z(e.documentType):"Dokument",className:"max-h-[80vh] w-full object-contain"})}):(0,y.jsx)("iframe",{src:"".concat(t,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"80vh"},title:e?Z(e.documentType):"Dokument"}):(0,y.jsx)("div",{className:"flex justify-center items-center text-gray-500 dark:text-gray-400",style:{height:"400px"},children:(0,y.jsx)("p",{children:c("identificationDocuments.previewError",{defaultValue:"Vorschau konnte nicht geladen werden"})})})})]})}return(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("div",{className:"flex items-center gap-3",children:[(0,y.jsx)("button",{onClick:()=>I(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:c("identificationDocuments.newDocument"),children:(0,y.jsx)(k.A,{className:"h-4 w-4"})}),(0,y.jsx)("h3",{className:"text-lg font-medium",children:c("identificationDocuments.title")})]}),(0,y.jsx)("div",{})]}),g?(0,y.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-white"})}):b?(0,y.jsx)("div",{className:"text-red-600 p-4",children:b}):0===u.length?(0,y.jsx)("div",{className:"text-gray-500 dark:text-gray-400 p-4",children:c("identificationDocuments.noDocuments")}):(0,y.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,y.jsxs)("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,y.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:c("identificationDocuments.columns.type")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:c("identificationDocuments.columns.number")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",style:{width:"60px",maxWidth:"60px"},children:c("identificationDocuments.columns.country")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap",children:c("identificationDocuments.columns.validFrom")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap",children:c("identificationDocuments.columns.validTo")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",style:{width:"120px",maxWidth:"120px"},children:c("identificationDocuments.columns.status")}),(0,y.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap",style:{width:"180px",minWidth:"180px"},children:c("identificationDocuments.columns.actions")})]})}),(0,y.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:u.map((e=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm text-gray-900 dark:text-gray-200",children:Z(e.documentType)}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm text-gray-900 dark:text-gray-200 truncate",children:e.documentNumber}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm text-gray-900 dark:text-gray-200",style:{width:"60px",maxWidth:"60px"},children:e.issuingCountry}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm text-gray-900 dark:text-gray-200 whitespace-nowrap",children:J(e.issueDate)}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm text-gray-900 dark:text-gray-200 whitespace-nowrap",children:J(e.expiryDate)}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm",style:{width:"120px",maxWidth:"120px"},children:e.isVerified?(0,y.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100 whitespace-nowrap",children:c("identificationDocuments.status.verified")}):(0,y.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100 whitespace-nowrap",children:c("identificationDocuments.status.pending")})}),(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-2 text-sm font-medium whitespace-nowrap",style:{width:"180px",minWidth:"180px"},children:(0,y.jsxs)("div",{className:"flex space-x-1 justify-end",children:[(0,y.jsx)("button",{onClick:()=>K(e.id),className:"p-2 rounded-md text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20",disabled:_[e.id],title:c("identificationDocuments.actions.view"),children:_[e.id]?(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):(0,y.jsx)(j.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>$(e.id),className:"p-2 rounded-md text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20",disabled:F===e.id,title:c("identificationDocuments.actions.download",{defaultValue:"Herunterladen"}),children:F===e.id?(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):(0,y.jsx)(N.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>U(e),className:"p-2 rounded-md text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20",title:c("identificationDocuments.actions.edit"),children:(0,y.jsx)(C.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>q(e.id),className:"p-2 rounded-md text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",title:c("identificationDocuments.actions.delete"),children:(0,y.jsx)(E.A,{className:"h-5 w-5"})}),d&&!e.isVerified&&(0,y.jsx)("button",{onClick:()=>Y(e.id),className:"p-2 rounded-md text-green-700 hover:bg-green-50 dark:hover:bg-green-900/20",title:c("identificationDocuments.actions.verify"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})})]})})]},e.id)))})]})})]})}))},2882:(e,t,r)=>{r.d(t,{C:()=>s});var a=r(1801),n=r(8018);const s=async e=>{try{n.v.log("Starte KI-basierte Dokumentenerkennung..."),e.startsWith("data:image")||(e=e.startsWith("/9j/")?"data:image/jpeg;base64,"+e:e.startsWith("iVBOR")?"data:image/png;base64,"+e:"data:image/jpeg;base64,"+e);const t=localStorage.getItem("token");if(!t)throw new Error("Nicht authentifiziert. Bitte melden Sie sich an.");const r="".concat(a.H$,"/document-recognition");n.v.log("Verwende API-Endpunkt:",r);const s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},credentials:"include",mode:"cors",body:JSON.stringify({image:e})});if(!s.ok){const e=await s.text();throw new Error("API-Anfrage fehlgeschlagen: ".concat(s.status," ").concat(e))}const i=await s.json();return n.v.log("KI-Ergebnis:",i),i}catch(t){return console.error("Fehler bei der KI-basierten Dokumentenerkennung:",t),{}}}},3700:(e,t,r)=>{r.d(t,{e:()=>i});var a=r(2882),n=r(1923),s=r(1801);const i=async(e,t,r,i)=>{try{const i=await new Promise(((t,r)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=r,a.readAsDataURL(e)})),o=await(0,a.C)(i),d=new FormData;return d.append("documentFile",e),o.documentType&&d.append("documentType",o.documentType),o.documentNumber&&d.append("documentNumber",o.documentNumber),o.issueDate&&d.append("issueDate",o.issueDate),o.expiryDate&&d.append("expiryDate",o.expiryDate),o.issuingCountry&&d.append("issuingCountry",o.issuingCountry),o.issuingAuthority&&d.append("issuingAuthority",o.issuingAuthority),o.firstName&&d.append("firstName",o.firstName),o.lastName&&d.append("lastName",o.lastName),o.birthday&&d.append("birthday",o.birthday),o.gender&&d.append("gender",o.gender),o.country&&d.append("country",o.country),await n.A.post(s.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(t),d,{headers:{"Content-Type":"multipart/form-data"}}),r&&r(),{success:!0,message:"Dokument erfolgreich hochgeladen"}}catch(c){var o,d;const e=(null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.error)||c.message||"Fehler beim Hochladen des Dokuments";return i&&i(e),{success:!1,message:e}}}}}]);
//# sourceMappingURL=786.3bc84aa7.chunk.js.map