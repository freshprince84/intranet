"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[481],{481:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ce});var r=a(5043),s=a(4117),l=a(3216),n=a(2760),i=a(9379),o=a(1801),d=a(1923),c=a(2672),m=a(2395),x=a(579);const u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CHF";return new Intl.NumberFormat("CHF"===t?"de-CH":"es-CO",{style:"currency",currency:t}).format(e)},y=(e,t)=>{const a="payroll.payrollComponent.contractTypes.".concat(e),r=t(a);return r!==a?r:e},g=()=>{const{t:e}=(0,s.Bd)(),{user:t}=(0,c.As)(),{hasPermission:a,getAccessLevel:l,loading:g}=(0,n.S)(),p=a("payroll","write")||a("payroll","both"),[h,b]=(0,r.useState)({regular:0,overtime:0,night:0,holidayHours:0,sundayHoliday:0,overtimeNight:0,overtimeSundayHoliday:0,overtimeNightSundayHoliday:0}),[v,N]=(0,r.useState)(null),[j,k]=(0,r.useState)([]),[f,w]=(0,r.useState)(null),[C,S]=(0,r.useState)([]),{organization:D}=(0,m.Z)(),[A,E]=(0,r.useState)(null),[R,L]=(0,r.useState)(null),[T,H]=(0,r.useState)(!1),[F,O]=(0,r.useState)(null),P=l("payroll_reports","tab"),_="all_both"===P||"all_read"===P;(0,r.useEffect)((()=>{_||null===t||void 0===t||!t.id||f||w(t.id)}),[_,null===t||void 0===t?void 0:t.id,f]);const I=(0,r.useMemo)((()=>_?C:[]),[C,_]);(0,r.useEffect)((()=>{a("payroll_reports","read","tab")&&_&&(async()=>{try{const e=await d.A.get(o.Sn.USERS.DROPDOWN);S(e.data)}catch(F){console.error("Fehler beim Laden der Benutzer:",F),O(e("payroll.payrollComponent.usersLoadError"))}})()}),[a,_,e]);const M=(0,r.useCallback)((async()=>{if(f){H(!0);try{const e=await d.A.get("".concat(o.Sn.PAYROLL.BASE,"?userId=").concat(f));k(e.data),H(!1)}catch(F){console.error("Fehler beim Laden der Abrechnungen:",F),O(e("payroll.payrollComponent.payrollsLoadError")),H(!1)}}}),[f,e]);(0,r.useEffect)((()=>{f&&M()}),[f,M]);const U=(0,r.useCallback)((async(e,t,a)=>{try{const r=await d.A.get("".concat(o.Sn.PAYROLL.PREFILL_HOURS,"?userId=").concat(e,"&periodStart=").concat(t.toISOString(),"&periodEnd=").concat(a.toISOString()));b(r.data)}catch(F){console.error("Fehler beim Abrufen der vorausgef\xfcllten Stunden:",F)}}),[]);(0,r.useEffect)((()=>{if(f&&I.length>0){const e=I.find((e=>e.id===f));if(e){const t=(e=>{const t=new Date;let a,r;return"CH"===e.payrollCountry?(a=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth(),25)):t.getDate()<=15?(a=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth(),15)):(a=new Date(t.getFullYear(),t.getMonth(),16),r=new Date(t.getFullYear(),t.getMonth()+1,0)),{start:a,end:r}})(e);E(t.start),L(t.end)}}else E(null),L(null)}),[f,I]),(0,r.useEffect)((()=>{f&&A&&R&&U(f,A,R)}),[A,R,f,U]);const z=(e,t)=>{const a=Math.max(0,Number(e.target.value));b((0,i.A)((0,i.A)({},h),{},{[t]:a}))},V=(0,r.useCallback)((async()=>{if(f&&A&&R){H(!0),O(null);try{const e=await d.A.post(o.Sn.PAYROLL.HOURS,{userId:f,hours:h,periodStart:A.toISOString(),periodEnd:R.toISOString()}),t=await d.A.get("".concat(o.Sn.PAYROLL.CALCULATE,"?payrollId=").concat(e.data.id));N(t.data),M(),H(!1)}catch(F){var t,a,r,s,l,n;if(console.error("Fehler beim Speichern der Stunden:",F),400===(null===(t=F.response)||void 0===t?void 0:t.status)&&null!==(a=F.response)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&null!==(s=r.error)&&void 0!==s&&s.includes("bereits eine Lohnabrechnung"))O(e("payroll.payrollComponent.duplicatePeriodError",{periodStart:A.toLocaleDateString(),periodEnd:R.toLocaleDateString()})||F.response.data.error);else O((null===(l=F.response)||void 0===l||null===(n=l.data)||void 0===n?void 0:n.error)||e("payroll.payrollComponent.saveError"));H(!1)}}else O(e("payroll.payrollComponent.selectUserAndPeriod"))}),[f,h,A,R,M,e]),B=(0,r.useCallback)((async t=>{H(!0),O(null);try{const e=await d.A.get("".concat(o.Sn.PAYROLL.CALCULATE,"?payrollId=").concat(t));N(e.data),H(!1)}catch(F){console.error("Fehler beim Laden der Abrechnung:",F),O(e("payroll.payrollComponent.loadError")),H(!1)}}),[e]),G=(0,r.useCallback)((async t=>{try{window.open("".concat(window.location.origin).concat(o.Sn.PAYROLL.PDF(t)),"_blank")}catch(F){console.error("Fehler beim Generieren des PDFs:",F),O(e("payroll.payrollComponent.pdfError"))}}),[e]);return g?(0,x.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:(0,x.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,x.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("common.loadingPermissions",{defaultValue:"Berechtigungen werden geladen..."})})]})}):a("payroll","read")?(0,x.jsxs)("div",{className:"p-6",children:[(0,x.jsx)("h1",{className:"text-2xl font-bold mb-6 dark:text-white",children:e("payroll.payrollComponent.title")}),F&&(0,x.jsx)("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-4 py-3 rounded mb-4",children:F}),_&&(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("payroll.payrollComponent.selectEmployee")}),(0,x.jsxs)("select",{className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white",value:f||"",onChange:e=>{const t=Number(e.target.value);w(t||null),N(null),b({regular:0,overtime:0,night:0,holidayHours:0,sundayHoliday:0,overtimeNight:0,overtimeSundayHoliday:0,overtimeNightSundayHoliday:0})},children:[(0,x.jsxs)("option",{value:"",children:["-- ",e("payroll.payrollComponent.pleaseSelect")," --"]}),I.map((e=>(0,x.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),f&&(0,x.jsxs)(x.Fragment,{children:[!p&&(0,x.jsx)("div",{className:"mb-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:(0,x.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:e("payroll.payrollComponent.noEditPermission")})}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:e("payroll.payrollComponent.period")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.periodStart")}),(0,x.jsx)("input",{type:"date",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:A?A.toISOString().split("T")[0]:"",onChange:e=>{const t=e.target.value?new Date(e.target.value):null;E(t)},disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.periodEnd")}),(0,x.jsx)("input",{type:"date",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:R?R.toISOString().split("T")[0]:"",onChange:e=>{const t=e.target.value?new Date(e.target.value):null;L(t)},disabled:!p})]})]})]}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:e("payroll.payrollComponent.enterHours")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.regularHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white",value:h.regular,onChange:e=>z(e,"regular")})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.overtimeHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.overtime,onChange:e=>z(e,"overtime"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.nightHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.night,onChange:e=>z(e,"night"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.holidayHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.holidayHours,onChange:e=>z(e,"holidayHours"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.sundayHolidayHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.sundayHoliday,onChange:e=>z(e,"sundayHoliday"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.overtimeNightHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.overtimeNight,onChange:e=>z(e,"overtimeNight"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.overtimeSundayHolidayHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.overtimeSundayHoliday,onChange:e=>z(e,"overtimeSundayHoliday"),disabled:!p})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("payroll.payrollComponent.overtimeNightSundayHolidayHours")}),(0,x.jsx)("input",{type:"number",min:"0",step:"0.5",className:"border border-gray-300 dark:border-gray-600 rounded-md p-2 w-full dark:bg-gray-700 dark:text-white disabled:opacity-50 disabled:cursor-not-allowed",value:h.overtimeNightSundayHoliday,onChange:e=>z(e,"overtimeNightSundayHoliday"),disabled:!p})]})]}),(0,x.jsx)("button",{className:"mt-4 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-blue-300 dark:disabled:bg-blue-800 disabled:cursor-not-allowed",onClick:V,disabled:T||!p,children:e(T?"payroll.payrollComponent.saving":"payroll.payrollComponent.saveAndCalculate")})]}),j.length>0&&(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:e("payroll.payrollComponent.existingPayrolls")}),(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e("payroll.payrollComponent.period")}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e("payroll.payrollComponent.totalHours")}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e("payroll.payrollComponent.grossPay")}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e("payroll.payrollComponent.netPay")}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e("payroll.payrollComponent.actions")})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:j.map((t=>(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[new Date(t.periodStart).toLocaleDateString()," - ",new Date(t.periodEnd).toLocaleDateString()]}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.regularHours+t.overtimeHours+t.nightHours+t.holidayHours+t.sundayHolidayHours+t.overtimeNightHours+t.overtimeSundayHolidayHours+t.overtimeNightSundayHolidayHours}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:u(Number(t.grossPay),t.currency)}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:u(Number(t.netPay),t.currency)}),(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[(0,x.jsx)("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 mr-3",onClick:()=>B(t.id),children:e("payroll.payrollComponent.details")}),(0,x.jsx)("button",{className:"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300",onClick:()=>G(t.id),children:"PDF"})]})]},t.id)))})]})})]}),v&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-sm",children:[(0,x.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:e("payroll.payrollComponent.payrollDetails")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:e("payroll.payrollComponent.employee")}),(0,x.jsxs)("p",{className:"text-gray-900 dark:text-gray-100",children:[v.user.firstName," ",v.user.lastName]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:e("payroll.payrollComponent.period")}),(0,x.jsxs)("p",{className:"text-gray-900 dark:text-gray-100",children:[new Date(v.periodStart).toLocaleDateString()," - ",new Date(v.periodEnd).toLocaleDateString()]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:e("payroll.payrollComponent.country")}),(0,x.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:e("countries.".concat(v.user.payrollCountry))})]}),"CO"===v.user.payrollCountry&&v.user.contractType&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:e("payroll.payrollComponent.contractType")}),(0,x.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:y(v.user.contractType,e)})]})]}),(0,x.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4 mb-4",children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("payroll.payrollComponent.workingHours")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.regularHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.regularHours})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.overtimeHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.overtimeHours})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.nightHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.nightHours})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.holidaySundayHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.holidayHours+v.sundayHolidayHours})]}),"CO"===v.user.payrollCountry&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.overtimeNightHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.overtimeNightHours})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.overtimeSundayHolidayHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.overtimeSundayHolidayHours})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.overtimeNightSundayHolidayHours")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.overtimeNightSundayHolidayHours})]})]})]})]}),(0,x.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4",children:[(0,x.jsx)("h3",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("payroll.payrollComponent.calculation")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.hourlyRate")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u(Number(v.hourlyRate),v.currency)})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.grossPay")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u(Number(v.grossPay),v.currency)})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.socialSecurity")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u(Number(v.socialSecurity),v.currency)})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.taxes")}),(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u(Number(v.taxes),v.currency)})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("payroll.payrollComponent.netPay")}),(0,x.jsx)("p",{className:"font-medium font-bold text-gray-900 dark:text-gray-100",children:u(Number(v.netPay),v.currency)})]})]})]}),(0,x.jsxs)("div",{className:"mt-6",children:[(0,x.jsx)("button",{className:"bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600",onClick:()=>G(v.id),children:e("payroll.payrollComponent.generatePDF")}),(0,x.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,x.jsx)("h3",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:e("payroll.payrollComponent.paymentInstruction")}),(0,x.jsxs)("p",{className:"text-blue-700 dark:text-blue-300",children:[(0,x.jsxs)("strong",{children:[e("payroll.payrollComponent.recipient"),":"]})," ",v.user.firstName," ",v.user.lastName]}),(0,x.jsxs)("p",{className:"text-blue-700 dark:text-blue-300",children:[(0,x.jsxs)("strong",{children:[e("payroll.payrollComponent.amount"),":"]})," ",u(Number(v.netPay),v.currency)]}),(0,x.jsxs)("p",{className:"text-blue-700 dark:text-blue-300",children:[(0,x.jsxs)("strong",{children:[e("payroll.payrollComponent.paymentReason"),":"]})," ",e("payroll.payrollComponent.salary")," ",new Date(v.periodStart).toLocaleDateString()," - ",new Date(v.periodEnd).toLocaleDateString()]}),(0,x.jsxs)("p",{className:"text-blue-700 dark:text-blue-300",children:[(0,x.jsxs)("strong",{children:[e("payroll.payrollComponent.payUntil"),":"]})," ",new Date(new Date(v.periodEnd).getTime()+432e6).toLocaleDateString()]})]})]})]})]})]}):(0,x.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 text-center",children:(0,x.jsx)("p",{className:"text-red-800 dark:text-red-200",children:e("payroll.payrollComponent.noPermission")})})};var p=a(8010),h=a(4850),b=a(1663),v=a(1909),N=a(7449),j=a(2517),k=a(2811),f=a(8416),w=a(2683),C=a(6238),S=a(7988),D=a(7591),A=a(8662),E=a(9248),R=a(9422),L=a(2415),T=a(887),H=a(2023),F=a(8897),O=a(4426),P=a(7829),_=a(6443),I=a(4129),M=a(7012),U=a(1816),z=a(7855),V=a(1713);const B=e=>{const t={DRAFT:{label:"Entwurf",color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},SENT:{label:"Gesendet",color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},PAID:{label:"Bezahlt",color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},OVERDUE:{label:"\xdcberf\xe4llig",color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},CANCELLED:{label:"Storniert",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}}[e];return(0,x.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.color),children:t.label})},G=e=>{let{isOpen:t,onClose:a,invoiceId:l,onInvoiceUpdated:n}=e;const{t:i}=(0,s.Bd)(),{showMessage:c}=(0,z.A)(),[m,u]=(0,r.useState)(null),[y,g]=(0,r.useState)(!0),[p,h]=(0,r.useState)(null),[b,v]=(0,r.useState)(!1);(0,r.useEffect)((()=>{t&&l&&N()}),[t,l]);const N=async()=>{try{g(!0);const e=await d.A.get(o.Sn.CONSULTATION_INVOICES.BY_ID(l));u(e.data),h(null)}catch(p){console.error("Fehler beim Laden der Rechnungsdetails:",p),h("Fehler beim Laden der Rechnungsdetails")}finally{g(!1)}},j=()=>null!==m&&void 0!==m&&m.payments?m.payments.reduce(((e,t)=>e+Number(t.amount)),0):0,k=()=>m?Number(m.total)-j():0;return t?(0,x.jsxs)(_.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,x.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,x.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,x.jsx)(_.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:(0,x.jsxs)("div",{className:"p-6",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)(_.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnungsdetails"}),m&&B(m.status)]}),(0,x.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,x.jsx)(D.A,{className:"h-6 w-6"})})]}),y?(0,x.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,x.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),(0,x.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,x.jsx)("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded"})]}):p?(0,x.jsx)("div",{className:"text-center text-red-600 dark:text-red-400 py-6",children:p}):m?(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Rechnungsinformationen"}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rechnungsnummer"}),(0,x.jsx)("p",{className:"text-gray-900 dark:text-white font-mono",children:m.invoiceNumber})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rechnungsdatum"}),(0,x.jsx)("p",{className:"text-gray-900 dark:text-white",children:(0,L.GP)(new Date(m.issueDate),"dd.MM.yyyy",{locale:T.de})})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"F\xe4lligkeitsdatum"}),(0,x.jsx)("p",{className:"text-gray-900 dark:text-white",children:(0,L.GP)(new Date(m.dueDate),"dd.MM.yyyy",{locale:T.de})})]})]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,x.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,x.jsxs)("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-200 mb-3 flex items-center",children:[(0,x.jsx)(I.A,{className:"h-5 w-5 mr-2"}),"Kunde"]}),(0,x.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,x.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:m.client.name}),m.client.company&&(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:m.client.company}),m.client.email&&(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:m.client.email}),m.client.phone&&(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:m.client.phone}),m.client.address&&(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:m.client.address})]})]}),(0,x.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,x.jsxs)("h3",{className:"text-lg font-medium text-green-800 dark:text-green-200 mb-3 flex items-center",children:[(0,x.jsx)(C.A,{className:"h-5 w-5 mr-2"}),"Berater"]}),(0,x.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,x.jsxs)("p",{className:"font-medium text-gray-900 dark:text-white",children:[m.user.firstName," ",m.user.lastName]}),(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:m.user.email})]})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[(0,x.jsx)(M.A,{className:"h-5 w-5 mr-2"}),"Abgerechnete Beratungen (",m.items.length,")"]}),(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Datum & Zeit"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Dauer"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Niederlassung"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Stundensatz"}),(0,x.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Betrag"})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:m.items.map((e=>(0,x.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"font-medium",children:(0,V.fU)(e.workTime.startTime)}),(0,x.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-xs",children:(0,L.GP)(new Date(e.workTime.startTime),"dd.MM.yyyy",{locale:T.de})})]})}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,V.P0)(e.workTime.startTime,e.workTime.endTime)}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.workTime.branch.name}),(0,x.jsxs)("td",{className:"px-4 py-2 text-right text-sm text-gray-900 dark:text-gray-200",children:[m.currency," ",Number(e.unitPrice).toFixed(2)]}),(0,x.jsxs)("td",{className:"px-4 py-2 text-right text-sm text-gray-900 dark:text-gray-200",children:[m.currency," ",Number(e.amount).toFixed(2)]})]},e.id)))})]})})]}),(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Rechnungssumme"}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:"Zwischensumme:"}),(0,x.jsxs)("span",{children:[m.currency," ",Number(m.subtotal).toFixed(2)]})]}),m.vatRate&&m.vatAmount&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{children:["MwSt. (",Number(m.vatRate).toFixed(1),"%):"]}),(0,x.jsxs)("span",{children:[m.currency," ",Number(m.vatAmount).toFixed(2)]})]}),(0,x.jsxs)("div",{className:"flex justify-between border-t border-gray-200 dark:border-gray-600 pt-2 font-bold",children:[(0,x.jsx)("span",{children:"Gesamtbetrag:"}),(0,x.jsxs)("span",{children:[m.currency," ",Number(m.total).toFixed(2)]})]})]})]}),m.payments.length>0&&(0,x.jsxs)("div",{children:[(0,x.jsxs)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[(0,x.jsx)(w.A,{className:"h-5 w-5 mr-2"}),"Zahlungen (",m.payments.length,")"]}),(0,x.jsxs)("div",{className:"space-y-3",children:[m.payments.map((e=>(0,x.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:(0,x.jsx)("div",{className:"flex justify-between items-start",children:(0,x.jsxs)("div",{children:[(0,x.jsxs)("p",{className:"font-medium text-green-800 dark:text-green-200",children:[m.currency," ",Number(e.amount).toFixed(2)]}),(0,x.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:(0,L.GP)(new Date(e.paymentDate),"dd.MM.yyyy HH:mm",{locale:T.de})}),(0,x.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.paymentMethod,e.reference&&" - ".concat(e.reference)]})]})})},e.id))),(0,x.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:"Bezahlt:"}),(0,x.jsxs)("span",{className:"ml-2 font-medium",children:[m.currency," ",j().toFixed(2)]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:"Ausstehend:"}),(0,x.jsxs)("span",{className:"ml-2 font-medium",children:[m.currency," ",k().toFixed(2)]})]})]})})]})]}),m.notes&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Notizen"}),(0,x.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,x.jsx)("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:m.notes})})]}),(0,x.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,x.jsx)("button",{onClick:async()=>{if(m)try{const e=await d.A.get(o.Sn.CONSULTATION_INVOICES.GENERATE_PDF(m.id),{responseType:"blob",headers:{Accept:"application/pdf"}}),t=new Blob([e.data],{type:"application/pdf"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="Rechnung_".concat(m.invoiceNumber,".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),c(i("invoice.downloadSuccess",{defaultValue:"PDF erfolgreich heruntergeladen"}),"success")}catch(p){var e,t;console.error("Fehler beim Download der PDF:",p),c((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||i("invoice.downloadError",{defaultValue:"Fehler beim Download der PDF"}),"error")}},className:"p-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 rounded-md",title:"PDF herunterladen",children:(0,x.jsx)(f.A,{className:"h-5 w-5"})}),"PAID"!==m.status&&"CANCELLED"!==m.status&&k()>0&&(0,x.jsx)("button",{onClick:async()=>{if(m)try{v(!0),await d.A.post(o.Sn.CONSULTATION_INVOICES.MARK_PAID(m.id),{amount:m.total,paymentDate:(new Date).toISOString(),paymentMethod:"Manual",reference:"Manuelle Zahlung"}),c(i("invoice.markPaidSuccess",{defaultValue:"Rechnung als bezahlt markiert"}),"success"),N(),n()}catch(p){var e,t;c((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||i("invoice.markPaidError",{defaultValue:"Fehler beim Markieren als bezahlt"}),"error")}finally{v(!1)}},disabled:b,className:"p-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:bg-green-700 dark:hover:bg-green-800 disabled:opacity-50 disabled:cursor-not-allowed",title:b?"Verarbeitung...":"Als bezahlt markieren",children:b?(0,x.jsx)(U.A,{className:"h-5 w-5 animate-spin"}):(0,x.jsx)(w.A,{className:"h-5 w-5"})}),(0,x.jsx)("button",{onClick:a,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:i("common.close"),children:(0,x.jsx)(D.A,{className:"h-5 w-5"})})]})]}):null]})})})]}):null};var W=a(6400),Y=a(7488),q=a(5657),K=a(957),Z=a(637);const Q=["expand","invoiceNumber","client","issueDate","dueDate","total","status","actions"],$="invoice-management",J={expand:[],invoiceNumber:["invoiceNumber"],client:["client"],issueDate:["issueDate"],dueDate:["dueDate"],total:["total"],status:["status"],actions:[]},X=e=>{var t;let{selectedInvoiceId:a}=e;const{t:l}=(0,s.Bd)(),{hasPermission:i}=(0,n.S)(),{openSidepane:c,closeSidepane:m}=(0,q.N)(),[u,y]=(0,r.useState)(window.innerWidth>1070),[g,_]=(0,r.useState)([]),[I,M]=(0,r.useState)(!0),[U,z]=(0,r.useState)(null),[V,B]=(0,r.useState)(""),[X,ee]=(0,r.useState)(!1),[te,ae]=(0,r.useState)([]),[re,se]=(0,r.useState)([]),[le,ne]=(0,r.useState)(""),[ie,oe]=(0,r.useState)(null),[de,ce]=(0,r.useState)(a||null),[me,xe]=(0,r.useState)(!1),[ue,ye]=(0,r.useState)(new Set),[ge,pe]=(0,r.useState)(!1),[he,be]=(0,r.useState)(null),[ve,Ne]=(0,r.useState)({}),je=i("consultation_invoices","read","table"),ke=i("invoice_mark_paid","write","button"),fe=i("invoice_download","read","button"),{settings:we,isLoading:Ce,updateColumnOrder:Se,updateHiddenColumns:De,toggleColumnVisibility:Ae,isColumnVisible:Ee,updateViewMode:Re,updateSortConfig:Le}=(0,H.F)($,{defaultColumnOrder:Q,defaultHiddenColumns:[],defaultViewMode:"cards"}),[Te,He]=(0,r.useState)(!1),Fe=(0,r.useMemo)((()=>[{id:"expand",label:"",shortLabel:""},{id:"invoiceNumber",label:l("invoices.columns.invoiceNumber"),shortLabel:l("invoices.columns.invoiceNumber").substring(0,2)},{id:"client",label:l("invoices.columns.client"),shortLabel:l("invoices.columns.client")},{id:"issueDate",label:l("invoices.columns.issueDate"),shortLabel:l("common.today").substring(0,3)},{id:"dueDate",label:l("invoices.columns.dueDate"),shortLabel:l("invoices.columns.dueDate").substring(0,5)},{id:"total",label:l("invoices.columns.total"),shortLabel:l("invoices.columns.total")},{id:"status",label:l("invoices.columns.status"),shortLabel:l("invoices.columns.status")},{id:"actions",label:l("common.actions"),shortLabel:l("common.actions").substring(0,3)}]),[l]),Oe=we.sortConfig||{key:"issueDate",direction:"desc"},Pe=(0,r.useMemo)((()=>({DRAFT:{label:l("invoices.status.draft"),color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},SENT:{label:l("invoices.status.sent"),color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},PAID:{label:l("invoices.status.paid"),color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},OVERDUE:{label:l("invoices.status.overdue"),color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},CANCELLED:{label:l("invoices.status.cancelled"),color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}})),[l]),_e=e=>{const t=Pe[e];return(0,x.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.color),children:t.label})},Ie=we.viewMode||"cards",Me=(0,r.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const a=J[e];a&&a.length>0&&t.push(...a)})),t})(we.columnOrder||Q)),[we.columnOrder]),Ue=(0,r.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(J[e]||[]).forEach((e=>t.add(e)))})),t})(we.hiddenColumns||[])),[we.hiddenColumns]),ze=(0,r.useMemo)((()=>new Set(Me.filter((e=>!Ue.has(e))))),[Me,Ue]);(0,r.useEffect)((()=>{const e=document.querySelector(".dashboard-invoices-wrapper");e&&("cards"===Ie?e.classList.add("cards-mode"):e.classList.remove("cards-mode"))}),[Ie]),(0,r.useEffect)((()=>{Ve()}),[]),(0,r.useEffect)((()=>{if(a&&g.length>0){g.find((e=>e.id===a))&&(ce(a),xe(!0))}}),[a,g]);const Ve=async()=>{try{M(!0);const e=await d.A.get(o.Sn.CONSULTATION_INVOICES.BASE);_(e.data),z(null)}catch(U){console.error("Fehler beim Laden der Rechnungen:",U),z(l("invoice.loadError"))}finally{M(!1)}},Be=async(e,t)=>{try{const a=await d.A.get(o.Sn.CONSULTATION_INVOICES.GENERATE_PDF(e),{responseType:"blob",headers:{Accept:"application/pdf"}}),r=new Blob([a.data],{type:"application/pdf"}),s=window.URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download="Rechnung_".concat(t,".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),Y.oR.success(l("invoice.downloadSuccess"))}catch(U){var a,r;console.error("Fehler beim Download der PDF:",U),Y.oR.error((null===(a=U.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||l("invoice.downloadError"))}},Ge=async e=>{try{var t;await d.A.post(o.Sn.CONSULTATION_INVOICES.MARK_PAID(e),{amount:(null===(t=g.find((t=>t.id===e)))||void 0===t?void 0:t.total)||0,paymentDate:(new Date).toISOString(),paymentMethod:"Manual",reference:"Manuelle Zahlung"}),Y.oR.success(l("invoice.markPaidSuccess")),Ve()}catch(U){var a,r;Y.oR.error((null===(a=U.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||l("invoice.markPaidError"))}},We=e=>{ye((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))};(0,r.useEffect)((()=>{const e=()=>{y(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(ge?c():m(),()=>{m()})),[ge,c,m]);const Ye=e=>{be(e),pe(!0)},qe=()=>{pe(!1),be(null),Ne({})},Ke=(e,t)=>{ae(e),se(t)},Ze=()=>{ae([]),se([]),ne(""),oe(null)},Qe=(0,r.useMemo)((()=>{let e=g;if(V){const t=V.toLowerCase();e=e.filter((e=>{if(e.invoiceNumber.toLowerCase().includes(t))return!0;if(e.client.name.toLowerCase().includes(t))return!0;if(e.client.company&&e.client.company.toLowerCase().includes(t))return!0;return!!"".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase().includes(t)}))}if(te.length>0){const t={client:(e,t)=>{const a=e.client.name.toLowerCase(),r=(t.value||"").toLowerCase();return"contains"===t.operator?a.includes(r):"equals"===t.operator?e.client.name===t.value:null},status:(e,t)=>"equals"===t.operator?e.status===t.value:null,total:(e,t)=>{const a=e.total,r=parseFloat(t.value);return!isNaN(r)&&("greaterThan"===t.operator?a>r:"lessThan"===t.operator?a<r:"equals"===t.operator?Math.abs(a-r)<.01:null)}},a=(e,t)=>{switch(t){case"client":return e.client.name;case"status":return e.status;case"total":return e.total;default:return e[t]}};e=(0,W.W5)(e,te,re,a,t)}if("cards"===Ie){const t=Me.filter((e=>ze.has(e)));e.sort(((e,a)=>{for(const r of t){const t=cardSortDirections[r]||"asc";let s,l;switch(r){case"invoiceNumber":s=e.invoiceNumber.toLowerCase(),l=a.invoiceNumber.toLowerCase();break;case"client":s=e.client.name.toLowerCase(),l=a.client.name.toLowerCase();break;case"issueDate":s=new Date(e.issueDate).getTime(),l=new Date(a.issueDate).getTime();break;case"dueDate":s=new Date(e.dueDate).getTime(),l=new Date(a.dueDate).getTime();break;case"total":s=Number(e.total),l=Number(a.total);break;case"status":s=e.status.toLowerCase(),l=a.status.toLowerCase();break;default:continue}let n=0;if("number"===typeof s&&"number"===typeof l)n=s-l;else{const e="string"===typeof s?s:String(s),t="string"===typeof l?l:String(l);n=e.localeCompare(t)}if("desc"===t&&(n=-n),0!==n)return n}return 0}))}else e.sort(((e,t)=>{let a,r;switch(Oe.key){case"issueDate":a=new Date(e.issueDate).getTime(),r=new Date(t.issueDate).getTime();break;case"dueDate":a=new Date(e.dueDate).getTime(),r=new Date(t.dueDate).getTime();break;case"client.name":a=e.client.name,r=t.client.name;break;case"total":a=e.total,r=t.total;break;case"invoiceNumber":a=e.invoiceNumber,r=t.invoiceNumber;break;default:return 0}return a<r?"asc"===Oe.direction?-1:1:a>r?"asc"===Oe.direction?1:-1:0}));return e}),[g,V,te,re,Oe,Ie,Me,ze]),$e=(e,t,a)=>(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer select-none",onClick:()=>a&&(e=>{const t=Oe.key===e&&"asc"===Oe.direction?"desc":"asc";Le({key:e,direction:t})})(a),children:(0,x.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,x.jsx)("span",{children:t}),a&&Oe.key===a&&(0,x.jsx)("span",{children:"asc"===Oe.direction?"\u2191":"\u2193"})]})},e);return I&&0===g.length?(0,x.jsxs)("div",{className:"animate-pulse",children:[(0,x.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),(0,x.jsx)("div",{className:"space-y-3",children:[...Array(5)].map(((e,t)=>(0,x.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t)))})]}):je?(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-6 px-3 sm:px-4 md:px-6 -mx-3 sm:-mx-4 md:-mx-6",children:[(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Beratungsrechnungen"}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsxs)("button",{onClick:()=>ee(!0),className:"p-2 rounded-md ".concat(te.length>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"," hover:bg-gray-200 dark:hover:bg-gray-600 relative"),children:[(0,x.jsx)(p.A,{className:"h-5 w-5"}),te.length>0&&(0,x.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:te.length})]}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.filter")})]}),(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{type:"button",className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Ie?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Re("table"===Ie?"cards":"table"),children:"table"===Ie?(0,x.jsx)(h.A,{className:"h-5 w-5"}):(0,x.jsx)(b.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("table"===Ie?"common.viewAsCards":"common.viewAsTable")})]}),(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>He(!0),className:"p-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:(0,x.jsx)(v.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("cards"===Ie?"tableColumn.sortAndDisplay":"tableColumn.configure")})]})]})]}),(0,x.jsxs)("div",{className:"relative mb-6 px-3 sm:px-4 md:px-6 -mx-3 sm:-mx-4 md:-mx-6",children:[(0,x.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,x.jsx)(N.A,{className:"h-5 w-5 text-gray-400"})}),(0,x.jsx)("input",{type:"text",value:V,onChange:e=>B(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:l("invoices.searchPlaceholder")})]}),(0,x.jsx)("div",{className:"cards"===Ie?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6 -mx-3 sm:-mx-4 md:-mx-6",children:(0,x.jsx)(P.A,{tableId:$,onSelectFilter:Ke,onReset:Ze,activeFilterName:le,selectedFilterId:ie,onFilterChange:(e,t,a,r)=>{ne(e),oe(t),Ke(a,r)}})}),U?(0,x.jsx)("div",{className:"text-center text-red-600 dark:text-red-400 py-6 px-3 sm:px-4 md:px-6 -mx-3 sm:-mx-4 md:-mx-6",children:U}):"table"===Ie?(0,x.jsx)("div",{className:"dashboard-invoices-wrapper overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,x.jsx)("tr",{children:we.columnOrder.filter((e=>Ee(e))).map((e=>{const t=Fe.find((t=>t.id===e));if(!t)return null;switch(e){case"expand":return(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left w-12"},"expand");case"invoiceNumber":return $e("invoiceNumber",t.label,"invoiceNumber");case"client":return $e("client",t.label,"client.name");case"issueDate":return $e("issueDate",t.label,"issueDate");case"dueDate":return $e("dueDate",t.label,"dueDate");case"total":return $e("total",t.label,"total");case"status":return $e("status",t.label,"status");default:return $e(e,t.label)}}))})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Qe.map((e=>{var t;return(0,x.jsxs)(r.Fragment,{children:[(0,x.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[Ee("expand")&&(0,x.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>We(e.id),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,x.jsx)(j.A,{className:"h-4 w-4 transition-transform ".concat(ue.has(e.id)?"rotate-180":"")})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:ue.has(e.id)?l("common.collapse"):l("common.expand")})]})}),Ee("invoiceNumber")&&(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-200",children:e.invoiceNumber}),Ee("client")&&(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"font-medium",children:e.client.name}),e.client.company&&(0,x.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-xs",children:e.client.company})]})}),Ee("issueDate")&&(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,L.GP)(new Date(e.issueDate),"dd.MM.yyyy",{locale:T.de})}),Ee("dueDate")&&(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,L.GP)(new Date(e.dueDate),"dd.MM.yyyy",{locale:T.de})}),Ee("total")&&(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(e.total).toFixed(2)]}),Ee("status")&&(0,x.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:_e(e.status)}),Ee("actions")&&(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,x.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Ye(e),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,x.jsx)(k.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.edit")})]}),fe&&(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Be(e.id,e.invoiceNumber),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,x.jsx)(f.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("invoices.downloadPDF")})]}),ke&&"PAID"!==e.status&&"CANCELLED"!==e.status&&(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Ge(e.id),className:"text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300",children:(0,x.jsx)(w.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("invoices.markAsPaid")})]})]})})]}),ue.has(e.id)&&(0,x.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-900",children:(0,x.jsx)("td",{colSpan:we.columnOrder.filter((e=>Ee(e))).length,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsx)("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:l("invoices.detailsAndPositions")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.columns.invoiceNumber")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.invoiceNumber})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.consultant")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):l("common.unknown")})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.paymentTerms")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.paymentTerms})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.subtotal")}),(0,x.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(e.subtotal).toFixed(2)]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.vat")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.vatAmount?"".concat(e.currency," ").concat(Number(e.vatAmount).toFixed(2)," (").concat(e.vatRate,"%)"):l("invoices.noVat")})]})]}),e.notes&&(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("invoices.notes")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200 bg-white dark:bg-gray-800 p-3 rounded border",children:e.notes})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,x.jsx)("h5",{className:"text-md font-medium text-gray-900 dark:text-white",children:l("invoices.items",{count:(null===(t=e.items)||void 0===t?void 0:t.length)||0})}),(0,x.jsxs)("button",{onClick:()=>Ye(e),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[(0,x.jsx)(k.A,{className:"h-4 w-4 mr-2"}),l("invoices.editItems")]})]}),e.items&&e.items.length>0?(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemDescription")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemQuantity")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemUnitPrice")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemAmount")})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.items.map((t=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.description}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:Number(t.quantity).toFixed(2)}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(t.unitPrice).toFixed(2)]}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(t.amount).toFixed(2)]})]},t.id)))})]})}):(0,x.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:l("invoices.noItems")})]})]})})})]},e.id)}))})]})}):(0,x.jsx)("div",{className:"dashboard-invoices-wrapper -mx-3 sm:-mx-4 md:-mx-6",children:0===Qe.length?(0,x.jsx)("div",{className:"text-center py-8 text-sm text-gray-500 dark:text-gray-400",children:l("invoices.noInvoicesFound")}):(0,x.jsx)(Z.A,{gap:"md",children:Qe.map((e=>{var t;const a=ue.has(e.id),r=[];ze.has("invoiceNumber")&&r.push({label:l("invoices.columns.invoiceNumber"),value:e.invoiceNumber,icon:(0,x.jsx)(f.A,{className:"h-4 w-4"})}),ze.has("client")&&r.push({label:l("invoices.columns.client"),value:e.client.company?"".concat(e.client.name," (").concat(e.client.company,")"):e.client.name,icon:(0,x.jsx)(C.A,{className:"h-4 w-4"})}),ze.has("issueDate")&&r.push({label:l("invoices.columns.issueDate"),value:(0,L.GP)(new Date(e.issueDate),"dd.MM.yyyy",{locale:T.de}),icon:(0,x.jsx)(S.A,{className:"h-4 w-4"})}),ze.has("dueDate")&&r.push({label:l("invoices.columns.dueDate"),value:(0,L.GP)(new Date(e.dueDate),"dd.MM.yyyy",{locale:T.de}),icon:(0,x.jsx)(S.A,{className:"h-4 w-4"})}),ze.has("total")&&r.push({label:l("invoices.columns.total"),value:"".concat(e.currency," ").concat(Number(e.total).toFixed(2)),icon:(0,x.jsx)(w.A,{className:"h-4 w-4"})});const s={DRAFT:{label:l("invoices.status.draft"),color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},SENT:{label:l("invoices.status.sent"),color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},PAID:{label:l("invoices.status.paid"),color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},OVERDUE:{label:l("invoices.status.overdue"),color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},CANCELLED:{label:l("invoices.status.cancelled"),color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}}[e.status],n=(0,x.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Ye(e),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,x.jsx)(k.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.edit")})]}),fe&&(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Be(e.id,e.invoiceNumber),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,x.jsx)(f.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("invoice.downloadPdfTitle")})]}),ke&&"PAID"!==e.status&&"CANCELLED"!==e.status&&(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Ge(e.id),className:"text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300",children:(0,x.jsx)(w.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Als bezahlt markieren"})]})]}),i=(0,x.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,x.jsx)("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Rechnungsdetails & Positionen"}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rechnungsnummer"}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.invoiceNumber})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berater"}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):"Unbekannt"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Zahlungsbedingungen"}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.paymentTerms})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Untertotal"}),(0,x.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(e.subtotal).toFixed(2)]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"MwSt."}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:e.vatAmount?"".concat(e.currency," ").concat(Number(e.vatAmount).toFixed(2)," (").concat(e.vatRate,"%)"):"Keine MwSt."})]})]}),e.notes&&(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("invoices.notes")}),(0,x.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200 bg-white dark:bg-gray-800 p-3 rounded border",children:e.notes})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,x.jsxs)("h5",{className:"text-md font-medium text-gray-900 dark:text-white",children:["Rechnungspositionen (",(null===(t=e.items)||void 0===t?void 0:t.length)||0,")"]}),(0,x.jsxs)("button",{onClick:()=>Ye(e),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[(0,x.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Positionen bearbeiten"]})]}),e.items&&e.items.length>0?(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemDescription")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemQuantity")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemUnitPrice")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:l("invoices.itemAmount")})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.items.map((t=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.description}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:Number(t.quantity).toFixed(2)}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(t.unitPrice).toFixed(2)]}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:[e.currency," ",Number(t.amount).toFixed(2)]})]},t.id)))})]})}):(0,x.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:"Keine Rechnungspositionen vorhanden"})]})]});return(0,x.jsx)(K.A,{title:e.invoiceNumber,status:{label:s.label,color:s.color},metadata:r,actions:n,expandable:{isExpanded:a,content:i,onToggle:()=>We(e.id)}},e.id)}))})}),X&&(0,x.jsx)(O.A,{columns:[{id:"client",label:l("invoices.columns.client")},{id:"status",label:l("invoices.columns.status")},{id:"total",label:"".concat(l("invoices.columns.total")," (CHF)")}],onApply:Ke,onReset:Ze,savedConditions:te,savedOperators:re,tableId:$}),(0,x.jsx)(F.A,{isOpen:Te,onOpenChange:He,columns:Fe,columnOrder:we.columnOrder,visibleColumns:Fe.filter((e=>!we.hiddenColumns.includes(e.id))).map((e=>e.id)),onToggleColumnVisibility:e=>Ae(e),mainSortConfig:Oe,onMainSortChange:(e,t)=>{Le({key:e,direction:t})},showMainSort:!0}),me&&de&&(0,x.jsx)(G,{isOpen:me,onClose:()=>{xe(!1),ce(null)},invoiceId:de,onInvoiceUpdated:Ve}),ge&&he&&(0,x.jsx)("div",{className:"fixed inset-0 overflow-hidden z-50","aria-labelledby":"slide-over-title",role:"dialog","aria-modal":"true",children:(0,x.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[!u&&(0,x.jsx)("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity sidepane-overlay sidepane-backdrop",onClick:qe}),(0,x.jsx)("div",{className:"fixed top-16 bottom-0 right-0 pl-10 max-w-full flex sidepane-panel sidepane-panel-container",style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)"},children:(0,x.jsx)("div",{className:"w-screen max-w-2xl",children:(0,x.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-800 shadow-xl overflow-y-scroll",children:[(0,x.jsx)("div",{className:"px-4 py-6 bg-gray-50 dark:bg-gray-700 sm:px-6",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",id:"slide-over-title",children:l("invoices.editSidepane.title",{invoiceNumber:he.invoiceNumber})}),(0,x.jsx)("div",{className:"ml-3 h-7 flex items-center",children:(0,x.jsxs)("button",{type:"button",className:"bg-gray-50 dark:bg-gray-700 rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:qe,children:[(0,x.jsx)("span",{className:"sr-only",children:l("common.close")}),(0,x.jsx)(D.A,{className:"h-6 w-6","aria-hidden":"true"})]})})]})}),(0,x.jsx)("div",{className:"flex-1 px-4 py-6 sm:px-6",children:(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:l("invoices.editSidepane.basicInfo")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.invoiceNumber")}),(0,x.jsx)("input",{type:"text",value:he.invoiceNumber,disabled:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.status")}),(0,x.jsxs)("select",{value:he.status,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,x.jsx)("option",{value:"DRAFT",children:l("invoices.status.draft")}),(0,x.jsx)("option",{value:"SENT",children:l("invoices.status.sent")}),(0,x.jsx)("option",{value:"PAID",children:l("invoices.status.paid")}),(0,x.jsx)("option",{value:"OVERDUE",children:l("invoices.status.overdue")}),(0,x.jsx)("option",{value:"CANCELLED",children:l("invoices.status.cancelled")})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.editSidepane.issueDate")}),(0,x.jsx)("input",{type:"date",value:he.issueDate.split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.editSidepane.dueDate")}),(0,x.jsx)("input",{type:"date",value:he.dueDate.split("T")[0],className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:l("invoices.notes")}),(0,x.jsx)("textarea",{rows:3,value:he.notes||"",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:l("invoices.editSidepane.notesPlaceholder")})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:l("invoices.editSidepane.items")}),(0,x.jsxs)("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,x.jsx)(A.A,{className:"h-4 w-4 mr-2"}),l("invoices.editSidepane.addItem")]})]}),(0,x.jsx)("div",{className:"space-y-3",children:null===(t=he.items)||void 0===t?void 0:t.map(((e,t)=>(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[(0,x.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[(0,x.jsxs)("div",{className:"sm:col-span-2",children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:l("invoices.itemDescription")}),(0,x.jsx)("input",{type:"text",value:e.description,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:l("invoices.editSidepane.hours")}),(0,x.jsx)("input",{type:"number",step:"0.01",value:e.quantity,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:l("invoices.itemUnitPrice")}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)("input",{type:"number",step:"0.01",value:e.unitPrice,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),(0,x.jsxs)("div",{className:"relative group mt-1",children:[(0,x.jsx)("button",{type:"button",className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,x.jsx)(E.A,{className:"h-4 w-4"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("invoices.deletePosition")})]})]})]})]}),(0,x.jsx)("div",{className:"mt-2 text-right",children:(0,x.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l("invoices.itemAmount"),": ",he.currency," ",Number(e.amount).toFixed(2)]})})]},e.id||t)))})]}),(0,x.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l("invoices.subtotal"),":"]}),(0,x.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[he.currency," ",Number(he.subtotal).toFixed(2)]})]}),he.vatAmount&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l("invoices.vat")," (",he.vatRate,"%):"]}),(0,x.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[he.currency," ",Number(he.vatAmount).toFixed(2)]})]}),(0,x.jsxs)("div",{className:"flex justify-between pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,x.jsxs)("span",{className:"text-base font-medium text-gray-900 dark:text-white",children:[l("invoices.editSidepane.total"),":"]}),(0,x.jsxs)("span",{className:"text-base font-bold text-gray-900 dark:text-white",children:[he.currency," ",Number(he.total).toFixed(2)]})]})]})})]})}),(0,x.jsx)("div",{className:"flex-shrink-0 px-4 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:(0,x.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{type:"button",className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",onClick:qe,children:(0,x.jsx)(D.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.cancel")})]}),(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{type:"button",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,x.jsx)(R.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.save")})]})]})})]})})})]})})]}):(0,x.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:(0,x.jsx)("div",{className:"flex",children:(0,x.jsxs)("div",{className:"ml-3",children:[(0,x.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Keine Berechtigung"}),(0,x.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(0,x.jsx)("p",{children:"Sie haben keine Berechtigung, Rechnungen anzuzeigen."})})]})})})};var ee=a(4538),te=a(9531),ae=a(9399),re=a(8018);const se=["expand","reportNumber","period","recipient","totalHours","status","actions"],le={expand:[],reportNumber:["reportNumber"],period:["period"],recipient:["recipient"],totalHours:["totalHours"],status:["status"],actions:[]},ne=e=>{let{selectedReportId:t}=e;const{t:a}=(0,s.Bd)(),{openSidepane:l,closeSidepane:n}=(0,q.N)(),[i,c]=((0,r.useMemo)((()=>[{id:"expand",label:"",shortLabel:""},{id:"reportNumber",label:a("analytics.monthlyReports.columns.reportNumber"),shortLabel:a("analytics.monthlyReports.shortLabels.reportNumber")},{id:"period",label:a("analytics.monthlyReports.columns.period"),shortLabel:a("analytics.monthlyReports.shortLabels.period")},{id:"recipient",label:a("analytics.monthlyReports.columns.recipient"),shortLabel:a("analytics.monthlyReports.shortLabels.recipient")},{id:"totalHours",label:a("analytics.monthlyReports.columns.totalHours"),shortLabel:a("analytics.monthlyReports.shortLabels.totalHours")},{id:"status",label:a("analytics.monthlyReports.columns.status"),shortLabel:a("analytics.monthlyReports.shortLabels.status")},{id:"actions",label:a("analytics.monthlyReports.columns.actions"),shortLabel:a("analytics.monthlyReports.shortLabels.actions")}]),[a]),(0,r.useState)(window.innerWidth>1070)),[m,u]=(0,r.useState)([]),[y,g]=(0,r.useState)(!0),[p,h]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null),N=(0,r.useRef)(null),[w,F]=(0,r.useState)(new Set),{settings:O,isLoading:P,updateColumnOrder:_,updateHiddenColumns:I,toggleColumnVisibility:U,isColumnVisible:z,updateViewMode:B,updateSortConfig:G}=(0,H.F)("monthly-reports-table",{defaultColumnOrder:se,defaultHiddenColumns:[],defaultViewMode:"cards"}),W=O.viewMode||"cards",Q=O.sortConfig||{key:"period",direction:"desc"},$=r.useMemo((()=>(e=>{const t=[];return e.forEach((e=>{const a=le[e];a&&a.length>0&&t.push(...a)})),t})(O.columnOrder||se)),[O.columnOrder]),J=r.useMemo((()=>(e=>{const t=new Set;return e.forEach((e=>{(le[e]||[]).forEach((e=>t.add(e)))})),t})(O.hiddenColumns||[])),[O.hiddenColumns]),X=r.useMemo((()=>new Set($.filter((e=>!J.has(e))))),[$,J]);(0,r.useEffect)((()=>{const e=document.querySelector(".dashboard-monthly-reports-wrapper");e&&("cards"===W?e.classList.add("cards-mode"):e.classList.remove("cards-mode"))}),[W]);const ne=r.useMemo((()=>{var e,t,a,r,s,l,n,i,o,d,c,x,u,y,g,p;const h=[...m];if(Q.key){let m,b;switch(Q.key){case"reportNumber":m=(null===(e=h[0])||void 0===e||null===(t=e.reportNumber)||void 0===t?void 0:t.toLowerCase())||"",b=(null===(a=h[1])||void 0===a||null===(r=a.reportNumber)||void 0===r?void 0:r.toLowerCase())||"";break;case"period":m=null!==(s=h[0])&&void 0!==s&&s.periodStart?new Date(h[0].periodStart).getTime():0,b=null!==(l=h[1])&&void 0!==l&&l.periodStart?new Date(h[1].periodStart).getTime():0;break;case"recipient":m=(null===(n=h[0])||void 0===n||null===(i=n.recipient)||void 0===i?void 0:i.toLowerCase())||"",b=(null===(o=h[1])||void 0===o||null===(d=o.recipient)||void 0===d?void 0:d.toLowerCase())||"";break;case"totalHours":m=Number(null===(c=h[0])||void 0===c?void 0:c.totalHours)||0,b=Number(null===(x=h[1])||void 0===x?void 0:x.totalHours)||0;break;case"status":m=(null===(u=h[0])||void 0===u||null===(y=u.status)||void 0===y?void 0:y.toLowerCase())||"",b=(null===(g=h[1])||void 0===g||null===(p=g.status)||void 0===p?void 0:p.toLowerCase())||"";break;default:return h}h.sort(((e,t)=>{var a,r,s,l,n,i;let o,d;switch(Q.key){case"reportNumber":o=(null===(a=e.reportNumber)||void 0===a?void 0:a.toLowerCase())||"",d=(null===(r=t.reportNumber)||void 0===r?void 0:r.toLowerCase())||"";break;case"period":o=e.periodStart?new Date(e.periodStart).getTime():0,d=t.periodStart?new Date(t.periodStart).getTime():0;break;case"recipient":o=(null===(s=e.recipient)||void 0===s?void 0:s.toLowerCase())||"",d=(null===(l=t.recipient)||void 0===l?void 0:l.toLowerCase())||"";break;case"totalHours":o=Number(e.totalHours)||0,d=Number(t.totalHours)||0;break;case"status":o=(null===(n=e.status)||void 0===n?void 0:n.toLowerCase())||"",d=(null===(i=t.status)||void 0===i?void 0:i.toLowerCase())||"";break;default:return 0}let c=0;if("number"===typeof o&&"number"===typeof d)c=o-d;else{const e="string"===typeof o?o:String(o),t="string"===typeof d?d:String(d);c=e.localeCompare(t)}return"asc"===Q.direction?c:-c}))}return h}),[m,Q]),[ie,oe]=(0,r.useState)(!1),[de,ce]=(0,r.useState)(null),[me,xe]=(0,r.useState)(""),[ue,ye]=(0,r.useState)([]),[ge,pe]=(0,r.useState)(!1);(0,r.useEffect)((()=>{he(),be()}),[]),(0,r.useEffect)((()=>{const e=()=>{c(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,r.useEffect)((()=>(ie?l():n(),()=>{n()})),[ie,l,n]),(0,r.useEffect)((()=>{let e=null;return t&&m.length>0&&N.current&&(N.current.scrollIntoView({behavior:"smooth",block:"center"}),N.current.style.backgroundColor="#dbeafe",e=setTimeout((()=>{N.current&&(N.current.style.backgroundColor="")}),2e3)),()=>{e&&clearTimeout(e)}}),[t,m]);const he=async()=>{try{g(!0);const e=await d.A.get(o.Sn.MONTHLY_CONSULTATION_REPORTS.BASE);u(e.data)}catch(e){console.error("Fehler beim Laden der Monatsberichte:",e),Y.oR.error(a("analytics.monthlyReports.loadError"))}finally{g(!1)}},be=async()=>{try{const e=await d.A.get(o.Sn.MONTHLY_CONSULTATION_REPORTS.CHECK_UNBILLED);v(e.data)}catch(e){console.error("Fehler beim Pr\xfcfen der nicht-abgerechneten Beratungen:",e)}},ve=async e=>{try{const t=await d.A.get(o.Sn.MONTHLY_CONSULTATION_REPORTS.PDF(e.id),{responseType:"blob"}),a=new Blob([t.data],{type:"application/pdf"}),r=window.URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="".concat(e.reportNumber,".pdf"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}catch(t){Y.oR.error(a("analytics.monthlyReports.downloadError"))}},Ne=e=>{F((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},je=async(e,t,a)=>{ce(e),xe(t),oe(!0),await fe(e,a)},ke=()=>{oe(!1),ce(null),xe(""),ye([])},fe=async(e,t)=>{try{pe(!0);const a=m.find((e=>e.id===t));if(!a)return;const r=await d.A.get("".concat(o.Sn.CONSULTATIONS.BASE,"?clientId=").concat(e,"&from=").concat(a.periodStart,"&to=").concat(a.periodEnd));ye(r.data)}catch(r){console.error("Fehler beim Laden der Client-Beratungen:",r),Y.oR.error(a("analytics.monthlyReports.consultationsLoadError"))}finally{pe(!1)}},we=e=>{switch(e){case"GENERATED":return(0,x.jsx)(M.A,{className:"h-5 w-5 text-blue-500"});case"SENT":return(0,x.jsx)(ee.A,{className:"h-5 w-5 text-green-500"});case"ARCHIVED":return(0,x.jsx)(te.A,{className:"h-5 w-5 text-gray-500"});default:return(0,x.jsx)(M.A,{className:"h-5 w-5 text-gray-500"})}},Ce=e=>{switch(e){case"GENERATED":return a("analytics.monthlyReports.status.generated");case"SENT":return a("analytics.monthlyReports.status.sent");case"ARCHIVED":return a("analytics.monthlyReports.status.archived");default:return e}};return y?(0,x.jsx)("div",{className:"p-6",children:(0,x.jsxs)("div",{className:"animate-pulse",children:[(0,x.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),(0,x.jsx)("div",{className:"space-y-3",children:[...Array(3)].map(((e,t)=>(0,x.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t)))})]})}):(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"flex items-center justify-between mb-6 px-3 sm:px-4 md:px-6 -mx-3 sm:-mx-4 md:-mx-6",children:(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a("analytics.monthlyReports.title")})}),(null===b||void 0===b?void 0:b.hasUnbilledConsultations)&&(0,x.jsx)("div",{className:"mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)(ae.A,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-3"}),(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsx)("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:a("analytics.monthlyReports.unbilledWarning.title")}),(0,x.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:a("analytics.monthlyReports.unbilledWarning.message",{count:b.count})}),(0,x.jsxs)("button",{onClick:async()=>{re.v.log("DEBUG: handleGenerateReport called");try{const e=await d.A.post(o.Sn.MONTHLY_CONSULTATION_REPORTS.GENERATE_AUTOMATIC);re.v.log("DEBUG: API response:",e),await he(),Y.oR.success(a("analytics.monthlyReports.generateSuccess"))}catch(l){var e,t,r,s;console.error("DEBUG: Error generating report:",l),re.v.log("DEBUG: Error details:",{status:null===(e=l.response)||void 0===e?void 0:e.status,data:null===(t=l.response)||void 0===t?void 0:t.data,message:l.message}),Y.oR.error((null===(r=l.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||a("analytics.monthlyReports.generateError"))}},disabled:p,className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-yellow-800 dark:text-yellow-200 bg-yellow-100 dark:bg-yellow-800 hover:bg-yellow-200 dark:hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 disabled:opacity-50",children:[(0,x.jsx)(A.A,{className:"h-4 w-4 mr-2"}),a(p?"analytics.monthlyReports.unbilledWarning.creating":"analytics.monthlyReports.unbilledWarning.createButton")]})]})]})}),"table"===W?(0,x.jsx)("div",{className:"dashboard-monthly-reports-wrapper bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden -mx-3 sm:-mx-4 md:-mx-6",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left w-12"}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.reportNumber")}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.period")}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.recipient")}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.totalHours")}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.status")}),(0,x.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.actions")})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:m.map((e=>{var s;return(0,x.jsxs)(r.Fragment,{children:[(0,x.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",ref:t===e.id?N:null,children:[(0,x.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>Ne(e.id),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,x.jsx)(j.A,{className:"h-4 w-4 transition-transform ".concat(w.has(e.id)?"rotate-180":"")})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:w.has(e.id)?a("common.collapse"):a("common.expand")})]})}),(0,x.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:[(0,x.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.reportNumber}),(0,x.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,L.GP)(new Date(e.generatedAt),"dd.MM.yyyy HH:mm",{locale:T.de})})]}),(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:[(0,L.GP)(new Date(e.periodStart),"dd.MM.yyyy",{locale:T.de})," - "," ",(0,L.GP)(new Date(e.periodEnd),"dd.MM.yyyy",{locale:T.de})]}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.recipient}),(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:[Number(e.totalHours).toFixed(2)," h"]}),(0,x.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,x.jsxs)("div",{className:"flex items-center",children:[we(e.status),(0,x.jsx)("span",{className:"ml-2 text-sm text-gray-900 dark:text-white",children:Ce(e.status)})]})}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,x.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>ve(e),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,x.jsx)(f.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("analytics.monthlyReports.downloadTitle")})]})})})]}),w.has(e.id)&&(0,x.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-900",children:(0,x.jsx)("td",{colSpan:7,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,x.jsx)("div",{className:"space-y-4",children:(0,x.jsxs)("div",{children:[(0,x.jsx)("h5",{className:"text-md font-medium text-gray-900 dark:text-white mb-4",children:a("analytics.monthlyReports.billingPositions",{count:(null===(s=e.items)||void 0===s?void 0:s.length)||0})}),e.items&&e.items.length>0?(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.client")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.consultationCount")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.columns.totalHours")}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:a("analytics.monthlyReports.actions")})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.items.map((t=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.clientName}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.consultationCount}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200 font-semibold",children:[Number(t.totalHours).toFixed(2)," h"]}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>je(t.clientId,t.clientName,e.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,x.jsx)(k.A,{className:"h-4 w-4"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("analytics.monthlyReports.editConsultationsTitle")})]})})]},t.id)))})]})}):(0,x.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:a("analytics.monthlyReports.noPositions")})]})})})})]},e.id)}))})]})}):(0,x.jsx)("div",{className:"dashboard-monthly-reports-wrapper -mx-3 sm:-mx-4 md:-mx-6",children:0===ne.length?(0,x.jsx)("div",{className:"text-center py-8 text-sm text-gray-500 dark:text-gray-400",children:a("analytics.monthlyReports.noReports")}):(0,x.jsx)(Z.A,{gap:"md",children:ne.map((e=>{var t;const r=w.has(e.id),s=[];X.has("reportNumber")&&s.push({label:a("analytics.monthlyReports.metadata.reportNumber"),value:e.reportNumber,icon:(0,x.jsx)(f.A,{className:"h-4 w-4"})}),X.has("period")&&s.push({label:a("analytics.monthlyReports.metadata.period"),value:"".concat((0,L.GP)(new Date(e.periodStart),"dd.MM.yyyy",{locale:T.de})," - ").concat((0,L.GP)(new Date(e.periodEnd),"dd.MM.yyyy",{locale:T.de})),icon:(0,x.jsx)(S.A,{className:"h-4 w-4"})}),X.has("recipient")&&s.push({label:a("analytics.monthlyReports.metadata.recipient"),value:e.recipient,icon:(0,x.jsx)(C.A,{className:"h-4 w-4"})}),X.has("totalHours")&&s.push({label:a("analytics.monthlyReports.metadata.totalHours"),value:"".concat(Number(e.totalHours).toFixed(2)," h"),icon:(0,x.jsx)(M.A,{className:"h-4 w-4"})});const l={GENERATED:{label:a("analytics.monthlyReports.status.generated"),color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},SENT:{label:a("analytics.monthlyReports.status.sent"),color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},ARCHIVED:{label:a("analytics.monthlyReports.status.archived"),color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}[e.status],n=(0,x.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>ve(e),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,x.jsx)(f.A,{className:"h-5 w-5"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"PDF herunterladen"})]})}),i=(0,x.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,x.jsxs)("h5",{className:"text-md font-medium text-gray-900 dark:text-white mb-4",children:["Abrechnungspositionen (",(null===(t=e.items)||void 0===t?void 0:t.length)||0,")"]}),e.items&&e.items.length>0?(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,x.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anzahl Beratungen"}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Stunden"}),(0,x.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Aktionen"})]})}),(0,x.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.items.map((t=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.clientName}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:t.consultationCount}),(0,x.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200 font-semibold",children:[Number(t.totalHours).toFixed(2)," h"]}),(0,x.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-200",children:(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{onClick:()=>je(t.clientId,t.clientName,e.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,x.jsx)(k.A,{className:"h-4 w-4"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("analytics.monthlyReports.editConsultationsTitle")})]})})]},t.id)))})]})}):(0,x.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:"Keine Abrechnungspositionen vorhanden"})]});return(0,x.jsx)(K.A,{title:e.reportNumber,subtitle:(0,L.GP)(new Date(e.generatedAt),"dd.MM.yyyy HH:mm",{locale:T.de}),status:{label:l.label,color:l.color},metadata:s,actions:n,expandable:{isExpanded:r,content:i,onToggle:()=>Ne(e.id)}},e.id)}))})}),ie&&de&&(0,x.jsx)("div",{className:"fixed inset-0 overflow-hidden z-50","aria-labelledby":"slide-over-title",role:"dialog","aria-modal":"true",children:(0,x.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[!i&&(0,x.jsx)("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity sidepane-overlay sidepane-backdrop",onClick:ke}),(0,x.jsx)("div",{className:"fixed top-16 bottom-0 right-0 pl-10 max-w-full flex sidepane-panel sidepane-panel-container",style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)"},children:(0,x.jsx)("div",{className:"w-screen max-w-3xl",children:(0,x.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-800 shadow-xl overflow-y-scroll",children:[(0,x.jsx)("div",{className:"px-4 py-6 bg-gray-50 dark:bg-gray-700 sm:px-6",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",id:"slide-over-title",children:a("analytics.monthlyReports.editConsultations",{clientName:me})}),(0,x.jsx)("div",{className:"ml-3 h-7 flex items-center",children:(0,x.jsxs)("button",{type:"button",className:"bg-gray-50 dark:bg-gray-700 rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:ke,children:[(0,x.jsx)("span",{className:"sr-only",children:a("analytics.monthlyReports.closePanel")}),(0,x.jsx)(D.A,{className:"h-6 w-6","aria-hidden":"true"})]})})]})}),(0,x.jsx)("div",{className:"flex-1 px-4 py-6 sm:px-6",children:(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:(0,x.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:(0,x.jsx)("span",{dangerouslySetInnerHTML:{__html:a("analytics.monthlyReports.info",{clientName:me})}})})}),(0,x.jsxs)("div",{className:"flex justify-between items-center",children:[(0,x.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:a("analytics.monthlyReports.consultationsCount",{count:ue.length})}),(0,x.jsxs)("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,x.jsx)(A.A,{className:"h-4 w-4 mr-2"}),a("analytics.monthlyReports.addConsultation")]})]}),ge?(0,x.jsxs)("div",{className:"text-center py-4",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,x.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:a("analytics.monthlyReports.loadingConsultations")})]}):ue.length>0?(0,x.jsx)("div",{className:"space-y-3",children:ue.map((e=>(0,x.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:a("analytics.monthlyReports.startTime")}),(0,x.jsx)("input",{type:"datetime-local",value:e.startTime?new Date(e.startTime).toISOString().slice(0,16):"",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:a("analytics.monthlyReports.endTime")}),(0,x.jsx)("input",{type:"datetime-local",value:e.endTime?new Date(e.endTime).toISOString().slice(0,16):"",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:a("analytics.monthlyReports.notes")}),(0,x.jsx)("input",{type:"text",value:e.notes||"",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:a("consultations.notesPlaceholder")})]})]}),(0,x.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[a("consultations.duration"),": ",e.endTime?(0,V.P0)(e.startTime,e.endTime):a("worktime.running")]})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{type:"button",className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,x.jsx)(R.A,{className:"h-4 w-4"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.save")})]}),(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{type:"button",className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,x.jsx)(E.A,{className:"h-4 w-4"})}),(0,x.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.delete")})]})]})]})},e.id)))}):(0,x.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[(0,x.jsx)(M.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),(0,x.jsx)("p",{children:a("consultations.noConsultationsFound")})]})]})}),(0,x.jsx)("div",{className:"flex-shrink-0 px-4 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:(0,x.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,x.jsx)("button",{type:"button",className:"bg-white dark:bg-gray-600 py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:ke,children:a("common.close")}),(0,x.jsx)("button",{type:"button",className:"bg-blue-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:a("settings.saveAllChanges")})]})})]})})})]})})]})};var ie=a(2704),oe=a(1369),de=a(4294);const ce=()=>{var e;const{t:t}=(0,s.Bd)(),{canView:a}=(0,n.S)(),i=(0,l.zy)(),[o,d]=(0,r.useState)("invoices"),[c,m]=(0,r.useState)(null),[u,y]=(0,r.useState)(null);(0,r.useEffect)((()=>{const e=new URLSearchParams(i.search),t=e.get("tab"),a=e.get("invoiceId"),r=e.get("reportId");if(t&&["invoices","monthly-reports","payroll"].includes(t)&&d(t),a){const e=parseInt(a,10);isNaN(e)||m(e)}if(r){const e=parseInt(r,10);isNaN(e)||y(e)}}),[i.search]);const p=[{id:"invoices",entity:"consultation_invoices",name:t("payroll.tabs.invoices"),icon:ie.A,component:(0,x.jsx)(X,{})},{id:"monthly-reports",entity:"monthly_reports",name:t("payroll.tabs.monthlyReports"),icon:oe.A,component:(0,x.jsx)(ne,{})},{id:"payroll",entity:"payroll_reports",name:t("payroll.tabs.payroll"),icon:de.A,component:(0,x.jsx)(g,{})}].filter((e=>a(e.entity,"tab")));return(0,r.useEffect)((()=>{p.length>0&&!p.find((e=>e.id===o))&&d(p[0].id)}),[p,o]),(0,x.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,x.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,x.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,x.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,x.jsx)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:p.map((e=>{const t=e.icon;return(0,x.jsxs)("button",{onClick:()=>d(e.id),className:"group inline-flex items-center pb-2 sm:pb-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat(o===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"),children:[(0,x.jsx)(t,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e.name]},e.id)}))})}),(0,x.jsx)("div",{className:"mt-6",children:null===(e=p.find((e=>e.id===o)))||void 0===e?void 0:e.component})]})})})}},6400:(e,t,a)=>{a.d(t,{Ac:()=>x,J1:()=>m,W5:()=>c});var r=a(1620),s=a(8605),l=a(4912),n=a(3695),i=a(8621),o=a(7744);const d=(e,t)=>{const{operator:a,value:r}=t;if(void 0===r)return console.error("evaluateCondition: value ist undefined",t),!1;if(null==e&&null==r)return"equals"===a;if(null==e||null==r)return"notEquals"===a;let s="",l="";try{const t=null==e?"":"string"===typeof e?e:String(e);if("string"!==typeof t)return!1;const a=t.toLowerCase();if(void 0===a||null===a||"string"!==typeof a)return!1;s=a;const n=null==r?"":"string"===typeof r?r:String(r);if("string"!==typeof n)return!1;const i=n.toLowerCase();if(void 0===i||null===i||"string"!==typeof i)return!1;l=i}catch(n){return!1}if("string"!==typeof s||"string"!==typeof l||void 0===s||void 0===l||null===s||null===l)return!1;switch(a){case"equals":return s===l;case"notEquals":return s!==l;case"contains":return s.includes(l);case"startsWith":return s.startsWith(l);case"endsWith":if(void 0===s||null===s)return console.error("endsWith: strField ist undefined/null",{strField:s,strValue:l,fieldValue:e,value:r,condition:t}),!1;if(void 0===l||null===l)return console.error("endsWith: strValue ist undefined/null",{strField:s,strValue:l,fieldValue:e,value:r,condition:t}),!1;if("string"!==typeof s)return console.error("endsWith: strField ist kein String",{strField:s,typeof:typeof s,strValue:l,fieldValue:e,value:r,condition:t}),!1;if("string"!==typeof l)return console.error("endsWith: strValue ist kein String",{strField:s,strValue:l,typeof:typeof l,fieldValue:e,value:r,condition:t}),!1;try{return s.endsWith(l)}catch(n){return console.error("endsWith: Fehler bei endsWith-Aufruf",n,{strField:s,strValue:l,fieldValue:e,value:r,condition:t}),!1}case"before":case"after":{const t=new Date(e),s=new Date(r);return!isNaN(t.getTime())&&!isNaN(s.getTime())&&("before"===a?t<s:t>s)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),s=parseFloat(String(r));return!isNaN(t)&&!isNaN(s)&&("greaterThan"===a?t>s:t<s)}default:return!0}},c=(e,t,a,r,s)=>0===t.length?e:e.filter((e=>{let l=!0;for(let n=0;n<t.length;n++){const i=t[n];let o=!1;if(s&&s[i.column]){const t=s[i.column](e,i);if(null!==t)o=t;else{const t=r(e,i.column);o=d(t,i)}}else{const t=r(e,i.column);o=d(t,i)}if(0===n)l=o;else{l="AND"===(a[n-1]||"AND")?l&&o:l||o}}return l})),m=(e,t)=>{if(!e)return!1;const a=new Date(e);if(isNaN(a.getTime()))return!1;const d=a.getUTCFullYear(),c=a.getUTCMonth(),m=a.getUTCDate(),x=new Date(d,c,m);try{if("__THIS_WEEK__"===t.value){if("equals"===t.operator){const e=(0,r.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const t=(0,s.$)(new Date,{weekStartsOn:1});return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,r.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const a=(0,s.$)(new Date,{weekStartsOn:1});return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}if("__THIS_MONTH__"===t.value){if("equals"===t.operator){const e=(0,l.w)(new Date);e.setHours(0,0,0,0);const t=(0,n.p)(new Date);return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,l.w)(new Date);e.setHours(0,0,0,0);const a=(0,n.p)(new Date);return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}if("__THIS_YEAR__"===t.value){if("equals"===t.operator){const e=(0,i.D)(new Date);e.setHours(0,0,0,0);const t=(0,o.Q)(new Date);return t.setHours(23,59,59,999),x>=e&&x<=t}const e=(0,i.D)(new Date);e.setHours(0,0,0,0);const a=(0,o.Q)(new Date);return a.setHours(23,59,59,999),"before"===t.operator?x<a:"after"===t.operator&&x>e}let e;if("__TODAY__"===t.value){const t=new Date;t.setHours(0,0,0,0),e=t}else if("__WEEK_START__"===t.value){const t=(0,r.k)(new Date,{weekStartsOn:1});t.setHours(0,0,0,0),e=t}else if("__WEEK_END__"===t.value){const t=(0,s.$)(new Date,{weekStartsOn:1});t.setHours(23,59,59,999),e=t}else if("__MONTH_START__"===t.value){const t=(0,l.w)(new Date);t.setHours(0,0,0,0),e=t}else if("__MONTH_END__"===t.value){const t=(0,n.p)(new Date);t.setHours(23,59,59,999),e=t}else if("__YEAR_START__"===t.value){const t=(0,i.D)(new Date);t.setHours(0,0,0,0),e=t}else if("__YEAR_END__"===t.value){const t=(0,o.Q)(new Date);t.setHours(23,59,59,999),e=t}else{const a=new Date(t.value);if(isNaN(a.getTime()))return!1;const r=a.getUTCFullYear(),s=a.getUTCMonth(),l=a.getUTCDate();e=new Date(r,s,l)}switch(t.operator){case"equals":return x.getTime()===e.getTime();case"before":return x<e;case"after":return x>e;default:return!0}}catch(u){return console.error("[evaluateDateCondition] Error with placeholder ".concat(t.value,":"),u),!1}},x=(e,t,a,r)=>{const s=a.value||"";if(s.startsWith("user-")){const t=parseInt(s.replace("user-",""),10);if(isNaN(t))return!1;const r=e===t;return"notEquals"===a.operator?!r:r}if(s.startsWith("role-")){const e=parseInt(s.replace("role-",""),10);if(isNaN(e))return!1;const r=t===e;return"notEquals"===a.operator?!r:r}if(""===s)return!0;if(void 0!==r){const e=r.toLowerCase(),t=s.toLowerCase();if("equals"===a.operator)return e===t;if("notEquals"===a.operator)return e!==t;if("contains"===a.operator)return e.includes(t)}return!1}}}]);
//# sourceMappingURL=481.f6504682.chunk.js.map