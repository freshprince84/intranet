"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[692],{4426:(e,r,t)=>{t.d(r,{A:()=>x});var a=t(5043),l=t(4117),o=t(6582),s=t(7591),n=t(1816),i=t(9422),d=t(9379),c=t(9248),u=t(9938),g=t(1923),h=t(579);const m=e=>{let{condition:r,onChange:t,onDelete:o,onAdd:s,columns:n,isFirst:i,isLast:m}=e;const{t:p}=(0,l.Bd)(),[b,f]=(0,a.useState)([]),[x,y]=(0,a.useState)([]),[v,k]=(0,a.useState)([]),[w,j]=(0,a.useState)(!1),[A,S]=(0,a.useState)(!1);(0,a.useEffect)((()=>{f(((e,r)=>{const t=[{value:"equals",label:r("filter.operators.equals")},{value:"contains",label:r("filter.operators.contains")},{value:"startsWith",label:r("filter.operators.startsWith")},{value:"endsWith",label:r("filter.operators.endsWith")}],a=[{value:"equals",label:r("filter.operators.isExactly")},{value:"after",label:r("filter.operators.after")},{value:"before",label:r("filter.operators.before")},{value:"between",label:r("filter.operators.between")}],l=[{value:"equals",label:r("filter.operators.isEqual")},{value:"greater_than",label:r("filter.operators.greaterThan")},{value:"less_than",label:r("filter.operators.lessThan")}],o=[{value:"equals",label:r("filter.operators.equals")},{value:"notEquals",label:r("filter.operators.notEquals")}];return"dueDate"===e||"startTime"===e?a:"duration"===e?l:"status"===e||"responsible"===e||"qualityControl"===e||"responsibleAndQualityControl"===e?o:t})(r.column,p))}),[r.column,p]),(0,a.useEffect)((()=>{(async()=>{if(localStorage.getItem("token")&&("responsible"===r.column||"qualityControl"===r.column||"responsibleAndQualityControl"===r.column)){j(!0);try{const e=await g.A.get("/users/dropdown");y(e.data)}catch(e){console.error("Fehler beim Laden der Benutzer:",e)}finally{j(!1)}if("responsible"===r.column||"responsibleAndQualityControl"===r.column){S(!0);try{const e=await g.A.get("/roles");k(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e)}finally{S(!1)}}}})()}),[r.column]);return(0,h.jsxs)("div",{className:"flex items-center space-x-2 mb-0",children:[(0,h.jsx)("div",{className:"w-1/3",children:(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-full",value:r.column,onChange:e=>{var a;return t((0,d.A)((0,d.A)({},r),{},{column:e.target.value,operator:(null===(a=b[0])||void 0===a?void 0:a.value)||"equals",value:null}))},children:[(0,h.jsx)("option",{value:"",children:p("filter.row.selectColumn")}),n.map((e=>(0,h.jsx)("option",{value:e.id,children:e.label},e.id)))]})}),(0,h.jsx)("div",{className:"w-1/4",children:(0,h.jsx)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-full",value:r.operator,onChange:e=>t((0,d.A)((0,d.A)({},r),{},{operator:e.target.value})),children:b.map((e=>(0,h.jsx)("option",{value:e.value,children:e.label},e.value)))})}),(0,h.jsx)("div",{className:"w-1/3",children:((e,r,t,a)=>{if("status"===e){const e=n.some((e=>"requestedBy"===e.id||"createTodo"===e.id)),r=n.some((e=>"responsible"===e.id||"qualityControl"===e.id)),l=n.some((e=>"client"===e.id))&&!n.some((e=>"responsible"===e.id));return e?(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),(0,h.jsx)("option",{value:"approval",children:p("filter.row.status.approval")}),(0,h.jsx)("option",{value:"approved",children:p("filter.row.status.approved")}),(0,h.jsx)("option",{value:"to_improve",children:p("filter.row.status.to_improve")}),(0,h.jsx)("option",{value:"denied",children:p("filter.row.status.denied")})]}):r?(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),(0,h.jsx)("option",{value:"open",children:p("filter.row.status.open")}),(0,h.jsx)("option",{value:"in_progress",children:p("filter.row.status.in_progress")}),(0,h.jsx)("option",{value:"improval",children:p("filter.row.status.improval")}),(0,h.jsx)("option",{value:"quality_control",children:p("filter.row.status.quality_control")}),(0,h.jsx)("option",{value:"done",children:p("filter.row.status.done")})]}):l?(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),(0,h.jsx)("option",{value:"DRAFT",children:p("filter.row.status.draft")}),(0,h.jsx)("option",{value:"SENT",children:p("filter.row.status.sent")}),(0,h.jsx)("option",{value:"PAID",children:p("filter.row.status.paid")}),(0,h.jsx)("option",{value:"OVERDUE",children:p("filter.row.status.overdue")}),(0,h.jsx)("option",{value:"CANCELLED",children:p("filter.row.status.cancelled")})]}):(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),(0,h.jsx)("option",{value:"open",children:p("filter.row.status.open")}),(0,h.jsx)("option",{value:"in_progress",children:p("filter.row.status.in_progress")}),(0,h.jsx)("option",{value:"done",children:p("filter.row.status.done")})]})}if("responsible"===e||"responsibleAndQualityControl"===e)return(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),disabled:w||A,children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),x.length>0&&(0,h.jsx)("optgroup",{label:p("filter.row.groups.users"),children:x.map((e=>(0,h.jsxs)("option",{value:"user-".concat(e.id),children:[e.firstName," ",e.lastName]},"user-".concat(e.id))))}),v.length>0&&(0,h.jsx)("optgroup",{label:p("filter.row.groups.roles"),children:v.map((e=>(0,h.jsx)("option",{value:"role-".concat(e.id),children:e.name},"role-".concat(e.id))))}),(w||A)&&(0,h.jsx)("option",{value:"",disabled:!0,children:p("filter.row.loadingData")})]});if("qualityControl"===e)return(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value),disabled:w,children:[(0,h.jsx)("option",{value:"",children:p("filter.row.pleaseSelect")}),x.length>0&&(0,h.jsx)("optgroup",{label:p("filter.row.groups.users"),children:x.map((e=>(0,h.jsxs)("option",{value:"user-".concat(e.id),children:[e.firstName," ",e.lastName]},"user-".concat(e.id))))}),w&&(0,h.jsx)("option",{value:"",disabled:!0,children:p("filter.row.loadingUsers")})]});if("dueDate"===e||"startTime"===e){const e="__TODAY__"===t;return(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsxs)("select",{className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-full",value:e?"variable":"date",onChange:e=>{"variable"===e.target.value?a("__TODAY__"):a("")},children:[(0,h.jsx)("option",{value:"date",children:p("filter.row.selectDate")}),(0,h.jsx)("option",{value:"variable",children:p("filter.row.currentDay")})]}),!e&&(0,h.jsx)("input",{type:"date",className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-xs w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:t||"",onChange:e=>a(e.target.value)}),e&&(0,h.jsxs)("div",{className:"px-2 py-1 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md text-blue-700 dark:text-blue-300 text-xs",children:["\ud83d\udcc5 ",p("filter.row.dynamicDay")]})]})}return(0,h.jsx)("input",{type:"text",className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-full",value:t||"",onChange:e=>a(e.target.value),placeholder:p("filter.row.enterValue")})})(r.column,r.operator,r.value,(e=>t((0,d.A)((0,d.A)({},r),{},{value:e}))))}),(0,h.jsxs)("div",{className:"flex gap-1",children:[(0,h.jsx)("button",{type:"button",onClick:o,className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-500 rounded-md transition-colors",disabled:i&&!m,title:p("filter.row.removeCondition"),children:(0,h.jsx)(c.A,{className:"h-4 w-4"})}),m&&(0,h.jsx)("button",{type:"button",onClick:s,className:"p-1 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 rounded-md transition-colors",title:p("filter.row.addCondition"),children:(0,h.jsx)(u.A,{className:"h-4 w-4"})})]})]})},p=e=>{let{operator:r,onChange:t}=e;return(0,h.jsx)("div",{className:"flex items-center justify-center -my-1",children:(0,h.jsxs)("select",{className:"px-1.5 py-0.5 border border-gray-300 dark:border-gray-600 rounded-md text-xs font-medium bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-[60px]",value:r,onChange:e=>t(e.target.value),children:[(0,h.jsx)("option",{value:"AND",children:"UND"}),(0,h.jsx)("option",{value:"OR",children:"ODER"})]})})};var b=t(1801),f=t(7488);const x=e=>{let{columns:r,onApply:t,onReset:d,savedConditions:c,savedOperators:u,tableId:x}=e;const{t:y}=(0,l.Bd)(),[v,k]=(0,a.useState)(c&&c.length>0?c:[{column:"",operator:"equals",value:null}]),[w,j]=(0,a.useState)(u&&u.length>0?u:[]),[A,S]=(0,a.useState)(!1),[N,E]=(0,a.useState)(""),[F,C]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return;const e=await g.A.get(b.Sn.SAVED_FILTERS.BY_TABLE(x));C(e.data.map((e=>({id:e.id,name:e.name}))))}catch(e){console.error(y("filter.loadError"),e)}})()}),[x]),(0,a.useEffect)((()=>{c&&c.length>0&&k(c),u&&u.length>0&&j(u)}),[c,u]);const R=()=>{k([...v,{column:"",operator:"equals",value:null}]),v.length>0&&j([...w,"AND"])};return(0,h.jsxs)("div",{className:"mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg",children:[(0,h.jsx)("h3",{className:"text-base font-medium text-gray-700 dark:text-gray-200 mb-3",children:y("filter.title")}),(0,h.jsx)("div",{className:"space-y-0",children:v.map(((e,t)=>(0,h.jsxs)(a.Fragment,{children:[(0,h.jsx)(m,{condition:e,onChange:e=>((e,r)=>{const t=[...v];t[e]=r,k(t)})(t,e),onDelete:()=>(e=>{const r=[...v];if(r.splice(e,1),k(r),e>0){const r=[...w];r.splice(e-1,1),j(r)}})(t),onAdd:R,columns:r,isFirst:0===t,isLast:t===v.length-1}),t<v.length-1&&(0,h.jsx)(p,{operator:w[t]||"AND",onChange:e=>((e,r)=>{const t=[...w];t[e]=r,j(t)})(t,e)})]},t)))}),A?(0,h.jsxs)("div",{className:"mt-4 flex gap-2 items-center",children:[(0,h.jsx)("input",{type:"text",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white flex-grow",placeholder:y("filter.filterName"),value:N,onChange:e=>E(e.target.value)}),(0,h.jsx)("button",{onClick:async()=>{if(!N.trim())return void f.oR.error(y("filter.noName"));if("Archiv"===N||"Aktuell"===N)return void f.oR.error(y("filter.reservedNames"));if(F.some((e=>("Archiv"===e.name||"Aktuell"===e.name)&&e.name===N)))return void f.oR.error(y("filter.cannotOverwriteStandard"));const e=v.filter((e=>""!==e.column));if(0!==e.length)try{if(!localStorage.getItem("token"))return void f.oR.error(y("filter.notAuthenticated"));await g.A.post(b.Sn.SAVED_FILTERS.BASE,{tableId:x,name:N,conditions:e,operators:w});f.oR.success(y("filter.saveSuccess")),S(!1),E("")}catch(r){console.error("Fehler beim Speichern des Filters:",r),f.oR.error(y("filter.saveError"))}else f.oR.error(y("filter.noConditions"))},className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:y("filter.saveFilter"),children:(0,h.jsx)(o.A,{className:"h-5 w-5"})}),(0,h.jsx)("button",{onClick:()=>S(!1),className:"p-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700 transition-colors",title:y("filter.cancel"),children:(0,h.jsx)(s.A,{className:"h-5 w-5"})})]}):(0,h.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,h.jsx)("button",{onClick:()=>{k([{column:"",operator:"equals",value:null}]),j([]),d()},className:"p-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700 transition-colors",title:y("filter.reset"),children:(0,h.jsx)(n.A,{className:"h-5 w-5"})}),(0,h.jsx)("button",{onClick:()=>S(!0),className:"p-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700 transition-colors",title:y("filter.save"),children:(0,h.jsx)(o.A,{className:"h-5 w-5"})}),(0,h.jsx)("button",{onClick:()=>{const e=v.filter((e=>""!==e.column));t(e,w)},className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:y("filter.apply"),children:(0,h.jsx)(i.A,{className:"h-5 w-5"})})]})]})}},7829:(e,r,t)=>{t.d(r,{A:()=>m});var a=t(5043),l=t(4117),o=t(2517),s=t(9422),n=t(7591),i=t(2811),d=t(9248),c=t(1923),u=t(1801),g=t(7488),h=t(579);const m=e=>{let{tableId:r,onSelectFilter:t,onReset:m,activeFilterName:p,selectedFilterId:b,onFilterChange:f,defaultFilterName:x="Heute"}=e;const{t:y}=(0,l.Bd)(),v=e=>"Archiv"===e||"tasks.filters.archive"===e||"requests.filters.archiv"===e?y("worktracker-todos"===r?"tasks.filters.archive":"requests.filters.archiv"):"Aktuell"===e||"tasks.filters.current"===e||"requests.filters.aktuell"===e?y("worktracker-todos"===r?"tasks.filters.current":"requests.filters.aktuell"):"Heute"===e?y("common.today","Heute"):"Woche"===e?y("common.week","Woche"):"Aktive"===e?y("common.active","Aktive"):"Alle"===e?y("common.all","Alle"):e,[k,w]=(0,a.useState)([]),[j,A]=(0,a.useState)([]),[S,N]=(0,a.useState)(!0),[E,F]=(0,a.useState)(null),[C,R]=(0,a.useState)([]),D=(0,a.useRef)(null),[T,_]=(0,a.useState)(4),[L,I]=(0,a.useState)(0),P=(0,a.useRef)(null),[q,G]=(0,a.useState)(!1),[B,O]=(0,a.useState)(null),[V,U]=(0,a.useState)(null),[z,W]=(0,a.useState)(null),[M,Y]=(0,a.useState)(new Set),[H,Q]=(0,a.useState)(null),[K,J]=(0,a.useState)(""),X=(0,a.useCallback)((async()=>{try{const[e,t]=await Promise.all([c.A.get(u.Sn.SAVED_FILTERS.BY_TABLE(r)),c.A.get(u.Sn.SAVED_FILTERS.GROUPS.BY_TABLE(r))]),a=Array.isArray(e.data)?e.data.filter((e=>null!=e)):[],l=Array.isArray(t.data)?t.data.filter((e=>null!=e)):[];w(a),A(l)}catch(E){console.error("Fehler beim Neuladen der Filter:",E)}}),[r]),Z=(0,a.useCallback)((async e=>{try{const t=await c.A.get(u.Sn.SAVED_FILTERS.BY_TABLE(r)),a=t.data.filter((r=>e.includes(r.name)));if(a.length>5){const e=a.sort(((e,r)=>new Date(e.createdAt).getTime()-new Date(r.createdAt).getTime())).slice(0,a.length-5);for(const r of e)await c.A.delete(u.Sn.SAVED_FILTERS.BY_ID(r.id));await X()}}catch(E){console.error("Fehler beim Bereinigen der Client-Filter:",E)}}),[r,X]),$=(0,a.useCallback)((async()=>{if("consultations-table"===r)try{console.log("\ud83d\udd04 SavedFilterTags: Loading recent clients...");const e=(await c.A.get(u.Sn.CLIENTS.RECENT)).data.map((e=>e.name));console.log("\ud83d\udccb SavedFilterTags: Recent client names:",e),R(e),await Z(e)}catch(E){console.error("\u274c SavedFilterTags: Error loading recent clients:",E)}}),[r,Z]);(0,a.useEffect)((()=>{const e=()=>{console.log("\ud83d\udd14 SavedFilterTags: Received consultationChanged event"),$()};return window.addEventListener("consultationChanged",e),()=>{window.removeEventListener("consultationChanged",e)}}),[$]),(0,a.useEffect)((()=>{$()}),[$]),(0,a.useEffect)((()=>{(async()=>{try{N(!0);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");const[e,a]=await Promise.all([c.A.get(u.Sn.SAVED_FILTERS.BY_TABLE(r)),c.A.get(u.Sn.SAVED_FILTERS.GROUPS.BY_TABLE(r))]),l=Array.isArray(e.data)?e.data.filter((e=>null!=e)):[],o=Array.isArray(a.data)?a.data.filter((e=>null!=e)):[];if(w(l),A(o),!f&&x&&!p){const e=l.find((e=>null!=e&&e.name===x));e&&t(e.conditions,e.operators)}}catch(e){console.error("Fehler beim Laden der gespeicherten Filter:",e),F("Fehler beim Laden der gespeicherten Filter")}finally{N(!1)}})()}),[r]),(0,a.useEffect)((()=>(window.refreshSavedFilters=X,()=>{delete window.refreshSavedFilters})),[]),(0,a.useEffect)((()=>{const e=e=>{q&&!e.target.closest(".relative")&&G(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[q]);const ee=e=>{f?f(e.name,e.id,e.conditions,e.operators):t(e.conditions,e.operators)},re=async(e,r)=>{e.stopPropagation();const t=k.find((e=>e.id===r));if(t&&te(t.name))g.oR.error(y("filter.cannotDeleteStandard"));else try{if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");await c.A.delete(u.Sn.SAVED_FILTERS.BY_ID(r)),w(k.filter((e=>e.id!==r))),(b===r||!f&&r)&&(f?f("",null,[],[]):m()),g.oR.success("Filter erfolgreich gel\xf6scht")}catch(a){console.error("Fehler beim L\xf6schen des Filters:",a),g.oR.error("Fehler beim L\xf6schen des Filters")}},te=e=>{if(["Archiv","Aktuell","Aktive","Alle","Heute","Woche","tasks.filters.archive","tasks.filters.current","requests.filters.archiv","requests.filters.aktuell"].includes(e))return!0;if("consultations-table"===r){if("Archiv"===e||"Heute"===e||"Woche"===e)return!0;if(C.includes(e))return!0}return!1},ae=(0,a.useMemo)((()=>{const e=k.filter((e=>null!=e&&!e.groupId));if("consultations-table"===r){console.log("\ud83d\udd27 SavedFilterTags: Sorting filters..."),console.log("\ud83d\udccb SavedFilterTags: recentClientNames:",C),console.log("\ud83d\uddc2\ufe0f SavedFilterTags: savedFilters:",e.map((e=>e.name)));const r=e.find((e=>null!=e&&"Heute"===e.name)),t=e.find((e=>null!=e&&"Woche"===e.name)),a=e.find((e=>null!=e&&"Archiv"===e.name)),l=C.map((r=>e.find((e=>null!=e&&e.name===r)))).filter((e=>null!=e));console.log("\u2705 SavedFilterTags: sortedRecentClientFilters:",l.map((e=>e.name)));const o=e.filter((e=>null!=e&&!["Heute","Woche","Archiv"].includes(e.name)&&!C.includes(e.name)));console.log("\ud83d\udd27 SavedFilterTags: customFilters:",o.map((e=>e.name)));const s=[];return r&&s.push(r),t&&s.push(t),s.push(...l),s.push(...o),a&&s.push(a),console.log("\ud83c\udfaf SavedFilterTags: Final filter order:",s.map((e=>e.name))),s}if("requests-table"===r||"worktracker-todos"===r){const r=e.find((e=>null!=e&&"Aktuell"===e.name)),t=e.find((e=>null!=e&&"Archiv"===e.name)),a=e.filter((e=>null!=e&&"Aktuell"!==e.name&&"Archiv"!==e.name)),l=[];return r&&l.push(r),l.push(...a),t&&l.push(t),l}return e}),[k,C,r]),le=0===k.length&&S,oe=(0,a.useMemo)((()=>le?Array(3).fill(null).map(((e,t)=>({id:"placeholder-".concat(t),name:0===t?"Heute":1===t?"Woche":"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",isPlaceholder:!0,tableId:r,conditions:[],operators:[]}))):[]),[le,r]),se=le?oe:ae.filter((e=>null!=e)),ne=le?oe.length:T,ie=(0,a.useMemo)((()=>0===ae.length?75:ae.filter((e=>null!=e)).reduce(((e,r)=>{const t=te(r.name)?0:18;return e+(6.5*r.name.length+28+t)}),0)/ae.filter((e=>null!=e)).length),[ae]),de=(0,a.useCallback)((()=>{if(!D.current||0===ae.length)return;const e=D.current.clientWidth;if(Math.abs(e-L)<45)return;I(e);const r=e-14-15;if(Math.max(1,Math.floor(r/ie))>=ae.length)_(ae.length);else{const e=r-70,t=Math.max(1,Math.floor(e/ie));_(Math.min(t,ae.length-1))}}),[ae,ie,L,te]),ce=(0,a.useCallback)((()=>{P.current&&clearTimeout(P.current),P.current=setTimeout((()=>{de()}),100)}),[de]);(0,a.useEffect)((()=>{if(!D.current)return;const e=new ResizeObserver(ce);return e.observe(D.current),window.addEventListener("resize",ce),()=>{e.disconnect(),window.removeEventListener("resize",ce),P.current&&clearTimeout(P.current)}}),[ce]),(0,a.useLayoutEffect)((()=>{de()}),[de]);const ue=(0,a.useMemo)((()=>[...j].sort(((e,r)=>e.order-r.order))),[j]),ge=(e,r,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move","filter"===t?U(r):W(r)},he=()=>{O(null),U(null),W(null)},me=async(e,t,a)=>{if(e.preventDefault(),B)if("filter"!==a||B!==t)try{if("group"===a)await c.A.post(u.Sn.SAVED_FILTERS.GROUPS.ADD_FILTER(B,t)),g.oR.success("Filter zur Gruppe hinzugef\xfcgt");else{const e=k.find((e=>e.id===t));if(!e)return void he();if(e.groupId)await c.A.post(u.Sn.SAVED_FILTERS.GROUPS.ADD_FILTER(B,e.groupId)),g.oR.success("Filter zur Gruppe hinzugef\xfcgt");else{const t="Gruppe ".concat(j.length+1),a=(await c.A.post(u.Sn.SAVED_FILTERS.GROUPS.CREATE,{tableId:r,name:t})).data;await Promise.all([c.A.post(u.Sn.SAVED_FILTERS.GROUPS.ADD_FILTER(B,a.id)),c.A.post(u.Sn.SAVED_FILTERS.GROUPS.ADD_FILTER(e.id,a.id))]),g.oR.success("Gruppe erstellt")}}await X()}catch(l){console.error("Fehler beim Gruppieren der Filter:",l),g.oR.error("Fehler beim Gruppieren der Filter")}finally{he()}else he()},pe=e=>{Y((r=>{const t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t}))},be=()=>{Q(null),J("")},fe=async e=>{if(K.trim())try{await c.A.put(u.Sn.SAVED_FILTERS.GROUPS.UPDATE(e),{name:K.trim()}),g.oR.success("Gruppe umbenannt"),await X(),Q(null),J("")}catch(a){var r,t;console.error("Fehler beim Umbenennen der Gruppe:",a);const e=(null===(r=a.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.message)||"Fehler beim Umbenennen der Gruppe";g.oR.error(e)}else g.oR.error("Gruppenname darf nicht leer sein")},xe=()=>f?b:null;return S?(0,h.jsx)("div",{className:"flex justify-center items-center py-2",children:y("common.loadingFilters")}):E?(0,h.jsx)("div",{className:"text-red-500 py-2",children:E}):0===k.length&&0===j.length?null:(0,h.jsx)("div",{ref:D,className:"flex items-center gap-2 mb-3 mt-1",children:(0,h.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[ue.map((e=>{const r=e.filters.find((e=>xe()===e.id)),t=r?v(r.name):"".concat(e.name," (").concat(e.filters.length,")");return(0,h.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,h.jsxs)("button",{onClick:()=>pe(e.id),onDragOver:r=>ge(r,e.id,"group"),onDrop:r=>me(r,e.id,"group"),className:"flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border border-purple-300 dark:border-purple-700 hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors ".concat(z===e.id?"ring-2 ring-purple-500":""," ").concat(r?"ring-2 ring-purple-500":""),title:r?t:"".concat(e.name," (").concat(e.filters.length,")"),children:[(0,h.jsx)("span",{className:"truncate max-w-[100px]",children:t}),(0,h.jsx)(o.A,{className:"h-4 w-4 ml-1 transition-transform ".concat(M.has(e.id)?"rotate-180":"")})]}),M.has(e.id)&&(0,h.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50 min-w-[200px]",children:[e.filters.map((r=>(0,h.jsx)("div",{onClick:()=>{ee(r),pe(e.id)},className:"flex items-center justify-between px-3 py-2 text-sm cursor-pointer transition-colors ".concat(xe()===r.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"," ").concat(te(r.name)?"font-bold":""),title:v(r.name),children:(0,h.jsx)("span",{className:"truncate flex-1",children:v(r.name)})},r.id))),(0,h.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 mt-1 pt-1",children:H===e.id?(0,h.jsxs)("div",{className:"px-3 py-2",children:[(0,h.jsx)("input",{type:"text",value:K,onChange:e=>J(e.target.value),onKeyDown:r=>{"Enter"===r.key?fe(e.id):"Escape"===r.key&&be()},className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,h.jsxs)("div",{className:"flex gap-2 mt-2 justify-end",children:[(0,h.jsx)("button",{onClick:r=>{r.stopPropagation(),fe(e.id)},className:"p-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",title:"Speichern",children:(0,h.jsx)(s.A,{className:"h-4 w-4"})}),(0,h.jsx)("button",{onClick:e=>{e.stopPropagation(),be()},className:"p-2 rounded-md bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-400 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",title:"Abbrechen",children:(0,h.jsx)(n.A,{className:"h-4 w-4"})})]})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{onClick:r=>{r.stopPropagation(),(e=>{Q(e.id),J(e.name)})(e)},className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left transition-colors",title:"Gruppe umbenennen",children:(0,h.jsx)(i.A,{className:"h-4 w-4"})}),(0,h.jsx)("button",{onClick:r=>{r.stopPropagation(),(async e=>{try{await c.A.delete(u.Sn.SAVED_FILTERS.GROUPS.DELETE(e)),g.oR.success("Gruppe aufgel\xf6st"),await X(),Y((r=>{const t=new Set(r);return t.delete(e),t}))}catch(r){console.error("Fehler beim Aufl\xf6sen der Gruppe:",r),g.oR.error("Fehler beim Aufl\xf6sen der Gruppe")}})(e.id)},className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 w-full text-left transition-colors",title:y("filter.ungroup"),children:(0,h.jsx)(d.A,{className:"h-4 w-4"})})]})})]})]},e.id)})),se.slice(0,ne).map((e=>(0,h.jsxs)("div",{draggable:!0,onDragStart:r=>((e,r)=>{e.dataTransfer.effectAllowed="move",O(r)})(r,e.id),onDragOver:r=>ge(r,e.id,"filter"),onDrop:r=>me(r,e.id,"filter"),onDragEnd:he,onClick:()=>!e.isPlaceholder&&ee(e),className:"flex items-center px-3 py-1 rounded-full text-sm font-medium cursor-pointer transition-colors flex-shrink-0 ".concat(e.isPlaceholder?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 animate-pulse cursor-default":B===e.id?"opacity-50":V===e.id?"ring-2 ring-blue-500":xe()===e.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 border border-blue-300 dark:border-blue-700":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600"," ").concat(!e.isPlaceholder&&te(e.name)?"font-bold":""),title:e.isPlaceholder?y("common.loading"):v(e.name),children:[(0,h.jsx)("span",{className:"truncate max-w-[100px]",children:e.isPlaceholder&&"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"===e.name?(0,h.jsx)("span",{className:"inline-block w-16 h-4 bg-gray-300 dark:bg-gray-500 rounded animate-pulse"}):v(e.name)}),!e.isPlaceholder&&!te(e.name)&&(0,h.jsx)("button",{onClick:r=>re(r,e.id),className:"ml-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none",title:y("filter.delete"),children:(0,h.jsx)(n.A,{className:"h-4 w-4"})})]},e.id))),!le&&ae.length>T&&(0,h.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,h.jsxs)("button",{onClick:()=>G(!q),className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border border-gray-300 dark:border-gray-600",title:"Weitere Filter anzeigen",children:[(0,h.jsxs)("span",{children:["+",ae.length-T]}),(0,h.jsx)(o.A,{className:"h-4 w-4 ml-1 transition-transform ".concat(q?"rotate-180":"")})]}),q&&(0,h.jsx)("div",{className:"absolute top-full left-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50 min-w-[200px] max-w-[300px]",children:ae.slice(T).map((e=>(0,h.jsxs)("div",{onClick:()=>{ee(e),G(!1)},className:"flex items-center justify-between px-3 py-2 text-sm cursor-pointer transition-colors ".concat(xe()===e.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"," ").concat(te(e.name)?"font-bold":""),title:v(e.name),children:[(0,h.jsx)("span",{className:"truncate flex-1",children:v(e.name)}),!te(e.name)&&(0,h.jsx)("button",{onClick:r=>{r.stopPropagation(),re(r,e.id),G(!1)},className:"ml-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none flex-shrink-0",title:y("filter.delete"),children:(0,h.jsx)(n.A,{className:"h-4 w-4"})})]},e.id)))})]})]})})}}}]);
//# sourceMappingURL=692.77cb6ba4.chunk.js.map