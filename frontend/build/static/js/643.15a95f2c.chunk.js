"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[643],{637:(e,t,r)=>{r.d(t,{A:()=>s});r(5043);var a=r(579);const s=e=>{let{children:t,columns:r={mobile:1,tablet:1,desktop:1,largeDesktop:1},gap:s="md",className:l=""}=e;const n={sm:"gap-0.5",md:"gap-0.5",lg:"gap-1"}[s];return(0,a.jsx)("div",{className:"flex flex-col ".concat(n," ").concat(l),children:t})}},2023:(e,t,r)=>{r.d(t,{F:()=>c});var a=r(9379),s=r(5043),l=r(1923),n=r(8018);const i=e=>"table_settings_".concat(e),o=async e=>{try{return(await l.A.get("/table-settings/".concat(e))).data}catch(t){console.error("Fehler beim Abrufen der Tabelleneinstellungen vom Server:",t);try{const t=i(e),r=localStorage.getItem(t);if(r)return JSON.parse(r)}catch(r){console.error("Fehler beim Laden aus localStorage:",r)}return{tableId:e,columnOrder:[],hiddenColumns:[]}}},d=async e=>{try{await l.A.post("/table-settings",e);const t=i(e.tableId);localStorage.setItem(t,JSON.stringify(e))}catch(t){console.error("Fehler beim Speichern der Tabelleneinstellungen auf dem Server:",t);try{const t=i(e.tableId);localStorage.setItem(t,JSON.stringify(e))}catch(r){console.error("Fehler beim Speichern im localStorage:",r)}}},c=(e,t)=>{const[r,l]=(0,s.useState)({tableId:e,columnOrder:(null===t||void 0===t?void 0:t.defaultColumnOrder)||[],hiddenColumns:(null===t||void 0===t?void 0:t.defaultHiddenColumns)||[]}),[i,c]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null);(0,s.useEffect)((()=>{let r=!0;return(async()=>{try{c(!0);const a=await o(e);if(!r)return;n.v.log("Geladene Tabelleneinstellungen vom Server:",a),0===a.columnOrder.length&&null!==t&&void 0!==t&&t.defaultColumnOrder&&(a.columnOrder=t.defaultColumnOrder),!a.viewMode&&null!==t&&void 0!==t&&t.defaultViewMode&&(a.viewMode=t.defaultViewMode);let s=!1;!a.sortConfig&&null!==t&&void 0!==t&&t.defaultSortConfig&&(a.sortConfig=t.defaultSortConfig,s=!0),n.v.log("Finale Tabelleneinstellungen nach Initialisierung:",a),l(a),m(null),s&&d(a).catch((e=>{m(e instanceof Error?e:new Error("Fehler beim Speichern der Standard-Sortierung")),console.error("Fehler beim Speichern der Standard-Sortierung:",e)}))}catch(a){if(!r)return;m(a instanceof Error?a:new Error("Fehler beim Laden der Einstellungen")),console.error("Fehler beim Laden der Tabelleneinstellungen:",a)}finally{r&&c(!1)}})(),()=>{r=!1}}),[e]);const g=(0,s.useCallback)((async e=>{try{const t=(0,a.A)((0,a.A)({},r),{},{columnOrder:e});l(t),await d(t)}catch(t){m(t instanceof Error?t:new Error("Fehler beim Speichern der Spaltenreihenfolge")),console.error("Fehler beim Speichern der Spaltenreihenfolge:",t)}}),[r]),x=(0,s.useCallback)((async e=>{try{l((t=>{const r=(0,a.A)((0,a.A)({},t),{},{hiddenColumns:e});return d(r).catch((e=>{m(e instanceof Error?e:new Error("Fehler beim Speichern der versteckten Spalten")),console.error("Fehler beim Speichern der versteckten Spalten:",e)})),r}))}catch(t){m(t instanceof Error?t:new Error("Fehler beim Speichern der versteckten Spalten")),console.error("Fehler beim Speichern der versteckten Spalten:",t)}}),[]),b=(0,s.useCallback)((async e=>{try{let t;t=r.hiddenColumns.includes(e)?r.hiddenColumns.filter((t=>t!==e)):[...r.hiddenColumns,e];const s=(0,a.A)((0,a.A)({},r),{},{hiddenColumns:t});l(s),await d(s)}catch(t){m(t instanceof Error?t:new Error("Fehler beim \xc4ndern der Spaltenansicht")),console.error("Fehler beim \xc4ndern der Spaltenansicht:",t)}}),[r]),h=(0,s.useCallback)((async e=>{try{l((t=>{const r=(0,a.A)((0,a.A)({},t),{},{viewMode:e});return d(r).catch((e=>{m(e instanceof Error?e:new Error("Fehler beim Speichern des View-Modes")),console.error("Fehler beim Speichern des View-Modes:",e)})),r}))}catch(t){m(t instanceof Error?t:new Error("Fehler beim Speichern des View-Modes")),console.error("Fehler beim Speichern des View-Modes:",t)}}),[]),p=(0,s.useCallback)((async e=>{try{l((t=>{const r=(0,a.A)((0,a.A)({},t),{},{sortConfig:e});return d(r).catch((e=>{m(e instanceof Error?e:new Error("Fehler beim Speichern der Sortierung")),console.error("Fehler beim Speichern der Sortierung:",e)})),r}))}catch(t){m(t instanceof Error?t:new Error("Fehler beim Speichern der Sortierung")),console.error("Fehler beim Speichern der Sortierung:",t)}}),[]);return{settings:r,isLoading:i,error:u,updateColumnOrder:g,updateHiddenColumns:x,toggleColumnVisibility:b,isColumnVisible:e=>!r.hiddenColumns.includes(e),updateViewMode:h,updateSortConfig:p}}},6400:(e,t,r)=>{r.d(t,{Ac:()=>m,J1:()=>u,W5:()=>c});var a=r(1620),s=r(8605),l=r(4912),n=r(3695),i=r(8621),o=r(7744);const d=(e,t)=>{const{operator:r,value:a}=t;if(void 0===a)return console.error("evaluateCondition: value ist undefined",t),!1;if(null==e&&null==a)return"equals"===r;if(null==e||null==a)return"notEquals"===r;let s="",l="";try{const t=null==e?"":"string"===typeof e?e:String(e);if("string"!==typeof t)return!1;const r=t.toLowerCase();if(void 0===r||null===r||"string"!==typeof r)return!1;s=r;const n=null==a?"":"string"===typeof a?a:String(a);if("string"!==typeof n)return!1;const i=n.toLowerCase();if(void 0===i||null===i||"string"!==typeof i)return!1;l=i}catch(n){return!1}if("string"!==typeof s||"string"!==typeof l||void 0===s||void 0===l||null===s||null===l)return!1;switch(r){case"equals":return s===l;case"notEquals":return s!==l;case"contains":return s.includes(l);case"startsWith":return s.startsWith(l);case"endsWith":if(void 0===s||null===s)return console.error("endsWith: strField ist undefined/null",{strField:s,strValue:l,fieldValue:e,value:a,condition:t}),!1;if(void 0===l||null===l)return console.error("endsWith: strValue ist undefined/null",{strField:s,strValue:l,fieldValue:e,value:a,condition:t}),!1;if("string"!==typeof s)return console.error("endsWith: strField ist kein String",{strField:s,typeof:typeof s,strValue:l,fieldValue:e,value:a,condition:t}),!1;if("string"!==typeof l)return console.error("endsWith: strValue ist kein String",{strField:s,strValue:l,typeof:typeof l,fieldValue:e,value:a,condition:t}),!1;try{return s.endsWith(l)}catch(n){return console.error("endsWith: Fehler bei endsWith-Aufruf",n,{strField:s,strValue:l,fieldValue:e,value:a,condition:t}),!1}case"before":case"after":{const t=new Date(e),s=new Date(a);return!isNaN(t.getTime())&&!isNaN(s.getTime())&&("before"===r?t<s:t>s)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),s=parseFloat(String(a));return!isNaN(t)&&!isNaN(s)&&("greaterThan"===r?t>s:t<s)}default:return!0}},c=(e,t,r,a,s)=>0===t.length?e:e.filter((e=>{let l=!0;for(let n=0;n<t.length;n++){const i=t[n];let o=!1;if(s&&s[i.column]){const t=s[i.column](e,i);if(null!==t)o=t;else{const t=a(e,i.column);o=d(t,i)}}else{const t=a(e,i.column);o=d(t,i)}if(0===n)l=o;else{l="AND"===(r[n-1]||"AND")?l&&o:l||o}}return l})),u=(e,t)=>{if(!e)return!1;const r=new Date(e);if(isNaN(r.getTime()))return!1;const d=r.getUTCFullYear(),c=r.getUTCMonth(),u=r.getUTCDate(),m=new Date(d,c,u);try{if("__THIS_WEEK__"===t.value){if("equals"===t.operator){const e=(0,a.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const t=(0,s.$)(new Date,{weekStartsOn:1});return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,a.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const r=(0,s.$)(new Date,{weekStartsOn:1});return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}if("__THIS_MONTH__"===t.value){if("equals"===t.operator){const e=(0,l.w)(new Date);e.setHours(0,0,0,0);const t=(0,n.p)(new Date);return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,l.w)(new Date);e.setHours(0,0,0,0);const r=(0,n.p)(new Date);return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}if("__THIS_YEAR__"===t.value){if("equals"===t.operator){const e=(0,i.D)(new Date);e.setHours(0,0,0,0);const t=(0,o.Q)(new Date);return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,i.D)(new Date);e.setHours(0,0,0,0);const r=(0,o.Q)(new Date);return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}let e;if("__TODAY__"===t.value){const t=new Date;t.setHours(0,0,0,0),e=t}else if("__WEEK_START__"===t.value){const t=(0,a.k)(new Date,{weekStartsOn:1});t.setHours(0,0,0,0),e=t}else if("__WEEK_END__"===t.value){const t=(0,s.$)(new Date,{weekStartsOn:1});t.setHours(23,59,59,999),e=t}else if("__MONTH_START__"===t.value){const t=(0,l.w)(new Date);t.setHours(0,0,0,0),e=t}else if("__MONTH_END__"===t.value){const t=(0,n.p)(new Date);t.setHours(23,59,59,999),e=t}else if("__YEAR_START__"===t.value){const t=(0,i.D)(new Date);t.setHours(0,0,0,0),e=t}else if("__YEAR_END__"===t.value){const t=(0,o.Q)(new Date);t.setHours(23,59,59,999),e=t}else{const r=new Date(t.value);if(isNaN(r.getTime()))return!1;const a=r.getUTCFullYear(),s=r.getUTCMonth(),l=r.getUTCDate();e=new Date(a,s,l)}switch(t.operator){case"equals":return m.getTime()===e.getTime();case"before":return m<e;case"after":return m>e;default:return!0}}catch(g){return console.error("[evaluateDateCondition] Error with placeholder ".concat(t.value,":"),g),!1}},m=(e,t,r,a)=>{const s=r.value||"";if(s.startsWith("user-")){const t=parseInt(s.replace("user-",""),10);if(isNaN(t))return!1;const a=e===t;return"notEquals"===r.operator?!a:a}if(s.startsWith("role-")){const e=parseInt(s.replace("role-",""),10);if(isNaN(e))return!1;const a=t===e;return"notEquals"===r.operator?!a:a}if(""===s)return!0;if(void 0!==a){const e=a.toLowerCase(),t=s.toLowerCase();if("equals"===r.operator)return e===t;if("notEquals"===r.operator)return e!==t;if("contains"===r.operator)return e.includes(t)}return!1}},7539:(e,t,r)=>{r.d(t,{A:()=>g});var a=r(5043),s=r(4117),l=r(1923),n=r(6443),i=r(7591),o=r(9422),d=r(1801),c=r(2672),u=r(7855),m=r(579);const g=e=>{let{isOpen:t,onClose:r,onBookingCreated:g,tour:x}=e;const{t:b}=(0,s.Bd)(),{user:h}=(0,c.As)(),{showMessage:p}=(0,u.A)(),[y,f]=(0,a.useState)((null===x||void 0===x?void 0:x.id)||""),[v,k]=(0,a.useState)(""),[j,w]=(0,a.useState)(1),[N,A]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[E,T]=(0,a.useState)(""),[D,L]=(0,a.useState)(""),[R,P]=(0,a.useState)([]),[z,I]=(0,a.useState)(x||null),[F,_]=(0,a.useState)(null),[B,V]=(0,a.useState)(!1),[O,M]=(0,a.useState)(!0);(0,a.useEffect)((()=>{t&&(async()=>{try{var e;M(!0);const t=await l.A.get(d.Sn.TOURS.BASE,{params:{isActive:!0}}),r=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];P(Array.isArray(r)?r:[])}catch(t){console.error("Error loading tours:",t),p(b("errors.loadError"),"error")}finally{M(!1)}})()}),[t,b,p]),(0,a.useEffect)((()=>{x&&(f(x.id),I(x))}),[x]),(0,a.useEffect)((()=>{if(y){const e=R.find((e=>e.id===Number(y)));I(e||null)}else I(null)}),[y,R]),(0,a.useEffect)((()=>{t||(x||f(""),k(""),w(1),A(""),C(""),T(""),L(""),_(null))}),[t,x]);return(0,m.jsxs)(n.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,m.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,m.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,m.jsxs)(n.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,m.jsx)(n.lG.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:b("tourBookings.create",{defaultValue:"Neue Tour-Buchung"})}),(0,m.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,m.jsx)(i.A,{className:"h-6 w-6"})})]}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),_(null),!y)return void _(b("tourBookings.validation.tourRequired",{defaultValue:"Tour ist erforderlich"}));if(!v)return void _(b("tourBookings.validation.tourDateRequired",{defaultValue:"Tour-Datum ist erforderlich"}));if(new Date(v)<new Date)_(b("tours.validation.tourDateFuture",{defaultValue:"Tour-Datum muss in der Zukunft liegen"}));else if(!j||Number(j)<1)_(b("tourBookings.validation.numberOfParticipantsMin",{defaultValue:"Anzahl Teilnehmer muss >= 1 sein"}));else if(!N.trim()||N.trim().length<2)_(b("tourBookings.validation.customerNameMinLength",{defaultValue:"Kundenname muss mindestens 2 Zeichen lang sein"}));else if(E.trim()||S.trim()){if(z){const e=Number(j);if(z.minParticipants&&e<z.minParticipants)return void _(b("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:z.minParticipants,max:z.maxParticipants||"\u221e"}));if(z.maxParticipants&&e>z.maxParticipants)return void _(b("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:z.minParticipants||1,max:z.maxParticipants}))}V(!0);try{var t,a;const e=await l.A.post(d.Sn.TOUR_BOOKINGS.BASE,{tourId:Number(y),tourDate:v,numberOfParticipants:Number(j),customerName:N.trim(),customerEmail:S.trim()||null,customerPhone:E.trim()||null,customerNotes:D.trim()||null});var s;if(null===(t=e.data)||void 0===t||!t.success||null===(a=e.data)||void 0===a||!a.data)throw new Error((null===(s=e.data)||void 0===s?void 0:s.message)||b("tours.bookings.createError",{defaultValue:"Fehler beim Erstellen der Buchung"}));p(b("tourBookings.created",{defaultValue:"Tour-Buchung erfolgreich erstellt"}),"success"),g(e.data.data),r()}catch(o){var n,i;console.error("Error creating booking:",o);const e=(null===o||void 0===o||null===(n=o.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||(null===o||void 0===o?void 0:o.message)||b("errors.unknownError");_(e),p(e,"error")}finally{V(!1)}}else _(b("tourBookings.validation.contactRequired",{defaultValue:"Mindestens eine Kontaktinformation (Telefon oder E-Mail) ist erforderlich"}))},className:"p-4 space-y-4",children:[F&&(0,m.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,m.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:F})}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[b("tourBookings.tour",{defaultValue:"Tour"})," *"]}),(0,m.jsxs)("select",{value:y,onChange:e=>f(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B||O||!!x,children:[(0,m.jsx)("option",{value:"",children:b("common.select",{defaultValue:"Bitte w\xe4hlen"})}),R.filter((e=>e.isActive&&e.title)).map((e=>(0,m.jsx)("option",{value:e.id,children:e.title||"-"},e.id)))]}),z&&(0,m.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:z.minParticipants&&z.maxParticipants?b("tourBookings.participantsRange",{defaultValue:"Teilnehmer: {min} - {max}",min:z.minParticipants,max:z.maxParticipants}):z.minParticipants?b("tourBookings.participantsMin",{defaultValue:"Min. Teilnehmer: {min}",min:z.minParticipants}):z.maxParticipants?b("tourBookings.participantsMax",{defaultValue:"Max. Teilnehmer: {max}",max:z.maxParticipants}):null})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[b("tourBookings.tourDate",{defaultValue:"Tour-Datum"})," *"]}),(0,m.jsx)("input",{type:"datetime-local",value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B||O})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[b("tourBookings.numberOfParticipants",{defaultValue:"Anzahl Teilnehmer"})," *"]}),(0,m.jsx)("input",{type:"number",min:(null===z||void 0===z?void 0:z.minParticipants)||1,max:(null===z||void 0===z?void 0:z.maxParticipants)||void 0,value:j,onChange:e=>w(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B||O})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[b("tourBookings.customerName",{defaultValue:"Kundenname"})," *"]}),(0,m.jsx)("input",{type:"text",value:N,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B||O})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:b("tourBookings.customerPhone",{defaultValue:"Telefon"})}),(0,m.jsx)("input",{type:"tel",value:E,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B||O})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:b("tourBookings.customerEmail",{defaultValue:"E-Mail"})}),(0,m.jsx)("input",{type:"email",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B||O})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:b("tourBookings.customerNotes",{defaultValue:"Notizen"})}),(0,m.jsx)("textarea",{value:D,onChange:e=>L(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B||O})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,m.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:b("common.cancel","Abbrechen"),children:(0,m.jsx)(i.A,{className:"h-5 w-5"})}),(0,m.jsx)("button",{type:"submit",disabled:B||O,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:B?b("common.saving","Speichere..."):b("common.save","Speichern"),children:(0,m.jsx)(o.A,{className:"h-5 w-5"})})]})]})]})})]})}},7643:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Lt});var a=r(5043),s=r(4117),l=r(2760),n=r(7504),i=r(4129),o=r(8153),d=r(7459),c=r(5889),u=r(7988),m=r(9379),g=r(6443),x=r(542),b=r(8662),h=r(6009),p=r(2704),y=r(6238),f=r(7591),v=r(9422),k=r(7855),j=r(595),w=r(1923),N=r(1801),A=r(6287),S=r(4538),C=r(2811),E=r(7012),T=r(4791),D=r(1816),L=r(2672),R=r(5657),P=r(579);const z=e=>{let{isOpen:t,onClose:r,onCertificateCreated:n,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:m}=(0,L.As)(),{isHR:x,isAdmin:b,loading:h}=(0,l.S)(),{openSidepane:y,closeSidepane:j}=(0,R.N)(),{showMessage:A}=(0,k.A)(),[S,C]=(0,a.useState)(window.innerWidth<640),[E,T]=(0,a.useState)(window.innerWidth>1070),[z,I]=(0,a.useState)("data"),[F,_]=(0,a.useState)(!1),[B,V]=(0,a.useState)(null),[O,M]=(0,a.useState)(null),[U,q]=(0,a.useState)((new Date).toISOString().split("T")[0]),[W,G]=(0,a.useState)("employment"),[H,K]=(0,a.useState)(null),[J,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(!1),[$,Q]=(0,a.useState)([]),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(!1),se=(0,a.useRef)(null);(0,a.useEffect)((()=>{h||x()||b()||(A("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse erstellen","error"),r())}),[x,b,h,r,A]),(0,a.useEffect)((()=>{const e=()=>{C(window.innerWidth<640),T(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(y(),ne(),le()):j(),()=>{j()})),[t,y,j]);const le=async()=>{try{const e=(await w.A.get(N.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentCertificate&&t.push({type:"employmentCertificate",version:e.employmentCertificate.version,path:e.employmentCertificate.path}),Q(t),t.length>0&&(te(t[0].type),ae(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},ne=async()=>{try{const[e,t]=await Promise.all([w.A.get(N.Sn.USERS.BY_ID(o)),w.A.get(N.Sn.LIFECYCLE.BY_USER(o))]),r=e.data,a=t.data.lifecycle,s={firstName:r.firstName||"",lastName:r.lastName||"",identificationNumber:r.identificationNumber||null,contractStartDate:(null===a||void 0===a?void 0:a.contractStartDate)||null,contractEndDate:(null===a||void 0===a?void 0:a.contractEndDate)||null,contractType:(null===a||void 0===a?void 0:a.contractType)||null,salary:r.salary||null,position:null};M(s),U&&U!==(new Date).toISOString().split("T")[0]||q((new Date).toISOString().split("T")[0])}catch(e){console.error("Fehler beim Laden der User-Daten:",e),V("Fehler beim Laden der Daten")}};(0,a.useEffect)((()=>()=>{J&&URL.revokeObjectURL(J)}),[J]);return x()||b()?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(!E||S)&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,P.jsxs)(g.lG.Panel,{className:"\n            ".concat(S?"w-full h-full":"w-[600px]","\n            ").concat(S?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(S?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n            ").concat(S?"":"sidepane-panel-container","\n          "),style:{animation:S?"none":"slideIn 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94)"},children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,P.jsx)(p.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis erstellen"})]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,P.jsx)("div",{className:"mb-4",children:(0,P.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,P.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,P.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,P.jsx)("button",{type:"button",onClick:()=>I("data"),className:"".concat("data"===z?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Daten"}),(0,P.jsx)("button",{type:"button",onClick:()=>I("text"),className:"".concat("text"===z?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),B&&(0,P.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:B})}),"data"===z&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,P.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,P.jsx)("div",{className:"space-y-2 text-sm",children:O&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,P.jsxs)("span",{className:"dark:text-white",children:[O.firstName," ",O.lastName]})]}),O.identificationNumber&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(p.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,P.jsx)("span",{className:"dark:text-white",children:O.identificationNumber})]}),O.contractStartDate&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(u.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Eintrittsdatum:"}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(O.contractStartDate).toLocaleDateString("de-DE")})]}),O.contractEndDate&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(u.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Austrittsdatum:"}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(O.contractEndDate).toLocaleDateString("de-DE")})]})]})})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Ausstellungsdatum ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsx)("input",{type:"date",value:U,onChange:e=>{const t=e.target.value;q(t),t&&new Date(t)>new Date?V("Ausstellungsdatum darf nicht in der Zukunft liegen"):V(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(B&&U&&new Date(U)>new Date||B&&!U?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!(U&&!(U&&new Date(U)>new Date))||void 0,"aria-describedby":!U||U&&new Date(U)>new Date?"issueDate-error":void 0}),B&&(!U||U&&new Date(U)>new Date)&&(0,P.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:B}),!B&&(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Zertifikat-Typ ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("select",{value:W,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0,children:[(0,P.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,P.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,P.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]})]}),"text"===z&&(0,P.jsxs)("div",{className:"space-y-4",children:[$.length>0&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,P.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,P.jsx)("input",{type:"checkbox",checked:re,onChange:e=>{ae(e.target.checked),e.target.checked&&H&&(K(null),J&&(URL.revokeObjectURL(J),Y(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,P.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),re&&(0,P.jsx)("select",{value:ee||"",onChange:e=>te(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:$.map((e=>(0,P.jsxs)("option",{value:e.type,children:["Arbeitszeugnis (Version ",e.version,")"]},e.type)))})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[re?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!re&&(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,P.jsx)("input",{ref:se,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void A("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void A("Datei ist zu gro\xdf (max. 10MB)","error");K(r),ae(!1);const e=URL.createObjectURL(r);Y(e)}},className:"hidden"}),H?(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,P.jsx)("p",{className:"text-sm font-medium dark:text-white",children:H.name}),(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(H.size/1024/1024).toFixed(2)," MB"]}),(0,P.jsx)("button",{type:"button",onClick:()=>{K(null),J&&(URL.revokeObjectURL(J),Y(null)),se.current&&(se.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,P.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=se.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,P.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),J&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,P.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,P.jsx)("iframe",{src:"".concat(J,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!re&&!H)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!U)return"Bitte geben Sie ein Ausstellungsdatum an";const e=new Date(U);return isNaN(e.getTime())?"Ung\xfcltiges Ausstellungsdatum":e>new Date?"Ausstellungsdatum darf nicht in der Zukunft liegen":null})();if(t)return V(t),void A(t,"error");_(!0),V(null);try{let e,t=null,a=null;if(re&&ee&&!H){const e=$.find((e=>e.type===ee));e&&(t=e.type,a=e.version)}else{if(!H)return A("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(H.name)}const s={certificateType:W,issueDate:new Date(U),pdfPath:e,templateUsed:t,templateVersion:a};await w.A.post(N.Sn.LIFECYCLE.CERTIFICATES(o),s),A("Arbeitszeugnis erfolgreich erstellt","success"),n(),r(),J&&(URL.revokeObjectURL(J),Y(null)),K(null),q((new Date).toISOString().split("T")[0]),se.current&&(se.current.value="")}catch(l){var a,s;console.error("Fehler beim Erstellen des Arbeitszeugnisses:",l),V((null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitszeugnisses"),A("Fehler beim Erstellen des Arbeitszeugnisses","error")}finally{_(!1)}},disabled:F||!H&&!re,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:F?"Wird erstellt...":"Erstellen",children:F?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]}):null};var I=r(2683);const F=e=>{let{isOpen:t,onClose:r,onContractCreated:n,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:u}=(0,L.As)(),{isHR:m,isAdmin:x,loading:b}=(0,l.S)(),{openSidepane:h,closeSidepane:y}=(0,R.N)(),{showMessage:j}=(0,k.A)(),[A,S]=(0,a.useState)(window.innerWidth<640),[C,E]=(0,a.useState)(window.innerWidth>1070),[T,z]=(0,a.useState)("data"),[F,_]=(0,a.useState)(!1),[B,V]=(0,a.useState)(null),[O,M]=(0,a.useState)(null),[U,q]=(0,a.useState)("employment"),[W,G]=(0,a.useState)((new Date).toISOString().split("T")[0]),[H,K]=(0,a.useState)(""),[J,Y]=(0,a.useState)(""),[Z,X]=(0,a.useState)(""),[$,Q]=(0,a.useState)(""),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(null),[se,le]=(0,a.useState)([]),[ne,ie]=(0,a.useState)(null),[oe,de]=(0,a.useState)(!1),ce=(0,a.useRef)(null);(0,a.useEffect)((()=>{b||m()||x()||(j("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge erstellen","error"),r())}),[m,x,b,r,j]),(0,a.useEffect)((()=>{const e=()=>{S(window.innerWidth<640),E(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(h(),me(),ue()):y(),()=>{y()})),[t,h,y]);const ue=async()=>{try{const e=(await w.A.get(N.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentContract&&t.push({type:"employmentContract",version:e.employmentContract.version,path:e.employmentContract.path}),le(t),t.length>0&&(ie(t[0].type),de(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},me=async()=>{try{const[e,t]=await Promise.all([w.A.get(N.Sn.USERS.BY_ID(o)),w.A.get(N.Sn.LIFECYCLE.BY_USER(o))]),r=e.data,a=t.data.lifecycle,s={firstName:r.firstName||"",lastName:r.lastName||"",identificationNumber:r.identificationNumber||null,contractStartDate:(null===a||void 0===a?void 0:a.contractStartDate)||null,contractEndDate:(null===a||void 0===a?void 0:a.contractEndDate)||null,contractType:(null===a||void 0===a?void 0:a.contractType)||null,salary:r.salary||null,position:null};M(s),s.contractStartDate&&G(new Date(s.contractStartDate).toISOString().split("T")[0]),s.contractEndDate&&K(new Date(s.contractEndDate).toISOString().split("T")[0]),s.salary&&Y(s.salary.toString()),s.contractType&&q(s.contractType)}catch(e){console.error("Fehler beim Laden der User-Daten:",e),V("Fehler beim Laden der Daten")}};(0,a.useEffect)((()=>()=>{re&&URL.revokeObjectURL(re)}),[re]);return m()||x()?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(!C||A)&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,P.jsxs)(g.lG.Panel,{className:"\n            ".concat(A?"w-full h-full":"w-[600px]","\n            ").concat(A?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(A?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n            ").concat(A?"":"sidepane-panel-container","\n          "),children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,P.jsx)(p.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag erstellen"})]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,P.jsx)("div",{className:"mb-4",children:(0,P.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,P.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,P.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,P.jsx)("button",{type:"button",onClick:()=>z("data"),className:"".concat("data"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Vertragsdaten"}),(0,P.jsx)("button",{type:"button",onClick:()=>z("text"),className:"".concat("text"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),B&&(0,P.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:B})}),"data"===T&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,P.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,P.jsx)("div",{className:"space-y-2 text-sm",children:O&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,P.jsxs)("span",{className:"dark:text-white",children:[O.firstName," ",O.lastName]})]}),O.identificationNumber&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(p.A,{className:"h-4 w-4 text-gray-400"}),(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,P.jsx)("span",{className:"dark:text-white",children:O.identificationNumber})]})]})})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("select",{value:U,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,P.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,P.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsx)("input",{type:"date",value:W,onChange:e=>{G(e.target.value),V(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(B&&!W?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!W,"aria-describedby":W?void 0:"startDate-error"}),B&&!W&&(0,P.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:B})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,P.jsx)("input",{type:"date",value:H,onChange:e=>{K(e.target.value),e.target.value&&W&&new Date(e.target.value)<new Date(W)?V("Enddatum muss nach dem Startdatum liegen"):V(null)},min:W||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(B&&H&&W&&new Date(H)<new Date(W)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(H&&W&&new Date(H)<new Date(W))||void 0,"aria-describedby":H&&W&&new Date(H)<new Date(W)?"endDate-error":void 0}),B&&H&&W&&new Date(H)<new Date(W)&&(0,P.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:B})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,P.jsx)("input",{type:"text",value:$,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)(I.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,P.jsx)("input",{type:"number",value:J,onChange:e=>{const t=e.target.value;Y(t),t&&parseFloat(t)<0?V("Gehalt darf nicht negativ sein"):V(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(B&&J&&parseFloat(J)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(J&&parseFloat(J)<0)||void 0,"aria-describedby":J&&parseFloat(J)<0?"salary-error":void 0})]}),B&&J&&parseFloat(J)<0&&(0,P.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:B})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,P.jsx)("input",{type:"number",value:Z,onChange:e=>{const t=e.target.value;X(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?V("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):V(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(B&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!Z||!(parseFloat(Z)<0||parseFloat(Z)>168))||void 0,"aria-describedby":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"workingHours-error":void 0}),B&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)&&(0,P.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:B}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]})]}),"text"===T&&(0,P.jsxs)("div",{className:"space-y-4",children:[se.length>0&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,P.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,P.jsx)("input",{type:"checkbox",checked:oe,onChange:e=>{de(e.target.checked),e.target.checked&&ee&&(te(null),re&&(URL.revokeObjectURL(re),ae(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,P.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),oe&&(0,P.jsx)("select",{value:ne||"",onChange:e=>ie(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:se.map((e=>(0,P.jsxs)("option",{value:e.type,children:["Arbeitsvertrag (Version ",e.version,")"]},e.type)))})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[oe?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!oe&&(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,P.jsx)("input",{ref:ce,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void j("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void j("Datei ist zu gro\xdf (max. 10MB)","error");te(r),de(!1);const e=URL.createObjectURL(r);ae(e)}},className:"hidden"}),ee?(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,P.jsx)("p",{className:"text-sm font-medium dark:text-white",children:ee.name}),(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(ee.size/1024/1024).toFixed(2)," MB"]}),(0,P.jsx)("button",{type:"button",onClick:()=>{te(null),re&&(URL.revokeObjectURL(re),ae(null)),ce.current&&(ce.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,P.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ce.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,P.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),re&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,P.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,P.jsx)("iframe",{src:"".concat(re,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!oe&&!ee)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!W)return"Bitte geben Sie ein Startdatum an";const e=new Date(W);if(isNaN(e.getTime()))return"Ung\xfcltiges Startdatum";if(H){const t=new Date(H);if(isNaN(t.getTime()))return"Ung\xfcltiges Enddatum";if(t<e)return"Enddatum muss nach dem Startdatum liegen"}return J&&parseFloat(J)<0?"Gehalt darf nicht negativ sein":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen":null})();if(t)return V(t),void j(t,"error");_(!0),V(null);try{let e,t=null,a=null;if(oe&&ne&&!ee){const e=se.find((e=>e.type===ne));e&&(t=e.type,a=e.version)}else{if(!ee)return j("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(ee.name)}const s={contractType:U,startDate:new Date(W),endDate:H?new Date(H):null,salary:J?parseFloat(J):null,workingHours:Z?parseFloat(Z):null,position:$||null,pdfPath:e,templateUsed:t,templateVersion:a};await w.A.post(N.Sn.LIFECYCLE.CONTRACTS(o),s),j("Arbeitsvertrag erfolgreich erstellt","success"),n(),r(),re&&(URL.revokeObjectURL(re),ae(null)),te(null),G((new Date).toISOString().split("T")[0]),K(""),Y(""),X(""),Q(""),ce.current&&(ce.current.value="")}catch(l){var a,s;console.error("Fehler beim Erstellen des Arbeitsvertrags:",l),V((null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitsvertrags"),j("Fehler beim Erstellen des Arbeitsvertrags","error")}finally{_(!1)}},disabled:F||!ee&&!oe||!W,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:F?"Wird erstellt...":"Erstellen",children:F?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]}):null},_=e=>{let{isOpen:t,onClose:r,onCertificateUpdated:n,userId:i,certificate:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:m}=(0,l.S)(),{openSidepane:x,closeSidepane:b}=(0,R.N)(),{showMessage:h}=(0,k.A)(),[y,j]=(0,a.useState)(window.innerWidth<640),[A,S]=(0,a.useState)(window.innerWidth>1070),[C,E]=(0,a.useState)(!1),[T,L]=(0,a.useState)(null),[z,I]=(0,a.useState)(o.issueDate?new Date(o.issueDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[F,_]=(0,a.useState)(o.certificateType||"employment"),[B,V]=(0,a.useState)(null),[O,M]=(0,a.useState)(null),[U,q]=(0,a.useState)(null),W=(0,a.useRef)(null);(0,a.useEffect)((()=>{m||c()||u()||(h("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse bearbeiten","error"),r())}),[c,u,m,r,h]),(0,a.useEffect)((()=>{const e=()=>{j(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(x(),o.id&&q(N.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id))):b(),()=>{b()})),[t,x,b,o.id,i]),(0,a.useEffect)((()=>()=>{O&&URL.revokeObjectURL(O)}),[O]);const G=async e=>{e.preventDefault(),E(!0),L(null);try{const e={issueDate:new Date(z),certificateType:F};B&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(B.name),e.templateVersion=o.templateVersion||"1.0"),await w.A.put(N.Sn.LIFECYCLE.CERTIFICATE(i,o.id),e),h("Arbeitszeugnis erfolgreich aktualisiert","success"),n(),r(),O&&(URL.revokeObjectURL(O),M(null)),V(null),W.current&&(W.current.value="")}catch(s){var t,a;console.error("Fehler beim Aktualisieren des Arbeitszeugnisses:",s),L((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Aktualisieren des Arbeitszeugnisses"),h("Fehler beim Aktualisieren des Arbeitszeugnisses","error")}finally{E(!1)}};return c()||u()?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(!A||y)&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,P.jsxs)(g.lG.Panel,{className:"\n            ".concat(y?"w-full h-full":"w-[600px]","\n            ").concat(y?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(y?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n            ").concat(y?"":"sidepane-panel-container","\n          "),children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,P.jsx)(p.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis bearbeiten"})]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[T&&(0,P.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:T})}),(0,P.jsxs)("form",{onSubmit:G,className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausstellungsdatum"}),(0,P.jsx)("input",{type:"date",value:z,onChange:e=>{const t=e.target.value;I(t),t&&new Date(t)>new Date?L("Ausstellungsdatum darf nicht in der Zukunft liegen"):L(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(T&&z&&new Date(z)>new Date?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(z&&new Date(z)>new Date)||void 0,"aria-describedby":z&&new Date(z)>new Date?"issueDate-error":void 0}),T&&z&&new Date(z)>new Date&&(0,P.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:T}),!T&&(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zertifikat-Typ"}),(0,P.jsxs)("select",{value:F,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,P.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,P.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,P.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,P.jsx)("input",{ref:W,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void h("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void h("Datei ist zu gro\xdf (max. 10MB)","error");V(r);const e=URL.createObjectURL(r);M(e),q(null)}},className:"hidden"}),B?(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,P.jsx)("p",{className:"text-sm font-medium dark:text-white",children:B.name}),(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(B.size/1024/1024).toFixed(2)," MB"]}),(0,P.jsx)("button",{type:"button",onClick:()=>{V(null),O&&(URL.revokeObjectURL(O),M(null)),q(N.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id)),W.current&&(W.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,P.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=W.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,P.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(O||U)&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,P.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,P.jsx)("iframe",{src:"".concat(O||U).concat(O?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,P.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,P.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,P.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:G,disabled:C,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]}):null},B=e=>{let{isOpen:t,onClose:r,onContractUpdated:n,userId:i,contract:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:m}=(0,l.S)(),{openSidepane:x,closeSidepane:b}=(0,R.N)(),{showMessage:h}=(0,k.A)(),[y,j]=(0,a.useState)(window.innerWidth<640),[A,S]=(0,a.useState)(window.innerWidth>1070),[C,E]=(0,a.useState)(!1),[T,L]=(0,a.useState)(null),[z,F]=(0,a.useState)(o.contractType||"employment"),[_,B]=(0,a.useState)(o.startDate?new Date(o.startDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[V,O]=(0,a.useState)(o.endDate?new Date(o.endDate).toISOString().split("T")[0]:""),[M,U]=(0,a.useState)(o.salary?o.salary.toString():""),[q,W]=(0,a.useState)(o.workingHours?o.workingHours.toString():""),[G,H]=(0,a.useState)(o.position||""),[K,J]=(0,a.useState)(null),[Y,Z]=(0,a.useState)(null),[X,$]=(0,a.useState)(null),Q=(0,a.useRef)(null);(0,a.useEffect)((()=>{m||c()||u()||(h("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge bearbeiten","error"),r())}),[c,u,m,r,h]),(0,a.useEffect)((()=>{const e=()=>{j(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(x(),o.id&&$(N.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id))):b(),()=>{b()})),[t,x,b,o.id,i]),(0,a.useEffect)((()=>()=>{Y&&URL.revokeObjectURL(Y)}),[Y]);const ee=async e=>{if(e.preventDefault(),_){E(!0),L(null);try{const e={contractType:z,startDate:new Date(_),endDate:V?new Date(V):null,salary:M?parseFloat(M):null,workingHours:q?parseFloat(q):null,position:G||null};K&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(K.name),e.templateVersion=o.templateVersion||"1.0"),await w.A.put(N.Sn.LIFECYCLE.CONTRACT(i,o.id),e),h("Arbeitsvertrag erfolgreich aktualisiert","success"),n(),r(),Y&&(URL.revokeObjectURL(Y),Z(null)),J(null),Q.current&&(Q.current.value="")}catch(s){var t,a;console.error("Fehler beim Aktualisieren des Arbeitsvertrags:",s),L((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Aktualisieren des Arbeitsvertrags"),h("Fehler beim Aktualisieren des Arbeitsvertrags","error")}finally{E(!1)}}else h("Bitte geben Sie ein Startdatum an","error")};return c()||u()?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(!A||y)&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,P.jsxs)(g.lG.Panel,{className:"\n            ".concat(y?"w-full h-full":"w-[600px]","\n            ").concat(y?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(y?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n            ").concat(y?"":"sidepane-panel-container","\n          "),children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,P.jsx)(p.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag bearbeiten"})]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[T&&(0,P.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:T})}),(0,P.jsxs)("form",{onSubmit:ee,className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("select",{value:z,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,P.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,P.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsx)("input",{type:"date",value:_,onChange:e=>{const t=e.target.value;B(t),V&&t&&new Date(V)<new Date(t)?L("Enddatum muss nach dem Startdatum liegen"):L(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(T&&!_?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!_||void 0,"aria-describedby":_?void 0:"startDate-error"}),T&&!_&&(0,P.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:T})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,P.jsx)("input",{type:"date",value:V,onChange:e=>{const t=e.target.value;O(t),t&&_&&new Date(t)<new Date(_)?L("Enddatum muss nach dem Startdatum liegen"):L(null)},min:_||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(T&&V&&_&&new Date(V)<new Date(_)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(V&&_&&new Date(V)<new Date(_))||void 0,"aria-describedby":V&&_&&new Date(V)<new Date(_)?"endDate-error":void 0}),T&&V&&_&&new Date(V)<new Date(_)&&(0,P.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:T})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,P.jsx)("input",{type:"text",value:G,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)(I.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,P.jsx)("input",{type:"number",value:M,onChange:e=>{const t=e.target.value;U(t),t&&parseFloat(t)<0?L("Gehalt darf nicht negativ sein"):L(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(T&&M&&parseFloat(M)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(M&&parseFloat(M)<0)||void 0,"aria-describedby":M&&parseFloat(M)<0?"salary-error":void 0})]}),T&&M&&parseFloat(M)<0&&(0,P.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:T})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,P.jsx)("input",{type:"number",value:q,onChange:e=>{const t=e.target.value;W(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?L("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):L(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(T&&q&&(parseFloat(q)<0||parseFloat(q)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!q||!(parseFloat(q)<0||parseFloat(q)>168))||void 0,"aria-describedby":q&&(parseFloat(q)<0||parseFloat(q)>168)?"workingHours-error":void 0}),T&&q&&(parseFloat(q)<0||parseFloat(q)>168)&&(0,P.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:T}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,P.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,P.jsx)("input",{ref:Q,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void h("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void h("Datei ist zu gro\xdf (max. 10MB)","error");J(r);const e=URL.createObjectURL(r);Z(e),$(null)}},className:"hidden"}),K?(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,P.jsx)("p",{className:"text-sm font-medium dark:text-white",children:K.name}),(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(K.size/1024/1024).toFixed(2)," MB"]}),(0,P.jsx)("button",{type:"button",onClick:()=>{J(null),Y&&(URL.revokeObjectURL(Y),Z(null)),$(N.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id)),Q.current&&(Q.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,P.jsxs)("div",{children:[(0,P.jsx)(p.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,P.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,P.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(Y||X)&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,P.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,P.jsx)("iframe",{src:"".concat(Y||X).concat(Y?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,P.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,P.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,P.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:ee,disabled:C||!_,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]}):null};var V=r(7098);const O=e=>{let{userId:t,lifecycleId:r,onUpdate:n}=e;const{t:i}=(0,s.Bd)(),{isLegal:o,isAdmin:d,loading:c}=(0,l.S)(),{showMessage:u}=(0,k.A)(),[g,x]=(0,a.useState)({arl:null,eps:null,pension:null,caja:null}),[b,h]=(0,a.useState)(!0),[y,v]=(0,a.useState)(null),[j,A]=(0,a.useState)({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),[T,L]=(0,a.useState)(!1),R=(0,a.useRef)(!1),z=(0,a.useRef)(null),I=(0,a.useCallback)((async()=>{z.current&&z.current.abort();const e=new AbortController;z.current=e,R.current=!0,h(!0);try{const r=["arl","eps","pension","caja"].map((async r=>{if(e.signal.aborted)return{type:r,registration:null};try{return{type:r,registration:(await w.A.get(N.Sn.LIFECYCLE.SOCIAL_SECURITY(t,r),{timeout:5e3,signal:e.signal})).data}}catch(l){var a,s;return"AbortError"===l.name||"CanceledError"===l.name||e.signal.aborted||404===(null===(a=l.response)||void 0===a?void 0:a.status)?{type:r,registration:null}:"ERR_NETWORK"===l.code||"ECONNABORTED"===l.code||null!==(s=l.message)&&void 0!==s&&s.includes("ERR_INSUFFICIENT_RESOURCES")?(console.warn("Network error loading ".concat(r,", treating as not found")),{type:r,registration:null}):(console.error("Error loading ".concat(r,":"),l),{type:r,registration:null})}})),a=await Promise.all(r);if(e.signal.aborted)return;const s={arl:null,eps:null,pension:null,caja:null};a.forEach((e=>{let{type:t,registration:r}=e;r&&(s[t]={id:r.id||0,registrationType:t,registrationNumber:r.number||r.registrationNumber||null,provider:r.provider||null,registrationDate:r.registeredAt||r.registrationDate||null,status:r.status||"pending",notes:r.notes||null,completedAt:r.completedAt||null})})),x(s)}catch(r){if("AbortError"===r.name||"CanceledError"===r.name||e.signal.aborted)return;console.error("Error loading registrations:",r),u(i("socialSecurity.loadError"),"error")}finally{h(!1),R.current=!1}}),[t,i,u]);(0,a.useEffect)((()=>{if(c)return;if((o()||d())&&t&&r){if(!R.current)return I(),()=>{z.current&&z.current.abort(),R.current=!1}}else h(!1)}),[t,r,c]);const F=()=>{v(null),A({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""})},_=async()=>{if(y)if(c)u(i("common.loading",{defaultValue:"Berechtigungen werden geladen..."}),"warning");else if(o()||d()){L(!0);try{await w.A.put(N.Sn.LIFECYCLE.SOCIAL_SECURITY(t,y),{status:j.status,number:j.registrationNumber||void 0,provider:j.provider||void 0,registrationDate:j.registrationDate?new Date(j.registrationDate).toISOString():void 0,notes:j.notes||void 0}),u("Sozialversicherung erfolgreich aktualisiert","success"),v(null),await new Promise((e=>setTimeout(e,200))),await I(),n&&"function"===typeof n&&n()}catch(a){var e,r;console.error("Error updating social security:",a),u((null===(e=a.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||i("socialSecurity.updateError"),"error")}finally{L(!1)}}else u(i("lifecycle.noPermission",{defaultValue:"Keine Berechtigung - nur Legal oder Admin"}),"error")},B=e=>{switch(e){case"registered":return(0,P.jsx)(S.A,{className:"h-5 w-5 text-green-500"});case"pending":return(0,P.jsx)(E.A,{className:"h-5 w-5 text-yellow-500"});case"failed":return(0,P.jsx)(V.A,{className:"h-5 w-5 text-red-500"});case"not_required":return(0,P.jsx)(S.A,{className:"h-5 w-5 text-gray-400"});case"deregistered":return(0,P.jsx)(V.A,{className:"h-5 w-5 text-gray-400"});default:return(0,P.jsx)(E.A,{className:"h-5 w-5 text-gray-400"})}},O=e=>{const t="lifecycle.socialSecurityStatus.".concat(e);return i(t)||e},M=e=>({arl:"ARL (Risiko-Arbeit)",eps:"EPS (Gesundheit)",pension:"Pension",caja:"Caja de Compensaci\xf3n"}[e]);if(c)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,P.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(!o()&&!d())return null;if(b)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,P.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});return(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,P.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,P.jsx)(p.A,{className:"h-5 w-5 mr-2"}),i("lifecycle.socialSecurity",{defaultValue:"Sozialversicherungen"})]})}),(0,P.jsx)("div",{className:"space-y-4",children:["arl","eps","pension","caja"].map((e=>{const t=g[e],r=y===e;return(0,P.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:r?(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h4",{className:"font-medium dark:text-white uppercase mb-3",children:i("socialSecurity.editType",{type:M(e)})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("socialSecurity.status")," ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("select",{value:j.status,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"not_required",children:"Nicht erforderlich"}),(0,P.jsx)("option",{value:"pending",children:"Ausstehend"}),(0,P.jsx)("option",{value:"registered",children:"Registriert"}),(0,P.jsx)("option",{value:"failed",children:"Fehlgeschlagen"}),(0,P.jsx)("option",{value:"deregistered",children:"Abgemeldet"})]})]}),"registered"===j.status&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationNumber")}),(0,P.jsx)("input",{type:"text",value:j.registrationNumber,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 123456789"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.provider")}),(0,P.jsx)("input",{type:"text",value:j.provider,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{provider:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. ARL Sura, EPS Sanitas"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationDate")}),(0,P.jsx)("input",{type:"date",value:j.registrationDate,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{registrationDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.notes")}),(0,P.jsx)("textarea",{value:j.notes,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",rows:3,placeholder:i("socialSecurity.additionalInfo")})]}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,P.jsx)("button",{onClick:F,disabled:T,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:i("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{onClick:_,disabled:T,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(T?"common.saving":"common.save"),children:T?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(S.A,{className:"h-5 w-5"})})]})]}):(0,P.jsxs)("div",{className:"flex items-start justify-between",children:[(0,P.jsxs)("div",{className:"flex items-start space-x-3 flex-1",children:[B((null===t||void 0===t?void 0:t.status)||"pending"),(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,P.jsx)("h4",{className:"font-medium dark:text-white uppercase",children:M(e)}),(0,P.jsx)("span",{className:"text-sm font-medium dark:text-white",children:O((null===t||void 0===t?void 0:t.status)||"pending")})]}),t&&(0,P.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[t.provider&&(0,P.jsxs)("div",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.provider"),":"]})," ",t.provider]}),t.registrationNumber&&(0,P.jsxs)("div",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.number"),":"]})," ",t.registrationNumber]}),t.registrationDate&&(0,P.jsxs)("div",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.registrationDate"),":"]})," ",new Date(t.registrationDate).toLocaleDateString("de-DE")]}),t.notes&&(0,P.jsxs)("div",{className:"mt-2",children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.notes"),":"]}),(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t.notes})]}),t.completedAt&&(0,P.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[i("socialSecurity.completedAt")," ",new Date(t.completedAt).toLocaleDateString("de-DE")]})]}),!t&&(0,P.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("socialSecurity.notRegistered")})]})]}),(0,P.jsx)("button",{onClick:()=>(e=>{const t=g[e];A(t?{status:t.status,registrationNumber:t.registrationNumber||"",provider:t.provider||"",registrationDate:t.registrationDate?new Date(t.registrationDate).toISOString().split("T")[0]:"",notes:t.notes||""}:{status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),v(e)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition ml-4",title:i("lifecycle.edit",{defaultValue:"Bearbeiten"}),children:(0,P.jsx)(C.A,{className:"h-5 w-5"})})]})},e)}))})]})};var M=r(9399);const U=e=>{let{isOpen:t,onClose:r,onOffboardingStarted:l,userId:n,userName:i}=e;const{t:o}=(0,s.Bd)(),{openSidepane:d,closeSidepane:c}=(0,R.N)(),{showMessage:x}=(0,k.A)(),[b,h]=(0,a.useState)(window.innerWidth<640),[p,y]=(0,a.useState)(window.innerWidth>1070),[v,j]=(0,a.useState)(!1),[S,C]=(0,a.useState)(null),[E,T]=(0,a.useState)(""),[L,z]=(0,a.useState)(""),[I,F]=(0,a.useState)({});(0,a.useEffect)((()=>{const e=()=>{h(window.innerWidth<640),y(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>{if(t){d();const e=(new Date).toISOString().split("T")[0];T(e),z(""),C(null),F({})}else c();return()=>{c()}}),[t,d,c]);const _=async e=>{if(e.preventDefault(),(()=>{const e={};if(E){const t=new Date(E);(new Date).setHours(0,0,0,0);const r=new Date;r.setFullYear(r.getFullYear()+1),t>r&&(e.exitDate=o("lifecycle.offboarding.exitDateTooFar",{defaultValue:"Austrittsdatum darf nicht mehr als 1 Jahr in der Zukunft liegen"}))}else e.exitDate=o("lifecycle.offboarding.exitDateRequired",{defaultValue:"Austrittsdatum ist erforderlich"});return L&&0!==L.trim().length?L.trim().length<10&&(e.exitReason=o("lifecycle.offboarding.exitReasonTooShort",{defaultValue:"Austrittsgrund muss mindestens 10 Zeichen lang sein"})):e.exitReason=o("lifecycle.offboarding.exitReasonRequired",{defaultValue:"Austrittsgrund ist erforderlich"}),F(e),0===Object.keys(e).length})()){j(!0),C(null);try{await w.A.put(N.Sn.LIFECYCLE.STATUS(n),{status:"offboarding",exitDate:E,exitReason:L.trim()}),x(o("lifecycle.offboarding.started",{defaultValue:"Offboarding erfolgreich gestartet"}),"success"),l(),r()}catch(s){var t,a;console.error("Fehler beim Starten des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||o("lifecycle.offboarding.startError",{defaultValue:"Fehler beim Starten des Offboarding"});C(e),x(e,"error")}finally{j(!1)}}},B=()=>(0,P.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,P.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:(0,P.jsxs)("div",{className:"flex items-start",children:[(0,P.jsx)(M.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5 mr-3 flex-shrink-0"}),(0,P.jsxs)("div",{className:"text-sm text-orange-800 dark:text-orange-200",children:[(0,P.jsx)("p",{className:"font-medium mb-1",children:o("lifecycle.offboarding.warningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,P.jsx)("p",{children:o("lifecycle.offboarding.warningText",{defaultValue:"Durch das Starten des Offboarding-Prozesses werden automatisch Tasks erstellt. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})]})]})}),(0,P.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("lifecycle.offboarding.user",{defaultValue:"Mitarbeiter"})}),(0,P.jsx)("p",{className:"font-medium dark:text-white",children:i})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{htmlFor:"exitDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitDate",{defaultValue:"Austrittsdatum"})," *"]}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,P.jsx)(u.A,{className:"h-5 w-5 text-gray-400"})}),(0,P.jsx)("input",{type:"date",id:"exitDate",value:E,onChange:e=>{T(e.target.value),I.exitDate&&F((e=>(0,m.A)((0,m.A)({},e),{},{exitDate:void 0})))},className:"block w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitDate?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),required:!0})]}),I.exitDate&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitDate}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitDateHint",{defaultValue:"Das Datum, an dem der Mitarbeiter die Organisation verl\xe4sst"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{htmlFor:"exitReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitReason",{defaultValue:"Austrittsgrund"})," *"]}),(0,P.jsx)("textarea",{id:"exitReason",value:L,onChange:e=>{z(e.target.value),I.exitReason&&F((e=>(0,m.A)((0,m.A)({},e),{},{exitReason:void 0})))},rows:4,className:"block w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitReason?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),placeholder:o("lifecycle.offboarding.exitReasonPlaceholder",{defaultValue:"z.B. K\xfcndigung, Vertragsende, etc."}),required:!0}),I.exitReason&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitReason}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitReasonHint",{defaultValue:"Mindestens 10 Zeichen. Beschreiben Sie den Grund f\xfcr den Austritt."})})]}),S&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,P.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:S})}),(0,P.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:r,disabled:v,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:o("common.cancel",{defaultValue:"Abbrechen"}),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed",title:v?o("common.saving",{defaultValue:"Speichern..."}):o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"}),children:v?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(A.A,{className:"h-5 w-5"})})]})]});return t?b?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,P.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4",children:B()})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!p&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,P.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:B()})]})]}):null},q=e=>{let{isOpen:t,onClose:r,onOffboardingCompleted:l,userId:n,userName:i,offboardingTasks:o}=e;const{t:d}=(0,s.Bd)(),{openSidepane:c,closeSidepane:u}=(0,R.N)(),{showMessage:m}=(0,k.A)(),[x,b]=(0,a.useState)(window.innerWidth<640),[h,p]=(0,a.useState)(window.innerWidth>1070),[y,v]=(0,a.useState)(!1),[j,A]=(0,a.useState)(null),[C,E]=(0,a.useState)(""),T=o.filter((e=>"done"===e.status)),L=o.length>0&&T.length===o.length,z=i.trim().toLowerCase();(0,a.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),p(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(c(),E(""),A(null)):u(),()=>{u()})),[t,c,u]);const I=async e=>{if(e.preventDefault(),C.trim().toLowerCase()===z||(A(d("lifecycle.offboarding.complete.confirmTextMismatch",{defaultValue:"Best\xe4tigungstext stimmt nicht \xfcberein"})),0)){v(!0),A(null);try{await w.A.put(N.Sn.LIFECYCLE.STATUS(n),{status:"archived"}),m(d("lifecycle.offboarding.complete.success",{defaultValue:"Offboarding erfolgreich abgeschlossen"}),"success"),l(),r()}catch(s){var t,a;console.error("Fehler beim Abschlie\xdfen des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||d("lifecycle.offboarding.complete.error",{defaultValue:"Fehler beim Abschlie\xdfen des Offboarding"});A(e),m(e,"error")}finally{v(!1)}}},F=()=>(0,P.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,P.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md flex items-center space-x-3",children:[(0,P.jsx)(S.A,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),(0,P.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[d("lifecycle.offboarding.complete.user",{defaultValue:"Mitarbeiter"}),": ",i]})]}),o.length>0&&(0,P.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-md",children:[(0,P.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:d("lifecycle.offboarding.complete.tasksStatus",{defaultValue:"Status der Offboarding-Aufgaben"})}),(0,P.jsx)("div",{className:"space-y-2",children:o.map((e=>{const t="done"===e.status;return(0,P.jsxs)("div",{className:"flex items-center space-x-2 text-sm ".concat(t?"text-green-700 dark:text-green-300":"text-orange-700 dark:text-orange-300"),children:[t?(0,P.jsx)(S.A,{className:"h-4 w-4 flex-shrink-0"}):(0,P.jsx)(M.A,{className:"h-4 w-4 flex-shrink-0"}),(0,P.jsx)("span",{children:e.title}),(0,P.jsx)("span",{className:"ml-auto text-xs",children:"(".concat(t?d("common.done",{defaultValue:"Abgeschlossen"}):d("common.open",{defaultValue:"Offen"}),")")})]},e.id)}))})]}),!L&&o.length>0&&(0,P.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 p-4",children:(0,P.jsxs)("div",{className:"flex",children:[(0,P.jsx)("div",{className:"flex-shrink-0",children:(0,P.jsx)(M.A,{className:"h-5 w-5 text-orange-400","aria-hidden":"true"})}),(0,P.jsxs)("div",{className:"ml-3",children:[(0,P.jsx)("h3",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:d("lifecycle.offboarding.complete.warningTitle",{defaultValue:"Nicht alle Aufgaben abgeschlossen"})}),(0,P.jsx)("div",{className:"mt-2 text-sm text-orange-700 dark:text-orange-200",children:(0,P.jsx)("p",{children:d("lifecycle.offboarding.complete.warningText",{defaultValue:"Es sind noch nicht alle Offboarding-Aufgaben abgeschlossen. Sie k\xf6nnen das Offboarding trotzdem abschlie\xdfen, aber es wird empfohlen, alle Aufgaben zuerst zu erledigen."})})})]})]})}),L&&(0,P.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 p-4",children:(0,P.jsxs)("div",{className:"flex",children:[(0,P.jsx)("div",{className:"flex-shrink-0",children:(0,P.jsx)(S.A,{className:"h-5 w-5 text-green-400","aria-hidden":"true"})}),(0,P.jsxs)("div",{className:"ml-3",children:[(0,P.jsx)("h3",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:d("lifecycle.offboarding.complete.allTasksCompleted",{defaultValue:"Alle Aufgaben abgeschlossen"})}),(0,P.jsx)("div",{className:"mt-2 text-sm text-green-700 dark:text-green-200",children:(0,P.jsx)("p",{children:d("lifecycle.offboarding.complete.allTasksCompletedText",{defaultValue:"Alle Offboarding-Aufgaben sind abgeschlossen. Sie k\xf6nnen das Offboarding jetzt abschlie\xdfen."})})})]})]})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{htmlFor:"confirmText",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("lifecycle.offboarding.complete.confirmLabel",{userName:i})||'Best\xe4tigen Sie durch Eingabe des Namens: "'.concat(i,'"')," *"]}),(0,P.jsx)("input",{type:"text",id:"confirmText",value:C,onChange:e=>{E(e.target.value),A(null)},className:"w-full px-3 py-2 border ".concat(j&&j.includes("Best\xe4tigung")?"border-red-500":"border-gray-300"," dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"),placeholder:i,required:!0}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:d("lifecycle.offboarding.complete.confirmHint",{defaultValue:"Geben Sie den vollst\xe4ndigen Namen des Mitarbeiters ein, um das Offboarding abzuschlie\xdfen"})})]}),(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsxs)("div",{className:"flex",children:[(0,P.jsx)("div",{className:"flex-shrink-0",children:(0,P.jsx)(M.A,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),(0,P.jsxs)("div",{className:"ml-3",children:[(0,P.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:d("lifecycle.offboarding.complete.finalWarningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,P.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-200",children:(0,P.jsx)("p",{children:d("lifecycle.offboarding.complete.finalWarningText",{defaultValue:"Durch das Abschlie\xdfen des Offboarding wird der Mitarbeiter archiviert. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})})]})]})}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:y,title:d("common.cancel",{defaultValue:"Abbrechen"}),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",className:"p-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y||C.trim().toLowerCase()!==z,title:y?d("common.saving",{defaultValue:"Speichern..."}):d("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"}),children:y?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(S.A,{className:"h-5 w-5"})})]})]});return t?x?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,P.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})}),(0,P.jsxs)("div",{className:"p-6",children:[j&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:j}),F()]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!h&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,P.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[j&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:j}),F()]})]})]}):null},W=e=>{var t;let{userId:r,userName:n}=e;const{t:o}=(0,s.Bd)(),{isHR:d,isAdmin:c}=(0,l.S)(),{showMessage:m}=(0,k.A)(),[g,x]=(0,a.useState)(null),[h,f]=(0,a.useState)([]),[v,j]=(0,a.useState)([]),[D,L]=(0,a.useState)([]),[R,I]=(0,a.useState)(!0),[V,M]=(0,a.useState)(null),[W,G]=(0,a.useState)(!1),[H,K]=(0,a.useState)(!1),[J,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(null),[$,Q]=(0,a.useState)(null),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(!1),[se,le]=(0,a.useState)(!1),[ne,ie]=(0,a.useState)(!1),[oe,de]=(0,a.useState)(""),[ce,ue]=(0,a.useState)(""),me=(0,a.useRef)(!1),ge=(0,a.useRef)(!0),xe=(0,a.useRef)(null),be=(0,a.useRef)(null),he=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!me.current||e)try{var t,a,s,l,n,i;me.current=!0,I(!0);const[e,o,d,c]=await Promise.all([w.A.get(N.Sn.LIFECYCLE.BY_USER(r)),w.A.get(N.Sn.LIFECYCLE.CERTIFICATES(r)),w.A.get(N.Sn.LIFECYCLE.CONTRACTS(r)),w.A.get(N.Sn.TASKS.BY_USER(r)).catch((()=>({data:[]})))]);if(!ge.current)return;x(e.data),f((null===(t=o.data)||void 0===t?void 0:t.certificates)||[]),j((null===(a=d.data)||void 0===a?void 0:a.contracts)||[]);const u=c.data||[],m=["Crear certificado laboral","Realizar liquidaci\xf3n final","Desafiliar de seguridad social"],g=u.filter((e=>m.includes(e.title)));L(g),"onboarding"===(null===(s=e.data)||void 0===s||null===(l=s.lifecycle)||void 0===l?void 0:l.status)&&100===(null===(n=e.data)||void 0===n||null===(i=n.progress)||void 0===i?void 0:i.percent)&&(be.current=setTimeout((()=>{ge.current&&he()}),1e3)),M(null)}catch(c){var o,d;if(!ge.current)return;console.error("Fehler beim Laden der Lebenszyklus-Daten:",c),M((null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.message)||"Fehler beim Laden der Daten"),m("Fehler beim Laden der Daten","error")}finally{I(!1),me.current=!1}else xe.current=setTimeout((()=>{!me.current&&ge.current&&he(!0)}),500)}),[r]);(0,a.useEffect)((()=>(ge.current=!0,me.current=!1,he(),()=>{ge.current=!1,xe.current&&clearTimeout(xe.current),be.current&&clearTimeout(be.current)})),[he]);const pe=()=>{null!==g&&void 0!==g&&g.lifecycle&&(de(g.lifecycle.contractStartDate?new Date(g.lifecycle.contractStartDate).toISOString().split("T")[0]:""),ue(g.lifecycle.contractEndDate?new Date(g.lifecycle.contractEndDate).toISOString().split("T")[0]:""),ie(!0))},ye=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"});if(R)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,P.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(V)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,P.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:V})})});if(!g)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:o("lifecycle.noData",{defaultValue:"Keine Lebenszyklus-Daten verf\xfcgbar"})})});(null===(t=g.lifecycle)||void 0===t?void 0:t.socialSecurityRegistrations)||g.socialSecurityRegistrations;const{lifecycle:fe,progress:ve}=g;return(0,P.jsxs)("div",{className:"space-y-6",children:[(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,P.jsx)(y.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.statusTitle")]}),(0,P.jsxs)("div",{className:"flex items-center space-x-3",children:[function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r={onboarding:{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",labelKey:"lifecycle.status.onboarding"},active:{color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",labelKey:"lifecycle.status.active"},contract_change:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",labelKey:"lifecycle.status.contract_change"},offboarding:{color:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",labelKey:"lifecycle.status.offboarding"},archived:{color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",labelKey:"lifecycle.status.archived"}}[e]||{color:"bg-gray-100 text-gray-800",labelKey:e};return(0,P.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(r.color," ").concat(t?"cursor-pointer hover:opacity-80":""),children:o(r.labelKey)||e})}(fe.status),(d()||c())&&"active"===fe.status&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>ae(!0),className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:(0,P.jsx)(A.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"})})]}),(d()||c())&&"offboarding"===fe.status&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>le(!0),className:"p-2 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:(0,P.jsx)(S.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"})})]})]})]}),(0,P.jsxs)("div",{className:"space-y-2 text-sm",children:[fe.onboardingStartedAt&&(0,P.jsxs)("div",{className:"flex justify-between",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingStarted")}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.onboardingStartedAt).toLocaleDateString("de-DE")})]}),fe.onboardingCompletedAt&&(0,P.jsxs)("div",{className:"flex justify-between",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingCompleted")}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.onboardingCompletedAt).toLocaleDateString("de-DE")})]}),(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractStart")}),(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[fe.contractStartDate?(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.contractStartDate).toLocaleDateString("de-DE")}):(0,P.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>pe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",children:(0,P.jsx)(C.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit",{defaultValue:"Bearbeiten"})})]})]})]}),(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractEnd")}),(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[fe.contractEndDate?(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.contractEndDate).toLocaleDateString("de-DE")}):(0,P.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>pe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",children:(0,P.jsx)(C.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit",{defaultValue:"Bearbeiten"})})]})]})]}),fe.offboardingStartedAt&&(0,P.jsxs)("div",{className:"flex justify-between",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboardingStarted")}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.offboardingStartedAt).toLocaleDateString("de-DE")})]}),fe.exitDate&&(0,P.jsxs)("div",{className:"flex justify-between",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitDate")}),(0,P.jsx)("span",{className:"dark:text-white",children:new Date(fe.exitDate).toLocaleDateString("de-DE")})]}),fe.exitReason&&(0,P.jsxs)("div",{className:"flex justify-between",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitReason")}),(0,P.jsx)("span",{className:"dark:text-white",children:fe.exitReason})]})]})]}),"onboarding"===fe.status&&(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.progressTitle")}),(0,P.jsxs)("div",{className:"space-y-2",children:[(0,P.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.progressSteps",{completed:ve.completed,total:ve.total})}),(0,P.jsxs)("span",{className:"font-medium dark:text-white",children:[ve.percent,"%"]})]}),(0,P.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,P.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(ve.percent,"%")}})})]})]}),"offboarding"===fe.status&&(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.offboarding.progressTitle",{defaultValue:"Offboarding-Fortschritt"})}),(0,P.jsxs)("div",{className:"space-y-4",children:[(()=>{const e=D.filter((e=>"done"===e.status)).length,t=D.length||3,r=t>0?Math.round(e/t*100):0;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,P.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboarding.progressSteps",{completed:e,total:t})||"".concat(e," von ").concat(t," Schritten abgeschlossen")}),(0,P.jsxs)("span",{className:"font-medium dark:text-white",children:[r,"%"]})]}),(0,P.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,P.jsx)("div",{className:"bg-orange-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(r,"%")}})})]})})(),D.length>0&&(0,P.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,P.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("lifecycle.offboarding.tasksTitle",{defaultValue:"Offboarding-Aufgaben"})}),D.map((e=>{const t="done"===e.status;return(0,P.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border ".concat(t?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[(0,P.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[t?(0,P.jsx)(S.A,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):(0,P.jsx)(E.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 flex-shrink-0"}),(0,P.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,P.jsx)("p",{className:"text-sm font-medium ".concat(t?"text-green-800 dark:text-green-200":"text-gray-800 dark:text-gray-200"),children:e.title}),e.description&&(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 truncate",children:e.description})]})]}),(0,P.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(t?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200"),children:t?o("common.done",{defaultValue:"Abgeschlossen"}):o("common.open",{defaultValue:"Offen"})})]},e.id)}))]})]})]}),(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,P.jsx)(p.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.certificates")]}),(d()||c())&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>G(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":o("lifecycle.createCertificate"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.createCertificate")})]})]}),0===h.length?(0,P.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,P.jsx)(p.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,P.jsx)("p",{children:o("lifecycle.noCertificates")})]}):(0,P.jsx)("div",{className:"space-y-4",children:h.map((e=>(0,P.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,P.jsxs)("div",{className:"flex items-start justify-between",children:[(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,P.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.certificate"),"employment"!==e.certificateType&&" (".concat(e.certificateType,")")]}),e.isLatest&&(0,P.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,P.jsx)(S.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,P.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(u.A,{className:"h-4 w-4"}),(0,P.jsxs)("span",{children:[o("lifecycle.issuedOn")," ",ye(e.issueDate)]})]}),e.generatedByUser&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(i.A,{className:"h-4 w-4"}),(0,P.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,P.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>Y(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",children:(0,P.jsx)(C.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit")})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>(async e=>{Q(e);try{const t=await w.A.get(N.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(r,e),{responseType:"blob"}),a=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="arbeitszeugnis-".concat(e,".pdf"),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(s),m("Arbeitszeugnis erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitszeugnisses","error")}finally{Q(null)}})(e.id),disabled:$===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",children:$===e.id?(0,P.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,P.jsx)(T.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.download")})]})]})]})},e.id)))})]}),(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsxs)("div",{className:"flex items-center mb-4",children:[(d()||c())&&(0,P.jsxs)("div",{className:"relative group mr-3",children:[(0,P.jsx)("button",{onClick:()=>K(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":o("lifecycle.createContract"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.createContract")})]}),(0,P.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,P.jsx)(p.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.contracts")]})]}),0===v.length?(0,P.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,P.jsx)(p.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,P.jsx)("p",{children:o("lifecycle.noContracts")})]}):(0,P.jsx)("div",{className:"space-y-4",children:v.map((e=>(0,P.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,P.jsxs)("div",{className:"flex items-start justify-between",children:[(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,P.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.contract"),"employment"!==e.contractType&&" (".concat(e.contractType,")")]}),e.isLatest&&(0,P.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,P.jsx)(S.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,P.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(u.A,{className:"h-4 w-4"}),(0,P.jsxs)("span",{children:[ye(e.startDate),e.endDate&&" - ".concat(ye(e.endDate))]})]}),e.position&&(0,P.jsxs)("div",{children:[o("lifecycle.position")," ",e.position]}),e.salary&&(0,P.jsxs)("div",{children:[o("lifecycle.salary")," ",e.salary.toLocaleString("de-DE",{style:"currency",currency:"EUR"})]}),e.workingHours&&(0,P.jsxs)("div",{children:[o("lifecycle.workingHours")," ",e.workingHours,"h/Woche"]}),e.generatedByUser&&(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)(i.A,{className:"h-4 w-4"}),(0,P.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,P.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>X(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",children:(0,P.jsx)(C.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.edit")})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>(async e=>{te(e);try{const t=await w.A.get(N.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(r,e),{responseType:"blob"}),a=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="arbeitsvertrag-".concat(e,".pdf"),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(s),m("Arbeitsvertrag erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitsvertrags","error")}finally{te(null)}})(e.id),disabled:ee===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",children:ee===e.id?(0,P.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,P.jsx)(T.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("lifecycle.download")})]})]})]})},e.id)))})]}),(null===g||void 0===g?void 0:g.lifecycle)&&(0,P.jsx)(O,{userId:r,lifecycleId:g.lifecycle.id,onUpdate:()=>he(!0)}),(0,P.jsx)(z,{isOpen:W,onClose:()=>G(!1),onCertificateCreated:()=>{he(),G(!1)},userId:r,userName:n}),(0,P.jsx)(F,{isOpen:H,onClose:()=>K(!1),onContractCreated:()=>{he(),K(!1)},userId:r,userName:n}),J&&(0,P.jsx)(_,{isOpen:!!J,onClose:()=>Y(null),onCertificateUpdated:()=>{he(),Y(null)},userId:r,certificate:J}),Z&&(0,P.jsx)(B,{isOpen:!!Z,onClose:()=>X(null),onContractUpdated:()=>{he(),X(null)},userId:r,contract:Z}),(0,P.jsx)(U,{isOpen:re,onClose:()=>ae(!1),onOffboardingStarted:()=>{he(),ae(!1)},userId:r,userName:n}),(0,P.jsx)(q,{isOpen:se,onClose:()=>le(!1),onOffboardingCompleted:()=>{he(),le(!1)},userId:r,userName:n,offboardingTasks:D}),ne&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[(0,P.jsx)("h2",{className:"text-xl font-semibold dark:text-white mb-4",children:o("lifecycle.editContractDates",{defaultValue:"Vertragsdaten bearbeiten"})}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractStart",{defaultValue:"Vertragsbeginn"})," *"]}),(0,P.jsx)("input",{type:"date",value:oe,onChange:e=>de(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractEnd",{defaultValue:"Vertragsende"})," (optional)"]}),(0,P.jsx)("input",{type:"date",value:ce,onChange:e=>ue(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.contractEndHint",{defaultValue:"Nur bei befristeten Vertr\xe4gen ausf\xfcllen"})})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,P.jsx)("button",{onClick:()=>ie(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:o("common.cancel",{defaultValue:"Abbrechen"})}),(0,P.jsx)("button",{onClick:async()=>{try{await w.A.put(N.Sn.LIFECYCLE.STATUS(r),{status:(null===g||void 0===g?void 0:g.lifecycle.status)||"active",contractStartDate:oe||null,contractEndDate:ce||null}),m("Vertragsdaten erfolgreich aktualisiert","success"),ie(!1),he()}catch(e){console.error("Fehler beim Speichern der Vertragsdaten:",e),m("Fehler beim Speichern der Vertragsdaten","error")}},disabled:!oe,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o("common.save",{defaultValue:"Speichern"})})]})]})})]})};var G=r(3700),H=r(6507),K=r(8018);const J=[{code:"tiempo_completo",name:"Tiempo Completo (>21 Tage/Monat)"},{code:"tiempo_parcial_7",name:"Tiempo Parcial (\u22647 Tage/Monat)"},{code:"tiempo_parcial_14",name:"Tiempo Parcial (\u226414 Tage/Monat)"},{code:"tiempo_parcial_21",name:"Tiempo Parcial (\u226421 Tage/Monat)"},{code:"prestacion_de_servicios",name:"Prestaci\xf3n de Servicios"},{code:"externo",name:"Externo"}],Y=()=>{const{t:e}=(0,s.Bd)(),{handleError:t}=(0,H.qz)(),r=[{code:"CO",name:e("countries.CO")},{code:"CH",name:e("countries.CH")},{code:"DE",name:e("countries.DE")},{code:"AT",name:e("countries.AT")}],n=[{code:"CH",name:e("countries.CH")},{code:"CO",name:e("countries.CO")}],i=[{code:"es",name:e("languages.es")},{code:"de",name:e("languages.de")},{code:"en",name:e("languages.en")}],[c,u]=(0,a.useState)([]),[w,N]=(0,a.useState)(null),[A,S]=(0,a.useState)({}),[C,E]=(0,a.useState)(!1),[T,D]=(0,a.useState)([]),[L,z]=(0,a.useState)(0),[I,F]=(0,a.useState)(!1),[_,B]=(0,a.useState)(null),{showMessage:V}=(0,k.A)(),{isAdmin:O}=(0,l.S)(),[M,U]=(0,a.useState)([]),[q,Y]=(0,a.useState)(!1),[Z,X]=(0,a.useState)([]),[$,Q]=(0,a.useState)(!1),[ee,te]=(0,a.useState)([]),[re,ae]=(0,a.useState)("details"),[se,le]=(0,a.useState)("active"),[ne,ie]=(0,a.useState)(!1),oe=(0,a.useRef)(null),[de,ce]=(0,a.useState)(!1),[ue,me]=(0,a.useState)(window.innerWidth<640),[ge,xe]=(0,a.useState)(window.innerWidth>1070),{openSidepane:be,closeSidepane:he}=(0,R.N)(),[pe,ye]=(0,a.useState)({email:"",password:"",firstName:"",lastName:""});(0,a.useEffect)((()=>{const e=()=>{me(window.innerWidth<640),xe(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(de?be():he(),()=>{he()})),[de,be,he]);const[fe,ve]=(0,a.useState)([]);(0,a.useEffect)((()=>{ke()}),[]);const ke=async()=>{try{const e=await x.i$.getAll();ve(e.data),je("active",e.data)}catch(e){Ne(e)}},je=function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:fe).filter((t=>{const r=void 0===t.active||t.active;return"active"===e?r:!r})).sort(((e,t)=>{const r=(e.username||"").toLowerCase(),a=(t.username||"").toLowerCase(),s=(e.firstName||"").toLowerCase(),l=(t.firstName||"").toLowerCase();return r!==a?r.localeCompare(a):s.localeCompare(l)}));u(t)};(0,a.useEffect)((()=>{fe.length>0&&je(se,fe)}),[se]);const we=async e=>{try{if(!e||isNaN(e))return void N(null);K.v.log("Lade Benutzerdetails f\xfcr ID:",e);const t=await x.i$.getById(e),r=(0,m.A)((0,m.A)({},t.data),{},{active:void 0===t.data.active||t.data.active,birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});let a=[];t.data.roles&&Array.isArray(t.data.roles)?(K.v.log("Rollenstruktur (Typ):",typeof t.data.roles,"L\xe4nge:",t.data.roles.length),t.data.roles.length>0&&t.data.roles[0].role?(a=t.data.roles.map((e=>e.role.id)),K.v.log("Extrahierte Rollen-IDs aus verschachtelter Struktur:",a)):t.data.roles.length>0&&("number"===typeof t.data.roles[0]?a=t.data.roles:t.data.roles[0].roleId?a=t.data.roles.map((e=>e.roleId)):t.data.roles[0].id&&(a=t.data.roles.map((e=>e.id))))):console.warn("Rollen fehlen oder sind kein Array:",t.data.roles),0===a.length&&t.data.role&&(K.v.log("Versuche Rollen aus role-Eigenschaft zu extrahieren:",t.data.role),Array.isArray(t.data.role)?a=t.data.role.map((e=>e.id)):"object"===typeof t.data.role&&null!==t.data.role&&(a=[t.data.role.id])),K.v.log("Endg\xfcltige extrahierte Rollen-IDs:",a);let s=[];t.data.branches&&Array.isArray(t.data.branches)?(K.v.log("Branches-Struktur (Typ):",typeof t.data.branches,"L\xe4nge:",t.data.branches.length),t.data.branches.length>0&&t.data.branches[0].branch?(s=t.data.branches.map((e=>e.branch.id)),K.v.log("Extrahierte Branch-IDs aus verschachtelter Struktur:",s)):t.data.branches.length>0&&("number"===typeof t.data.branches[0]?s=t.data.branches:t.data.branches[0].branchId?s=t.data.branches.map((e=>e.branchId)):t.data.branches[0].id&&(s=t.data.branches.map((e=>e.id))))):console.warn("Branches fehlen oder sind kein Array:",t.data.branches),K.v.log("Endg\xfcltige extrahierte Branch-IDs:",s),N(r),S(r),D(a),te(s),0===M.length&&await(async()=>{try{Y(!0);const t=[{id:1,name:"admin",description:"Administrator mit allen Rechten",permissions:[]},{id:2,name:"user",description:"Standardbenutzer",permissions:[]},{id:999,name:"hamburger",description:"Hamburger-Rolle f\xfcr neue Benutzer",permissions:[]}];try{const e=await x.Zj.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(U(e.data),K.v.log("".concat(e.data.length," Rollen erfolgreich geladen"))):(console.warn("Keine Rollen vom Server erhalten, verwende Fallback"),U(t))}catch(e){console.warn("Fehler beim Laden der Rollen, verwende Fallback:",e),U(t)}}finally{Y(!1)}})(),0===Z.length&&await(async()=>{try{Q(!0);try{const e=await x.H_.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(X(e.data),K.v.log("".concat(e.data.length," Branches erfolgreich geladen"))):(console.warn("Keine Branches vom Server erhalten"),X([]))}catch(e){console.warn("Fehler beim Laden der Branches:",e),X([])}}finally{Q(!1)}})()}catch(t){console.error("Fehler beim Laden der Benutzerdetails:",t),Ne(t)}},Ne=e=>{var r,a;let s="Ein Fehler ist aufgetreten";null!==(r=e.response)&&void 0!==r&&null!==(a=r.data)&&void 0!==a&&a.message?s=e.response.data.message:e instanceof Error&&(s=e.message),!s.includes("Ung\xfcltige Rollen-ID")||w?t({message:s}):console.warn("Fehler unterdr\xfcckt, da kein Benutzer ausgew\xe4hlt ist:",s)},Ae=e=>{const{name:t,value:r,type:a}=e.target;let s=r;"number"===a&&(s=""===r?null:Number(r)),S((0,m.A)((0,m.A)({},A),{},{[t]:s})),E(!0)},Se=async e=>{if(e&&w)if(1===e&&1===w.id&&T.includes(e))V("Die Admin-Rolle kann vom Admin-Benutzer nicht entfernt werden","warning");else try{K.v.log("Toggle Rolle:",e,"f\xfcr Benutzer:",w.id),K.v.log("Aktuelle ausgew\xe4hlte Rollen:",T);const t=T.includes(e),r=t?T.filter((t=>t!==e)):[...T,e];K.v.log("Neue ausgew\xe4hlte Rollen:",r),D(r),K.v.log("Sende Rollenaktualisierung an API:",{userId:w.id,roleIds:r});const a=await x.i$.updateRoles(w.id,r);K.v.log("API-Antwort bei Rollenaktualisierung:",a.data),await we(w.id),V(t?"Rolle erfolgreich entfernt":"Rolle erfolgreich zugewiesen","success")}catch(t){console.error("Fehler beim Aktualisieren der Rollen:",t),we(w.id),Ne(t),V("Fehler beim Aktualisieren der Rollen","error")}},Ce=async e=>{if(e&&w)try{K.v.log("Toggle Branch:",e,"f\xfcr Benutzer:",w.id),K.v.log("Aktuelle ausgew\xe4hlte Branches:",ee);const t=ee.includes(e),r=t?ee.filter((t=>t!==e)):[...ee,e];K.v.log("Neue ausgew\xe4hlte Branches:",r),te(r),K.v.log("Sende Branch-Aktualisierung an API:",{userId:w.id,branchIds:r});const a=await x.i$.updateBranches(w.id,r);K.v.log("API-Antwort bei Branch-Aktualisierung:",a.data),await we(w.id),V(t?"Branch erfolgreich entfernt":"Branch erfolgreich zugewiesen","success")}catch(t){console.error("Fehler beim Aktualisieren der Branches:",t),we(w.id),Ne(t),V("Fehler beim Aktualisieren der Branches","error")}};(0,a.useEffect)((()=>{w&&(S((0,m.A)((0,m.A)({},w),{},{birthday:w.birthday?new Date(w.birthday).toISOString().split("T")[0]:null})),E(!1))}),[w]);const Ee=e=>{const{name:t,value:r}=e.target;ye((0,m.A)((0,m.A)({},pe),{},{[t]:r}))},Te=async e=>{if(e.preventDefault(),pe.email&&pe.password&&pe.firstName&&pe.lastName)if(pe.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/))try{const e=await x.i$.create(pe);if(e.data){const t=(0,m.A)((0,m.A)({},e.data),{},{active:void 0===e.data.active||e.data.active});ve((e=>[t,...e])),"active"===se&&t.active&&u((e=>[t,...e]))}V("Benutzer erfolgreich erstellt","success"),ce(!1),ye({email:"",password:"",firstName:"",lastName:""})}catch(s){var r,a;await ke();const e=(null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Fehler beim Erstellen des Benutzers";V(e,"error"),t({message:e})}else V("Ung\xfcltiges E-Mail-Format","error");else V("Bitte f\xfcllen Sie alle Felder aus","error")};return(0,P.jsxs)("div",{className:"container mx-auto px-4 pb-6",children:[(0,P.jsx)("div",{className:"mb-6",children:(0,P.jsxs)("div",{className:"flex items-start gap-4",children:[(0,P.jsx)("div",{className:"flex items-center pt-8",children:O()&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>ce(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("users.create"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("users.create")})]})}),(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,P.jsx)("button",{type:"button",onClick:()=>le("active"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("active"===se?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:e("users.active")}),(0,P.jsx)("button",{type:"button",onClick:()=>le("inactive"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("inactive"===se?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:e("users.inactive")})]}),(0,P.jsxs)("select",{id:"userSelect",onChange:e=>{const t=parseInt(e.target.value,10);t&&!isNaN(t)?we(t):(N(null),S({}),D([]))},className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",children:[(0,P.jsxs)("option",{value:"",children:["-- ",e("common.select")," --"]}),c.map((e=>(0,P.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.username,")"]},e.id)))]})]})]})}),w&&(0,P.jsx)("div",{children:(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 mb-6",children:[(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,P.jsxs)("nav",{className:"flex -mb-px",children:[(0,P.jsxs)("button",{onClick:()=>ae("details"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("details"===re?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,P.jsx)(h.A,{className:"h-5 w-5 inline mr-2"}),e("users.title")]}),(0,P.jsxs)("button",{onClick:()=>ae("documents"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("documents"===re?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,P.jsx)(p.A,{className:"h-5 w-5 inline mr-2"}),e("profile.documents")]}),(0,P.jsxs)("button",{onClick:()=>ae("roles"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("roles"===re?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,P.jsx)(o.A,{className:"h-5 w-5 inline mr-2"}),e("roles.title")]}),(0,P.jsxs)("button",{onClick:()=>ae("branches"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("branches"===re?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,P.jsx)(d.A,{className:"h-5 w-5 inline mr-2"}),e("branches.title")||"Niederlassungen"]}),(0,P.jsxs)("button",{onClick:()=>ae("lifecycle"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("lifecycle"===re?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,P.jsx)(y.A,{className:"h-5 w-5 inline mr-2"}),e("lifecycle.tabTitle")]})]})}),"details"===re&&(0,P.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!w||!w.id)return t({message:"Kein Benutzer ausgew\xe4hlt"}),void V("Kein Benutzer ausgew\xe4hlt","error");try{var r,a;if(null===(r=A.username)||void 0===r||!r.trim())throw new Error("Benutzername ist erforderlich");if(null===(a=A.email)||void 0===a||!a.trim())throw new Error("E-Mail ist erforderlich");const e={username:A.username,email:A.email,bankDetails:A.bankDetails||null,gender:A.gender||null,phoneNumber:A.phoneNumber||null,language:A.language||null,hourlyRate:null===A.hourlyRate||void 0===A.hourlyRate||""===A.hourlyRate?null:"string"===typeof A.hourlyRate?A.hourlyRate:A.hourlyRate.toString(),monthlySalary:null===A.monthlySalary||void 0===A.monthlySalary||""===A.monthlySalary?null:"string"===typeof A.monthlySalary?parseFloat(A.monthlySalary):A.monthlySalary,payrollCountry:A.payrollCountry||null,contractType:A.contractType||null};K.v.log("Sende Daten zum Server:",e);const t=await x.i$.update(w.id,e);if(t.data){const e=(0,m.A)((0,m.A)({},t.data),{},{birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});N(e),S((0,m.A)((0,m.A)({},e),{},{birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null})),ve((t=>t.map((t=>t.id===e.id?e:t)))),je(se,fe.map((t=>t.id===e.id?e:t))),V("Benutzerprofil erfolgreich aktualisiert","success"),E(!1)}}catch(o){var s,l;if(console.error("Fehler beim Speichern der Benutzerdaten:",o),await ke(),400===(null===(s=o.response)||void 0===s?void 0:s.status)){var n,i;const e="Validierungsfehler: ".concat((null===(n=o.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Bitte \xfcberpr\xfcfe die eingegebenen Daten");t({message:e}),V(e,"error")}else 404===(null===(l=o.response)||void 0===l?void 0:l.status)?(t({message:"Benutzer wurde nicht gefunden"}),V("Benutzer wurde nicht gefunden","error")):Ne(o)}},className:"p-6",children:[(0,P.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.username")}),(0,P.jsx)("input",{type:"text",name:"username",value:A.username||"",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.email")}),(0,P.jsx)("input",{type:"email",name:"email",value:A.email||"",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("profile.language")," ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsx)("select",{name:"language",value:A.language||"es",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0,children:i.map((e=>(0,P.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),w&&(0,P.jsx)("div",{className:"sm:col-span-2",children:(0,P.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-1",children:e("profile.identificationDocument",{defaultValue:"Identifikationsdokument"})}),(0,P.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:e("profile.uploadDocumentHint",{defaultValue:"Bitte laden Sie das Identifikationsdokument (C\xe9dula oder Pasaporte) hoch. Die Felder werden automatisch ausgef\xfcllt."})})]}),(0,P.jsx)("input",{type:"file",id:"documentUploadUserManagement",accept:"image/*",className:"hidden",onChange:async t=>{if(!t.target.files||0===t.target.files.length)return;if(!w)return;ie(!0);await(0,G.e)(t.target.files[0],w.id,(async()=>{var t;await we(w.id),await new Promise((e=>setTimeout(e,500))),null===(t=oe.current)||void 0===t||t.loadDocuments(),V(e("profile.documentUploadSuccess",{defaultValue:"Dokument erfolgreich hochgeladen. Felder werden automatisch ausgef\xfcllt."}),"success")}),(e=>{V(e,"error")}));ie(!1),t.target.value=""},disabled:ne}),(0,P.jsx)("label",{htmlFor:"documentUploadUserManagement",className:"p-2 text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer ".concat(ne?"opacity-50 cursor-not-allowed":""),title:e("profile.uploadDocument",{defaultValue:"Dokument hochladen"}),children:(0,P.jsx)(p.A,{className:"h-5 w-5"})})]})})}),(w.firstName||w.lastName||w.birthday||w.identificationNumber)&&(0,P.jsx)(P.Fragment,{children:(t=>{const a=w.identificationDocuments&&w.identificationDocuments.length>0?w.identificationDocuments[0]:null;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.firstName")}),(0,P.jsx)("input",{type:"text",value:w.firstName||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.lastName")}),(0,P.jsx)("input",{type:"text",value:w.lastName||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.birthday")}),(0,P.jsx)("input",{type:"text",value:w.birthday?new Date(w.birthday).toISOString().split("T")[0]:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.country")}),(0,P.jsx)("input",{type:"text",value:w.country?(null===(t=r.find((e=>e.code===w.country)))||void 0===t?void 0:t.name)||w.country:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.gender")}),(0,P.jsxs)("select",{name:"gender",value:A.gender||"",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:e("profile.selectGender")}),(0,P.jsx)("option",{value:"male",children:e("profile.genderMale")}),(0,P.jsx)("option",{value:"female",children:e("profile.genderFemale")}),(0,P.jsx)("option",{value:"other",children:e("profile.genderOther")})]})]}),a&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.identificationType")}),(0,P.jsx)("input",{type:"text",value:a.documentType?{passport:e("identificationDocuments.types.passport"),national_id:e("identificationDocuments.types.national_id"),driving_license:e("identificationDocuments.types.driving_license"),residence_permit:e("identificationDocuments.types.residence_permit"),work_permit:e("identificationDocuments.types.work_permit"),tax_id:e("identificationDocuments.types.tax_id"),social_security:e("identificationDocuments.types.social_security")}[a.documentType]||a.documentType:"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(w.identificationNumber||(null===a||void 0===a?void 0:a.documentNumber))&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.identificationNumber")}),(0,P.jsx)("input",{type:"text",value:w.identificationNumber||(null===a||void 0===a?void 0:a.documentNumber)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(null===a||void 0===a?void 0:a.issueDate)&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.identificationIssueDate")||"Ausstellungsdatum"}),(0,P.jsx)("input",{type:"text",value:new Date(a.issueDate).toISOString().split("T")[0],disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(null===a||void 0===a?void 0:a.expiryDate)&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.identificationExpiryDate")}),(0,P.jsx)("input",{type:"text",value:new Date(a.expiryDate).toISOString().split("T")[0],disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(null===a||void 0===a?void 0:a.issuingCountry)&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.issuingCountry")}),(0,P.jsx)("input",{type:"text",value:a.issuingCountry,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]}),(null===a||void 0===a?void 0:a.issuingAuthority)&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.issuingAuthority")}),(0,P.jsx)("input",{type:"text",value:a.issuingAuthority,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white bg-gray-100 dark:bg-gray-800",readOnly:!0})]})]})})()}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.phoneNumber")}),(0,P.jsx)("input",{type:"tel",name:"phoneNumber",value:A.phoneNumber||"",onChange:Ae,placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e("profile.phoneNumberHint")})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("profile.bankDetails")}),(0,P.jsx)("input",{type:"text",name:"bankDetails",value:A.bankDetails||"",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("users.form.payrollSettings")}),(0,P.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.payrollCountry")}),(0,P.jsx)("select",{name:"payrollCountry",value:A.payrollCountry||w.payrollCountry||"CH",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:n.map((e=>(0,P.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),("CO"===A.payrollCountry||"CO"===w.payrollCountry&&!A.payrollCountry)&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("users.form.contractType")}),(0,P.jsxs)("select",{name:"contractType",value:A.contractType||"",onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:"Bitte ausw\xe4hlen"}),J.map((e=>(0,P.jsx)("option",{value:e.code,children:e.name},e.code)))]})]})]}),(0,P.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("users.form.hourlyRate")," (","CH"===(A.payrollCountry||w.payrollCountry)?"CHF":"COP",")"]}),(0,P.jsx)("input",{type:"number",name:"hourlyRate",min:"0",step:"CH"===(A.payrollCountry||w.payrollCountry)?"0.05":"1",value:null===A.hourlyRate||void 0===A.hourlyRate?"":A.hourlyRate,onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"CH"===(A.payrollCountry||w.payrollCountry)?"z.B. 45.00":"z.B. 50000"})]}),("CO"===A.payrollCountry||"CO"===w.payrollCountry)&&"servicios_externos"!==A.contractType&&"servicios_externos"!==w.contractType&&(A.contractType||w.contractType)&&(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("users.form.monthlySalary")," (COP)"]}),(0,P.jsx)("input",{type:"number",name:"monthlySalary",min:"0",step:"1000",value:null===A.monthlySalary||void 0===A.monthlySalary?"":A.monthlySalary,onChange:Ae,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 3500000"})]})]})]}),C&&(0,P.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:()=>{w&&S((0,m.A)((0,m.A)({},w),{},{birthday:w.birthday?new Date(w.birthday).toISOString().split("T")[0]:null})),E(!1)},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.cancel")})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.save")})]})]}),(0,P.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[void 0!==w.active&&(0,P.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(w.active?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"),children:w.active?e("users.active"):e("users.inactive")}),O()&&(0,P.jsx)("button",{onClick:async()=>{if(!w||!w.id)return void V("Kein Benutzer ausgew\xe4hlt","error");const e=parseInt(localStorage.getItem("userId")||"0",10);if(w.id!==e)try{const e=void 0===w.active||w.active,t=!e;K.v.log("Toggle active:",{currentActiveStatus:e,newActiveStatus:t,selectedUser:w,selectedUserActive:w.active,userId:w.id});const r={active:t};K.v.log("Sending update payload:",r,"Type of active:",typeof t);const a=await x.i$.update(w.id,r);if(K.v.log("Update response:",a.data),a.data){const e=(0,m.A)((0,m.A)({},a.data),{},{active:void 0===a.data.active||a.data.active,birthday:a.data.birthday?new Date(a.data.birthday).toISOString().split("T")[0]:null});K.v.log("Updated user data:",e),N(e),S((0,m.A)((0,m.A)({},e),{},{birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null}));const r=fe.map((t=>t.id===e.id?e:t));ve(r),je(se,r),V(t?"Benutzer erfolgreich aktiviert":"Benutzer erfolgreich deaktiviert","success")}}catch(t){console.error("Fehler beim Aktivieren/Deaktivieren des Benutzers:",t),Ne(t),await ke()}else V("Du kannst dich nicht selbst deaktivieren","warning")},className:"relative group flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(w.active?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/20 dark:text-green-400 dark:hover:bg-green-900/30"),children:w.active?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f.A,{className:"h-5 w-5"}),e("users.deactivate")]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(v.A,{className:"h-5 w-5"}),e("users.activate")]})})]})]}),"documents"===re&&(0,P.jsx)("div",{className:"p-6",children:(0,P.jsx)(j.A,{userId:w.id,isAdmin:!0,ref:oe})}),"roles"===re&&(0,P.jsx)("div",{className:"p-6",children:q?(0,P.jsxs)("div",{className:"mt-4 mb-4",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("roleAssignment.title")}),(0,P.jsx)("p",{className:"dark:text-gray-300",children:e("roleAssignment.loading")})]}):M.length>0&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("roleAssignment.title")}),T.some((e=>!M.some((t=>t.id===e))))&&(0,P.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,P.jsx)("p",{className:"font-bold",children:e("roleAssignment.unknownRolesWarning")}),(0,P.jsx)("p",{children:e("roleAssignment.unknownRolesMessage",{ids:T.filter((e=>!M.some((t=>t.id===e)))).join(", ")})}),(0,P.jsx)("p",{className:"mt-2 text-sm",children:e("roleAssignment.availableRoleIds",{ids:M.map((e=>e.id)).join(", ")})})]}),(0,P.jsxs)("div",{className:"mb-4",children:[(0,P.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("roleAssignment.currentRoles")}),0===T.length?(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:e("roleAssignment.noRolesAssigned")}):(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[M.filter((e=>T.includes(e.id))).map((t=>{const r=1===t.id&&w&&1===w.id;return(0,P.jsx)("div",{className:"border rounded-lg p-4 ".concat(r?"border-green-500 bg-green-50 dark:bg-green-900/20 dark:border-green-700 cursor-not-allowed":"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 cursor-pointer"),onClick:()=>!r&&Se(t.id),children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("h4",{className:"font-medium flex items-center dark:text-white",children:[t.name,r&&(0,P.jsx)("span",{className:"ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded-full",children:e("roleAssignment.fixed")})]}),(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description})]}),(0,P.jsxs)("div",{className:"flex items-center ".concat(r?"text-gray-400 dark:text-gray-500":"text-blue-600 dark:text-blue-400"),children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e(r?"roleAssignment.fixedAssigned":"roleAssignment.remove")}),(0,P.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,P.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},t.id)})),T.filter((e=>!M.some((t=>t.id===e)))).map((t=>(0,P.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"font-medium",children:e("roleAssignment.unknownRole",{id:t})}),(0,P.jsx)("p",{className:"text-sm text-orange-600",children:e("roleAssignment.unknownRoleDescription")})]}),(0,P.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e("roleAssignment.remove")}),(0,P.jsx)("button",{onClick:()=>Se(t),className:"focus:outline-none",children:(0,P.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,P.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},"unknown-".concat(t))))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("roleAssignment.availableRoles")}),0===M.filter((e=>!T.includes(e.id))).length?(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:e("roleAssignment.noRolesAvailable")}):(0,P.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.filter((e=>!T.includes(e.id))).map((t=>(0,P.jsx)("div",{className:"border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50",onClick:()=>Se(t.id),children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"font-medium",children:t.name}),(0,P.jsx)("p",{className:"text-sm text-gray-600",children:t.description})]}),(0,P.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600",children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e("roleAssignment.add")}),(0,P.jsx)(b.A,{className:"h-5 w-5"})]})]})},t.id)))})]})]})}),"branches"===re&&(0,P.jsxs)("div",{className:"p-6",children:[$?(0,P.jsxs)("div",{className:"mt-4 mb-4",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("branchAssignment.title")||"Niederlassungszuweisung"}),(0,P.jsx)("p",{className:"dark:text-gray-300",children:e("branchAssignment.loading")||"Lade Niederlassungen..."})]}):Z.length>0&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("branchAssignment.title")||"Niederlassungszuweisung"}),ee.some((e=>!Z.some((t=>t.id===e))))&&(0,P.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,P.jsx)("p",{className:"font-bold",children:e("branchAssignment.unknownBranchesWarning")||"Unbekannte Niederlassungen zugewiesen"}),(0,P.jsx)("p",{children:e("branchAssignment.unknownBranchesMessage",{ids:ee.filter((e=>!Z.some((t=>t.id===e)))).join(", ")})||"Die folgenden Niederlassungs-IDs sind zugewiesen, aber nicht verf\xfcgbar: ".concat(ee.filter((e=>!Z.some((t=>t.id===e)))).join(", "))}),(0,P.jsx)("p",{className:"mt-2 text-sm",children:e("branchAssignment.availableBranchIds",{ids:Z.map((e=>e.id)).join(", ")})||"Verf\xfcgbare Niederlassungs-IDs: ".concat(Z.map((e=>e.id)).join(", "))})]}),(0,P.jsxs)("div",{className:"mb-4",children:[(0,P.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("branchAssignment.currentBranches")||"Aktuell zugewiesene Niederlassungen"}),0===ee.length?(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:e("branchAssignment.noBranchesAssigned")||"Keine Niederlassungen zugewiesen"}):(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Z.filter((e=>ee.includes(e.id))).map((t=>(0,P.jsx)("div",{className:"border border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 rounded-lg p-4 cursor-pointer",onClick:()=>Ce(t.id),children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsx)("div",{children:(0,P.jsx)("h4",{className:"font-medium dark:text-white",children:t.name})}),(0,P.jsxs)("div",{className:"flex items-center text-blue-600 dark:text-blue-400",children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e("branchAssignment.remove")||"Entfernen"}),(0,P.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,P.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},t.id))),ee.filter((e=>!Z.some((t=>t.id===e)))).map((t=>(0,P.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"font-medium",children:e("branchAssignment.unknownBranch",{id:t})||"Unbekannte Niederlassung (ID: ".concat(t,")")}),(0,P.jsx)("p",{className:"text-sm text-orange-600",children:e("branchAssignment.unknownBranchDescription")||"Diese Niederlassung existiert nicht mehr oder ist nicht verf\xfcgbar."})]}),(0,P.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e("branchAssignment.remove")||"Entfernen"}),(0,P.jsx)("button",{onClick:()=>Ce(t),className:"focus:outline-none",children:(0,P.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,P.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},"unknown-".concat(t))))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("branchAssignment.availableBranches")||"Verf\xfcgbare Niederlassungen"}),0===Z.filter((e=>!ee.includes(e.id))).length?(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:e("branchAssignment.noBranchesAvailable")||"Keine weiteren Niederlassungen verf\xfcgbar"}):(0,P.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Z.filter((e=>!ee.includes(e.id))).map((t=>(0,P.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20",onClick:()=>Ce(t.id),children:(0,P.jsxs)("div",{className:"flex justify-between items-center",children:[(0,P.jsx)("div",{children:(0,P.jsx)("h4",{className:"font-medium dark:text-white",children:t.name})}),(0,P.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600 dark:hover:text-blue-400",children:[(0,P.jsx)("span",{className:"mr-2 text-sm",children:e("branchAssignment.add")||"Hinzuf\xfcgen"}),(0,P.jsx)(b.A,{className:"h-5 w-5"})]})]})},t.id)))})]})]}),!$&&0===Z.length&&(0,P.jsxs)("div",{className:"mt-4 mb-4",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:e("branchAssignment.title")||"Niederlassungszuweisung"}),(0,P.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:e("branchAssignment.noBranchesFound")||"Keine Niederlassungen gefunden"})]})]}),"lifecycle"===re&&w&&(0,P.jsx)("div",{className:"p-6",children:(0,P.jsx)(W,{userId:w.id,userName:"".concat(w.firstName," ").concat(w.lastName)},"lifecycle-".concat(w.id,"-").concat(L))})]})}),de&&(0,P.jsx)(P.Fragment,{children:ue?(0,P.jsxs)(g.lG,{open:de,onClose:()=>ce(!1),className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:e("organisation.createUser.title")}),(0,P.jsx)("button",{onClick:()=>ce(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})}),(0,P.jsxs)("form",{onSubmit:Te,className:"p-6",children:[(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.email")," *"]}),(0,P.jsx)("input",{type:"email",name:"email",value:pe.email,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.password")," *"]}),(0,P.jsx)("input",{type:"password",name:"password",value:pe.password,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.firstName")," *"]}),(0,P.jsx)("input",{type:"text",name:"firstName",value:pe.firstName,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.lastName")," *"]}),(0,P.jsx)("input",{type:"text",name:"lastName",value:pe.lastName,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,P.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:()=>ce(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.cancel")})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("organisation.createUser.create")})]})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[de&&!ge&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:de?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(de?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:de?"auto":"none"},"aria-hidden":!de,role:"dialog","aria-modal":de,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:e("organisation.createUser.title")}),(0,P.jsx)("button",{onClick:()=>ce(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"flex flex-col flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:Te,className:"flex flex-col flex-1 min-h-0",children:[(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0 space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.email")," *"]}),(0,P.jsx)("input",{type:"email",name:"email",value:pe.email,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.password")," *"]}),(0,P.jsx)("input",{type:"password",name:"password",value:pe.password,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.firstName")," *"]}),(0,P.jsx)("input",{type:"text",name:"firstName",value:pe.firstName,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e("organisation.createUser.lastName")," *"]}),(0,P.jsx)("input",{type:"text",name:"lastName",value:pe.lastName,onChange:Ee,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,P.jsxs)("div",{className:"flex justify-end gap-3 border-t dark:border-gray-700 pt-4 px-4 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:()=>ce(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.cancel")})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("organisation.createUser.create")})]})]})]})})]})]})})]})};var Z=r(3744),X=r(9248),$=r(2517),Q=r(8010),ee=r(4426),te=r(7829),re=r(9462),ae=r(5365),se=r(2357);const le=[{entity:"dashboard",label:"Dashboard",options:"binary",boxes:[{entity:"requests",label:"Solicitudes",options:"ternary",buttons:[{entity:"request_create",label:"Erstellen",options:"ternary"},{entity:"request_edit",label:"Bearbeiten",options:"ternary"},{entity:"request_delete",label:"L\xf6schen",options:"ternary"}]}]},{entity:"worktracker",label:"Worktracker",options:"binary",boxes:[{entity:"zeiterfassung",label:"Zeiterfassung",options:null,buttons:[{entity:"worktime_start",label:"Starten",options:"binary"},{entity:"worktime_stop",label:"Stoppen",options:"binary"}]}],tabs:[{entity:"todos",label:"To Do's",options:"ternary",buttons:[{entity:"todo_create",label:"Erstellen",options:"ternary"},{entity:"todo_edit",label:"Bearbeiten",options:"ternary"},{entity:"todo_delete",label:"L\xf6schen",options:"ternary"}]},{entity:"reservations",label:"Reservierungen",options:"ternary",buttons:[{entity:"reservation_create",label:"Erstellen",options:"ternary"},{entity:"reservation_edit",label:"Bearbeiten",options:"ternary"},{entity:"reservation_delete",label:"L\xf6schen",options:"ternary"}]},{entity:"tour_bookings",label:"Touren",options:"ternary",buttons:[{entity:"tour_booking_create",label:"Erstellen",options:"ternary"},{entity:"tour_booking_edit",label:"Bearbeiten",options:"ternary"},{entity:"tour_booking_delete",label:"L\xf6schen",options:"ternary"}]}]},{entity:"consultations",label:"Consultas",options:"binary",boxes:[{entity:"consultas_box",label:"Consultas",options:null,buttons:[{entity:"consultation_start",label:"Starten",options:"binary"},{entity:"consultation_stop",label:"Stoppen",options:"binary"},{entity:"consultation_plan",label:"Planen",options:"binary"},{entity:"client_create",label:"Client anlegen",options:"binary"}]},{entity:"consultation_list",label:"Beratungsliste",options:"ternary",buttons:[{entity:"consultation_edit",label:"Bearbeiten",options:"ternary"},{entity:"consultation_delete",label:"L\xf6schen",options:"ternary"}]}]},{entity:"team_worktime_control",label:"Workcenter",options:"binary",tabs:[{entity:"arbeitszeiten",label:"Arbeitszeiten",options:"ternary",buttons:[{entity:"team_worktime_create",label:"Erstellen",options:"ternary"},{entity:"team_worktime_edit",label:"Bearbeiten",options:"ternary"},{entity:"team_worktime_delete",label:"L\xf6schen",options:"ternary"}]},{entity:"plan_de_turnos",label:"Schichtplan",options:"ternary",buttons:[{entity:"shift_create",label:"Erstellen",options:"binary"},{entity:"shift_edit",label:"Bearbeiten",options:"binary"},{entity:"shift_delete",label:"L\xf6schen",options:"binary"},{entity:"shift_exchange_request",label:"Tausch-Anfragen",options:"binary"}]},{entity:"task_analytics",label:"Task Analytics",options:"ternary"},{entity:"request_analytics",label:"Request Analytics",options:"ternary"}]},{entity:"payroll",label:"N\xf3mina",options:"binary",tabs:[{entity:"consultation_invoices",label:"Beratungsrechnungen",options:"ternary"},{entity:"monthly_reports",label:"Monatsrechnungen",options:"ternary"},{entity:"payroll_reports",label:"Lohnabrechnungen",options:"ternary"}]},{entity:"cerebro",label:"Cerebro",options:"binary"},{entity:"organization_management",label:"Organisation",options:"binary",tabs:[{entity:"users",label:"Benutzer",options:"ternary",buttons:[{entity:"user_create",label:"Erstellen",options:"binary"},{entity:"user_edit",label:"Bearbeiten",options:"binary"},{entity:"user_delete",label:"L\xf6schen",options:"binary"}]},{entity:"roles",label:"Rollen",options:"ternary",buttons:[{entity:"role_create",label:"Erstellen",options:"binary"},{entity:"role_edit",label:"Bearbeiten",options:"binary"},{entity:"role_delete",label:"L\xf6schen",options:"binary"}]},{entity:"branches",label:"Niederlassungen",options:"ternary",buttons:[{entity:"branch_create",label:"Erstellen",options:"binary"},{entity:"branch_edit",label:"Bearbeiten",options:"binary"},{entity:"branch_delete",label:"L\xf6schen",options:"binary"}]},{entity:"tour_providers",label:"Tour-Anbieter",options:"ternary",buttons:[{entity:"tour_provider_create",label:"Anbieter erstellen",options:"binary"},{entity:"tour_provider_edit",label:"Anbieter bearbeiten",options:"binary"},{entity:"tour_provider_delete",label:"Anbieter l\xf6schen",options:"binary"},{entity:"tour_create",label:"Tour erstellen",options:"binary"},{entity:"tour_edit",label:"Tour bearbeiten",options:"binary"},{entity:"tour_delete",label:"Tour l\xf6schen",options:"binary"}]},{entity:"organization_settings",label:"Organisation",options:"ternary",buttons:[{entity:"organization_create",label:"Erstellen",options:"binary"},{entity:"organization_edit",label:"Bearbeiten",options:"binary"},{entity:"organization_delete",label:"L\xf6schen",options:"binary"}]}]},{entity:"price_analysis",label:"Preisanalyse",options:"binary"},{entity:"settings",label:"Konfiguration",options:"binary",tabs:[{entity:"password_manager",label:"Passwort-Manager",options:"ternary"},{entity:"system",label:"System",options:"ternary"}]},{entity:"profile",label:"Profil",options:"binary"}],ne=()=>{const e=[];return le.forEach((t=>{var r,a;e.push({entity:t.entity,type:"page",options:t.options}),null===(r=t.boxes)||void 0===r||r.forEach((t=>{var r,a;t.options&&e.push({entity:t.entity,type:"box",options:t.options}),null===(r=t.buttons)||void 0===r||r.forEach((t=>{e.push({entity:t.entity,type:"button",options:t.options})})),null===(a=t.tabs)||void 0===a||a.forEach((t=>{var r;e.push({entity:t.entity,type:"tab",options:t.options}),null===(r=t.buttons)||void 0===r||r.forEach((t=>{e.push({entity:t.entity,type:"button",options:t.options})}))}))})),null===(a=t.tabs)||void 0===a||a.forEach((t=>{var r;e.push({entity:t.entity,type:"tab",options:t.options}),null===(r=t.buttons)||void 0===r||r.forEach((t=>{e.push({entity:t.entity,type:"button",options:t.options})}))}))})),e},ie=(e,t)=>({Erstellen:t("common.create"),Bearbeiten:t("common.edit"),"L\xf6schen":t("common.delete"),Starten:t("common.start")||"Starten",Stoppen:t("common.stop")||"Stoppen",Planen:t("common.plan")||"Planen","Client anlegen":t("roles.buttons.client_create")||"Client anlegen","Anbieter erstellen":t("roles.buttons.tour_provider_create")||"Anbieter erstellen","Anbieter bearbeiten":t("roles.buttons.tour_provider_edit")||"Anbieter bearbeiten","Anbieter l\xf6schen":t("roles.buttons.tour_provider_delete")||"Anbieter l\xf6schen","Tour erstellen":t("roles.buttons.tour_create")||"Tour erstellen","Tour bearbeiten":t("roles.buttons.tour_edit")||"Tour bearbeiten","Tour l\xf6schen":t("roles.buttons.tour_delete")||"Tour l\xf6schen","Tausch-Anfragen":t("common.exchangeRequests")||"Tausch-Anfragen"}[e]||e),oe=(e,t)=>e.find((e=>e.entity===t)),de=(e,t,r,a)=>{const s=e.findIndex((e=>e.entity===t));if(s>=0){const t=[...e];return t[s]=(0,m.A)((0,m.A)({},t[s]),{},{accessLevel:a}),t}return[...e,{entity:t,entityType:r,accessLevel:a}]},ce=e=>{let{value:t,options:r,onChange:a,disabled:l}=e;const{t:n}=(0,s.Bd)(),i=(0,se.rr)(t),o=(e=>"binary"===e?["none","all_both"]:["none","own_both","all_both"])(r),d=o.includes(i)?i:"own_read"===i||"own_both"===i?o.includes("own_both")?"own_both":"all_both":"all_read"===i||"all_both"===i?"all_both":"none";return(0,P.jsx)("select",{value:d,onChange:e=>a(e.target.value),disabled:l,className:"text-xs px-1.5 py-0.5 ".concat((e=>{switch(e){case"none":default:return"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400";case"own_both":return"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300";case"all_both":return"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"}})(d)," rounded border-0 cursor-pointer focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed max-w-[90px]"),children:o.map((e=>(0,P.jsx)("option",{value:e,children:n("roles.accessLevels.".concat(e))},e)))})},ue=e=>{let{button:t,permissions:r,onChange:a,disabled:l}=e;const{t:n}=(0,s.Bd)(),i=oe(r,t.entity),o=(null===i||void 0===i?void 0:i.accessLevel)||"none";return(0,P.jsxs)("div",{className:"flex items-center justify-between mt-1 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,P.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mr-2",children:["\u2514 ",ie(t.label,n)]}),(0,P.jsx)(ce,{value:o,options:t.options,onChange:e=>{a(de(r,t.entity,"button",e))},disabled:l})]})},me=e=>{var t;let{tab:r,permissions:a,onChange:l,disabled:n}=e;const{t:i}=(0,s.Bd)(),o=oe(a,r.entity),d=(null===o||void 0===o?void 0:o.accessLevel)||"none";return(0,P.jsxs)("div",{className:"mt-2",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,P.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate mr-2",children:["\u2514 ",ie(r.label,i)]}),(0,P.jsx)(ce,{value:d,options:r.options,onChange:e=>{l(de(a,r.entity,"tab",e))},disabled:n})]}),null===(t=r.buttons)||void 0===t?void 0:t.map((e=>(0,P.jsx)(ue,{button:e,permissions:a,onChange:l,disabled:n},e.entity)))]})},ge=e=>{var t,r;let{box:a,permissions:l,onChange:n,disabled:i}=e;const{t:o}=(0,s.Bd)(),d=oe(l,a.entity),c=(null===d||void 0===d?void 0:d.accessLevel)||"none";return(0,P.jsxs)("div",{className:"mt-2",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-purple-300 dark:border-purple-600",children:[(0,P.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate mr-2",children:["\u2514 ",ie(a.label,o)]}),a.options?(0,P.jsx)(ce,{value:c,options:a.options,onChange:e=>{n(de(l,a.entity,"box",e))},disabled:i}):(0,P.jsx)("span",{className:"text-xs text-gray-400",children:"-"})]}),null===(t=a.buttons)||void 0===t?void 0:t.map((e=>(0,P.jsx)(ue,{button:e,permissions:l,onChange:n,disabled:i},e.entity))),null===(r=a.tabs)||void 0===r?void 0:r.map((e=>(0,P.jsx)(me,{tab:e,permissions:l,onChange:n,disabled:i},e.entity)))]})},xe=e=>{var t,r;let{page:a,permissions:l,onChange:n,disabled:i,isExpanded:o,onToggle:d}=e;const{t:c}=(0,s.Bd)(),u=oe(l,a.entity),m=(null===u||void 0===u?void 0:u.accessLevel)||"none",g=a.boxes&&a.boxes.length>0||a.tabs&&a.tabs.length>0;return(0,P.jsxs)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-3 mb-3",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded p-1",onClick:g?d:void 0,children:[(0,P.jsxs)("div",{className:"flex items-center gap-2",children:[g&&(0,P.jsx)("span",{className:"text-gray-400 transform transition-transform ".concat(o?"rotate-90":""),children:"\u25b6"}),(0,P.jsx)("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:ie(a.label,c)})]}),(0,P.jsx)(ce,{value:m,options:a.options,onChange:e=>{n(de(l,a.entity,"page",e))},disabled:i})]}),o&&g&&(0,P.jsxs)("div",{className:"mt-2 ml-4",children:[null===(t=a.boxes)||void 0===t?void 0:t.map((e=>(0,P.jsx)(ge,{box:e,permissions:l,onChange:n,disabled:i},e.entity))),null===(r=a.tabs)||void 0===r?void 0:r.map((e=>(0,P.jsx)(me,{tab:e,permissions:l,onChange:n,disabled:i},e.entity)))]})]})},be=e=>{let{permissions:t,onChange:r,disabled:l=!1}=e;const{t:n}=(0,s.Bd)(),[i,o]=a.useState(new Set),d=e=>{let a=[...t];le.forEach((t=>{var r,s;a=de(a,t.entity,"page",e),null===(r=t.boxes)||void 0===r||r.forEach((t=>{var r,s;t.options&&(a=de(a,t.entity,"box",e)),null===(r=t.buttons)||void 0===r||r.forEach((t=>{a=de(a,t.entity,"button",e)})),null===(s=t.tabs)||void 0===s||s.forEach((t=>{var r;a=de(a,t.entity,"tab",e),null===(r=t.buttons)||void 0===r||r.forEach((t=>{a=de(a,t.entity,"button",e)}))}))})),null===(s=t.tabs)||void 0===s||s.forEach((t=>{var r;a=de(a,t.entity,"tab",e),null===(r=t.buttons)||void 0===r||r.forEach((t=>{a=de(a,t.entity,"button",e)}))}))})),r(a)};return(0,P.jsxs)("div",{className:"space-y-2",children:[(0,P.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,P.jsx)("button",{type:"button",onClick:()=>{o(new Set(le.map((e=>e.entity))))},className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200",children:n("common.expandAll")||"Alle aufklappen"}),(0,P.jsx)("button",{type:"button",onClick:()=>{o(new Set)},className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200",children:n("common.collapseAll")||"Alle zuklappen"}),(0,P.jsx)("button",{type:"button",onClick:()=>d("all_both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200",children:n("roles.form.setAllToYes")}),(0,P.jsx)("button",{type:"button",onClick:()=>d("none"),className:"px-2 py-1 text-xs bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded hover:bg-red-200",children:n("roles.form.setAllToNo")})]}),(0,P.jsx)("div",{className:"border rounded-lg p-4 dark:border-gray-600 max-h-[400px] overflow-y-auto",children:le.map((e=>(0,P.jsx)(xe,{page:e,permissions:t,onChange:r,disabled:l,isExpanded:i.has(e.entity),onToggle:()=>(e=>{const t=new Set(i);t.has(e)?t.delete(e):t.add(e),o(t)})(e.entity)},e.entity)))})]})},he=["dashboard","worktracker","cerebro","settings","profile"],pe=["dashboard","worktracker","consultations","team_worktime_control","payroll","organization_management","cerebro","settings","profile","tour_management","password_manager","price_analysis"],ye=["requests","tasks","reservations","users","roles","organization","organization_join_requests","organization_users","team_worktime","worktime","clients","consultation_invoices","branches","notifications","settings","monthly_reports","tours","tour_bookings","ota_listings","price_analyses","price_recommendations","pricing_rules","rate_shopping_jobs"],fe=["database_reset_table","database_logs","invoice_create","invoice_download","invoice_mark_paid","invoice_settings","todo_create","todo_edit","todo_delete","task_create","task_edit","task_delete","user_create","user_edit","user_delete","role_assign","role_create","role_edit","role_delete","organization_create","organization_edit","organization_delete","worktime_start","worktime_stop","worktime_edit","worktime_delete","cerebro","consultation_start","consultation_stop","consultation_edit","client_create","client_edit","client_delete","settings_system","settings_notifications","settings_profile","payroll_generate","payroll_export","payroll_edit","tour_create","tour_edit","tour_delete","tour_view","tour_booking_create","tour_booking_edit","tour_booking_cancel","tour_provider_create","tour_provider_edit","tour_provider_delete","password_entry_create","password_entry_edit","password_entry_delete","price_analysis_create_rule","price_analysis_edit_rule","price_analysis_delete_rule","price_analysis_apply_recommendation","price_analysis_reject_recommendation","price_analysis_run_rate_shopping"],ve="roles-table",ke=[1,2,999],je=["Admin","User","Hamburger"],we=(e,t)=>!!ke.includes(e)||!(!t||!je.includes(t)),Ne=e=>{let{role:t,onEdit:r,onDelete:a,onCopy:l,canEdit:n,canDelete:i,canCopy:o}=e;const{t:d}=(0,s.Bd)();return(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:[(0,P.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,P.jsxs)("div",{className:"flex space-x-2",children:[o&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>l(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,P.jsx)(Z.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.copy")})]}),n&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,P.jsx)(C.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.edit")})]}),i&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>a(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",children:(0,P.jsx)(X.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:d("roles.actions.delete")})]})]})]}),(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description||d("roles.noDescription")}),(0,P.jsx)("div",{className:"mt-2",children:(0,P.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.allBranches?(0,P.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",children:d("roles.form.allBranches")||"Alle Branches"}):t.branches&&t.branches.length>0?(0,P.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",children:[t.branches.length," ",d("roles.form.specificBranches")||"Branches"]}):(0,P.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:d("roles.form.noBranches")||"Keine Branches"})})}),(0,P.jsxs)("div",{className:"mt-2",children:[(0,P.jsxs)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:[d("roles.permissions"),":"]}),(0,P.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.permissions.filter((e=>"none"!==e.accessLevel)).slice(0,8).map((e=>(0,P.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:[e.entity,": ",e.accessLevel]},"".concat(e.entity,"-").concat(e.entityType)))),t.permissions.filter((e=>"none"!==e.accessLevel)).length>8&&(0,P.jsxs)("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:["+",t.permissions.filter((e=>"none"!==e.accessLevel)).length-8," ",d("common.showMore")]})]})]})]})},Ae=e=>{let{onRolesChange:t,onError:r,readOnly:n=!1}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),[h,p]=(0,a.useState)([]),[y,k]=(0,a.useState)(!0),[j,A]=((0,a.useMemo)((()=>({dashboard:i("roles.pages.dashboard"),worktracker:i("roles.pages.worktracker"),consultations:i("roles.pages.consultations"),team_worktime_control:i("roles.pages.team_worktime_control"),payroll:i("roles.pages.payroll"),organization_management:i("roles.pages.organization_management"),cerebro:i("roles.pages.cerebro"),settings:i("roles.pages.settings"),profile:i("roles.pages.profile"),tour_management:i("roles.pages.tour_management","Touren-Verwaltung"),password_manager:i("roles.pages.password_manager","Passwort-Manager")})),[i]),(0,a.useMemo)((()=>({tasks:i("roles.tables.tasks"),reservations:i("roles.tables.reservations"),worktime:i("roles.tables.worktime"),users:i("roles.tables.users"),roles:i("roles.tables.roles"),organization:i("roles.tables.organization"),organization_join_requests:i("roles.tables.organization_join_requests"),organization_users:i("roles.tables.organization_users"),clients:i("roles.tables.clients"),consultation_invoices:i("roles.tables.consultation_invoices"),requests:i("roles.tables.requests"),team_worktime:i("roles.tables.team_worktime"),settings:i("roles.tables.settings"),notifications:i("roles.tables.notifications"),branches:i("roles.tables.branches"),monthly_reports:i("roles.tables.monthly_reports"),tours:i("roles.tables.tours","Touren"),tour_bookings:i("roles.tables.tour_bookings","Tour-Buchungen")})),[i]),(0,a.useMemo)((()=>({worktime_start:i("roles.buttons.worktime_start"),worktime_stop:i("roles.buttons.worktime_stop"),worktime_edit:i("roles.buttons.worktime_edit"),worktime_delete:i("roles.buttons.worktime_delete"),task_create:i("roles.buttons.task_create"),task_edit:i("roles.buttons.task_edit"),task_delete:i("roles.buttons.task_delete"),todo_create:i("roles.buttons.todo_create"),todo_edit:i("roles.buttons.todo_edit"),todo_delete:i("roles.buttons.todo_delete"),client_create:i("roles.buttons.client_create"),client_edit:i("roles.buttons.client_edit"),client_delete:i("roles.buttons.client_delete"),consultation_start:i("roles.buttons.consultation_start"),consultation_stop:i("roles.buttons.consultation_stop"),consultation_edit:i("roles.buttons.consultation_edit"),invoice_create:i("roles.buttons.invoice_create"),invoice_download:i("roles.buttons.invoice_download"),invoice_mark_paid:i("roles.buttons.invoice_mark_paid"),invoice_settings:i("roles.buttons.invoice_settings"),user_create:i("roles.buttons.user_create"),user_edit:i("roles.buttons.user_edit"),user_delete:i("roles.buttons.user_delete"),role_assign:i("roles.buttons.role_assign"),role_create:i("roles.buttons.role_create"),role_edit:i("roles.buttons.role_edit"),role_delete:i("roles.buttons.role_delete"),organization_create:i("roles.buttons.organization_create"),organization_edit:i("roles.buttons.organization_edit"),organization_delete:i("roles.buttons.organization_delete"),settings_system:i("roles.buttons.settings_system"),settings_notifications:i("roles.buttons.settings_notifications"),settings_profile:i("roles.buttons.settings_profile"),database_reset_table:i("roles.buttons.database_reset_table"),database_logs:i("roles.buttons.database_logs"),payroll_generate:i("roles.buttons.payroll_generate"),payroll_export:i("roles.buttons.payroll_export"),payroll_edit:i("roles.buttons.payroll_edit"),cerebro:i("roles.buttons.cerebro")})),[i]),(0,a.useState)({name:"",description:"",permissions:[...pe.map((e=>({entity:e,entityType:"page",accessLevel:"none"}))),...ye.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...fe.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]})),[S,C]=(0,a.useState)(null),{hasPermission:E}=(0,l.S)(),[T,D]=(0,a.useState)(""),[L,z]=(0,a.useState)(!1),[I,F]=(0,a.useState)(!0),[_,B]=(0,a.useState)([]),[V,O]=(0,a.useState)([]),[M,U]=(0,a.useState)(!1),[q,W]=(0,a.useState)([]),[G,J]=(0,a.useState)([]),[Y,Z]=(0,a.useState)("Alle"),[X,se]=(0,a.useState)(null),[le,ie]=(0,a.useState)(window.innerWidth<640),[oe,de]=(0,a.useState)(window.innerWidth>1070),{openSidepane:ce,closeSidepane:ue}=(0,R.N)(),me=(0,a.useRef)(r);(0,a.useEffect)((()=>{me.current=r}),[r]);const ge=(0,H.qz)(),xe=(0,a.useCallback)(((e,t)=>{null!==ge&&void 0!==ge&&ge.handleError?ge.handleError(e,t):(console.error("Fehler:",e,t),me.current&&me.current((null===e||void 0===e?void 0:e.message)||"Ein Fehler ist aufgetreten"))}),[ge]),ke=(0,a.useCallback)(((e,t)=>{null!==ge&&void 0!==ge&&ge.handleValidationError?ge.handleValidationError(e,t):(console.error("Validierungsfehler:",e,t),me.current&&me.current(e))}),[ge]),[je,Ae]=(0,a.useState)(!1),[Se,Ce]=(0,a.useState)(null),[Ee,Te]=(0,a.useState)(10);(0,a.useEffect)((()=>{const e=()=>{ie(window.innerWidth<640),de(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(o?ce():ue(),()=>{ue()})),[o,ce,ue]);const De=(0,a.useCallback)((async()=>{U(!0);try{const e=await x.H_.getAll();O(e.data)}catch(S){console.error("Fehler beim Laden der Branches:",S)}finally{U(!1)}}),[]),Le=(0,a.useCallback)((async()=>{k(!0),K.v.log("DEBUGAUSGABE: Hole Rollen vom Server...");try{const e=await x.Zj.getAll();K.v.log("DEBUGAUSGABE: Rollen erfolgreich geholt:",e.data),p(e.data),C(null)}catch(S){console.error("DEBUGAUSGABE: Fehler beim Abrufen der Rollen:",S),xe(S,{component:"RoleManagementTab",action:"fetchRoles"}),r&&r("Fehler beim Laden der Rollen")}finally{k(!1)}}),[xe]);(0,a.useEffect)((()=>{o&&De()}),[o,De]);const Re=async e=>{if(e.preventDefault(),C(null),I||0!==_.length)if(j.name){if(c){const e=j.permissions.map((e=>"page"===e.entityType&&he.includes(e.entity)?(0,m.A)((0,m.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));if(!c.id||isNaN(c.id))return console.warn("DEBUGAUSGABE: Ung\xfcltige Rollen-ID erkannt, Bearbeitung abgebrochen"),void xe("Ung\xfcltige Rollen-ID, Bearbeitung abgebrochen",{component:"RoleManagementTab",roleId:c.id});if(we(c.id,c.name))return console.warn("DEBUGAUSGABE: Versuch, gesch\xfctzte Rolle mit ID ".concat(c.id," zu bearbeiten")),xe({message:"Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",name:"PermissionError"},{component:"RoleManagementTab",roleId:c.id,category:ae.h.PERMISSION}),void d(!1);if(!h.some((e=>e.id===c.id)))return console.error("DEBUGAUSGABE: Rolle mit ID ".concat(c.id," existiert nicht in der aktuellen Liste")),xe("Rolle mit ID ".concat(c.id," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:c.id}),d(!1),void await Le();K.v.log("DEBUGAUSGABE: Bearbeite Rolle mit ID ".concat(c.id));try{K.v.log("DEBUGAUSGABE: Sende Aktualisierung an API:",{name:j.name,description:j.description,permissions:e});const t={name:j.name,description:j.description,permissions:e,allBranches:I,branchIds:I?[]:_};K.v.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.update");const r=await x.Zj.update(c.id,t);K.v.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.update"),K.v.log("DEBUGAUSGABE: API-Antwort bei Rollenaktualisierung:",r),await Le()}catch(r){return console.error("DEBUGAUSGABE: Fehler bei Rollenaktualisierung:",r),void(r.response?r.response.data.meta&&"Record to update not found."===r.response.data.meta.cause?(xe("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:c.id}),d(!1),await Le()):xe(r.response.data.message||"Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:c.id}):xe("Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:c.id}))}}else try{const e=j.permissions.map((e=>"page"===e.entityType&&he.includes(e.entity)?(0,m.A)((0,m.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));K.v.log("DEBUGAUSGABE: Sende Daten an API f\xfcr neue Rolle:",{name:j.name,description:j.description,permissions:e});const t={name:j.name,description:j.description,permissions:e,allBranches:I,branchIds:I?[]:_};K.v.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.create");const r=await x.Zj.create(t);K.v.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.create"),K.v.log("DEBUGAUSGABE: API-Antwort beim Erstellen der Rolle:",r),await Le()}catch(a){return console.error("DEBUGAUSGABE: Fehler bei API-Anfrage zum Erstellen der Rolle:",a),void(a.response?xe(a.response.data.message||"Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}):xe("Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}))}t&&t(),d(!1),Fe()}else ke("Rollenname darf nicht leer sein",{name:"Rollenname ist erforderlich"});else xe(i("roles.form.branchSelectionRequired")||'Bitte w\xe4hlen Sie mindestens eine Branch aus oder aktivieren Sie "F\xfcr alle Branches g\xfcltig"',{component:"RoleManagementTab"})},Pe=async e=>{if(!e||isNaN(e))return console.warn("Ung\xfcltige Rollen-ID erkannt, L\xf6schvorgang abgebrochen"),void xe("Ung\xfcltige Rollen-ID, L\xf6schvorgang abgebrochen",{component:"RoleManagementTab",roleId:e});const r=h.find((t=>t.id===e));if(r&&we(e,r.name))return console.warn("Versuch, gesch\xfctzte Rolle mit ID ".concat(e," (").concat(r.name,") zu l\xf6schen")),void xe("Gesch\xfctzte Systemrollen k\xf6nnen nicht gel\xf6scht werden",{component:"RoleManagementTab",roleId:e});if(window.confirm("M\xf6chten Sie diese Rolle wirklich l\xf6schen?"))try{K.v.log("Starte L\xf6schvorgang f\xfcr Rolle mit ID ".concat(e));if(!h.some((t=>t.id===e)))return console.error("Rolle mit ID ".concat(e," existiert nicht in der aktuellen Liste")),xe("Rolle mit ID ".concat(e," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:e}),void await Le();K.v.log("Sende L\xf6schanfrage an API");try{const t=await x.Zj.delete(e);K.v.log("API-Antwort beim L\xf6schen der Rolle:",t),await Le(),K.v.log("Rollenliste nach L\xf6schen aktualisiert")}catch(a){return console.error("API-Fehler beim L\xf6schen der Rolle:",a),void(a.response?(console.error("API-Fehlerdaten:",a.response.data),a.response.data.meta&&"Record to delete does not exist."===a.response.data.meta.cause?(xe("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:e}),await Le()):xe(a.response.data.message||i("roleManagement.deleteError"),{component:"RoleManagementTab",roleId:e})):xe(i("roleManagement.networkError"),{component:"RoleManagementTab",roleId:e}))}K.v.log("Rolle erfolgreich gel\xf6scht"),t&&t()}catch(s){console.error(i("roleManagement.unhandledError"),s),xe(s);try{await Le()}catch(l){console.error("Fehler beim Aktualisieren der Rollenliste nach fehlgeschlagenem L\xf6schvorgang:",l)}}},ze=async e=>{try{if(!e||!e.id)return void xe("Ung\xfcltige Rolle zum Kopieren",{component:"RoleManagementTab"});const r={name:"".concat(e.name,"-Kopie"),description:e.description||"",permissions:e.permissions.filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})))};K.v.log("DEBUGAUSGABE: Kopiere Rolle:",e.name,"mit Daten:",r);const a=await x.Zj.create(r);K.v.log("DEBUGAUSGABE: Rolle erfolgreich kopiert:",a.data),p((e=>[a.data,...e])),Ie(a.data),t&&t()}catch(r){console.error("DEBUGAUSGABE: Fehler beim Kopieren der Rolle:",r),xe(r,{component:"RoleManagementTab",roleId:e.id})}},Ie=async e=>{if(we(e.id,e.name))return void xe("Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",{component:"RoleManagementTab",roleId:e.id});const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=ne(),r=[];return t.forEach((t=>{let{entity:a,type:s}=t;const l=e.find((e=>e.entity===a&&e.entityType===s));r.push({entity:a,entityType:s,accessLevel:(null===l||void 0===l?void 0:l.accessLevel)||"none"})})),r}(e.permissions).map((e=>(0,m.A)((0,m.A)({},e),{},{accessLevel:e.accessLevel})));if(t.forEach((e=>{"page"===e.entityType&&he.includes(e.entity)&&(e.accessLevel="both")})),A({name:e.name,description:e.description||"",permissions:t}),e.id)try{var r;const t=(await x.Zj.getRoleBranches(e.id)).data;F(t.allBranches||!1),B((null===(r=t.branches)||void 0===r?void 0:r.map((e=>e.id)))||[])}catch(S){console.error("Fehler beim Laden der Branch-Zuweisungen:",S),F(!0),B([])}u(e),d(!0)},Fe=()=>{u(null),F(!0),B([]),A({name:"",description:"",permissions:[...pe.map((e=>({entity:e,entityType:"page",accessLevel:he.includes(e)?"both":"none"}))),...ye.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...fe.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]})},_e=()=>q.length,Be=(0,a.useMemo)((()=>h.filter((e=>{if(T){const t=T.toLowerCase();return!!e.name.toLowerCase().includes(t)||!(!e.description||!e.description.toLowerCase().includes(t))}if(q.length>0){let t=q.length>0;for(let r=0;r<q.length;r++){const a=q[r];let s=!1;switch(a.column){case"name":const t=e.name.toLowerCase(),r=(a.value||"").toLowerCase();"equals"===a.operator?s=t===r:"contains"===a.operator?s=t.includes(r):"startsWith"===a.operator&&(s=t.startsWith(r));break;case"description":if(!e.description){s=!1;break}const l=e.description.toLowerCase(),n=(a.value||"").toLowerCase();"equals"===a.operator?s=l===n:"contains"===a.operator?s=l.includes(n):"startsWith"===a.operator&&(s=l.startsWith(n));break;case"permissions":const i=a.value,o=e.permissions.filter((e=>e.accessLevel===i)).length;("greaterThan"===a.operator||"equals"===a.operator)&&(s=o>0)}if(0===r)t=s;else{t="AND"===G[r-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())))),[h,T,q,G]);(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await w.A.get(N.Sn.SAVED_FILTERS.BY_TABLE(ve))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:ve,name:"Alle",conditions:[],operators:[]};await w.A.post(N.Sn.SAVED_FILTERS.BASE,e),K.v.log("Alle-Filter f\xfcr Rollen erstellt")}}catch(S){console.error("Fehler beim Erstellen der Standard-Filter:",S)}})()}),[]);const Ve=(0,re.b)(),{loadFilters:Oe}=Ve,Me=(0,a.useCallback)(((e,t)=>{W(e),J(t)}),[]),Ue=(0,a.useCallback)((()=>{W([]),J([]),Z(""),se(null)}),[]),qe=(0,a.useCallback)((async(e,t,r,a)=>{Z(e),se(t),Me(r,a)}),[Me]);return(0,a.useEffect)((()=>{(async()=>{const e=(await Oe(ve)).find((e=>"Alle"===e.name));e&&await qe(e.name,e.id,e.conditions,e.operators),await Le()})()}),[Oe,qe,Le]),(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("div",{className:"flex items-center",children:!n&&E("roles","write","table")&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>d(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":i("roles.createRole"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("roles.createRole")})]})}),(0,P.jsx)("div",{}),(0,P.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,P.jsx)("input",{type:"text",placeholder:"Suchen...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:T,onChange:e=>D(e.target.value)}),(0,P.jsxs)("div",{className:"relative group ml-1",children:[(0,P.jsxs)("button",{className:"p-2 rounded-md ".concat(_e()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"),onClick:()=>z(!L),children:[(0,P.jsx)(Q.A,{className:"w-5 h-5"}),_e()>0&&(0,P.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:_e()})]}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Filter"})]})]})]}),L&&(0,P.jsx)(ee.A,{columns:[{id:"name",label:"Name"},{id:"description",label:"Beschreibung"},{id:"permissions",label:"Berechtigungen"}],onApply:Me,onReset:Ue,savedConditions:q,savedOperators:G,tableId:ve}),(0,P.jsx)(te.A,{tableId:ve,onSelectFilter:Me,onReset:Ue,activeFilterName:Y,selectedFilterId:X,onFilterChange:qe,defaultFilterName:"Alle"}),y?(0,P.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,P.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===h.length?(0,P.jsx)("div",{className:"p-4 bg-gray-50 rounded text-center",children:(0,P.jsx)("p",{children:"Keine Rollen gefunden. Erstellen Sie eine neue Rolle mit dem Button oben."})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"space-y-4",children:Be.slice(0,Ee).map((e=>(0,P.jsx)(Ne,{role:e,onEdit:Ie,onDelete:Pe,onCopy:ze,canEdit:!n&&E("roles","write","table")&&!we(e.id,e.name),canDelete:!n&&E("roles","write","table")&&!we(e.id,e.name),canCopy:!n&&E("roles","write","table")&&we(e.id,e.name)},e.id)))}),Be.length>Ee&&(0,P.jsx)("div",{className:"mt-4 flex justify-center",children:(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{className:"p-2 text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>Te((e=>e+10)),children:(0,P.jsx)($.A,{className:"h-5 w-5"})}),(0,P.jsxs)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:[i("common.showMore")," (",Be.length-Ee," ",i("common.remaining"),")"]})]})})]})]}),o&&(0,P.jsx)(P.Fragment,{children:le?(0,P.jsxs)(g.lG,{open:o,onClose:()=>d(!1),className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,P.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i(c?"roles.editRole":"roles.createRole")}),(0,P.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})}),(0,P.jsxs)("form",{onSubmit:Re,className:"flex flex-col flex-1 min-h-0",children:[(0,P.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,P.jsxs)("div",{className:"p-6 space-y-5",children:[(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,P.jsx)("input",{type:"text",value:j.name,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Beschreibung"}),(0,P.jsx)("input",{type:"text",value:j.description,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.branchAssignment")||"Branch-Zuweisung"}),(0,P.jsxs)("div",{className:"space-y-3",children:[(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"checkbox",checked:I,onChange:e=>{F(e.target.checked),e.target.checked&&B([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,P.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("roles.form.allBranches")||"F\xfcr alle Branches g\xfcltig"})]}),!I&&(0,P.jsxs)("div",{className:"ml-6",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.specificBranches")||"Spezifische Branches:"}),M?(0,P.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Branches..."}):0===V.length?(0,P.jsx)("div",{className:"text-sm text-gray-500",children:"Keine Branches verf\xfcgbar"}):(0,P.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:V.map((e=>(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"checkbox",checked:_.includes(e.id),onChange:t=>{t.target.checked?B([..._,e.id]):B(_.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,P.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]})]})]}),(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.detailedPermissions")}),(0,P.jsx)(be,{permissions:j.permissions,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{permissions:e}))})]})]})}),(0,P.jsxs)("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-end gap-2 border-t dark:border-gray-600 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c?"Aktualisieren":"Erstellen"})]})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[o&&!oe&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:o?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(o?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:o?"auto":"none"},"aria-hidden":!o,role:"dialog","aria-modal":o,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i(c?"roles.editRole":"roles.createRole")}),(0,P.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:Re,className:"space-y-5",children:[(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.name")}),(0,P.jsx)("input",{type:"text",value:j.name,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.description")}),(0,P.jsx)("input",{type:"text",value:j.description,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("roles.form.detailedPermissions")}),(0,P.jsx)(be,{permissions:j.permissions,onChange:e=>A((0,m.A)((0,m.A)({},j),{},{permissions:e}))})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c?"Aktualisieren":"Erstellen"})]})]})]})})]})]})})]})},Se=e=>{let{branchId:t}=e;const{t:r}=(0,s.Bd)(),[l,n]=(0,a.useState)({}),[i,o]=(0,a.useState)(!0),[d,c]=(0,a.useState)(!1),[u,g]=(0,a.useState)(null),[x,b]=(0,a.useState)({text:"",imageUrl:"",videoUrl:""}),[h,p]=(0,a.useState)([]),[y,k]=(0,a.useState)(!1),j=async()=>{try{o(!0);const e=await w.A.get(N.Sn.BRANCHES.ROOM_DESCRIPTIONS(t));n(e.data||{})}catch(e){console.error("Fehler beim Laden der Zimmer-Beschreibungen:",e)}finally{o(!1)}};(0,a.useEffect)((()=>{t&&(j(),(async()=>{try{k(!0);const e=await w.A.get(N.Sn.RESERVATION.BASE,{params:{branchId:t,limit:1e3}}),r=new Map;(e.data.data||[]).forEach((e=>{if(e.categoryId&&e.roomNumber){const t=e.roomNumber.includes("("),a=t?"compartida":"privada",s=t?e.roomNumber.split("(")[0].trim():e.roomNumber;r.has(e.categoryId)||r.set(e.categoryId,{roomName:s,roomType:a})}}));const a=Array.from(r.entries()).map((e=>{let[t,r]=e;return(0,m.A)({categoryId:t},r)}));p(a.sort(((e,t)=>e.roomName.localeCompare(t.roomName))))}catch(e){console.error("Fehler beim Laden der Zimmer:",e)}finally{k(!1)}})())}),[t]);const A=async()=>{if(null!==u)try{c(!0);const e=(0,m.A)((0,m.A)({},l),{},{[u]:x});await w.A.put(N.Sn.BRANCHES.ROOM_DESCRIPTIONS(t),{roomDescriptions:e}),await j(),g(null),b({text:"",imageUrl:"",videoUrl:""})}catch(e){console.error("Fehler beim Speichern der Zimmer-Beschreibung:",e),alert(r("branches.roomDescriptions.saveError",{defaultValue:"Fehler beim Speichern der Beschreibung"}))}finally{c(!1)}},S=()=>{g(null),b({text:"",imageUrl:"",videoUrl:""})};return i||y?(0,P.jsx)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded",children:(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("common.loading",{defaultValue:"Lade..."})})}):0===h.length?(0,P.jsx)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded",children:(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r("branches.roomDescriptions.noRooms",{defaultValue:"Keine Zimmer gefunden. Importieren Sie zuerst Reservierungen aus LobbyPMS."})})}):(0,P.jsxs)("div",{className:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:r("branches.roomDescriptions.title",{defaultValue:"Zimmer-Beschreibungen"})}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:r("branches.roomDescriptions.description",{defaultValue:"Beschreibungen, wie man zu den Zimmern kommt. Diese werden in den Check-in-Nachrichten verwendet."})}),(0,P.jsx)("div",{className:"space-y-4",children:h.map((e=>{const t=u===e.categoryId,a=l[e.categoryId]||null;return(0,P.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-800",children:[(0,P.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h6",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.roomName}),(0,P.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["compartida"===e.roomType?r("branches.roomDescriptions.dorm",{defaultValue:"Dorm"}):r("branches.roomDescriptions.private",{defaultValue:"Privatzimmer"})," \u2022 ",r("branches.roomDescriptions.categoryId",{defaultValue:"Category ID"}),": ",e.categoryId]})]}),!t&&(0,P.jsx)("button",{onClick:()=>(e=>{const t=l[e]||{text:"",imageUrl:"",videoUrl:""};b(t),g(e)})(e.categoryId),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:r("common.edit",{defaultValue:"Bearbeiten"}),children:(0,P.jsx)(C.A,{className:"h-4 w-4"})})]}),t?(0,P.jsxs)("div",{className:"space-y-3 mt-3",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("branches.roomDescriptions.text",{defaultValue:"Text"})}),(0,P.jsx)("textarea",{value:x.text||"",onChange:e=>b((0,m.A)((0,m.A)({},x),{},{text:e.target.value})),rows:3,placeholder:r("branches.roomDescriptions.textPlaceholder",{defaultValue:"Beschreibung, wie man zum Zimmer kommt..."}),className:"w-full text-sm rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("branches.roomDescriptions.imageUrl",{defaultValue:"Bild-URL"})}),(0,P.jsx)("input",{type:"text",value:x.imageUrl||"",onChange:e=>b((0,m.A)((0,m.A)({},x),{},{imageUrl:e.target.value})),placeholder:"https://example.com/image.jpg",className:"w-full text-sm rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("branches.roomDescriptions.videoUrl",{defaultValue:"Video-URL"})}),(0,P.jsx)("input",{type:"text",value:x.videoUrl||"",onChange:e=>b((0,m.A)((0,m.A)({},x),{},{videoUrl:e.target.value})),placeholder:"https://example.com/video.mp4",className:"w-full text-sm rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,P.jsx)("button",{onClick:S,disabled:d,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50",title:r("common.cancel",{defaultValue:"Abbrechen"}),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{onClick:A,disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",title:d?r("common.saving",{defaultValue:"Speichere..."}):r("common.save",{defaultValue:"Speichern"}),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]}):(0,P.jsx)("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:a?(0,P.jsxs)("div",{className:"space-y-1",children:[a.text&&(0,P.jsx)("p",{children:a.text}),a.imageUrl&&(0,P.jsxs)("p",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[r("branches.roomDescriptions.image",{defaultValue:"Bild"}),":"]})," ",(0,P.jsx)("a",{href:a.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:a.imageUrl})]}),a.videoUrl&&(0,P.jsxs)("p",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[r("branches.roomDescriptions.video",{defaultValue:"Video"}),":"]})," ",(0,P.jsx)("a",{href:a.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:a.videoUrl})]})]}):(0,P.jsx)("p",{className:"text-gray-400 dark:text-gray-500 italic",children:r("branches.roomDescriptions.noDescription",{defaultValue:"Keine Beschreibung vorhanden"})})})]},e.categoryId)}))})]})},Ce=e=>{let{branch:t,onEdit:r,onDelete:a,canEdit:l,canDelete:n}=e;const{t:i}=(0,s.Bd)();return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4",children:(0,P.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,P.jsxs)("div",{className:"flex space-x-2",children:[l&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",children:(0,P.jsx)(C.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.edit",{defaultValue:"Bearbeiten"})})]}),n&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>a(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",children:(0,P.jsx)(X.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.delete",{defaultValue:"L\xf6schen"})})]})]})]})})},Ee="branches-table",Te=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)(!1),[n,i]=(0,a.useState)(null),[o,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(!0),[x,h]=(0,a.useState)({name:"",address:"",city:"",country:"",whatsappSettings:{provider:"whatsapp-business-api",apiKey:"",apiSecret:"",phoneNumberId:"",ai:{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}},lobbyPmsSettings:{apiUrl:"",apiKey:"",propertyId:"",syncEnabled:!0,autoCreateTasks:!1,lateCheckInThreshold:"22:00",notificationChannels:["email"],autoSendInvitation:!1},boldPaymentSettings:{apiKey:"",merchantId:"",environment:"sandbox"},doorSystemSettings:{clientId:"",clientSecret:"",username:"",password:"",apiUrl:"https://euopen.ttlock.com",lockIds:[],appName:"TTLock"},emailSettings:{smtpHost:"",smtpPort:587,smtpUser:"",smtpPass:"",smtpFromEmail:"",smtpFromName:"",imap:{enabled:!1,host:"",port:993,secure:!0,user:"",password:"",folder:"INBOX",processedFolder:""}},messageTemplates:{checkInInvitation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}},checkInConfirmation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}}},autoSendReservationInvitation:!1}),[p,y]=(0,a.useState)("whatsapp"),[k,j]=(0,a.useState)({}),[A,S]=(0,a.useState)("checkInInvitation"),[C,E]=(0,a.useState)("en"),[T,D]=(0,a.useState)(""),[L,z]=(0,a.useState)(!1),[I,F]=(0,a.useState)([]),[_,B]=(0,a.useState)([]),[V,O]=(0,a.useState)(""),[M,U]=(0,a.useState)(null),[q,W]=(0,a.useState)(10),{hasPermission:G}=(0,l.S)(),{openSidepane:K,closeSidepane:J}=(0,R.N)(),{handleError:Y}=(0,H.qz)(),Z=G("branches","write","table"),X=G("branches","write","table"),$=G("branches","write","table"),ae=(0,a.useCallback)((async()=>{u(!0);try{const e=await w.A.get(N.Sn.BRANCHES.BASE);d(e.data)}catch(e){console.error("Fehler beim Laden der Niederlassungen:",e),Y(e)}finally{u(!1)}}),[Y]);(0,a.useEffect)((()=>{ae()}),[ae]),(0,a.useEffect)((()=>(t?K():J(),()=>{J()})),[t,K,J]);const se=()=>{h({name:"",address:"",city:"",country:"",whatsappSettings:{provider:"whatsapp-business-api",apiKey:"",apiSecret:"",phoneNumberId:"",ai:{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}},lobbyPmsSettings:{apiUrl:"",apiKey:"",propertyId:"",syncEnabled:!0,autoCreateTasks:!1,lateCheckInThreshold:"22:00",notificationChannels:["email"],autoSendInvitation:!1},boldPaymentSettings:{apiKey:"",merchantId:"",environment:"sandbox"},doorSystemSettings:{clientId:"",clientSecret:"",username:"",password:"",apiUrl:"https://euopen.ttlock.com",lockIds:[],appName:"TTLock"},sireSettings:{enabled:!1,autoRegisterOnCheckIn:!1,apiUrl:"",apiKey:"",apiSecret:"",propertyCode:""},emailSettings:{smtpHost:"",smtpPort:587,smtpUser:"",smtpPass:"",smtpFromEmail:"",smtpFromName:"",imap:{enabled:!1,host:"",port:993,secure:!0,user:"",password:"",folder:"INBOX",processedFolder:""}},messageTemplates:{checkInInvitation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}},checkInConfirmation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}}},autoSendReservationInvitation:!1}),y("whatsapp"),i(null)},le=async e=>{i(e);const t=e.whatsappSettings||{},a=e.lobbyPmsSettings||{};let s=e.boldPaymentSettings;if(s){if("string"===typeof s)try{s=JSON.parse(s)}catch(c){console.error("Fehler beim Parsen von boldPaymentSettings:",c),s={}}}else s={};const l=e.doorSystemSettings||{},n=e.emailSettings||{},o=e.messageTemplates||{},d=e.autoSendReservationInvitation||!1;h({name:e.name,address:e.address||"",city:e.city||"",country:e.country||"",whatsappSettings:{provider:t.provider||"whatsapp-business-api",apiKey:t.apiKey||"",apiSecret:t.apiSecret||"",phoneNumberId:t.phoneNumberId||"",ai:t.ai||{enabled:!1,model:"gpt-4o",systemPrompt:"",rules:[],sources:[],temperature:.7,maxTokens:500}},lobbyPmsSettings:{apiUrl:a.apiUrl||"",apiKey:a.apiKey||"",propertyId:a.propertyId||"",syncEnabled:void 0===a.syncEnabled||a.syncEnabled,autoCreateTasks:a.autoCreateTasks||!1,lateCheckInThreshold:a.lateCheckInThreshold||"22:00",notificationChannels:a.notificationChannels||["email"],autoSendInvitation:a.autoSendInvitation||!1},boldPaymentSettings:{apiKey:s.apiKey&&!s.apiKey.includes(":")?s.apiKey:"",merchantId:s.merchantId&&!s.merchantId.includes(":")?s.merchantId:"",environment:s.environment||"sandbox",_hasEncryptedValues:s.apiKey&&s.apiKey.includes(":")||s.merchantId&&s.merchantId.includes(":")},doorSystemSettings:{clientId:l.clientId||"",clientSecret:l.clientSecret||"",username:l.username||"",password:l.password||"",apiUrl:l.apiUrl||"https://euopen.ttlock.com",lockIds:l.lockIds||[],appName:l.appName||"TTLock"},emailSettings:{smtpHost:n.smtpHost||"",smtpPort:n.smtpPort||587,smtpUser:n.smtpUser||"",smtpPass:n.smtpPass||"",smtpFromEmail:n.smtpFromEmail||"",smtpFromName:n.smtpFromName||"",imap:n.imap||{enabled:!1,host:"",port:993,secure:!0,user:"",password:"",folder:"INBOX",processedFolder:""}},messageTemplates:o||{checkInInvitation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}},checkInConfirmation:{en:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},es:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""},de:{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""}}},autoSendReservationInvitation:d}),r(!0)},ne=()=>{r(!1),se()},ie=async t=>{if(t.preventDefault(),x.name.trim())try{n?await w.A.put(N.Sn.BRANCHES.UPDATE(n.id),{name:x.name.trim(),address:x.address.trim()||null,city:x.city.trim()||null,country:x.country.trim()||null,whatsappSettings:x.whatsappSettings,lobbyPmsSettings:x.lobbyPmsSettings,boldPaymentSettings:{apiKey:x.boldPaymentSettings.apiKey,merchantId:x.boldPaymentSettings.merchantId,environment:x.boldPaymentSettings.environment},doorSystemSettings:x.doorSystemSettings,emailSettings:x.emailSettings,messageTemplates:x.messageTemplates,autoSendReservationInvitation:x.autoSendReservationInvitation}):await w.A.post(N.Sn.BRANCHES.CREATE,{name:x.name.trim()}),await ae(),ne()}catch(r){console.error("Fehler beim Speichern der Niederlassung:",r),Y(r)}else Y({message:e("branches.nameRequired")})},oe=async t=>{if(window.confirm(e("branches.deleteConfirm",{defaultValue:"M\xf6chten Sie diese Niederlassung wirklich l\xf6schen?"})))try{await w.A.delete(N.Sn.BRANCHES.DELETE(t)),await ae()}catch(r){console.error("Fehler beim L\xf6schen der Niederlassung:",r),Y(r)}},de=()=>I.length,ce=(0,a.useMemo)((()=>o.filter((e=>{if(T){const t=T.toLowerCase();if(!e.name.toLowerCase().includes(t))return!1}if(I.length>0){let t=I.length>0;for(let r=0;r<I.length;r++){const a=I[r];let s=!1;if("name"===a.column){const t=e.name.toLowerCase(),r=(a.value||"").toLowerCase();"equals"===a.operator?s=t===r:"contains"===a.operator?s=t.includes(r):"startsWith"===a.operator&&(s=t.startsWith(r))}if(0===r)t=s;else{t="AND"===_[r-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())))),[o,T,I,_]),ue=(e,t)=>{F(e),B(t)},me=()=>{F([]),B([]),O(""),U(null)},ge=async(e,t,r,a)=>{O(e),U(t),ue(r,a)},xe=(0,re.b)(),{loadFilters:be}=xe;(0,a.useEffect)((()=>{(async()=>{const e=(await be(Ee)).find((e=>"Alle"===e.name));e&&await ge(e.name,e.id,e.conditions,e.operators)})()}),[be,ge]),(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error(e("common.notAuthenticated"));const t=(await w.A.get(N.Sn.SAVED_FILTERS.BY_TABLE(Ee))).data||[];if(!t.some((e=>"Alle"===e.name))){const e={tableId:Ee,name:"Alle",conditions:[],operators:[]};await w.A.post(N.Sn.SAVED_FILTERS.BASE,e)}}catch(t){console.error(e("branches.createStandardFiltersError"),t)}})()}),[]);const[he,pe]=(0,a.useState)(window.innerWidth<640);return(0,a.useEffect)((()=>{const e=()=>{pe(window.innerWidth<640)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("div",{className:"flex items-center",children:Z&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>{se(),r(!0)},className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("branches.create",{defaultValue:"Neue Niederlassung"}),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("branches.create",{defaultValue:"Neue Niederlassung"})})]})}),(0,P.jsx)("div",{}),(0,P.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,P.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:T,onChange:e=>D(e.target.value)}),(0,P.jsxs)("div",{className:"relative group ml-1",children:[(0,P.jsxs)("button",{className:"p-2 rounded-md ".concat(de()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"," relative"),onClick:()=>z(!L),children:[(0,P.jsx)(Q.A,{className:"w-5 h-5"}),de()>0&&(0,P.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:de()})]}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter",{defaultValue:"Filter"})})]})]})]}),L&&(0,P.jsx)(ee.A,{columns:[{id:"name",label:e("branches.name",{defaultValue:"Name"})}],onApply:ue,onReset:me,savedConditions:I,savedOperators:_,tableId:Ee}),(0,P.jsx)(te.A,{tableId:Ee,onSelectFilter:ue,onReset:me,activeFilterName:V,selectedFilterId:M,onFilterChange:ge,defaultFilterName:"Alle"}),c?(0,P.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,P.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===ce.length?(0,P.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded text-center",children:(0,P.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:e("branches.noBranches",{defaultValue:"Keine Niederlassungen gefunden. Erstellen Sie eine neue Niederlassung mit dem Button oben."})})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"space-y-4",children:ce.slice(0,q).map((e=>(0,P.jsx)(Ce,{branch:e,onEdit:le,onDelete:oe,canEdit:X,canDelete:$},e.id)))}),ce.length>q&&(0,P.jsx)("div",{className:"mt-4 flex justify-center",children:(0,P.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>W((e=>e+10)),children:[e("common.showMore",{defaultValue:"Mehr anzeigen"})," (",ce.length-q," ",e("common.remaining",{defaultValue:"verbleibend"}),")"]})})]})]}),t&&(0,P.jsx)(P.Fragment,{children:he?(0,P.jsxs)(g.lG,{open:t,onClose:ne,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:n?e("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):e("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,P.jsx)("button",{onClick:ne,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})}),(0,P.jsxs)("form",{onSubmit:ie,className:"p-6 space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.name",{defaultValue:"Name"})}),(0,P.jsx)("input",{type:"text",value:x.name,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.address",{defaultValue:"Adresse"})}),(0,P.jsx)("input",{type:"text",value:x.address,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{address:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.addressPlaceholder",{defaultValue:"Stra\xdfe und Hausnummer"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.city",{defaultValue:"Stadt"})}),(0,P.jsx)("input",{type:"text",value:x.city,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{city:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.cityPlaceholder",{defaultValue:"z.B. Medell\xedn"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.country",{defaultValue:"Land"})}),(0,P.jsx)("input",{type:"text",value:x.country,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{country:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.countryPlaceholder",{defaultValue:"z.B. Kolumbien"})})]}),n&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:(0,P.jsx)("nav",{className:"-mb-px flex space-x-2 overflow-x-auto",children:["whatsapp","lobbypms","boldpayment","doorsystem","email","messages"].map((t=>(0,P.jsx)("button",{type:"button",onClick:()=>y(t),className:"py-2 px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap ".concat(p===t?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:"whatsapp"===t?"WhatsApp":"lobbypms"===t?"LobbyPMS":"boldpayment"===t?"Bold Payment":"doorsystem"===t?"TTLock":"email"===t?"Email":e("branches.messagesTab",{defaultValue:"Nachrichten"})},t)))})}),(0,P.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:["whatsapp"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"WhatsApp Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappProvider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Provider"}),(0,P.jsxs)("select",{id:"whatsappProvider",value:x.whatsappSettings.provider,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{provider:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"twilio",children:"Twilio"}),(0,P.jsx)("option",{value:"whatsapp-business-api",children:"WhatsApp Business API"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappApiKey",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key / Access Token"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.whatsappApiKey?"text":"password",id:"whatsappApiKey",value:x.whatsappSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{apiKey:e.target.value})})),placeholder:"API Key / Access Token",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((e=>(0,m.A)((0,m.A)({},e),{},{whatsappApiKey:!e.whatsappApiKey}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiKey?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number ID"}),(0,P.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",value:x.whatsappSettings.phoneNumberId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{phoneNumberId:e.target.value})})),placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappApiSecret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Secret"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.whatsappApiSecret?"text":"password",id:"whatsappApiSecret",value:x.whatsappSettings.apiSecret,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{apiSecret:e.target.value})})),placeholder:"API Secret",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((e=>(0,m.A)((0,m.A)({},e),{},{whatsappApiSecret:!e.whatsappApiSecret}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiSecret?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"KI-Konfiguration (AI)"}),(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.whatsappSettings.ai.enabled,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:x.whatsappSettings.ai.enabled?"Aktiviert":"Deaktiviert"})]})]}),x.whatsappSettings.ai.enabled&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiModel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Modell"}),(0,P.jsxs)("select",{id:"aiModel",value:x.whatsappSettings.ai.model,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{model:e.target.value})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,P.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,P.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiSystemPrompt",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"System Prompt"}),(0,P.jsx)("textarea",{id:"aiSystemPrompt",value:x.whatsappSettings.ai.systemPrompt,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{systemPrompt:e.target.value})})})),rows:4,placeholder:"Du bist ein hilfreicher Assistent f\xfcr...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Regeln (eine pro Zeile)"}),(0,P.jsx)("textarea",{value:x.whatsappSettings.ai.rules.join("\n"),onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{rules:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:3,placeholder:"Antworte immer auf Spanisch\nSei freundlich und professionell",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quellen/URLs (eine pro Zeile)"}),(0,P.jsx)("textarea",{value:x.whatsappSettings.ai.sources.join("\n"),onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{sources:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:2,placeholder:"https://wiki.example.com/manila-procedures\nhttps://wiki.example.com/faq",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{htmlFor:"aiTemperature",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Temperature (",x.whatsappSettings.ai.temperature,")"]}),(0,P.jsx)("input",{type:"range",id:"aiTemperature",min:"0",max:"2",step:"0.1",value:x.whatsappSettings.ai.temperature,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{temperature:parseFloat(e.target.value)})})})),className:"mt-1 block w-full"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiMaxTokens",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Tokens"}),(0,P.jsx)("input",{type:"number",id:"aiMaxTokens",min:"100",max:"4000",step:"100",value:x.whatsappSettings.ai.maxTokens,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{maxTokens:parseInt(e.target.value)||500})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]})]}),"lobbypms"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"LobbyPMS Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API URL"}),(0,P.jsx)("input",{type:"text",value:x.lobbyPmsSettings.apiUrl,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{apiUrl:e.target.value})})),placeholder:"https://api.lobbypms.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key"}),(0,P.jsx)("input",{type:k.lobbyPmsApiKey?"text":"password",value:x.lobbyPmsSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{apiKey:e.target.value})})),placeholder:"API Key",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Property ID"}),(0,P.jsx)("input",{type:"text",value:x.lobbyPmsSettings.propertyId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{propertyId:e.target.value})})),placeholder:"Property ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),n&&(0,P.jsx)(Se,{branchId:n.id})]}),"boldpayment"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Bold Payment Settings"}),x.boldPaymentSettings._hasEncryptedValues&&(0,P.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md",children:(0,P.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[(0,P.jsx)("strong",{children:"Hinweis:"})," Es sind verschl\xfcsselte Werte vorhanden, die mit einem alten Schl\xfcssel verschl\xfcsselt wurden und nicht mehr entschl\xfcsselt werden k\xf6nnen. Die Payment-Links funktionieren weiterhin. Um die Werte zu \xe4ndern, geben Sie sie neu ein."]})}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key"}),(0,P.jsx)("input",{type:k.boldPaymentApiKey?"text":"password",value:x.boldPaymentSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{apiKey:e.target.value,_hasEncryptedValues:!1})})),placeholder:"API Key",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Merchant ID"}),(0,P.jsx)("input",{type:k.boldPaymentMerchantId?"text":"password",value:x.boldPaymentSettings.merchantId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{merchantId:e.target.value,_hasEncryptedValues:!1})})),placeholder:"Merchant ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Environment"}),(0,P.jsxs)("select",{value:x.boldPaymentSettings.environment,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{environment:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"sandbox",children:"Sandbox"}),(0,P.jsx)("option",{value:"production",children:"Production"})]})]})]})]}),"doorsystem"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"TTLock Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client ID"}),(0,P.jsx)("input",{type:"text",value:x.doorSystemSettings.clientId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{clientId:e.target.value})})),placeholder:"Client ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client Secret"}),(0,P.jsx)("input",{type:k.doorSystemClientSecret?"text":"password",value:x.doorSystemSettings.clientSecret,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{clientSecret:e.target.value})})),placeholder:"Client Secret",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Username"}),(0,P.jsx)("input",{type:"text",value:x.doorSystemSettings.username,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{username:e.target.value})})),placeholder:"Username",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),(0,P.jsx)("input",{type:k.doorSystemPassword?"text":"password",value:x.doorSystemSettings.password,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{password:e.target.value})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),"email"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Email Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Host"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpHost,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpHost:e.target.value})})),placeholder:"smtp.example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Port"}),(0,P.jsx)("input",{type:"number",value:x.emailSettings.smtpPort,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpPort:parseInt(e.target.value)||587})})),placeholder:"587",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP User"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpUser,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpUser:e.target.value})})),placeholder:"user@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Password"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.emailSmtpPass?"text":"password",value:x.emailSettings.smtpPass,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpPass:e.target.value})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((0,m.A)((0,m.A)({},k),{},{emailSmtpPass:!k.emailSmtpPass})),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.emailSmtpPass?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP From Email"}),(0,P.jsx)("input",{type:"email",value:x.emailSettings.smtpFromEmail,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpFromEmail:e.target.value})})),placeholder:"noreply@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP From Name"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpFromName,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpFromName:e.target.value})})),placeholder:"Branch Name",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"IMAP Settings (Email Reading)"}),(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.emailSettings.imap.enabled,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:x.emailSettings.imap.enabled?"Enabled":"Disabled"})]})]}),x.emailSettings.imap.enabled&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Host"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.host,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{host:e.target.value})})})),placeholder:"imap.example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Port"}),(0,P.jsx)("input",{type:"number",value:x.emailSettings.imap.port,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{port:parseInt(e.target.value)||993})})})),placeholder:"993",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsx)("div",{children:(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.emailSettings.imap.secure,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{secure:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:"Secure (SSL/TLS)"})]})}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP User"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.user,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{user:e.target.value})})})),placeholder:"user@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Password"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.emailImapPass?"text":"password",value:x.emailSettings.imap.password,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{password:e.target.value})})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((0,m.A)((0,m.A)({},k),{},{emailImapPass:!k.emailImapPass})),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.emailImapPass?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Folder"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.folder,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{folder:e.target.value})})})),placeholder:"INBOX",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Processed Folder (optional)"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.processedFolder,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{processedFolder:e.target.value})})})),placeholder:"Processed",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:ne,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.cancel",{defaultValue:"Abbrechen"})})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:n?e("common.update",{defaultValue:"Aktualisieren"}):e("common.create",{defaultValue:"Erstellen"})})]})]})]})]})})]}):(0,P.jsxs)("div",{className:"fixed inset-y-0 right-0 w-full sm:min-w-[500px] sm:max-w-[600px] bg-white dark:bg-gray-800 shadow-xl z-50 flex flex-col",children:[(0,P.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n?e("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):e("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,P.jsx)("button",{onClick:ne,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})}),(0,P.jsxs)("form",{onSubmit:ie,className:"flex flex-col flex-1 min-h-0",children:[(0,P.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,P.jsxs)("div",{className:"p-6 space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.name",{defaultValue:"Name"})}),(0,P.jsx)("input",{type:"text",value:x.name,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.address",{defaultValue:"Adresse"})}),(0,P.jsx)("input",{type:"text",value:x.address,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{address:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.addressPlaceholder",{defaultValue:"Stra\xdfe und Hausnummer"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.city",{defaultValue:"Stadt"})}),(0,P.jsx)("input",{type:"text",value:x.city,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{city:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.cityPlaceholder",{defaultValue:"z.B. Medell\xedn"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.country",{defaultValue:"Land"})}),(0,P.jsx)("input",{type:"text",value:x.country,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{country:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",placeholder:e("branches.countryPlaceholder",{defaultValue:"z.B. Kolumbien"})})]}),n&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:(0,P.jsx)("nav",{className:"-mb-px flex space-x-2 overflow-x-auto",children:["whatsapp","lobbypms","boldpayment","doorsystem","email","messages"].map((t=>(0,P.jsx)("button",{type:"button",onClick:()=>y(t),className:"py-2 px-2 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap ".concat(p===t?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:"whatsapp"===t?"WhatsApp":"lobbypms"===t?"LobbyPMS":"boldpayment"===t?"Bold Payment":"doorsystem"===t?"TTLock":"email"===t?"Email":e("branches.messagesTab",{defaultValue:"Nachrichten"})},t)))})}),(0,P.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:["whatsapp"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"WhatsApp Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappProviderDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Provider"}),(0,P.jsxs)("select",{id:"whatsappProviderDesktop",value:x.whatsappSettings.provider,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{provider:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"twilio",children:"Twilio"}),(0,P.jsx)("option",{value:"whatsapp-business-api",children:"WhatsApp Business API"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappApiKey",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key / Access Token"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.whatsappApiKey?"text":"password",id:"whatsappApiKey",value:x.whatsappSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{apiKey:e.target.value})})),placeholder:"API Key / Access Token",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((e=>(0,m.A)((0,m.A)({},e),{},{whatsappApiKey:!e.whatsappApiKey}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiKey?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number ID"}),(0,P.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",value:x.whatsappSettings.phoneNumberId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{phoneNumberId:e.target.value})})),placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"whatsappApiSecretDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Secret"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.whatsappApiSecret?"text":"password",id:"whatsappApiSecretDesktop",value:x.whatsappSettings.apiSecret,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{apiSecret:e.target.value})})),placeholder:"API Secret",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((e=>(0,m.A)((0,m.A)({},e),{},{whatsappApiSecret:!e.whatsappApiSecret}))),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.whatsappApiSecret?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"KI-Konfiguration (AI)"}),(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.whatsappSettings.ai.enabled,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:x.whatsappSettings.ai.enabled?"Aktiviert":"Deaktiviert"})]})]}),x.whatsappSettings.ai.enabled&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiModelDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Modell"}),(0,P.jsxs)("select",{id:"aiModelDesktop",value:x.whatsappSettings.ai.model,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{model:e.target.value})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,P.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,P.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiSystemPromptDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"System Prompt"}),(0,P.jsx)("textarea",{id:"aiSystemPromptDesktop",value:x.whatsappSettings.ai.systemPrompt,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{systemPrompt:e.target.value})})})),rows:4,placeholder:"Du bist ein hilfreicher Assistent f\xfcr...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Regeln (eine pro Zeile)"}),(0,P.jsx)("textarea",{value:x.whatsappSettings.ai.rules.join("\n"),onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{rules:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:3,placeholder:"Antworte immer auf Spanisch\nSei freundlich und professionell",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quellen/URLs (eine pro Zeile)"}),(0,P.jsx)("textarea",{value:x.whatsappSettings.ai.sources.join("\n"),onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{sources:e.target.value.split("\n").filter((e=>e.trim()))})})})),rows:2,placeholder:"https://wiki.example.com/manila-procedures\nhttps://wiki.example.com/faq",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{htmlFor:"aiTemperatureDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Temperature (",x.whatsappSettings.ai.temperature,")"]}),(0,P.jsx)("input",{type:"range",id:"aiTemperatureDesktop",min:"0",max:"2",step:"0.1",value:x.whatsappSettings.ai.temperature,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{temperature:parseFloat(e.target.value)})})})),className:"mt-1 block w-full"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"aiMaxTokensDesktop",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Tokens"}),(0,P.jsx)("input",{type:"number",id:"aiMaxTokensDesktop",min:"100",max:"4000",step:"100",value:x.whatsappSettings.ai.maxTokens,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{whatsappSettings:(0,m.A)((0,m.A)({},x.whatsappSettings),{},{ai:(0,m.A)((0,m.A)({},x.whatsappSettings.ai),{},{maxTokens:parseInt(e.target.value)||500})})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]})]}),"lobbypms"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"LobbyPMS Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API URL"}),(0,P.jsx)("input",{type:"text",value:x.lobbyPmsSettings.apiUrl,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{apiUrl:e.target.value})})),placeholder:"https://api.lobbypms.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key"}),(0,P.jsx)("input",{type:k.lobbyPmsApiKey?"text":"password",value:x.lobbyPmsSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{apiKey:e.target.value})})),placeholder:"API Key",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Property ID"}),(0,P.jsx)("input",{type:"text",value:x.lobbyPmsSettings.propertyId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{lobbyPmsSettings:(0,m.A)((0,m.A)({},x.lobbyPmsSettings),{},{propertyId:e.target.value})})),placeholder:"Property ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),n&&(0,P.jsx)(Se,{branchId:n.id})]}),"boldpayment"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Bold Payment Settings"}),x.boldPaymentSettings._hasEncryptedValues&&(0,P.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md",children:(0,P.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[(0,P.jsx)("strong",{children:"Hinweis:"})," Es sind verschl\xfcsselte Werte vorhanden, die mit einem alten Schl\xfcssel verschl\xfcsselt wurden und nicht mehr entschl\xfcsselt werden k\xf6nnen. Die Payment-Links funktionieren weiterhin. Um die Werte zu \xe4ndern, geben Sie sie neu ein."]})}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Key"}),(0,P.jsx)("input",{type:k.boldPaymentApiKey?"text":"password",value:x.boldPaymentSettings.apiKey,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{apiKey:e.target.value,_hasEncryptedValues:!1})})),placeholder:"API Key",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Merchant ID"}),(0,P.jsx)("input",{type:k.boldPaymentMerchantId?"text":"password",value:x.boldPaymentSettings.merchantId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{merchantId:e.target.value,_hasEncryptedValues:!1})})),placeholder:"Merchant ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Environment"}),(0,P.jsxs)("select",{value:x.boldPaymentSettings.environment,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{boldPaymentSettings:(0,m.A)((0,m.A)({},x.boldPaymentSettings),{},{environment:e.target.value})})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"sandbox",children:"Sandbox"}),(0,P.jsx)("option",{value:"production",children:"Production"})]})]})]})]}),"doorsystem"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"TTLock Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client ID"}),(0,P.jsx)("input",{type:"text",value:x.doorSystemSettings.clientId,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{clientId:e.target.value})})),placeholder:"Client ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Client Secret"}),(0,P.jsx)("input",{type:k.doorSystemClientSecret?"text":"password",value:x.doorSystemSettings.clientSecret,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{clientSecret:e.target.value})})),placeholder:"Client Secret",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Username"}),(0,P.jsx)("input",{type:"text",value:x.doorSystemSettings.username,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{username:e.target.value})})),placeholder:"Username",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),(0,P.jsx)("input",{type:k.doorSystemPassword?"text":"password",value:x.doorSystemSettings.password,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{doorSystemSettings:(0,m.A)((0,m.A)({},x.doorSystemSettings),{},{password:e.target.value})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),"email"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Email Settings"}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Host"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpHost,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpHost:e.target.value})})),placeholder:"smtp.example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Port"}),(0,P.jsx)("input",{type:"number",value:x.emailSettings.smtpPort,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpPort:parseInt(e.target.value)||587})})),placeholder:"587",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP User"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpUser,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpUser:e.target.value})})),placeholder:"user@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Password"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.emailSmtpPass?"text":"password",value:x.emailSettings.smtpPass,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpPass:e.target.value})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((0,m.A)((0,m.A)({},k),{},{emailSmtpPass:!k.emailSmtpPass})),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.emailSmtpPass?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP From Email"}),(0,P.jsx)("input",{type:"email",value:x.emailSettings.smtpFromEmail,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpFromEmail:e.target.value})})),placeholder:"noreply@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP From Name"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.smtpFromName,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{smtpFromName:e.target.value})})),placeholder:"Branch Name",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"IMAP Settings (Email Reading)"}),(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.emailSettings.imap.enabled,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{enabled:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:x.emailSettings.imap.enabled?"Enabled":"Disabled"})]})]}),x.emailSettings.imap.enabled&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Host"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.host,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{host:e.target.value})})})),placeholder:"imap.example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Port"}),(0,P.jsx)("input",{type:"number",value:x.emailSettings.imap.port,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{port:parseInt(e.target.value)||993})})})),placeholder:"993",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsx)("div",{children:(0,P.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,P.jsx)("input",{type:"checkbox",checked:x.emailSettings.imap.secure,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{secure:e.target.checked})})})),className:"sr-only peer"}),(0,P.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:"Secure (SSL/TLS)"})]})}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP User"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.user,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{user:e.target.value})})})),placeholder:"user@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Password"}),(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("input",{type:k.emailImapPass?"text":"password",value:x.emailSettings.imap.password,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{password:e.target.value})})})),placeholder:"Password",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,P.jsx)("button",{type:"button",onClick:()=>j((0,m.A)((0,m.A)({},k),{},{emailImapPass:!k.emailImapPass})),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:k.emailImapPass?(0,P.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,P.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,P.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IMAP Folder"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.folder,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{folder:e.target.value})})})),placeholder:"INBOX",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Processed Folder (optional)"}),(0,P.jsx)("input",{type:"text",value:x.emailSettings.imap.processedFolder,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{emailSettings:(0,m.A)((0,m.A)({},x.emailSettings),{},{imap:(0,m.A)((0,m.A)({},x.emailSettings.imap),{},{processedFolder:e.target.value})})})),placeholder:"Processed",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]})]})]}),"messages"===p&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:e("branches.messagesTab",{defaultValue:"Nachrichten"})}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4",children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-1",children:e("branches.autoSendInvitation",{defaultValue:"Automatisches Versenden aktivieren"})}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e("branches.autoSendInvitationDescription",{defaultValue:"Sendet Check-in-Einladungen automatisch 1 Tag vor Check-in-Date um 08:00 Uhr"})})]}),(0,P.jsx)("input",{type:"checkbox",checked:x.autoSendReservationInvitation,onChange:e=>h((0,m.A)((0,m.A)({},x),{},{autoSendReservationInvitation:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})]})}),(0,P.jsxs)("div",{children:[(0,P.jsx)("h5",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:e("branches.messageTemplates",{defaultValue:"Mitteilungsvorlagen"})}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:e("branches.messageTemplatesDescription",{defaultValue:"Konfiguriere die Vorlagen f\xfcr Check-in-Einladungen und Check-in-Best\xe4tigungen"})}),(0,P.jsxs)("div",{className:"mb-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("branches.messageType",{defaultValue:"Mitteilungstyp"})}),(0,P.jsxs)("select",{value:A,onChange:e=>S(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"checkInInvitation",children:e("branches.messageType.checkInInvitation",{defaultValue:"Check-in-Einladung"})}),(0,P.jsx)("option",{value:"checkInConfirmation",children:e("branches.messageType.checkInConfirmation",{defaultValue:"Check-in-Best\xe4tigung"})})]})]}),(0,P.jsxs)("div",{className:"mb-4",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e("branches.language",{defaultValue:"Sprache"})}),(0,P.jsxs)("select",{value:C,onChange:e=>E(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"en",children:e("branches.language.en",{defaultValue:"Englisch"})}),(0,P.jsx)("option",{value:"es",children:e("branches.language.es",{defaultValue:"Spanisch"})}),(0,P.jsx)("option",{value:"de",children:e("branches.language.de",{defaultValue:"Deutsch"})})]})]}),((t,r)=>{const a=(null===(t=x.messageTemplates)||void 0===t||null===(r=t[A])||void 0===r?void 0:r[C])||{whatsappTemplateName:"",whatsappTemplateParams:[],emailSubject:"",emailContent:""};return(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.whatsappTemplateName",{defaultValue:"WhatsApp Template Name"})}),(0,P.jsx)("input",{type:"text",value:a.whatsappTemplateName||"",onChange:e=>{var t;h((0,m.A)((0,m.A)({},x),{},{messageTemplates:(0,m.A)((0,m.A)({},x.messageTemplates),{},{[A]:(0,m.A)((0,m.A)({},null===(t=x.messageTemplates)||void 0===t?void 0:t[A]),{},{[C]:(0,m.A)((0,m.A)({},a),{},{whatsappTemplateName:e.target.value})})})}))},placeholder:"reservation_checkin_invitation_en",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.whatsappTemplateParams",{defaultValue:"WhatsApp Template Parameter"})}),(0,P.jsx)("input",{type:"text",value:Array.isArray(a.whatsappTemplateParams)?a.whatsappTemplateParams.join(", "):a.whatsappTemplateParams||"",onChange:e=>{var t;const r=e.target.value.split(",").map((e=>e.trim())).filter((e=>e));h((0,m.A)((0,m.A)({},x),{},{messageTemplates:(0,m.A)((0,m.A)({},x.messageTemplates),{},{[A]:(0,m.A)((0,m.A)({},null===(t=x.messageTemplates)||void 0===t?void 0:t[A]),{},{[C]:(0,m.A)((0,m.A)({},a),{},{whatsappTemplateParams:r})})})}))},placeholder:"{{1}}, {{2}}, {{3}}",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:e("branches.whatsappTemplateParamsHint",{defaultValue:"Komma-separiert, z.B. {{1}}, {{2}}, {{3}}"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.emailSubject",{defaultValue:"Email Betreff"})}),(0,P.jsx)("input",{type:"text",value:a.emailSubject||"",onChange:e=>{var t;h((0,m.A)((0,m.A)({},x),{},{messageTemplates:(0,m.A)((0,m.A)({},x.messageTemplates),{},{[A]:(0,m.A)((0,m.A)({},null===(t=x.messageTemplates)||void 0===t?void 0:t[A]),{},{[C]:(0,m.A)((0,m.A)({},a),{},{emailSubject:e.target.value})})})}))},placeholder:"Welcome to La Familia Hostel - Online Check-in",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("branches.emailContent",{defaultValue:"Email Inhalt"})}),(0,P.jsx)("textarea",{rows:10,value:a.emailContent||"",onChange:e=>{var t;h((0,m.A)((0,m.A)({},x),{},{messageTemplates:(0,m.A)((0,m.A)({},x.messageTemplates),{},{[A]:(0,m.A)((0,m.A)({},null===(t=x.messageTemplates)||void 0===t?void 0:t[A]),{},{[C]:(0,m.A)((0,m.A)({},a),{},{emailContent:e.target.value})})})}))},placeholder:"Hello {{guestName}}, ...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,P.jsxs)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e("branches.templateVariables",{defaultValue:"Verf\xfcgbare Variablen"}),":",(0,P.jsx)("span",{className:"font-mono",children:"checkInInvitation"===A?e("branches.templateVariables.checkInInvitation",{defaultValue:"{{guestName}}, {{checkInLink}}, {{paymentLink}}"}):e("branches.templateVariables.checkInConfirmation",{defaultValue:"{{guestName}}, {{roomDisplay}}, {{doorPin}}, {{doorAppName}}"})})]})]})]})})()]})]})]})]})]})]})}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2 px-6 pb-6 border-t dark:border-gray-700",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"button",onClick:ne,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.cancel",{defaultValue:"Abbrechen"})})]}),(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",children:(0,P.jsx)(v.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:n?e("common.update",{defaultValue:"Aktualisieren"}):e("common.create",{defaultValue:"Erstellen"})})]})]})]})]})})]})},De=e=>{let{isOpen:t,onClose:r,onProviderCreated:l}=e;const{t:n}=(0,s.Bd)(),{user:i}=(0,L.As)(),{showMessage:o}=(0,k.A)(),{openSidepane:d,closeSidepane:c}=(0,R.N)(),[u,m]=(0,a.useState)(window.innerWidth<640),[x,b]=(0,a.useState)(window.innerWidth>1070),[h,p]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[A,S]=(0,a.useState)(""),[C,E]=(0,a.useState)(""),[T,D]=(0,a.useState)(""),[z,I]=(0,a.useState)(""),[F,_]=(0,a.useState)([]),[B,V]=(0,a.useState)(null),[O,M]=(0,a.useState)(!1),[U,q]=(0,a.useState)(!0);(0,a.useEffect)((()=>{t&&(async()=>{try{var e;q(!0);const t=await w.A.get(N.Sn.BRANCHES.BASE);_((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[])}catch(t){console.error("Error loading data:",t),o(n("errors.loadError"),"error")}finally{q(!1)}})()}),[t,n,o]),(0,a.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),b(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]),(0,a.useEffect)((()=>{t||(p(""),j(""),S(""),E(""),D(""),I(""),V(null))}),[t]);const W=async e=>{if(e.preventDefault(),V(null),h.trim()){M(!0);try{var t,r;const e=await w.A.post(N.Sn.TOUR_PROVIDERS.BASE,{name:h.trim(),phone:y.trim()||null,email:A.trim()||null,contactPerson:C.trim()||null,notes:T.trim()||null,branchId:z?Number(z):null});var a;if(null===(t=e.data)||void 0===t||!t.success||null===(r=e.data)||void 0===r||!r.data)throw new Error((null===(a=e.data)||void 0===a?void 0:a.message)||n("tours.providers.createError",{defaultValue:"Fehler beim Erstellen des Providers"}));o(n("tours.providers.created",{defaultValue:"Tour-Provider erfolgreich erstellt"}),"success"),l(e.data.data),G()}catch(d){var s,i;console.error("Error creating provider:",d);const e=(null===d||void 0===d||null===(s=d.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||(null===d||void 0===d?void 0:d.message)||n("errors.unknownError");V(e),o(e,"error")}finally{M(!1)}}else V(n("tours.providers.validation.nameRequired",{defaultValue:"Name ist erforderlich"}))},G=()=>{p(""),j(""),S(""),E(""),D(""),I(""),V(null),r()};return u?(0,P.jsxs)(g.lG,{open:t,onClose:G,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("tours.providers.create",{defaultValue:"Neuer Tour-Provider"})}),(0,P.jsx)("button",{onClick:G,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:W,className:"p-4 space-y-4",children:[B&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,P.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:B})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.providers.name",{defaultValue:"Name"})," *"]}),(0,P.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.contactPerson",{defaultValue:"Ansprechpartner"})}),(0,P.jsx)("input",{type:"text",value:C,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.phone",{defaultValue:"Telefon"})}),(0,P.jsx)("input",{type:"tel",value:y,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.email",{defaultValue:"E-Mail"})}),(0,P.jsx)("input",{type:"email",value:A,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.branch",{defaultValue:"Niederlassung"})}),(0,P.jsxs)("select",{value:z,onChange:e=>I(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U,children:[(0,P.jsx)("option",{value:"",children:n("common.all",{defaultValue:"Alle"})}),F.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.notes",{defaultValue:"Notizen"})}),(0,P.jsx)("textarea",{value:T,onChange:e=>D(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:G,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:O||U,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:O?n("common.saving","Speichere..."):n("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!x&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n("tours.providers.create",{defaultValue:"Neuer Tour-Provider"})}),(0,P.jsx)("button",{onClick:G,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[B&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,P.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:B})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.providers.name",{defaultValue:"Name"})," *"]}),(0,P.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.contactPerson",{defaultValue:"Ansprechpartner"})}),(0,P.jsx)("input",{type:"text",value:C,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.phone",{defaultValue:"Telefon"})}),(0,P.jsx)("input",{type:"tel",value:y,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.email",{defaultValue:"E-Mail"})}),(0,P.jsx)("input",{type:"email",value:A,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.branch",{defaultValue:"Niederlassung"})}),(0,P.jsxs)("select",{value:z,onChange:e=>I(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U,children:[(0,P.jsx)("option",{value:"",children:n("common.all",{defaultValue:"Alle"})}),F.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.providers.notes",{defaultValue:"Notizen"})}),(0,P.jsx)("textarea",{value:T,onChange:e=>D(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:O||U})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:G,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:O||U,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:O?n("common.saving","Speichere..."):n("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]})]})},Le=e=>{let{isOpen:t,onClose:r,provider:l,onProviderUpdated:n}=e;const{t:i}=(0,s.Bd)(),{user:o}=(0,L.As)(),{showMessage:d}=(0,k.A)(),{openSidepane:c,closeSidepane:u}=(0,R.N)(),[m,x]=(0,a.useState)(window.innerWidth<640),[b,h]=(0,a.useState)(window.innerWidth>1070),[p,y]=(0,a.useState)(""),[j,A]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[E,T]=(0,a.useState)(""),[D,z]=(0,a.useState)(""),[I,F]=(0,a.useState)(""),[_,B]=(0,a.useState)([]),[V,O]=(0,a.useState)(null),[M,U]=(0,a.useState)(!1),[q,W]=(0,a.useState)(!0);(0,a.useEffect)((()=>{t&&(async()=>{try{var e;W(!0);const t=await w.A.get(N.Sn.BRANCHES.BASE);B((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[])}catch(t){console.error("Error loading data:",t),d(i("errors.loadError"),"error")}finally{W(!1)}})()}),[t,i,d]),(0,a.useEffect)((()=>{const e=()=>{x(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?c():u(),()=>{u()})),[t,c,u]),(0,a.useEffect)((()=>{l?(y(l.name||""),A(l.phone||""),C(l.email||""),T(l.contactPerson||""),z(l.notes||""),F(l.branchId||"")):(y(""),A(""),C(""),T(""),z(""),F("")),O(null)}),[l,t]);const G=async e=>{if(e.preventDefault(),l)if(O(null),p.trim()){U(!0);try{var t,r;const e=await w.A.put(N.Sn.TOUR_PROVIDERS.BY_ID(l.id),{name:p.trim(),phone:j.trim()||null,email:S.trim()||null,contactPerson:E.trim()||null,notes:D.trim()||null,branchId:I?Number(I):null});var a;if(null===(t=e.data)||void 0===t||!t.success||null===(r=e.data)||void 0===r||!r.data)throw new Error((null===(a=e.data)||void 0===a?void 0:a.message)||i("tours.providers.updateError",{defaultValue:"Fehler beim Aktualisieren des Providers"}));d(i("tours.providers.updated",{defaultValue:"Tour-Provider erfolgreich aktualisiert"}),"success"),n(e.data.data),H()}catch(c){var s,o;console.error("Error updating provider:",c);const e=(null===c||void 0===c||null===(s=c.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||(null===c||void 0===c?void 0:c.message)||i("errors.unknownError");O(e),d(e,"error")}finally{U(!1)}}else O(i("tours.providers.validation.nameRequired",{defaultValue:"Name ist erforderlich"}))},H=()=>{r()};return l?m?(0,P.jsxs)(g.lG,{open:t,onClose:H,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i("tours.providers.edit",{defaultValue:"Tour-Provider bearbeiten"})}),(0,P.jsx)("button",{onClick:H,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:G,className:"p-4 space-y-4",children:[V&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,P.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:V})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("tours.providers.name",{defaultValue:"Name"})," *"]}),(0,P.jsx)("input",{type:"text",value:p,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.contactPerson",{defaultValue:"Ansprechpartner"})}),(0,P.jsx)("input",{type:"text",value:E,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.phone",{defaultValue:"Telefon"})}),(0,P.jsx)("input",{type:"tel",value:j,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.email",{defaultValue:"E-Mail"})}),(0,P.jsx)("input",{type:"email",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.branch",{defaultValue:"Niederlassung"})}),(0,P.jsxs)("select",{value:I,onChange:e=>F(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q,children:[(0,P.jsx)("option",{value:"",children:i("common.all",{defaultValue:"Alle"})}),_.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.notes",{defaultValue:"Notizen"})}),(0,P.jsx)("textarea",{value:D,onChange:e=>z(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:H,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:M||q,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:M?i("common.saving","Speichere..."):i("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!b&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("tours.providers.edit",{defaultValue:"Tour-Provider bearbeiten"})}),(0,P.jsx)("button",{onClick:H,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:G,className:"space-y-4",children:[V&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,P.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:V})}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("tours.providers.name",{defaultValue:"Name"})," *"]}),(0,P.jsx)("input",{type:"text",value:p,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.contactPerson",{defaultValue:"Ansprechpartner"})}),(0,P.jsx)("input",{type:"text",value:E,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.phone",{defaultValue:"Telefon"})}),(0,P.jsx)("input",{type:"tel",value:j,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.email",{defaultValue:"E-Mail"})}),(0,P.jsx)("input",{type:"email",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.branch",{defaultValue:"Niederlassung"})}),(0,P.jsxs)("select",{value:I,onChange:e=>F(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q,children:[(0,P.jsx)("option",{value:"",children:i("common.all",{defaultValue:"Alle"})}),_.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("tours.providers.notes",{defaultValue:"Notizen"})}),(0,P.jsx)("textarea",{value:D,onChange:e=>z(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:M||q})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:H,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:M||q,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:M?i("common.saving","Speichere..."):i("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]})]}):null},Re=e=>{let{provider:t,onEdit:r,onDelete:a,canEdit:l,canDelete:n}=e;const{t:i}=(0,s.Bd)();return(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4",children:[(0,P.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,P.jsxs)("div",{className:"flex space-x-2",children:[l&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:i("common.edit",{defaultValue:"Bearbeiten"}),children:(0,P.jsx)(C.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.edit",{defaultValue:"Bearbeiten"})})]}),n&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>a(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",title:i("common.delete",{defaultValue:"L\xf6schen"}),children:(0,P.jsx)(X.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.delete",{defaultValue:"L\xf6schen"})})]})]})]}),(0,P.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[t.contactPerson&&(0,P.jsxs)("p",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("tours.providers.contactPerson",{defaultValue:"Ansprechpartner"}),":"]})," ",t.contactPerson]}),t.phone&&(0,P.jsxs)("p",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("tours.providers.phone",{defaultValue:"Telefon"}),":"]})," ",t.phone]}),t.email&&(0,P.jsxs)("p",{children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("tours.providers.email",{defaultValue:"E-Mail"}),":"]})," ",t.email]}),t.notes&&(0,P.jsxs)("p",{className:"mt-2 text-xs",children:[(0,P.jsxs)("span",{className:"font-medium",children:[i("tours.providers.notes",{defaultValue:"Notizen"}),":"]})," ",t.notes]})]})]})},Pe=()=>{const{t:e}=(0,s.Bd)(),{showMessage:t}=(0,k.A)(),r=(0,H.qz)(),n=(null===r||void 0===r?void 0:r.handleError)||((r,a)=>{var s,l;console.error("Error:",r,a);const n=(null===r||void 0===r||null===(s=r.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message)||(null===r||void 0===r?void 0:r.message)||e("errors.unknownError",{defaultValue:"Ein Fehler ist aufgetreten"});t(n,"error")}),[i,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[g,x]=(0,a.useState)([]),[h,p]=(0,a.useState)(!0),[y,f]=(0,a.useState)(""),{hasPermission:v}=(0,l.S)(),j=v("tour_providers","write","table"),A=v("tour_providers","write","table"),S=v("tour_providers","write","table"),C=(0,a.useCallback)((async()=>{p(!0);try{var r;const e=await w.A.get(N.Sn.TOUR_PROVIDERS.BASE),t=(null===(r=e.data)||void 0===r?void 0:r.data)||e.data||[];x(Array.isArray(t)?t:[])}catch(l){var a,s;console.error("Error loading tour providers:",l),n(l);const r=(null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||e("tours.providers.loadError",{defaultValue:"Fehler beim Laden der Provider"});t(r,"error")}finally{p(!1)}}),[n]);(0,a.useEffect)((()=>{C()}),[C]);const E=g.filter((e=>{var t,r,a,s;if(!y)return!0;const l=y.toLowerCase();return e.name.toLowerCase().includes(l)||(null===(t=e.contactPerson)||void 0===t?void 0:t.toLowerCase().includes(l))||(null===(r=e.phone)||void 0===r?void 0:r.toLowerCase().includes(l))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(l))||(null===(s=e.notes)||void 0===s?void 0:s.toLowerCase().includes(l))})),T=e=>{m(e),c(!0)},D=async r=>{if(window.confirm(e("tours.providers.deleteConfirm",{defaultValue:"M\xf6chten Sie diesen Provider wirklich l\xf6schen?"})))try{await w.A.delete(N.Sn.TOUR_PROVIDERS.BY_ID(r)),t(e("tours.providers.deleted",{defaultValue:"Tour-Provider erfolgreich gel\xf6scht"}),"success"),C()}catch(l){var a,s;console.error("Error deleting provider:",l),n(l);const r=(null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||e("errors.unknownError");t(r,"error")}};return h?(0,P.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,P.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:e("common.loading",{defaultValue:"Lade..."})})}):(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,P.jsx)("div",{className:"flex-1 w-full sm:max-w-md",children:(0,P.jsx)("input",{type:"text",placeholder:e("tours.providers.search",{defaultValue:"Provider suchen..."}),value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),j&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>{o(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tours.providers.create",{defaultValue:"Neuer Provider"}),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.providers.create",{defaultValue:"Neuer Provider"})})]})]}),0===E.length?(0,P.jsx)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:y?e("tours.providers.noResults",{defaultValue:"Keine Provider gefunden"}):e("tours.providers.empty",{defaultValue:"Keine Tour-Provider vorhanden"})}):(0,P.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map((e=>(0,P.jsx)(Re,{provider:e,onEdit:T,onDelete:D,canEdit:A,canDelete:S},e.id)))}),(0,P.jsx)(De,{isOpen:i,onClose:()=>o(!1),onProviderCreated:e=>{C()}}),(0,P.jsx)(Le,{isOpen:d,onClose:()=>{c(!1),m(null)},provider:u,onProviderUpdated:e=>{C()}})]})};var ze=r(4850),Ie=r(1663),Fe=r(1909),_e=r(1252),Be=r(1602),Ve=r(637),Oe=r(2023),Me=r(8897);let Ue=function(e){return e.OWN="own",e.EXTERNAL="external",e}({});const qe=e=>{let{isOpen:t,onClose:r,onTourCreated:l}=e;const{t:n}=(0,s.Bd)(),{user:i}=(0,L.As)(),{showMessage:o}=(0,k.A)(),{openSidepane:d,closeSidepane:c}=(0,R.N)(),[u,m]=(0,a.useState)(window.innerWidth<640),[x,b]=(0,a.useState)(window.innerWidth>1070),[h,p]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[A,S]=(0,a.useState)(Ue.OWN),[C,E]=(0,a.useState)(!0),[T,D]=(0,a.useState)(""),[z,I]=(0,a.useState)(""),[F,_]=(0,a.useState)(""),[B,V]=(0,a.useState)(""),[O,M]=(0,a.useState)("COP"),[U,q]=(0,a.useState)(""),[W,G]=(0,a.useState)(""),[H,K]=(0,a.useState)(""),[J,Y]=(0,a.useState)(""),[Z,X]=(0,a.useState)(""),[$,Q]=(0,a.useState)(""),[ee,te]=(0,a.useState)(""),[re,ae]=(0,a.useState)(""),[se,le]=(0,a.useState)(""),[ne,ie]=(0,a.useState)(""),[oe,de]=(0,a.useState)(""),[ce,ue]=(0,a.useState)(""),[me,ge]=(0,a.useState)(null),[xe,be]=(0,a.useState)(null),[he,pe]=(0,a.useState)([]),[ye,fe]=(0,a.useState)([]),[ve,ke]=(0,a.useState)(!1),[je,we]=(0,a.useState)([]),[Ne,Ae]=(0,a.useState)([]),[Se,Ce]=(0,a.useState)(null),[Ee,Te]=(0,a.useState)(!1),[De,Le]=(0,a.useState)(!0);(0,a.useEffect)((()=>{t&&(async()=>{try{var e,t,r;Le(!0);const[a,s]=await Promise.all([w.A.get(N.Sn.BRANCHES.BASE),w.A.get((null===(e=N.Sn.TOUR_PROVIDERS)||void 0===e?void 0:e.BASE)||"/api/tour-providers")]);we((null===(t=a.data)||void 0===t?void 0:t.data)||a.data||[]),Ae((null===(r=s.data)||void 0===r?void 0:r.data)||s.data||[])}catch(a){console.error("Error loading data:",a),o(n("errors.loadError"),"error")}finally{Le(!1)}})()}),[t,n,o]),(0,a.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),b(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]),(0,a.useEffect)((()=>{t||(p(""),j(""),S(Ue.OWN),E(!0),D(""),I(""),_(""),V(""),M("COP"),q(""),G(""),K(""),Y(""),X(""),Q(""),te(""),ae(""),le(""),ie(""),de(""),ue(""),ge(null),be(null),pe([]),fe([]),Ce(null))}),[t]);const Re=async e=>{if(e.preventDefault(),Ce(null),!h.trim()||h.trim().length<3)return void Ce(n("tours.validation.titleMinLength",{defaultValue:"Titel muss mindestens 3 Zeichen lang sein"}));const t=z?Number(z):null,r=F?Number(F):null;if(null!==t&&null!==r&&t<r)Ce(n("tours.validation.maxParticipantsMin",{defaultValue:"Maximale Teilnehmeranzahl muss >= minimale Teilnehmeranzahl sein"}));else if(A!==Ue.EXTERNAL||ne)if(""!==B&&Number(B)<0)Ce(n("tours.validation.priceNonNegative",{defaultValue:"Preis muss >= 0 sein"}));else if(""!==$&&Number($)<0)Ce(n("tours.validation.commissionNonNegative",{defaultValue:"Kommission muss >= 0 sein"}));else{Te(!0);try{const e={title:h,description:y||null,type:A,isActive:C,duration:T?Number(T):null,maxParticipants:z?Number(z):null,minParticipants:F?Number(F):null,price:B?Number(B):null,currency:O||"COP",location:U||null,meetingPoint:W||null,includes:H||null,excludes:J||null,requirements:Z||null,totalCommission:$?Number($):null,totalCommissionPercent:ee?Number(ee):null,sellerCommissionPercent:re?Number(re):null,sellerCommissionFixed:se?Number(se):null,externalProviderId:ne?Number(ne):null,externalBookingUrl:oe||null,branchId:ce?Number(ce):null},t=await w.A.post(N.Sn.TOURS.BASE,e);if(t.data.success){const e=t.data.data;if(me&&e.id)try{ke(!0);const t=new FormData;t.append("image",me),await w.A.post(N.Sn.TOURS.UPLOAD_IMAGE(e.id),t,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){console.error("Error uploading main image:",i),o(n("tours.imageUploadError","Tour erstellt, aber Fehler beim Hochladen des Bildes"),"warning")}finally{ke(!1)}if(he.length>0&&e.id)try{ke(!0);for(const t of he){const r=new FormData;r.append("image",t),await w.A.post(N.Sn.TOURS.UPLOAD_GALLERY(e.id),r,{headers:{"Content-Type":"multipart/form-data"}})}}catch(d){console.error("Error uploading gallery images:",d),o(n("tours.galleryUploadError","Tour erstellt, aber Fehler beim Hochladen der Galerie-Bilder"),"warning")}finally{ke(!1)}o(n("tours.createSuccess","Tour erfolgreich erstellt"),"success");const r=await w.A.get(N.Sn.TOURS.BY_ID(e.id));l(r.data.data),Pe()}else Ce(t.data.message||n("errors.saveError"))}catch(c){var a,s;console.error("Error creating tour:",c);const e=(null===c||void 0===c||null===(a=c.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||(null===c||void 0===c?void 0:c.message)||n("errors.saveError");Ce(e),o(e,"error")}finally{Te(!1)}}else Ce(n("tours.validation.externalProviderRequired",{defaultValue:"Externer Anbieter ist bei externen Touren erforderlich"}))},Pe=()=>{p(""),j(""),S(Ue.OWN),E(!0),D(""),I(""),_(""),V(""),M("COP"),q(""),G(""),K(""),Y(""),X(""),Q(""),te(""),ae(""),le(""),ie(""),de(""),ue(""),ge(null),be(null),pe([]),fe([]),Ce(null),r()};return u?(0,P.jsxs)(g.lG,{open:t,onClose:Pe,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:n("tours.create","Neue Tour erstellen")}),(0,P.jsx)("button",{onClick:Pe,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:Re,className:"p-6 space-y-6",children:[Se&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:Se}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.basicInfo","Grundinformationen")}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.name","Titel")," *"]}),(0,P.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.description","Beschreibung")}),(0,P.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.type","Typ")," *"]}),(0,P.jsxs)("select",{value:A,onChange:e=>S(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:Ue.OWN,children:n("tours.typeOwn","Eigene Tour")}),(0,P.jsx)("option",{value:Ue.EXTERNAL,children:n("tours.typeExternal","Externe Tour")})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.status","Status")}),(0,P.jsxs)("select",{value:C?"true":"false",onChange:e=>E("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"true",children:n("tours.statusActive","Aktiv")}),(0,P.jsx)("option",{value:"false",children:n("tours.statusInactive","Inaktiv")})]})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.branch","Niederlassung")}),(0,P.jsxs)("select",{value:ce,onChange:e=>ue(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:n("common.all","Alle")}),je.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.details","Tour-Details")}),(0,P.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.duration","Dauer (Stunden)")}),(0,P.jsx)("input",{type:"number",value:T,onChange:e=>D(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.minParticipants","Min. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:F,onChange:e=>_(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.maxParticipants","Max. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:z,onChange:e=>I(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.price","Preis")}),(0,P.jsx)("input",{type:"number",value:B,onChange:e=>V(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.currency","W\xe4hrung")}),(0,P.jsx)("input",{type:"text",value:O,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.location","Ort")}),(0,P.jsx)("input",{type:"text",value:U,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.meetingPoint","Treffpunkt")}),(0,P.jsx)("input",{type:"text",value:W,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),A===Ue.EXTERNAL&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.externalInfo","Externe Tour-Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.externalProvider","Externer Anbieter")}),(0,P.jsxs)("select",{value:ne,onChange:e=>ie(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:n("common.select","Ausw\xe4hlen")}),Ne.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,P.jsx)("input",{type:"url",value:oe,onChange:e=>de(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.commissions","Kommissionen")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.totalCommission","Gesamtkommission")}),(0,P.jsx)("input",{type:"number",value:$,onChange:e=>Q(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,P.jsx)("input",{type:"number",value:ee,onChange:e=>te(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,P.jsx)("input",{type:"number",value:re,onChange:e=>ae(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,P.jsx)("input",{type:"number",value:se,onChange:e=>le(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.includes","Enth\xe4lt")}),(0,P.jsx)("textarea",{value:H,onChange:e=>K(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.excludes","Nicht enthalten")}),(0,P.jsx)("textarea",{value:J,onChange:e=>Y(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.requirements","Anforderungen")}),(0,P.jsx)("textarea",{value:Z,onChange:e=>X(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:Pe,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:Ee||De,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:Ee?n("common.saving","Speichere..."):n("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!x&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n("tours.create","Neue Tour erstellen")}),(0,P.jsx)("button",{onClick:Pe,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:Re,className:"space-y-6",children:[Se&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:Se}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.basicInfo","Grundinformationen")}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.name","Titel")," *"]}),(0,P.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.description","Beschreibung")}),(0,P.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("tours.type","Typ")," *"]}),(0,P.jsxs)("select",{value:A,onChange:e=>S(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:Ue.OWN,children:n("tours.typeOwn","Eigene Tour")}),(0,P.jsx)("option",{value:Ue.EXTERNAL,children:n("tours.typeExternal","Externe Tour")})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.status","Status")}),(0,P.jsxs)("select",{value:C?"true":"false",onChange:e=>E("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"true",children:n("tours.statusActive","Aktiv")}),(0,P.jsx)("option",{value:"false",children:n("tours.statusInactive","Inaktiv")})]})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.branch","Niederlassung")}),(0,P.jsxs)("select",{value:ce,onChange:e=>ue(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:n("common.all","Alle")}),je.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.details","Tour-Details")}),(0,P.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.duration","Dauer (Stunden)")}),(0,P.jsx)("input",{type:"number",value:T,onChange:e=>D(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.minParticipants","Min. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:F,onChange:e=>_(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.maxParticipants","Max. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:z,onChange:e=>I(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.price","Preis")}),(0,P.jsx)("input",{type:"number",value:B,onChange:e=>V(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.currency","W\xe4hrung")}),(0,P.jsx)("input",{type:"text",value:O,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.location","Ort")}),(0,P.jsx)("input",{type:"text",value:U,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.meetingPoint","Treffpunkt")}),(0,P.jsx)("input",{type:"text",value:W,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),A===Ue.EXTERNAL&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.externalInfo","Externe Tour-Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.externalProvider","Externer Anbieter")}),(0,P.jsxs)("select",{value:ne,onChange:e=>ie(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:n("common.select","Ausw\xe4hlen")}),Ne.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,P.jsx)("input",{type:"url",value:oe,onChange:e=>de(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.commissions","Kommissionen")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.totalCommission","Gesamtkommission")}),(0,P.jsx)("input",{type:"number",value:$,onChange:e=>Q(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,P.jsx)("input",{type:"number",value:ee,onChange:e=>te(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,P.jsx)("input",{type:"number",value:re,onChange:e=>ae(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,P.jsx)("input",{type:"number",value:se,onChange:e=>le(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.includes","Enth\xe4lt")}),(0,P.jsx)("textarea",{value:H,onChange:e=>K(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.excludes","Nicht enthalten")}),(0,P.jsx)("textarea",{value:J,onChange:e=>Y(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.requirements","Anforderungen")}),(0,P.jsx)("textarea",{value:Z,onChange:e=>X(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:n("tours.images","Bilder")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.mainImage","Hauptbild")}),(0,P.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){ge(r);const e=new FileReader;e.onloadend=()=>{be(e.result)},e.readAsDataURL(r)}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),xe&&(0,P.jsx)("div",{className:"mt-2 relative inline-block",children:(0,P.jsx)("img",{src:xe,alt:"Vorschau",className:"max-w-xs h-48 object-cover rounded-md border border-gray-300 dark:border-gray-600"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("tours.gallery","Galerie")}),(0,P.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);t.length>0&&(pe((e=>[...e,...t])),t.forEach((e=>{const t=new FileReader;t.onloadend=()=>{fe((e=>[...e,t.result]))},t.readAsDataURL(e)})))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),ye.length>0&&(0,P.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:ye.map(((e,t)=>(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("img",{src:e,alt:"Galerie ".concat(t+1),className:"w-full h-24 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(0,P.jsx)("button",{type:"button",onClick:()=>(e=>{pe((t=>t.filter(((t,r)=>r!==e)))),fe((t=>t.filter(((t,r)=>r!==e))))})(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 z-10 shadow-lg",title:n("tours.deleteImage","Bild l\xf6schen"),children:(0,P.jsx)(f.A,{className:"h-4 w-4"})})]},t)))})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:Pe,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:Ee||De,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:Ee?n("common.saving","Speichere..."):n("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]})]})},We=e=>{var t,r;let{isOpen:l,onClose:n,onTourUpdated:i,tour:o}=e;const{t:d}=(0,s.Bd)(),{user:c}=(0,L.As)(),{showMessage:u}=(0,k.A)(),{openSidepane:m,closeSidepane:x}=(0,R.N)(),[b,h]=(0,a.useState)(window.innerWidth<640),[p,y]=(0,a.useState)(window.innerWidth>1070),[j,A]=(0,a.useState)((null===o||void 0===o?void 0:o.title)||""),[S,C]=(0,a.useState)((null===o||void 0===o?void 0:o.description)||""),[E,T]=(0,a.useState)((null===o||void 0===o?void 0:o.type)||Ue.OWN),[D,z]=(0,a.useState)(null===(t=null===o||void 0===o?void 0:o.isActive)||void 0===t||t),[I,F]=(0,a.useState)((null===o||void 0===o?void 0:o.duration)||""),[_,B]=(0,a.useState)((null===o||void 0===o?void 0:o.maxParticipants)||""),[V,O]=(0,a.useState)((null===o||void 0===o?void 0:o.minParticipants)||""),[M,U]=(0,a.useState)(null!==o&&void 0!==o&&o.price?"string"===typeof o.price?parseFloat(o.price):o.price:""),[q,W]=(0,a.useState)((null===o||void 0===o?void 0:o.currency)||"COP"),[G,H]=(0,a.useState)((null===o||void 0===o?void 0:o.location)||""),[K,J]=(0,a.useState)((null===o||void 0===o?void 0:o.meetingPoint)||""),[Y,Z]=(0,a.useState)((null===o||void 0===o?void 0:o.includes)||""),[X,$]=(0,a.useState)((null===o||void 0===o?void 0:o.excludes)||""),[Q,ee]=(0,a.useState)((null===o||void 0===o?void 0:o.requirements)||""),[te,re]=(0,a.useState)(null!==o&&void 0!==o&&o.totalCommission?"string"===typeof o.totalCommission?parseFloat(o.totalCommission):o.totalCommission:""),[ae,se]=(0,a.useState)(null!==o&&void 0!==o&&o.totalCommissionPercent?"string"===typeof o.totalCommissionPercent?parseFloat(o.totalCommissionPercent):o.totalCommissionPercent:""),[le,ne]=(0,a.useState)(null!==o&&void 0!==o&&o.sellerCommissionPercent?"string"===typeof o.sellerCommissionPercent?parseFloat(o.sellerCommissionPercent):o.sellerCommissionPercent:""),[ie,oe]=(0,a.useState)(null!==o&&void 0!==o&&o.sellerCommissionFixed?"string"===typeof o.sellerCommissionFixed?parseFloat(o.sellerCommissionFixed):o.sellerCommissionFixed:""),[de,ce]=(0,a.useState)((null===o||void 0===o?void 0:o.externalProviderId)||""),[ue,me]=(0,a.useState)((null===o||void 0===o?void 0:o.externalBookingUrl)||""),[ge,xe]=(0,a.useState)((null===o||void 0===o?void 0:o.branchId)||""),[be,he]=(0,a.useState)(null),[pe,ye]=(0,a.useState)(null!==o&&void 0!==o&&o.imageUrl?(0,N.Xe)(o.id):null),[fe,ve]=(0,a.useState)([]),[ke,je]=(0,a.useState)((null===o||void 0===o||null===(r=o.galleryUrls)||void 0===r?void 0:r.map(((e,t)=>(0,N.nU)(o.id,t))))||[]),[we,Ne]=(0,a.useState)(!1),[Ae,Se]=(0,a.useState)([]),[Ce,Ee]=(0,a.useState)([]),[Te,De]=(0,a.useState)(null),[Le,Re]=(0,a.useState)(!1),[Pe,ze]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(async()=>{try{var e,t,r;ze(!0);const[a,s]=await Promise.all([w.A.get(N.Sn.BRANCHES.BASE),w.A.get((null===(e=N.Sn.TOUR_PROVIDERS)||void 0===e?void 0:e.BASE)||"/api/tour-providers")]);Se((null===(t=a.data)||void 0===t?void 0:t.data)||a.data||[]),Ee((null===(r=s.data)||void 0===r?void 0:r.data)||s.data||[])}catch(a){console.error("Error loading data:",a),u(d("errors.loadError"),"error")}finally{ze(!1)}})()}),[l,d,u]),(0,a.useEffect)((()=>{const e=()=>{h(window.innerWidth<640),y(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(l?m():x(),()=>{x()})),[l,m,x]),(0,a.useEffect)((()=>{var e,t;o&&(A(o.title||""),C(o.description||""),T(o.type||Ue.OWN),z(null===(e=o.isActive)||void 0===e||e),F(o.duration||""),B(o.maxParticipants||""),O(o.minParticipants||""),U(o.price?"string"===typeof o.price?parseFloat(o.price):o.price:""),W(o.currency||"COP"),H(o.location||""),J(o.meetingPoint||""),Z(o.includes||""),$(o.excludes||""),ee(o.requirements||""),re(o.totalCommission?"string"===typeof o.totalCommission?parseFloat(o.totalCommission):o.totalCommission:""),se(o.totalCommissionPercent?"string"===typeof o.totalCommissionPercent?parseFloat(o.totalCommissionPercent):o.totalCommissionPercent:""),ne(o.sellerCommissionPercent?"string"===typeof o.sellerCommissionPercent?parseFloat(o.sellerCommissionPercent):o.sellerCommissionPercent:""),oe(o.sellerCommissionFixed?"string"===typeof o.sellerCommissionFixed?parseFloat(o.sellerCommissionFixed):o.sellerCommissionFixed:""),ce(o.externalProviderId||""),me(o.externalBookingUrl||""),xe(o.branchId||""),ye(o.imageUrl?(0,N.Xe)(o.id):null),je((null===(t=o.galleryUrls)||void 0===t?void 0:t.map(((e,t)=>(0,N.nU)(o.id,t))))||[]))}),[o]);const Ie=e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){he(r);const e=new FileReader;e.onloadend=()=>{ye(e.result)},e.readAsDataURL(r)}},Fe=e=>{const t=Array.from(e.target.files||[]);t.length>0&&(ve((e=>[...e,...t])),t.forEach((e=>{const t=new FileReader;t.onloadend=()=>{je((e=>[...e,t.result]))},t.readAsDataURL(e)})))},_e=async()=>{if(null!==o&&void 0!==o&&o.imageUrl)try{await w.A.delete(N.Sn.TOURS.DELETE_IMAGE(o.id)),ye(null),he(null);const e=await w.A.get(N.Sn.TOURS.BY_ID(o.id));e.data.success&&(i(e.data.data),u(d("tours.imageDeleted","Hauptbild erfolgreich gel\xf6scht"),"success"))}catch(r){var e,t;console.error("Error deleting main image:",r);const a=(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("errors.deleteError");u(a,"error")}},Be=async e=>{if(!o)return;const t=o.galleryUrls||[];if(e<t.length)try{await w.A.delete(N.Sn.TOURS.DELETE_GALLERY_IMAGE(o.id,e)),je((t=>t.filter(((t,r)=>r!==e))));const t=await w.A.get(N.Sn.TOURS.BY_ID(o.id));t.data.success&&(i(t.data.data),u(d("tours.galleryImageDeleted","Galerie-Bild erfolgreich gel\xf6scht"),"success"))}catch(s){var r,a;console.error("Error deleting gallery image:",s);const e=(null===s||void 0===s||null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||d("errors.deleteError");u(e,"error")}else{const r=e-t.length;ve((e=>e.filter(((e,t)=>t!==r)))),je((t=>t.filter(((t,r)=>r!==e))))}},Ve=async e=>{if(e.preventDefault(),De(null),!j.trim()||j.trim().length<3)return void De(d("tours.validation.titleMinLength",{defaultValue:"Titel muss mindestens 3 Zeichen lang sein"}));const t=_?Number(_):null,r=V?Number(V):null;if(null!==t&&null!==r&&t<r)De(d("tours.validation.maxParticipantsMin",{defaultValue:"Maximale Teilnehmeranzahl muss >= minimale Teilnehmeranzahl sein"}));else if(E!==Ue.EXTERNAL||de)if(""!==M&&Number(M)<0)De(d("tours.validation.priceNonNegative",{defaultValue:"Preis muss >= 0 sein"}));else if(""!==te&&Number(te)<0)De(d("tours.validation.commissionNonNegative",{defaultValue:"Kommission muss >= 0 sein"}));else{Re(!0);try{const e={title:j,description:S||null,type:E,isActive:D,duration:I?Number(I):null,maxParticipants:_?Number(_):null,minParticipants:V?Number(V):null,price:M?Number(M):null,currency:q||"COP",location:G||null,meetingPoint:K||null,includes:Y||null,excludes:X||null,requirements:Q||null,totalCommission:te?Number(te):null,totalCommissionPercent:ae?Number(ae):null,sellerCommissionPercent:le?Number(le):null,sellerCommissionFixed:ie?Number(ie):null,externalProviderId:de?Number(de):null,externalBookingUrl:ue||null,branchId:ge?Number(ge):null},t=await w.A.put(N.Sn.TOURS.BY_ID(o.id),e);if(t.data.success){t.data.data;if(be)try{Ne(!0);const e=new FormData;e.append("image",be),await w.A.post(N.Sn.TOURS.UPLOAD_IMAGE(tourId),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){console.error("Error uploading main image:",l),u(d("tours.imageUploadError","Tour aktualisiert, aber Fehler beim Hochladen des Bildes"),"warning")}finally{Ne(!1)}if(fe.length>0)try{Ne(!0);for(const e of fe){const t=new FormData;t.append("image",e),await w.A.post(N.Sn.TOURS.UPLOAD_GALLERY(tourId),t,{headers:{"Content-Type":"multipart/form-data"}})}}catch(n){console.error("Error uploading gallery images:",n),u(d("tours.galleryUploadError","Tour aktualisiert, aber Fehler beim Hochladen der Galerie-Bilder"),"warning")}finally{Ne(!1)}u(d("tours.updateSuccess","Tour erfolgreich aktualisiert"),"success");const e=await w.A.get(N.Sn.TOURS.BY_ID(tourId));i(e.data.data),Oe()}else De(t.data.message||d("errors.saveError"))}catch(c){var a,s;console.error("Error updating tour:",c);const e=(null===c||void 0===c||null===(a=c.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||(null===c||void 0===c?void 0:c.message)||d("errors.saveError");De(e),u(e,"error")}finally{Re(!1)}}else De(d("tours.validation.externalProviderRequired",{defaultValue:"Externer Anbieter ist bei externen Touren erforderlich"}))},Oe=()=>{n()};return o?b?(0,P.jsxs)(g.lG,{open:l,onClose:Oe,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:d("tours.edit","Tour bearbeiten")}),(0,P.jsx)("button",{onClick:Oe,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:Ve,className:"p-6 space-y-6",children:[Te&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:Te}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.basicInfo","Grundinformationen")}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tours.name","Titel")," *"]}),(0,P.jsx)("input",{type:"text",value:j,onChange:e=>A(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.description","Beschreibung")}),(0,P.jsx)("textarea",{value:S,onChange:e=>C(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tours.type","Typ")," *"]}),(0,P.jsxs)("select",{value:E,onChange:e=>T(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:Ue.OWN,children:d("tours.typeOwn","Eigene Tour")}),(0,P.jsx)("option",{value:Ue.EXTERNAL,children:d("tours.typeExternal","Externe Tour")})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.status","Status")}),(0,P.jsxs)("select",{value:D?"true":"false",onChange:e=>z("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"true",children:d("tours.statusActive","Aktiv")}),(0,P.jsx)("option",{value:"false",children:d("tours.statusInactive","Inaktiv")})]})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.branch","Niederlassung")}),(0,P.jsxs)("select",{value:ge,onChange:e=>xe(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:d("common.all","Alle")}),Ae.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.details","Tour-Details")}),(0,P.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.duration","Dauer (Stunden)")}),(0,P.jsx)("input",{type:"number",value:I,onChange:e=>F(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.minParticipants","Min. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:V,onChange:e=>O(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.maxParticipants","Max. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:_,onChange:e=>B(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.price","Preis")}),(0,P.jsx)("input",{type:"number",value:M,onChange:e=>U(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.currency","W\xe4hrung")}),(0,P.jsx)("input",{type:"text",value:q,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.location","Ort")}),(0,P.jsx)("input",{type:"text",value:G,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.meetingPoint","Treffpunkt")}),(0,P.jsx)("input",{type:"text",value:K,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),E===Ue.EXTERNAL&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.externalInfo","Externe Tour-Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.externalProvider","Externer Anbieter")}),(0,P.jsxs)("select",{value:de,onChange:e=>ce(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:d("common.select","Ausw\xe4hlen")}),Ce.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,P.jsx)("input",{type:"url",value:ue,onChange:e=>me(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.commissions","Kommissionen")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.totalCommission","Gesamtkommission")}),(0,P.jsx)("input",{type:"number",value:te,onChange:e=>re(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,P.jsx)("input",{type:"number",value:ae,onChange:e=>se(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,P.jsx)("input",{type:"number",value:le,onChange:e=>ne(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,P.jsx)("input",{type:"number",value:ie,onChange:e=>oe(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.includes","Enth\xe4lt")}),(0,P.jsx)("textarea",{value:Y,onChange:e=>Z(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.excludes","Nicht enthalten")}),(0,P.jsx)("textarea",{value:X,onChange:e=>$(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.requirements","Anforderungen")}),(0,P.jsx)("textarea",{value:Q,onChange:e=>ee(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.images","Bilder")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.mainImage","Hauptbild")}),(0,P.jsx)("input",{type:"file",accept:"image/*",onChange:Ie,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),pe&&(0,P.jsxs)("div",{className:"mt-2 relative inline-block",children:[(0,P.jsx)("img",{src:pe,alt:"Vorschau",className:"max-w-xs h-48 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(null===o||void 0===o?void 0:o.imageUrl)&&(0,P.jsx)("button",{type:"button",onClick:_e,className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 z-10 shadow-lg",title:d("tours.deleteImage","Hauptbild l\xf6schen"),children:(0,P.jsx)(f.A,{className:"h-4 w-4"})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.gallery","Galerie")}),(0,P.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:Fe,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),ke.length>0&&(0,P.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:ke.map(((e,t)=>(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("img",{src:e,alt:"Galerie ".concat(t+1),className:"w-full h-32 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(0,P.jsx)("button",{type:"button",onClick:()=>Be(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,P.jsx)(f.A,{className:"h-4 w-4"})})]},t)))})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:Oe,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:d("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:Le||Pe||we,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:Le?d("common.saving","Speichere..."):d("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[l&&!p&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:l?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(l?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:l?"auto":"none"},"aria-hidden":!l,role:"dialog","aria-modal":l,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:d("tours.edit","Tour bearbeiten")}),(0,P.jsx)("button",{onClick:Oe,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,P.jsxs)("form",{onSubmit:Ve,className:"space-y-6",children:[Te&&(0,P.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:Te}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.basicInfo","Grundinformationen")}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tours.name","Titel")," *"]}),(0,P.jsx)("input",{type:"text",value:j,onChange:e=>A(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.description","Beschreibung")}),(0,P.jsx)("textarea",{value:S,onChange:e=>C(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tours.type","Typ")," *"]}),(0,P.jsxs)("select",{value:E,onChange:e=>T(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:Ue.OWN,children:d("tours.typeOwn","Eigene Tour")}),(0,P.jsx)("option",{value:Ue.EXTERNAL,children:d("tours.typeExternal","Externe Tour")})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.status","Status")}),(0,P.jsxs)("select",{value:D?"true":"false",onChange:e=>z("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"true",children:d("tours.statusActive","Aktiv")}),(0,P.jsx)("option",{value:"false",children:d("tours.statusInactive","Inaktiv")})]})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.branch","Niederlassung")}),(0,P.jsxs)("select",{value:ge,onChange:e=>xe(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:d("common.all","Alle")}),Ae.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.details","Tour-Details")}),(0,P.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.duration","Dauer (Stunden)")}),(0,P.jsx)("input",{type:"number",value:I,onChange:e=>F(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.minParticipants","Min. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:V,onChange:e=>O(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.maxParticipants","Max. Teilnehmer")}),(0,P.jsx)("input",{type:"number",value:_,onChange:e=>B(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.price","Preis")}),(0,P.jsx)("input",{type:"number",value:M,onChange:e=>U(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.currency","W\xe4hrung")}),(0,P.jsx)("input",{type:"text",value:q,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.location","Ort")}),(0,P.jsx)("input",{type:"text",value:G,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.meetingPoint","Treffpunkt")}),(0,P.jsx)("input",{type:"text",value:K,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),E===Ue.EXTERNAL&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.externalInfo","Externe Tour-Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.externalProvider","Externer Anbieter")}),(0,P.jsxs)("select",{value:de,onChange:e=>ce(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,P.jsx)("option",{value:"",children:d("common.select","Ausw\xe4hlen")}),Ce.map((e=>(0,P.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,P.jsx)("input",{type:"url",value:ue,onChange:e=>me(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.commissions","Kommissionen")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.totalCommission","Gesamtkommission")}),(0,P.jsx)("input",{type:"number",value:te,onChange:e=>re(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,P.jsx)("input",{type:"number",value:ae,onChange:e=>se(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,P.jsx)("input",{type:"number",value:le,onChange:e=>ne(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,P.jsx)("input",{type:"number",value:ie,onChange:e=>oe(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.includes","Enth\xe4lt")}),(0,P.jsx)("textarea",{value:Y,onChange:e=>Z(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.excludes","Nicht enthalten")}),(0,P.jsx)("textarea",{value:X,onChange:e=>$(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.requirements","Anforderungen")}),(0,P.jsx)("textarea",{value:Q,onChange:e=>ee(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:d("tours.images","Bilder")}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.mainImage","Hauptbild")}),(0,P.jsx)("input",{type:"file",accept:"image/*",onChange:Ie,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),pe&&(0,P.jsxs)("div",{className:"mt-2 relative inline-block",children:[(0,P.jsx)("img",{src:pe,alt:"Vorschau",className:"max-w-xs h-48 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(null===o||void 0===o?void 0:o.imageUrl)&&(0,P.jsx)("button",{type:"button",onClick:_e,className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 z-10 shadow-lg",title:d("tours.deleteImage","Hauptbild l\xf6schen"),children:(0,P.jsx)(f.A,{className:"h-4 w-4"})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tours.gallery","Galerie")}),(0,P.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:Fe,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),ke.length>0&&(0,P.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:ke.map(((e,t)=>(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)("img",{src:e,alt:"Galerie ".concat(t+1),className:"w-full h-24 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(0,P.jsx)("button",{type:"button",onClick:()=>Be(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 z-10 shadow-lg",title:d("tours.deleteImage","Bild l\xf6schen"),children:(0,P.jsx)(f.A,{className:"h-4 w-4"})})]},t)))})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:Oe,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:d("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:Le||Pe||we,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:Le?d("common.saving","Speichere..."):d("common.save","Speichern"),children:(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})})]})]}):null};var Ge=r(5590),He=r(2415),Ke=r(887),Je=r(7539);const Ye=e=>{let{isOpen:t,onClose:r,tourId:n,onTourUpdated:o}=e;const{t:c}=(0,s.Bd)(),{showMessage:u}=(0,k.A)(),{hasPermission:m}=(0,l.S)(),[x,h]=(0,a.useState)(null),[p,v]=(0,a.useState)(!1),[j,A]=(0,a.useState)(null),[S,C]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t&&n&&T()}),[t,n]);const T=async()=>{try{v(!0),A(null);const e=await w.A.get(N.Sn.TOURS.BY_ID(n));e.data.success?h(e.data.data):A(e.data.message||c("errors.loadError"))}catch(r){var e,t;console.error("Error loading tour:",r);const a=(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||c("errors.loadError");A(a),u(a,"error")}finally{v(!1)}};return t?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:c("tours.details","Tour-Details")}),(0,P.jsxs)("div",{className:"flex items-center gap-3",children:[m("tour_bookings","write","table")&&x&&x.isActive&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>C(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":c("tourBookings.create","Buchung erstellen"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c("tourBookings.create","Buchung erstellen")})]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]})]}),(0,P.jsx)("div",{className:"p-6",children:p?(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:c("common.loading")}):j?(0,P.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:j}):x?(0,P.jsxs)("div",{className:"space-y-6",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:x.title||"-"}),(0,P.jsxs)("div",{className:"flex items-center gap-2",children:[(0,P.jsx)("span",{className:"px-3 py-1 text-sm rounded-full ".concat(x.type===Ue.OWN?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"),children:x.type===Ue.OWN?c("tours.typeOwn"):c("tours.typeExternal")}),(0,P.jsx)("span",{className:"px-3 py-1 text-sm rounded-full ".concat(x.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:x.isActive?c("tours.statusActive"):c("tours.statusInactive")})]})]}),x.description&&(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:c("tours.description")}),(0,P.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:x.description})]}),(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,P.jsxs)("div",{className:"space-y-4",children:[x.duration&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(E.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.duration")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[x.duration," ",c("common.hours","h")]})]})]}),(x.minParticipants||x.maxParticipants)&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(Ge.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.participants","Teilnehmer")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:x.minParticipants&&x.maxParticipants?"".concat(x.minParticipants," - ").concat(x.maxParticipants):x.minParticipants?"".concat(x.minParticipants,"+"):x.maxParticipants?"bis ".concat(x.maxParticipants):"-"})]})]}),x.price&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(I.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.price")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white font-semibold",children:[Number(x.price).toLocaleString()," ",x.currency||"COP"]})]})]}),x.location&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(d.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.location")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:x.location})]})]}),x.meetingPoint&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(d.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.meetingPoint")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:x.meetingPoint})]})]})]}),(0,P.jsxs)("div",{className:"space-y-4",children:[x.branch&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(y.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.branch")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:x.branch.name})]})]}),x.createdBy&&(0,P.jsxs)("div",{className:"flex items-start gap-3",children:[(0,P.jsx)(i.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.columns.createdBy")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[x.createdBy.firstName," ",x.createdBy.lastName]})]})]}),x.createdAt&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("common.createdAt","Erstellt am")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,He.GP)(new Date(x.createdAt),"dd.MM.yyyy HH:mm",{locale:Ke.de})})]}),x.externalProvider&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.externalProvider")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:x.externalProvider.name})]}),x.externalBookingUrl&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.externalBookingUrl")}),(0,P.jsx)("a",{href:x.externalBookingUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:x.externalBookingUrl})]})]})]}),(x.totalCommission||x.totalCommissionPercent||x.sellerCommissionPercent||x.sellerCommissionFixed)&&(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:c("tours.commissions")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[x.totalCommission&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.totalCommission")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(x.totalCommission).toLocaleString()," ",x.currency||"COP"]})]}),x.totalCommissionPercent&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.totalCommissionPercent")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(x.totalCommissionPercent),"%"]})]}),x.sellerCommissionPercent&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.sellerCommissionPercent")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(x.sellerCommissionPercent),"%"]})]}),x.sellerCommissionFixed&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.sellerCommissionFixed")}),(0,P.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(x.sellerCommissionFixed).toLocaleString()," ",x.currency||"COP"]})]})]})]}),(x.includes||x.excludes||x.requirements)&&(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:c("tours.additionalInfo")}),(0,P.jsxs)("div",{className:"space-y-4",children:[x.includes&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:c("tours.includes")}),(0,P.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:x.includes})]}),x.excludes&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:c("tours.excludes")}),(0,P.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:x.excludes})]}),x.requirements&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:c("tours.requirements")}),(0,P.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:x.requirements})]})]})]}),(x.availableFrom||x.availableTo)&&(0,P.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:c("tours.availability","Verf\xfcgbarkeit")}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[x.availableFrom&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.availableFrom","Verf\xfcgbar ab")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,He.GP)(new Date(x.availableFrom),"dd.MM.yyyy",{locale:Ke.de})})]}),x.availableTo&&(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:c("tours.availableTo","Verf\xfcgbar bis")}),(0,P.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,He.GP)(new Date(x.availableTo),"dd.MM.yyyy",{locale:Ke.de})})]})]})]})]}):(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:c("tours.notFound","Tour nicht gefunden")})}),(0,P.jsx)("div",{className:"flex justify-end p-6 border-t border-gray-200 dark:border-gray-700",children:(0,P.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:c("common.close","Schlie\xdfen")})})]})}),x&&(0,P.jsx)(Je.A,{isOpen:S,onClose:()=>C(!1),tour:x,onBookingCreated:async e=>{u(c("tourBookings.created",{defaultValue:"Tour-Buchung erfolgreich erstellt"}),"success"),C(!1)}})]}):null},Ze=e=>{let{isOpen:t,onClose:r,tourCount:l}=e;const{t:n}=(0,s.Bd)(),{showMessage:i}=(0,k.A)(),[o,d]=(0,a.useState)(["id","title","description","type","price","currency","duration","maxParticipants","minParticipants","location","meetingPoint","imageUrl","galleryUrls","availableFrom","availableTo"]),[c,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)("json"),b=[{id:"id",label:n("tours.columns.title","Titel")},{id:"title",label:n("tours.name","Titel")},{id:"description",label:n("tours.description","Beschreibung")},{id:"type",label:n("tours.type","Typ")},{id:"price",label:n("tours.price","Preis")},{id:"currency",label:n("tours.currency","W\xe4hrung")},{id:"duration",label:n("tours.duration","Dauer")},{id:"maxParticipants",label:n("tours.maxParticipants","Max. Teilnehmer")},{id:"minParticipants",label:n("tours.minParticipants","Min. Teilnehmer")},{id:"location",label:n("tours.location","Ort")},{id:"meetingPoint",label:n("tours.meetingPoint","Treffpunkt")},{id:"includes",label:n("tours.includes","Enth\xe4lt")},{id:"excludes",label:n("tours.excludes","Nicht enthalten")},{id:"requirements",label:n("tours.requirements","Anforderungen")},{id:"imageUrl",label:n("tours.mainImage","Hauptbild")},{id:"galleryUrls",label:n("tours.gallery","Galerie")},{id:"availableFrom",label:n("tours.availableFrom","Verf\xfcgbar ab")},{id:"availableTo",label:n("tours.availableTo","Verf\xfcgbar bis")},{id:"externalBookingUrl",label:n("tours.externalBookingUrl","Externe Buchungs-URL")},{id:"branch",label:n("tours.branch","Niederlassung")},{id:"externalProvider",label:n("tours.externalProvider","Externer Anbieter")}];return t?(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,P.jsxs)(g.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[n("tours.export.title","Touren exportieren")," (",l,")"]}),(0,P.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"p-6 space-y-6",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("tours.export.format","Export-Format")}),(0,P.jsxs)("div",{className:"flex gap-4",children:[(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"json",checked:"json"===m,onChange:e=>x(e.target.value),className:"mr-2"}),"JSON"]}),(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"csv",checked:"csv"===m,onChange:e=>x(e.target.value),className:"mr-2"}),"CSV"]})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:n("tours.export.selectFields","Felder ausw\xe4hlen")}),(0,P.jsxs)("div",{className:"flex gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:()=>{d(b.map((e=>e.id)))},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:n("common.selectAll","Alle ausw\xe4hlen")}),(0,P.jsx)("span",{className:"text-gray-400",children:"|"}),(0,P.jsx)("button",{type:"button",onClick:()=>{d([])},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:n("common.deselectAll","Alle abw\xe4hlen")})]})]}),(0,P.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md p-4 max-h-96 overflow-y-auto",children:(0,P.jsx)("div",{className:"grid grid-cols-2 gap-2",children:b.map((e=>(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>{return t=e.id,void d((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},className:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,P.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.label})]},e.id)))})})]})]}),(0,P.jsxs)("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel","Abbrechen"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:async()=>{if(0!==o.length){u(!0);try{const e=o.join(","),t=await w.A.get(N.Sn.TOURS.EXPORT,{params:{fields:e}}),a=t.data.tours||t.data;if("json"===m){const e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=window.URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="tours-export-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)}else{if(!Array.isArray(a)||0===a.length)return void i(n("tours.export.noData","Keine Daten zum Exportieren"),"warning");const e=o.map((e=>{const t=b.find((t=>t.id===e));return(null===t||void 0===t?void 0:t.label)||e})),t=a.map((e=>o.map((t=>{let r=e[t];return null===r||void 0===r?"":"object"===typeof r?"branch"===t||"externalProvider"===t?(null===r||void 0===r?void 0:r.name)||"":"galleryUrls"===t&&Array.isArray(r)?r.join("; "):JSON.stringify(r):"boolean"===typeof r?r?"Ja":"Nein":String(r)})))),r=[e.join(","),...t.map((e=>e.map((e=>'"'.concat(String(e).replace(/"/g,'""'),'"'))).join(",")))].join("\n"),s=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=window.URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download="tours-export-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(l)}i(n("tours.export.success","Export erfolgreich"),"success"),r()}catch(a){var e,t;console.error("Error exporting:",a),i((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n("tours.export.error","Fehler beim Exportieren"),"error")}finally{u(!1)}}else i(n("tours.export.noFieldsSelected","Bitte w\xe4hlen Sie mindestens ein Feld aus"),"error")},disabled:c||0===o.length,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:c?n("common.exporting","Exportiere..."):n("common.export","Exportieren"),children:(0,P.jsx)(T.A,{className:"h-5 w-5"})})]})]})})]}):null};var Xe=r(6319),$e=r(2597),Qe=r(8224),et=r(6365);const tt=e=>{let{isOpen:t,onClose:r,tourId:l,initialImageIndex:n=0,imageUrl:i,galleryUrls:o,tourTitle:d}=e;const{t:c}=(0,s.Bd)(),[u,m]=(0,a.useState)(n),[x,b]=(0,a.useState)(1),[h,p]=(0,a.useState)(!0),[y,v]=(0,a.useState)(!1),k=[];i&&k.push((0,N.Xe)(l)),o&&o.length>0&&o.forEach(((e,t)=>{k.push((0,N.nU)(l,t))})),(0,a.useEffect)((()=>{t&&(m(n),b(1),p(!0),v(!1))}),[t,n]);const j=(0,a.useCallback)((()=>{u>0&&(m(u-1),p(!0),v(!1),b(1))}),[u]),w=(0,a.useCallback)((()=>{u<k.length-1&&(m(u+1),p(!0),v(!1),b(1))}),[u,k.length]),A=(0,a.useCallback)((()=>{b((e=>e>=3?3:e<1.5?1.5:e<2?2:e<2.5?2.5:3))}),[]),S=(0,a.useCallback)((()=>{b((e=>e<=1?1:e>2.5?2.5:e>2?2:e>1.5?1.5:1))}),[]),C=(0,a.useCallback)((()=>{b(1)}),[]);if((0,a.useEffect)((()=>{if(!t)return;const e=e=>{"Escape"===e.key?r():"ArrowLeft"===e.key&&u>0?j():"ArrowRight"===e.key&&u<k.length-1?w():"+"!==e.key&&"="!==e.key||e.shiftKey?"-"===e.key||"_"===e.key&&e.shiftKey?S():"0"===e.key&&C():A()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[t,u,k.length,j,w,A,S,C,r]),0===k.length)return null;const E=k[u],T=u>0,L=u<k.length-1,R=x<3,z=x>1;return(0,P.jsxs)(g.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/80","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-7xl w-full h-full flex flex-col bg-black/90 rounded-lg shadow-xl overflow-hidden",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0",children:[(0,P.jsxs)("div",{className:"flex items-center gap-4",children:[(0,P.jsxs)(g.lG.Title,{className:"text-lg font-semibold text-white",children:[d&&"".concat(d," - "),c("tours.imageLightbox.title","Bild {{current}} von {{total}}",{current:u+1,total:k.length})]}),(0,P.jsxs)("div",{className:"flex items-center gap-2",children:[(0,P.jsx)("button",{onClick:S,disabled:!z,className:"p-2 text-white hover:bg-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":c("tours.imageLightbox.zoomOut","Verkleinern"),title:c("tours.imageLightbox.zoomOut","Verkleinern"),children:(0,P.jsx)(Xe.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{onClick:C,className:"p-2 text-white hover:bg-gray-700 rounded transition-colors","aria-label":c("tours.imageLightbox.zoomReset","Zoom zur\xfccksetzen"),title:c("tours.imageLightbox.zoomReset","Zoom zur\xfccksetzen"),children:(0,P.jsx)(D.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{onClick:A,disabled:!R,className:"p-2 text-white hover:bg-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":c("tours.imageLightbox.zoomIn","Vergr\xf6\xdfern"),title:c("tours.imageLightbox.zoomIn","Vergr\xf6\xdfern"),children:(0,P.jsx)($e.A,{className:"h-5 w-5"})})]})]}),(0,P.jsx)("button",{onClick:r,className:"p-2 text-white hover:bg-gray-700 rounded transition-colors","aria-label":c("tours.imageLightbox.close","Schlie\xdfen"),children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"flex-1 relative overflow-hidden flex items-center justify-center",children:[k.length>1&&(0,P.jsx)("button",{onClick:j,disabled:!T,className:"absolute left-4 z-10 p-3 bg-black/50 hover:bg-black/70 text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all","aria-label":c("tours.imageLightbox.previous","Vorheriges Bild"),children:(0,P.jsx)(Qe.A,{className:"h-6 w-6"})}),(0,P.jsxs)("div",{className:"flex-1 flex items-center justify-center h-full p-4",children:[h&&!y&&(0,P.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,P.jsxs)("div",{className:"text-white",children:[(0,P.jsx)(D.A,{className:"h-8 w-8 animate-spin"}),(0,P.jsx)("p",{className:"mt-2 text-sm",children:c("tours.imageLightbox.loading","Bild wird geladen...")})]})}),y&&(0,P.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,P.jsx)("div",{className:"text-white text-center",children:(0,P.jsx)("p",{className:"text-lg",children:c("tours.imageLightbox.error","Bild konnte nicht geladen werden")})})}),!y&&(0,P.jsx)("img",{src:E,alt:"".concat(d||"Tour"," - Bild ").concat(u+1),className:"max-w-full max-h-full object-contain transition-transform duration-200 ".concat(h?"opacity-0":"opacity-100"),style:{transform:"scale(".concat(x,")"),cursor:x>1?"move":"default"},onLoad:()=>{p(!1),v(!1)},onError:()=>{p(!1),v(!0)}})]}),k.length>1&&(0,P.jsx)("button",{onClick:w,disabled:!L,className:"absolute right-4 z-10 p-3 bg-black/50 hover:bg-black/70 text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all","aria-label":c("tours.imageLightbox.next","N\xe4chstes Bild"),children:(0,P.jsx)(et.A,{className:"h-6 w-6"})})]})]})})]})};var rt=r(6400);const at="worktracker-tours",st=["title","type","price","location","duration","branch","isActive","actions"],lt={title:"title",type:"type",price:"price",location:"location",duration:"duration",branch:"branch",createdBy:"createdBy",isActive:"isActive"},nt=()=>{const{t:e}=(0,s.Bd)(),{hasPermission:t,loading:r}=(0,l.S)(),{showMessage:n}=(0,k.A)(),i=(0,H.qz)(),[o,d]=(null===i||void 0===i||i.handleError,(0,a.useState)([])),[c,u]=(0,a.useState)(!1),[g,x]=(0,a.useState)(null),[h,p]=(0,a.useState)(""),[y,f]=(0,a.useState)([]),[v,j]=(0,a.useState)([]),[A,S]=(0,a.useState)(e("tours.filters.current","Aktuell")),[E,D]=(0,a.useState)(null),L=(0,a.useRef)(v);(0,a.useEffect)((()=>{L.current=v}),[v]);const[R,z]=(0,a.useState)(!1),[I,F]=(0,a.useState)(!1),[_,B]=(0,a.useState)(!1),[V,O]=(0,a.useState)(!1),[M,U]=(0,a.useState)(!1),[q,W]=(0,a.useState)(null),[G,K]=(0,a.useState)(0),[J,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(null),[$,ae]=(0,a.useState)(10),[se,le]=(0,a.useState)(null),[ne,ie]=(0,a.useState)(null),[oe,de]=(0,a.useState)(!1),[ce,ue]=(0,a.useState)({}),[me,ge]=(0,a.useState)({}),xe=(0,a.useRef)({}),be=(0,a.useRef)({}),{settings:he,isLoading:pe,updateColumnOrder:ye,updateHiddenColumns:fe,toggleColumnVisibility:ve,isColumnVisible:ke,updateViewMode:je,updateSortConfig:we}=(0,Oe.F)(at,{defaultColumnOrder:st,defaultHiddenColumns:[],defaultViewMode:"cards"}),Ne=(null===he||void 0===he?void 0:he.sortConfig)||{key:"title",direction:"asc"},Ae=(0,a.useMemo)((()=>[{id:"title",label:e("tours.columns.title","Titel"),shortLabel:e("tours.columns.title","Titel").substring(0,4)},{id:"type",label:e("tours.columns.type","Typ"),shortLabel:e("tours.columns.type","Typ").substring(0,3)},{id:"price",label:e("tours.columns.price","Preis"),shortLabel:e("tours.columns.price","Preis").substring(0,3)},{id:"location",label:e("tours.columns.location","Ort"),shortLabel:e("tours.columns.location","Ort").substring(0,3)},{id:"duration",label:e("tours.columns.duration","Dauer"),shortLabel:e("tours.columns.duration","Dauer").substring(0,3)},{id:"branch",label:e("tours.columns.branch","Niederlassung"),shortLabel:e("tours.columns.branch","Niederlassung").substring(0,5)},{id:"createdBy",label:e("tours.columns.createdBy","Erstellt von"),shortLabel:e("tours.columns.createdBy","Erstellt von").substring(0,5)},{id:"isActive",label:e("tours.columns.status","Status"),shortLabel:e("tours.columns.status","Status").substring(0,3)},{id:"actions",label:e("tours.columns.actions","Aktionen"),shortLabel:e("common.actions").substring(0,3)}]),[e]),Se=(0,a.useMemo)((()=>[{id:"description",label:e("tours.columns.description","Beschreibung"),shortLabel:e("tours.columns.description","Beschreibung").substring(0,3)},{id:"maxParticipants",label:e("tours.columns.maxParticipants","Max. Teilnehmer"),shortLabel:e("tours.columns.maxParticipants","Max. Teilnehmer").substring(0,3)},{id:"minParticipants",label:e("tours.columns.minParticipants","Min. Teilnehmer"),shortLabel:e("tours.columns.minParticipants","Min. Teilnehmer").substring(0,3)}]),[e]),Ce=(null===he||void 0===he?void 0:he.viewMode)||"cards",Ee=(0,a.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const r=lt[e]||[];r&&"string"===typeof r&&t.push(r)})),t})((null===he||void 0===he?void 0:he.columnOrder)||st)),[null===he||void 0===he?void 0:he.columnOrder]),Te=(0,a.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{const r=lt[e];r&&t.add(r)})),t})((null===he||void 0===he?void 0:he.hiddenColumns)||[])),[null===he||void 0===he?void 0:he.hiddenColumns]),De=(0,a.useMemo)((()=>new Set(Ee.filter((e=>!Te.has(e))))),[Ee,Te]),Le=(0,a.useCallback)((async function(t,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{a||(u(!0),x(null));const s={};t?s.filterId=t:r&&r.length>0&&(s.filterConditions=JSON.stringify({conditions:r,operators:L.current}));const l=await w.A.get(N.Sn.TOURS.BASE,{params:s});if(l.data.success){const e=l.data.data||[],t=Array.isArray(e)?e.filter((e=>null!=e&&"object"===typeof e&&null!=e.title&&"string"===typeof e.title)):[];a||d(t)}else{const t=l.data.message||e("errors.loadError");a||(x(t),n(t,"error"))}}catch(i){var s,l;console.error("Fehler beim Laden der Touren:",i);const t=(null===(s=i.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message)||e("errors.loadError");a||(x(t),n(t,"error"))}finally{a||u(!1)}}),[e,n]),Re=(0,a.useCallback)((async t=>{try{ue((e=>(0,m.A)((0,m.A)({},e),{},{[t]:!0})));const r=await w.A.post(N.Sn.TOURS.GENERATE_IMAGES(t));if(!r.data.success)throw new Error(r.data.message||e("tours.imageGenerationFailed",{defaultValue:"Fehler beim Starten der Bildgenerierung"}));if("synchronous"===r.data.mode)n(e("tours.imagesGenerated",{defaultValue:"Bilder erfolgreich generiert"}),"success"),ue((e=>(0,m.A)((0,m.A)({},e),{},{[t]:!1}))),await Le();else{const a=r.data.jobId;ge((e=>(0,m.A)((0,m.A)({},e),{},{[t]:a}))),n(e("tours.imageGenerationStarted",{defaultValue:"Bildgenerierung gestartet"}),"info")}}catch(s){var r,a;console.error("Error starting image generation:",s);const l=(null===s||void 0===s||null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||(null===s||void 0===s?void 0:s.message)||e("tours.imageGenerationFailed",{defaultValue:"Fehler bei Bildgenerierung"});n(l,"error"),ue((e=>(0,m.A)((0,m.A)({},e),{},{[t]:!1})))}}),[e,n,Le]);(0,a.useEffect)((()=>(Object.entries(me).forEach((t=>{let[r,a]=t;if(!a)return;const s=parseInt(r,10);if(xe.current[s])return;be.current[s]||(be.current[s]=0);xe.current[s]=setInterval((async()=>{try{if(be.current[s]=(be.current[s]||0)+1,be.current[s]>30)return clearInterval(xe.current[s]),delete xe.current[s],delete be.current[s],ue((e=>(0,m.A)((0,m.A)({},e),{},{[s]:!1}))),ge((e=>{const t=(0,m.A)({},e);return delete t[s],t})),void n(e("tours.imageGenerationTimeout",{defaultValue:"Bildgenerierung hat zu lange gedauert"}),"warning");const t=await w.A.get(N.Sn.TOURS.GENERATE_IMAGES_STATUS(s),{params:{jobId:a}});if(t.data.success){const r=t.data.status;t.data.progress;"completed"===r?(clearInterval(xe.current[s]),delete xe.current[s],delete be.current[s],ue((e=>(0,m.A)((0,m.A)({},e),{},{[s]:!1}))),ge((e=>{const t=(0,m.A)({},e);return delete t[s],t})),n(e("tours.imagesGenerated",{defaultValue:"Bilder erfolgreich generiert"}),"success"),await Le()):"failed"===r&&(clearInterval(xe.current[s]),delete xe.current[s],delete be.current[s],ue((e=>(0,m.A)((0,m.A)({},e),{},{[s]:!1}))),ge((e=>{const t=(0,m.A)({},e);return delete t[s],t})),n(e("tours.imageGenerationFailed",{defaultValue:"Fehler bei Bildgenerierung"}),"error"))}}catch(r){var t;console.error("Error during polling:",r),404===(null===r||void 0===r||null===(t=r.response)||void 0===t?void 0:t.status)&&(clearInterval(xe.current[s]),delete xe.current[s],delete be.current[s],ue((e=>(0,m.A)((0,m.A)({},e),{},{[s]:!1}))),ge((e=>{const t=(0,m.A)({},e);return delete t[s],t})),n(e("tours.imageGenerationFailed",{defaultValue:"Fehler bei Bildgenerierung"}),"error"))}}),2e3)})),()=>{Object.values(xe.current).forEach((e=>clearInterval(e)))})),[me,e,n,Le]),(0,a.useEffect)((()=>()=>{d([]),f([])}),[]);const Pe=(0,a.useCallback)(((e,t)=>{f(e),j(t),Le(void 0,e,!1)}),[Le]),Ge=(0,a.useCallback)((()=>{f([]),j([]),S(e("tours.filters.current","Aktuell")),D(null),Le()}),[Le,e]),He=(0,a.useCallback)((async(e,t,r,a)=>{D(t),S(e),t?(f(r),j(a),await Le(t)):await Pe(r,a)}),[Le,Pe]),Ke=(0,re.b)(),{loadFilters:Je}=Ke,Xe=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(r)return;if(Xe.current)return;(async()=>{Xe.current=!0;try{if(!t("tours","read","table"))return;const e=(await Je(at)).find((e=>"Aktuell"===e.name));if(e)return void await He(e.name,e.id,e.conditions,e.operators);await Le()}catch(e){Xe.current=!1}})()}),[r]);const $e=()=>{le(null),ie(null)},Qe=(0,a.useMemo)((()=>{const e=((null===he||void 0===he?void 0:he.columnOrder)||[]).filter((e=>null!=e&&"string"===typeof e)),t=st.filter((t=>!e.includes(t)));return[...e,...t]}),[null===he||void 0===he?void 0:he.columnOrder]).filter((e=>null!=e&&"string"===typeof e&&ke(e))),et=()=>y.length,nt=(0,a.useMemo)((()=>{if(!Array.isArray(o))return[];let e=o.filter((e=>null!=e&&null!=e.title&&"string"===typeof e.title)).filter((e=>{if(h){const t=h.toLowerCase();return!(!e.title||!e.title.toLowerCase().includes(t))||(!(!e.location||!e.location.toLowerCase().includes(t))||!(!e.description||!e.description.toLowerCase().includes(t)))}return!0}));if(y.length>0){const t={title:(e,t)=>{if(!e||!e.title)return!1;const r=(t.value||"").toLowerCase(),a=(e.title||"").toLowerCase();return"equals"===t.operator?e.title===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},type:(e,t)=>!(!e||!e.type)&&("equals"===t.operator?e.type===t.value:"notEquals"===t.operator?e.type!==t.value:null),isActive:(e,t)=>{const r="true"===t.value||!0===t.value||"1"===t.value;return"equals"===t.operator?e.isActive===r:"notEquals"===t.operator?e.isActive!==r:null},price:(e,t)=>{const r="string"===typeof e.price?parseFloat(e.price):e.price||0,a="string"===typeof t.value?parseFloat(t.value):t.value||0;return!isNaN(r)&&!isNaN(a)&&("equals"===t.operator?Math.abs(r-a)<.01:"greaterThan"===t.operator?r>a:"lessThan"===t.operator?r<a:null)},location:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.location||"").toLowerCase();return"equals"===t.operator?e.location===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},branch:(e,t)=>{var r;const a=((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase(),s=(t.value||"").toLowerCase();return"equals"===t.operator?a===s:"contains"===t.operator?a.includes(s):null},createdBy:(e,t)=>{const r=e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName):"";return(0,rt.Ac)(e.createdById||null,null,t,r)}},r=(e,t)=>{var r;if(!e)return"";switch(t){case"title":return e.title||"";case"type":return e.type||"";case"price":return"string"===typeof e.price?parseFloat(e.price):e.price||0;case"location":return e.location||"";case"duration":return e.duration||0;case"branch":return(null===(r=e.branch)||void 0===r?void 0:r.name)||"";case"createdBy":return e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName):"";case"isActive":return e.isActive;default:return""}};e=(0,rt.W5)(e,y,v,r,t)}const t=(e,t)=>{var r;if(!e)return"";switch(t){case"title":return(e.title||"").toLowerCase();case"type":return(e.type||"").toLowerCase();case"price":return"string"===typeof e.price?parseFloat(e.price):e.price||0;case"location":return(e.location||"").toLowerCase();case"duration":return e.duration||0;case"branch":return((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase();case"createdBy":return e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName).toLowerCase():"";case"isActive":return e.isActive?1:0;default:return""}};return e.sort(((e,r)=>{if(!e||!r){if(!e&&!r)return 0;if(!e)return 1;if(!r)return-1}if("table"===Ce&&Ne.key){const a=t(e,Ne.key),s=t(r,Ne.key);let l=0;if("number"===typeof a&&"number"===typeof s)l=a-s;else{const e="string"===typeof a?a:String(a),t="string"===typeof s?s:String(s);l=e.localeCompare(t)}if(0!==l)return"asc"===Ne.direction?l:-l}const a=((null===e||void 0===e?void 0:e.title)||"").toLowerCase(),s=((null===r||void 0===r?void 0:r.title)||"").toLowerCase();return a.localeCompare(s)}))}),[o,h,y,v,Ce,Ne]);return(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,P.jsx)("div",{className:"flex-1 w-full sm:max-w-md",children:(0,P.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>p(e.target.value)})}),(0,P.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Ce?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>je("table"===Ce?"cards":"table"),children:"table"===Ce?(0,P.jsx)(ze.A,{className:"h-5 w-5"}):(0,P.jsx)(Ie.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===Ce?"common.viewAsCards":"common.viewAsTable")})]}),(0,P.jsxs)("div",{className:"relative group ml-1",children:[(0,P.jsxs)("button",{className:"p-2 rounded-md ".concat(et()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>de(!oe),children:[(0,P.jsx)(Q.A,{className:"h-5 w-5"}),et()>0&&(0,P.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:et()})]}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),t("tour_edit","write","button")&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>O(!0),className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,P.jsx)(T.A,{className:"h-5 w-5"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.export","Exportieren")})]}),(0,P.jsx)("div",{className:"ml-1",children:(0,P.jsx)(Me.A,{columns:"cards"===Ce?[{id:"title",label:e("tours.columns.title","Titel")},{id:"type",label:e("tours.columns.type","Typ")},{id:"price",label:e("tours.columns.price","Preis")},{id:"location",label:e("tours.columns.location","Ort")},{id:"duration",label:e("tours.columns.duration","Dauer")},{id:"branch",label:e("tours.columns.branch","Niederlassung")},{id:"createdBy",label:e("tours.columns.createdBy","Erstellt von")},{id:"isActive",label:e("tours.columns.status","Status")}]:Ae,visibleColumns:"cards"===Ce?Array.from(De):Qe,columnOrder:"cards"===Ce?Ee:he.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Ce){const t=lt[e];t&&ve(t)}else ve(e)},onColumnOrderChange:e=>{if("cards"===Ce){const t=e.map((e=>lt[e]||e)).filter(Boolean);ye(t)}else ye(e)},modalTitle:e("cards"===Ce?"tableColumn.sortAndDisplay":"tableColumn.configure"),mainSortConfig:Ne,onMainSortChange:(e,t)=>{we({key:e,direction:t})},showMainSort:!0})}),t("tour_create","write","button")&&(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>z(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tours.create","Neue Tour erstellen"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.create","Neue Tour erstellen")})]})]})]}),oe&&(0,P.jsx)("div",{className:"px-3 sm:px-4 md:px-6",children:(0,P.jsx)(ee.A,{columns:[...Ae,...Se],onApply:Pe,onReset:Ge,savedConditions:y,savedOperators:v,tableId:at})}),(0,P.jsx)(te.A,{tableId:at,onSelectFilter:Pe,onReset:Ge,activeFilterName:A,selectedFilterId:E,onFilterChange:He,defaultFilterName:"Aktuell"}),"table"===Ce&&(0,P.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,P.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,P.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,P.jsx)("tr",{children:Qe.map((e=>{const t=Ae.find((t=>t.id===e));return t?(0,P.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ".concat(e===ne?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>(e=>{le(e)})(e),onDragOver:t=>((e,t)=>{e.preventDefault(),se&&se!==t&&ie(t)})(t,e),onDrop:t=>((e,t)=>{if(e.preventDefault(),se&&se!==t){const e=(null===he||void 0===he?void 0:he.columnOrder)||st,r=e.indexOf(se),a=e.indexOf(t);if(r>-1&&a>-1){const t=[...e],s=t[r];t.splice(r,1),t.splice(a,0,s),ye(t)}}le(null),ie(null)})(t,e),onDragEnd:$e,children:(0,P.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,P.jsx)("button",{onClick:()=>(e=>{const t=Ne.key===e&&"asc"===Ne.direction?"desc":"asc";we({key:e,direction:t})})(e),className:"ml-1 focus:outline-none",children:(0,P.jsx)(Fe.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,P.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:c?(0,P.jsx)("tr",{children:(0,P.jsx)("td",{colSpan:Qe.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:e("common.loading")})}):g?(0,P.jsx)("tr",{children:(0,P.jsx)("td",{colSpan:Qe.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-red-500 dark:text-red-400",children:g})}):0===nt.length?(0,P.jsx)("tr",{children:(0,P.jsx)("td",{colSpan:Qe.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:e("tours.noTours")})}):(0,P.jsx)(P.Fragment,{children:nt.slice(0,$).filter((e=>null!=e&&null!=e.title)).map((r=>(0,P.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:Qe.map((a=>{var s;switch(a){case"title":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:(null===r||void 0===r?void 0:r.title)||"-"})},a);case"type":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r.type===Ue.OWN?e("tours.typeOwn"):e("tours.typeExternal")})},a);case"price":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r.price?"".concat(Number(r.price).toLocaleString()," ").concat(r.currency||"COP"):"-"})},a);case"location":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r.location||"-"})},a);case"duration":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r.duration?"".concat(r.duration," ").concat(e("common.hours","h")):"-"})},a);case"branch":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(s=r.branch)||void 0===s?void 0:s.name)||"-"})},a);case"createdBy":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r.createdBy?"".concat(r.createdBy.firstName," ").concat(r.createdBy.lastName):"-"})},a);case"isActive":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:t("tour_edit","write","button")?(0,P.jsx)("button",{onClick:async t=>{t.stopPropagation();try{await w.A.put(N.Sn.TOURS.TOGGLE_ACTIVE(r.id)),n(r.isActive?e("tours.deactivated",{defaultValue:"Tour deaktiviert"}):e("tours.activated",{defaultValue:"Tour aktiviert"}),"success"),await Le()}catch(l){var a,s;console.error("Fehler beim Toggle der Tour:",l),n((null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||e("errors.unknownError"),"error")}},className:"px-2 py-1 text-xs rounded transition-colors ".concat(r.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-800":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"),children:r.isActive?e("tours.statusActive"):e("tours.statusInactive")}):(0,P.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(r.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:r.isActive?e("tours.statusActive"):e("tours.statusInactive")})},a);case"actions":return(0,P.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,P.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:e=>{e.stopPropagation(),X(r.id),B(!0)},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",title:e("common.viewDetails",{defaultValue:"Details anzeigen"}),children:(0,P.jsx)(_e.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails","Details anzeigen")})]}),t("tour_edit","write","button")&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:e=>{e.stopPropagation(),Re(r.id)},disabled:ce[r.id]||!1,className:"p-1.5 transition-colors ".concat(ce[r.id]?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"),title:ce[r.id]?e("tours.generatingImages",{defaultValue:"Bilder werden generiert..."}):e("tours.generateImages",{defaultValue:"Bilder generieren"}),children:(0,P.jsx)(Be.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:ce[r.id]?e("tours.generatingImages",{defaultValue:"Bilder werden generiert..."}):e("tours.generateImages",{defaultValue:"Bilder generieren"})})]}),(0,P.jsx)("button",{onClick:e=>{e.stopPropagation(),Y(r),F(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("tours.edit",{defaultValue:"Bearbeiten"}),children:(0,P.jsx)(C.A,{className:"h-4 w-4"})})]})]})},a);default:return null}}))},r.id)))})})]})}),"cards"===Ce&&(0,P.jsx)(Ve.A,{children:c?(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("common.loading")}):g?(0,P.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:g}):0===nt.length?(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("tours.noTours")}):nt.slice(0,$).filter((e=>null!=e&&null!=e.title)).map((r=>(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 p-4 hover:shadow-md transition-shadow",children:[r.imageUrl&&(0,P.jsx)("img",{src:(0,N.Xe)(r.id),alt:r.title||"Tour Bild",className:"w-full h-48 object-cover rounded-lg mb-2 cursor-pointer hover:opacity-90 transition-opacity",loading:"lazy",onClick:()=>{W(r),K(0),U(!0)}}),r.galleryUrls&&r.galleryUrls.length>0&&(0,P.jsx)("div",{className:"flex gap-2 mb-2 overflow-x-auto",children:r.galleryUrls.map(((e,t)=>(0,P.jsx)("img",{src:(0,N.nU)(r.id,t),alt:"".concat(r.title," - Galerie ").concat(t+1),className:"w-20 h-20 object-cover rounded cursor-pointer hover:opacity-90 transition-opacity flex-shrink-0",onClick:()=>{W(r),K(t+1),U(!0)}},t)))}),(0,P.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,P.jsx)("h4",{className:"text-lg font-semibold dark:text-white",children:(null===r||void 0===r?void 0:r.title)||"-"}),t("tour_edit","write","button")?(0,P.jsx)("button",{onClick:async()=>{try{await w.A.put(N.Sn.TOURS.TOGGLE_ACTIVE(r.id)),n(r.isActive?e("tours.deactivated",{defaultValue:"Tour deaktiviert"}):e("tours.activated",{defaultValue:"Tour aktiviert"}),"success"),await Le()}catch(s){var t,a;console.error("Error toggling tour:",s),n((null===s||void 0===s||null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e("errors.unknownError"),"error")}},className:"px-2 py-1 text-xs rounded transition-colors ".concat(r.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-800":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"),children:r.isActive?e("tours.statusActive"):e("tours.statusInactive")}):(0,P.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(r.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:r.isActive?e("tours.statusActive"):e("tours.statusInactive")})]}),r.description&&(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2 line-clamp-2",children:r.description}),(0,P.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,P.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(0,P.jsxs)("span",{className:"font-medium",children:[e("tours.type"),":"]})," ",r.type===Ue.OWN?e("tours.typeOwn"):e("tours.typeExternal")]}),r.price&&(0,P.jsxs)("div",{className:"text-sm font-semibold dark:text-white",children:[Number(r.price).toLocaleString()," ",r.currency||"COP"]})]}),t("tour_edit","write","button")&&(0,P.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,P.jsxs)("div",{className:"relative group",children:[(0,P.jsx)("button",{onClick:()=>Re(r.id),disabled:ce[r.id]||!1,className:"p-1.5 rounded transition-colors ".concat(ce[r.id]?"bg-gray-200 dark:bg-gray-600 text-gray-400 cursor-not-allowed":"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/30"),children:(0,P.jsx)(Be.A,{className:"h-4 w-4"})}),(0,P.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:ce[r.id]?e("tours.generatingImages",{defaultValue:"Bilder werden generiert..."}):e("tours.generateImages",{defaultValue:"Bilder generieren"})})]}),(0,P.jsx)("button",{onClick:()=>{Y(r),F(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("tours.edit",{defaultValue:"Bearbeiten"}),children:(0,P.jsx)(C.A,{className:"h-4 w-4"})})]})]},r.id)))}),nt.length>$&&(0,P.jsx)("div",{className:"mt-4 flex justify-center",children:(0,P.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>ae((e=>e+10)),children:[e("common.showMore")," (",nt.length-$," ",e("common.remaining"),")"]})}),(0,P.jsx)(qe,{isOpen:R,onClose:()=>z(!1),onTourCreated:async()=>{await Le()}}),J&&(0,P.jsx)(We,{isOpen:I,onClose:()=>{F(!1),Y(null)},onTourUpdated:async e=>{await Le()},tour:J}),Z&&(0,P.jsx)(Ye,{isOpen:_,onClose:()=>{B(!1),X(null)},tourId:Z,onTourUpdated:async()=>{await Le()}}),(0,P.jsx)(Ze,{isOpen:V,onClose:()=>O(!1),tourCount:nt.length}),q&&(0,P.jsx)(tt,{isOpen:M,onClose:()=>{U(!1),W(null)},tourId:q.id,initialImageIndex:G,imageUrl:q.imageUrl,galleryUrls:q.galleryUrls,tourTitle:q.title})]})};var it=r(7629),ot=r(8682),dt=r(3315),ct=r(8673),ut=r(2395);const mt=e=>{let{isOpen:t,onClose:r,onSuccess:l}=e;const{t:n}=(0,s.Bd)(),[i,o]=(0,a.useState)({name:"",displayName:"",domain:""}),[d,c]=(0,a.useState)(!1),[u,x]=(0,a.useState)({}),[b,h]=(0,a.useState)(window.innerWidth<640),[p,y]=(0,a.useState)(window.innerWidth>1070),{openSidepane:j,closeSidepane:w}=(0,R.N)(),{showMessage:N}=(0,k.A)(),{fetchCurrentUser:A}=(0,L.As)();(0,a.useEffect)((()=>{const e=()=>{h(window.innerWidth<640),y(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?j():w(),()=>{w()})),[t,j,w]);const S=e=>{const{name:t,value:r}=e.target;o((e=>(0,m.A)((0,m.A)({},e),{},{[t]:r}))),u[t]&&x((e=>(0,m.A)((0,m.A)({},e),{},{[t]:""})))},C=async e=>{if(e.preventDefault(),(()=>{const e={};return i.name.trim()||(e.name=n("organization.create.nameRequired")),i.displayName.trim()||(e.displayName=n("organization.create.displayNameRequired")),x(e),0===Object.keys(e).length})())try{c(!0),await ct.h.createOrganization(i),x({}),N(n("organization.create.createSuccess"),"success"),await A(),o({name:"",displayName:"",domain:""}),r(),l&&l()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("organization.create.createError");N(e,"error"),x({submit:e})}finally{c(!1)}else N(n("joinRequest.fillRequired"),"error")},E=()=>{o({name:"",displayName:"",domain:""}),x({}),r()};return b?(0,P.jsxs)(g.lG,{open:t,onClose:E,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:n("organization.create.title")}),(0,P.jsx)("button",{onClick:E,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:C,className:"p-4",children:[u.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:u.submit}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.name")}),(0,P.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(u.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.name&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.name})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.displayName")}),(0,P.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(u.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.displayName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.displayName})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.domain")}),(0,P.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:E,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("joinRequest.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!p&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:E,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n("organization.create.title")}),(0,P.jsx)("button",{onClick:E,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[u.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:u.submit}),(0,P.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.name")}),(0,P.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(u.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.name&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.name})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.displayName")}),(0,P.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(u.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.displayName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.displayName})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.create.domain")}),(0,P.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:E,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})]})]})},gt=e=>{let{isOpen:t,onClose:r,onSuccess:l}=e;const{t:n}=(0,s.Bd)(),[i,o]=(0,a.useState)({organizationName:"",message:""}),[d,c]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),[b,h]=(0,a.useState)({}),[p,y]=(0,a.useState)(window.innerWidth<640),[j,w]=(0,a.useState)(window.innerWidth>1070),{openSidepane:N,closeSidepane:A}=(0,R.N)(),[S,C]=(0,a.useState)([]),[E,T]=(0,a.useState)(!1),[L,z]=(0,a.useState)(null),I=(0,a.useRef)(null),F=(0,a.useRef)(null),{showMessage:_}=(0,k.A)();(0,a.useEffect)((()=>{const e=()=>{y(window.innerWidth<640),w(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?N():A(),()=>{A()})),[t,N,A]),(0,a.useEffect)((()=>{const e=e=>{F.current&&!F.current.contains(e.target)&&T(!1)};return E&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[E]);const B=e=>{const t=e.target.value;o((e=>(0,m.A)((0,m.A)({},e),{},{organizationName:t}))),z(null),b.organizationName&&h((e=>(0,m.A)((0,m.A)({},e),{},{organizationName:""}))),I.current&&clearTimeout(I.current),I.current=setTimeout((()=>{(async e=>{if(e.length<2)return C([]),void T(!1);try{x(!0);const t=await ct.h.searchOrganizations(e);C(t),T(!0)}catch(t){console.error("Fehler bei der Organisationen-Suche:",t),C([])}finally{x(!1)}})(t)}),300)},V=e=>{z(e),o((t=>(0,m.A)((0,m.A)({},t),{},{organizationName:e.name}))),T(!1),C([])},O=e=>{o((t=>(0,m.A)((0,m.A)({},t),{},{message:e.target.value}))),b.message&&h((e=>(0,m.A)((0,m.A)({},e),{},{message:""})))},M=async e=>{if(e.preventDefault(),(()=>{const e={};return i.organizationName.trim()?L||(e.organizationName=n("organization.join.selectFromList")):e.organizationName=n("organization.join.nameRequired"),h(e),0===Object.keys(e).length})())try{c(!0),await ct.h.createJoinRequest(i),h({}),_(n("organization.join.sendSuccess"),"success"),o({organizationName:"",message:""}),z(null),C([]),r(),l&&l()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||n("organization.join.sendError");_(e,"error"),h({submit:e})}finally{c(!1)}else _(n("joinRequest.fillRequired"),"error")},U=()=>{o({organizationName:"",message:""}),z(null),C([]),h({}),T(!1),I.current&&clearTimeout(I.current),r()};return p?(0,P.jsxs)(g.lG,{open:t,onClose:U,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:n("organization.join.title")}),(0,P.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:M,className:"p-4",children:[b.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"relative",ref:F,children:[(0,P.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.join.search")}),(0,P.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:B,placeholder:n("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),E&&(S.length>0||u)&&(0,P.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:u?(0,P.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:n("organization.join.searching")}):S.length>0?S.map((e=>(0,P.jsxs)("button",{type:"button",onClick:()=>V(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,P.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,P.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,P.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:n("organization.join.noOrganizations")})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.join.message")}),(0,P.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:O,rows:3,placeholder:n("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("joinRequest.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(d?"organization.join.sending":"organization.join.send"),children:d?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!j&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:U,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n("organization.join.title")}),(0,P.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[b.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,P.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,P.jsxs)("div",{className:"relative",ref:F,children:[(0,P.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.join.search")}),(0,P.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:B,placeholder:n("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),E&&(S.length>0||u)&&(0,P.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:u?(0,P.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:n("organization.join.searching")}):S.length>0?S.map((e=>(0,P.jsxs)("button",{type:"button",onClick:()=>V(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,P.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,P.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,P.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:n("organization.join.noOrganizations")})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.join.message")}),(0,P.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:O,rows:3,placeholder:n("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:n("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(d?"organization.join.sending":"organization.join.send"),children:d?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})]})]})};var xt=r(5648);const bt=a.lazy((()=>r.e(862).then(r.bind(r,6862)))),ht=a.lazy((()=>r.e(587).then(r.bind(r,587)))),pt=a.lazy((()=>r.e(138).then(r.bind(r,5138)))),yt=a.lazy((()=>r.e(629).then(r.bind(r,10)))),ft=e=>{let{isOpen:t,onClose:r,onSuccess:l,organization:n}=e;const{t:i}=(0,s.Bd)(),{fetchCurrentUser:o}=(0,L.As)(),[d,c]=(0,a.useState)({displayName:"",domain:"",logo:"",country:null,nit:null,settings:{}}),[u,x]=(0,a.useState)(null),[b,h]=(0,a.useState)(""),[p,y]=(0,a.useState)(""),[j,w]=(0,a.useState)(!1),[N,A]=(0,a.useState)({}),[S,C]=(0,a.useState)(window.innerWidth<640),[E,T]=(0,a.useState)(window.innerWidth>1070),{openSidepane:z,closeSidepane:I}=(0,R.N)(),{showMessage:F}=(0,k.A)(),{organizationLanguage:_,setOrganizationLanguage:B}=(0,xt.o)(),[V,O]=(0,a.useState)(""),[M,U]=(0,a.useState)(!1),[q,W]=(0,a.useState)("general"),[G,H]=(0,a.useState)(null),[K,J]=(0,a.useState)(null),Y=[{code:"CO",name:i("countries.CO")},{code:"CH",name:i("countries.CH")},{code:"DE",name:i("countries.DE")},{code:"AT",name:i("countries.AT")}];(0,a.useEffect)((()=>{if(t&&n){(async()=>{let e=n;if(!n.settings)try{e=await ct.h.getCurrentOrganization(void 0,!0)}catch(r){console.error("Fehler beim Laden der Settings:",r)}x(e);const t=e.settings||{};c({displayName:e.displayName||"",domain:e.domain||"",logo:e.logo||"",country:e.country||null,nit:e.nit||null,settings:t}),h(e.country||""),y(e.nit||""),e.logo?J(e.logo):J(null),H(null);(async()=>{try{const e=await ct.h.getOrganizationLanguage();O(e.language||"")}catch(e){console.error(i("organization.loadLanguageError"),e),O("")}})()})()}else t||x(null)}),[t,n,i]),(0,a.useEffect)((()=>{const e=()=>{C(window.innerWidth<640),T(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?z():I(),()=>{I()})),[t,z,I]);const Z=e=>{const{name:t,value:r}=e.target;"country"===t?(h(r),c((e=>(0,m.A)((0,m.A)({},e),{},{country:r||null}))),"CO"!==r&&(y(""),c((e=>(0,m.A)((0,m.A)({},e),{},{nit:null}))))):"nit"===t?(y(r),c((e=>(0,m.A)((0,m.A)({},e),{},{nit:r||null})))):c((e=>(0,m.A)((0,m.A)({},e),{},{[t]:r}))),N[t]&&A((e=>(0,m.A)((0,m.A)({},e),{},{[t]:""})))},X=e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(!r.type.match("image/(png|jpeg|jpg)"))return void F(i("organization.logoInvalidType")||"Nur PNG und JPEG Dateien sind erlaubt","error");if(r.size>5242880)return void F(i("organization.logoTooLarge")||"Logo darf maximal 5MB gro\xdf sein","error");H(r);const a=new FileReader;a.onloadend=()=>{const e=a.result;J(e),c((t=>(0,m.A)((0,m.A)({},t),{},{logo:e})))},a.readAsDataURL(r)},$=async e=>{e.preventDefault();try{w(!0),A({}),await ct.h.updateOrganization(d),F(i("organization.updateSuccess"),"success");try{await o()}catch(s){console.error("Fehler beim Neuladen der User-Daten:",s)}r(),l&&l()}catch(n){var t,a;const e=(null===(t=n.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("organization.updateError");F(e,"error"),A({submit:e})}finally{w(!1)}},Q=()=>{if(n){const e=n.settings||{};c({displayName:n.displayName||"",domain:n.domain||"",logo:n.logo||"",country:n.country||null,nit:n.nit||null,settings:e}),h(n.country||""),y(n.nit||"")}A({}),r()};return S?(0,P.jsxs)(g.lG,{open:t,onClose:Q,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,P.jsx)("button",{onClick:Q,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:$,className:"p-4",children:[N.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:N.submit}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,P.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:d.displayName||"",onChange:Z,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(N.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),N.displayName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:N.displayName})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,P.jsx)("input",{type:"text",id:"domain",name:"domain",value:d.domain||"",onChange:Z,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"logo-mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logo")||"Logo"}),(0,P.jsx)("input",{type:"file",id:"logo-mobile",name:"logo",accept:"image/png,image/jpeg,image/jpg",onChange:X,className:"mt-1 block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300 dark:hover:file:bg-blue-800"}),K&&(0,P.jsx)("div",{className:"mt-2",children:(0,P.jsx)("img",{src:K,alt:"Logo Preview",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})}),d.logo&&!K&&(0,P.jsx)("div",{className:"mt-2",children:(0,P.jsx)("img",{src:d.logo,alt:"Current Logo",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})})]}),(0,P.jsxs)("div",{className:"border-t pt-4",children:[(0,P.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,P.jsxs)("select",{id:"country",name:"country",value:b,onChange:Z,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"",children:i("organization.selectCountry")}),Y.map((e=>(0,P.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),(0,P.jsxs)("div",{className:"border-t pt-4",children:[(0,P.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,P.jsxs)("select",{id:"organizationLanguage",value:V||_||"",onChange:async e=>{const t=e.target.value;if(O(t),t&&t!==_){U(!0);try{await B(t),F(i("common.save"),"success")}catch(r){console.error(i("organization.saveLanguageError"),r),F(i("worktime.messages.orgLanguageError"),"error")}finally{U(!1)}}},disabled:M||j,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,P.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,P.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,P.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,P.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:Q,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(j?"organization.saving":"common.save"),children:j?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!E&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:Q,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,P.jsx)("button",{onClick:Q,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,P.jsxs)("nav",{className:"-mb-px flex space-x-4 px-4","aria-label":"Tabs",children:[(0,P.jsx)("button",{type:"button",onClick:()=>W("general"),className:"".concat("general"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.general")}),(0,P.jsx)("button",{type:"button",onClick:()=>W("roles"),className:"".concat("roles"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.roles")}),(0,P.jsx)("button",{type:"button",onClick:()=>W("documents"),className:"".concat("documents"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.documents")}),(0,P.jsx)("button",{type:"button",onClick:()=>W("smtp"),className:"".concat("smtp"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.smtp")}),"CO"===b&&(0,P.jsx)("button",{type:"button",onClick:()=>W("api"),className:"".concat("api"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.api")})]})}),(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[N.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:N.submit}),"general"===q&&(0,P.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,P.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:d.displayName||"",onChange:Z,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(N.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),N.displayName&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:N.displayName})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,P.jsx)("input",{type:"text",id:"domain",name:"domain",value:d.domain||"",onChange:Z,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logo")||"Logo"}),(0,P.jsx)("input",{type:"file",id:"logo",name:"logo",accept:"image/png,image/jpeg,image/jpg",onChange:X,className:"mt-1 block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300 dark:hover:file:bg-blue-800"}),K&&(0,P.jsx)("div",{className:"mt-2",children:(0,P.jsx)("img",{src:K,alt:"Logo Preview",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})}),d.logo&&!K&&(0,P.jsx)("div",{className:"mt-2",children:(0,P.jsx)("img",{src:d.logo,alt:"Current Logo",className:"h-20 w-auto border border-gray-300 dark:border-gray-600 rounded"})})]}),(0,P.jsxs)("div",{className:"border-t pt-4",children:[(0,P.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,P.jsxs)("select",{id:"country",name:"country",value:b,onChange:Z,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,P.jsx)("option",{value:"",children:i("organization.selectCountry")}),Y.map((e=>(0,P.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),"CO"===b&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"nit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.nit")}),(0,P.jsx)("input",{type:"text",id:"nit",name:"nit",value:p,onChange:Z,placeholder:i("organization.nitDescription"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,P.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:i("organization.nitDescription")})]}),(0,P.jsxs)("div",{className:"border-t pt-4",children:[(0,P.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,P.jsxs)("select",{id:"organizationLanguage",value:V||_||"",onChange:async e=>{const t=e.target.value;if(O(t),t&&t!==_){U(!0);try{await B(t),F(i("common.save"),"success")}catch(r){console.error("Fehler beim Speichern der Organisation-Sprache:",r),F(i("worktime.messages.orgLanguageError"),"error")}finally{U(!1)}}},disabled:M||j,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,P.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,P.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,P.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,P.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:Q,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(j?"organization.saving":"common.save"),children:j?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(v.A,{className:"h-5 w-5"})})]})]}),"roles"===q&&(0,P.jsx)(a.Suspense,{fallback:(0,P.jsx)("div",{className:"p-4 text-center",children:i("common.loading","Lade...")}),children:(0,P.jsx)(bt,{organization:u||n,onSave:()=>{l&&l()}})}),"documents"===q&&(0,P.jsx)(a.Suspense,{fallback:(0,P.jsx)("div",{className:"p-4 text-center",children:i("common.loading","Lade...")}),children:(0,P.jsx)(ht,{organization:u||n,onSave:()=>{l&&l()}})}),"smtp"===q&&(0,P.jsx)(a.Suspense,{fallback:(0,P.jsx)("div",{className:"p-4 text-center",children:i("common.loading","Lade...")}),children:(0,P.jsx)(pt,{organization:u||n,onSave:()=>{l&&l()}})}),"api"===q&&"CO"===b&&(0,P.jsx)(a.Suspense,{fallback:(0,P.jsx)("div",{className:"p-4 text-center",children:i("common.loading","Lade...")}),children:(0,P.jsx)(yt,{organization:u||n,onSave:()=>{l&&l()}})})]})]})]})};var vt=r(3736);const kt=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},jt=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},wt="my-join-requests-table",Nt=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)([]),[l,n]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[u,g]=(0,a.useState)([]),[x,b]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),{showMessage:y}=(0,k.A)(),f=(0,a.useRef)(!0),[v,j]=(0,a.useState)(null),[A,S]=(0,a.useState)("Alle"),[C,E]=(0,a.useState)(null);(0,a.useEffect)((()=>()=>{f.current=!1}),[]),(0,a.useEffect)((()=>{K.v.log("MyJoinRequestsList: useEffect called - component mounted"),K.v.log("MyJoinRequestsList: Resetting state on mount to prevent data leaks"),r([]),o(null),n(!0);let t=!0;return(async()=>{if(!t)return void K.v.log("MyJoinRequestsList: Component unmounted, skipping fetch");K.v.log("MyJoinRequestsList: Starting fetch");const a=setTimeout((()=>{t&&(console.error("Request timeout after 10 seconds"),o("Anfrage dauert zu lange. Bitte Seite neu laden."),n(!1))}),1e4);try{K.v.log("MyJoinRequestsList: Setting loading to true"),n(!0),o(null),K.v.log("MyJoinRequestsList: Fetching my join requests from:",N.Sn.ORGANIZATIONS.MY_JOIN_REQUESTS);const e=await ct.h.getMyJoinRequests();if(K.v.log("MyJoinRequestsList: Received requests:",e),K.v.log("MyJoinRequestsList: Requests type:",typeof e),K.v.log("MyJoinRequestsList: Requests isArray:",Array.isArray(e)),K.v.log("MyJoinRequestsList: Requests length:",(null===e||void 0===e?void 0:e.length)||0),!Array.isArray(e))throw console.error("\u274c MyJoinRequestsList: Response is not an array!",e),new Error("Ung\xfcltige Antwort vom Server");clearTimeout(a),t?(K.v.log("MyJoinRequestsList: Setting joinRequests state"),r(e),K.v.log("MyJoinRequestsList: State updated with",e.length,"requests")):(K.v.log("MyJoinRequestsList: Component was unmounted, but setting state anyway"),r(e))}catch(c){var s,l,i,d;if(clearTimeout(a),!t)return void K.v.log("MyJoinRequestsList: Component unmounted during error, skipping error handling");console.error("MyJoinRequestsList: Error fetching my join requests:",c),console.error("MyJoinRequestsList: Error response:",c.response),console.error("MyJoinRequestsList: Error status:",null===(s=c.response)||void 0===s?void 0:s.status),console.error("MyJoinRequestsList: Error data:",null===(l=c.response)||void 0===l?void 0:l.data);const r=(null===(i=c.response)||void 0===i||null===(d=i.data)||void 0===d?void 0:d.message)||c.message||e("myJoinRequests.loadError");o(r),setTimeout((()=>{y(r,"error")}),0)}finally{t?(K.v.log("MyJoinRequestsList: Setting loading to false"),n(!1)):(K.v.log("MyJoinRequestsList: Component unmounted, but setting loading to false anyway"),n(!1))}})(),()=>{K.v.log("MyJoinRequestsList: useEffect cleanup - component unmounting"),t=!1,f.current=!1,r([]),o(null)}}),[]);const T=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=(e,t)=>{g(e),b(t)},R=()=>{g([]),b([]),S(""),E(null)},z=async(e,t,r,a)=>{S(e),E(t),L(r,a)},I=()=>u.length,F=(0,re.b)(),{loadFilters:_}=F;(0,a.useEffect)((()=>{(async()=>{const e=(await _(wt)).find((e=>"Alle"===e.name));e&&await z(e.name,e.id,e.conditions,e.operators)})()}),[_,z]),(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await w.A.get(N.Sn.SAVED_FILTERS.BY_TABLE(wt))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:wt,name:"Alle",conditions:[],operators:[]};await w.A.post(N.Sn.SAVED_FILTERS.BASE,e),K.v.log("Alle-Filter f\xfcr Meine Beitrittsanfragen erstellt")}}catch(i){console.error("Fehler beim Erstellen der Standard-Filter:",i)}})()}),[]);const B=(0,a.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var r;const a=(e.organization.displayName||e.organization.name||"").toLowerCase(),s=(null===(r=e.message)||void 0===r?void 0:r.toLowerCase())||"";return a.includes(t)||s.includes(t)}))}return u.length>0&&(e=u.reduce(((e,t,r)=>{if(!t.column||null===t.value||""===t.value)return e;const a=t.operator,s=t.value;return e.filter((e=>{var r;switch(t.column){case"organization":const t=(e.organization.displayName||e.organization.name||"").toLowerCase(),l=String(s).toLowerCase();return"contains"===a?t.includes(l):"equals"===a?t===l:"startsWith"===a&&t.startsWith(l);case"message":const n=(null===(r=e.message)||void 0===r?void 0:r.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===a?n.includes(i):"equals"===a?n===i:"startsWith"===a&&n.startsWith(i);case"status":return"equals"===a&&e.status===s;default:return!0}}))}),e)),e}),[t,h,u,x]);return(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("myJoinRequests.title")}),(0,P.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,P.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>p(e.target.value)}),(0,P.jsxs)("button",{className:"p-2 rounded-md border ".concat(I()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>c(!d),title:e("common.filter"),children:[(0,P.jsx)(Q.A,{className:"h-5 w-5"}),I()>0&&(0,P.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:I()})]})]})]}),d&&(0,P.jsx)("div",{className:"mb-4",children:(0,P.jsx)(ee.A,{columns:[{id:"organization",label:e("myJoinRequests.filter.organization",{defaultValue:"Organisation"})},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:L,onReset:R,savedConditions:u,savedOperators:x,tableId:wt})}),(0,P.jsx)(te.A,{tableId:wt,onSelectFilter:L,onReset:R,activeFilterName:A,selectedFilterId:C,onFilterChange:z,defaultFilterName:"Alle"}),i&&(0,P.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:i}),l?(0,P.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("myJoinRequests.loading")})]}):0===t.length?(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("myJoinRequests.noRequests")}):(0,P.jsx)("div",{className:"space-y-4",children:B.map((t=>(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsx)("div",{className:"flex items-start justify-between",children:(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.organization.displayName||t.organization.name}),(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:T(t.createdAt)})]}),(0,P.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(kt(t.status)),children:jt(t.status,e)})]}),t.message&&(0,P.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,P.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,P.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,P.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,P.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,P.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),t.processor&&(0,P.jsxs)("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e("myJoinRequests.processedBy"),": ",t.processor.firstName," ",t.processor.lastName,t.processedAt&&" - ".concat(T(t.processedAt))]}),"pending"===t.status&&(0,P.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,P.jsx)("button",{onClick:()=>(async t=>{if(window.confirm(e("myJoinRequests.confirmWithdraw")))try{j(t),await ct.h.withdrawJoinRequest(t),r((e=>e.map((e=>e.id===t?(0,m.A)((0,m.A)({},e),{},{status:"withdrawn",processedAt:(new Date).toISOString()}):e)))),y(e("myJoinRequests.withdrawSuccess"),"success")}catch(l){var a,s;const t=(null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||e("myJoinRequests.withdrawError");y(t,"error")}finally{j(null)}})(t.id),disabled:v===t.id,className:"p-2 bg-red-600 hover:bg-red-700 text-white rounded-md dark:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",title:v===t.id?e("myJoinRequests.withdrawing"):e("myJoinRequests.withdraw"),children:v===t.id?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):(0,P.jsx)(vt.A,{className:"h-5 w-5"})})})]})})},t.id)))})]})},At=()=>{const[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[u,g]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),{canViewOrganization:A,canManageOrganization:S,hasPermission:E,loading:T}=(0,l.S)(),{showMessage:D}=(0,k.A)(),{t:R}=(0,s.Bd)(),{refreshOrganization:z}=(0,ut.Z)(),{fetchCurrentUser:I}=(0,L.As)(),F=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{c(!0),h(null);const r=await ct.h.getCurrentOrganization(void 0,e);t(r);try{g(!0);const e=await ct.h.getOrganizationStats();i(e)}catch(o){console.error("Fehler beim Laden der Statistiken:",o)}finally{g(!1)}}catch(d){var r,a,s;if(404===(null===(r=d.response)||void 0===r?void 0:r.status)&&!1===(null===(a=d.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.hasOrganization))h(R("organization.notFound")),t(null),D(R("organization.notFound"),"info");else{var l,n;const e=(null===(l=d.response)||void 0===l||null===(n=l.data)||void 0===n?void 0:n.message)||R("organization.loadError");h(e),D(e,"error")}}finally{c(!1)}}),[]),_=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(T)return;if(_.current)return;return A()?(_.current=!0,F(!1)):(h(R("organization.noPermission")),c(!1),_.current=!0),()=>{t(null),i(null)}}),[T]);if(T)return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,P.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingPermissions")})]})});if(!A())return(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,P.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:R("organization.noPermission")})});return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsx)("div",{className:"flex items-center mb-4 sm:mb-4",children:(0,P.jsxs)("div",{className:"flex items-center gap-1.5","data-onboarding":"organization-buttons",children:[(0,P.jsx)("button",{onClick:()=>f(!0),"data-onboarding":"create-organization-button",className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:R("organization.createOrganization"),"aria-label":R("organization.createOrganization"),children:(0,P.jsx)(b.A,{className:"h-4 w-4"})}),(0,P.jsx)("button",{onClick:()=>j(!0),"data-onboarding":"join-organization-button",className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:R("organization.joinOrganization"),"aria-label":R("organization.joinOrganization"),children:(0,P.jsx)(it.A,{className:"h-4 w-4"})})]})}),d?(0,P.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingOrganization")})]}):(0,P.jsxs)(P.Fragment,{children:[x&&(0,P.jsx)("div",{className:"mb-4 p-4 border rounded ".concat(e?"bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300":"bg-blue-50 dark:bg-blue-900/30 border-blue-400 dark:border-blue-700 text-blue-700 dark:text-blue-300"),children:(0,P.jsxs)("div",{className:"flex items-start",children:[(0,P.jsx)("div",{className:"flex-shrink-0",children:e?(0,P.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"\u26a0\ufe0f"}):(0,P.jsx)(n.A,{className:"h-5 w-5"})}),(0,P.jsxs)("div",{className:"ml-3 flex-1",children:[(0,P.jsx)("p",{className:"font-medium",children:x}),!e&&(0,P.jsx)("p",{className:"mt-2 text-sm",children:R("organization.createOrJoinHint")})]})]})}),e?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsx)("div",{className:"flex items-start justify-between",children:(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[(0,P.jsx)(y.A,{className:"h-5 w-5 mr-2"}),e.displayName||e.name]}),(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.domain||R("organization.noDomain")})]}),E("organization_edit","write","button")&&(0,P.jsx)("button",{onClick:()=>{N(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:R("organization.edit.title"),children:(0,P.jsx)(C.A,{className:"h-5 w-5"})})]}),(0,P.jsx)("div",{className:"space-y-3",children:e.subscriptionPlan&&(0,P.jsxs)("div",{children:[(0,P.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[R("organization.subscriptionPlan"),":"]}),(0,P.jsx)("span",{className:"ml-2 text-sm text-gray-900 dark:text-white capitalize",children:e.subscriptionPlan})]})}),r&&(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:R("organization.statistics")}),u?(0,P.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),(0,P.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:R("common.loadingStatistics")})]}):(0,P.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3",children:(0,P.jsx)(n.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,P.jsxs)("div",{className:"ml-4",children:[(0,P.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.users")}),(0,P.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[r.currentUsers," / ",r.maxUsers]}),void 0!==r.utilizationPercent&&(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.utilizationPercent,"% ",R("organization.utilizationPercent")]})]})]})}),(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"flex-shrink-0 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3",children:(0,P.jsx)(o.A,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,P.jsxs)("div",{className:"ml-4",children:[(0,P.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.roles")}),(0,P.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.roles})]})]})}),(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3",children:(0,P.jsx)(ot.A,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),(0,P.jsxs)("div",{className:"ml-4",children:[(0,P.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.joinRequests")}),(0,P.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.joinRequests})]})]})}),void 0!==r._count.invitations&&(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"flex-shrink-0 bg-green-100 dark:bg-green-900/30 rounded-lg p-3",children:(0,P.jsx)(ot.A,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,P.jsxs)("div",{className:"ml-4",children:[(0,P.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.invitations")}),(0,P.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.invitations})]})]})}),void 0!==r.utilizationPercent&&(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"flex-shrink-0 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-3",children:(0,P.jsx)(dt.A,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),(0,P.jsxs)("div",{className:"ml-4",children:[(0,P.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.utilization")}),(0,P.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[r.utilizationPercent,"%"]}),(0,P.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.availableSlots," ",R("organization.availableSlots")]})]})]})})]})]})})]})})})}):(0,P.jsxs)("div",{className:"text-center py-8",children:[(0,P.jsx)(n.A,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),(0,P.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:R("organization.notFound")}),(0,P.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:R("organization.createOrJoinHint")})]})]})]}),(0,P.jsx)(Nt,{}),(0,P.jsx)(mt,{isOpen:p,onClose:()=>f(!1),onSuccess:()=>{F(!1)}}),(0,P.jsx)(gt,{isOpen:v,onClose:()=>j(!1),onSuccess:async()=>{F(!1),await I()}}),(0,P.jsx)(ft,{isOpen:w,onClose:()=>{N(!1),null!==e&&void 0!==e&&e.settings&&t((0,m.A)((0,m.A)({},e),{},{settings:void 0}))},onSuccess:()=>{F(!0),z()},organization:e})]})},St=e=>{let{isOpen:t,onClose:r,joinRequest:l,onSuccess:n}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)("approve"),[c,u]=(0,a.useState)(null),[b,h]=(0,a.useState)(""),[p,y]=(0,a.useState)([]),[j,w]=(0,a.useState)(!1),[N,A]=(0,a.useState)(!1),[S,C]=(0,a.useState)({}),[E,T]=(0,a.useState)(window.innerWidth<640),[L,z]=(0,a.useState)(window.innerWidth>1070),{openSidepane:I,closeSidepane:F}=(0,R.N)(),{showMessage:_}=(0,k.A)();(0,a.useEffect)((()=>{const e=()=>{T(window.innerWidth<640),z(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?I():F(),()=>{F()})),[t,I,F]),(0,a.useEffect)((()=>{t&&l&&(d("approve"),u(null),h(""),C({}),l.organizationId&&B())}),[t,l]);const B=async()=>{try{w(!0);const e=await x.Zj.getAll();e.data&&Array.isArray(e.data)&&y(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),_(i("joinRequest.loadRolesError"),"error")}finally{w(!1)}},O=async e=>{if(e.preventDefault(),(()=>{const e={};return"approve"!==o||c||(e.roleId=i("joinRequest.selectRoleError")),C(e),0===Object.keys(e).length})()){if(l)try{A(!0);const e={action:o,response:b.trim()||void 0,roleId:"approve"===o&&c||void 0};await ct.h.processJoinRequest(l.id,e),_(i("approve"===o?"joinRequest.approveSuccess":"joinRequest.rejectSuccess"),"success"),d("approve"),u(null),h(""),C({}),r(),n()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("joinRequest.processError");_(e,"error"),C({submit:e})}finally{A(!1)}}else _(i("joinRequest.fillRequired"),"error")},M=()=>{d("approve"),u(null),h(""),C({}),r()};return l?E?(0,P.jsxs)(g.lG,{open:t,onClose:M,className:"relative z-50",children:[(0,P.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,P.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,P.jsxs)(g.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,P.jsx)(g.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,P.jsx)("button",{onClick:M,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("form",{onSubmit:O,className:"p-4",children:[S.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,P.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,P.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[l.requester.firstName," ",l.requester.lastName]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l.requester.email}),l.message&&(0,P.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,P.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l.message})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,P.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,P.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,P.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,P.jsxs)("div",{className:"flex items-center py-2",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,P.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,P.jsxs)("select",{id:"roleId",value:c||"",onChange:e=>{u(Number(e.target.value)||null),S.roleId&&C((e=>(0,m.A)((0,m.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,P.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),p.map((e=>(0,P.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,P.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:M,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("joinRequest.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:N,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:i(N?"approve"===o?"joinRequest.approving":"joinRequest.rejecting":"approve"===o?"joinRequest.approve":"joinRequest.reject"),children:N?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,P.jsx)(v.A,{className:"h-5 w-5"}):(0,P.jsx)(V.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,P.jsxs)(P.Fragment,{children:[t&&!L&&(0,P.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:M,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,P.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,P.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,P.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,P.jsx)("button",{onClick:M,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,P.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,P.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[S.submit&&(0,P.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,P.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,P.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,P.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,P.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[l.requester.firstName," ",l.requester.lastName]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l.requester.email}),l.message&&(0,P.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,P.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l.message})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,P.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,P.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,P.jsxs)("label",{className:"flex items-center",children:[(0,P.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,P.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,P.jsxs)("div",{className:"flex items-center py-2",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,P.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,P.jsxs)("select",{id:"roleId",value:c||"",onChange:e=>{u(Number(e.target.value)||null),S.roleId&&C((e=>(0,m.A)((0,m.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,P.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),p.map((e=>(0,P.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,P.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,P.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,P.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,P.jsx)("button",{type:"button",onClick:M,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,P.jsx)(f.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"submit",disabled:N,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:N?"approve"===o?"Genehmige...":"Lehne ab...":"approve"===o?"Genehmigen":"Ablehnen",children:N?(0,P.jsx)(D.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,P.jsx)(v.A,{className:"h-5 w-5"}):(0,P.jsx)(V.A,{className:"h-5 w-5"})})]})]})]})]})]}):null},Ct=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Et=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},Tt="join-requests-table",Dt=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1),[m,g]=(0,a.useState)([]),[x,b]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),[y,f]=(0,a.useState)(!1),[v,j]=(0,a.useState)(null),[w,A]=(0,a.useState)("Alle"),[S,E]=(0,a.useState)(null),{canViewJoinRequests:T,canManageJoinRequests:D,loading:L}=(0,l.S)(),{showMessage:R}=(0,k.A)(),z=(0,a.useRef)(!0),I=(0,a.useRef)(!1);(0,a.useEffect)((()=>{K.v.log("[JoinRequestsList] permissionsLoading ge\xe4ndert:",L)}),[L]),(0,a.useEffect)((()=>(K.v.log("[JoinRequestsList] Component mounted, reset hasInitialLoadRef"),I.current=!1,z.current=!0,()=>{K.v.log("[JoinRequestsList] Component unmounting"),z.current=!1})),[]),(0,a.useEffect)((()=>{if(K.v.log("[JoinRequestsList] useEffect triggered",{permissionsLoading:L,hasInitialLoad:I.current,joinRequestsCount:t.length}),L)return void K.v.log("[JoinRequestsList] Warte auf Berechtigungen...");const a=T();if(K.v.log("[JoinRequestsList] Berechtigung gepr\xfcft:",a),!a)return K.v.log("[JoinRequestsList] Keine Berechtigung zum Anzeigen"),d(e("joinRequestsList.noPermission")),i(!1),void(I.current=!0);if(I.current)return void K.v.log("[JoinRequestsList] Bereits geladen, \xfcberspringe Fetch");K.v.log("[JoinRequestsList] Starte Fetch der Join Requests...");(async()=>{if(z.current)try{K.v.log("[JoinRequestsList] Setze loading auf true"),i(!0),d(null),K.v.log("[JoinRequestsList] Rufe organizationService.getJoinRequests() auf..."),K.v.log("[JoinRequestsList] API Endpoint:",N.Sn.ORGANIZATIONS.JOIN_REQUESTS);const e=await ct.h.getJoinRequests();if(K.v.log("[JoinRequestsList] Antwort erhalten:",e),K.v.log("[JoinRequestsList] Antwort Typ:",typeof e),K.v.log("[JoinRequestsList] Ist Array:",Array.isArray(e)),K.v.log("[JoinRequestsList] Ist null/undefined:",null===e||void 0===e),!z.current)return void K.v.log("[JoinRequestsList] Component w\xe4hrend Request unmounted");if(null===e||void 0===e)throw console.error("[JoinRequestsList] \u274c Antwort ist null oder undefined!"),new Error("Ung\xfcltige Antwort vom Server: Antwort ist null oder undefined");if(!Array.isArray(e))throw console.error("[JoinRequestsList] \u274c Antwort ist kein Array!",e),new Error("Ung\xfcltige Antwort vom Server: Erwartetes Array, erhalten: "+typeof e);K.v.log("[JoinRequestsList] \u2705 Setze",e.length,"Join Requests"),r(e),d(null),I.current=!0}catch(n){var t,a,s,l;if(console.error("[JoinRequestsList] \u274c Fehler beim Laden:",n),console.error("[JoinRequestsList] Fehler Details:",{message:n.message,response:n.response,status:null===(t=n.response)||void 0===t?void 0:t.status,data:null===(a=n.response)||void 0===a?void 0:a.data,stack:n.stack}),!z.current)return void K.v.log("[JoinRequestsList] Component w\xe4hrend Error-Handling unmounted");const r=(null===(s=n.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message)||n.message||e("joinRequestsList.loadError",{defaultValue:"Fehler beim Laden der Beitrittsanfragen"});K.v.log("[JoinRequestsList] Zeige Fehlermeldung:",r),d(r),setTimeout((()=>{R(r,"error")}),0)}finally{z.current&&(K.v.log("[JoinRequestsList] Setze loading auf false"),i(!1))}else K.v.log("[JoinRequestsList] Component unmounted, breche ab")})()}),[L]);const F=(e,t)=>{g(e),b(t)},_=()=>{g([]),b([]),A(""),E(null)},B=async(e,t,r,a)=>{A(e),E(t),F(r,a)},V=(0,re.b)(),{loadFilters:O}=V;(0,a.useEffect)((()=>{(async()=>{const e=(await O(Tt)).find((e=>"Alle"===e.name));e&&await B(e.name,e.id,e.conditions,e.operators)})()}),[O,B]);const M=()=>m.length,U=(0,a.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var r,a;const s="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),l=(null===(r=e.requester.email)||void 0===r?void 0:r.toLowerCase())||"",n=(null===(a=e.message)||void 0===a?void 0:a.toLowerCase())||"";return s.includes(t)||l.includes(t)||n.includes(t)}))}return m.length>0&&(e=m.reduce(((e,t,r)=>{if(!t.column||null===t.value||""===t.value)return e;const a=t.operator,s=t.value;return e.filter((e=>{var r,l;switch(t.column){case"requester":const t="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),n=(null===(r=e.requester.email)||void 0===r?void 0:r.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===a?t.includes(i)||n.includes(i):"equals"===a?t===i||n===i:"startsWith"===a&&(t.startsWith(i)||n.startsWith(i));case"message":const o=(null===(l=e.message)||void 0===l?void 0:l.toLowerCase())||"",d=String(s).toLowerCase();return"contains"===a?o.includes(d):"equals"===a?o===d:"startsWith"===a&&o.startsWith(d);case"status":return"equals"===a&&e.status===s;default:return!0}}))}),e)),e}),[t,h,m,x]);return L?(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,P.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loadingPermissions")})]})}):T()?(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 sm:p-6 mb-6",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-4",children:[(0,P.jsxs)("h2",{className:"text-xl sm:text-xl font-semibold flex items-center dark:text-white",children:[(0,P.jsx)(it.A,{className:"h-6 w-6 sm:h-6 sm:w-6 mr-2 sm:mr-2"}),e("joinRequestsList.title")]}),(0,P.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,P.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>p(e.target.value)}),(0,P.jsxs)("button",{className:"p-2 rounded-md border ".concat(M()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>u(!c),title:e("common.filter"),children:[(0,P.jsx)(Q.A,{className:"h-5 w-5"}),M()>0&&(0,P.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:M()})]})]})]}),c&&(0,P.jsx)("div",{className:"mb-4",children:(0,P.jsx)(ee.A,{columns:[{id:"requester",label:e("joinRequestsList.filter.requester")},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:F,onReset:_,savedConditions:m,savedOperators:x,tableId:Tt})}),(0,P.jsx)(te.A,{tableId:Tt,onSelectFilter:F,onReset:_,activeFilterName:w,selectedFilterId:S,onFilterChange:B,defaultFilterName:"Alle"}),o&&(0,P.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:o}),n?(0,P.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,P.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,P.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loading")})]}):0===U.length?(0,P.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:0===t.length?e("joinRequestsList.noRequests"):e("joinRequestsList.noMatching")}):(0,P.jsx)("div",{className:"space-y-4",children:U.map((t=>(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,P.jsx)("div",{className:"flex items-start justify-between",children:(0,P.jsxs)("div",{className:"flex-1",children:[(0,P.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.requester.firstName," ",t.requester.lastName]}),(0,P.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.requester.email})]}),(0,P.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(Ct(t.status)),children:Et(t.status,e)})]}),t.message&&(0,P.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,P.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,P.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,P.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,P.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,P.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),"pending"===t.status&&D()&&(0,P.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,P.jsx)("button",{onClick:()=>(t=>{if(!D()){const t=e("joinRequestsList.noPermissionEdit");return d(t),void R(t,"error")}j(t),f(!0)})(t),className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:e("joinRequestsList.edit"),children:(0,P.jsx)(C.A,{className:"h-5 w-5"})})})]})})},t.id)))}),(0,P.jsx)(St,{isOpen:y,onClose:()=>{f(!1),j(null)},joinRequest:v,onSuccess:async()=>{I.current=!1;try{i(!0);const e=await ct.h.getJoinRequests();r(e),d(null),I.current=!0}catch(a){var e,t;const r=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Laden der Beitrittsanfragen";d(r),I.current=!0}finally{i(!1)}}})]}):(0,P.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,P.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("joinRequestsList.noPermission")})})},Lt=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)(!1),[m,g]=(0,a.useState)(null),{showMessage:x}=(0,k.A)(),{isAdmin:b,hasPermission:h,canView:p,canViewOrganization:y,loading:f}=(0,l.S)(),v=p("organization_management","page"),j=p("users","tab"),w=p("roles","tab"),N=p("branches","tab"),A=p("tour_providers","tab"),S=p("organization_settings","tab"),[C,E]=(0,a.useState)("users"),[T,D]=(0,a.useState)("tours"),L=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(!f&&!L.current){let e="organization";j?e="users":w?e="roles":N?e="branches":A?e="providers":S&&(e="organization"),E(e),L.current=!0}}),[f,j,w,N,A,S]);const R=e=>{("users"!==e||j)&&("roles"!==e||w)&&("branches"!==e||N)&&("providers"!==e||A)&&("organization"!==e||S)&&(E(e),g(null))};return v?(0,P.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,P.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,P.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,P.jsxs)("div",{className:"flex items-center mb-6",children:[(0,P.jsx)(n.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,P.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("organisation.title")})]}),(0,P.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,P.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[j&&(0,P.jsxs)("button",{className:"".concat("users"===C?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center relative flex-shrink-0"),onClick:()=>R("users"),children:[(0,P.jsx)(i.A,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e("organisation.tabs.users")]}),w&&(0,P.jsxs)("button",{className:"".concat("roles"===C?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center relative flex-shrink-0"),onClick:()=>R("roles"),children:[(0,P.jsx)(o.A,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e("organisation.tabs.roles")]}),N&&(0,P.jsxs)("button",{className:"".concat("branches"===C?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center relative flex-shrink-0"),onClick:()=>R("branches"),children:[(0,P.jsx)(d.A,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e("organisation.tabs.branches",{defaultValue:"Niederlassungen"})]}),A&&(0,P.jsxs)("button",{className:"".concat("providers"===C?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center relative flex-shrink-0"),onClick:()=>R("providers"),children:[(0,P.jsx)(c.A,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e("organisation.tabs.providers",{defaultValue:"Proveedores"})]}),S&&(0,P.jsxs)("button",{className:"".concat("organization"===C?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center flex-shrink-0"),onClick:()=>R("organization"),children:[(0,P.jsx)(n.A,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1 sm:mr-2"}),e("organisation.tabs.organization")]})]})}),m&&(0,P.jsxs)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded mb-4",children:[(0,P.jsx)("p",{className:"font-bold",children:e("organisation.error")}),(0,P.jsx)("p",{children:m})]}),t&&(0,P.jsx)("div",{className:"p-4 dark:text-gray-300",children:e("organisation.loading")}),(0,P.jsxs)("div",{className:"mt-6",children:["users"===C&&j&&(0,P.jsx)(Y,{}),"roles"===C&&w&&(0,P.jsx)(Ae,{}),"branches"===C&&N&&(0,P.jsx)(Te,{}),"providers"===C&&A&&(0,P.jsxs)("div",{className:"space-y-4",children:[(0,P.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,P.jsx)("button",{type:"button",onClick:()=>D("tours"),className:"p-2 rounded-md transition-colors ".concat("tours"===T?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"),title:e("tours.title","Touren"),children:(0,P.jsx)(u.A,{className:"h-5 w-5"})}),(0,P.jsx)("button",{type:"button",onClick:()=>D("providers"),className:"p-2 rounded-md transition-colors ".concat("providers"===T?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":"text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"),title:e("organisation.tabs.providers",{defaultValue:"Proveedores"}),children:(0,P.jsx)(c.A,{className:"h-5 w-5"})})]}),"tours"===T?(0,P.jsx)(nt,{}):(0,P.jsx)(Pe,{})]}),"organization"===C&&S&&(0,P.jsxs)("div",{className:"space-y-6",children:[(0,P.jsx)(At,{}),(0,P.jsx)(Dt,{})]})]})]})})}):(0,P.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("organisation.noPermission")})}},8897:(e,t,r)=>{r.d(t,{A:()=>g});var a=r(5043),s=r(4117),l=r(9626),n=r(2311),i=r(1909),o=r(9531),d=r(4832),c=r(7591),u=r(579);const m=e=>{let{id:t,label:r,index:a,isVisible:c,onToggleVisibility:m,sortDirection:g,onSortDirectionChange:x,showMainSort:b=!1,isMainSort:h=!1}=e;const{t:p}=(0,s.Bd)();return(0,u.jsxs)("li",{className:"flex items-center justify-between px-2.5 py-2 rounded-md transition-colors duration-150 hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,u.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:(0,u.jsx)("span",{className:"text-sm dark:text-gray-300",children:r})}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[x&&(0,u.jsx)("button",{onClick:e=>{e.stopPropagation();x(t,h&&void 0!==g&&"asc"===g?"desc":"asc")},className:"inline-flex items-center justify-center p-1.5 rounded-md transition-colors duration-150 ".concat(h?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/50":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-300"),title:h&&void 0!==g?"".concat(p("tableColumn.mainSort"),": ").concat(p("asc"===g?"tableColumn.ascending":"tableColumn.descending")," (").concat(p("tableColumn.clickToToggle"),")"):"".concat(p("tableColumn.setMainSort")," (").concat(p("tableColumn.clickToSet"),")"),children:h&&"asc"===g?(0,u.jsx)(l.A,{className:"h-4 w-4"}):h&&"desc"===g?(0,u.jsx)(n.A,{className:"h-4 w-4"}):(0,u.jsx)(i.A,{className:"h-4 w-4"})}),(0,u.jsx)("button",{onClick:()=>m(t),className:"inline-flex items-center justify-center p-1.5 rounded-full bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-300 transition-colors duration-150",title:p(c?"tableColumn.hideColumn":"tableColumn.showColumn"),children:c?(0,u.jsx)(o.A,{className:"w-4 h-4 dark:text-gray-300"}):(0,u.jsx)(d.A,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})})]})]})},g=e=>{let{columns:t,visibleColumns:r,columnOrder:l,onToggleColumnVisibility:n,onMoveColumn:o,onClose:d,buttonTitle:g,modalTitle:x,mainSortConfig:b,onMainSortChange:h,showMainSort:p=!1,isOpen:y,onOpenChange:f}=e;const{t:v}=(0,s.Bd)(),k=g||v("tableColumn.configure"),j=x||v("tableColumn.configure"),[w,N]=(0,a.useState)(!1),A=void 0!==y?y:w,S=(0,a.useRef)(null),C=[...t].sort(((e,t)=>{const r=l.indexOf(e.id),a=l.indexOf(t.id);return-1===r?1:-1===a?-1:r-a})),E=(0,a.useCallback)((()=>{void 0!==y?null===f||void 0===f||f(!1):N(!1),null===d||void 0===d||d()}),[y,f,d]),T=(0,a.useCallback)((()=>{void 0!==y?null===f||void 0===f||f(!0):N(!0)}),[y,f]);return(0,a.useEffect)((()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&E()};return A&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[A,E]),(0,a.useEffect)((()=>{const e=e=>{"Escape"===e.key&&A&&E()};return A&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[A,E]),(0,u.jsxs)("div",{className:"relative",ref:S,children:[void 0===y&&(0,u.jsx)("button",{className:"inline-flex items-center justify-center p-2 rounded-md bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-300 transition-colors duration-150",onClick:A?E:T,title:k,children:p?(0,u.jsx)(i.A,{className:"w-5 h-5"}):(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:(0,u.jsx)("path",{fillRule:"evenodd",d:"M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 012 10z",clipRule:"evenodd"})})}),A&&(0,u.jsxs)("div",{className:"absolute right-0 mt-2 w-64 max-w-[calc(100vw-1rem)] bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 border border-gray-300 dark:border-gray-600",role:"dialog","aria-modal":"true","aria-labelledby":"table-column-config-title",children:[(0,u.jsxs)("div",{className:"px-3 py-2.5 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,u.jsx)("h3",{id:"table-column-config-title",className:"text-sm font-semibold text-gray-900 dark:text-white",children:j}),(0,u.jsx)("button",{onClick:E,className:"inline-flex items-center justify-center p-2 rounded-md bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-300 transition-colors duration-150",title:v("common.close"),children:(0,u.jsx)(c.A,{className:"w-5 h-5"})})]}),(0,u.jsx)("ul",{className:"px-2 py-1 max-h-64 overflow-y-auto",children:C.map(((e,t)=>{const a=r.includes(e.id),s=(null===b||void 0===b?void 0:b.key)===e.id,l=s?b.direction:void 0,i=p&&h;return(0,u.jsx)(m,{id:e.id,label:e.label,index:t,isVisible:a,onToggleVisibility:n,sortDirection:l,onSortDirectionChange:i?h:void 0,showMainSort:p,isMainSort:s},e.id)}))})]})]})}}}]);
//# sourceMappingURL=643.15a95f2c.chunk.js.map