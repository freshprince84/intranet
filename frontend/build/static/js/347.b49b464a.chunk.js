"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[347],{542:(e,t,r)=>{r.d(t,{Ay:()=>l,H_:()=>c,Zj:()=>s,i$:()=>o});var n=r(1923),a=r(1801);console.log("DEBUGAUSGABE API-Client: API_URL ist:",a.H$);const i=n.A;i.interceptors.request.use((e=>{var t;const r="".concat(e.baseURL).concat(e.url);console.log("DEBUGAUSGABE API-Client: Vollst\xe4ndige Request URL:",r),console.log("DEBUGAUSGABE API-Client: Request-Methode:",null===(t=e.method)||void 0===t?void 0:t.toUpperCase()),console.log("DEBUGAUSGABE API-Client: Request-Headers:",e.headers),console.log("DEBUGAUSGABE API-Client: Request-Daten:",e.data);const n=localStorage.getItem("token");return console.log("DEBUGAUSGABE API-Client: Token vorhanden:",!!n),e}),(e=>(console.error("DEBUGAUSGABE API-Client: Fehler im Request Interceptor:",e),Promise.reject(e)))),i.interceptors.response.use((e=>(console.log("DEBUGAUSGABE API-Client: Response erhalten:",e.status,e.config.url),e)),(e=>(console.error("DEBUGAUSGABE API-Client: Fehler im Response Interceptor:",e.message),e.response?(console.error("DEBUGAUSGABE API-Client: Response Status:",e.response.status),console.error("DEBUGAUSGABE API-Client: Response Daten:",e.response.data)):console.error("DEBUGAUSGABE API-Client: Keine Response erhalten"),Promise.reject(e))));const o={getAll:()=>i.get("/users"),getById:e=>i.get("/users/".concat(e)),create:e=>{console.log("DEBUGAUSGABE API-Client: userApi.create wird aufgerufen mit Daten:",e);try{return i.post("/users",e).then((e=>(console.log("DEBUGAUSGABE API-Client: userApi.create Antwort:",e),e))).catch((e=>{throw console.error("DEBUGAUSGABE API-Client: userApi.create Fehler:",e.response||e),e}))}catch(t){throw console.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in userApi.create:",t),t}},update:(e,t)=>i.put("/users/".concat(e),t),updateRoles:(e,t)=>i.put("/users/".concat(e,"/roles"),{roleIds:t}),updateBranches:(e,t)=>i.put("/users/".concat(e,"/branches"),{branchIds:t})},s={getAll:e=>{console.log("DEBUGAUSGABE API-Client: roleApi.getAll wird aufgerufen",e?"mit branchId=".concat(e):"");const t=e?"/roles?branchId=".concat(e):"/roles";return i.get(t).then((e=>(console.log("DEBUGAUSGABE API-Client: roleApi.getAll erfolgreich:",e.data.length,"Rollen geladen"),e))).catch((e=>{throw console.error("DEBUGAUSGABE API-Client: roleApi.getAll Fehler:",e.message),e}))},getById:e=>(console.log("DEBUGAUSGABE API-Client: roleApi.getById(".concat(e,") wird aufgerufen")),i.get("/roles/".concat(e))),create:e=>{console.log("DEBUGAUSGABE API-Client: roleApi.create wird aufgerufen mit Daten:",e);try{return i.post("/roles",e).then((e=>(console.log("DEBUGAUSGABE API-Client: roleApi.create Antwort:",e),e))).catch((e=>{throw console.error("DEBUGAUSGABE API-Client: roleApi.create Fehler:",e.response||e),e}))}catch(t){throw console.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.create:",t),t}},update:(e,t)=>{console.log("DEBUGAUSGABE API-Client: roleApi.update f\xfcr ID ".concat(e," wird aufgerufen mit Daten:"),t);try{return i.put("/roles/".concat(e),t).then((e=>(console.log("DEBUGAUSGABE API-Client: roleApi.update Antwort:",e),e))).catch((e=>{throw console.error("DEBUGAUSGABE API-Client: roleApi.update Fehler:",e.response||e),e}))}catch(r){throw console.error("DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.update:",r),r}},delete:e=>(console.log("DEBUGAUSGABE API-Client: roleApi.delete(".concat(e,") wird aufgerufen")),i.delete("/roles/".concat(e))),getRoleBranches:e=>(console.log("DEBUGAUSGABE API-Client: roleApi.getRoleBranches(".concat(e,") wird aufgerufen")),i.get("/roles/".concat(e,"/branches"))),updateRoleBranches:(e,t)=>(console.log("DEBUGAUSGABE API-Client: roleApi.updateRoleBranches(".concat(e,") wird aufgerufen mit:"),t),i.put("/roles/".concat(e,"/branches"),t))},c={getAll:e=>{const t=e?"/branches?roleId=".concat(e):"/branches";return i.get(t)},getById:e=>i.get("/branches/".concat(e)),getUserBranches:()=>i.get("/branches/user"),switchBranch:e=>i.put("/branches/switch",{branchId:e}),create:e=>i.post("/branches",e),update:(e,t)=>i.put("/branches/".concat(e),t),delete:e=>i.delete("/branches/".concat(e))},l=i},4791:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(45),a=r(5043);const i=["title","titleId"];function o(e,t){let{title:r,titleId:o}=e,s=(0,n.A)(e,i);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),r?a.createElement("title",{id:o},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}const s=a.forwardRef(o)},5408:(e,t,r)=>{r.d(t,{Gp:()=>l,Nn:()=>u,Pe:()=>g,Tt:()=>m,Yw:()=>o,f:()=>d,n4:()=>s,xv:()=>c});var n=r(9379),a=r(542),i=r(1801);const o=async e=>{try{return(await a.Ay.get(i.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e))).data}catch(t){throw console.error("Fehler beim Abrufen der Identifikationsdokumente:",t),t}},s=async(e,t)=>{try{return(await a.Ay.post(i.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){throw console.error("Fehler beim Hinzuf\xfcgen des Dokuments:",r),r}},c=async(e,t,r)=>{try{return(await a.Ay.post(i.Sn.IDENTIFICATION_DOCUMENTS.BY_USER(e),(0,n.A)((0,n.A)({},r),{},{imageData:t}))).data}catch(o){throw console.error("Fehler beim Hinzuf\xfcgen des Dokuments mit Kamera:",o),o}},l=async(e,t)=>{try{return(await a.Ay.put(i.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){throw console.error("Fehler beim Aktualisieren des Dokuments:",r),r}},d=async(e,t,r)=>{try{return(await a.Ay.put(i.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e),(0,n.A)((0,n.A)({},r),{},{imageData:t}))).data}catch(o){throw console.error("Fehler beim Aktualisieren des Dokuments mit Kamera:",o),o}},u=async e=>{try{await a.Ay.delete(i.Sn.IDENTIFICATION_DOCUMENTS.BY_ID(e))}catch(t){throw console.error("Fehler beim L\xf6schen des Dokuments:",t),t}},m=async(e,t)=>{try{await a.Ay.post(i.Sn.IDENTIFICATION_DOCUMENTS.VERIFY(e),{adminId:t})}catch(r){throw console.error("Fehler bei der Verifizierung des Dokuments:",r),r}},g=e=>"".concat(window.location.origin,"/api").concat(i.Sn.IDENTIFICATION_DOCUMENTS.DOWNLOAD(e))},6238:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(45),a=r(5043);const i=["title","titleId"];function o(e,t){let{title:r,titleId:o}=e,s=(0,n.A)(e,i);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),r?a.createElement("title",{id:o},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const s=a.forwardRef(o)},6768:(e,t,r)=>{r.d(t,{A:()=>d});var n=r(5043),a=r(4117),i=r(5408),o=r(7855),s=r(8444),c=r(2672),l=r(579);const d=e=>{let{userId:t,isAdmin:r=!1}=e;const{t:d}=(0,a.Bd)(),[u,m]=(0,n.useState)([]),[g,p]=(0,n.useState)(!0),[h,x]=(0,n.useState)(null),[y,b]=(0,n.useState)(!1),[f,w]=(0,n.useState)(null),[A,v]=(0,n.useState)(null),{showMessage:k}=(0,o.A)(),{user:D}=(0,c.As)(),j=async()=>{p(!0);try{const e=await i.Yw(t);m(e),x(null)}catch(e){x(e.message||d("identificationDocuments.loadError")),k(d("identificationDocuments.loadError"),"error")}finally{p(!1)}};(0,n.useEffect)((()=>{j()}),[t]);const N=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE")}catch(t){return e}};return y?(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium mb-4",children:d("identificationDocuments.addDocument")}),(0,l.jsx)(s.A,{userId:t,onDocumentSaved:()=>{b(!1),j()},onCancel:()=>b(!1)})]}):f?(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium mb-4",children:d("identificationDocuments.editDocument")}),(0,l.jsx)(s.A,{userId:t,document:f,onDocumentSaved:()=>{w(null),j()},onCancel:()=>w(null)})]}):(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:d("identificationDocuments.title")}),(0,l.jsx)("button",{onClick:()=>b(!0),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:d("identificationDocuments.newDocument")})]}),g?(0,l.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-white"})}):h?(0,l.jsx)("div",{className:"text-red-600 p-4",children:h}):0===u.length?(0,l.jsx)("div",{className:"text-gray-500 dark:text-gray-400 p-4",children:d("identificationDocuments.noDocuments")}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,l.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.type")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.number")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.country")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.validFrom")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.validTo")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.status")}),(0,l.jsx)("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:d("identificationDocuments.columns.actions")})]})}),(0,l.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:u.map((e=>{return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(t=e.documentType,{passport:d("identificationDocuments.types.passport"),national_id:d("identificationDocuments.types.national_id"),driving_license:d("identificationDocuments.types.driving_license"),residence_permit:d("identificationDocuments.types.residence_permit"),work_permit:d("identificationDocuments.types.work_permit"),tax_id:d("identificationDocuments.types.tax_id"),social_security:d("identificationDocuments.types.social_security")}[t]||t)}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.documentNumber}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.issuingCountry}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:N(e.issueDate)}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:N(e.expiryDate)}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm",children:e.isVerified?(0,l.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100",children:d("identificationDocuments.status.verified")}):(0,l.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100",children:d("identificationDocuments.status.pending")})}),(0,l.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm font-medium",children:(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:()=>(async e=>{v(e);try{const t=i.Pe(e);window.open(t,"_blank")}catch(t){k("".concat(d("identificationDocuments.downloadError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}finally{v(null)}})(e.id),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",disabled:A===e.id,children:A===e.id?d("identificationDocuments.actions.downloading"):d("identificationDocuments.actions.view")}),(0,l.jsx)("button",{onClick:()=>w(e),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:d("identificationDocuments.actions.edit")}),(0,l.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(d("identificationDocuments.deleteConfirm")))try{await i.Nn(e),k(d("identificationDocuments.deleteSuccess"),"success"),j()}catch(t){k("".concat(d("identificationDocuments.deleteError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}})(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:d("identificationDocuments.actions.delete")}),r&&!e.isVerified&&(0,l.jsx)("button",{onClick:()=>(async e=>{if(D)try{await i.Tt(e,D.id),k(d("identificationDocuments.verifySuccess"),"success"),j()}catch(t){k("".concat(d("identificationDocuments.verifyError"),": ").concat(t.message||"Unbekannter Fehler"),"error")}else k(d("identificationDocuments.notAuthenticated"),"error")})(e.id),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",children:d("identificationDocuments.actions.verify")})]})})]},e.id);var t}))})]})})]})}},7098:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(45),a=r(5043);const i=["title","titleId"];function o(e,t){let{title:r,titleId:o}=e,s=(0,n.A)(e,i);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),r?a.createElement("title",{id:o},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const s=a.forwardRef(o)},7988:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(45),a=r(5043);const i=["title","titleId"];function o(e,t){let{title:r,titleId:o}=e,s=(0,n.A)(e,i);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),r?a.createElement("title",{id:o},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const s=a.forwardRef(o)},8444:(e,t,r)=>{r.d(t,{A:()=>f});var n=r(5043),a=r(4117),i=r(5408),o=r(7855);const s=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768;var c=r(7591),l=r(45);const d=["title","titleId"];function u(e,t){let{title:r,titleId:a}=e,i=(0,l.A)(e,d);return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const m=n.forwardRef(u);var g=r(1816),p=r(9422),h=r(579);const x=e=>{let{onCapture:t,onCancel:r}=e;const{t:i}=(0,a.Bd)(),[o,l]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[x,y]=(0,n.useState)(null),b=(0,n.useRef)(null),f=(0,n.useRef)(null),w=async()=>{try{y(null);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});l(e),b.current&&(b.current.srcObject=e)}catch(x){console.error("Fehler beim Zugriff auf die Kamera:",x),y(i("camera.accessError"))}},A=()=>{o&&(o.getTracks().forEach((e=>e.stop())),l(null))};return(0,n.useEffect)((()=>(s()&&w(),()=>{A()})),[]),s()?(0,h.jsxs)("div",{className:"camera-capture p-2 dark:bg-gray-800",children:[(0,h.jsx)("canvas",{ref:f,className:"hidden"}),x&&(0,h.jsxs)("div",{className:"error bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:[(0,h.jsx)("p",{children:x}),(0,h.jsxs)("div",{className:"relative group mt-2",children:[(0,h.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,h.jsx)(c.A,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("camera.back")})]})]}),x||d?!x&&d?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"preview-container mb-4 rounded overflow-hidden border border-gray-300 dark:border-gray-700",children:(0,h.jsx)("img",{src:d,alt:"Aufgenommenes Dokument",className:"w-full h-auto"})}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:()=>{u(null),w()},children:(0,h.jsx)(g.A,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Neu aufnehmen"})]}),(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("button",{className:"p-2 bg-green-500 dark:bg-green-600 text-white rounded-md hover:bg-green-600 dark:hover:bg-green-700",onClick:()=>{d&&t(d)},children:(0,h.jsx)(p.A,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Verwenden"})]})]})]}):null:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"video-container mb-4 rounded overflow-hidden border border-gray-300 dark:border-gray-700",children:(0,h.jsx)("video",{ref:b,autoPlay:!0,playsInline:!0,className:"w-full h-auto"})}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,h.jsx)(c.A,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Abbrechen"})]}),(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("button",{className:"p-2 bg-blue-500 dark:bg-blue-600 text-white rounded-md hover:bg-blue-600 dark:hover:bg-blue-700",onClick:()=>{if(b.current&&f.current){const e=f.current,t=b.current;e.width=t.videoWidth,e.height=t.videoHeight;const r=e.getContext("2d");if(r){r.drawImage(t,0,0);const n=e.toDataURL("image/jpeg",.9);u(n),A()}}},children:(0,h.jsx)(m,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Foto aufnehmen"})]})]})]})]}):(0,h.jsxs)("div",{className:"p-4 text-center dark:bg-gray-800 dark:text-white",children:[(0,h.jsx)("p",{className:"mb-4",children:i("camera.onlyMobile")}),(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("button",{className:"p-2 bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 rounded-md",onClick:r,children:(0,h.jsx)(c.A,{className:"h-5 w-5"})}),(0,h.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("camera.back")})]})]})};var y=r(1801);var b=r(2704);const f=e=>{let{userId:t,document:r,onDocumentSaved:l,onCancel:d}=e;const{t:u}=(0,a.Bd)(),[f,w]=(0,n.useState)((null===r||void 0===r?void 0:r.documentType)||""),[A,v]=(0,n.useState)((null===r||void 0===r?void 0:r.documentNumber)||""),[k,D]=(0,n.useState)(null!==r&&void 0!==r&&r.issueDate?r.issueDate.substring(0,10):""),[j,N]=(0,n.useState)(null!==r&&void 0!==r&&r.expiryDate?r.expiryDate.substring(0,10):""),[E,I]=(0,n.useState)((null===r||void 0===r?void 0:r.issuingCountry)||""),[C,B]=(0,n.useState)((null===r||void 0===r?void 0:r.issuingAuthority)||""),[S,U]=(0,n.useState)(null),[G,F]=(0,n.useState)(null),[P,T]=(0,n.useState)(!1),[_,R]=(0,n.useState)(!1),[M,O]=(0,n.useState)(!1),[L,V]=(0,n.useState)(null),{showMessage:z}=(0,o.A)(),W=[{value:"passport",label:u("identificationDocuments.types.passport")},{value:"national_id",label:u("identificationDocuments.types.national_id")},{value:"driving_license",label:u("identificationDocuments.types.driving_license")},{value:"residence_permit",label:u("identificationDocuments.types.residence_permit")},{value:"work_permit",label:u("identificationDocuments.types.work_permit")},{value:"tax_id",label:u("identificationDocuments.types.tax_id")},{value:"social_security",label:u("identificationDocuments.types.social_security")}],q=e=>{F(e),T(!1),U(null)},H=()=>{T(!1)};return P?(0,h.jsx)(x,{onCapture:q,onCancel:H}):(0,h.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f&&A&&E){R(!0);try{if(r){if(S){const e=new FormData;A&&e.append("documentNumber",A),k&&e.append("issueDate",k),j&&e.append("expiryDate",j),E&&e.append("issuingCountry",E),C&&e.append("issuingAuthority",C),e.append("documentFile",S),await i.Gp(r.id,e)}else if(G)await i.f(r.id,G,{documentNumber:A,issuingCountry:E,issueDate:k,expiryDate:j,issuingAuthority:C});else{const e=new FormData;A&&e.append("documentNumber",A),k&&e.append("issueDate",k),j&&e.append("expiryDate",j),E&&e.append("issuingCountry",E),C&&e.append("issuingAuthority",C),await i.Gp(r.id,e)}z(u("identificationDocuments.form.updateSuccess"),"success")}else{if(S){const e=new FormData;e.append("documentType",f),e.append("documentNumber",A),e.append("issuingCountry",E),k&&e.append("issueDate",k),j&&e.append("expiryDate",j),C&&e.append("issuingAuthority",C),e.append("documentFile",S),await i.n4(t,e)}else if(G)await i.xv(t,G,{documentType:f,documentNumber:A,issuingCountry:E,issueDate:k,expiryDate:j,issuingAuthority:C});else{const e=new FormData;e.append("documentType",f),e.append("documentNumber",A),e.append("issuingCountry",E),k&&e.append("issueDate",k),j&&e.append("expiryDate",j),C&&e.append("issuingAuthority",C),await i.n4(t,e)}z(u("identificationDocuments.form.createSuccess"),"success")}l()}catch(o){var n,a;z(u("identificationDocuments.form.error",{error:(null===(n=o.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.error)||u("common.error")}),"error")}finally{R(!1)}}else z(u("identificationDocuments.form.fillRequiredFields"),"error")},className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{htmlFor:"documentType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("identificationDocuments.form.documentType")," ",(0,h.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,h.jsxs)("select",{id:"documentType",value:f,onChange:e=>w(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0,children:[(0,h.jsx)("option",{value:"",children:u("identificationDocuments.form.selectDocumentType")}),W.map((e=>(0,h.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{htmlFor:"documentNumber",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("identificationDocuments.form.documentNumber")," ",(0,h.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,h.jsx)("input",{type:"text",id:"documentNumber",value:A,onChange:e=>v(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{htmlFor:"issuingCountry",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("identificationDocuments.form.issuingCountry")," ",(0,h.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"*"})]}),(0,h.jsx)("input",{type:"text",id:"issuingCountry",value:E,onChange:e=>I(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"issuingAuthority",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("identificationDocuments.form.issuingAuthority")}),(0,h.jsx)("input",{type:"text",id:"issuingAuthority",value:C,onChange:e=>B(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"issueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("identificationDocuments.form.issueDate")}),(0,h.jsx)("input",{type:"date",id:"issueDate",value:k,onChange:e=>D(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"expiryDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("identificationDocuments.form.expiryDate")}),(0,h.jsx)("input",{type:"date",id:"expiryDate",value:j,onChange:e=>N(e.target.value),className:"mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:text-white"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("identificationDocuments.form.documentImage")}),(0,h.jsxs)("div",{className:"mt-1 flex items-center space-x-2",children:[(0,h.jsxs)("label",{className:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer",children:[(0,h.jsx)(b.A,{className:"h-5 w-5 mr-2 text-gray-500 dark:text-gray-400"}),u("identificationDocuments.form.uploadFile"),(0,h.jsx)("input",{type:"file",className:"sr-only",onChange:e=>{e.target.files&&e.target.files.length>0&&(U(e.target.files[0]),F(null))},accept:"image/*"})]}),s()&&(0,h.jsxs)("button",{type:"button",onClick:()=>T(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,h.jsx)(m,{className:"h-5 w-5 mr-2 text-gray-500 dark:text-gray-400"}),u("identificationDocuments.form.takePhoto")]}),(0,h.jsx)("button",{type:"button",onClick:async()=>{try{if(O(!0),V(null),!S&&!G)throw new Error(u("identificationDocuments.form.noDocumentUploaded"));let e=null;if(S?e=await new Promise(((e,t)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=t,r.readAsDataURL(S)})):G&&(e=G),!e)throw new Error(u("identificationDocuments.form.noImageData"));const t=await(async e=>{try{console.log("Starte KI-basierte Dokumentenerkennung..."),e.startsWith("data:image")||(e=e.startsWith("/9j/")?"data:image/jpeg;base64,"+e:e.startsWith("iVBOR")?"data:image/png;base64,"+e:"data:image/jpeg;base64,"+e);const t=localStorage.getItem("token");if(!t)throw new Error("Nicht authentifiziert. Bitte melden Sie sich an.");const r="".concat(y.H$,"/document-recognition");console.log("Verwende API-Endpunkt:",r);const n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},credentials:"include",mode:"cors",body:JSON.stringify({image:e,documentType:"id_card"})});if(!n.ok){const e=await n.text();throw new Error("API-Anfrage fehlgeschlagen: ".concat(n.status," ").concat(e))}const a=await n.json();return console.log("KI-Ergebnis:",a),a}catch(t){return console.error("Fehler bei der KI-basierten Dokumentenerkennung:",t),{}}})(e);console.log("Erkannte Daten:",t),t.documentType&&w(t.documentType),t.documentNumber&&v(t.documentNumber),t.issueDate&&D(t.issueDate),t.expiryDate&&N(t.expiryDate),t.issuingCountry&&I(t.issuingCountry),t.issuingAuthority&&B(t.issuingAuthority),z(u("identificationDocuments.form.recognitionSuccess"),"success")}catch(e){console.error("Fehler bei der automatischen Erkennung:",e),V(e.message),z(u("identificationDocuments.form.recognitionError",{error:e.message}),"error")}finally{O(!1)}},disabled:M||!S&&!G,className:"inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium ".concat(M||!S&&!G?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500 border-gray-300 dark:border-gray-700 cursor-not-allowed":"border-blue-300 dark:border-blue-700 text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50"),children:M?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.A,{className:"h-5 w-5 mr-2 animate-spin"}),u("identificationDocuments.form.recognitionRunning")]}):u("identificationDocuments.form.autoRecognize")})]}),S&&(0,h.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:u("identificationDocuments.form.selectedFile",{name:S.name})}),G&&(0,h.jsxs)("div",{className:"mt-2",children:[(0,h.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:u("identificationDocuments.form.capturedImage")}),(0,h.jsx)("img",{src:G,alt:u("identificationDocuments.form.capturedDocument"),className:"max-h-40 border dark:border-gray-700 rounded"})]}),L&&(0,h.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:u("identificationDocuments.form.recognitionErrorLabel",{error:L})})]}),(0,h.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,h.jsx)("button",{type:"button",onClick:d,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:u("common.cancel"),children:(0,h.jsx)(c.A,{className:"h-5 w-5"})}),(0,h.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:_,title:u(_?"common.saving":r?"identificationDocuments.form.update":"common.save"),children:_?(0,h.jsx)(g.A,{className:"h-5 w-5 animate-spin"}):(0,h.jsx)(p.A,{className:"h-5 w-5"})})]})]})}}}]);
//# sourceMappingURL=347.b49b464a.chunk.js.map