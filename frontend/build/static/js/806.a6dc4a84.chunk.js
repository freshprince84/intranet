"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[806],{2517:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const n=a.forwardRef(s)},3315:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const n=a.forwardRef(s)},4129:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const n=a.forwardRef(s)},5648:(e,r,t)=>{t.d(r,{o:()=>n});var a=t(4117),s=t(1859);const n=()=>{const{t:e,i18n:r}=(0,a.Bd)(),t=(0,s.D)();return{t:e,i18n:r,activeLanguage:t.activeLanguage,organizationLanguage:t.organizationLanguage,setUserLanguage:t.setUserLanguage,setOrganizationLanguage:t.setOrganizationLanguage,isLoading:t.isLoading}}},6238:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const n=a.forwardRef(s)},8010:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const n=a.forwardRef(s)},8662:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5043);function s(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const n=a.forwardRef(s)},9308:(e,r,t)=>{t.r(r),t.d(r,{default:()=>ne});var a=t(5043),s=t(4117),n=t(2760),l=t(7504),i=t(4129);function o(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"}))}const d=a.forwardRef(o);var c=t(6443),m=t(542),u=t(8662),g=t(6009),x=t(2704),b=t(7591),h=t(9422),y=t(7855),p=t(9e3),f=t(5657),k=t(579);const v=e=>{let{onError:r}=e;const{t:t}=(0,s.Bd)(),l=[{code:"CO",name:t("countries.CO")},{code:"CH",name:t("countries.CH")},{code:"DE",name:t("countries.DE")},{code:"AT",name:t("countries.AT")}],i=[{code:"CH",name:t("countries.CH")},{code:"CO",name:t("countries.CO")}],o=[{code:"es",name:t("languages.es")},{code:"de",name:t("languages.de")},{code:"en",name:t("languages.en")}],[v,w]=(0,a.useState)([]),[j,N]=(0,a.useState)(null),[A,S]=(0,a.useState)({}),[_,C]=(0,a.useState)(!1),[z,E]=(0,a.useState)([]),[R,L]=(0,a.useState)(!1),[B,I]=(0,a.useState)(null),{showMessage:F}=(0,y.A)(),{isAdmin:O}=(0,n.S)(),[T,D]=(0,a.useState)([]),[M,G]=(0,a.useState)(!1),[W,U]=(0,a.useState)("details"),[$,q]=(0,a.useState)(!1),[P,H]=(0,a.useState)(window.innerWidth<640),[V,Z]=(0,a.useState)(window.innerWidth>1070),{openSidepane:K,closeSidepane:J}=(0,f.N)(),[Y,Q]=(0,a.useState)({email:"",password:"",firstName:"",lastName:""});(0,a.useEffect)((()=>{const e=()=>{H(window.innerWidth<640),Z(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>($?K():J(),()=>{J()})),[$,K,J]),(0,a.useEffect)((()=>{X()}),[]);const X=async()=>{try{const e=await m.i$.getAll();w(e.data)}catch(e){re(e)}},ee=async e=>{try{if(!e||isNaN(e))return void N(null);console.log("Lade Benutzerdetails f\xfcr ID:",e);const r=await m.i$.getById(e),t={...r.data,birthday:r.data.birthday?new Date(r.data.birthday).toISOString().split("T")[0]:null};let a=[];r.data.roles&&Array.isArray(r.data.roles)?(console.log("Rollenstruktur (Typ):",typeof r.data.roles,"L\xe4nge:",r.data.roles.length),r.data.roles.length>0&&r.data.roles[0].role?(a=r.data.roles.map((e=>e.role.id)),console.log("Extrahierte Rollen-IDs aus verschachtelter Struktur:",a)):r.data.roles.length>0&&("number"===typeof r.data.roles[0]?a=r.data.roles:r.data.roles[0].roleId?a=r.data.roles.map((e=>e.roleId)):r.data.roles[0].id&&(a=r.data.roles.map((e=>e.id))))):console.warn("Rollen fehlen oder sind kein Array:",r.data.roles),0===a.length&&r.data.role&&(console.log("Versuche Rollen aus role-Eigenschaft zu extrahieren:",r.data.role),Array.isArray(r.data.role)?a=r.data.role.map((e=>e.id)):"object"===typeof r.data.role&&null!==r.data.role&&(a=[r.data.role.id])),console.log("Endg\xfcltige extrahierte Rollen-IDs:",a),N(t),S(t),E(a),0===T.length&&await(async()=>{try{G(!0);const r=[{id:1,name:"admin",description:"Administrator mit allen Rechten",permissions:[]},{id:2,name:"user",description:"Standardbenutzer",permissions:[]},{id:999,name:"hamburger",description:"Hamburger-Rolle f\xfcr neue Benutzer",permissions:[]}];try{const e=await m.Zj.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(D(e.data),console.log(`${e.data.length} Rollen erfolgreich geladen`)):(console.warn("Keine Rollen vom Server erhalten, verwende Fallback"),D(r))}catch(e){console.warn("Fehler beim Laden der Rollen, verwende Fallback:",e),D(r)}}finally{G(!1)}})()}catch(r){console.error("Fehler beim Laden der Benutzerdetails:",r),re(r)}},re=e=>{var t,a;let s="Ein Fehler ist aufgetreten";null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message?s=e.response.data.message:e instanceof Error&&(s=e.message),!s.includes("Ung\xfcltige Rollen-ID")||j?r(s):console.warn("Fehler unterdr\xfcckt, da kein Benutzer ausgew\xe4hlt ist:",s)},te=e=>{const{name:r,value:t,type:a}=e.target;let s=t;"number"===a&&(s=""===t?null:Number(t)),S({...A,[r]:s}),C(!0)},ae=async e=>{if(e&&j)if(1===e&&1===j.id&&z.includes(e))F("Die Admin-Rolle kann vom Admin-Benutzer nicht entfernt werden","warning");else try{console.log("Toggle Rolle:",e,"f\xfcr Benutzer:",j.id),console.log("Aktuelle ausgew\xe4hlte Rollen:",z);const r=z.includes(e),t=r?z.filter((r=>r!==e)):[...z,e];console.log("Neue ausgew\xe4hlte Rollen:",t),E(t),console.log("Sende Rollenaktualisierung an API:",{userId:j.id,roleIds:t});const a=await m.i$.updateRoles(j.id,t);console.log("API-Antwort bei Rollenaktualisierung:",a.data),await ee(j.id),F(r?"Rolle erfolgreich entfernt":"Rolle erfolgreich zugewiesen","success")}catch(r){console.error("Fehler beim Aktualisieren der Rollen:",r),ee(j.id),re(r),F("Fehler beim Aktualisieren der Rollen","error")}};(0,a.useEffect)((()=>{j&&(S({...j,birthday:j.birthday?new Date(j.birthday).toISOString().split("T")[0]:null}),C(!1))}),[j]);const se=e=>{const{name:r,value:t}=e.target;Q({...Y,[r]:t})},ne=async e=>{if(e.preventDefault(),Y.email&&Y.password&&Y.firstName&&Y.lastName)if(Y.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/))try{const e=await m.i$.create(Y);e.data&&w((r=>[e.data,...r])),F("Benutzer erfolgreich erstellt","success"),q(!1),Q({email:"",password:"",firstName:"",lastName:""})}catch(s){var t,a;X();const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Erstellen des Benutzers";F(e,"error"),r(e)}else F("Ung\xfcltiges E-Mail-Format","error");else F("Bitte f\xfcllen Sie alle Felder aus","error")};return(0,k.jsxs)("div",{className:"container mx-auto px-4 pb-6",children:[(0,k.jsx)("div",{className:"mb-6",children:(0,k.jsxs)("div",{className:"flex items-center gap-4",children:[(0,k.jsx)("div",{className:"flex items-center",children:O()&&(0,k.jsx)("button",{onClick:()=>q(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:t("users.create"),"aria-label":t("users.create"),children:(0,k.jsx)(u.A,{className:"h-4 w-4"})})}),(0,k.jsxs)("div",{className:"flex-1",children:[(0,k.jsx)("label",{htmlFor:"userSelect",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.title")}),(0,k.jsxs)("select",{id:"userSelect",onChange:e=>{const r=parseInt(e.target.value,10);r&&!isNaN(r)?ee(r):(N(null),S({}),E([]))},className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",children:[(0,k.jsxs)("option",{value:"",children:["-- ",t("users.title")," ",t("common.select")," --"]}),v.map((e=>(0,k.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.username,")"]},e.id)))]})]})]})}),j&&(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,k.jsxs)("h2",{className:"text-xl font-semibold dark:text-white",children:[t("users.title"),": ",j.firstName," ",j.lastName]})}),(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6",children:(0,k.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,k.jsxs)("nav",{className:"flex -mb-px",children:[(0,k.jsxs)("button",{onClick:()=>U("details"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm "+("details"===W?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,k.jsx)(g.A,{className:"h-5 w-5 inline mr-2"}),t("users.title")]}),(0,k.jsxs)("button",{onClick:()=>U("documents"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm "+("documents"===W?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,k.jsx)(x.A,{className:"h-5 w-5 inline mr-2"}),t("profile.documents")]}),(0,k.jsxs)("button",{onClick:()=>U("roles"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm "+("roles"===W?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,k.jsx)(d,{className:"h-5 w-5 inline mr-2"}),t("roles.title")]})]})})}),"details"===W&&(0,k.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!j||!j.id)return r("Kein Benutzer ausgew\xe4hlt"),void F("Kein Benutzer ausgew\xe4hlt","error");try{var t,a,s,n;if(null===(t=A.username)||void 0===t||!t.trim())throw new Error("Benutzername ist erforderlich");if(null===(a=A.email)||void 0===a||!a.trim())throw new Error("E-Mail ist erforderlich");if(null===(s=A.firstName)||void 0===s||!s.trim())throw new Error("Vorname ist erforderlich");if(null===(n=A.lastName)||void 0===n||!n.trim())throw new Error("Nachname ist erforderlich");const e={...A,salary:null===A.salary||void 0===A.salary||""===A.salary?null:"string"===typeof A.salary?parseFloat(A.salary):A.salary,normalWorkingHours:null===A.normalWorkingHours||void 0===A.normalWorkingHours||""===A.normalWorkingHours?7.6:"string"===typeof A.normalWorkingHours?parseFloat(A.normalWorkingHours):A.normalWorkingHours,hourlyRate:null===A.hourlyRate||void 0===A.hourlyRate||""===A.hourlyRate?null:"string"===typeof A.hourlyRate?A.hourlyRate:A.hourlyRate.toString(),monthlySalary:null===A.monthlySalary||void 0===A.monthlySalary||""===A.monthlySalary?null:"string"===typeof A.monthlySalary?parseFloat(A.monthlySalary):A.monthlySalary,birthday:A.birthday||null};console.log("Sende Daten zum Server:",e);const r=await m.i$.update(j.id,e);if(r.data){const e={...r.data,birthday:r.data.birthday?new Date(r.data.birthday).toISOString().split("T")[0]:null};N(e),S({...e,birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null}),w((r=>r.map((r=>r.id===e.id?e:r)))),F("Benutzerprofil erfolgreich aktualisiert","success"),C(!1)}}catch(c){var l,i;if(console.error("Fehler beim Speichern der Benutzerdaten:",c),X(),400===(null===(l=c.response)||void 0===l?void 0:l.status)){var o,d;const e=`Validierungsfehler: ${(null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.message)||"Bitte \xfcberpr\xfcfe die eingegebenen Daten"}`;r(e),F(e,"error")}else 404===(null===(i=c.response)||void 0===i?void 0:i.status)?(r("Benutzer wurde nicht gefunden"),F("Benutzer wurde nicht gefunden","error")):re(c)}},className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,k.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.username")}),(0,k.jsx)("input",{type:"text",name:"username",value:A.username||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.email")}),(0,k.jsx)("input",{type:"email",name:"email",value:A.email||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.firstName")}),(0,k.jsx)("input",{type:"text",name:"firstName",value:A.firstName||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.lastName")}),(0,k.jsx)("input",{type:"text",name:"lastName",value:A.lastName||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.birthday")}),(0,k.jsx)("input",{type:"date",name:"birthday",value:A.birthday||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.bankDetails")}),(0,k.jsx)("input",{type:"text",name:"bankDetails",value:A.bankDetails||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.contract")}),(0,k.jsx)("input",{type:"text",name:"contract",value:A.contract||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.salary")}),(0,k.jsx)("input",{type:"number",name:"salary",value:null===A.salary||void 0===A.salary?"":A.salary,onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.normalWorkingHours")}),(0,k.jsx)("input",{type:"number",step:"0.1",name:"normalWorkingHours",value:null===A.normalWorkingHours||void 0===A.normalWorkingHours?"7.6":A.normalWorkingHours,onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.country")}),(0,k.jsx)("select",{name:"country",value:A.country||"CO",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:l.map((e=>(0,k.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("profile.language")}),(0,k.jsx)("select",{name:"language",value:A.language||"es",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:o.map((e=>(0,k.jsx)("option",{value:e.code,children:e.name},e.code)))})]})]}),(0,k.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:t("users.form.payrollSettings")}),(0,k.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.payrollCountry")}),(0,k.jsx)("select",{name:"payrollCountry",value:A.payrollCountry||j.payrollCountry||"CH",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:i.map((e=>(0,k.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),("CO"===A.payrollCountry||"CO"===j.payrollCountry&&!A.payrollCountry)&&(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("users.form.contractType")}),(0,k.jsxs)("select",{name:"contractType",value:A.contractType||"",onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,k.jsx)("option",{value:"",children:"Bitte ausw\xe4hlen"}),CONTRACT_TYPES.map((e=>(0,k.jsx)("option",{value:e.code,children:e.name},e.code)))]})]})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("users.form.hourlyRate")," (","CH"===(A.payrollCountry||j.payrollCountry)?"CHF":"COP",")"]}),(0,k.jsx)("input",{type:"number",name:"hourlyRate",min:"0",step:"CH"===(A.payrollCountry||j.payrollCountry)?"0.05":"1",value:null===A.hourlyRate||void 0===A.hourlyRate?"":A.hourlyRate,onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"CH"===(A.payrollCountry||j.payrollCountry)?"z.B. 45.00":"z.B. 50000"})]}),("CO"===A.payrollCountry||"CO"===j.payrollCountry)&&"servicios_externos"!==A.contractType&&"servicios_externos"!==j.contractType&&(A.contractType||j.contractType)&&(0,k.jsxs)("div",{children:[(0,k.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("users.form.monthlySalary")," (COP)"]}),(0,k.jsx)("input",{type:"number",name:"monthlySalary",min:"0",step:"1000",value:null===A.monthlySalary||void 0===A.monthlySalary?"":A.monthlySalary,onChange:te,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 3500000"})]})]})]}),_&&(0,k.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,k.jsx)("button",{type:"button",onClick:()=>{j&&S({...j,birthday:j.birthday?new Date(j.birthday).toISOString().split("T")[0]:null}),C(!1)},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:t("common.cancel"),children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:t("common.save"),children:(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]}),"documents"===W&&(0,k.jsx)(p.A,{userId:j.id,isAdmin:!0}),"roles"===W&&(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:M?(0,k.jsxs)("div",{className:"mt-4 mb-4",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Rollenzuweisung"}),(0,k.jsx)("p",{className:"dark:text-gray-300",children:"Rollen werden geladen..."})]}):T.length>0&&(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Rollenzuweisung"}),z.some((e=>!T.some((r=>r.id===e))))&&(0,k.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,k.jsx)("p",{className:"font-bold",children:"Achtung: Unbekannte Rollen-IDs gefunden"}),(0,k.jsxs)("p",{children:["Einige Rollen-IDs des Benutzers (",z.filter((e=>!T.some((r=>r.id===e)))).join(", "),") sind in den verf\xfcgbaren Rollen nicht vorhanden."]}),(0,k.jsxs)("p",{className:"mt-2 text-sm",children:["Verf\xfcgbare Rollen-IDs: ",T.map((e=>e.id)).join(", ")]})]}),(0,k.jsxs)("div",{className:"mb-4",children:[(0,k.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Aktuelle Rollen"}),0===z.length?(0,k.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:"Keine Rollen zugewiesen"}):(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.filter((e=>z.includes(e.id))).map((e=>{const r=1===e.id&&j&&1===j.id;return(0,k.jsx)("div",{className:"border rounded-lg p-4 "+(r?"border-green-500 bg-green-50 dark:bg-green-900/20 dark:border-green-700 cursor-not-allowed":"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 cursor-pointer"),onClick:()=>!r&&ae(e.id),children:(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("h4",{className:"font-medium flex items-center dark:text-white",children:[e.name,r&&(0,k.jsx)("span",{className:"ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded-full",children:"Fix"})]}),(0,k.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,k.jsxs)("div",{className:"flex items-center "+(r?"text-gray-400 dark:text-gray-500":"text-blue-600 dark:text-blue-400"),children:[(0,k.jsx)("span",{className:"mr-2 text-sm",children:r?"Fest zugewiesen":"Entfernen"}),(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,k.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},e.id)})),z.filter((e=>!T.some((r=>r.id===e)))).map((e=>(0,k.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("h4",{className:"font-medium",children:["Unbekannte Rolle (ID: ",e,")"]}),(0,k.jsx)("p",{className:"text-sm text-orange-600",children:"Diese Rolle ist dem Benutzer zugewiesen, aber nicht in der Rollenliste vorhanden."})]}),(0,k.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,k.jsx)("span",{className:"mr-2 text-sm",children:"Entfernen"}),(0,k.jsx)("button",{onClick:()=>ae(e),className:"focus:outline-none",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,k.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},`unknown-${e}`)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Verf\xfcgbare Rollen"}),0===T.filter((e=>!z.includes(e.id))).length?(0,k.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:"Keine weiteren Rollen verf\xfcgbar"}):(0,k.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.filter((e=>!z.includes(e.id))).map((e=>(0,k.jsx)("div",{className:"border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50",onClick:()=>ae(e.id),children:(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{className:"font-medium",children:e.name}),(0,k.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,k.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600",children:[(0,k.jsx)("span",{className:"mr-2 text-sm",children:"Hinzuf\xfcgen"}),(0,k.jsx)(u.A,{className:"h-5 w-5"})]})]})},e.id)))})]})]})})]}),$&&(0,k.jsx)(k.Fragment,{children:P?(0,k.jsxs)(c.lG,{open:$,onClose:()=>q(!1),className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(c.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)(c.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Neuen Benutzer erstellen"}),(0,k.jsx)("button",{onClick:()=>q(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]})}),(0,k.jsxs)("form",{onSubmit:ne,className:"p-6",children:[(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"E-Mail *"}),(0,k.jsx)("input",{type:"email",name:"email",value:Y.email,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort *"}),(0,k.jsx)("input",{type:"password",name:"password",value:Y.password,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorname *"}),(0,k.jsx)("input",{type:"text",name:"firstName",value:Y.firstName,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachname *"}),(0,k.jsx)("input",{type:"text",name:"lastName",value:Y.lastName,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,k.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,k.jsx)("button",{type:"button",onClick:()=>q(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:"Erstellen",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[$&&!V&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:$?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+($?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:$?"auto":"none"},"aria-hidden":!$,role:"dialog","aria-modal":$,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neuen Benutzer erstellen"}),(0,k.jsx)("button",{onClick:()=>q(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsx)("div",{className:"flex flex-col flex-1 min-h-0",children:(0,k.jsxs)("form",{onSubmit:ne,className:"flex flex-col flex-1 min-h-0",children:[(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0 space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"E-Mail *"}),(0,k.jsx)("input",{type:"email",name:"email",value:Y.email,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort *"}),(0,k.jsx)("input",{type:"password",name:"password",value:Y.password,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorname *"}),(0,k.jsx)("input",{type:"text",name:"firstName",value:Y.firstName,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachname *"}),(0,k.jsx)("input",{type:"text",name:"lastName",value:Y.lastName,onChange:se,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,k.jsxs)("div",{className:"flex justify-end gap-3 border-t dark:border-gray-700 pt-4 px-4 flex-shrink-0",children:[(0,k.jsx)("button",{type:"button",onClick:()=>q(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:"Erstellen",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})})]})]})})]})};var w=t(2811),j=t(9248),N=t(8010),A=t(1801),S=t(1923),_=t(4426),C=t(7829),z=t(6507),E=t(5365);const R=["dashboard","worktracker","cerebro","settings","profile"],L=["dashboard","worktracker","consultations","team_worktime_control","payroll","usermanagement","cerebro","settings","profile"],B=["requests","tasks","users","roles","team_worktime","worktime","clients","consultation_invoices","branches","notifications","settings","monthly_reports"],I=["database_reset_table","database_logs","invoice_create","invoice_download","invoice_mark_paid","invoice_settings","todo_create","todo_edit","todo_delete","task_create","task_edit","task_delete","user_create","user_edit","user_delete","role_assign","role_create","role_edit","role_delete","worktime_start","worktime_stop","worktime_edit","worktime_delete","cerebro","consultation_start","consultation_stop","consultation_edit","client_create","client_edit","client_delete","settings_system","settings_notifications","settings_profile","payroll_generate","payroll_export","payroll_edit"],F={requests:"dashboard",tasks:"worktracker",users:"usermanagement",roles:"usermanagement",team_worktime:"team_worktime_control",worktime:"worktracker",clients:"consultations",consultation_invoices:"consultations",branches:"settings",notifications:"general",settings:"settings",monthly_reports:"consultations"},O={database_reset_table:"settings",database_logs:"settings",invoice_create:"consultations",invoice_download:"consultations",invoice_mark_paid:"consultations",invoice_settings:"consultations",todo_create:"worktracker",todo_edit:"worktracker",todo_delete:"worktracker",task_create:"worktracker",task_edit:"worktracker",task_delete:"worktracker",user_create:"usermanagement",user_edit:"usermanagement",user_delete:"usermanagement",role_assign:"usermanagement",role_create:"usermanagement",role_edit:"usermanagement",role_delete:"usermanagement",worktime_start:"worktracker",worktime_stop:"worktracker",worktime_edit:"worktracker",worktime_delete:"worktracker",cerebro:"cerebro",consultation_start:"consultations",consultation_stop:"consultations",consultation_edit:"consultations",client_create:"consultations",client_edit:"consultations",client_delete:"consultations",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",payroll_generate:"payroll",payroll_export:"payroll",payroll_edit:"payroll"},T={worktime_start:"worktime",worktime_stop:"worktime",worktime_edit:"worktime",worktime_delete:"worktime",task_create:"tasks",task_edit:"tasks",task_delete:"tasks",todo_create:"tasks",todo_edit:"tasks",todo_delete:"tasks",client_create:"clients",client_edit:"clients",client_delete:"clients",consultation_start:"clients",consultation_stop:"clients",consultation_edit:"clients",invoice_create:"consultation_invoices",invoice_download:"consultation_invoices",invoice_mark_paid:"consultation_invoices",invoice_settings:"consultation_invoices",user_create:"users",user_edit:"users",user_delete:"users",role_assign:"roles",role_create:"roles",role_edit:"roles",role_delete:"roles",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",database_reset_table:null,database_logs:null,cerebro:null,payroll_generate:null,payroll_export:null,payroll_edit:null},D="roles-table",M=e=>{let{role:r,onEdit:t,onDelete:a,canEdit:n,canDelete:l}=e;const{t:i}=(0,s.Bd)();return(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:[(0,k.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:r.name}),(0,k.jsxs)("div",{className:"flex space-x-2",children:[n&&(0,k.jsx)("button",{onClick:()=>t(r),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:i("roles.actions.edit"),children:(0,k.jsx)(w.A,{className:"h-5 w-5"})}),l&&(0,k.jsx)("button",{onClick:()=>a(r.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",title:i("roles.actions.delete"),children:(0,k.jsx)(j.A,{className:"h-5 w-5"})})]})]}),(0,k.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.description||i("roles.noDescription")}),(0,k.jsxs)("div",{className:"mt-2",children:[(0,k.jsxs)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:[i("roles.permissions"),":"]}),(0,k.jsxs)("div",{className:"flex flex-wrap gap-1",children:[r.permissions.filter((e=>"none"!==e.accessLevel)).slice(0,8).map((e=>(0,k.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:[e.entity,": ",e.accessLevel]},`${e.entity}-${e.entityType}`))),r.permissions.filter((e=>"none"!==e.accessLevel)).length>8&&(0,k.jsxs)("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:["+",r.permissions.filter((e=>"none"!==e.accessLevel)).length-8," ",i("common.showMore")]})]})]})]})},G=e=>{let{onRolesChange:r,onError:t,readOnly:l=!1}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)(!1),[g,x]=(0,a.useState)(null),[y,p]=(0,a.useState)([]),[v,w]=(0,a.useState)(!0),j=(0,a.useMemo)((()=>({dashboard:i("roles.pages.dashboard"),worktracker:i("roles.pages.worktracker"),consultations:i("roles.pages.consultations"),team_worktime_control:i("roles.pages.team_worktime_control"),payroll:i("roles.pages.payroll"),usermanagement:i("roles.pages.usermanagement"),cerebro:i("roles.pages.cerebro"),settings:i("roles.pages.settings"),profile:i("roles.pages.profile")})),[i]),G=(0,a.useMemo)((()=>({tasks:i("roles.tables.tasks"),worktime:i("roles.tables.worktime"),users:i("roles.tables.users"),roles:i("roles.tables.roles"),clients:i("roles.tables.clients"),consultation_invoices:i("roles.tables.consultation_invoices"),requests:i("roles.tables.requests"),team_worktime:i("roles.tables.team_worktime"),settings:i("roles.tables.settings"),notifications:i("roles.tables.notifications"),branches:i("roles.tables.branches"),monthly_reports:i("roles.tables.monthly_reports")})),[i]),W=(0,a.useMemo)((()=>({worktime_start:i("roles.buttons.worktime_start"),worktime_stop:i("roles.buttons.worktime_stop"),worktime_edit:i("roles.buttons.worktime_edit"),worktime_delete:i("roles.buttons.worktime_delete"),task_create:i("roles.buttons.task_create"),task_edit:i("roles.buttons.task_edit"),task_delete:i("roles.buttons.task_delete"),todo_create:i("roles.buttons.todo_create"),todo_edit:i("roles.buttons.todo_edit"),todo_delete:i("roles.buttons.todo_delete"),client_create:i("roles.buttons.client_create"),client_edit:i("roles.buttons.client_edit"),client_delete:i("roles.buttons.client_delete"),consultation_start:i("roles.buttons.consultation_start"),consultation_stop:i("roles.buttons.consultation_stop"),consultation_edit:i("roles.buttons.consultation_edit"),invoice_create:i("roles.buttons.invoice_create"),invoice_download:i("roles.buttons.invoice_download"),invoice_mark_paid:i("roles.buttons.invoice_mark_paid"),invoice_settings:i("roles.buttons.invoice_settings"),user_create:i("roles.buttons.user_create"),user_edit:i("roles.buttons.user_edit"),user_delete:i("roles.buttons.user_delete"),role_assign:i("roles.buttons.role_assign"),role_create:i("roles.buttons.role_create"),role_edit:i("roles.buttons.role_edit"),role_delete:i("roles.buttons.role_delete"),settings_system:i("roles.buttons.settings_system"),settings_notifications:i("roles.buttons.settings_notifications"),settings_profile:i("roles.buttons.settings_profile"),database_reset_table:i("roles.buttons.database_reset_table"),database_logs:i("roles.buttons.database_logs"),payroll_generate:i("roles.buttons.payroll_generate"),payroll_export:i("roles.buttons.payroll_export"),payroll_edit:i("roles.buttons.payroll_edit"),cerebro:i("roles.buttons.cerebro")})),[i]),[U,$]=(0,a.useState)({name:"",description:"",permissions:[...L.map((e=>({entity:e,entityType:"page",accessLevel:"none"}))),...B.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...I.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]}),[q,P]=(0,a.useState)(null),{hasPermission:H}=(0,n.S)(),[V,Z]=(0,a.useState)(""),[K,J]=(0,a.useState)(!1),[Y,Q]=(0,a.useState)([]),[X,ee]=(0,a.useState)([]),[re,te]=(0,a.useState)("Alle"),[ae,se]=(0,a.useState)(null),[ne,le]=(0,a.useState)(window.innerWidth<640),[ie,oe]=(0,a.useState)(window.innerWidth>1070),{openSidepane:de,closeSidepane:ce}=(0,f.N)(),{handleError:me,handleValidationError:ue}=(0,z.qz)(),[ge,xe]=(0,a.useState)(!1),[be,he]=(0,a.useState)(null),[ye,pe]=(0,a.useState)(10);(0,a.useEffect)((()=>{const e=()=>{le(window.innerWidth<640),oe(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(o?de():ce(),()=>{ce()})),[o,de,ce]);const fe=(0,a.useCallback)((async()=>{w(!0),console.log("DEBUGAUSGABE: Hole Rollen vom Server...");try{const e=await m.Zj.getAll();console.log("DEBUGAUSGABE: Rollen erfolgreich geholt:",e.data),p(e.data),P(null)}catch(q){console.error("DEBUGAUSGABE: Fehler beim Abrufen der Rollen:",q),me(q,{component:"RoleManagementTab",action:"fetchRoles"}),t&&t("Fehler beim Laden der Rollen")}finally{w(!1)}}),[me,t]);(0,a.useEffect)((()=>{fe()}),[fe]);const ke=async e=>{if(e.preventDefault(),P(null),U.name){if(g){const e=U.permissions.map((e=>"page"===e.entityType&&R.includes(e.entity)?{...e,accessLevel:"both"}:e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));if(!g.id||isNaN(g.id))return console.warn("DEBUGAUSGABE: Ung\xfcltige Rollen-ID erkannt, Bearbeitung abgebrochen"),void me("Ung\xfcltige Rollen-ID, Bearbeitung abgebrochen",{component:"RoleManagementTab",roleId:g.id});if(1===g.id||2===g.id||999===g.id)return console.warn(`DEBUGAUSGABE: Versuch, gesch\xfctzte Rolle mit ID ${g.id} zu bearbeiten`),me({message:"Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",name:"PermissionError"},{component:"RoleManagementTab",roleId:g.id,category:E.h.PERMISSION}),void d(!1);if(!y.some((e=>e.id===g.id)))return console.error(`DEBUGAUSGABE: Rolle mit ID ${g.id} existiert nicht in der aktuellen Liste`),me(`Rolle mit ID ${g.id} existiert nicht mehr. Bitte aktualisieren Sie die Seite.`,{component:"RoleManagementTab",roleId:g.id}),d(!1),void await fe();console.log(`DEBUGAUSGABE: Bearbeite Rolle mit ID ${g.id}`);try{console.log("DEBUGAUSGABE: Sende Aktualisierung an API:",{name:U.name,description:U.description,permissions:e});const r={name:U.name,description:U.description,permissions:e};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.update");const t=await m.Zj.update(g.id,r);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.update"),console.log("DEBUGAUSGABE: API-Antwort bei Rollenaktualisierung:",t),await fe()}catch(t){return console.error("DEBUGAUSGABE: Fehler bei Rollenaktualisierung:",t),void(t.response?t.response.data.meta&&"Record to update not found."===t.response.data.meta.cause?(me("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:g.id}),d(!1),await fe()):me(t.response.data.message||"Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:g.id}):me("Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:g.id}))}}else try{const e=U.permissions.map((e=>"page"===e.entityType&&R.includes(e.entity)?{...e,accessLevel:"both"}:e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));console.log("DEBUGAUSGABE: Sende Daten an API f\xfcr neue Rolle:",{name:U.name,description:U.description,permissions:e});const r={name:U.name,description:U.description,permissions:e};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.create");const t=await m.Zj.create(r);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.create"),console.log("DEBUGAUSGABE: API-Antwort beim Erstellen der Rolle:",t),await fe()}catch(a){return console.error("DEBUGAUSGABE: Fehler bei API-Anfrage zum Erstellen der Rolle:",a),void(a.response?me(a.response.data.message||"Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}):me("Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}))}r&&r(),d(!1),je()}else ue("Rollenname darf nicht leer sein",{name:"Rollenname ist erforderlich"})},ve=async e=>{if(!e||isNaN(e))return console.warn("Ung\xfcltige Rollen-ID erkannt, L\xf6schvorgang abgebrochen"),void me("Ung\xfcltige Rollen-ID, L\xf6schvorgang abgebrochen",{component:"RoleManagementTab",roleId:e});if(1===e||2===e||999===e)return console.warn(`Versuch, gesch\xfctzte Rolle mit ID ${e} zu l\xf6schen`),void me("Gesch\xfctzte Systemrollen k\xf6nnen nicht gel\xf6scht werden",{component:"RoleManagementTab",roleId:e});if(window.confirm("M\xf6chten Sie diese Rolle wirklich l\xf6schen?"))try{console.log(`Starte L\xf6schvorgang f\xfcr Rolle mit ID ${e}`);if(!y.some((r=>r.id===e)))return console.error(`Rolle mit ID ${e} existiert nicht in der aktuellen Liste`),me(`Rolle mit ID ${e} existiert nicht mehr. Bitte aktualisieren Sie die Seite.`,{component:"RoleManagementTab",roleId:e}),void await fe();console.log("Sende L\xf6schanfrage an API");try{const r=await m.Zj.delete(e);console.log("API-Antwort beim L\xf6schen der Rolle:",r),await fe(),console.log("Rollenliste nach L\xf6schen aktualisiert")}catch(t){return console.error("API-Fehler beim L\xf6schen der Rolle:",t),void(t.response?(console.error("API-Fehlerdaten:",t.response.data),t.response.data.meta&&"Record to delete does not exist."===t.response.data.meta.cause?(me("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:e}),await fe()):me(t.response.data.message||"Fehler beim L\xf6schen der Rolle",{component:"RoleManagementTab",roleId:e})):me("Netzwerkfehler beim L\xf6schen der Rolle",{component:"RoleManagementTab",roleId:e}))}console.log("Rolle erfolgreich gel\xf6scht"),r&&r()}catch(a){console.error("Unbehandelter Fehler beim L\xf6schen der Rolle:",a),me(a);try{await fe()}catch(s){console.error("Fehler beim Aktualisieren der Rollenliste nach fehlgeschlagenem L\xf6schvorgang:",s)}}},we=e=>{if(1===e.id||2===e.id||999===e.id)return void me("Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",{component:"RoleManagementTab",roleId:e.id});const r=[...L.map((e=>({entity:e,entityType:"page",accessLevel:R.includes(e)?"both":"none"}))),...B.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...I.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))];e.permissions.forEach((e=>{const t=r.findIndex((r=>r.entity===e.entity&&r.entityType===e.entityType));-1!==t&&("page"===e.entityType&&R.includes(e.entity)?r[t].accessLevel="both":r[t].accessLevel=e.accessLevel)})),$({name:e.name,description:e.description||"",permissions:r}),x(e),d(!0)},je=()=>{x(null),$({name:"",description:"",permissions:[...L.map((e=>({entity:e,entityType:"page",accessLevel:R.includes(e)?"both":"none"}))),...B.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...I.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]})},Ne=e=>{const r=[...U.permissions];U.permissions.filter((e=>"page"===e.entityType&&!R.includes(e.entity))).forEach((t=>{const a=U.permissions.indexOf(t);r[a]={...t,accessLevel:e}})),$({...U,permissions:r})},Ae=e=>{const r=[...U.permissions];U.permissions.filter((e=>"table"===e.entityType)).forEach((t=>{const a=U.permissions.indexOf(t);r[a]={...t,accessLevel:e}})),$({...U,permissions:r})},Se=e=>{const r=[...U.permissions];U.permissions.filter((e=>"button"===e.entityType)).forEach((t=>{const a=U.permissions.indexOf(t);r[a]={...t,accessLevel:e}})),$({...U,permissions:r})},_e=()=>Y.length,Ce=(0,a.useMemo)((()=>y.filter((e=>{if(V){const r=V.toLowerCase();if(!(e.name.toLowerCase().includes(r)||e.description&&e.description.toLowerCase().includes(r)))return!1}if(Y.length>0){let r=Y.length>0;for(let t=0;t<Y.length;t++){const a=Y[t];let s=!1;switch(a.column){case"name":"equals"===a.operator?s=e.name.toLowerCase()===(a.value||"").toLowerCase():"contains"===a.operator?s=e.name.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator&&(s=e.name.toLowerCase().startsWith((a.value||"").toLowerCase()));break;case"description":if(!e.description){s=!1;break}"equals"===a.operator?s=e.description.toLowerCase()===(a.value||"").toLowerCase():"contains"===a.operator?s=e.description.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator&&(s=e.description.toLowerCase().startsWith((a.value||"").toLowerCase()));break;case"permissions":const r=a.value,t=e.permissions.filter((e=>e.accessLevel===r)).length;("greaterThan"===a.operator||"equals"===a.operator)&&(s=t>0)}if(0===t)r=s;else{r="AND"===X[t-1]?r&&s:r||s}}if(!r)return!1}return!0})).sort(((e,r)=>e.name.localeCompare(r.name)))),[y,V,Y,X]);(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await S.A.get(A.Sn.SAVED_FILTERS.BY_TABLE(D))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:D,name:"Alle",conditions:[],operators:[]};await S.A.post(A.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Rollen erstellt")}}catch(q){console.error("Fehler beim Erstellen der Standard-Filter:",q)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await S.A.get(A.Sn.SAVED_FILTERS.BY_TABLE(D)),r=e.data.find((e=>"Alle"===e.name));r&&(te("Alle"),se(r.id),ze(r.conditions,r.operators))}catch(q){console.error("Fehler beim Setzen des initialen Filters:",q)}})()}),[]);const ze=(e,r)=>{Q(e),ee(r)},Ee=()=>{Q([]),ee([]),te(""),se(null)};return(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,k.jsx)("div",{className:"flex items-center",children:!l&&H("roles","write","table")&&(0,k.jsx)("button",{onClick:()=>d(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:"Neue Rolle erstellen","aria-label":"Neue Rolle erstellen",children:(0,k.jsx)(u.A,{className:"h-4 w-4"})})}),(0,k.jsx)("div",{}),(0,k.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,k.jsx)("input",{type:"text",placeholder:"Suchen...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:V,onChange:e=>Z(e.target.value)}),(0,k.jsxs)("button",{className:`p-2 rounded-md ${_e()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"} ml-1 relative`,onClick:()=>J(!K),title:"Filter",children:[(0,k.jsx)(N.A,{className:"w-5 h-5"}),_e()>0&&(0,k.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:_e()})]})]})]}),K&&(0,k.jsx)(_.A,{columns:[{id:"name",label:"Name"},{id:"description",label:"Beschreibung"},{id:"permissions",label:"Berechtigungen"}],onApply:ze,onReset:Ee,savedConditions:Y,savedOperators:X,tableId:D}),(0,k.jsx)(C.A,{tableId:D,onSelectFilter:ze,onReset:Ee,activeFilterName:re,selectedFilterId:ae,onFilterChange:(e,r,t,a)=>{te(e),se(r),ze(t,a)},defaultFilterName:"Alle"}),v?(0,k.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,k.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===y.length?(0,k.jsx)("div",{className:"p-4 bg-gray-50 rounded text-center",children:(0,k.jsx)("p",{children:"Keine Rollen gefunden. Erstellen Sie eine neue Rolle mit dem Button oben."})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"space-y-4",children:Ce.slice(0,ye).map((e=>(0,k.jsx)(M,{role:e,onEdit:we,onDelete:ve,canEdit:!l&&H("roles","write","table")&&1!==e.id&&2!==e.id&&999!==e.id,canDelete:!l&&H("roles","write","table")&&1!==e.id&&2!==e.id&&999!==e.id},e.id)))}),Ce.length>ye&&(0,k.jsx)("div",{className:"mt-4 flex justify-center",children:(0,k.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>pe((e=>e+10)),children:["Mehr anzeigen (",Ce.length-ye," verbleibend)"]})})]})]}),o&&(0,k.jsx)(k.Fragment,{children:ne?(0,k.jsxs)(c.lG,{open:o,onClose:()=>d(!1),className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(c.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,k.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)(c.lG.Title,{className:"text-lg font-semibold dark:text-white",children:g?"Rolle bearbeiten":"Neue Rolle erstellen"}),(0,k.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]})}),(0,k.jsxs)("form",{onSubmit:ke,className:"flex flex-col flex-1 min-h-0",children:[(0,k.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,k.jsxs)("div",{className:"p-6 space-y-5",children:[(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,k.jsx)("input",{type:"text",value:U.name,onChange:e=>$({...U,name:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Beschreibung"}),(0,k.jsx)("input",{type:"text",value:U.description,onChange:e=>$({...U,description:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,k.jsxs)("div",{className:"mt-2",children:[(0,k.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Detaillierte Berechtigungen"}),(0,k.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,k.jsx)("button",{type:"button",onClick:()=>Ne("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",title:"Alle Seiten aktivieren",children:"Seiten \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ne("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Seiten deaktivieren",children:"Seiten \u2717"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ae("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",title:"Alle Tabellen aktivieren",children:"Tabellen \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ae("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Tabellen deaktivieren",children:"Tabellen \u2717"}),(0,k.jsx)("button",{type:"button",onClick:()=>Se("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",title:"Alle Buttons aktivieren",children:"Buttons \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Se("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Buttons deaktivieren",children:"Buttons \u2717"})]})]}),(0,k.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600",children:U.permissions.filter((e=>"page"===e.entityType)).map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel;return(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:j[e.entity]||e.entity}),(0,k.jsxs)("label",{className:"inline-flex items-center "+(R.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,disabled:R.includes(e.entity),onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:`relative w-11 h-6 ${R.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"} peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700`,children:R.includes(e.entity)&&(0,k.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),U.permissions.filter((r=>"table"===r.entityType&&F[r.entity]===e.entity)).sort(((e,r)=>{const t=G[e.entity]||e.entity,a=G[r.entity]||r.entity;return t.localeCompare(a)})).map(((r,t)=>{const a=U.permissions.indexOf(r),s="both"===r.accessLevel,n=r.entity,l=G[n]||n,i=U.permissions.filter((r=>"button"===r.entityType&&O[r.entity]===e.entity&&T[r.entity]===n&&!("tasks"===n&&r.entity.startsWith("todo_")))).sort(((e,r)=>{const t=W[e.entity]||e.entity,a=W[r.entity]||r.entity,s=["Start","Stop","Erstellen","Bearbeiten","L\xf6schen"],n=s.indexOf(t),l=s.indexOf(a);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:t.localeCompare(a)}));return(0,k.jsxs)("div",{className:"mt-3",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,k.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...U.permissions];e[a]={...r,accessLevel:s?"none":"both"},$({...U,permissions:e})}}),(0,k.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),i.map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel,s=W[e.entity]||e.entity;return(0,k.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},`button-permission-${e.entity}-${r}`)}))]},`table-permission-${n}-${t}`)})),U.permissions.filter((r=>"button"===r.entityType&&O[r.entity]===e.entity&&!T[r.entity])).sort(((e,r)=>{const t=W[e.entity]||e.entity,a=W[r.entity]||r.entity;return t.localeCompare(a)})).map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel,s=W[e.entity]||e.entity;return(0,k.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},`button-permission-${e.entity}-${r}`)}))]},`permission-page-${e.entity}-${r}`)}))})]})]})}),(0,k.jsxs)("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-end gap-2 border-t dark:border-gray-600 flex-shrink-0",children:[(0,k.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800",title:g?"Aktualisieren":"Erstellen",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[o&&!ie&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:o?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(o?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:o?"auto":"none"},"aria-hidden":!o,role:"dialog","aria-modal":o,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:g?"Rolle bearbeiten":"Neue Rolle erstellen"}),(0,k.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,k.jsxs)("form",{onSubmit:ke,className:"space-y-5",children:[(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,k.jsx)("input",{type:"text",value:U.name,onChange:e=>$({...U,name:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Beschreibung"}),(0,k.jsx)("input",{type:"text",value:U.description,onChange:e=>$({...U,description:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,k.jsxs)("div",{className:"mt-2",children:[(0,k.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Detaillierte Berechtigungen"}),(0,k.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,k.jsx)("button",{type:"button",onClick:()=>Ne("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",title:"Alle Seiten aktivieren",children:"Seiten \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ne("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Seiten deaktivieren",children:"Seiten \u2717"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ae("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",title:"Alle Tabellen aktivieren",children:"Tabellen \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Ae("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Tabellen deaktivieren",children:"Tabellen \u2717"}),(0,k.jsx)("button",{type:"button",onClick:()=>Se("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",title:"Alle Buttons aktivieren",children:"Buttons \u2713"}),(0,k.jsx)("button",{type:"button",onClick:()=>Se("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Buttons deaktivieren",children:"Buttons \u2717"})]})]}),(0,k.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600 max-h-[60vh]",children:U.permissions.filter((e=>"page"===e.entityType)).map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel;return(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:j[e.entity]||e.entity}),(0,k.jsxs)("label",{className:"inline-flex items-center "+(R.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,disabled:R.includes(e.entity),onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:`relative w-11 h-6 ${R.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"} peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700`,children:R.includes(e.entity)&&(0,k.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),U.permissions.filter((r=>"table"===r.entityType&&F[r.entity]===e.entity)).sort(((e,r)=>{const t=G[e.entity]||e.entity,a=G[r.entity]||r.entity;return t.localeCompare(a)})).map(((r,t)=>{const a=U.permissions.indexOf(r),s="both"===r.accessLevel,n=r.entity,l=G[n]||n,i=U.permissions.filter((r=>"button"===r.entityType&&O[r.entity]===e.entity&&T[r.entity]===n&&!("tasks"===n&&r.entity.startsWith("todo_")))).sort(((e,r)=>{const t=W[e.entity]||e.entity,a=W[r.entity]||r.entity,s=["Start","Stop","Erstellen","Bearbeiten","L\xf6schen"],n=s.indexOf(t),l=s.indexOf(a);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:t.localeCompare(a)}));return(0,k.jsxs)("div",{className:"mt-3",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,k.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...U.permissions];e[a]={...r,accessLevel:s?"none":"both"},$({...U,permissions:e})}}),(0,k.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),i.map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel,s=W[e.entity]||e.entity;return(0,k.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},`button-permission-desktop-${e.entity}-${r}`)}))]},`table-permission-desktop-${n}-${t}`)})),U.permissions.filter((r=>"button"===r.entityType&&O[r.entity]===e.entity&&!T[r.entity])).sort(((e,r)=>{const t=W[e.entity]||e.entity,a=W[r.entity]||r.entity;return t.localeCompare(a)})).map(((e,r)=>{const t=U.permissions.indexOf(e),a="both"===e.accessLevel,s=W[e.entity]||e.entity;return(0,k.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,k.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,k.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const r=[...U.permissions];r[t]={...e,accessLevel:a?"none":"both"},$({...U,permissions:r})}}),(0,k.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},`button-permission-desktop-${e.entity}-${r}`)}))]},`permission-page-desktop-${e.entity}-${r}`)}))})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:g?"Aktualisieren":"Erstellen",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})})]})]})})]})};var W=t(6238);function U(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const $=a.forwardRef(U);var q=t(1816);function P(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"}))}const H=a.forwardRef(P);var V=t(3315),Z=t(8673),K=t(5648);const J=e=>{let{isOpen:r,onClose:t,onSuccess:s}=e;const[n,l]=(0,a.useState)({name:"",displayName:"",domain:""}),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)({}),[u,g]=(0,a.useState)(window.innerWidth<640),[x,p]=(0,a.useState)(window.innerWidth>1070),{openSidepane:v,closeSidepane:w}=(0,f.N)(),{showMessage:j}=(0,y.A)();(0,a.useEffect)((()=>{const e=()=>{g(window.innerWidth<640),p(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(r?v():w(),()=>{w()})),[r,v,w]);const N=e=>{const{name:r,value:t}=e.target;l((e=>({...e,[r]:t}))),d[r]&&m((e=>({...e,[r]:""})))},A=async e=>{if(e.preventDefault(),(()=>{const e={};return n.name.trim()||(e.name="Name ist erforderlich"),n.displayName.trim()||(e.displayName="Anzeigename ist erforderlich"),m(e),0===Object.keys(e).length})())try{o(!0),await Z.h.createOrganization(n),m({}),j("Organisation erfolgreich erstellt","success"),l({name:"",displayName:"",domain:""}),t(),s&&s()}catch(i){var r,a;const e=(null===(r=i.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Fehler beim Erstellen der Organisation";j(e,"error"),m({submit:e})}finally{o(!1)}else j("Bitte f\xfcllen Sie alle erforderlichen Felder aus","error")},S=()=>{l({name:"",displayName:"",domain:""}),m({}),t()};return u?(0,k.jsxs)(c.lG,{open:r,onClose:S,className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(c.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,k.jsx)(c.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Neue Organisation erstellen"}),(0,k.jsx)("button",{onClick:S,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("form",{onSubmit:A,className:"p-4",children:[d.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:d.submit}),(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),(0,k.jsx)("input",{type:"text",id:"name",name:"name",value:n.name,onChange:N,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(d.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),d.name&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.name})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzeigename *"}),(0,k.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:n.displayName,onChange:N,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(d.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),d.displayName&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.displayName})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Domain"}),(0,k.jsx)("input",{type:"text",id:"domain",name:"domain",value:n.domain,onChange:N,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:S,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i?"Erstelle...":"Erstellen",children:i?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[r&&!x&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:S,style:{opacity:r?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(r?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:r?"auto":"none"},"aria-hidden":!r,role:"dialog","aria-modal":r,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neue Organisation erstellen"}),(0,k.jsx)("button",{onClick:S,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[d.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:d.submit}),(0,k.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),(0,k.jsx)("input",{type:"text",id:"name",name:"name",value:n.name,onChange:N,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(d.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),d.name&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.name})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzeigename *"}),(0,k.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:n.displayName,onChange:N,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(d.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),d.displayName&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.displayName})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Domain"}),(0,k.jsx)("input",{type:"text",id:"domain",name:"domain",value:n.domain,onChange:N,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:S,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i?"Erstelle...":"Erstellen",children:i?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})]})]})},Y=e=>{let{isOpen:r,onClose:t,onSuccess:s}=e;const[n,l]=(0,a.useState)({organizationName:"",message:""}),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)({}),[x,p]=(0,a.useState)(window.innerWidth<640),[v,w]=(0,a.useState)(window.innerWidth>1070),{openSidepane:j,closeSidepane:N}=(0,f.N)(),[A,S]=(0,a.useState)([]),[_,C]=(0,a.useState)(!1),[z,E]=(0,a.useState)(null),R=(0,a.useRef)(null),L=(0,a.useRef)(null),{showMessage:B}=(0,y.A)();(0,a.useEffect)((()=>{const e=()=>{p(window.innerWidth<640),w(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(r?j():N(),()=>{N()})),[r,j,N]),(0,a.useEffect)((()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&C(!1)};return _&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[_]);const I=e=>{const r=e.target.value;l((e=>({...e,organizationName:r}))),E(null),u.organizationName&&g((e=>({...e,organizationName:""}))),R.current&&clearTimeout(R.current),R.current=setTimeout((()=>{(async e=>{if(e.length<2)return S([]),void C(!1);try{m(!0);const r=await Z.h.searchOrganizations(e);S(r),C(!0)}catch(r){console.error("Fehler bei der Organisationen-Suche:",r),S([])}finally{m(!1)}})(r)}),300)},F=e=>{E(e),l((r=>({...r,organizationName:e.name}))),C(!1),S([])},O=e=>{l((r=>({...r,message:e.target.value}))),u.message&&g((e=>({...e,message:""})))},T=async e=>{if(e.preventDefault(),(()=>{const e={};return n.organizationName.trim()?z||(e.organizationName="Bitte w\xe4hlen Sie eine Organisation aus der Liste aus"):e.organizationName="Organisationsname ist erforderlich",g(e),0===Object.keys(e).length})())try{o(!0),await Z.h.createJoinRequest(n),g({}),B("Beitrittsanfrage erfolgreich gesendet","success"),l({organizationName:"",message:""}),E(null),S([]),t(),s&&s()}catch(i){var r,a;const e=(null===(r=i.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Fehler beim Senden der Beitrittsanfrage";B(e,"error"),g({submit:e})}finally{o(!1)}else B("Bitte f\xfcllen Sie alle erforderlichen Felder aus","error")},D=()=>{l({organizationName:"",message:""}),E(null),S([]),g({}),C(!1),R.current&&clearTimeout(R.current),t()};return x?(0,k.jsxs)(c.lG,{open:r,onClose:D,className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(c.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,k.jsx)(c.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Organisation beitreten"}),(0,k.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("form",{onSubmit:T,className:"p-4",children:[u.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:u.submit}),(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"relative",ref:L,children:[(0,k.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Organisation suchen *"}),(0,k.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:n.organizationName,onChange:I,placeholder:"Organisationsname eingeben...",className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(u.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.organizationName&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.organizationName}),_&&(A.length>0||d)&&(0,k.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:d?(0,k.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Suche..."}):A.length>0?A.map((e=>(0,k.jsxs)("button",{type:"button",onClick:()=>F(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,k.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,k.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,k.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Keine Organisationen gefunden"})})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachricht (optional)"}),(0,k.jsx)("textarea",{id:"message",name:"message",value:n.message||"",onChange:O,rows:3,placeholder:"Optional: F\xfcgen Sie eine Nachricht hinzu...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:D,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i?"Sende...":"Senden",children:i?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[r&&!v&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:D,style:{opacity:r?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(r?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:r?"auto":"none"},"aria-hidden":!r,role:"dialog","aria-modal":r,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Organisation beitreten"}),(0,k.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[u.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:u.submit}),(0,k.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,k.jsxs)("div",{className:"relative",ref:L,children:[(0,k.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Organisation suchen *"}),(0,k.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:n.organizationName,onChange:I,placeholder:"Organisationsname eingeben...",className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(u.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),u.organizationName&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:u.organizationName}),_&&(A.length>0||d)&&(0,k.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:d?(0,k.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Suche..."}):A.length>0?A.map((e=>(0,k.jsxs)("button",{type:"button",onClick:()=>F(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,k.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,k.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,k.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Keine Organisationen gefunden"})})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachricht (optional)"}),(0,k.jsx)("textarea",{id:"message",name:"message",value:n.message||"",onChange:O,rows:3,placeholder:"Optional: F\xfcgen Sie eine Nachricht hinzu...",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:D,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i?"Sende...":"Senden",children:i?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(h.A,{className:"h-5 w-5"})})]})]})]})]})]})},Q=()=>{const[e,r]=(0,a.useState)(null),[t,i]=(0,a.useState)(null),[o,c]=(0,a.useState)({}),[m,g]=(0,a.useState)(!0),[x,b]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[A,S]=(0,a.useState)(!1),{canViewOrganization:_,canManageOrganization:C,loading:z}=(0,n.S)(),{showMessage:E}=(0,y.A)(),{t:R}=(0,s.Bd)(),{organizationLanguage:L,setOrganizationLanguage:B}=(0,K.o)(),[I,F]=(0,a.useState)(""),[O,T]=(0,a.useState)(!1),D=(0,a.useCallback)((async()=>{try{g(!0),w(null);const e=await Z.h.getCurrentOrganization();r(e),c({displayName:e.displayName||"",domain:e.domain||"",logo:e.logo||"",settings:e.settings});try{const e=await Z.h.getOrganizationLanguage();F(e.language||"")}catch(a){console.error("Fehler beim Laden der Organisation-Sprache:",a)}try{b(!0);const e=await Z.h.getOrganizationStats();i(e)}catch(s){console.error("Fehler beim Laden der Statistiken:",s)}finally{b(!1)}}catch(n){var e,t;const r=(null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||R("organization.loadError");w(r),E(r,"error")}finally{g(!1)}}),[]),M=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(z)return;if(M.current)return;_()?(M.current=!0,D()):(w(R("organization.noPermission")),g(!1),M.current=!0)}),[z]);const G=e=>{const{name:r,value:t}=e.target;c((e=>({...e,[r]:t}))),v&&w(null)};if(z)return(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,k.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,k.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingPermissions")})]})});if(!_())return(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,k.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:R("organization.noPermission")})});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 sm:p-6 mb-6",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-4",children:[(0,k.jsxs)("h2",{className:"text-xl sm:text-xl font-semibold flex items-center dark:text-white",children:[(0,k.jsx)(W.A,{className:"h-6 w-6 sm:h-6 sm:w-6 mr-2 sm:mr-2"}),R("organization.settings")]}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("button",{onClick:()=>S(!0),className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:R("organization.joinOrganization"),children:(0,k.jsx)($,{className:"h-5 w-5"})}),C()&&(0,k.jsx)("button",{onClick:()=>N(!0),className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md dark:bg-green-700 dark:hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",title:R("organization.createOrganization"),children:(0,k.jsx)(u.A,{className:"h-5 w-5"})})]})]}),m?(0,k.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,k.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingOrganization")})]}):(0,k.jsxs)(k.Fragment,{children:[v&&(0,k.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:v}),(0,k.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!C()){const e=R("organization.noPermissionEdit");return w(e),void E(e,"error")}try{f(!0),w(null);const e=await Z.h.updateOrganization(o);r(e),E(R("organization.updateSuccess"),"success")}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||R("organization.updateError");w(e),E(e,"error")}finally{f(!1)}},className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:R("organization.displayName")}),(0,k.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:o.displayName||"",onChange:G,disabled:!C()||p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:R("organization.domain")}),(0,k.jsx)("input",{type:"text",id:"domain",name:"domain",value:o.domain||"",onChange:G,disabled:!C()||p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:R("organization.logoUrl")}),(0,k.jsx)("input",{type:"text",id:"logo",name:"logo",value:o.logo||"",onChange:G,disabled:!C()||p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed"})]}),C()&&(0,k.jsxs)("div",{className:"border-t pt-4",children:[(0,k.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:R("organization.language")}),(0,k.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:R("organization.languageDescription")}),(0,k.jsxs)("select",{id:"organizationLanguage",value:I||L||"",onChange:async e=>{const r=e.target.value;if(F(r),r&&r!==L){T(!0);try{await B(r),E(R("common.save"),"success")}catch(v){console.error("Fehler beim Speichern der Organisation-Sprache:",v),E(R("worktime.messages.orgLanguageError"),"error")}finally{T(!1)}}},disabled:!C()||O||p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,k.jsxs)("option",{value:"",children:[R("settings.useOrganizationLanguage")," (",R("worktime.language.fallback"),": ",R("worktime.language.german"),")"]}),(0,k.jsx)("option",{value:"de",children:R("worktime.language.german")}),(0,k.jsx)("option",{value:"es",children:R("worktime.language.spanish")}),(0,k.jsx)("option",{value:"en",children:R("worktime.language.english")})]})]}),C()&&(0,k.jsx)("div",{className:"flex items-center justify-end space-x-3 pt-4",children:(0,k.jsx)("button",{type:"submit",disabled:p,className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:R(p?"organization.saving":"common.save"),children:p?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(h.A,{className:"h-5 w-5"})})})]}),t&&(0,k.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:R("organization.statistics")}),x?(0,k.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),(0,k.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:R("common.loadingStatistics")})]}):(0,k.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3",children:(0,k.jsx)(l.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.users")}),(0,k.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[t.currentUsers," / ",t.maxUsers]}),void 0!==t.utilizationPercent&&(0,k.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.utilizationPercent,"% ",R("organization.utilizationPercent")]})]})]})}),(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"flex-shrink-0 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3",children:(0,k.jsx)(d,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.roles")}),(0,k.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:t._count.roles})]})]})}),(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3",children:(0,k.jsx)(H,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.joinRequests")}),(0,k.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:t._count.joinRequests})]})]})}),void 0!==t._count.invitations&&(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"flex-shrink-0 bg-green-100 dark:bg-green-900/30 rounded-lg p-3",children:(0,k.jsx)(H,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.invitations")}),(0,k.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:t._count.invitations})]})]})}),void 0!==t.utilizationPercent&&(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"flex-shrink-0 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-3",children:(0,k.jsx)(V.A,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.utilization")}),(0,k.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[t.utilizationPercent,"%"]}),(0,k.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t.availableSlots," ",R("organization.availableSlots")]})]})]})})]})]}),e&&(0,k.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:(0,k.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:[R("organization.organizationName"),":"]}),(0,k.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white",children:e.name})]}),e.subscriptionPlan&&(0,k.jsxs)("div",{children:[(0,k.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:[R("organization.subscriptionPlan"),":"]}),(0,k.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white capitalize",children:e.subscriptionPlan})]})]})})]})]}),(0,k.jsx)(J,{isOpen:j,onClose:()=>N(!1),onSuccess:()=>{D()}}),(0,k.jsx)(Y,{isOpen:A,onClose:()=>S(!1),onSuccess:()=>{D()}})]})};function X(e,r){let{title:t,titleId:s,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},n),t?a.createElement("title",{id:s},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const ee=a.forwardRef(X),re=e=>{let{isOpen:r,onClose:t,joinRequest:s,onSuccess:n}=e;const[l,i]=(0,a.useState)("approve"),[o,d]=(0,a.useState)(null),[u,g]=(0,a.useState)(""),[x,p]=(0,a.useState)([]),[v,w]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[A,S]=(0,a.useState)({}),[_,C]=(0,a.useState)(window.innerWidth<640),[z,E]=(0,a.useState)(window.innerWidth>1070),{openSidepane:R,closeSidepane:L}=(0,f.N)(),{showMessage:B}=(0,y.A)();(0,a.useEffect)((()=>{const e=()=>{C(window.innerWidth<640),E(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(r?R():L(),()=>{L()})),[r,R,L]),(0,a.useEffect)((()=>{r&&s&&(i("approve"),d(null),g(""),S({}),s.organizationId&&I())}),[r,s]);const I=async()=>{try{w(!0);const e=await m.Zj.getAll();e.data&&Array.isArray(e.data)&&p(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),B("Fehler beim Laden der Rollen","error")}finally{w(!1)}},F=async e=>{if(e.preventDefault(),(()=>{const e={};return"approve"!==l||o||(e.roleId="Bitte w\xe4hlen Sie eine Rolle aus"),S(e),0===Object.keys(e).length})()){if(s)try{N(!0);const e={action:l,response:u.trim()||void 0,roleId:"approve"===l&&o||void 0};await Z.h.processJoinRequest(s.id,e),B("approve"===l?"Beitrittsanfrage erfolgreich genehmigt":"Beitrittsanfrage erfolgreich abgelehnt","success"),i("approve"),d(null),g(""),S({}),t(),n()}catch(c){var r,a;const e=(null===(r=c.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Fehler beim Bearbeiten der Beitrittsanfrage";B(e,"error"),S({submit:e})}finally{N(!1)}}else B("Bitte f\xfcllen Sie alle erforderlichen Felder aus","error")},O=()=>{i("approve"),d(null),g(""),S({}),t()};return s?_?(0,k.jsxs)(c.lG,{open:r,onClose:O,className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(c.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,k.jsx)(c.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Beitrittsanfrage bearbeiten"}),(0,k.jsx)("button",{onClick:O,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("form",{onSubmit:F,className:"p-4",children:[A.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A.submit}),(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Antragsteller:"}),(0,k.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[s.requester.firstName," ",s.requester.lastName]}),(0,k.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s.requester.email}),s.message&&(0,k.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachricht:"}),(0,k.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s.message})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Aktion *"}),(0,k.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,k.jsxs)("label",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"radio",value:"approve",checked:"approve"===l,onChange:e=>{i(e.target.value),S({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,k.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Genehmigen"})]}),(0,k.jsxs)("label",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"radio",value:"reject",checked:"reject"===l,onChange:e=>{i(e.target.value),S({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,k.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Ablehnen"})]})]})]}),"approve"===l&&(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rolle zuweisen *"}),v?(0,k.jsxs)("div",{className:"flex items-center py-2",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,k.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lade Rollen..."})]}):(0,k.jsxs)("select",{id:"roleId",value:o||"",onChange:e=>{d(Number(e.target.value)||null),A.roleId&&S((e=>({...e,roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(A.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,k.jsx)("option",{value:"",children:"-- Rolle ausw\xe4hlen --"}),x.map((e=>(0,k.jsxs)("option",{value:e.id,children:[e.name," ",e.description?`- ${e.description}`:""]},e.id)))]}),A.roleId&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:A.roleId})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Antwort (optional)"}),(0,k.jsx)("textarea",{id:"response",value:u,onChange:e=>g(e.target.value),rows:3,placeholder:`Optional: ${"approve"===l?"Willkommensnachricht":"Ablehnungsgrund"} hinzuf\xfcgen...`,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:O,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:j,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors "+("approve"===l?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:j?"approve"===l?"Genehmige...":"Lehne ab...":"approve"===l?"Genehmigen":"Ablehnen",children:j?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):"approve"===l?(0,k.jsx)(h.A,{className:"h-5 w-5"}):(0,k.jsx)(ee,{className:"h-5 w-5"})})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[r&&!z&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:O,style:{opacity:r?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(r?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:r?"auto":"none"},"aria-hidden":!r,role:"dialog","aria-modal":r,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Beitrittsanfrage bearbeiten"}),(0,k.jsx)("button",{onClick:O,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[A.submit&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A.submit}),(0,k.jsxs)("form",{onSubmit:F,className:"space-y-4",children:[(0,k.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Antragsteller:"}),(0,k.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[s.requester.firstName," ",s.requester.lastName]}),(0,k.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s.requester.email}),s.message&&(0,k.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nachricht:"}),(0,k.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s.message})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Aktion *"}),(0,k.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,k.jsxs)("label",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"radio",value:"approve",checked:"approve"===l,onChange:e=>{i(e.target.value),S({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,k.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Genehmigen"})]}),(0,k.jsxs)("label",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"radio",value:"reject",checked:"reject"===l,onChange:e=>{i(e.target.value),S({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,k.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Ablehnen"})]})]})]}),"approve"===l&&(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rolle zuweisen *"}),v?(0,k.jsxs)("div",{className:"flex items-center py-2",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,k.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lade Rollen..."})]}):(0,k.jsxs)("select",{id:"roleId",value:o||"",onChange:e=>{d(Number(e.target.value)||null),A.roleId&&S((e=>({...e,roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 "+(A.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,k.jsx)("option",{value:"",children:"-- Rolle ausw\xe4hlen --"}),x.map((e=>(0,k.jsxs)("option",{value:e.id,children:[e.name," ",e.description?`- ${e.description}`:""]},e.id)))]}),A.roleId&&(0,k.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:A.roleId})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Antwort (optional)"}),(0,k.jsx)("textarea",{id:"response",value:u,onChange:e=>g(e.target.value),rows:3,placeholder:`Optional: ${"approve"===l?"Willkommensnachricht":"Ablehnungsgrund"} hinzuf\xfcgen...`,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsx)("button",{type:"button",onClick:O,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("button",{type:"submit",disabled:j,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed "+("approve"===l?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:j?"approve"===l?"Genehmige...":"Lehne ab...":"approve"===l?"Genehmigen":"Ablehnen",children:j?(0,k.jsx)(q.A,{className:"h-5 w-5 animate-spin"}):"approve"===l?(0,k.jsx)(h.A,{className:"h-5 w-5"}):(0,k.jsx)(ee,{className:"h-5 w-5"})})]})]})]})]})]}):null},te=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},ae=e=>{switch(e){case"pending":return"Ausstehend";case"approved":return"Genehmigt";case"rejected":return"Abgelehnt";case"withdrawn":return"Zur\xfcckgezogen";default:return e}},se=()=>{const[e,r]=(0,a.useState)([]),[t,s]=(0,a.useState)(!0),[l,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(!1),[c,m]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[x,b]=(0,a.useState)("all"),[h,p]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),{canViewJoinRequests:j,canManageJoinRequests:A,loading:S}=(0,n.S)(),{showMessage:C}=(0,y.A)(),z=(0,a.useRef)(!0),E=(0,a.useRef)(!1);(0,a.useEffect)((()=>()=>{z.current=!1}),[]),(0,a.useEffect)((()=>{if(S)return;if(E.current)return;if(!j())return i("Keine Berechtigung zum Anzeigen der Beitrittsanfragen"),s(!1),void(E.current=!0);E.current=!0;(async()=>{if(z.current)try{s(!0),i(null);const e=await Z.h.getJoinRequests();if(!z.current)return;r(e)}catch(a){var e,t;if(!z.current)return;const r=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Laden der Beitrittsanfragen";i(r),setTimeout((()=>{C(r,"error")}),0)}finally{z.current&&s(!1)}})()}),[S]);const R=()=>{let e=0;return"all"!==x&&e++,c.length>0&&e++,e},L=(0,a.useMemo)((()=>{let r=[...e];return"all"!==x&&(r=r.filter((e=>e.status===x))),c.length>0&&(r=c.reduce(((e,r,t)=>{if(!r.column||null===r.value||""===r.value)return e;const a=r.operator,s=r.value;return e.filter((e=>{var t,n;switch(r.column){case"requester":const r=`${e.requester.firstName} ${e.requester.lastName}`.toLowerCase(),l=(null===(t=e.requester.email)||void 0===t?void 0:t.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===a&&(r.includes(i)||l.includes(i));case"message":const o=(null===(n=e.message)||void 0===n?void 0:n.toLowerCase())||"",d=String(s).toLowerCase();return"contains"===a&&o.includes(d);default:return!0}}))}),r)),r}),[e,x,c]);return S?(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,k.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,k.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:"Lade Berechtigungen..."})]})}):j()?(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 sm:p-6 mb-6",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-4",children:[(0,k.jsxs)("h2",{className:"text-xl sm:text-xl font-semibold flex items-center dark:text-white",children:[(0,k.jsx)($,{className:"h-6 w-6 sm:h-6 sm:w-6 mr-2 sm:mr-2"}),"Beitrittsanfragen"]}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsxs)("select",{value:x,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,k.jsx)("option",{value:"all",children:"Alle Status"}),(0,k.jsx)("option",{value:"pending",children:"Ausstehend"}),(0,k.jsx)("option",{value:"approved",children:"Genehmigt"}),(0,k.jsx)("option",{value:"rejected",children:"Abgelehnt"}),(0,k.jsx)("option",{value:"withdrawn",children:"Zur\xfcckgezogen"})]}),(0,k.jsxs)("button",{className:"relative p-2 rounded-md border "+(R()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"),onClick:()=>d(!o),title:"Filter",children:[(0,k.jsx)(N.A,{className:"h-5 w-5"}),R()>0&&(0,k.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:R()})]})]})]}),o&&(0,k.jsx)("div",{className:"mb-4",children:(0,k.jsx)(_.A,{columns:[{id:"requester",label:"Antragsteller"},{id:"message",label:"Nachricht"}],onApply:(e,r)=>{m(e),g(r)},onReset:()=>{m([]),g([]),b("all")},savedConditions:c,savedOperators:u,tableId:"join-requests-table"})}),l&&(0,k.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:l}),t?(0,k.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,k.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:"Lade Beitrittsanfragen..."})]}):0===L.length?(0,k.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:0===e.length?"Keine Beitrittsanfragen vorhanden.":"Keine Beitrittsanfragen entsprechen den Filterkriterien."}):(0,k.jsx)("div",{className:"space-y-4",children:L.map((e=>(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,k.jsx)("div",{className:"flex items-start justify-between",children:(0,k.jsxs)("div",{className:"flex-1",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,k.jsxs)("div",{children:[(0,k.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.requester.firstName," ",e.requester.lastName]}),(0,k.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.requester.email})]}),(0,k.jsx)("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${te(e.status)}`,children:ae(e.status)})]}),e.message&&(0,k.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,k.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,k.jsx)("span",{className:"font-medium",children:"Nachricht:"})," ",e.message]})}),e.response&&(0,k.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,k.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,k.jsx)("span",{className:"font-medium",children:"Antwort:"})," ",e.response]})}),"pending"===e.status&&A()&&(0,k.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,k.jsxs)("button",{onClick:()=>(e=>{if(!A()){const e="Keine Berechtigung zum Bearbeiten der Beitrittsanfragen";return i(e),void C(e,"error")}v(e),p(!0)})(e),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center",children:[(0,k.jsx)(w.A,{className:"h-4 w-4 mr-1"}),"Bearbeiten"]})})]})})},e.id)))}),(0,k.jsx)(re,{isOpen:h,onClose:()=>{p(!1),v(null)},joinRequest:f,onSuccess:async()=>{E.current=!1;try{s(!0);const e=await Z.h.getJoinRequests();r(e),i(null),E.current=!0}catch(a){var e,t;const r=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Laden der Beitrittsanfragen";i(r),E.current=!0}finally{s(!1)}}})]}):(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,k.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:"Keine Berechtigung zum Anzeigen der Beitrittsanfragen."})})},ne=()=>{const{t:e}=(0,s.Bd)(),[r,t]=(0,a.useState)("users"),[o,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(null),{showMessage:g}=(0,y.A)(),{isAdmin:x}=(0,n.S)(),b=e=>{t(e),u(null)},h=e=>{var r,t;let a="Ein Fehler ist aufgetreten";null!==(r=e.response)&&void 0!==r&&null!==(t=r.data)&&void 0!==t&&t.message?a=e.response.data.message:e instanceof Error&&(a=e.message),u(a),g(a,"error")};return x()?(0,k.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,k.jsx)("div",{className:"container mx-auto py-6",children:(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,k.jsxs)("div",{className:"flex items-center mb-6",children:[(0,k.jsx)(l.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,k.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("userManagement.title")})]}),(0,k.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,k.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,k.jsxs)("button",{className:("users"===r?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center",onClick:()=>b("users"),children:[(0,k.jsx)(i.A,{className:"h-5 w-5 mr-2"}),e("userManagement.tabs.users")]}),(0,k.jsxs)("button",{className:("roles"===r?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center",onClick:()=>b("roles"),children:[(0,k.jsx)(d,{className:"h-5 w-5 mr-2"}),e("userManagement.tabs.roles")]}),x()&&(0,k.jsxs)("button",{className:("organization"===r?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center",onClick:()=>b("organization"),children:[(0,k.jsx)(l.A,{className:"h-5 w-5 mr-2"}),e("userManagement.tabs.organization")]})]})}),m&&(0,k.jsxs)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded mb-4",children:[(0,k.jsx)("p",{className:"font-bold",children:e("userManagement.error")}),(0,k.jsx)("p",{children:m})]}),o&&(0,k.jsx)("div",{className:"p-4 dark:text-gray-300",children:e("userManagement.loading")}),(0,k.jsx)("div",{className:"mt-6",children:"users"===r?(0,k.jsx)(v,{onError:h}):"roles"===r?(0,k.jsx)(G,{onError:h}):"organization"===r&&x()?(0,k.jsxs)("div",{className:"space-y-6",children:[(0,k.jsx)(Q,{}),(0,k.jsx)(se,{})]}):(0,k.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("userManagement.noPermissionForPage")})})]})})}):(0,k.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("userManagement.noPermission")})}}}]);
//# sourceMappingURL=806.a6dc4a84.chunk.js.map