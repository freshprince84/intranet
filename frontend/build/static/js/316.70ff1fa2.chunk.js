"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[316],{1726:(e,t,a)=>{a.d(t,{X:()=>r,d:()=>s});let r=function(e){return e.CONFIRMED="confirmed",e.NOTIFICATION_SENT="notification_sent",e.CHECKED_IN="checked_in",e.CHECKED_OUT="checked_out",e.CANCELLED="cancelled",e.NO_SHOW="no_show",e}({}),s=function(e){return e.PENDING="pending",e.PAID="paid",e.PARTIALLY_PAID="partially_paid",e.REFUNDED="refunded",e}({})},4450:(e,t,a)=>{a.d(t,{u:()=>i});var r=a(1923),s=a(8018),n=a(1801);const o="/reservations",i={async create(e){s.v.log("[reservationService] POST zu:",o),s.v.log("[reservationService] Daten:",e);const t=await r.A.post(o,e);return s.v.log("[reservationService] Response:",t),t.data.data||t.data},async getById(e){const t=await r.A.get("".concat(o,"/").concat(e));return t.data.data||t.data},async updateGuestContact(e,t){const a=await r.A.put("".concat(o,"/").concat(e,"/guest-contact"),{contact:t});return a.data.data||a.data},async generatePinAndSend(e){const t=await r.A.post(n.Sn.RESERVATION.GENERATE_PIN_AND_SEND(e));return t.data.data||t.data},async sendInvitation(e,t){const a=await r.A.post(n.Sn.RESERVATION.SEND_INVITATION(e),t||{});return a.data.data||a.data},async sendPasscode(e,t){const a=await r.A.post(n.Sn.RESERVATION.SEND_PASSCODE(e),t||{});return a.data.data||a.data},async getNotificationLogs(e){const t=await r.A.get(n.Sn.RESERVATION.NOTIFICATION_LOGS(e)),a=t.data.data||t.data;return Array.isArray(a)?{notificationLogs:a,whatsappMessages:[]}:a}}},7539:(e,t,a)=>{a.d(t,{A:()=>g});var r=a(5043),s=a(4117),n=a(1923),o=a(6443),i=a(7591),l=a(9422),d=a(1801),c=a(2672),u=a(7855),m=a(579);const g=e=>{let{isOpen:t,onClose:a,onBookingCreated:g,tour:x}=e;const{t:h}=(0,s.Bd)(),{user:p}=(0,c.As)(),{showMessage:b}=(0,u.A)(),[y,v]=(0,r.useState)((null===x||void 0===x?void 0:x.id)||""),[f,k]=(0,r.useState)(""),[N,w]=(0,r.useState)(1),[j,S]=(0,r.useState)(""),[A,C]=(0,r.useState)(""),[T,E]=(0,r.useState)(""),[D,I]=(0,r.useState)(""),[R,P]=(0,r.useState)([]),[L,O]=(0,r.useState)(x||null),[F,B]=(0,r.useState)(null),[z,M]=(0,r.useState)(!1),[V,_]=(0,r.useState)(!0);(0,r.useEffect)((()=>{t&&(async()=>{try{var e;_(!0);const t=await n.A.get(d.Sn.TOURS.BASE,{params:{isActive:!0}}),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];P(Array.isArray(a)?a:[])}catch(t){console.error("Error loading tours:",t),b(h("errors.loadError"),"error")}finally{_(!1)}})()}),[t,h,b]),(0,r.useEffect)((()=>{x&&(v(x.id),O(x))}),[x]),(0,r.useEffect)((()=>{if(y){const e=R.find((e=>e.id===Number(y)));O(e||null)}else O(null)}),[y,R]),(0,r.useEffect)((()=>{t||(x||v(""),k(""),w(1),S(""),C(""),E(""),I(""),B(null))}),[t,x]);return(0,m.jsxs)(o.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,m.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,m.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,m.jsxs)(o.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,m.jsx)(o.lG.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h("tourBookings.create",{defaultValue:"Neue Tour-Buchung"})}),(0,m.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,m.jsx)(i.A,{className:"h-6 w-6"})})]}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),B(null),!y)return void B(h("tourBookings.validation.tourRequired",{defaultValue:"Tour ist erforderlich"}));if(!f)return void B(h("tourBookings.validation.tourDateRequired",{defaultValue:"Tour-Datum ist erforderlich"}));if(new Date(f)<new Date)B(h("tours.validation.tourDateFuture",{defaultValue:"Tour-Datum muss in der Zukunft liegen"}));else if(!N||Number(N)<1)B(h("tourBookings.validation.numberOfParticipantsMin",{defaultValue:"Anzahl Teilnehmer muss >= 1 sein"}));else if(!j.trim()||j.trim().length<2)B(h("tourBookings.validation.customerNameMinLength",{defaultValue:"Kundenname muss mindestens 2 Zeichen lang sein"}));else if(T.trim()||A.trim()){if(L){const e=Number(N);if(L.minParticipants&&e<L.minParticipants)return void B(h("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:L.minParticipants,max:L.maxParticipants||"\u221e"}));if(L.maxParticipants&&e>L.maxParticipants)return void B(h("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:L.minParticipants||1,max:L.maxParticipants}))}M(!0);try{var t,r;const e=await n.A.post(d.Sn.TOUR_BOOKINGS.BASE,{tourId:Number(y),tourDate:f,numberOfParticipants:Number(N),customerName:j.trim(),customerEmail:A.trim()||null,customerPhone:T.trim()||null,customerNotes:D.trim()||null});var s;if(null===(t=e.data)||void 0===t||!t.success||null===(r=e.data)||void 0===r||!r.data)throw new Error((null===(s=e.data)||void 0===s?void 0:s.message)||h("tours.bookings.createError",{defaultValue:"Fehler beim Erstellen der Buchung"}));b(h("tourBookings.created",{defaultValue:"Tour-Buchung erfolgreich erstellt"}),"success"),g(e.data.data),a()}catch(l){var o,i;console.error("Error creating booking:",l);const e=(null===l||void 0===l||null===(o=l.response)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.message)||(null===l||void 0===l?void 0:l.message)||h("errors.unknownError");B(e),b(e,"error")}finally{M(!1)}}else B(h("tourBookings.validation.contactRequired",{defaultValue:"Mindestens eine Kontaktinformation (Telefon oder E-Mail) ist erforderlich"}))},className:"p-4 space-y-4",children:[F&&(0,m.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,m.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:F})}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[h("tourBookings.tour",{defaultValue:"Tour"})," *"]}),(0,m.jsxs)("select",{value:y,onChange:e=>v(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:z||V||!!x,children:[(0,m.jsx)("option",{value:"",children:h("common.select",{defaultValue:"Bitte w\xe4hlen"})}),R.filter((e=>e.isActive&&e.title)).map((e=>(0,m.jsx)("option",{value:e.id,children:e.title||"-"},e.id)))]}),L&&(0,m.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:L.minParticipants&&L.maxParticipants?h("tourBookings.participantsRange",{defaultValue:"Teilnehmer: {min} - {max}",min:L.minParticipants,max:L.maxParticipants}):L.minParticipants?h("tourBookings.participantsMin",{defaultValue:"Min. Teilnehmer: {min}",min:L.minParticipants}):L.maxParticipants?h("tourBookings.participantsMax",{defaultValue:"Max. Teilnehmer: {max}",max:L.maxParticipants}):null})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[h("tourBookings.tourDate",{defaultValue:"Tour-Datum"})," *"]}),(0,m.jsx)("input",{type:"datetime-local",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:z||V})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[h("tourBookings.numberOfParticipants",{defaultValue:"Anzahl Teilnehmer"})," *"]}),(0,m.jsx)("input",{type:"number",min:(null===L||void 0===L?void 0:L.minParticipants)||1,max:(null===L||void 0===L?void 0:L.maxParticipants)||void 0,value:N,onChange:e=>w(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:z||V})]}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[h("tourBookings.customerName",{defaultValue:"Kundenname"})," *"]}),(0,m.jsx)("input",{type:"text",value:j,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:z||V})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:h("tourBookings.customerPhone",{defaultValue:"Telefon"})}),(0,m.jsx)("input",{type:"tel",value:T,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:z||V})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:h("tourBookings.customerEmail",{defaultValue:"E-Mail"})}),(0,m.jsx)("input",{type:"email",value:A,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:z||V})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:h("tourBookings.customerNotes",{defaultValue:"Notizen"})}),(0,m.jsx)("textarea",{value:D,onChange:e=>I(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:z||V})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,m.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:h("common.cancel","Abbrechen"),children:(0,m.jsx)(i.A,{className:"h-5 w-5"})}),(0,m.jsx)("button",{type:"submit",disabled:z||V,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:z?h("common.saving","Speichere..."):h("common.save","Speichern"),children:(0,m.jsx)(l.A,{className:"h-5 w-5"})})]})]})]})})]})}},7935:(e,t,a)=>{a.d(t,{A:()=>f});var r=a(5043),s=a(4117),n=a(4450),o=a(2415),i=a(887),l=a(4057),d=a(6511),c=a(9850),u=a(8682),m=a(7438),g=a(6693),x=a(4538),h=a(7098),p=a(7012),b=a(2311),y=a(9626),v=a(579);const f=e=>{let{reservationId:t,refreshKey:a}=e;const{t:f,i18n:k}=(0,s.Bd)(),[N,w]=(0,r.useState)([]),[j,S]=(0,r.useState)([]),[A,C]=(0,r.useState)(!0),[T,E]=(0,r.useState)(null),D=()=>{switch(k.language){case"de":return i.de;case"es":return l.es;default:return d.c}},I=e=>{try{return(0,o.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:D()})}catch(t){return e}},R=e=>{switch(e){case"invitation":return f("reservations.notificationLogs.type.invitation","Einladung");case"pin":return f("reservations.notificationLogs.type.pin","PIN-Code");case"checkin_confirmation":return f("reservations.notificationLogs.type.checkinConfirmation","Check-in-Best\xe4tigung");default:return e}},P=e=>{switch(e){case"whatsapp":return(0,v.jsx)(c.A,{className:"h-4 w-4"});case"email":return(0,v.jsx)(u.A,{className:"h-4 w-4"});case"both":return(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)(c.A,{className:"h-4 w-4"}),(0,v.jsx)(u.A,{className:"h-4 w-4"})]});default:return(0,v.jsx)(m.A,{className:"h-4 w-4"})}},L=e=>{switch(e){case"pin":return(0,v.jsx)(g.A,{className:"h-4 w-4"});case"invitation":default:return(0,v.jsx)(m.A,{className:"h-4 w-4"});case"checkin_confirmation":return(0,v.jsx)(x.A,{className:"h-4 w-4"})}};if((0,r.useEffect)((()=>{(async()=>{try{C(!0),E(null);const e=await n.u.getNotificationLogs(t);w(e.notificationLogs||[]),S(e.whatsappMessages||[])}catch(r){var e,a;console.error("Fehler beim Laden der Notification-Logs:",r),E((null===(e=r.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||f("reservations.notificationLogs.loadError","Fehler beim Laden der Logs"))}finally{C(!1)}})()}),[t,f,a]),A)return(0,v.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:(0,v.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,v.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),(0,v.jsx)("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"})]})});if(T)return(0,v.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:(0,v.jsx)("div",{className:"text-red-600 dark:text-red-400 text-sm",children:T})});const O=[...N.map((e=>({type:"notification",data:e,timestamp:e.sentAt}))),...j.map((e=>({type:"whatsapp",data:e,timestamp:e.sentAt})))].sort(((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()));return 0===O.length?(0,v.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:[(0,v.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:f("reservations.notificationLogs.title","Benachrichtigungs-Historie")}),(0,v.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f("reservations.notificationLogs.noLogs","Keine Logs vorhanden")})]}):(0,v.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:[(0,v.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:f("reservations.notificationLogs.title","Benachrichtigungs-Historie")}),(0,v.jsx)("div",{className:"space-y-3",children:O.map((e=>{if("notification"===e.type){const t=e.data;return(0,v.jsxs)("div",{className:"border rounded-lg p-3 ".concat(t.success?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"),children:[(0,v.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,v.jsxs)("div",{className:"flex items-center space-x-2",children:[t.success?(0,v.jsx)(x.A,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):(0,v.jsx)(h.A,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),(0,v.jsxs)("div",{className:"flex items-center space-x-2",children:[L(t.notificationType),(0,v.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:R(t.notificationType)})]}),(0,v.jsx)("div",{className:"flex items-center space-x-1 text-gray-500 dark:text-gray-400",children:P(t.channel)})]}),(0,v.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,v.jsx)(p.A,{className:"h-4 w-4"}),(0,v.jsx)("span",{children:I(t.sentAt)})]})]}),t.sentTo&&(0,v.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-1",children:[(0,v.jsxs)("span",{className:"font-medium",children:[f("reservations.notificationLogs.sentTo","Gesendet an"),":"]})," ",t.sentTo]}),t.message&&(0,v.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2 mt-2 p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,v.jsxs)("div",{className:"font-medium mb-1",children:[f("reservations.notificationLogs.message","Nachricht"),":"]}),(0,v.jsx)("div",{className:"whitespace-pre-wrap break-words",children:t.message})]}),(t.paymentLink||t.checkInLink)&&(0,v.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[t.paymentLink&&(0,v.jsx)("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:f("reservations.notificationLogs.paymentLink","Zahlungslink")}),t.checkInLink&&(0,v.jsx)("a",{href:t.checkInLink,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:f("reservations.notificationLogs.checkInLink","Check-in-Link")})]}),t.errorMessage&&(0,v.jsxs)("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded text-xs text-red-700 dark:text-red-300",children:[(0,v.jsxs)("div",{className:"font-medium mb-1",children:[f("reservations.notificationLogs.error","Fehler"),":"]}),(0,v.jsx)("div",{children:t.errorMessage})]})]},"notification-".concat(t.id))}{const t=e.data,a="incoming"===t.direction,r="failed"===t.status;return(0,v.jsxs)("div",{className:"border rounded-lg p-3 ".concat(a?"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20":r?"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"),children:[(0,v.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,v.jsxs)("div",{className:"flex items-center space-x-2",children:[a?(0,v.jsx)(b.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}):r?(0,v.jsx)(h.A,{className:"h-5 w-5 text-red-600 dark:text-red-400"}):(0,v.jsx)(y.A,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"}),(0,v.jsx)(c.A,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),(0,v.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a?f("reservations.notificationLogs.whatsapp.incoming","Eingehende WhatsApp-Nachricht"):f("reservations.notificationLogs.whatsapp.outgoing","Ausgehende WhatsApp-Nachricht")}),t.status&&(0,v.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",t.status,")"]})]}),(0,v.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,v.jsx)(p.A,{className:"h-4 w-4"}),(0,v.jsx)("span",{children:I(t.sentAt)})]})]}),(0,v.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-1",children:[(0,v.jsxs)("span",{className:"font-medium",children:[f("reservations.notificationLogs.sentTo","Gesendet an"),":"]})," ",t.phoneNumber]}),t.message&&(0,v.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2 mt-2 p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,v.jsxs)("div",{className:"font-medium mb-1",children:[f("reservations.notificationLogs.message","Nachricht"),":"]}),(0,v.jsx)("div",{className:"whitespace-pre-wrap break-words",children:t.message})]}),t.errorMessage&&(0,v.jsxs)("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded text-xs text-red-700 dark:text-red-300",children:[(0,v.jsxs)("div",{className:"font-medium mb-1",children:[f("reservations.notificationLogs.error","Fehler"),":"]}),(0,v.jsx)("div",{children:t.errorMessage})]})]},"whatsapp-".concat(t.id))}}))})]})}},9935:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ze});var r=a(9379),s=a(5043),n=a(4117),o=a(1637),i=a(3216),l=a(2672),d=a(2760),c=a(2023),u=a(8897),m=a(5442),g=a(6287),x=a(8662),h=a(4538),p=a(7988),b=a(1369),y=a(1816),v=a(4850),f=a(1663),k=a(8010),N=a(1909),w=a(1252),j=a(2811),S=a(3744),A=a(9248),C=a(6238),T=a(4129),E=a(5501),D=a(8682),I=a(9850),R=a(9670),P=a(2683),L=a(7012),O=a(6693),F=a(7438),B=a(1923),z=a(6443),M=a(7591),V=a(9422),_=a(1801),q=a(579);const U=e=>{let{onArticleSelected:t,excludeArticleIds:a=[],selectedArticles:r,onArticleRemove:n}=e;const[o,i]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,g]=(0,s.useState)(!1),[x,h]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{try{g(!0),h(null);const e=(await B.A.get(_.Sn.CEREBRO.ARTICLES.BASE)).data.filter((e=>!a.includes(e.id)));i(e)}catch(r){var e,t;console.error("Fehler beim Abrufen der Artikel:",r);const a=r;h((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{g(!1)}})()}),[a]);return(0,q.jsxs)("div",{className:"mt-4",children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cerebro-Artikel verkn\xfcpfen"}),(0,q.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[(0,q.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:l||"",onChange:e=>{const t=parseInt(e.target.value,10);if(isNaN(t))d(null),u(null);else{d(t);o.find((e=>e.id===t))&&(async e=>{try{g(!0);const t=await B.A.get(_.Sn.CEREBRO.ARTICLES.BY_ID(e));u(t.data)}catch(t){console.error("Fehler beim Abrufen der Artikeldetails:",t)}finally{g(!1)}})(t)}},children:[(0,q.jsx)("option",{value:"",children:"-- Artikel ausw\xe4hlen --"}),o.map((e=>(0,q.jsx)("option",{value:e.id,children:e.title},e.id)))]}),(0,q.jsx)("button",{type:"button",onClick:()=>{if(null!==l){const e=o.find((e=>e.id===l));e&&(t(e),d(null),u(null))}},disabled:null===l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Verkn\xfcpfen"})]}),m&&(0,q.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Artikel..."}),x&&(0,q.jsx)("div",{className:"text-sm text-red-600",children:x}),c&&(0,q.jsxs)("div",{className:"mt-2 p-4 border border-gray-300 rounded-md bg-gray-50",children:[(0,q.jsx)("h4",{className:"font-medium text-lg mb-2",children:c.title}),(0,q.jsx)("div",{className:"prose prose-sm max-w-none",children:c.content?(0,q.jsxs)("div",{className:"text-sm text-gray-700 max-h-40 overflow-y-auto",children:[c.content.substring(0,300),c.content.length>300&&"..."]}):(0,q.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Kein Inhalt verf\xfcgbar"})}),(0,q.jsx)("div",{className:"mt-2",children:(0,q.jsx)("a",{href:"/cerebro/articles/".concat(c.slug),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"Artikel \xf6ffnen"})})]})]})]})};var W=a(5657),K=a(8018);const G=e=>{let{file:t,alt:a,blobUrlsRef:r,className:n="max-w-[200px] max-h-[150px] object-contain"}=e;const[o,i]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=URL.createObjectURL(t);return r.current.add(e),i(e),()=>{URL.revokeObjectURL(e),r.current.delete(e)}}),[t,r]),o?(0,q.jsx)("img",{src:o,alt:a,className:n}):null},H=e=>{let{error:t,title:a,setTitle:r,description:o,setDescription:i,assigneeType:l,setAssigneeType:d,responsibleId:c,setResponsibleId:u,roleId:m,setRoleId:g,qualityControlId:x,setQualityControlId:h,branchId:p,setBranchId:b,dueDate:v,setDueDate:f,users:k,roles:N,branches:w,loading:j,handleSubmit:S,handleClose:A,selectedArticles:C,onArticleSelect:T,onArticleRemove:E,uploading:D=!1,temporaryAttachments:I=[],onFileUpload:R,onRemoveAttachment:P,textareaRef:L,fileInputRef:O,handlePaste:F,handleDrop:B,handleDragOver:z}=e;const{t:_}=(0,n.Bd)(),[W,K]=(0,s.useState)("data");return(0,q.jsxs)("form",{onSubmit:S,className:"space-y-4",noValidate:!0,children:[t&&(0,q.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 dark:border-red-700 text-red-700 dark:text-red-300 p-4 mb-4",children:(0,q.jsx)("p",{children:t})}),(0,q.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,q.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,q.jsx)("button",{type:"button",className:"".concat("data"===W?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>K("data"),children:"Daten"}),(0,q.jsx)("button",{type:"button",className:"".concat("cerebro"===W?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>K("cerebro"),children:"Cerebro Artikel"})]})}),"data"===W&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[_("tasks.createTask.form.title")," *"]}),(0,q.jsx)("input",{type:"text",id:"title",value:a,onChange:e=>r(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsx)("div",{className:"space-y-4",children:(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"description_sidepane",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:_("tasks.createTask.form.description")}),(0,q.jsxs)("div",{className:"relative",children:[(0,q.jsx)("textarea",{ref:L,id:"description_task_create",rows:6,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",value:o,onChange:e=>i(e.target.value),onPaste:F,onDrop:B,onDragOver:z,placeholder:_("tasks.createTask.form.descriptionPlaceholder")}),(0,q.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,q.jsx)("button",{type:"button",onClick:()=>{var e;return null===O||void 0===O||null===(e=O.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_("tasks.createTask.form.fileUpload")})]}),(0,q.jsx)("input",{ref:O,type:"file",onChange:R,className:"hidden"}),D&&(0,q.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,q.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:_("tasks.createTask.form.uploading")})})]}),I&&I.length>0&&(0,q.jsx)("div",{className:"mt-2",children:(0,q.jsx)("ul",{className:"flex flex-wrap gap-2",children:I.map(((e,t)=>(0,q.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,q.jsx)("div",{className:"flex ml-2",children:(0,q.jsxs)("div",{className:"relative group ml-1",children:[(0,q.jsx)("button",{type:"button",onClick:()=>null===P||void 0===P?void 0:P(t),className:"text-red-600 hover:text-red-900",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_("tasks.createTask.form.remove")})]})}),e.fileType.startsWith("image/")&&e.file&&(0,q.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-700 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,q.jsx)(G,{file:e.file,alt:e.fileName,blobUrlsRef:blobUrlsRef})})]},t)))})})]})}),(0,q.jsxs)("div",{className:"space-y-2",children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[_("tasks.createTask.form.responsibleFor")," *"]}),(0,q.jsxs)("div",{className:"flex space-x-4",children:[(0,q.jsxs)("label",{className:"inline-flex items-center",children:[(0,q.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===l,onChange:()=>{d("user"),g("")}}),(0,q.jsx)("span",{className:"ml-2 dark:text-gray-300",children:_("tasks.createTask.form.user")})]}),(0,q.jsxs)("label",{className:"inline-flex items-center",children:[(0,q.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===l,onChange:()=>{d("role"),u("")}}),(0,q.jsx)("span",{className:"ml-2 dark:text-gray-300",children:_("tasks.createTask.form.role")})]})]})]}),"user"===l?(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[_("tasks.createTask.form.responsibleUser")," *"]}),(0,q.jsxs)("select",{id:"responsible",value:c,onChange:e=>u(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,q.jsx)("option",{value:"",children:_("tasks.createTask.form.pleaseSelect")}),Array.isArray(k)&&k.map((e=>(0,q.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[_("tasks.createTask.form.responsibleRole")," *"]}),(0,q.jsxs)("select",{id:"role",value:m,onChange:e=>g(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,q.jsx)("option",{value:"",children:_("tasks.createTask.form.pleaseSelect")}),Array.isArray(N)&&N.map((e=>(0,q.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:_("tasks.createTask.form.qualityControl")}),(0,q.jsxs)("select",{id:"qualityControl",value:x,onChange:e=>h(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,q.jsx)("option",{value:"",children:_("tasks.createTask.form.noQualityControl")}),Array.isArray(k)&&k.map((e=>(0,q.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[_("tasks.createTask.form.branch")," *"]}),(0,q.jsxs)("select",{id:"branch",value:p,onChange:e=>b(Number(e.target.value)),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,q.jsx)("option",{value:"",children:_("common.pleaseSelect")}),Array.isArray(w)&&w.map((e=>(0,q.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:_("tasks.createTask.form.dueDate")}),(0,q.jsx)("input",{type:"date",id:"dueDate",value:v,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===W&&(0,q.jsxs)("div",{children:[(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Verkn\xfcpfte Cerebro-Artikel"}),C.length>0?(0,q.jsx)("ul",{className:"mt-2 space-y-2",children:C.map((e=>(0,q.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,q.jsx)("span",{className:"dark:text-gray-300",children:e.title}),(0,q.jsx)("button",{type:"button",onClick:()=>E(e.id),className:"text-red-600 hover:text-red-800",children:_("tasks.createTask.form.remove")})]},e.id)))}):(0,q.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:_("tasks.createTask.form.noArticlesLinked")})]}),(0,q.jsx)(U,{onArticleSelected:T,excludeArticleIds:C.map((e=>e.id)),selectedArticles:C,onArticleRemove:E})]}),(0,q.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{type:"button",onClick:A,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_("tasks.createTask.form.cancel")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:j,children:j?(0,q.jsx)(y.A,{className:"h-5 w-5 animate-spin"}):(0,q.jsx)(V.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_(j?"tasks.createTask.form.creating":"tasks.createTask.form.create")})]})]})]})},Z=e=>{let{isOpen:t,onClose:a,onTaskCreated:r}=e;const{t:o}=(0,n.Bd)(),{user:i}=(0,l.As)(),{openSidepane:d,closeSidepane:c}=(0,W.N)(),[u,m]=(0,s.useState)(window.innerWidth>1070),[g,x]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[b,y]=(0,s.useState)("user"),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(""),[w,j]=(0,s.useState)(""),[S,A]=(0,s.useState)(""),[C,T]=(0,s.useState)(""),[E,D]=(0,s.useState)([]),[I,R]=(0,s.useState)([]),[P,L]=(0,s.useState)([]),[O,F]=(0,s.useState)(null),[V,U]=(0,s.useState)(!1),[G,Z]=(0,s.useState)(window.innerWidth<640),[Y,Q]=(0,s.useState)([]),[J,$]=(0,s.useState)("data"),[X,ee]=(0,s.useState)([]),[te,ae]=(0,s.useState)(!1),re=(0,s.useRef)(null),se=(0,s.useRef)(null),ne=(0,s.useRef)(new Set);(0,s.useEffect)((()=>{t&&(oe(),ie(),le(),i&&j(i.id),T((()=>{const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]})()))}),[t,i]),(0,s.useEffect)((()=>{P.length>0&&""===S&&(1===P.length||P.length>1)&&A(P[0].id)}),[P,S]),(0,s.useEffect)((()=>{const e=()=>{Z(window.innerWidth<640),m(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>()=>{ne.current.forEach((e=>{URL.revokeObjectURL(e)})),ne.current.clear()}),[]),(0,s.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]);const oe=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");K.v.log("Lade Benutzer f\xfcr CreateTaskModal...");const e=await B.A.get(_.Sn.USERS.DROPDOWN);K.v.log("Benutzer geladen:",e.data.length),D(e.data||[])}catch(a){console.error("Fehler beim Laden der Benutzer:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadUsersError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},ie=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");const e=await B.A.get(_.Sn.ROLES.BASE);R(e.data||[])}catch(a){console.error("Fehler beim Laden der Rollen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadRolesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},le=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");K.v.log("Lade Niederlassungen f\xfcr CreateTaskModal...");const e=await B.A.get(_.Sn.BRANCHES.BASE);K.v.log("Niederlassungen geladen:",e.data.length),L(e.data||[])}catch(a){console.error("Fehler beim Laden der Niederlassungen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadBranchesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},de=async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++){const r=t[a];if(0===r.type.indexOf("image")){e.preventDefault();const t=r.getAsFile();return void(t&&await me(t))}}},ce=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await me(t)}},ue=e=>{e.preventDefault(),e.stopPropagation()},me=async e=>{ae(!0),F(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};ee((e=>[...e,t]));let a="";if(a=e.type.startsWith("image/")?"\n![".concat(e.name,"](").concat(o("tasks.createTask.form.uploadAfterCreate"),")\n"):"\n[".concat(e.name,"](").concat(o("tasks.createTask.form.uploadAfterCreate"),")\n"),se.current){const e=se.current.selectionStart,t=h.substring(0,e),r=h.substring(e);p(t+a+r),setTimeout((()=>{if(se.current){const t=e+a.length;se.current.selectionStart=t,se.current.selectionEnd=t,se.current.focus()}}),0)}else p(h+a)}catch(r){var t,a;console.error("Fehler beim Verarbeiten der Datei:",r);const e=r;F((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{ae(!1)}},ge=async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=t[0];await me(a),re.current&&(re.current.value="")},xe=e=>{const t=X[e];if(t&&(ee(X.filter(((t,a)=>a!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=o("tasks.createTask.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=h.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");p(n)}},he=async e=>{e.preventDefault(),F(null),U(!0);try{if(!g||!v&&!k||!S)return F(o("tasks.createTask.errors.fillAllFields")),void U(!1);if(v&&k)return F(o("tasks.createTask.errors.chooseUserOrRole")),void U(!1);if(!localStorage.getItem("token"))return F("Nicht authentifiziert"),void U(!1);const e=Number(S),t=w?Number(w):null,a=v?Number(v):null,s=k?Number(k):null;if(v&&isNaN(a)||k&&isNaN(s)||isNaN(e)||w&&isNaN(t))return F(o("tasks.createTask.errors.invalidIds")),void U(!1);const n={title:g,description:h,status:"open",qualityControlId:t,branchId:e,dueDate:C};"user"===b&&v?n.responsibleId=v:"role"===b&&k&&(n.roleId=k);const i=await B.A.post(_.Sn.TASKS.BASE,n),l=i.data.id;Y.length>0&&await Promise.all(Y.map((e=>B.A.post(_.Sn.TASKS.LINK_CARTICLE(l,e.id))))),await(async e=>{if(0!==X.length)try{U(!0);for(const t of X){if(!t.file)continue;const a=new FormData;a.append("file",t.file),await B.A.post(_.Sn.TASKS.ATTACHMENTS(e),a,{headers:{"Content-Type":"multipart/form-data"}})}K.v.log("".concat(X.length," Anh\xe4nge erfolgreich hochgeladen."))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{U(!1)}})(l),K.v.log("Task erfolgreich erstellt:",i.data),r(i.data),pe()}catch(s){var t,a;console.error("Fehler beim Erstellen des Tasks:",s);const e=s;F((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||e.message||o("tasks.createTask.errors.createError"))}finally{U(!1)}},pe=()=>{x(""),p(""),y("user"),f(""),N(""),j(""),A(""),T(""),F(null),Q([]),ee([]),a()},be=e=>{Q((t=>[...t,e]))},ye=e=>{Q((t=>t.filter((t=>t.id!==e))))};return G?(0,q.jsxs)(z.lG,{open:t,onClose:pe,className:"relative z-50",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,q.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,q.jsxs)(z.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,q.jsx)(z.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("tasks.createTask.title")}),(0,q.jsx)("button",{onClick:pe,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)(H,{error:O,title:g,setTitle:x,description:h,setDescription:p,assigneeType:b,setAssigneeType:y,responsibleId:v,setResponsibleId:f,roleId:k,setRoleId:N,qualityControlId:w,setQualityControlId:j,branchId:S,setBranchId:A,dueDate:C,setDueDate:T,users:E,roles:I,branches:P,loading:V,handleSubmit:he,handleClose:pe,selectedArticles:Y,onArticleSelect:be,onArticleRemove:ye,uploading:te,temporaryAttachments:X,onFileUpload:ge,onRemoveAttachment:xe,textareaRef:se,fileInputRef:re,handlePaste:de,handleDrop:ce,handleDragOver:ue})]})})]}):(0,q.jsxs)(q.Fragment,{children:[t&&!u&&(0,q.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,q.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("tasks.createTask.title")}),(0,q.jsx)("button",{onClick:pe,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,q.jsx)(H,{error:O,title:g,setTitle:x,description:h,setDescription:p,assigneeType:b,setAssigneeType:y,responsibleId:v,setResponsibleId:f,roleId:k,setRoleId:N,qualityControlId:w,setQualityControlId:j,branchId:S,setBranchId:A,dueDate:C,setDueDate:T,users:E,roles:I,branches:P,loading:V,handleSubmit:he,handleClose:pe,selectedArticles:Y,onArticleSelect:be,onArticleRemove:ye,uploading:te,temporaryAttachments:X,onFileUpload:ge,onRemoveAttachment:xe,textareaRef:se,fileInputRef:re,handlePaste:de,handleDrop:ce,handleDragOver:ue})})]})]})};var Y=a(5377),Q=a(7855);const J=e=>{var t,a,r,s,o;let{task:i}=e;const{t:l}=(0,n.Bd)(),{showMessage:d}=(0,Q.A)(),c=(null===(t=i.title)||void 0===t?void 0:t.includes("ARL"))||(null===(a=i.title)||void 0===a?void 0:a.includes("EPS"))||(null===(r=i.title)||void 0===r?void 0:r.includes("Pension"))||(null===(s=i.title)||void 0===s?void 0:s.includes("Caja"))||(null===(o=i.description)||void 0===o?void 0:o.includes("lifecycle"));let u={};if(i.description)try{const e=i.description.match(/\{[\s\S]*\}/);e&&(u=JSON.parse(e[0]))}catch(m){i.description.split("\n").forEach((e=>{const t=e.match(/([^:]+):\s*(.+)/);if(t){const e=t[1].trim(),a=t[2].trim();u[e]=a}}))}0===Object.keys(u).length&&c&&(u={taskType:i.title,description:i.description||l("lifecycle.noDataAvailable")});return c||0!==Object.keys(u).length?(0,q.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,q.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,q.jsx)(Y.A,{className:"h-5 w-5 mr-2"}),l("lifecycle.autoGeneratedData",{defaultValue:"Automatisch generierte Daten"})]}),(0,q.jsx)("button",{onClick:async()=>{try{const e=JSON.stringify(u,null,2);await navigator.clipboard.writeText(e),d(l("lifecycle.dataCopied",{defaultValue:"Daten in Zwischenablage kopiert"}),"success")}catch(e){console.error("Fehler beim Kopieren:",e),d(l("lifecycle.copyError",{defaultValue:"Fehler beim Kopieren"}),"error")}},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:l("lifecycle.copyData",{defaultValue:"Daten kopieren"})})]}),(0,q.jsx)("div",{className:"space-y-2",children:Object.keys(u).length>0?Object.entries(u).map((e=>{let[t,a]=e;return(0,q.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[(0,q.jsxs)("span",{className:"font-medium w-full sm:w-1/3 dark:text-gray-300",children:[l("lifecycle.".concat(t))||t,":"]}),(0,q.jsx)("span",{className:"text-gray-600 dark:text-gray-400 flex-1 break-words",children:"object"===typeof a?JSON.stringify(a,null,2):String(a)})]},t)})):(0,q.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:l("lifecycle.noDataAvailable",{defaultValue:"Keine automatisch generierten Daten verf\xfcgbar"})})})]}):null},$=e=>{var t,a,r,o,i;let{task:l}=e;const{t:d}=(0,n.Bd)(),{showMessage:c}=(0,Q.A)(),[u,m]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[b,v]=(0,s.useState)(!1);if(!((null===(t=l.title)||void 0===t?void 0:t.includes("ARL"))||(null===(a=l.title)||void 0===a?void 0:a.includes("EPS"))||(null===(r=l.title)||void 0===r?void 0:r.includes("Pension"))||(null===(o=l.title)||void 0===o?void 0:o.includes("Caja"))||(null===(i=l.description)||void 0===i?void 0:i.includes("lifecycle"))))return null;return(0,q.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,q.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,q.jsx)(D.A,{className:"h-5 w-5 mr-2"}),d("lifecycle.emailTemplate",{defaultValue:"Email-Vorlage"})]}),(0,q.jsx)("button",{onClick:async()=>{v(!0);try{const e="Sehr geehrte Damen und Herren,\n\nim Rahmen des Onboarding-Prozesses ben\xf6tigen wir die Anmeldung f\xfcr ".concat(l.title,".\n\nBitte senden Sie uns die erforderlichen Informationen zur\xfcck.\n\nMit freundlichen Gr\xfc\xdfen\nIhr Team");m(e),c(d("lifecycle.templateGenerated",{defaultValue:"Email-Vorlage generiert"}),"success")}catch(a){var e,t;console.error("Fehler beim Generieren der Email-Vorlage:",a),c((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("lifecycle.templateGenerationError",{defaultValue:"Fehler beim Generieren der Vorlage"}),"error")}finally{v(!1)}},disabled:b,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center text-sm",children:b?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(y.A,{className:"h-4 w-4 mr-2 animate-spin"}),d("common.generating",{defaultValue:"Generiere..."})]}):d("lifecycle.generateTemplate",{defaultValue:"Vorlage generieren"})})]}),u&&(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsx)("textarea",{value:u,onChange:e=>{m(e.target.value),p(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:10,placeholder:d("lifecycle.templatePlaceholder",{defaultValue:"Email-Vorlage wird hier angezeigt..."})}),(0,q.jsx)("div",{className:"flex justify-end",children:(0,q.jsx)("button",{onClick:async()=>{if(u.trim()){x(!0);try{await new Promise((e=>setTimeout(e,1e3))),p(!0),c(d("lifecycle.emailSent",{defaultValue:"Email erfolgreich versendet"}),"success")}catch(a){var e,t;console.error("Fehler beim Versenden der Email:",a),c((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("lifecycle.emailSendError",{defaultValue:"Fehler beim Versenden der Email"}),"error")}finally{x(!1)}}else c(d("lifecycle.templateRequired",{defaultValue:"Bitte generieren Sie zuerst eine Vorlage"}),"warning")},disabled:g||h,className:"p-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",title:g?d("common.sending",{defaultValue:"Sende..."}):h?d("lifecycle.emailSent",{defaultValue:"Versendet"}):d("lifecycle.sendEmail",{defaultValue:"Email versenden"}),children:g?(0,q.jsx)(y.A,{className:"h-5 w-5 animate-spin"}):h?(0,q.jsx)(V.A,{className:"h-5 w-5"}):(0,q.jsx)(F.A,{className:"h-5 w-5"})})})]}),!u&&(0,q.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-sm text-center py-4",children:d("lifecycle.noTemplate",{defaultValue:'Klicken Sie auf "Vorlage generieren" um eine Email-Vorlage zu erstellen'})})]})},X=e=>{var t,a,o,i,l;let{task:d,onComplete:c}=e;const{t:u}=(0,n.Bd)(),{showMessage:m}=(0,Q.A)(),[g,x]=(0,s.useState)({registrationNumber:"",provider:"",registrationDate:"",notes:""}),[h,p]=(0,s.useState)(!1);if(!((null===(t=d.title)||void 0===t?void 0:t.includes("ARL"))||(null===(a=d.title)||void 0===a?void 0:a.includes("EPS"))||(null===(o=d.title)||void 0===o?void 0:o.includes("Pension"))||(null===(i=d.title)||void 0===i?void 0:i.includes("Caja"))||(null===(l=d.description)||void 0===l?void 0:l.includes("lifecycle"))))return null;const b=(()=>{var e,t,a,r;return null!==(e=d.title)&&void 0!==e&&e.includes("ARL")?"arl":null!==(t=d.title)&&void 0!==t&&t.includes("EPS")?"eps":null!==(a=d.title)&&void 0!==a&&a.includes("Pension")?"pension":null!==(r=d.title)&&void 0!==r&&r.includes("Caja")?"caja":null})();return(0,q.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,q.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:u("lifecycle.completeRegistration",{defaultValue:"Anmeldung abschlie\xdfen"})}),(0,q.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(!0);try{const e=(()=>{if(d.description){const e=d.description.match(/userId[:\s]+(\d+)/i);if(e)return parseInt(e[1],10)}return d.responsibleId})();if(!e||!b)return void m(u("lifecycle.missingData",{defaultValue:"Benutzer-ID oder Sozialversicherungs-Typ fehlt"}),"error");await B.A.put(_.Sn.LIFECYCLE.SOCIAL_SECURITY(e,b),{status:"registered",registrationNumber:g.registrationNumber,provider:g.provider,registrationDate:g.registrationDate,notes:g.notes,completedAt:(new Date).toISOString()}),m(u("lifecycle.registrationCompleted",{defaultValue:"Anmeldung erfolgreich abgeschlossen"}),"success"),x({registrationNumber:"",provider:"",registrationDate:"",notes:""}),c&&c()}catch(r){var t,a;console.error("Fehler beim Abschlie\xdfen der Anmeldung:",r),m((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||u("lifecycle.registrationError",{defaultValue:"Fehler beim Abschlie\xdfen der Anmeldung"}),"error")}finally{p(!1)}},className:"space-y-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.registrationNumber",{defaultValue:"Registrierungsnummer"})," *"]}),(0,q.jsx)("input",{type:"text",value:g.registrationNumber,onChange:e=>x((0,r.A)((0,r.A)({},g),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,placeholder:u("lifecycle.registrationNumberPlaceholder",{defaultValue:"z.B. 123456789"})})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.provider",{defaultValue:"Anbieter"})," *"]}),(0,q.jsx)("input",{type:"text",value:g.provider,onChange:e=>x((0,r.A)((0,r.A)({},g),{},{provider:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,placeholder:u("lifecycle.providerPlaceholder",{defaultValue:"z.B. ARL Sura, EPS Sanitas"})})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.registrationDate",{defaultValue:"Anmeldedatum"})," *"]}),(0,q.jsx)("input",{type:"date",value:g.registrationDate,onChange:e=>x((0,r.A)((0,r.A)({},g),{},{registrationDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("lifecycle.notes",{defaultValue:"Notizen"})}),(0,q.jsx)("textarea",{value:g.notes,onChange:e=>x((0,r.A)((0,r.A)({},g),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:u("lifecycle.notesPlaceholder",{defaultValue:"Zus\xe4tzliche Informationen..."})})]}),(0,q.jsx)("div",{className:"flex justify-end",children:(0,q.jsx)("button",{type:"submit",disabled:h,className:"p-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",title:h?u("common.saving",{defaultValue:"Speichere..."}):u("lifecycle.complete",{defaultValue:"Abschlie\xdfen"}),children:h?(0,q.jsx)(y.A,{className:"h-5 w-5 animate-spin"}):(0,q.jsx)(V.A,{className:"h-5 w-5"})})})]})]})},ee=e=>{let{file:t,alt:a,blobUrlsRef:r,className:n="max-w-[200px] max-h-[150px] object-contain"}=e;const[o,i]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=URL.createObjectURL(t);return r.current.add(e),i(e),()=>{URL.revokeObjectURL(e),r.current.delete(e)}}),[t,r]),o?(0,q.jsx)("img",{src:o,alt:a,className:n}):null},te=e=>{var t,a;let{isOpen:r,onClose:o,onTaskUpdated:i,task:c}=e;const{t:u}=(0,n.Bd)(),{hasPermission:m}=(0,d.S)(),{user:g}=(0,l.As)(),{openSidepane:x,closeSidepane:h}=(0,W.N)(),[p,b]=(0,s.useState)(window.innerWidth>1070),[v,f]=(0,s.useState)(c.title||""),[k,N]=(0,s.useState)((w=c.description||"")?w.replace(/!\[([^\]]*)\]\([^)]+\)/g,"").trim():"");var w;const j=c.description||"",[S,C]=(0,s.useState)(c.status||"open"),[T,E]=(0,s.useState)(c.roleId?"role":"user"),[D,I]=(0,s.useState)(c.responsibleId||null),[R,P]=(0,s.useState)(c.roleId||null),[L,O]=(0,s.useState)((null===(t=c.qualityControl)||void 0===t?void 0:t.id)||null),[F,G]=(0,s.useState)((null===(a=c.branch)||void 0===a?void 0:a.id)||0),[H,Z]=(0,s.useState)(c.attachments||[]),[Y,Q]=(0,s.useState)([]),[te,ae]=(0,s.useState)(!1),[re,se]=(0,s.useState)([]),ne=(0,s.useRef)(null),oe=(0,s.useRef)(null),ie=(0,s.useRef)(new Set),[le,de]=(0,s.useState)((e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]})(c.dueDate)),[ce,ue]=(0,s.useState)([]),[me,ge]=(0,s.useState)([]),[xe,he]=(0,s.useState)([]),[pe,be]=(0,s.useState)(null),[ye,ve]=(0,s.useState)(!1),[fe,ke]=(0,s.useState)(!1),[Ne,we]=(0,s.useState)(window.innerWidth<640),[je,Se]=(0,s.useState)([]),[Ae,Ce]=(0,s.useState)("data"),Te=m("tasks","both","table");(0,s.useEffect)((()=>{const e=()=>{we(window.innerWidth<640),b(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,s.useEffect)((()=>()=>{ie.current.forEach((e=>{URL.revokeObjectURL(e)})),ie.current.clear()}),[]),(0,s.useEffect)((()=>{if(!r&&re.length>0){(async()=>{for(const t of re)try{await B.A.delete(_.Sn.TASKS.ATTACHMENT(c.id,t)),K.v.log("Task Attachment ".concat(t," gel\xf6scht (Modal ohne Speichern geschlossen)"))}catch(e){console.error("Fehler beim L\xf6schen von Task Attachment ".concat(t,":"),e)}se([])})()}}),[r,re,c.id]),(0,s.useEffect)((()=>(r?x():h(),()=>{h()})),[r,x,h]),(0,s.useEffect)((()=>{r&&(Ee(),De(),Ie(),Re(),Pe())}),[r,c.id]);const Ee=async()=>{try{be(null);if(!localStorage.getItem("token"))return void be("Nicht authentifiziert");const e=await B.A.get(_.Sn.USERS.DROPDOWN);ue(e.data||[])}catch(a){console.error("Fehler beim Laden der Benutzer:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)be(u("tasks.editTask.errors.connectionError"));else be("".concat(u("tasks.editTask.errors.loadUsersError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},De=async()=>{try{be(null);if(!localStorage.getItem("token"))return void be("Nicht authentifiziert");const e=await B.A.get(_.Sn.ROLES.BASE);ge(e.data||[])}catch(a){console.error("Fehler beim Laden der Rollen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)be(u("tasks.editTask.errors.connectionError"));else be("".concat(u("tasks.editTask.errors.loadRolesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},Ie=async()=>{try{be(null);if(!localStorage.getItem("token"))return void be("Nicht authentifiziert");const e=await B.A.get(_.Sn.BRANCHES.BASE);he(e.data||[])}catch(a){console.error("Fehler beim Laden der Niederlassungen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)be(u("tasks.editTask.errors.connectionError"));else be("".concat(u("tasks.editTask.errors.loadBranchesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},Re=async()=>{try{be(null);const e=await B.A.get(_.Sn.TASKS.CARTICLES(c.id));Se(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der verkn\xfcpften Artikel:",a);const r=a;be((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}},Pe=async()=>{try{be(null);const e=await B.A.get(_.Sn.TASKS.ATTACHMENTS(c.id));Z(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",a);const r=a;be((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten"),Z([])}},Le=async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++){const r=t[a];if(0===r.type.indexOf("image")){e.preventDefault();const t=r.getAsFile();return void(t&&await Be(t))}}},Oe=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await Be(t)}},Fe=e=>{e.preventDefault(),e.stopPropagation()},Be=async e=>{ae(!0),be(null);try{const t=new FormData;t.append("file",e);const a=(await B.A.post(_.Sn.TASKS.ATTACHMENTS(c.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;if(Z([...H,a]),se((e=>[...e,a.id])),!a.fileType.startsWith("image/")){const e="\n[".concat(a.fileName,"](").concat((0,_._y)(c.id,a.id),")\n");if(oe.current){const t=oe.current.selectionStart,a=k.substring(0,t),r=k.substring(t);N(a+e+r),setTimeout((()=>{if(oe.current){const a=t+e.length;oe.current.selectionStart=a,oe.current.selectionEnd=a,oe.current.focus()}}),0)}else N(k+e)}}catch(r){var t,a;console.error("Fehler beim Verarbeiten der Datei:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{ae(!1)}},ze=async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=t[0];await Be(a),ne.current&&(ne.current.value="")},Me=async e=>{e.preventDefault(),be(null),ve(!0);try{if(!v||!S||!F)return be(u("tasks.editTask.errors.fillAllFields")),void ve(!1);if("user"===T&&!D)return be(u("tasks.editTask.form.chooseUser")),void ve(!1);if("role"===T&&!R)return be(u("tasks.editTask.form.chooseRole")),void ve(!1);let e=k||"";const t=H.filter((e=>{var t;return(null===(t=e.fileType)||void 0===t?void 0:t.startsWith("image/"))&&e.id})),a=/!\[([^\]]*)\]\([^)]+\)/g,r=[];let s;if(j)for(;null!==(s=a.exec(j));)r.push(s[0]);for(const o of t){const t=(0,_._y)(c.id,o.id),a="![".concat(o.fileName,"](").concat(t,")"),r=o.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp("!\\[".concat(r,"\\]\\([^)]+\\)"),"g").test(e)||(e=e?"".concat(e,"\n").concat(a):a)}for(const o of r)e.includes(o)||(e=e?"".concat(e,"\n").concat(o):o);const n={title:v,description:e,status:S,qualityControlId:L,branchId:F,dueDate:le};"user"===T?(n.responsibleId=D,n.roleId=null):"role"===T&&(n.roleId=R,n.responsibleId=null);const l=await B.A.put("".concat(_.Sn.TASKS.BASE,"/").concat(c.id),n);K.v.log("Task aktualisiert:",l.data);const d=await B.A.get(_.Sn.TASKS.BY_ID(c.id));d.data.attachments?d.data.attachments=d.data.attachments.map((e=>({id:e.id,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,filePath:e.filePath,uploadedAt:e.uploadedAt,url:(0,_._y)(c.id,e.id)}))):d.data.attachments=[],se([]),i(d.data),o()}catch(r){var t,a;console.error("Fehler beim Aktualisieren des Tasks:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{ve(!1)}},Ve=async()=>{if(fe)try{if(!localStorage.getItem("token"))return void be("Nicht authentifiziert");await B.A.delete(_.Sn.TASKS.BY_ID(c.id)),i(void 0),o()}catch(a){var e,t;console.error("Delete Error:",a);const r=a;be((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}else ke(!0)},_e=async e=>{try{be(null),await B.A.post(_.Sn.TASKS.LINK_CARTICLE(c.id,e.id)),Se((t=>[...t,e]))}catch(r){var t,a;console.error("Fehler beim Verkn\xfcpfen des Artikels:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},qe=async e=>{try{be(null),await B.A.delete(_.Sn.TASKS.UNLINK_CARTICLE(c.id,e)),Se((t=>t.filter((t=>t.id!==e))))}catch(r){var t,a;console.error("Fehler beim Entfernen der Artikelverkn\xfcpfung:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Ue=()=>{var e,t,a,r,s;return(0,q.jsxs)("form",{onSubmit:Me,className:"space-y-4",children:[(0,q.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,q.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,q.jsx)("button",{type:"button",className:"".concat("data"===Ae?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>Ce("data"),children:u("tasks.editTask.tabs.data")}),(0,q.jsx)("button",{type:"button",className:"".concat("cerebro"===Ae?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>Ce("cerebro"),children:u("tasks.editTask.tabs.cerebro")})]})}),"data"===Ae&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.title")}),(0,q.jsx)("input",{type:"text",id:"title",value:v,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"description_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.description")}),(0,q.jsxs)("div",{className:"relative",children:[(0,q.jsx)("textarea",{ref:oe,id:"description_edit",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:k,onChange:e=>N(e.target.value),onPaste:Le,onDrop:Oe,onDragOver:Fe,placeholder:u("tasks.editTask.form.descriptionPlaceholder")}),(0,q.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,q.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ne.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.fileUpload")})]}),(0,q.jsx)("input",{ref:ne,type:"file",onChange:ze,className:"hidden"}),te&&(0,q.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,q.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("tasks.editTask.form.uploading")})})]}),We(),Ke()]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.status")}),(0,q.jsxs)("select",{id:"status",value:S,onChange:e=>C(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,q.jsx)("option",{value:"open",children:u("tasks.status.open")}),(0,q.jsx)("option",{value:"in_progress",children:u("tasks.status.in_progress")}),(0,q.jsx)("option",{value:"improval",children:u("tasks.status.improval")}),(0,q.jsx)("option",{value:"quality_control",children:u("tasks.status.quality_control")}),(0,q.jsx)("option",{value:"done",children:u("tasks.status.done")})]})]}),(0,q.jsxs)("div",{className:"space-y-2",children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleFor")," *"]}),(0,q.jsxs)("div",{className:"flex space-x-4",children:[(0,q.jsxs)("label",{className:"inline-flex items-center",children:[(0,q.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===T,onChange:()=>{E("user"),P(null)}}),(0,q.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.user")})]}),(0,q.jsxs)("label",{className:"inline-flex items-center",children:[(0,q.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===T,onChange:()=>{E("role"),I(null)}}),(0,q.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.role")})]})]})]}),"user"===T?(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleUser")," *"]}),(0,q.jsxs)("select",{id:"responsible",value:null===D?"":D,onChange:e=>I(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"user"===T,children:[(0,q.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(ce)&&ce.map((e=>(0,q.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleRole")," *"]}),(0,q.jsxs)("select",{id:"role",value:null===R?"":R,onChange:e=>P(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"role"===T,children:[(0,q.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(me)&&me.map((e=>(0,q.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.qualityControl")}),(0,q.jsxs)("select",{id:"qualityControl",value:null===L?"":L,onChange:e=>O(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,q.jsx)("option",{value:"",children:u("tasks.editTask.form.noQualityControl")}),Array.isArray(ce)&&ce.map((e=>(0,q.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.branch")}),(0,q.jsxs)("select",{id:"branch",value:0===F?"":F,onChange:e=>G(e.target.value?Number(e.target.value):0),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,q.jsx)("option",{value:"",children:u("common.pleaseSelect")}),Array.isArray(xe)&&xe.map((e=>(0,q.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.dueDate")}),(0,q.jsx)("input",{type:"date",id:"dueDate",value:le||"",onChange:e=>{e.target.value?de(e.target.value):de(null)},className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===Ae&&(0,q.jsxs)("div",{children:[je.length>0&&(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:u("tasks.editTask.form.linkedCerebroArticles")}),(0,q.jsx)("ul",{className:"space-y-2",children:je.map((e=>(0,q.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,q.jsx)("a",{href:"/cerebro/articles/".concat(e.slug),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:e.title}),(0,q.jsx)("button",{type:"button",onClick:()=>qe(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:u("tasks.editTask.form.remove")})]},e.id)))})]}),(0,q.jsx)(U,{onArticleSelected:_e,excludeArticleIds:je.map((e=>e.id)),selectedArticles:je,onArticleRemove:qe})]}),"data"===Ae&&((null===(e=c.title)||void 0===e?void 0:e.includes("ARL"))||(null===(t=c.title)||void 0===t?void 0:t.includes("EPS"))||(null===(a=c.title)||void 0===a?void 0:a.includes("Pension"))||(null===(r=c.title)||void 0===r?void 0:r.includes("Caja"))||(null===(s=c.description)||void 0===s?void 0:s.includes("lifecycle")))&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(J,{task:c}),(0,q.jsx)($,{task:c}),(0,q.jsx)(X,{task:c,onComplete:()=>{}})]}),(0,q.jsxs)("div",{className:"flex justify-between pt-4",children:[Te&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{type:"button",onClick:Ve,className:"p-2 rounded-md ".concat(fe?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),children:fe?(0,q.jsx)(V.A,{className:"h-5 w-5"}):(0,q.jsx)(A.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u(fe?"tasks.editTask.form.confirmDelete":"tasks.editTask.form.delete")})]}),(0,q.jsxs)("div",{className:"flex gap-2",children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{type:"button",onClick:o,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.cancel")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:ye,children:ye?(0,q.jsx)(y.A,{className:"h-5 w-5 animate-spin"}):(0,q.jsx)(V.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u(ye?"tasks.editTask.form.saving":"tasks.editTask.form.save")})]})]})]})]})},We=()=>0===H.length?null:(0,q.jsx)("div",{className:"mt-2",children:(0,q.jsx)("ul",{className:"flex flex-wrap gap-2",children:H.map((e=>(0,q.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,q.jsxs)("div",{className:"flex ml-2",children:[(0,q.jsxs)("div",{className:"relative group mr-1",children:[(0,q.jsx)("button",{type:"button",onClick:()=>(async e=>{try{const t=await B.A.get(_.Sn.TASKS.ATTACHMENT(c.id,e.id),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download",e.fileName),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}catch(r){var t,a;console.error("Fehler beim Herunterladen des Anhangs:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.download")})]}),(0,q.jsxs)("div",{className:"relative group ml-1",children:[(0,q.jsx)("button",{type:"button",onClick:()=>(async e=>{try{be(null);const t=H.find((t=>t.id===e));if(t&&(await B.A.delete(_.Sn.TASKS.ATTACHMENT(c.id,e)),Z(H.filter((t=>t.id!==e))),t.fileName)){const t=(0,_._y)(c.id,e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp("!\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),r=new RegExp("\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),s=k.replace(a,"").replace(r,"").replace(/\n{3,}/g,"\n\n");N(s)}}catch(r){var t,a;console.error("Fehler beim L\xf6schen des Anhangs:",r);const e=r;be((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.remove")})]})]}),e.fileType.startsWith("image/")&&(0,q.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,q.jsx)("img",{src:(0,_._y)(c.id,e.id),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id)))})}),Ke=()=>0===Y.length?null:(0,q.jsx)("div",{className:"mt-2",children:(0,q.jsx)("ul",{className:"flex flex-wrap gap-2",children:Y.map(((e,t)=>{var a;return(0,q.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,q.jsx)("div",{className:"flex ml-2",children:(0,q.jsxs)("div",{className:"relative group ml-1",children:[(0,q.jsx)("button",{type:"button",onClick:()=>(e=>{const t=Y[e];if(t&&(Q(Y.filter(((t,a)=>a!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=u("tasks.editTask.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=k.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");N(n)}})(t),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.remove")})]})}),(null===(a=e.fileType)||void 0===a?void 0:a.startsWith("image/"))&&e.file&&(0,q.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,q.jsx)(ee,{file:e.file,alt:e.fileName,blobUrlsRef:ie})})]},"temp-".concat(t))}))})});return r?Ne?(0,q.jsxs)(z.lG,{open:r,onClose:o,className:"relative z-50",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,q.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,q.jsxs)(z.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,q.jsx)(z.lG.Title,{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,q.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsxs)("div",{className:"p-4",children:[pe&&(0,q.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:pe}),Ue()]})]})})]}):(0,q.jsxs)(q.Fragment,{children:[r&&!p&&(0,q.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:o,style:{opacity:r?1:0,transition:"opacity 300ms ease-out"}}),(0,q.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(r?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:r?"auto":"none"},"aria-hidden":!r,role:"dialog","aria-modal":r,children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,q.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[pe&&(0,q.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:pe}),Ue()]})]})]}):null};var ae=a(4450);const re=e=>{let{isOpen:t,onClose:a,onReservationCreated:r}=e;const{t:o}=(0,n.Bd)(),{showMessage:i}=(0,Q.A)(),{openSidepane:l,closeSidepane:d}=(0,W.N)(),[c,u]=(0,s.useState)(window.innerWidth<640),[m,g]=(0,s.useState)(window.innerWidth>1070),[x,h]=(0,s.useState)(""),[p,b]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[f,k]=(0,s.useState)("COP"),[N,w]=(0,s.useState)(null),[j,S]=(0,s.useState)(null),[A,C]=(0,s.useState)(!1),T=e=>{const t=e.target.value;b(t),w((e=>e&&0!==e.trim().length?e.includes("@")&&e.includes(".")?"email":"phone":null)(t))},E=e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&v(t)};(0,s.useEffect)((()=>{const e=()=>{u(window.innerWidth<640),g(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!c?l():d(),()=>{d()})),[t,c,l,d]),(0,s.useEffect)((()=>{t||(h(""),b(""),v(""),k("COP"),w(null),S(null))}),[t]);const D=async e=>{if(e.preventDefault(),S(null),x&&0!==x.trim().length)if(p&&0!==p.trim().length)if(!y||parseFloat(y)<=0)S(o("reservations.createReservation.errors.amountRequired","Betrag muss eine positive Zahl sein"));else try{C(!0);const e={guestName:x.trim(),contact:p.trim(),amount:parseFloat(y),currency:f};K.v.log("[CreateReservationModal] Sende Daten:",e),K.v.log("[CreateReservationModal] API Endpoint:","/api/reservations");const t=await ae.u.create(e);K.v.log("[CreateReservationModal] Reservierung erstellt:",t),i(o("reservations.createReservation.success","Reservierung erfolgreich erstellt"),"success"),r(t),a()}catch(d){var t,s,n,l;console.error("[CreateReservationModal] Fehler beim Erstellen der Reservierung:",d),console.error("[CreateReservationModal] Error Response:",d.response),console.error("[CreateReservationModal] Error Status:",null===(t=d.response)||void 0===t?void 0:t.status),console.error("[CreateReservationModal] Error Data:",null===(s=d.response)||void 0===s?void 0:s.data);const e=(null===(n=d.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.message)||d.message||o("reservations.createReservation.errors.createError","Fehler beim Erstellen der Reservierung");S(e),i(e,"error")}finally{C(!1)}else S(o("reservations.createReservation.errors.contactRequired","Kontaktinformation ist erforderlich"));else S(o("reservations.createReservation.errors.guestNameRequired","Gast-Name ist erforderlich"))},I=()=>{a()};return c?(0,q.jsxs)(z.lG,{open:t,onClose:I,className:"relative z-50",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,q.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,q.jsx)(z.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,q.jsxs)("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,q.jsx)(z.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("reservations.createReservation.title","Neue Reservierung")}),(0,q.jsx)("button",{onClick:I,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),j&&(0,q.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:j}),(0,q.jsxs)("form",{onSubmit:D,children:[(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsxs)("label",{htmlFor:"guestName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.guestName","Gast-Name")," *"]}),(0,q.jsx)("input",{type:"text",id:"guestName",value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsxs)("label",{htmlFor:"contact",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.contact","Telefonnummer oder Email")," *"]}),(0,q.jsx)("input",{type:"text",id:"contact",value:p,onChange:T,placeholder:o("reservations.createReservation.contactPlaceholder","z.B. +573001234567 oder email@example.com"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),N&&(0,q.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"email"===N?o("reservations.createReservation.detectedEmail","Email erkannt"):o("reservations.createReservation.detectedPhone","Telefonnummer erkannt")})]}),(0,q.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.amount","Betrag")," *"]}),(0,q.jsx)("input",{type:"text",id:"amount",value:y,onChange:E,placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("reservations.createReservation.currency","W\xe4hrung")}),(0,q.jsxs)("select",{id:"currency",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",children:[(0,q.jsx)("option",{value:"COP",children:"COP"}),(0,q.jsx)("option",{value:"USD",children:"USD"}),(0,q.jsx)("option",{value:"EUR",children:"EUR"})]})]})]}),(0,q.jsx)("p",{className:"mb-4 text-sm text-gray-500 dark:text-gray-400",children:o("reservations.createReservation.hint","Nach der Erstellung wird automatisch eine WhatsApp-Nachricht mit Zahlungslink versendet (wenn Telefonnummer angegeben).")}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,q.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:o("common.cancel","Abbrechen")}),(0,q.jsx)("button",{type:"submit",disabled:A,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:A?o("common.creating","Wird erstellt..."):o("common.create","Erstellen")})]})]})]})})})]}):(0,q.jsxs)(q.Fragment,{children:[t&&!m&&(0,q.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,q.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("reservations.createReservation.title","Neue Reservierung")}),(0,q.jsx)("button",{onClick:I,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[j&&(0,q.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:j}),(0,q.jsxs)("form",{onSubmit:D,children:[(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsxs)("label",{htmlFor:"guestName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.guestName","Gast-Name")," *"]}),(0,q.jsx)("input",{type:"text",id:"guestName",value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsxs)("label",{htmlFor:"contact",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.contact","Telefonnummer oder Email")," *"]}),(0,q.jsx)("input",{type:"text",id:"contact",value:p,onChange:T,placeholder:o("reservations.createReservation.contactPlaceholder","z.B. +573001234567 oder email@example.com"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),N&&(0,q.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"email"===N?o("reservations.createReservation.detectedEmail","Email erkannt"):o("reservations.createReservation.detectedPhone","Telefonnummer erkannt")})]}),(0,q.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.amount","Betrag")," *"]}),(0,q.jsx)("input",{type:"text",id:"amount",value:y,onChange:E,placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("reservations.createReservation.currency","W\xe4hrung")}),(0,q.jsxs)("select",{id:"currency",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",children:[(0,q.jsx)("option",{value:"COP",children:"COP"}),(0,q.jsx)("option",{value:"USD",children:"USD"}),(0,q.jsx)("option",{value:"EUR",children:"EUR"})]})]})]}),(0,q.jsx)("p",{className:"mb-4 text-sm text-gray-500 dark:text-gray-400",children:o("reservations.createReservation.hint","Nach der Erstellung wird automatisch eine WhatsApp-Nachricht mit Zahlungslink versendet (wenn Telefonnummer angegeben).")}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,q.jsx)("button",{type:"button",onClick:I,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel","Abbrechen"),children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("button",{type:"submit",disabled:A,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:A?o("common.creating","Wird erstellt..."):o("common.create","Erstellen"),children:(0,q.jsx)(V.A,{className:"h-5 w-5"})})]})]})]})]})]})};var se=a(7539);const ne=e=>{var t;let{isOpen:a,onClose:r,booking:o,onBookingUpdated:i}=e;const{t:d}=(0,n.Bd)(),{user:c}=(0,l.As)(),{showMessage:u}=(0,Q.A)(),[m,g]=(0,s.useState)(""),[x,h]=(0,s.useState)(1),[p,b]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[f,k]=(0,s.useState)(""),[N,w]=(0,s.useState)(""),[j,S]=(0,s.useState)(null),[A,C]=(0,s.useState)(null),[T,E]=(0,s.useState)(!1),[D,I]=(0,s.useState)(!0);(0,s.useEffect)((()=>{a&&o&&(async()=>{if(null!==o&&void 0!==o&&o.tourId)try{var e;I(!0);const t=await B.A.get(_.Sn.TOURS.BY_ID(o.tourId));null!==(e=t.data)&&void 0!==e&&e.success&&S(t.data.data)}catch(t){console.error("Error loading tour:",t)}finally{I(!1)}})()}),[a,o]),(0,s.useEffect)((()=>{if(o){const e=new Date(o.tourDate),t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");g("".concat(t,"-").concat(a,"-").concat(r,"T").concat(s,":").concat(n)),h(o.numberOfParticipants),b(o.customerName||""),v(o.customerEmail||""),k(o.customerPhone||""),w(o.customerNotes||"")}else g(""),h(1),b(""),v(""),k(""),w("");C(null)}),[o,a]);return o?(0,q.jsxs)(z.lG,{open:a,onClose:r,className:"relative z-50",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,q.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,q.jsxs)(z.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,q.jsx)(z.lG.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:d("tourBookings.edit",{defaultValue:"Tour-Buchung bearbeiten"})}),(0,q.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!o)return;if(C(null),!m)return void C(d("tourBookings.validation.tourDateRequired",{defaultValue:"Tour-Datum ist erforderlich"}));if(new Date(m)<new Date)C(d("tours.validation.tourDateFuture",{defaultValue:"Tour-Datum muss in der Zukunft liegen"}));else if(!x||Number(x)<1)C(d("tourBookings.validation.numberOfParticipantsMin",{defaultValue:"Anzahl Teilnehmer muss >= 1 sein"}));else if(!p.trim()||p.trim().length<2)C(d("tourBookings.validation.customerNameMinLength",{defaultValue:"Kundenname muss mindestens 2 Zeichen lang sein"}));else if(f.trim()||y.trim()){if(j){const e=Number(x);if(j.minParticipants&&e<j.minParticipants)return void C(d("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:j.minParticipants,max:j.maxParticipants||"\u221e"}));if(j.maxParticipants&&e>j.maxParticipants)return void C(d("tours.validation.numberOfParticipantsRange",{defaultValue:"Anzahl der Teilnehmer muss zwischen {min} und {max} sein",min:j.minParticipants||1,max:j.maxParticipants}))}E(!0);try{var t,a;const e=await B.A.put(_.Sn.TOUR_BOOKINGS.BY_ID(o.id),{tourDate:m,numberOfParticipants:Number(x),customerName:p.trim(),customerEmail:y.trim()||null,customerPhone:f.trim()||null,customerNotes:N.trim()||null});var s;if(null===(t=e.data)||void 0===t||!t.success||null===(a=e.data)||void 0===a||!a.data)throw new Error((null===(s=e.data)||void 0===s?void 0:s.message)||d("tours.bookings.updateError",{defaultValue:"Fehler beim Aktualisieren der Buchung"}));u(d("tourBookings.updated",{defaultValue:"Tour-Buchung erfolgreich aktualisiert"}),"success"),i(e.data.data),r()}catch(c){var n,l;console.error("Error updating booking:",c);const e=(null===c||void 0===c||null===(n=c.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.message)||(null===c||void 0===c?void 0:c.message)||d("errors.unknownError");C(e),u(e,"error")}finally{E(!1)}}else C(d("tourBookings.validation.contactRequired",{defaultValue:"Mindestens eine Kontaktinformation (Telefon oder E-Mail) ist erforderlich"}))},className:"p-4 space-y-4",children:[A&&(0,q.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,q.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:A})}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tourBookings.tour",{defaultValue:"Tour"})}),(0,q.jsx)("input",{type:"text",value:(null===(t=o.tour)||void 0===t?void 0:t.title)||"",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 cursor-not-allowed",disabled:!0})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tourBookings.tourDate",{defaultValue:"Tour-Datum"})," *"]}),(0,q.jsx)("input",{type:"datetime-local",value:m,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:T||D})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tourBookings.numberOfParticipants",{defaultValue:"Anzahl Teilnehmer"})," *"]}),(0,q.jsx)("input",{type:"number",min:(null===j||void 0===j?void 0:j.minParticipants)||1,max:(null===j||void 0===j?void 0:j.maxParticipants)||void 0,value:x,onChange:e=>h(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:T||D})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("tourBookings.customerName",{defaultValue:"Kundenname"})," *"]}),(0,q.jsx)("input",{type:"text",value:p,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:T||D})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tourBookings.customerPhone",{defaultValue:"Telefon"})}),(0,q.jsx)("input",{type:"tel",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:T||D})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tourBookings.customerEmail",{defaultValue:"E-Mail"})}),(0,q.jsx)("input",{type:"email",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:T||D})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d("tourBookings.customerNotes",{defaultValue:"Notizen"})}),(0,q.jsx)("textarea",{value:N,onChange:e=>w(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:T||D})]}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,q.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:d("common.cancel","Abbrechen"),children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("button",{type:"submit",disabled:T||D,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:T?d("common.saving","Speichere..."):d("common.save","Speichern"),children:(0,q.jsx)(V.A,{className:"h-5 w-5"})})]})]})]})})]}):null},oe=e=>{let{isOpen:t,onClose:a,booking:r,onLinked:o}=e;const{t:i}=(0,n.Bd)(),{showMessage:l}=(0,Q.A)(),[d,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),[v,f]=(0,s.useState)(!1),[k,N]=(0,s.useState)([]);(0,s.useEffect)((()=>{t&&r&&(w(),j(),r.totalPrice&&x("string"===typeof r.totalPrice?parseFloat(r.totalPrice):r.totalPrice))}),[t,r]);const w=async()=>{try{f(!0);const e=await B.A.get(_.Sn.RESERVATION.BASE);if(e.data.success||Array.isArray(e.data)){const t=e.data.success?e.data.data:e.data;c(Array.isArray(t)?t:[])}}catch(e){console.error("Error loading reservations:",e),l(i("errors.loadError"),"error")}finally{f(!1)}},j=async()=>{if(r)try{const e=await B.A.get(_.Sn.TOUR_RESERVATIONS.BY_BOOKING(r.id));e.data.success&&N(e.data.data||[])}catch(e){console.error("Fehler beim Laden der Verkn\xfcpfungen:",e)}};if(!t||!r)return null;const S=d.find((e=>e.id===Number(u))),A=null!==S&&void 0!==S&&S.amount?Number(S.amount):0,C=(Number(g)||0)+(Number(h)||0),T=C<=A&&C>0;return(0,q.jsxs)(z.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,q.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,q.jsxs)(z.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,q.jsxs)(z.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[(0,q.jsx)(R.A,{className:"h-6 w-6"}),i("tours.reservationLink.title","Tour mit Reservation verkn\xfcpfen")]}),(0,q.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),r&&u&&g&&h){y(!0);try{const e=await B.A.post(_.Sn.TOUR_RESERVATIONS.BASE,{tourId:r.tourId,bookingId:r.id,reservationId:u,tourPrice:Number(g),accommodationPrice:Number(h),currency:r.currency||"COP"});e.data.success?(l(i("tours.reservationLink.success","Verkn\xfcpfung erfolgreich erstellt"),"success"),o(),a()):l(e.data.message||i("errors.saveError"),"error")}catch(n){var t,s;console.error("Error creating link:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||i("errors.saveError");l(e,"error")}finally{y(!1)}}else l(i("tours.reservationLink.fillAllFields","Bitte f\xfcllen Sie alle Felder aus"),"error")},className:"p-6 space-y-6",children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("tours.reservationLink.reservation","Reservation")," *"]}),(0,q.jsxs)("select",{value:u,onChange:e=>{m(e.target.value?Number(e.target.value):"");const t=d.find((t=>t.id===Number(e.target.value)));if(null!==t&&void 0!==t&&t.amount){const e=Number(t.amount),a=Number(g)||0;p(e-a)}},required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",disabled:v,children:[(0,q.jsx)("option",{value:"",children:i("common.select","Ausw\xe4hlen")}),d.map((e=>(0,q.jsxs)("option",{value:e.id,children:[e.guestName," - ",e.checkInDate," bis ",e.checkOutDate," (",Number(e.amount||0).toLocaleString()," ",e.currency||"COP",")"]},e.id)))]}),S&&(0,q.jsxs)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i("tours.reservationLink.reservationAmount","Reservationsbetrag"),": ",A.toLocaleString()," ",S.currency||"COP"]})]}),(0,q.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("tours.reservationLink.tourPrice","Tour-Preis")," *"]}),(0,q.jsx)("input",{type:"number",value:g,onChange:e=>x(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("tours.reservationLink.accommodationPrice","Betten-Preis")," *"]}),(0,q.jsx)("input",{type:"number",value:h,onChange:e=>p(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),S&&(0,q.jsx)("div",{className:"p-3 rounded-md ".concat(T?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"),children:(0,q.jsxs)("p",{className:"text-sm ".concat(T?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"),children:[i("tours.reservationLink.totalPrice","Gesamtpreis"),": ",C.toLocaleString()," ",r.currency||"COP",!T&&C>A&&(0,q.jsx)("span",{className:"block mt-1",children:i("tours.reservationLink.exceedsAmount","\xdcberschreitet Reservationsbetrag")})]})}),k.length>0&&(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("tours.reservationLink.existingLinks","Bestehende Verkn\xfcpfungen")}),(0,q.jsx)("div",{className:"space-y-2",children:k.map((e=>{var t;return(0,q.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("p",{className:"text-sm font-medium dark:text-white",children:(null===(t=e.reservation)||void 0===t?void 0:t.guestName)||"Reservation #".concat(e.reservationId)}),(0,q.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tour: ",Number(e.tourPrice||0).toLocaleString()," ",e.currency," | Betten: ",Number(e.accommodationPrice||0).toLocaleString()," ",e.currency]})]}),(0,q.jsx)("button",{type:"button",onClick:()=>(async e=>{if(window.confirm(i("tours.reservationLink.confirmDelete","M\xf6chten Sie diese Verkn\xfcpfung wirklich l\xf6schen?")))try{const t=await B.A.delete(_.Sn.TOUR_RESERVATIONS.BY_ID(e));t.data.success?(l(i("tours.reservationLink.deleted","Verkn\xfcpfung gel\xf6scht"),"success"),j(),o()):l(t.data.message||i("errors.deleteError"),"error")}catch(r){var t,a;console.error("Error deleting link:",r);const e=(null===r||void 0===r||null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("errors.deleteError");l(e,"error")}})(e.id),className:"px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-md",children:i("common.delete","L\xf6schen")})]},e.id)}))})]}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,q.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:i("common.cancel","Abbrechen")}),(0,q.jsx)("button",{type:"submit",disabled:b||!T||!u,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:b?i("common.saving","Wird gespeichert..."):i("common.save","Speichern")})]})]})]})})]})};class ie{static getLanguageForCountry(e){if(!e)return"es";const t=e.toLowerCase().trim().replace(/\s+/g," ");if(this.COUNTRY_LANGUAGE_MAP[t])return this.COUNTRY_LANGUAGE_MAP[t];for(const[a,r]of Object.entries(this.COUNTRY_LANGUAGE_MAP))if(t.includes(a)||a.includes(t))return r;return"es"}static getLanguageForReservation(e){if(e.guestNationality){return this.getLanguageForCountry(e.guestNationality)}return"es"}}ie.COUNTRY_LANGUAGE_MAP={colombia:"es",colombie:"es",mexico:"es","m\xe9xico":"es",argentina:"es",spain:"es","espa\xf1a":"es",espana:"es",chile:"es",peru:"es","per\xfa":"es",venezuela:"es",ecuador:"es",bolivia:"es",paraguay:"es",uruguay:"es","costa rica":"es",panama:"es","panam\xe1":"es",nicaragua:"es",honduras:"es",guatemala:"es","el salvador":"es","republica dominicana":"es","rep\xfablica dominicana":"es",cuba:"es","puerto rico":"es","united states":"en",usa:"en","united kingdom":"en",uk:"en",canada:"en",australia:"en","new zealand":"en","south africa":"en",ireland:"en",singapore:"en",philippines:"en",filipinas:"en",germany:"en",alemania:"en",deutschland:"en",switzerland:"es",suiza:"es",schweiz:"es",austria:"en","\xf6sterreich":"en",france:"en",francia:"en",frankreich:"en",belgium:"en","b\xe9lgica":"en",belgien:"en",belgique:"en",italy:"en",italia:"en",italien:"en",brazil:"en",brasil:"en",brasilien:"en",portugal:"en",netherlands:"en",holanda:"en",niederlande:"en",poland:"en",polonia:"en",polen:"en",russia:"en",rusia:"en",russland:"en",china:"en",japan:"en","jap\xf3n":"en",korea:"en",corea:"en",india:"en",turkey:"en","turqu\xeda":"en","t\xfcrkei":"en",egypt:"en",egipto:"en","\xe4gypten":"en",bielorrusia:"en",belarus:"en"};const le=e=>{let{isOpen:t,onClose:a,reservation:r,onSuccess:o}=e;const{t:i}=(0,n.Bd)(),{showMessage:l}=(0,Q.A)(),{openSidepane:d,closeSidepane:c}=(0,W.N)(),[u,m]=(0,s.useState)(window.innerWidth<640),[g,x]=(0,s.useState)(window.innerWidth>1070),[h,p]=(0,s.useState)(r.guestPhone||""),[b,y]=(0,s.useState)(r.guestEmail||""),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(!1),[w,j]=(0,s.useState)(null),[S,A]=(0,s.useState)(""),C=()=>"en"===ie.getLanguageForReservation({guestNationality:r.guestNationality})?"Hello {{guestName}},\n\nWe are pleased to welcome you to La Familia Hostel! \ud83c\udf8a\n\nIn case that you arrive after 18:00 or before 09:00, our recepcion \ud83d\udece\ufe0f will be closed.\n\nWe would then kindly ask you to complete check-in & payment online in advance:\n\nCheck-In:\n\n{{checkInLink}}\n\nPlease make the payment in advance:\n\n{{paymentLink}}\n\nPlease write us briefly once you have completed both the check-in and the payment, so we can send you your pin code \ud83d\udd11 for the entrance door.\n\nThank you!\n\nWe look forward to seeing you soon!":"Hola {{guestName}},\n\n\xa1Nos complace darte la bienvenida a La Familia Hostel! \ud83c\udf8a\n\nEn caso de que llegues despu\xe9s de las 18:00 o antes de las 09:00, nuestra recepci\xf3n \ud83d\udece\ufe0f estar\xe1 cerrada.\n\nTe pedimos amablemente que completes el check-in y el pago en l\xednea con anticipaci\xf3n:\n\nCheck-In:\n\n{{checkInLink}}\n\nPor favor, realiza el pago por adelantado:\n\n{{paymentLink}}\n\nPor favor, escr\xedbenos brevemente una vez que hayas completado tanto el check-in como el pago, para que podamos enviarte tu c\xf3digo PIN \ud83d\udd11 para la puerta de entrada.\n\n\xa1Gracias!\n\n\xa1Esperamos verte pronto!";(0,s.useEffect)((()=>{t&&!v&&f(C())}),[t,r]),(0,s.useEffect)((()=>{if(v){const e=ie.getLanguageForReservation({guestNationality:r.guestNationality}),t=r.guestEmail||"";let a="[Check-in-Link wird generiert]";if(t){const s=r.lobbyReservationId||r.id.toString(),n="https://app.lobbypms.com/checkinonline/confirmar",o=new URLSearchParams;o.append("codigo",s),o.append("email",t),o.append("lg","en"===e?"GB":"ES"),a="".concat(n,"?").concat(o.toString())}const s=r.paymentLink||"[Zahlungslink wird erstellt]";let n=v.replace(/\{\{guestName\}\}/g,r.guestName).replace(/\{\{checkInLink\}\}/g,a).replace(/\{\{paymentLink\}\}/g,s);A(n)}}),[v,r.guestName,r.paymentLink,r.id,r.guestEmail,r.guestNationality]),(0,s.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),x(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!u?d():c(),()=>{c()})),[t,u,d,c]),(0,s.useEffect)((()=>{t||(p(r.guestPhone||""),y(r.guestEmail||""),f(""),j(null),A(""))}),[t,r]);const T=()=>{j(null),a()},E=async e=>{if(e.preventDefault(),j(null),h||b)try{N(!0),await ae.u.sendInvitation(r.id,{guestPhone:h||void 0,guestEmail:b||void 0,customMessage:v||void 0}),l(i("reservations.sendInvitation.success","Einladung erfolgreich versendet"),"success"),o(),T()}catch(s){var t,a;console.error("Fehler beim Versenden der Einladung:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("reservations.sendInvitation.error","Fehler beim Versenden der Einladung");j(e),l(e,"error")}finally{N(!1)}else j(i("reservations.sendInvitation.noContact","Bitte geben Sie mindestens eine Telefonnummer oder E-Mail-Adresse an."))},D=r.sentMessageAt;return u?(0,q.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto ".concat(t?"":"hidden"),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,q.jsxs)("div",{className:"flex min-h-screen items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:T}),(0,q.jsxs)("div",{className:"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("reservations.sendInvitation.title","Einladung senden")}),(0,q.jsx)("button",{onClick:T,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(100vh-200px)]",children:I()})]})]})}):(0,q.jsxs)(q.Fragment,{children:[t&&!g&&(0,q.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,q.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("reservations.sendInvitation.title","Einladung senden")}),(0,q.jsx)("button",{onClick:T,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:I()})]})]});function I(){return(0,q.jsxs)(q.Fragment,{children:[w&&(0,q.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:w}),D&&(0,q.jsxs)("div",{className:"mb-4 p-3 bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-200 rounded",children:[(0,q.jsxs)("p",{className:"text-sm",children:[i("reservations.sendInvitation.alreadySent","Bereits versendet am"),": ",new Date(r.sentMessageAt).toLocaleString()]}),(0,q.jsx)("p",{className:"text-xs mt-1",children:i("reservations.sendInvitation.canResend","Sie k\xf6nnen die Einladung erneut senden.")})]}),(0,q.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:i("reservations.sendInvitation.contactInfo","Kontaktinformationen")}),(0,q.jsxs)("div",{className:"space-y-3",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"guestPhone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.phone","Telefonnummer")}),(0,q.jsx)("input",{type:"tel",id:"guestPhone",value:h,onChange:e=>p(e.target.value),placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"guestEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.email","E-Mail")}),(0,q.jsx)("input",{type:"email",id:"guestEmail",value:b,onChange:e=>y(e.target.value),placeholder:"email@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:i("reservations.sendInvitation.message","Nachricht")}),(0,q.jsxs)("div",{className:"space-y-3",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"customMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.sendInvitation.messageLabel","Nachricht (editierbar)")}),(0,q.jsx)("textarea",{id:"customMessage",value:v,onChange:e=>f(e.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white font-mono text-xs",placeholder:C()}),(0,q.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:i("reservations.sendInvitation.messageVariables","Verf\xfcgbare Variablen: {{guestName}}, {{checkInLink}}, {{paymentLink}}")})]}),S&&(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.sendInvitation.preview","Vorschau")}),(0,q.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:S})]})]})]}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700",children:[(0,q.jsx)("button",{type:"button",onClick:T,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel","Abbrechen"),children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("button",{type:"submit",disabled:k||!h&&!b,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:k?i("reservations.sendInvitation.sending","Wird gesendet..."):i("reservations.sendInvitation.send","Senden"),children:(0,q.jsx)(F.A,{className:"h-5 w-5"})})]})]})]})}},de=e=>{let{isOpen:t,onClose:a,reservation:r,onSuccess:o}=e;const{t:i}=(0,n.Bd)(),{showMessage:l}=(0,Q.A)(),{openSidepane:d,closeSidepane:c}=(0,W.N)(),[u,m]=(0,s.useState)(window.innerWidth<640),[g,x]=(0,s.useState)(window.innerWidth>1070),[h,p]=(0,s.useState)(r.guestPhone||""),[b,y]=(0,s.useState)(r.guestEmail||""),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(!1),[w,j]=(0,s.useState)(null),[S,A]=(0,s.useState)(""),[C,T]=(0,s.useState)(null),E=()=>"en"===ie.getLanguageForReservation({guestNationality:r.guestNationality})?"Welcome,\n\nHello {{guestName}},\n\nYour check-in has been completed successfully!\n\nYour room information:\n- Room: {{roomNumber}}\n- Description: {{roomDescription}}\n\nAccess:\n- Door PIN: {{passcode}}\n\nWe wish you a pleasant stay!":"Bienvenido,\n\nHola {{guestName}},\n\n\xa1Tu check-in se ha completado exitosamente!\n\nInformaci\xf3n de tu habitaci\xf3n:\n- Habitaci\xf3n: {{roomNumber}}\n- Descripci\xf3n: {{roomDescription}}\n\nAcceso:\n- PIN de la puerta: {{passcode}}\n\n\xa1Te deseamos una estancia agradable!";(0,s.useEffect)((()=>{let e=!0;return t&&(async()=>{if(r.categoryId&&r.branchId)try{const t=await B.A.get(_.Sn.BRANCHES.ROOM_DESCRIPTION(r.branchId,r.categoryId));if(!e)return;const a=t.data;if(a){const t=ie.getLanguageForReservation({guestNationality:r.guestNationality}),s="en"===t?"Image":"es"===t?"Imagen":"Bild",n="Video",o=[];a.text&&o.push(a.text),a.imageUrl&&o.push("".concat(s,": ").concat(a.imageUrl)),a.videoUrl&&o.push("".concat(n,": ").concat(a.videoUrl)),e&&T(o.length>0?o.join("\n"):null)}else e&&T(null)}catch(w){e&&(console.warn("Fehler beim Laden der Zimmer-Beschreibung aus Branch-Settings:",w),T(null))}else e&&T(null)})(),()=>{e=!1}}),[t,r.categoryId,r.branchId,r.guestNationality]),(0,s.useEffect)((()=>{t&&!v&&f(E())}),[t,r]),(0,s.useEffect)((()=>{if(v){const e=r.doorPin||r.ttlLockPassword||"[Passcode wird generiert]",t=r.roomNumber||"[Bettnummer]",a=C||r.roomDescription||"[Zimmername]",s=r.doorAppName||"TTLock";let n=v.replace(/\{\{guestName\}\}/g,r.guestName).replace(/\{\{passcode\}\}/g,e).replace(/\{\{roomNumber\}\}/g,t).replace(/\{\{roomDescription\}\}/g,a).replace(/\{\{doorAppName\}\}/g,s);A(n)}}),[v,r.guestName,r.doorPin,r.ttlLockPassword,r.roomNumber,r.roomDescription,r.doorAppName,r.guestNationality,C]),(0,s.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),x(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!u?d():c(),()=>{c()})),[t,u,d,c]),(0,s.useEffect)((()=>{t||(p(r.guestPhone||""),y(r.guestEmail||""),f(""),j(null),A(""),T(null))}),[t,r]);const D=()=>{j(null),a()},I=async e=>{if(e.preventDefault(),j(null),h||b)try{N(!0),await ae.u.sendPasscode(r.id,{guestPhone:h||void 0,guestEmail:b||void 0,customMessage:v||void 0}),l(i("reservations.sendPasscode.success","Passcode erfolgreich versendet"),"success"),o(),D()}catch(s){var t,a;console.error("Fehler beim Versenden des Passcodes:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("reservations.sendPasscode.error","Fehler beim Versenden des Passcodes");j(e),l(e,"error")}finally{N(!1)}else j(i("reservations.sendPasscode.noContact","Bitte geben Sie mindestens eine Telefonnummer oder E-Mail-Adresse an."))};return u?(0,q.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto ".concat(t?"":"hidden"),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,q.jsxs)("div",{className:"flex min-h-screen items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[(0,q.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:D}),(0,q.jsxs)("div",{className:"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("reservations.sendPasscode.title","Passcode senden")}),(0,q.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(100vh-200px)]",children:R()})]})]})}):(0,q.jsxs)(q.Fragment,{children:[t&&!g&&(0,q.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,q.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,q.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,q.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("reservations.sendPasscode.title","Passcode senden")}),(0,q.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(M.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:R()})]})]});function R(){return(0,q.jsxs)(q.Fragment,{children:[w&&(0,q.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:w}),(0,q.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:i("reservations.sendPasscode.contactInfo","Kontaktinformationen")}),(0,q.jsxs)("div",{className:"space-y-3",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"guestPhone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.phone","Telefonnummer")}),(0,q.jsx)("input",{type:"tel",id:"guestPhone",value:h,onChange:e=>p(e.target.value),placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"guestEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.email","E-Mail")}),(0,q.jsx)("input",{type:"email",id:"guestEmail",value:b,onChange:e=>y(e.target.value),placeholder:"email@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:i("reservations.sendPasscode.message","Nachricht")}),(0,q.jsxs)("div",{className:"space-y-3",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{htmlFor:"customMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.sendPasscode.messageLabel","Nachricht (editierbar)")}),(0,q.jsx)("textarea",{id:"customMessage",value:v,onChange:e=>f(e.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white font-mono text-xs",placeholder:E()}),(0,q.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:i("reservations.sendPasscode.messageVariables","Verf\xfcgbare Variablen: {{guestName}}, {{passcode}}, {{roomNumber}}, {{roomDescription}}")})]}),S&&(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("reservations.sendPasscode.preview","Vorschau")}),(0,q.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:S})]})]})]}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700",children:[(0,q.jsx)("button",{type:"button",onClick:D,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel","Abbrechen"),children:(0,q.jsx)(M.A,{className:"h-5 w-5"})}),(0,q.jsx)("button",{type:"submit",disabled:k||!h&&!b,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600",title:k?i("reservations.sendPasscode.sending","Wird gesendet..."):i("reservations.sendPasscode.send","Senden"),children:(0,q.jsx)(F.A,{className:"h-5 w-5"})})]})]})]})}};var ce=a(7935),ue=a(1726),me=a(9399),ge=a(8526),xe=a(7460),he=a(7952),pe=a(2395),be=a(8658);const ye=()=>{const{t:e}=(0,n.Bd)(),[t,a]=(0,s.useState)(!1),[r,o]=(0,s.useState)(null),[i,d]=(0,s.useState)("00:00:00"),[c,u]=(0,s.useState)(null),[m,g]=(0,s.useState)(!0),[x,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),{user:y}=(0,l.As)(),{isTracking:v,updateTrackingStatus:f,checkTrackingStatus:k}=(0,xe.S)(),{branches:N,selectedBranch:w,setSelectedBranch:j}=(0,he.O)(),{organization:S}=(0,pe.Z)(),A=(0,s.useMemo)((()=>!(!c||!S)&&((null!==c.organizationId||void 0!==S.id)&&c.organizationId!==S.id)),[c,S]);(0,s.useCallback)((async()=>{try{g(!0),b(null),K.v.log("Pr\xfcfe aktive Zeiterfassung..."),K.v.log("Benutzer geladen:",null===y||void 0===y?void 0:y.id);const n=localStorage.getItem("token");if(K.v.log("Token vorhanden:",n?"Ja":"Nein"),!n)return console.error("Kein Authentifizierungstoken gefunden"),b(e("worktime.tracker.notAuthenticated")),void g(!1);try{const e=await B.A.get(_.Sn.WORKTIME.ACTIVE);K.v.log("API-Antwort Status:",e.status);const t=e.data;if(K.v.log("Aktive Zeiterfassung Daten:",t),t&&!0===t.active){K.v.log("Aktive Zeiterfassung gefunden:",t.id);const e=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,r=new Date(e),s=(new Date).getTime()-r.getTime(),n=Math.floor(s/1e3),i=Math.floor(n/3600),l=Math.floor(n%3600/60),c=n%60;u(t),o(r),d("".concat(i.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"),":").concat(c.toString().padStart(2,"0"))),a(!0),w!==t.branchId&&j(t.branchId),f(!0)}else K.v.log("Keine aktive Zeiterfassung vorhanden"),a(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(s){console.error("Fehler beim Abrufen der aktiven Zeiterfassung:",s);const a=s;var t,r;if("ERR_NETWORK"===a.code)b(e("worktime.tracker.connectionError"));else b("".concat(e("worktime.tracker.errorFetch"),": ").concat((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||a.message))}}finally{g(!1)}}),[null===y||void 0===y?void 0:y.id,f,w,S]);(0,s.useEffect)((()=>{y?void 0!==v&&(a(v),g(!1)):g(!1)}),[y,v]),(0,s.useEffect)((()=>{let e;return t&&r&&(e=window.setInterval((()=>{const e=(new Date).getTime()-r.getTime(),t=Math.floor(e/1e3),a=Math.floor(t/3600),s=Math.floor(t%3600/60),n=t%60;d("".concat(a.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")))}),1e3)),()=>{e&&clearInterval(e)}}),[t,r]);const C=async()=>{if(w)try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));const r=(await B.A.post(_.Sn.WORKTIME.START,{branchId:w,startTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data,s=r.startTime.endsWith("Z")?r.startTime.substring(0,r.startTime.length-1):r.startTime,n=new Date(s);u(r),o(n),d("00:00:00"),a(!0),f(!0)}catch(r){console.error("Fehler:",r);let a=e("worktime.tracker.errorStart");var t;if(r.response)a=(null===(t=r.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(r.response.status,")");alert(a)}else alert(e("worktime.tracker.selectBranch"))},T=async()=>{try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await B.A.post(_.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});a(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(r){console.error("Fehler:",r);let a=e("worktime.tracker.errorStop");var t;if(r.response)a=(null===(t=r.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(r.response.status,")");alert(a)}},E=(0,s.useMemo)((()=>{var t;return c?(null===(t=N.find((e=>e.id===c.branchId)))||void 0===t?void 0:t.name)||e("worktime.tracker.unknown"):null}),[N,c]);return m?(0,q.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-6",children:(0,q.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,q.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})})}):(0,q.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 sm:mb-6",children:[(0,q.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,q.jsxs)("h2",{className:"text-xl font-semibold flex items-center dark:text-white",children:[(0,q.jsx)(L.A,{className:"h-6 w-6 mr-2"}),e("worktime.tracker.title")]})}),p&&(0,q.jsxs)("div",{className:"mb-4 p-2 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 border border-red-200 dark:border-red-700 rounded-md flex justify-between items-center",children:[(0,q.jsx)("span",{children:p}),p!==e("worktime.tracker.noActiveTracking")&&(0,q.jsxs)("button",{onClick:async()=>{if(window.confirm(e("worktime.tracker.forceStopConfirm")))try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await B.A.post(_.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),force:!0},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});a(!1),o(null),d("00:00:00"),u(null),b(null),alert(e("worktime.tracker.forceStopSuccess")),f(!1)}catch(r){var t;console.error("Fehler:",r),b("Fehler beim Stoppen: ".concat((null===(t=r.response)||void 0===t?void 0:t.status)||"Netzwerkfehler")),alert(e("worktime.tracker.forceStopError"))}},className:"text-sm bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-800 dark:hover:bg-red-700 dark:text-red-300 px-2 py-1 rounded-md",children:[e("worktime.tracker.stop")," ",e("common.force","Erzwingen")]})]}),t&&A&&(0,q.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 border border-yellow-200 dark:border-yellow-700 rounded-md flex items-start",children:[(0,q.jsx)(me.A,{className:"h-5 w-5 mr-2 mt-0.5 flex-shrink-0"}),(0,q.jsxs)("div",{className:"flex-1",children:[(0,q.jsx)("p",{className:"font-medium",children:e("worktime.tracker.differentOrganizationWarning.title","Hinweis: Andere Organisation")}),(0,q.jsx)("p",{className:"text-sm mt-1",children:e("worktime.tracker.differentOrganizationWarning.message","Diese Zeiterfassung wurde in einer anderen Organisation gestartet. Sie wird nach dem Stoppen der Organisation zugeordnet, in der sie gestartet wurde.")})]})]}),(0,q.jsxs)("div",{className:"flex items-start justify-center mb-4",children:[(0,q.jsxs)("div",{className:"flex flex-col items-center",children:[(0,q.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,q.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:t,onChange:async()=>{t?await T():await C()},disabled:!w&&!t,"data-onboarding":t?"stop-worktime":"start-worktime"}),(0,q.jsx)("div",{className:"w-20 h-10 rounded-full \n                            ".concat(t?"bg-green-500 shadow-lg shadow-green-200 dark:shadow-green-900/20":"bg-gray-300 dark:bg-gray-600","\n                            before:content-[''] before:absolute before:top-0 before:left-0 before:bottom-0 before:right-0 \n                            peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-700\n                            peer-checked:after:translate-x-10\n                            after:content-[''] after:absolute after:top-1 after:left-1\n                            after:bg-white dark:after:bg-gray-200 after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full\n                            after:h-8 after:w-8 after:transition-all after:duration-300 ease-in-out\n                            transition-colors duration-300")})]}),(0,q.jsx)("span",{className:"mt-2 text-sm font-medium",children:t?(0,q.jsx)("span",{className:"text-green-600 dark:text-green-400 font-bold",children:e("worktime.tracker.running")}):(0,q.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:e("worktime.tracker.start")})})]}),(0,q.jsx)("button",{onClick:()=>{h(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-2 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-blue-700 shadow-sm flex items-center justify-center ml-8 mt-1",title:e("worktime.tracker.showTimes"),children:(0,q.jsx)(ge.A,{className:"h-6 w-6"})})]}),(0,q.jsx)("div",{className:"p-2 my-2 rounded-md text-sm ".concat(t&&c?"bg-green-50 dark:bg-green-900/20 dark:text-green-200":"bg-gray-50 dark:bg-gray-700 dark:text-gray-300"),children:t&&c?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("p",{children:[(0,q.jsx)("strong",{children:e("worktime.tracker.activeTracking")})," ",i]}),(0,q.jsxs)("p",{children:[(0,q.jsx)("strong",{children:e("worktime.tracker.started")})," ",(e=>{"string"===typeof e&&e.endsWith("Z")&&(e=e.substring(0,e.length-1));const t=new Date(e),a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),n=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return"".concat(a,".").concat(r,".").concat(s,", ").concat(n,":").concat(o,":").concat(i)})(r||Date.now())]}),(0,q.jsxs)("p",{children:[(0,q.jsxs)("strong",{children:[e("worktime.tracker.selectBranchLabel"),":"]})," ",E||e("worktime.tracker.unknown")]})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("p",{children:"\xa0"}),(0,q.jsx)("p",{children:"\xa0"}),(0,q.jsx)("p",{children:"\xa0"})]})}),x&&(0,q.jsx)(be.G,{isOpen:x,onClose:()=>{h(!1)}})]})};var ve=a(4426),fe=a(7829),ke=a(9462),Ne=a(7488),we=a(6896),je=a(1052),Se=a(1853),Ae=a(957),Ce=a(637),Te=a(2415),Ee=a(887);const De=["title","responsibleAndQualityControl","status","dueDate","branch","actions"],Ie="worktracker-todos",Re="worktracker-reservations",Pe=200,Le={title:["title"],status:["status"],responsibleAndQualityControl:["responsible","qualityControl"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},Oe={title:"title",status:"status",responsible:"responsibleAndQualityControl",qualityControl:"responsibleAndQualityControl",branch:"branch",dueDate:"dueDate",description:"description"},Fe={guestName:["guestName"],status:["status"],paymentStatus:["paymentStatus"],checkInDate:["checkInDate"],checkOutDate:["checkOutDate"],roomNumber:["roomNumber"],branch:["branch"],guestEmail:["guestEmail"],guestPhone:["guestPhone"],amount:["amount"],arrivalTime:["arrivalTime"],actions:[]},Be={guestName:"guestName",status:"status",paymentStatus:"paymentStatus",checkInDate:"checkInDate",checkOutDate:"checkOutDate",roomNumber:"roomNumber",branch:"branch",guestEmail:"guestEmail",guestPhone:"guestPhone",amount:"amount",arrivalTime:"arrivalTime"},ze=()=>{const{t:e}=(0,n.Bd)(),{user:t}=(0,l.As)(),{hasPermission:a,permissions:z,isAdmin:M}=(0,d.S)(),V=(0,i.zy)(),U=(0,i.Zp)(),{showMessage:W}=(0,Q.A)(),G=(0,s.useMemo)((()=>[{id:"title",label:e("tasks.columns.title"),shortLabel:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status"),shortLabel:e("tasks.columns.status")},{id:"responsibleAndQualityControl",label:e("tasks.columns.responsibleAndQualityControl"),shortLabel:e("tasks.columns.responsibleAndQualityControl").split("/")[0]},{id:"branch",label:e("tasks.columns.branch"),shortLabel:e("tasks.columns.branch").substring(0,5)},{id:"dueDate",label:e("tasks.columns.dueDate"),shortLabel:e("tasks.columns.dueDate").substring(0,5)},{id:"actions",label:e("tasks.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),H=(0,s.useMemo)((()=>[{id:"responsible",label:e("tasks.columns.responsible"),shortLabel:e("tasks.columns.responsible").substring(0,3)},{id:"qualityControl",label:e("tasks.columns.qualityControl"),shortLabel:e("tasks.columns.qualityControl").substring(0,2)}]),[e]),Y=(0,s.useMemo)((()=>[...G.filter((e=>"actions"!==e.id&&"responsibleAndQualityControl"!==e.id)).map((e=>({id:e.id,label:e.label}))),...H.map((e=>({id:e.id,label:e.label})))]),[G,H]),J=(0,s.useMemo)((()=>[{id:"guestName",label:e("reservations.columns.guestName","Gast"),shortLabel:e("reservations.columns.guestName","Gast").substring(0,4)},{id:"status",label:e("reservations.columns.status","Status"),shortLabel:e("reservations.columns.status","Status").substring(0,3)},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus"),shortLabel:e("reservations.columns.paymentStatus","Zahlungsstatus").substring(0,3)},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in"),shortLabel:e("reservations.columns.checkInDate","Check-in").substring(0,5)},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out"),shortLabel:e("reservations.columns.checkOutDate","Check-out").substring(0,5)},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer"),shortLabel:e("reservations.columns.roomNumber","Zimmer").substring(0,3)},{id:"branch",label:e("reservations.columns.branch","Niederlassung"),shortLabel:e("reservations.columns.branch","Niederlassung").substring(0,5)},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail"),shortLabel:e("reservations.columns.guestEmail","E-Mail").substring(0,3)},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon"),shortLabel:e("reservations.columns.guestPhone","Telefon").substring(0,3)},{id:"amount",label:e("reservations.columns.amount","Betrag"),shortLabel:e("reservations.columns.amount","Betrag").substring(0,3)},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit"),shortLabel:e("reservations.columns.arrivalTime","Ankunftszeit").substring(0,3)},{id:"actions",label:e("reservations.columns.actions","Aktionen"),shortLabel:e("common.actions").substring(0,3)}]),[e]),[$,X]=((0,s.useMemo)((()=>[]),[e]),(0,s.useState)("todos")),[ee,ae]=(0,s.useState)([]),[ie,me]=(0,s.useState)(0),[ge,xe]=(0,s.useState)(!0),[he,pe]=(0,s.useState)(!1),[be,ze]=(0,s.useState)(!0),[Me,Ve]=(0,s.useState)(null),[_e,qe]=(0,s.useState)(!1),[Ue,We]=((0,s.useRef)(!1),(0,s.useState)("")),[Ke,Ge]=(0,s.useState)("all"),[He,Ze]=(0,s.useState)([]),[Ye,Qe]=(0,s.useState)(0),[Je,$e]=(0,s.useState)(!0),[Xe,et]=(0,s.useState)(!1),[tt,at]=(0,s.useState)(!1),[rt,st]=(0,s.useState)(null),[nt,ot]=(0,s.useState)(!1),[it,lt]=((0,s.useRef)(!1),(0,s.useState)("")),[dt,ct]=(0,s.useState)("all"),[ut,mt]=(0,s.useState)("all"),[gt,xt]=(0,s.useState)(!1),[ht,pt]=(0,s.useState)(!1),[bt,yt]=(0,s.useState)(null),[vt,ft]=(0,s.useState)(null),[kt,Nt]=(0,s.useState)(!1),[wt,jt]=(0,s.useState)(null),[St,At]=(0,s.useState)(!1),[Ct,Tt]=(0,s.useState)([]),[Et,Dt]=(0,s.useState)(0),[It,Rt]=(0,s.useState)(!0),[Pt,Lt]=(0,s.useState)(!1),[Ot,Ft]=(0,s.useState)(!1),[Bt,zt]=(0,s.useState)(null),[Mt,Vt]=(0,s.useState)(""),[_t,qt]=(0,s.useState)(null),[Ut,Wt]=(0,s.useState)(!1),[Kt,Gt]=(0,s.useState)(!1),[Ht,Zt]=(0,s.useState)(!1),[Yt,Qt]=(0,s.useState)(null),[Jt,$t]=(0,s.useState)([]),[Xt,ea]=(0,s.useState)([]),[ta,aa]=(0,s.useState)(""),[ra,sa]=(0,s.useState)(null),[na,oa]=(0,s.useState)([]),[ia,la]=(0,s.useState)([]),[da,ca]=(0,s.useState)(""),[ua,ma]=(0,s.useState)(null),[ga,xa]=(0,s.useState)(!1),[ha,pa]=(0,s.useState)({key:"tourDate",direction:"desc"}),[ba,ya]=(0,s.useState)(!1),[va,fa]=(0,s.useState)(!1),[ka,Na]=(0,s.useState)(null),[wa,ja]=(0,s.useState)(null),{settings:Sa,isLoading:Aa,updateColumnOrder:Ca,updateHiddenColumns:Ta,toggleColumnVisibility:Ea,isColumnVisible:Da,updateViewMode:Ia,updateSortConfig:Ra}=(0,c.F)("worktracker_tasks",{defaultColumnOrder:De,defaultHiddenColumns:[],defaultViewMode:"cards",defaultSortConfig:{key:"dueDate",direction:"asc"}}),Pa=["guestName","status","paymentStatus","checkInDate","checkOutDate","roomNumber","branch","actions"],{settings:La,isLoading:Oa,updateColumnOrder:Fa,updateHiddenColumns:Ba,toggleColumnVisibility:za,isColumnVisible:Ma,updateViewMode:Va,updateSortConfig:_a}=(0,c.F)("worktracker-reservations",{defaultColumnOrder:Pa,defaultHiddenColumns:[],defaultViewMode:"cards"}),qa="todos"===$?Sa:La,Ua="todos"===$?Ca:Fa,Wa="todos"===$?Ea:za,Ka="todos"===$?Da:Ma,Ga="todos"===$?Ia:Va,Ha=(0,s.useMemo)((()=>{fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:452",message:"tableSortConfig useMemo ENTRY",data:{tasksSettingsSortConfig:Sa.sortConfig,isUndefined:void 0===Sa.sortConfig},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch((()=>{}));const e=Sa.sortConfig||{key:"dueDate",direction:"asc"};return fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:454",message:"tableSortConfig useMemo EXIT",data:{resultKey:e.key,resultDirection:e.direction,usedDefault:!Sa.sortConfig},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch((()=>{})),e}),[Sa.sortConfig]);(0,s.useEffect)((()=>{var e,t;fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:470",message:"tasksSettings.sortConfig changed",data:{sortConfigKey:null===(e=Sa.sortConfig)||void 0===e?void 0:e.key,sortConfigDirection:null===(t=Sa.sortConfig)||void 0===t?void 0:t.direction,isUndefined:void 0===Sa.sortConfig,tableSortConfigKey:null===Ha||void 0===Ha?void 0:Ha.key,tableSortConfigDirection:null===Ha||void 0===Ha?void 0:Ha.direction},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"J"})}).catch((()=>{}))}),[Sa.sortConfig,Ha]);const Za={key:"checkInDate",direction:"desc"},Ya=(0,s.useMemo)((()=>La.sortConfig||Za),[La.sortConfig]),[Qa,Ja]=(0,s.useState)(null),[$a,Xa]=(0,s.useState)(null),[er,tr]=(0,s.useState)(new Set),ar=qa.viewMode||"cards";(0,s.useEffect)((()=>{document.querySelectorAll(".dashboard-tasks-wrapper").forEach((e=>{"cards"===ar?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[ar]);const rr=(0,s.useMemo)((()=>"todos"===$?(e=>{const t=[];return e.forEach((e=>{const a=Le[e];a&&a.length>0&&t.push(...a)})),t.includes("description")||t.push("description"),t})(qa.columnOrder||De):(e=>{const t=[];return e.forEach((e=>{const a=Fe[e];a&&a.length>0&&t.push(...a)})),t})(qa.columnOrder||Pa)),[qa.columnOrder,$]),sr=(0,s.useMemo)((()=>"todos"===$?(e=>{const t=new Set;return e.forEach((e=>{(Le[e]||[]).forEach((e=>t.add(e)))})),t})(qa.hiddenColumns||[]):(e=>{const t=new Set;return e.forEach((e=>{(Fe[e]||[]).forEach((e=>t.add(e)))})),t})(qa.hiddenColumns||[])),[qa.hiddenColumns,$]),nr=(0,s.useMemo)((()=>new Set(rr.filter((e=>!sr.has(e))))),[rr,sr]),or=(0,s.useCallback)(((e,t)=>{fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:523",message:"handleMainSortChange ENTRY",data:{key:e,direction:t,activeTab:$},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"G"})}).catch((()=>{})),"todos"===$?(fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:525",message:"handleMainSortChange BEFORE updateTasksSortConfig",data:{key:e,direction:t},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"G"})}).catch((()=>{})),Ra({key:e,direction:t}),fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:526",message:"handleMainSortChange AFTER updateTasksSortConfig",data:{called:!0},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"G"})}).catch((()=>{}))):"reservations"===$&&_a({key:e,direction:t})}),[$,Ra,_a]),ir=e=>{tr((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},lr=((0,s.useRef)(!1),(0,s.useCallback)((async function(t,a){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;try{s?pe(!0):ze(!0);const e={limit:n,offset:o,includeAttachments:"true"};t?e.filterId=t:a&&a.length>0&&(e.filterConditions=JSON.stringify({conditions:a,operators:i||[]}));const l=(await B.A.get(_.Sn.TASKS.BASE,{params:e})).data;0;let d=[],c=0,u=!1;if(!l||"object"!==typeof l)throw console.error("[Worktracker Tasks] \u274c FEHLER: responseData ist kein Objekt!",{responseData:l,type:typeof l}),new Error("Ung\xfcltige Response-Struktur: responseData ist kein Objekt (Typ: ".concat(typeof l,")"));if(Array.isArray(l.data))d=l.data,c=l.totalCount||d.length,u=void 0!==l.hasMore?l.hasMore:o+d.length<c;else{if(!Array.isArray(l))throw console.error("[Worktracker Tasks] \u274c FEHLER: responseData.data ist kein Array!",{responseData:l,data:l.data,dataType:typeof l.data}),new Error("Ung\xfcltige Response-Struktur: responseData.data ist kein Array (Typ: ".concat(typeof l.data,")"));d=l,c=d.length,u=!1}if(!Array.isArray(d))throw console.error("[Worktracker Tasks] \u274c FEHLER: tasksData ist kein Array!",{tasksData:d,type:typeof d}),new Error("Ung\xfcltige Response-Struktur: tasksData ist kein Array (Typ: ".concat(typeof d,")"));const m=d.filter((e=>null!=e)).map((e=>{const t=(e.attachments||[]).filter((e=>null!=e)).map((t=>({id:t.id,fileName:t.fileName,fileType:t.fileType,fileSize:t.fileSize,filePath:t.filePath,uploadedAt:t.uploadedAt,url:(0,_._y)(e.id,t.id)})));return(0,r.A)((0,r.A)({},e),{},{attachments:t})}));ae(s?e=>{const t=[...e,...m];return t.length>Pe?t.slice(-200):t}:m),me(c),xe(u),Ve(null)}catch(Me){console.error("[Worktracker Tasks] Fehler beim Laden:",Me);const a=Me;if(!s){var l,d,c,u,m,g;const t=(null===(l=a.response)||void 0===l||null===(d=l.data)||void 0===d?void 0:d.message)||(null===(c=a.response)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.error)||a.message||e("worktime.messages.tasksLoadError");console.error("[Worktracker Tasks] Error Details:",{message:t,status:null===(m=a.response)||void 0===m?void 0:m.status,data:null===(g=a.response)||void 0===g?void 0:g.data}),Ve(t)}}finally{s?pe(!1):ze(!1)}}),[])),dr=(0,s.useCallback)((async(e,t)=>{oa(e),la(t),ma(null),ca(""),Ra({key:"dueDate",direction:"asc"}),e.length>0?await lr(void 0,e,!1,20,0,t):await lr(void 0,void 0,!1,20,0,[])}),[lr]),cr=(0,s.useCallback)((async function(t,a,r){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;try{s?et(!0):at(!0),st(null);const e={limit:n,offset:o};t?e.filterId=t:a&&a.length>0&&(e.filterConditions=JSON.stringify({conditions:a,operators:r||Nr.current}));const i=(await B.A.get(_.Sn.RESERVATION.BASE,{params:e})).data;let l=[],d=0,c=!1;i&&"object"===typeof i&&(i.success&&Array.isArray(i.data)||Array.isArray(i.data)?(l=i.data,d=i.totalCount||l.length,c=void 0!==i.hasMore?i.hasMore:o+l.length<d):Array.isArray(i)&&(l=i,d=l.length,c=!1)),Ze(s?e=>{const t=[...e,...l];return t.length>200?t.slice(-200):t}:l),Qe(d),$e(c)}catch(d){var i,l;0;const t=(null===(i=d.response)||void 0===i||null===(l=i.data)||void 0===l?void 0:l.message)||e("reservations.loadError","Fehler beim Laden der Reservations");s||(st(t),W(t,"error"))}finally{s?et(!1):at(!1)}}),[W]),ur=(0,s.useCallback)((async(e,t)=>{$t(e),ea(t),sa(null),aa(""),_a({key:"checkInDate",direction:"desc"}),e.length>0?await cr(void 0,e,t,!1,20,0):await cr(void 0,void 0,t,!1,20,0)}),[cr]),mr=(0,s.useCallback)((async(e,t,a,r)=>{"todos"===$?(ca(e),ma(t),Ra({key:"dueDate",direction:"asc"}),t?(oa(a),la(r),await lr(t,void 0,!1,20,0)):await dr(a,r)):"reservations"===$&&(aa(e),sa(t),_a({key:"checkInDate",direction:"desc"}),t?($t(a),ea(r),await cr(t,void 0,!1,20,0)):await ur(a,r))}),[$,dr,lr,cr,ur]),gr=(0,s.useCallback)((async(e,t,a,r)=>{aa(e),sa(t),_a({key:"checkInDate",direction:"desc"}),t?($t(a),ea(r),await cr(t,void 0,r,!1,20,0)):await ur(a,r)}),[ur,cr]),xr=(0,s.useRef)(mr),hr=(0,s.useRef)(gr);(0,s.useEffect)((()=>{xr.current=mr}),[mr]),(0,s.useEffect)((()=>{hr.current=gr}),[gr]);const pr=(0,ke.b)(),{loadFilters:br}=pr,yr=(0,s.useRef)({todos:!1,reservations:!1});(0,s.useEffect)((()=>{if("todos"===$&&yr.current.todos)return;if("reservations"===$&&yr.current.reservations)return;(async()=>{"todos"===$?yr.current.todos=!0:"reservations"===$&&(yr.current.reservations=!0);try{if("todos"===$){const e=(await br(Ie)).find((e=>"Aktuell"===e.name));e&&await xr.current(e.name,e.id,e.conditions,e.operators)}else if("reservations"===$){const e=(await br(Re)).find((e=>"Hoy"===e.name));e&&await hr.current(e.name,e.id,e.conditions,e.operators)}}catch(Me){"todos"===$?yr.current.todos=!1:"reservations"===$&&(yr.current.reservations=!1)}})()}),[$]);const vr=(0,s.useRef)(na);(0,s.useEffect)((()=>{vr.current=na}),[na]);const fr=(0,s.useRef)(ia);(0,s.useEffect)((()=>{fr.current=ia}),[ia]);const kr=(0,s.useRef)(Jt);(0,s.useEffect)((()=>{kr.current=Jt}),[Jt]);const Nr=(0,s.useRef)(Xt);(0,s.useEffect)((()=>{Nr.current=Xt}),[Xt]);const wr=(0,s.useRef)(null),jr=(0,s.useRef)(null),Sr=(0,s.useRef)(null),Ar=(0,s.useRef)(ee.length),Cr=(0,s.useRef)(He.length),Tr=(0,s.useRef)(Ct.length);(0,s.useEffect)((()=>{Ar.current=ee.length}),[ee.length]),(0,s.useEffect)((()=>{Cr.current=He.length}),[He.length]),(0,s.useEffect)((()=>{Tr.current=Ct.length}),[Ct.length]);const Er=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{t?Lt(!0):Ft(!0),zt(null);const e={limit:a,offset:r},s=(await B.A.get(_.Sn.TOUR_BOOKINGS.BASE,{params:e})).data;let n=[],o=0,i=!1;s&&"object"===typeof s&&(s.success&&Array.isArray(s.data)||Array.isArray(s.data)?(n=s.data,o=s.totalCount||n.length,i=void 0!==s.hasMore?s.hasMore:r+n.length<o):Array.isArray(s)&&(n=s,o=n.length,i=!1)),Tt(t?e=>[...e,...n]:n),Dt(o),Rt(i)}catch(o){var s,n;0;const a=(null===(s=o.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||e("tourBookings.loadError","Fehler beim Laden der Tour-Buchungen");t||(zt(a),W(a,"error"))}finally{t?Lt(!1):Ft(!1)}};(0,s.useEffect)((()=>{"tourBookings"===$&&a("tour_bookings","read","table")&&Er(!1,20,0)}),[$]),(0,s.useEffect)((()=>{if(ee.length>0){const e=new URLSearchParams(V.search).get("editTask");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=ee.find((e=>e.id===t));e&&(Na(e),fa(!0))}}}}),[ee,V.search]);const Dr=async(t,a)=>{try{ae((e=>e.filter((e=>null!=e)).map((e=>e.id===t?(0,r.A)((0,r.A)({},e),{},{status:a}):e)))),await B.A.patch(_.Sn.TASKS.BY_ID(t),{status:a}),Ne.oR.success(e("worktime.messages.taskUpdated"))}catch(Me){0,lr(),Ne.oR.error(e("worktime.messages.taskUpdatedError"))}},Ir=e=>{return e.responsible?e.responsible.id===(null===t||void 0===t?void 0:t.id):e.role&&(null===t||void 0===t||null===(a=t.roles)||void 0===a?void 0:a.some((t=>{var a,r;return(null===(a=t.role)||void 0===a?void 0:a.id)===(null===(r=e.role)||void 0===r?void 0:r.id)})))||!1;var a},Rr=e=>{var a;return(null===(a=e.qualityControl)||void 0===a?void 0:a.id)===(null===t||void 0===t?void 0:t.id)},Pr=(0,s.useCallback)((e=>{fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:1188",message:"handleSort ENTRY",data:{clickedKey:e,tableSortConfigKey:Ha.key,tableSortConfigDirection:Ha.direction,tasksSettingsSortConfig:Sa.sortConfig},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch((()=>{}));const t=Ha,a=t.key===e,r="asc"===t.direction,s=a&&r?"desc":"asc";fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:1193",message:"handleSort BEFORE update",data:{currentSortConfigKey:t.key,currentSortConfigDirection:t.direction,isSameKey:a,isAsc:r,newDirection:s,newKey:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch((()=>{})),Ra({key:e,direction:s}),fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:1194",message:"handleSort AFTER updateTasksSortConfig call",data:{called:!0},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch((()=>{}))}),[Ha,Ra]),Lr=(0,s.useCallback)((e=>{const t=Ya,a=t.key===e&&"asc"===t.direction?"desc":"asc";_a({key:e,direction:a})}),[Ya,_a]),Or=e=>{"table"===ar&&"tourBookings"===$&&pa((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},Fr=t=>{const r=[];if(!a("tasks","write","table"))return r;const s=M();return"in_progress"===t.status&&(s||Ir(t))?r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"open"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,q.jsx)(m.A,{className:"h-5 w-5"})},"back"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToOpen")})]})):"quality_control"===t.status&&(s||Ir(t))?r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"in_progress"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,q.jsx)(m.A,{className:"h-5 w-5"})},"back"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToInProgress")})]})):"done"===t.status&&(s||Rr(t))&&r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"quality_control"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,q.jsx)(m.A,{className:"h-5 w-5"})},"back"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToQualityControl")})]})),"open"===t.status&&(s||Ir(t))?r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"in_progress"),className:"p-1.5 bg-blue-600 dark:bg-blue-500 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-600",children:(0,q.jsx)(g.A,{className:"h-5 w-5"})},"forward"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.setInProgress")})]})):"in_progress"===t.status&&(s||Ir(t))?r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"quality_control"),className:"p-1.5 bg-purple-600 dark:bg-purple-500 text-white rounded hover:bg-purple-700 dark:hover:bg-purple-600",children:(0,q.jsx)(g.A,{className:"h-5 w-5"})},"forward"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.setQualityControl")})]})):"quality_control"===t.status&&(s||Rr(t))&&r.push((0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Dr(t.id,"done"),className:"p-1.5 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",children:(0,q.jsx)(g.A,{className:"h-5 w-5"})},"forward"),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.markDone")})]})),r},Br=()=>"todos"===$?na.length:"reservations"===$?Jt.length:0,zr=()=>{oa([]),la([]),ca(""),ma(null)},Mr=()=>{$t([]),ea([]),aa(""),sa(null)},Vr=e=>{switch(e){case"open":return 1;case"in_progress":return 2;case"improval":return 3;case"quality_control":return 4;case"done":return 5;default:return 99}},_r=e=>{switch(e){case ue.X.CONFIRMED:return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200";case ue.X.NOTIFICATION_SENT:return"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200";case ue.X.CHECKED_IN:return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case ue.X.CHECKED_OUT:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";case ue.X.CANCELLED:return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";case ue.X.NO_SHOW:return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},qr=e=>{switch(e){case ue.d.PAID:return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case ue.d.PARTIALLY_PAID:return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";case ue.d.REFUNDED:return"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200";case ue.d.PENDING:default:return"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200"}},Ur=(0,s.useMemo)((()=>{const e=ee.filter((e=>null!=e)).filter((e=>{if(Ue){const t=Ue.toLowerCase();if(e.title.toLowerCase().includes(t))return!0;if(e.branch.name.toLowerCase().includes(t))return!0;if(e.description&&e.description.toLowerCase().includes(t))return!0;if(e.role&&e.role.name.toLowerCase().includes(t))return!0;if(e.responsible){if("".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t))return!0}if(e.qualityControl){if("".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase().includes(t))return!0}return!1}return!0})),t=(e,t)=>{switch(t){case"title":return e.title.toLowerCase();case"status":return Vr(e.status);case"responsible":case"responsibleAndQualityControl":return e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?"Rolle: ".concat(e.role.name).toLowerCase():"";case"qualityControl":return e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"";case"branch":case"branch.name":return e.branch.name.toLowerCase();case"dueDate":return e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER;case"description":return(e.description||"").toLowerCase();default:return""}};return e.sort(((e,a)=>{if(Ha.key){const r=t(e,Ha.key),s=t(a,Ha.key);let n=0;if("number"===typeof r&&"number"===typeof s)n=r-s;else{const e="string"===typeof r?r:String(r),t="string"===typeof s?s:String(s);n=e.localeCompare(t)}if(0!==n)return"asc"===Ha.direction?n:-n}const r=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,s=a.dueDate?new Date(a.dueDate).getTime():Number.MAX_SAFE_INTEGER;if(r!==s)return r-s;const n=Vr(e.status),o=Vr(a.status);return n!==o?n-o:e.title.toLowerCase().localeCompare(a.title.toLowerCase())}))}),[ee,ua,Ue,Ha]),Wr=(0,s.useMemo)((()=>{const e=He.filter((e=>null!=e));let t=e.filter((e=>{if("all"!==dt&&e.status!==dt)return!1;if("all"!==ut&&e.paymentStatus!==ut)return!1;if(it){const t=it.toLowerCase();return!(!e.guestName||!e.guestName.toLowerCase().includes(t))||(!(!e.guestEmail||!e.guestEmail.toLowerCase().includes(t))||(!(!e.roomNumber||!e.roomNumber.toLowerCase().includes(t))||(!(!e.guestPhone||!e.guestPhone.toLowerCase().includes(t))||!(!e.lobbyReservationId||!e.lobbyReservationId.toLowerCase().includes(t)))))}return!0}));const a=(e,t)=>{var a;switch(t){case"guestName":return(e.guestName||"").toLowerCase();case"status":return e.status.toLowerCase();case"paymentStatus":return e.paymentStatus.toLowerCase();case"checkInDate":return e.checkInDate?new Date(e.checkInDate).getTime():0;case"checkOutDate":return e.checkOutDate?new Date(e.checkOutDate).getTime():0;case"roomNumber":return(e.roomNumber||"").toLowerCase();case"branch":case"branch.name":return((null===(a=e.branch)||void 0===a?void 0:a.name)||"").toLowerCase();case"guestEmail":return(e.guestEmail||"").toLowerCase();case"guestPhone":return(e.guestPhone||"").toLowerCase();case"amount":return"string"===typeof e.amount?parseFloat(e.amount):e.amount||0;case"arrivalTime":return e.arrivalTime?new Date(e.arrivalTime).getTime():0;default:return""}};return t.sort(((e,t)=>{if(Ya.key){const r=a(e,Ya.key),s=a(t,Ya.key);let n=0;if("number"===typeof r&&"number"===typeof s)n=r-s;else{const e="string"===typeof r?r:String(r),t="string"===typeof s?s:String(s);n=e.localeCompare(t)}if(0!==n)return"asc"===Ya.direction?n:-n}return new Date(t.checkInDate).getTime()-new Date(e.checkInDate).getTime()}))}),[He,dt,ut,it,Ya]),Kr=(0,s.useMemo)((()=>{const e=Ct.filter((e=>null!=e)).filter((e=>{if(Mt){var t;const a=Mt.toLowerCase();return!(!e.customerName||!e.customerName.toLowerCase().includes(a))||(!(!e.customerEmail||!e.customerEmail.toLowerCase().includes(a))||(!(null===(t=e.tour)||void 0===t||!t.title||!e.tour.title.toLowerCase().includes(a))||!(!e.customerPhone||!e.customerPhone.includes(a))))}return!0})),t=(e,t)=>{var a,r,s,n,o,i;switch(t){case"tour.title":return(null===(a=e.tour)||void 0===a||null===(r=a.title)||void 0===r?void 0:r.toLowerCase())||"";case"customerName":return e.customerName.toLowerCase();case"tourDate":return e.tourDate?new Date(e.tourDate).getTime():0;case"numberOfParticipants":return e.numberOfParticipants;case"totalPrice":return"string"===typeof e.totalPrice?parseFloat(e.totalPrice):e.totalPrice||0;case"paymentStatus":return null!==(s={paid:0,partially_paid:1,pending:2,refunded:3}[e.paymentStatus])&&void 0!==s?s:999;case"status":return null!==(n={confirmed:0,completed:1,cancelled:2,no_show:3}[e.status])&&void 0!==n?n:999;case"bookedBy":return e.bookedBy?"".concat(e.bookedBy.firstName," ").concat(e.bookedBy.lastName).toLowerCase():"";case"branch.name":return(null===(o=e.branch)||void 0===o||null===(i=o.name)||void 0===i?void 0:i.toLowerCase())||"";default:return""}};return e.sort(((e,a)=>{if(ha.key){const r=t(e,ha.key),s=t(a,ha.key);let n=0;if("number"===typeof r&&"number"===typeof s)n=r-s;else{const e="string"===typeof r?r:String(r),t="string"===typeof s?s:String(s);n=e.localeCompare(t)}if(0!==n)return"asc"===ha.direction?n:-n}const r=e.tourDate?new Date(e.tourDate).getTime():0;return(a.tourDate?new Date(a.tourDate).getTime():0)-r}))}),[Ct,Mt,ha]);(0,s.useEffect)((()=>{if("todos"!==$)return;const e=new IntersectionObserver((e=>{if(e[0].isIntersecting&&ge&&!he&&!be){const e=Ar.current,t=vr.current,a=fr.current;lr(ua||void 0,t.length>0?t:void 0,!0,20,e,a)}}),{threshold:.1});return wr.current&&e.observe(wr.current),()=>{e.disconnect()}}),[$,ge,he,be,ua,lr]),(0,s.useEffect)((()=>{if("reservations"!==$)return;const e=new IntersectionObserver((e=>{if(e[0].isIntersecting&&Je&&!Xe&&!tt){const e=Cr.current,t=kr.current,a=Nr.current;cr(ra||void 0,t.length>0?t:void 0,a.length>0?a:void 0,!0,20,e)}}),{threshold:.1});return jr.current&&e.observe(jr.current),()=>{e.disconnect()}}),[$,Je,Xe,tt,ra,cr]),(0,s.useEffect)((()=>{if("tourBookings"!==$)return;const e=new IntersectionObserver((e=>{if(e[0].isIntersecting&&It&&!Pt&&!Ot){const e=Tr.current;Er(!0,20,e)}}),{threshold:.1});return Sr.current&&e.observe(Sr.current),()=>{e.disconnect()}}),[$,It,Pt,Ot]);const Gr=(e,t)=>{const a=[...qa.columnOrder],r=a[e];a.splice(e,1),a.splice(t,0,r),Ua(a)},Hr=e=>{Ja(e)},Zr=(e,t)=>{e.preventDefault(),Qa&&Qa!==t&&Xa(t)},Yr=(e,t)=>{if(e.preventDefault(),Qa&&Qa!==t){const e=qa.columnOrder.indexOf(Qa),a=qa.columnOrder.indexOf(t);e>-1&&a>-1&&Gr(e,a)}Ja(null),Xa(null)},Qr=()=>{Ja(null),Xa(null)},Jr=(0,s.useMemo)((()=>{const e=(qa.columnOrder||[]).filter((e=>null!=e&&"string"===typeof e)),t=("todos"===$?De:Pa).filter((t=>!e.includes(t)));return[...e,...t]}),[qa.columnOrder,$,De,Pa]).filter((e=>null!=e&&"string"===typeof e&&Ka(e))),$r=async e=>{try{var t;const a={title:"".concat(e.title,"-Kopie"),description:e.description,status:"open",responsibleId:e.responsible?e.responsible.id:null,roleId:e.role?e.role.id:null,qualityControlId:(null===(t=e.qualityControl)||void 0===t?void 0:t.id)||null,branchId:e.branch.id,dueDate:e.dueDate},r=await B.A.post(_.Sn.TASKS.BASE,a);ae((e=>{const t=[r.data,...e];return t.length>Pe?t.slice(0,Pe):t})),Na(r.data),fa(!0)}catch(s){var a,r;0;const e=s;Ve((null===(a=e.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Xr=async t=>{if(window.confirm(e("worktime.messages.taskDeleteConfirm"))){K.v.log("\ud83d\uddd1\ufe0f Starte L\xf6schung von Task:",t),ae((e=>e.filter((e=>null!=e&&e.id!==t))));try{0,await B.A.delete(_.Sn.TASKS.BY_ID(t)),Ne.oR.success(e("worktime.messages.taskDeleted"))}catch(Me){0,lr(),Ne.oR.error(e("worktime.messages.taskDeletedError"))}}};return(0,q.jsxs)("div",{className:"min-h-screen dark:bg-gray-900",children:[(0,q.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,q.jsxs)("div",{className:"w-full mb-4",children:[(0,q.jsxs)("div",{className:"block sm:hidden w-full",children:[(0,q.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,q.jsxs)("div",{className:"flex items-center justify-between px-3 sm:px-4 md:px-6",children:[(0,q.jsx)("div",{className:"flex items-center",children:a("tasks","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>ya(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tasks.createTask"),children:(0,q.jsx)(x.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.createTask")})]})}),(0,q.jsx)("div",{className:"flex items-center",children:(0,q.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,q.jsxs)("button",{onClick:()=>X("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("todos"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(h.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tasks.title","To Do's")]}),a("reservations","read","table")&&(0,q.jsxs)("button",{onClick:()=>X("reservations"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("reservations"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(p.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("reservations.title","Reservations")]}),a("tour_bookings","read","table")&&(0,q.jsxs)("button",{onClick:()=>X("tourBookings"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("tourBookings"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(b.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tourBookings.title","Tour-Buchungen")]})]})}),(0,q.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,q.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[120px] sm:w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:"todos"===$?Ue:it,onChange:e=>{"todos"===$?We(e.target.value):lt(e.target.value)}}),"reservations"===$&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:async()=>{try{pt(!0),await B.A.post(_.Sn.RESERVATIONS.SYNC),W(e("reservations.syncSuccess","Reservations erfolgreich synchronisiert"),"success"),await cr(void 0,void 0,void 0,!1,20,0)}catch(r){var t,a;0,W((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e("reservations.syncError","Fehler beim Synchronisieren"),"error")}finally{pt(!1)}},disabled:ht,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,q.jsx)(y.A,{className:"h-5 w-5 ".concat(ht?"animate-spin":"")})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:ht?e("reservations.syncing","Synchronisiere..."):e("reservations.sync","Synchronisieren")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===ar?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Ga("table"===ar?"cards":"table"),children:"table"===ar?(0,q.jsx)(v.A,{className:"h-5 w-5"}):(0,q.jsx)(f.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===ar?"common.viewAsCards":"common.viewAsTable")})]}),(0,q.jsxs)("div",{className:"relative group ml-1",children:[(0,q.jsxs)("button",{className:"p-2 rounded-md ".concat(Br()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>xa(!ga),children:[(0,q.jsx)(k.A,{className:"h-5 w-5"}),Br()>0&&(0,q.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Br()})]}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),(0,q.jsx)("div",{className:"ml-1",children:(0,q.jsx)(u.A,{columns:"todos"===$?"cards"===ar?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:G:"reservations"===$?"cards"===ar?[{id:"guestName",label:e("reservations.columns.guestName","Gast")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail")},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon")},{id:"amount",label:e("reservations.columns.amount","Betrag")},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit")}]:J:[],visibleColumns:"cards"===ar?Array.from(nr):Jr,columnOrder:"cards"===ar?rr:qa.columnOrder,onToggleColumnVisibility:e=>{if("cards"===ar){const t=Oe[e];if(t)if("responsibleAndQualityControl"===t){const a="responsible"===e?"qualityControl":"responsible";sr.has(a),qa.hiddenColumns.includes(t);Wa(t)}else Wa(t)}else Wa(e)},onMoveColumn:"cards"===ar?(e,t)=>{const a=[...rr],r=a[e];a.splice(e,1),a.splice(t,0,r);const s=[],n=new Set;a.forEach((e=>{const t=Oe[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),G.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),Ua(s)}:Gr,buttonTitle:e("cards"===ar?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===ar?"tableColumn.sortAndDisplay":"tableColumn.configure"),mainSortConfig:"todos"===$?Ha:void 0,onMainSortChange:or,showMainSort:!0})})]})]}),ga&&(0,q.jsx)("div",{className:"cards"===ar?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:"todos"===$?(0,q.jsx)(ve.A,{columns:Y,onApply:dr,onReset:zr,savedConditions:na,savedOperators:ia,tableId:Ie}):(0,q.jsx)(ve.A,{columns:[{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"branch",label:e("reservations.columns.branch","Niederlassung")}],onApply:ur,onReset:Mr,savedConditions:Jt,savedOperators:Xt,tableId:Re})}),(0,q.jsx)("div",{className:"cards"===ar?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,q.jsx)(fe.A,{tableId:"todos"===$?Ie:Re,onSelectFilter:"todos"===$?dr:ur,onReset:"todos"===$?zr:Mr,activeFilterName:"todos"===$?da:ta,selectedFilterId:"todos"===$?ua:ra,onFilterChange:"todos"===$?mr:gr,defaultFilterName:"todos"===$?"Aktuell":"Hoy"})}),"todos"===$&&"table"===ar?(0,q.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,q.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,q.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,q.jsx)("tr",{children:Jr.map((t=>{const a=G.find((e=>e.id===t));if(!a)return null;let r;return"title"===t&&(r="title"),"status"===t&&(r="status"),"branch"===t&&(r="branch.name"),"dueDate"===t&&(r="dueDate"),(0,q.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(t===$a?"bg-blue-100 dark:bg-blue-800":""," ").concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==t?"cursor-move":""),draggable:!0,onDragStart:()=>Hr(t),onDragOver:e=>Zr(e,t),onDrop:e=>Yr(e,t),onDragEnd:Qr,children:(0,q.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?a.shortLabel:a.label,"actions"!==t&&r&&(0,q.jsx)("button",{type:"button",onClick:r?()=>Pr(r):void 0,className:"ml-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded","aria-label":r&&Ha.key===r?"asc"===Ha.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,title:r&&Ha.key===r?"asc"===Ha.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,disabled:!r,children:(()=>{const e=r&&Ha.key===r;return fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:2519",message:"Visualization render FIRST",data:{sortKey:r,tableSortConfigKey:Ha.key,tableSortConfigDirection:Ha.direction,isActive:e,willShowArrow:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch((()=>{})),e?"asc"===Ha.direction?"\u2191":"\u2193":(0,q.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})()})]})},t)}))})}),(0,q.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Me?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:Me})}):0===Ur.length?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,q.jsx)(b.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,q.jsx)(q.Fragment,{children:Ur.map((t=>{const r=(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,je.F2)(r);return(0,q.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:Jr.map((r=>{switch(r){case"title":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,q.jsxs)("div",{className:"ml-2 relative group",children:[(0,q.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:(0,q.jsx)(w.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.showDescription")}),(0,q.jsx)("div",{className:"absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,q.jsx)(we.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,Se.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},r);case"responsibleAndQualityControl":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"flex flex-col",children:[(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,q.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,q.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,q.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},r);case"branch":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const s=(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description),n=(0,je.F2)(s);return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"text-sm ".concat("none"!==s?n.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,q.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,q.jsx)("div",{className:"status-buttons",children:Fr(t)}),a("tasks","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>{Na(t),fa(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(j.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.edit")})]}),a("tasks","both","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>$r(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,q.jsx)(S.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]}),a("tasks","delete","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Xr(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,q.jsx)(A.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.delete")})]})]})},r);default:return null}}))},t.id)}))})})]})}):"todos"===$?(0,q.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:be&&0===ee.length?(0,q.jsx)(Ce.A,{children:Array(3).fill(null).map(((e,t)=>(0,q.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,q.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,q.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,q.jsxs)("div",{className:"space-y-2",children:[(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))}):Me?(0,q.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:Me}):0===Ur.length?(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,q.jsx)(b.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,q.jsx)(Ce.A,{children:Ur.map((t=>{(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(nr.has("branch")&&s.push({icon:(0,q.jsx)(C.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),nr.has("responsible")){const a=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,q.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:r,section:"main"})}if(nr.has("qualityControl")){const a=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,q.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:r,section:"main"})}if(nr.has("dueDate")){const a=(0,je.Rj)(t.dueDate,"todo",t.title,t.description,(0,q.jsx)(p.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,Te.GP)(e,"dd.MM.yyyy",{locale:Ee.de})),!1);s.push((0,r.A)((0,r.A)({},a),{},{section:"right-inline"}))}nr.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const n=(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,q.jsx)("div",{className:"status-buttons",children:Fr(t)}),a("tasks","write","table")&&(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),Na(t),fa(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(j.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),$r(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,q.jsx)(S.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]})]});return(0,q.jsx)(Ae.A,{title:(0,q.jsxs)("span",{children:[(0,q.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[t.id,":"]})," ",(0,q.jsx)("span",{children:t.title})]}),status:{label:(0,Se.Iw)(t.status,"task",e),color:(0,Se.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:n},t.id)}))})}):null,"reservations"===$&&"cards"===ar&&(0,q.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:rt?(0,q.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:rt}):0===Wr.length?(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,q.jsx)(p.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:it||"all"!==dt||"all"!==ut?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]}):(0,q.jsx)(Ce.A,{children:Wr.map((t=>{var r;const s=e=>{try{const t=new Date(e),a=t.getUTCFullYear(),r=t.getUTCMonth(),s=t.getUTCDate(),n=new Date(a,r,s);return(0,Te.GP)(n,"dd.MM.yyyy",{locale:Ee.de})}catch(t){return e}},n=[],o=(e=>{var t,a;return null!==e.roomNumber&&""!==e.roomNumber.trim()?(null===(t=e.roomNumber)||void 0===t?void 0:t.trim())||null:(null===(a=e.roomDescription)||void 0===a?void 0:a.trim())||null})(t);o&&n.push({icon:(0,q.jsx)(E.A,{className:"h-4 w-4"}),label:e("reservations.room","Zimmer"),value:o,section:"main"}),n.push({icon:(0,q.jsx)(p.A,{className:"h-4 w-4"}),label:e("reservations.checkInOut","Check-in/Check-out"),value:"".concat(s(t.checkInDate)," - ").concat(s(t.checkOutDate)),section:"main"}),t.guestEmail&&n.push({icon:(0,q.jsx)(D.A,{className:"h-4 w-4"}),value:t.guestEmail,section:"left"}),t.guestPhone&&n.push({icon:(0,q.jsx)(I.A,{className:"h-4 w-4"}),value:t.guestPhone,section:"left"}),t.branch&&n.push({icon:(0,q.jsx)(C.A,{className:"h-4 w-4"}),value:t.branch.name,section:"left"}),t.paymentLink&&n.push({icon:(0,q.jsx)(R.A,{className:"h-4 w-4"}),value:(0,q.jsx)("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white break-all",children:e("reservations.paymentLink","Zahlungslink")}),section:"center"});const i=t.lobbyReservationId||t.id.toString(),l=t.guestEmail?"https://app.lobbypms.com/checkinonline/confirmar?codigo=".concat(i,"&email=").concat(encodeURIComponent(t.guestEmail),"&lg=GB"):null;if(l&&n.push({icon:(0,q.jsx)(R.A,{className:"h-4 w-4"}),value:(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white",children:e("reservations.checkInLink","Check-in Link")}),(0,q.jsx)("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l})]}),section:"center"}),n.push({label:e("reservations.status","Status"),value:(0,q.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(_r(t.status)),children:e("reservations.status.".concat(t.status),t.status)}),section:"right"}),n.push({label:e("reservations.paymentStatus","Zahlungsstatus"),value:(0,q.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(qr(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)}),section:"right"}),t.amount){const a="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";n.push({icon:(0,q.jsx)(P.A,{className:"h-4 w-4"}),label:e("reservations.amount","Betrag"),value:"".concat(a," ").concat(t.currency||"COP"),section:"right"})}if(t.arrivalTime){const a=e=>{try{return(0,Te.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:Ee.de})}catch(t){return e}};n.push({icon:(0,q.jsx)(L.A,{className:"h-4 w-4"}),label:e("reservations.arrivalTime","Ankunftszeit"),value:a(t.arrivalTime),section:"right"})}t.doorPin&&n.push({icon:(0,q.jsx)(O.A,{className:"h-4 w-4"}),label:t.doorAppName||e("reservations.doorPin","T\xfcr-PIN"),value:t.doorPin,section:"right"}),t.onlineCheckInCompleted&&n.push({icon:(0,q.jsx)(h.A,{className:"h-4 w-4 text-green-600"}),label:e("reservations.onlineCheckIn","Online Check-in"),value:e("reservations.completed","Abgeschlossen"),section:"right"});const d=a("reservations","write","table");t.id,null===(r=Wr[0])||void 0===r||r.id;const c=d?(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),ft(t),Nt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(F.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),jt(t),At(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,q.jsx)(O.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]})]}):null,u=er.has(t.id),m=(0,q.jsx)("div",{className:"mt-2 pt-3",children:(0,q.jsx)(ce.A,{reservationId:t.id})});return(0,q.jsx)(Ae.A,{title:t.guestName,subtitle:t.lobbyReservationId?"ID: ".concat(t.lobbyReservationId):void 0,metadata:n,actions:c,expandable:m?{isExpanded:u,content:m,onToggle:()=>ir(t.id)}:void 0},t.id)}))})}),"reservations"===$&&Je&&(0,q.jsx)("div",{ref:jr,className:"flex justify-center py-4",children:Xe&&(0,q.jsx)(o.A,{size:24})}),"reservations"===$&&"table"===ar&&(0,q.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,q.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,q.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,q.jsx)("tr",{children:Jr.map((t=>{const a=J.find((e=>e.id===t));if(!a)return null;let r;return"guestName"===t&&(r="guestName"),"status"===t&&(r="status"),"paymentStatus"===t&&(r="paymentStatus"),"checkInDate"===t&&(r="checkInDate"),"checkOutDate"===t&&(r="checkOutDate"),"roomNumber"===t&&(r="roomNumber"),"branch"===t&&(r="branch.name"),"guestEmail"===t&&(r="guestEmail"),"guestPhone"===t&&(r="guestPhone"),"amount"===t&&(r="amount"),"arrivalTime"===t&&(r="arrivalTime"),(0,q.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(t===$a?"bg-blue-100 dark:bg-blue-800":""," ").concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==t?"cursor-move":""),draggable:!0,onDragStart:()=>Hr(t),onDragOver:e=>Zr(e,t),onDrop:e=>Yr(e,t),onDragEnd:Qr,children:(0,q.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?a.shortLabel:a.label,"actions"!==t&&r&&(0,q.jsx)("button",{type:"button",onClick:r?()=>Lr(r):void 0,className:"ml-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded","aria-label":r&&Ya.key===r?"asc"===Ya.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,title:r&&Ya.key===r?"asc"===Ya.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,disabled:!r,children:r&&Ya.key===r?"asc"===Ya.direction?"\u2191":"\u2193":(0,q.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},t)}))})}),(0,q.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:rt?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:rt})}):0===Wr.length?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,q.jsx)(p.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:it||"all"!==dt||"all"!==ut?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]})})}):(0,q.jsx)(q.Fragment,{children:Wr.map((t=>{const r=e=>{try{return(0,Te.GP)(new Date(e),"dd.MM.yyyy",{locale:Ee.de})}catch(t){return e}};return(0,q.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>U("/reservations/".concat(t.id)),children:Jr.map((s=>{var n;switch(s){case"guestName":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:[t.guestName,t.lobbyReservationId&&(0,q.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",t.lobbyReservationId]})]})},s);case"status":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(_r(t.status)),children:e("reservations.status.".concat(t.status),t.status)})},s);case"paymentStatus":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(qr(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})},s);case"checkInDate":case"checkOutDate":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r("checkInDate"===s?t.checkInDate:t.checkOutDate)})},s);case"roomNumber":const o=e=>{var t,a;return null!==e.roomNumber&&""!==e.roomNumber.trim()?(null===(t=e.roomNumber)||void 0===t?void 0:t.trim())||"-":(null===(a=e.roomDescription)||void 0===a?void 0:a.trim())||"-"};return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:o(t)})},s);case"branch":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(n=t.branch)||void 0===n?void 0:n.name)||"-"})},s);case"guestEmail":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestEmail||"-"})},s);case"guestPhone":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestPhone||"-"})},s);case"amount":const i="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[i," ",t.currency||"COP"]})},s);case"arrivalTime":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.arrivalTime?(0,Te.GP)(new Date(t.arrivalTime),"dd.MM.yyyy HH:mm",{locale:Ee.de}):"-"})},s);case"actions":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"flex space-x-2 action-buttons",children:a("reservations","write","table")&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),ft(t),Nt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(F.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),jt(t),At(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,q.jsx)(O.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),U("/reservations/".concat(t.id))},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(w.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails")})]})]})})},s);default:return null}}))},t.id)}))})})]})}),"todos"===$&&ge&&(0,q.jsx)("div",{ref:wr,className:"flex justify-center py-4",children:he&&(0,q.jsx)(o.A,{size:24})}),"tourBookings"===$&&It&&(0,q.jsx)("div",{ref:Sr,className:"flex justify-center py-4",children:Pt&&(0,q.jsx)(o.A,{size:24})})]}),(0,q.jsx)("div",{className:"fixed bottom-13 left-0 right-0 w-full bg-white dark:bg-gray-800 z-9 shadow-lg border-t-0 dark:border-t dark:border-gray-700",children:(0,q.jsx)(ye,{})})]}),(0,q.jsxs)("div",{className:"hidden sm:block",children:[(0,q.jsx)("div",{className:"mb-8",children:(0,q.jsx)(ye,{})}),(0,q.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,q.jsxs)("div",{className:"flex items-center mb-4 justify-between px-3 sm:px-4 md:px-6",children:[(0,q.jsxs)("div",{className:"flex items-center",children:["todos"===$&&a("tasks","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>ya(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tasks.createTask"),"data-onboarding":"create-task-button",children:(0,q.jsx)(x.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.createTask")})]}),"reservations"===$&&a("reservations","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>xt(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("reservations.createReservation.button","Neue Reservierung"),children:(0,q.jsx)(x.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.createReservation.button","Neue Reservierung")})]})]}),(0,q.jsx)("div",{className:"flex items-center",children:(0,q.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,q.jsxs)("button",{onClick:()=>X("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("todos"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(h.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tasks.title","To Do's")]}),a("reservations","read","table")&&(0,q.jsxs)("button",{onClick:()=>X("reservations"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("reservations"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(p.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("reservations.title","Reservations")]}),a("tour_bookings","read","table")&&(0,q.jsxs)("button",{onClick:()=>X("tourBookings"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("tourBookings"===$?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,q.jsx)(b.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tourBookings.title","Tour-Buchungen")]})]})}),(0,q.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,q.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[120px] sm:w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:"todos"===$?Ue:it,onChange:e=>{"todos"===$?We(e.target.value):lt(e.target.value)}}),"reservations"===$&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:async()=>{try{pt(!0),await B.A.post(_.Sn.RESERVATIONS.SYNC),W(e("reservations.syncSuccess","Reservations erfolgreich synchronisiert"),"success"),await cr(void 0,void 0,void 0,!1,20,0)}catch(r){var t,a;0,W((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e("reservations.syncError","Fehler beim Synchronisieren"),"error")}finally{pt(!1)}},disabled:ht,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,q.jsx)(y.A,{className:"h-5 w-5 ".concat(ht?"animate-spin":"")})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:ht?e("reservations.syncing","Synchronisiere..."):e("reservations.sync","Synchronisieren")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===ar?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Ga("table"===ar?"cards":"table"),children:"table"===ar?(0,q.jsx)(v.A,{className:"h-5 w-5"}):(0,q.jsx)(f.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===ar?"common.viewAsCards":"common.viewAsTable")})]}),(0,q.jsxs)("div",{className:"relative group ml-1",children:[(0,q.jsxs)("button",{className:"p-2 rounded-md ".concat(Br()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>xa(!ga),children:[(0,q.jsx)(k.A,{className:"h-5 w-5"}),Br()>0&&(0,q.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Br()})]}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),(0,q.jsx)("div",{className:"ml-1",children:(0,q.jsx)(u.A,{columns:"todos"===$?"cards"===ar?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:G:"reservations"===$?"cards"===ar?[{id:"guestName",label:e("reservations.columns.guestName","Gast")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail")},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon")},{id:"amount",label:e("reservations.columns.amount","Betrag")},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit")}]:J:[],visibleColumns:"cards"===ar?Array.from(nr):Jr,columnOrder:"cards"===ar?rr:qa.columnOrder,onToggleColumnVisibility:e=>{if("cards"===ar){if("todos"===$){const t=Oe[e];if(t)if("responsibleAndQualityControl"===t){const a="responsible"===e?"qualityControl":"responsible";sr.has(a),qa.hiddenColumns.includes(t);Wa(t)}else Wa(t)}else if("reservations"===$){const t=Be[e];t&&Wa(t)}}else Wa(e)},onMoveColumn:"cards"===ar?(e,t)=>{const a=[...rr],r=a[e];a.splice(e,1),a.splice(t,0,r);const s=[],n=new Set;"todos"===$?(a.forEach((e=>{const t=Oe[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),G.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)}))):"reservations"===$&&(a.forEach((e=>{const t=Be[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),J.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)}))),Ua(s)}:Gr,buttonTitle:e("cards"===ar?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===ar?"tableColumn.sortAndDisplay":"tableColumn.configure"),mainSortConfig:"reservations"===$?Ya:void 0,onMainSortChange:or,showMainSort:!0})})]})]}),ga&&(0,q.jsx)("div",{className:"cards"===ar?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:"todos"===$?(0,q.jsx)(ve.A,{columns:Y,onApply:dr,onReset:zr,savedConditions:na,savedOperators:ia,tableId:Ie}):(0,q.jsx)(ve.A,{columns:[{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"branch",label:e("reservations.columns.branch","Niederlassung")}],onApply:ur,onReset:Mr,savedConditions:Jt,savedOperators:Xt,tableId:Re})}),(0,q.jsx)(fe.A,{tableId:"todos"===$?Ie:Re,onSelectFilter:"todos"===$?dr:ur,onReset:"todos"===$?zr:Mr,activeFilterName:"todos"===$?da:ta,selectedFilterId:"todos"===$?ua:ra,onFilterChange:"todos"===$?mr:gr,defaultFilterName:"todos"===$?"Aktuell":"Hoy"}),"todos"===$&&"table"===ar?(0,q.jsx)("div",{className:"overflow-x-auto",children:(0,q.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700","data-onboarding":"task-list",children:[(0,q.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,q.jsx)("tr",{children:Jr.map((t=>{const a=G.find((e=>e.id===t));if(!a)return null;let r;return"title"===t&&(r="title"),"status"===t&&(r="status"),"branch"===t&&(r="branch.name"),"dueDate"===t&&(r="dueDate"),(0,q.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(t===$a?"bg-blue-100 dark:bg-blue-800":""," ").concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==t?"cursor-move":""),draggable:!0,onDragStart:()=>Hr(t),onDragOver:e=>Zr(e,t),onDrop:e=>Yr(e,t),onDragEnd:Qr,children:(0,q.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?a.shortLabel:a.label,"actions"!==t&&r&&(0,q.jsx)("button",{type:"button",onClick:r?()=>Pr(r):void 0,className:"ml-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded","aria-label":r&&Ha.key===r?"asc"===Ha.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,title:r&&Ha.key===r?"asc"===Ha.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,disabled:!r,children:(()=>{const e=r&&Ha.key===r;return fetch("http://127.0.0.1:7242/ingest/4b31729e-838f-41ed-a421-2153ac4e6c3c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Worktracker.tsx:2519",message:"Visualization render FIRST",data:{sortKey:r,tableSortConfigKey:Ha.key,tableSortConfigDirection:Ha.direction,isActive:e,willShowArrow:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch((()=>{})),e?"asc"===Ha.direction?"\u2191":"\u2193":(0,q.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})()})]})},t)}))})}),(0,q.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Me?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:Me})}):0===Ur.length?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,q.jsx)(b.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,q.jsx)(q.Fragment,{children:Ur.map((t=>{const r=(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,je.F2)(r);return(0,q.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:Jr.map((r=>{switch(r){case"title":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,q.jsxs)("div",{className:"ml-2 relative group",children:[(0,q.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:(0,q.jsx)(w.A,{className:"h-5 w-5"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.showDescription")}),(0,q.jsx)("div",{className:"absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,q.jsx)(we.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,Se.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},r);case"responsibleAndQualityControl":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"flex flex-col",children:[(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,q.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,q.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,q.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,q.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},r);case"branch":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const s=(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description),n=(0,je.F2)(s);return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"text-sm ".concat("none"!==s?n.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,q.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,q.jsx)("div",{className:"status-buttons",children:Fr(t)}),a("tasks","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>{Na(t),fa(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(j.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.edit")})]}),a("tasks","both","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>$r(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,q.jsx)(S.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]}),a("tasks","delete","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Xr(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,q.jsx)(A.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.delete")})]})]})},r);default:return null}}))},t.id)}))})})]})}):"todos"===$?(0,q.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:be&&0===ee.length?(0,q.jsx)(Ce.A,{children:Array(3).fill(null).map(((e,t)=>(0,q.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,q.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,q.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,q.jsxs)("div",{className:"space-y-2",children:[(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,q.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))}):Me?(0,q.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:Me}):0===Ur.length?(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,q.jsx)(b.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,q.jsx)(Ce.A,{children:Ur.map((t=>{(0,je.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(nr.has("branch")&&s.push({icon:(0,q.jsx)(C.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),nr.has("responsible")){const a=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,q.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:r,section:"main"})}if(nr.has("qualityControl")){const a=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,q.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:r,section:"main"})}if(nr.has("dueDate")){const a=(0,je.Rj)(t.dueDate,"todo",t.title,t.description,(0,q.jsx)(p.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,Te.GP)(e,"dd.MM.yyyy",{locale:Ee.de})),!1);s.push((0,r.A)((0,r.A)({},a),{},{section:"right-inline"}))}nr.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const n=(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,q.jsx)("div",{className:"status-buttons",children:Fr(t)}),a("tasks","write","table")&&(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),Na(t),fa(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(j.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),$r(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,q.jsx)(S.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]})]});return(0,q.jsx)(Ae.A,{title:(0,q.jsxs)("span",{children:[(0,q.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[t.id,":"]})," ",(0,q.jsx)("span",{children:t.title})]}),status:{label:(0,Se.Iw)(t.status,"task",e),color:(0,Se.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:n},t.id)}))})}):null,"reservations"===$&&"cards"===ar&&(0,q.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:rt?(0,q.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:rt}):0===Wr.length?(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,q.jsx)(p.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:it||"all"!==dt||"all"!==ut?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]}):(0,q.jsx)(Ce.A,{children:Wr.map((t=>{const r=e=>{try{const t=new Date(e),a=t.getUTCFullYear(),r=t.getUTCMonth(),s=t.getUTCDate(),n=new Date(a,r,s);return(0,Te.GP)(n,"dd.MM.yyyy",{locale:Ee.de})}catch(t){return e}},s=[],n=(e=>{var t,a;return null!==e.roomNumber&&""!==e.roomNumber.trim()?(null===(t=e.roomNumber)||void 0===t?void 0:t.trim())||null:(null===(a=e.roomDescription)||void 0===a?void 0:a.trim())||null})(t);n&&s.push({icon:(0,q.jsx)(E.A,{className:"h-4 w-4"}),label:e("reservations.room","Zimmer"),value:n,section:"main"}),s.push({icon:(0,q.jsx)(p.A,{className:"h-4 w-4"}),label:e("reservations.checkInOut","Check-in/Check-out"),value:"".concat(r(t.checkInDate)," - ").concat(r(t.checkOutDate)),section:"main"}),t.guestEmail&&s.push({icon:(0,q.jsx)(D.A,{className:"h-4 w-4"}),value:t.guestEmail,section:"left"}),t.guestPhone&&s.push({icon:(0,q.jsx)(I.A,{className:"h-4 w-4"}),value:t.guestPhone,section:"left"}),t.branch&&s.push({icon:(0,q.jsx)(C.A,{className:"h-4 w-4"}),value:t.branch.name,section:"left"}),t.paymentLink&&s.push({icon:(0,q.jsx)(R.A,{className:"h-4 w-4"}),value:(0,q.jsx)("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white break-all",children:e("reservations.paymentLink","Zahlungslink")}),section:"center"});const o=t.lobbyReservationId||t.id.toString(),i=t.guestEmail?"https://app.lobbypms.com/checkinonline/confirmar?codigo=".concat(o,"&email=").concat(encodeURIComponent(t.guestEmail),"&lg=GB"):null;if(i&&s.push({icon:(0,q.jsx)(R.A,{className:"h-4 w-4"}),value:(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("a",{href:i,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white",children:e("reservations.checkInLink","Check-in Link")}),(0,q.jsx)("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i})]}),section:"center"}),s.push({label:e("reservations.status","Status"),value:(0,q.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(_r(t.status)),children:e("reservations.status.".concat(t.status),t.status)}),section:"right"}),s.push({label:e("reservations.paymentStatus","Zahlungsstatus"),value:(0,q.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(qr(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)}),section:"right"}),t.amount){const a="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";s.push({icon:(0,q.jsx)(P.A,{className:"h-4 w-4"}),label:e("reservations.amount","Betrag"),value:"".concat(a," ").concat(t.currency||"COP"),section:"right"})}if(t.arrivalTime){const a=e=>{try{return(0,Te.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:Ee.de})}catch(t){return e}};s.push({icon:(0,q.jsx)(L.A,{className:"h-4 w-4"}),label:e("reservations.arrivalTime","Ankunftszeit"),value:a(t.arrivalTime),section:"right"})}t.doorPin&&s.push({icon:(0,q.jsx)(O.A,{className:"h-4 w-4"}),label:t.doorAppName||e("reservations.doorPin","T\xfcr-PIN"),value:t.doorPin,section:"right"}),t.onlineCheckInCompleted&&s.push({icon:(0,q.jsx)(h.A,{className:"h-4 w-4 text-green-600"}),label:e("reservations.onlineCheckIn","Online Check-in"),value:e("reservations.completed","Abgeschlossen"),section:"right"});const l=a("reservations","write","table")?(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),ft(t),Nt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(F.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),jt(t),At(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,q.jsx)(O.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]})]}):null,d=er.has(t.id),c=(0,q.jsx)("div",{className:"mt-2 pt-3",children:(0,q.jsx)(ce.A,{reservationId:t.id})});return(0,q.jsx)(Ae.A,{title:t.guestName,subtitle:t.lobbyReservationId?"ID: ".concat(t.lobbyReservationId):void 0,metadata:s,actions:l,expandable:c?{isExpanded:d,content:c,onToggle:()=>ir(t.id)}:void 0},t.id)}))})}),"reservations"===$&&Je&&(0,q.jsx)("div",{ref:jr,className:"flex justify-center py-4",children:Xe&&(0,q.jsx)(o.A,{size:24})}),"reservations"===$&&"table"===ar&&(0,q.jsx)("div",{className:"overflow-x-auto",children:(0,q.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,q.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,q.jsx)("tr",{children:Jr.map((t=>{const a=J.find((e=>e.id===t));if(!a)return null;let r;return"guestName"===t&&(r="guestName"),"status"===t&&(r="status"),"paymentStatus"===t&&(r="paymentStatus"),"checkInDate"===t&&(r="checkInDate"),"checkOutDate"===t&&(r="checkOutDate"),"roomNumber"===t&&(r="roomNumber"),"branch"===t&&(r="branch.name"),"guestEmail"===t&&(r="guestEmail"),"guestPhone"===t&&(r="guestPhone"),"amount"===t&&(r="amount"),"arrivalTime"===t&&(r="arrivalTime"),(0,q.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(t===$a?"bg-blue-100 dark:bg-blue-800":""," ").concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==t?"cursor-move":""),draggable:!0,onDragStart:()=>Hr(t),onDragOver:e=>Zr(e,t),onDrop:e=>Yr(e,t),onDragEnd:Qr,children:(0,q.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?a.shortLabel:a.label,"actions"!==t&&r&&(0,q.jsx)("button",{type:"button",onClick:r?()=>Lr(r):void 0,className:"ml-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded","aria-label":r&&Ya.key===r?"asc"===Ya.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,title:r&&Ya.key===r?"asc"===Ya.direction?e("tableColumn.sortDescending","Absteigend sortieren"):e("tableColumn.sortAscending","Aufsteigend sortieren"):r?e("tableColumn.setMainSort","Sortierung setzen"):void 0,disabled:!r,children:r&&Ya.key===r?"asc"===Ya.direction?"\u2191":"\u2193":(0,q.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},t)}))})}),(0,q.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:rt?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:rt})}):0===Wr.length?(0,q.jsx)("tr",{children:(0,q.jsx)("td",{colSpan:Jr.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,q.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,q.jsx)(p.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,q.jsx)("div",{className:"text-sm",children:it||"all"!==dt||"all"!==ut?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]})})}):(0,q.jsx)(q.Fragment,{children:Wr.map((t=>{const r=e=>{try{return(0,Te.GP)(new Date(e),"dd.MM.yyyy",{locale:Ee.de})}catch(t){return e}};return(0,q.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>U("/reservations/".concat(t.id)),children:Jr.map((s=>{var n;switch(s){case"guestName":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:[t.guestName,t.lobbyReservationId&&(0,q.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",t.lobbyReservationId]})]})},s);case"status":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(_r(t.status)),children:e("reservations.status.".concat(t.status),t.status)})},s);case"paymentStatus":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(qr(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})},s);case"checkInDate":case"checkOutDate":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:r("checkInDate"===s?t.checkInDate:t.checkOutDate)})},s);case"roomNumber":const o=e=>{var t,a;return null!==e.roomNumber&&""!==e.roomNumber.trim()?(null===(t=e.roomNumber)||void 0===t?void 0:t.trim())||"-":(null===(a=e.roomDescription)||void 0===a?void 0:a.trim())||"-"};return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:o(t)})},s);case"branch":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(n=t.branch)||void 0===n?void 0:n.name)||"-"})},s);case"guestEmail":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestEmail||"-"})},s);case"guestPhone":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestPhone||"-"})},s);case"amount":const i="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[i," ",t.currency||"COP"]})},s);case"arrivalTime":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.arrivalTime?(0,Te.GP)(new Date(t.arrivalTime),"dd.MM.yyyy HH:mm",{locale:Ee.de}):"-"})},s);case"actions":return(0,q.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"flex space-x-2 action-buttons",children:a("reservations","write","table")&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),ft(t),Nt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,q.jsx)(F.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),jt(t),At(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,q.jsx)(O.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]}),(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:e=>{e.stopPropagation(),U("/reservations/".concat(t.id))},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:(0,q.jsx)(w.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails")})]})]})})},s);default:return null}}))},t.id)}))})})]})}),"todos"===$&&ge&&(0,q.jsx)("div",{ref:wr,className:"flex justify-center py-4",children:he&&(0,q.jsx)(o.A,{size:24})}),"tourBookings"===$&&It&&(0,q.jsx)("div",{ref:Sr,className:"flex justify-center py-4",children:Pt&&(0,q.jsx)(o.A,{size:24})})]})]})]})}),(0,q.jsx)(Z,{isOpen:ba,onClose:()=>ya(!1),onTaskCreated:e=>{null!=e&&(ae((t=>{const a=t.filter((e=>null!=e));return[e,...a]})),fa(!0),Na(e))}}),ka&&(0,q.jsx)(te,{isOpen:va,onClose:()=>{fa(!1),Na(null)},onTaskUpdated:t=>{null!=t&&(ae((e=>e.filter((e=>null!=e)).map((e=>e.id===t.id?t:e)))),fa(!1),Na(null),Ne.oR.success(e("worktime.messages.taskUpdated")))},task:ka}),(0,q.jsx)(re,{isOpen:gt,onClose:()=>xt(!1),onReservationCreated:async e=>{X("reservations"),await cr(void 0,void 0,!1,20,0)}}),vt&&(0,q.jsx)(le,{isOpen:kt,onClose:()=>{Nt(!1),ft(null)},reservation:vt,onSuccess:async()=>{await cr(void 0,void 0,!1,20,0)}}),wt&&(0,q.jsx)(de,{isOpen:St,onClose:()=>{At(!1),jt(null)},reservation:wt,onSuccess:async()=>{await cr(void 0,void 0,!1,20,0)}}),"tourBookings"===$&&(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsxs)("div",{className:"flex items-center gap-1.5",children:[a("tour_bookings","write","table")&&(0,q.jsxs)("div",{className:"relative group",children:[(0,q.jsx)("button",{onClick:()=>Gt(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tourBookings.create","Neue Buchung"),children:(0,q.jsx)(x.A,{className:"h-4 w-4"})}),(0,q.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tourBookings.create","Neue Buchung")})]}),(0,q.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e("tourBookings.title","Tour-Buchungen")})]}),(0,q.jsx)("div",{className:"max-w-md",children:(0,q.jsx)("input",{type:"text",placeholder:e("common.search","Suchen..."),value:Mt,onChange:e=>Vt(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),Ot?(0,q.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("common.loading")}):Bt?(0,q.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:Bt}):0===Kr.length?(0,q.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("tourBookings.noBookings","Keine Buchungen vorhanden")}):(0,q.jsx)("div",{className:"overflow-x-auto",children:(0,q.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,q.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,q.jsxs)("tr",{children:[(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("tour.title"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.tour","Tour"),"tour.title"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("customerName"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.customerName","Kunde"),"customerName"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("tourDate"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.tourDate","Tour-Datum"),"tourDate"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("numberOfParticipants"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.numberOfParticipants","Teilnehmer"),"numberOfParticipants"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("totalPrice"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.totalPrice","Gesamtpreis"),"totalPrice"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("paymentStatus"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.paymentStatus","Zahlungsstatus"),"paymentStatus"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("status"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.status","Status"),"status"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>Or("bookedBy"),children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[e("tourBookings.bookedBy","Gebucht von"),"bookedBy"===ha.key&&(0,q.jsx)(N.A,{className:"h-4 w-4 ".concat("asc"===ha.direction?"rotate-180":"")})]})}),(0,q.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("common.actions","Aktionen")})]})}),(0,q.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Kr.map((t=>{var r;return(0,q.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(null===(r=t.tour)||void 0===r?void 0:r.title)||"-"})}),(0,q.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t.customerName}),t.customerEmail&&(0,q.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerEmail}),t.customerPhone&&(0,q.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerPhone})]}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,Te.GP)(new Date(t.tourDate),"dd.MM.yyyy",{locale:Ee.de})})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t.numberOfParticipants})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsxs)("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Number(t.totalPrice).toLocaleString()," ",t.currency]})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("paid"===t.paymentStatus?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"partially_paid"===t.paymentStatus?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"pending"===t.paymentStatus?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e("tourBookings.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,q.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("confirmed"===t.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"cancelled"===t.status?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"completed"===t.status?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:e("tourBookings.status.".concat(t.status),t.status)})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.bookedBy?(0,q.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[t.bookedBy.firstName," ",t.bookedBy.lastName]}):(0,q.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"-"})}),(0,q.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,q.jsxs)("div",{className:"flex items-center gap-2",children:[a("tour_bookings","write","table")&&(0,q.jsx)("button",{onClick:()=>{Qt(t),Zt(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",title:e("common.edit","Bearbeiten"),children:(0,q.jsx)(j.A,{className:"h-5 w-5"})}),(0,q.jsx)("button",{onClick:()=>{qt(t),Wt(!0)},className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300",title:e("tours.reservationLink.title","Mit Reservation verkn\xfcpfen"),children:(0,q.jsx)(R.A,{className:"h-5 w-5"})})]})})]},t.id)}))})]})})]}),(0,q.jsx)(se.A,{isOpen:Kt,onClose:()=>Gt(!1),onBookingCreated:async e=>{await Er()}}),(0,q.jsx)(ne,{isOpen:Ht,onClose:()=>{Zt(!1),Qt(null)},booking:Yt,onBookingUpdated:async e=>{await Er()}}),_t&&(0,q.jsx)(oe,{isOpen:Ut,onClose:()=>{Wt(!1),qt(null)},booking:_t,onLinked:async()=>{await Er()}})]})}}}]);
//# sourceMappingURL=316.70ff1fa2.chunk.js.map