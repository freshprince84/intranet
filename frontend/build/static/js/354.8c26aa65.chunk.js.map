{"version":3,"file":"static/js/354.8c26aa65.chunk.js","mappings":"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","sources":["api/apiClient.ts","utils/dateUtils.ts","components/MarkdownPreview.tsx"],"sourcesContent":["import axios, { AxiosRequestConfig, InternalAxiosRequestConfig } from 'axios';\nimport axiosInstance from '../config/axios.ts';\nimport { API_URL } from '../config/api.ts';\n\n// Debugausgaben für die API-Konfiguration\nconsole.log('DEBUGAUSGABE API-Client: API_URL ist:', API_URL);\n\n// Verwende die konfigurierte Instanz aus config/axios.ts\nconst apiClient = axiosInstance;\n\n// Request Interceptor für Debugging (zusätzlich zu dem in axios.ts)\napiClient.interceptors.request.use(\n  (config) => {\n    // Vollständige URL ausgeben\n    const fullUrl = `${config.baseURL}${config.url}`;\n    console.log('DEBUGAUSGABE API-Client: Vollständige Request URL:', fullUrl);\n    console.log('DEBUGAUSGABE API-Client: Request-Methode:', config.method?.toUpperCase());\n    console.log('DEBUGAUSGABE API-Client: Request-Headers:', config.headers);\n    console.log('DEBUGAUSGABE API-Client: Request-Daten:', config.data);\n    \n    const token = localStorage.getItem('token');\n    console.log('DEBUGAUSGABE API-Client: Token vorhanden:', !!token);\n    \n    return config;\n  },\n  (error) => {\n    console.error('DEBUGAUSGABE API-Client: Fehler im Request Interceptor:', error);\n    return Promise.reject(error);\n  }\n);\n\n// Response Interceptor für Debugging (zusätzlich zu dem in axios.ts)\napiClient.interceptors.response.use(\n  (response) => {\n    console.log('DEBUGAUSGABE API-Client: Response erhalten:', response.status, response.config.url);\n    return response;\n  },\n  (error) => {\n    console.error('DEBUGAUSGABE API-Client: Fehler im Response Interceptor:', error.message);\n    \n    if (error.response) {\n      console.error('DEBUGAUSGABE API-Client: Response Status:', error.response.status);\n      console.error('DEBUGAUSGABE API-Client: Response Daten:', error.response.data);\n    } else {\n      console.error('DEBUGAUSGABE API-Client: Keine Response erhalten');\n    }\n    \n    return Promise.reject(error);\n  }\n);\n\n// User API\nexport const userApi = {\n  getAll: () => apiClient.get('/users'),\n  getById: (id: number) => apiClient.get(`/users/${id}`),\n  create: (data: any) => {\n    console.log('DEBUGAUSGABE API-Client: userApi.create wird aufgerufen mit Daten:', data);\n    try {\n      return apiClient.post('/users', data)\n        .then(response => {\n          console.log('DEBUGAUSGABE API-Client: userApi.create Antwort:', response);\n          return response;\n        })\n        .catch(error => {\n          console.error('DEBUGAUSGABE API-Client: userApi.create Fehler:', error.response || error);\n          throw error;\n        });\n    } catch (initError) {\n      console.error('DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in userApi.create:', initError);\n      throw initError;\n    }\n  },\n  update: (id: number, data: any) => apiClient.put(`/users/${id}`, data),\n  updateRoles: (id: number, roleIds: number[]) => apiClient.put(`/users/${id}/roles`, { roleIds }),\n  updateBranches: (id: number, branchIds: number[]) => apiClient.put(`/users/${id}/branches`, { branchIds })\n};\n\n// Role API\nexport const roleApi = {\n  getAll: (branchId?: number) => {\n    console.log('DEBUGAUSGABE API-Client: roleApi.getAll wird aufgerufen', branchId ? `mit branchId=${branchId}` : '');\n    const url = branchId ? `/roles?branchId=${branchId}` : '/roles';\n    return apiClient.get(url)\n      .then(response => {\n        console.log('DEBUGAUSGABE API-Client: roleApi.getAll erfolgreich:', response.data.length, 'Rollen geladen');\n        return response;\n      })\n      .catch(error => {\n        console.error('DEBUGAUSGABE API-Client: roleApi.getAll Fehler:', error.message);\n        throw error;\n      });\n  },\n  getById: (id: number) => {\n    console.log(`DEBUGAUSGABE API-Client: roleApi.getById(${id}) wird aufgerufen`);\n    return apiClient.get(`/roles/${id}`);\n  },\n  create: (data: any) => {\n    console.log('DEBUGAUSGABE API-Client: roleApi.create wird aufgerufen mit Daten:', data);\n    try {\n      return apiClient.post('/roles', data)\n        .then(response => {\n          console.log('DEBUGAUSGABE API-Client: roleApi.create Antwort:', response);\n          return response;\n        })\n        .catch(error => {\n          console.error('DEBUGAUSGABE API-Client: roleApi.create Fehler:', error.response || error);\n          throw error;\n        });\n    } catch (initError) {\n      console.error('DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.create:', initError);\n      throw initError;\n    }\n  },\n  update: (id: number, data: any) => {\n    console.log(`DEBUGAUSGABE API-Client: roleApi.update für ID ${id} wird aufgerufen mit Daten:`, data);\n    try {\n      return apiClient.put(`/roles/${id}`, data)\n        .then(response => {\n          console.log('DEBUGAUSGABE API-Client: roleApi.update Antwort:', response);\n          return response;\n        })\n        .catch(error => {\n          console.error('DEBUGAUSGABE API-Client: roleApi.update Fehler:', error.response || error);\n          throw error;\n        });\n    } catch (initError) {\n      console.error('DEBUGAUSGABE API-Client: Fehler vor dem API-Aufruf in roleApi.update:', initError);\n      throw initError;\n    }\n  },\n  delete: (id: number) => {\n    console.log(`DEBUGAUSGABE API-Client: roleApi.delete(${id}) wird aufgerufen`);\n    return apiClient.delete(`/roles/${id}`);\n  },\n  getRoleBranches: (id: number) => {\n    console.log(`DEBUGAUSGABE API-Client: roleApi.getRoleBranches(${id}) wird aufgerufen`);\n    return apiClient.get(`/roles/${id}/branches`);\n  },\n  updateRoleBranches: (id: number, data: { allBranches?: boolean; branchIds?: number[] }) => {\n    console.log(`DEBUGAUSGABE API-Client: roleApi.updateRoleBranches(${id}) wird aufgerufen mit:`, data);\n    return apiClient.put(`/roles/${id}/branches`, data);\n  }\n};\n\n// Branch API\nexport const branchApi = {\n  getAll: (roleId?: number) => {\n    const url = roleId ? `/branches?roleId=${roleId}` : '/branches';\n    return apiClient.get(url);\n  },\n  getById: (id: number) => apiClient.get(`/branches/${id}`),\n  getUserBranches: () => apiClient.get('/branches/user'),\n  switchBranch: (branchId: number) => apiClient.put('/branches/switch', { branchId }),\n  create: (data: any) => apiClient.post('/branches', data),\n  update: (id: number, data: any) => apiClient.put(`/branches/${id}`, data),\n  delete: (id: number) => apiClient.delete(`/branches/${id}`)\n};\n\nexport default apiClient; ","import { format, parseISO, differenceInMinutes, parse, getWeek, getYear, addDays, startOfWeek } from 'date-fns';\nimport { de } from 'date-fns/locale';\n\n/**\n * Utility-Funktionen für die Datums- und Zeitverarbeitung im Frontend.\n * Diese Funktionen sorgen für eine konsistente Handhabung von Datum und Zeit\n * in allen Komponenten.\n */\n\n/**\n * Formatiert ein Datum für die Anzeige im deutschen Format.\n * @param dateString Das zu formatierende Datum im Format YYYY-MM-DD\n * @returns Formatiertes Datum im Format DD.MM.YYYY oder '-' bei Fehler\n */\nexport const formatDate = (dateString: string): string => {\n    if (!dateString) return '-';\n    \n    try {\n        // Wir erstellen ein neues Date-Objekt und setzen die Uhrzeit auf 12:00 Mittag\n        // um Probleme mit Zeitzonen zu vermeiden\n        const dateParts = dateString.split('-');\n        if (dateParts.length !== 3) return '-';\n        \n        const year = parseInt(dateParts[0]);\n        const month = parseInt(dateParts[1]) - 1; // Monate sind 0-basiert in JavaScript\n        const day = parseInt(dateParts[2]);\n        \n        const date = new Date(year, month, day, 12, 0, 0);\n        \n        return date.toLocaleDateString('de-DE', {\n            day: '2-digit',\n            month: '2-digit',\n            year: 'numeric'\n        });\n    } catch (error) {\n        console.error('Fehler beim Formatieren des Datums:', error);\n        return '-';\n    }\n};\n\n/**\n * Formatiert eine Zeit für die Anzeige basierend auf UTC.\n * @param dateString Das zu formatierende Datum im ISO-Format\n * @returns Formatierte Zeit im Format HH:MM oder '-' bei Fehler\n */\nexport const formatTime = (dateString: string): string => {\n    if (!dateString) return '-';\n    \n    try {\n        // Direkt aus dem ISO-String die Uhrzeit extrahieren ohne Umrechnung\n        const date = parseISO(dateString);\n        \n        // Verwende UTC-Stunden und -Minuten, um die DB-Zeit direkt zu zeigen\n        const hours = date.getUTCHours().toString().padStart(2, '0');\n        const minutes = date.getUTCMinutes().toString().padStart(2, '0');\n        \n        return `${hours}:${minutes}`;\n    } catch (error) {\n        console.error(`Fehler beim Formatieren der Zeit für ${dateString}:`, error);\n        return '-';\n    }\n};\n\n/**\n * Berechnet die Dauer zwischen zwei Zeitpunkten und formatiert sie als \"Nh Nm\".\n * @param startTime Startzeit im ISO-Format\n * @param endTime Endzeit im ISO-Format\n * @returns Formatierte Dauer als \"Nh Nm\" oder '-' bei Fehler\n */\nexport const calculateDuration = (startTime: string, endTime: string | null): string => {\n    if (!startTime || !endTime) return '-';\n    \n    try {\n        // Entferne das 'Z' am Ende der ISO-Strings, um Zeitzonenumrechnungen zu verhindern\n        const startISOString = startTime.endsWith('Z') \n            ? startTime.substring(0, startTime.length - 1)\n            : startTime;\n        \n        const endISOString = endTime.endsWith('Z') \n            ? endTime.substring(0, endTime.length - 1)\n            : endTime;\n        \n        const start = new Date(startISOString);\n        const end = new Date(endISOString);\n        \n        const durationMs = end.getTime() - start.getTime();\n        const durationMinutes = Math.floor(durationMs / (1000 * 60));\n        \n        const hours = Math.floor(durationMinutes / 60);\n        const minutes = durationMinutes % 60;\n        \n        return `${hours}h ${minutes}m`;\n    } catch (error) {\n        console.error('Fehler bei der Dauerberechnung:', error);\n        return '-';\n    }\n};\n\n/**\n * Konvertiert ein Wochenformat (YYYY-Www) in ein Datum (YYYY-MM-DD) für den Montag dieser Woche.\n * @param weekString Wochenformat im Format YYYY-Www\n * @returns Datum des Montags der Woche im Format YYYY-MM-DD\n */\nexport const convertWeekToDate = (weekString: string): string => {\n    try {\n        // Format: YYYY-Www\n        const year = parseInt(weekString.substring(0, 4));\n        const week = parseInt(weekString.substring(6));\n        \n        // Alternative Methode zur Berechnung des Montags für eine Kalenderwoche\n        // Statt parse mit yyyy und ww (was einen Fehler verursacht) verwenden wir\n        // einen direkten Algorithmus zur Berechnung\n        \n        // 1. Beginne mit dem ersten Tag des Jahres\n        const firstDayOfYear = new Date(Date.UTC(year, 0, 1, 12, 0, 0));\n        \n        // 2. Finde den ersten Donnerstag des Jahres (für ISO-Wochen)\n        // Verschiebe den Tag, bis wir am ersten Donnerstag sind\n        const dayOfWeek = firstDayOfYear.getUTCDay(); // 0 = Sonntag, 4 = Donnerstag\n        const daysToThursday = dayOfWeek <= 4 ? 4 - dayOfWeek : 11 - dayOfWeek; // Falls Sonntag ist 7\n        const firstThursday = new Date(Date.UTC(year, 0, 1 + daysToThursday, 12, 0, 0));\n        \n        // 3. Der erste Donnerstag ist immer in der ersten Woche\n        // Jetzt berechnen wir den Donnerstag der gewünschten Woche\n        const targetThursday = new Date(Date.UTC(\n            firstThursday.getUTCFullYear(),\n            firstThursday.getUTCMonth(),\n            firstThursday.getUTCDate() + (7 * (week - 1)),\n            12, 0, 0\n        ));\n        \n        // 4. Berechne den Montag dieser Woche (3 Tage vor dem Donnerstag)\n        const monday = new Date(Date.UTC(\n            targetThursday.getUTCFullYear(),\n            targetThursday.getUTCMonth(),\n            targetThursday.getUTCDate() - 3,\n            12, 0, 0\n        ));\n        \n        // Formatiere das Datum als YYYY-MM-DD\n        const formattedDate = format(monday, 'yyyy-MM-dd');\n        \n        // Protokolliere das berechnete Datum für Debug-Zwecke\n        console.log(`Konvertierte Woche ${weekString} zu Datum: ${formattedDate} (Wochentag: ${format(monday, 'EEEE', { locale: de })})`);\n        \n        // Zusätzliche Sicherheitsüberprüfung: Stelle sicher, dass es ein Montag ist\n        if (format(monday, 'EEEE', { locale: de }) !== 'Montag') {\n            console.warn(`Berechnetes Datum ist kein Montag! Korrigiere...`);\n            // Finde den nächsten Montag\n            const correctedMonday = startOfWeek(monday, { weekStartsOn: 1 });\n            return format(correctedMonday, 'yyyy-MM-dd');\n        }\n        \n        return formattedDate;\n    } catch (error) {\n        console.error('Fehler beim Konvertieren des Wochendatums:', error);\n        // Im Fehlerfall den letzten Montag als Fallback verwenden\n        const fallbackMonday = startOfWeek(new Date(), { weekStartsOn: 1 });\n        return format(fallbackMonday, 'yyyy-MM-dd');\n    }\n};\n\n/**\n * Prüft, ob ein Worktime-Eintrag für den ausgewählten Tag relevant ist.\n * @param worktime Der Worktime-Eintrag\n * @param selectedDate Ausgewähltes Datum im Format YYYY-MM-DD\n * @returns true, wenn der Eintrag für den ausgewählten Tag relevant ist\n */\nexport const isWorktimeRelevantForSelectedDate = (worktime: any, selectedDate: string): boolean => {\n    try {\n        if (!worktime || !worktime.startTime) return false;\n        \n        // Extrahiere nur den Datumsteil (YYYY-MM-DD) aus dem startTime ISO-String\n        const dateOnly = worktime.startTime.split('T')[0];\n        \n        // Vergleiche mit selectedDate\n        return dateOnly === selectedDate;\n    } catch (error) {\n        console.error(\"Fehler beim Prüfen der Relevanz eines Worktime-Eintrags:\", error);\n        return false;\n    }\n};\n\n/**\n * Berechnet die Wochentage von Montag bis Sonntag basierend auf einem Startdatum.\n * @param weekStartDate Montag der Woche im Format YYYY-MM-DD\n * @returns Array von Objekten mit date und day Eigenschaften\n */\nexport const getWeekDays = (weekStartDate: string): Array<{ date: string; day: string }> => {\n    if (!weekStartDate) return [];\n    \n    // Beginne mit dem angegebenen Datum als Montag\n    const weekStart = new Date(weekStartDate);\n    \n    // Berechne alle 7 Tage der Woche\n    const weekDays: Array<{ date: string; day: string }> = [];\n    for (let i = 0; i < 7; i++) {\n        const day = addDays(weekStart, i);\n        const dayInfo = {\n            date: format(day, 'yyyy-MM-dd'),\n            day: format(day, 'EEEE', { locale: de })\n        };\n        weekDays.push(dayInfo);\n    }\n    \n    return weekDays;\n};\n\n/**\n * Formatiert ein ISO-DateTime für die Anzeige im deutschen Format mit Uhrzeit.\n * Diese Funktion wird speziell für Cerebro-Artikel verwendet.\n * @param dateTimeString Das zu formatierende Datum im ISO-Format (z.B. 2023-06-15T14:30:00Z)\n * @returns Formatiertes Datum und Uhrzeit im Format DD.MM.YYYY HH:MM\n */\nexport const formatDateTimeForCerebro = (dateTimeString: string): string => {\n    if (!dateTimeString) return '-';\n    \n    try {\n        const date = new Date(dateTimeString);\n        \n        // Datum und Uhrzeit im deutschen Format\n        return date.toLocaleDateString('de-DE', {\n            day: '2-digit',\n            month: '2-digit',\n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        });\n    } catch (error) {\n        console.error('Fehler beim Formatieren des Datums und der Zeit:', error);\n        return '-';\n    }\n};\n\n/**\n * Berechnet die Quinzena (15-Tage-Periode) für ein gegebenes Datum.\n * Quinzenas sind monatsbasiert:\n * - Erste Quinzena: 1.-15. des Monats\n * - Zweite Quinzena: 16. bis letzter Tag des Monats\n * @param date Datum im Format YYYY-MM-DD\n * @returns Quinzena-String im Format YYYY-MM-Qq (z.B. \"2025-01-Q1\" für erste Quinzena Januar)\n */\nexport const getQuinzenaFromDate = (date: string): string => {\n    try {\n        const dateObj = new Date(date + 'T12:00:00');\n        const year = dateObj.getFullYear();\n        const month = dateObj.getMonth() + 1; // 1-12\n        const day = dateObj.getDate();\n        \n        // Erste Quinzena: 1.-15., Zweite Quinzena: 16.-Monatsende\n        const quinzena = day <= 15 ? 1 : 2;\n        \n        return `${year}-${String(month).padStart(2, '0')}-Q${quinzena}`;\n    } catch (error) {\n        console.error('Fehler beim Berechnen der Quinzena:', error);\n        const today = new Date();\n        const year = today.getFullYear();\n        const month = today.getMonth() + 1;\n        return `${year}-${String(month).padStart(2, '0')}-Q1`;\n    }\n};\n\n/**\n * Konvertiert eine Quinzena (YYYY-MM-Qq) in das Startdatum (erster Tag der Quinzena).\n * @param quinzenaString Quinzena im Format YYYY-MM-Qq (z.B. \"2025-01-Q1\")\n * @returns Datum des ersten Tages der Quinzena im Format YYYY-MM-DD\n */\nexport const convertQuinzenaToDate = (quinzenaString: string): string => {\n    try {\n        // Format: YYYY-MM-Qq oder YYYY-Qqq (für Rückwärtskompatibilität)\n        let year: number, month: number, quinzena: number;\n        \n        if (quinzenaString.includes('-Q')) {\n            // Format: YYYY-MM-Qq oder YYYY-Qqq\n            const parts = quinzenaString.split('-Q');\n            const datePart = parts[0];\n            quinzena = parseInt(parts[1]);\n            \n            if (datePart.includes('-')) {\n                // Format: YYYY-MM-Qq\n                const dateParts = datePart.split('-');\n                year = parseInt(dateParts[0]);\n                month = parseInt(dateParts[1]);\n            } else {\n                // Format: YYYY-Qqq (Rückwärtskompatibilität - berechne Monat basierend auf Quinzena)\n                year = parseInt(datePart);\n                // Für alte Format: Q1 = Jan, Q2 = Feb, etc. (vereinfacht)\n                month = Math.ceil(quinzena / 2);\n            }\n        } else {\n            throw new Error('Ungültiges Quinzena-Format');\n        }\n        \n        // Erste Quinzena beginnt am 1., zweite am 16.\n        const startDay = quinzena === 1 ? 1 : 16;\n        \n        const quinzenaStart = new Date(Date.UTC(year, month - 1, startDay, 12, 0, 0));\n        return format(quinzenaStart, 'yyyy-MM-dd');\n    } catch (error) {\n        console.error('Fehler beim Konvertieren der Quinzena:', error);\n        const fallback = startOfWeek(new Date(), { weekStartsOn: 1 });\n        return format(fallback, 'yyyy-MM-dd');\n    }\n};\n\n/**\n * Berechnet alle Tage einer Quinzena basierend auf einem Startdatum.\n * Erste Quinzena: 15 Tage (1.-15.), Zweite Quinzena: variabel (16.-Monatsende)\n * @param quinzenaStartDate Erster Tag der Quinzena im Format YYYY-MM-DD\n * @returns Array von Objekten mit date und day Eigenschaften\n */\nexport const getQuinzenaDays = (quinzenaStartDate: string): Array<{ date: string; day: string }> => {\n    if (!quinzenaStartDate) return [];\n    \n    const start = new Date(quinzenaStartDate);\n    const year = start.getFullYear();\n    const month = start.getMonth(); // 0-11\n    const day = start.getDate();\n    \n    // Bestimme Anzahl der Tage in der Quinzena\n    let daysCount: number;\n    if (day === 1) {\n        // Erste Quinzena: immer 15 Tage\n        daysCount = 15;\n    } else {\n        // Zweite Quinzena: 16. bis Monatsende\n        // Berechne letzter Tag des Monats\n        const lastDayOfMonth = new Date(year, month + 1, 0).getDate();\n        daysCount = lastDayOfMonth - 15; // 16. bis Monatsende\n    }\n    \n    const quinzenaDays: Array<{ date: string; day: string }> = [];\n    \n    for (let i = 0; i < daysCount; i++) {\n        const currentDay = addDays(start, i);\n        const dayInfo = {\n            date: format(currentDay, 'yyyy-MM-dd'),\n            day: format(currentDay, 'EEEE', { locale: de })\n        };\n        quinzenaDays.push(dayInfo);\n    }\n    \n    return quinzenaDays;\n};\n\n/**\n * Berechnet die aktuelle Quinzena im Format YYYY-MM-Qq.\n * @returns Quinzena-String im Format YYYY-MM-Qq (z.B. \"2025-01-Q1\")\n */\nexport const getCurrentQuinzena = (): string => {\n    const today = new Date();\n    return getQuinzenaFromDate(format(today, 'yyyy-MM-dd'));\n};\n\n/**\n * Hilfsfunktionen für die Datumsbehandlung im Frontend\n */\n\n/**\n * Erstellt ein Date-Objekt ohne Zeitzonenverschiebung\n * @param dateString Ein ISO-Zeitstring\n * @returns Date-Objekt mit korrigiertem Zeitzonenversatz\n */\nexport const createLocalDate = (dateString: string): Date => {\n  const date = new Date(dateString);\n  // Korrigiere den Zeitzonenversatz\n  return new Date(date.getTime() + date.getTimezoneOffset() * 60000);\n};\n\n/* CLAUDE-ANCHOR: TIMEZONE-CONVERSION-001 - Zentrale Timezone-sichere Konvertierung für datetime-local Inputs */\n/**\n * KRITISCH: Konvertiert datetime-local Input-Werte korrekt für die API.\n * \n * PROBLEM: datetime-local gibt lokale Zeit zurück (z.B. \"2024-01-15T14:01\")\n * Wenn wir einfach \":00.000\" anhängen, wird es als UTC interpretiert → 5h Unterschied!\n * \n * LÖSUNG: Explizit als lokale Zeit interpretieren und korrekt formatieren.\n * \n * @param datetimeLocalValue Wert aus datetime-local Input (Format: \"YYYY-MM-DDTHH:mm\")\n * @returns ISO-String der als lokale Zeit interpretiert wird (ohne 'Z' Suffix)\n * \n * @example\n * Input: \"2024-01-15T14:01\" (User gibt 14:01 ein)\n * Output: \"2024-01-15T14:01:00.000\" (wird als lokale Zeit gespeichert)\n * Nicht: \"2024-01-15T14:01:00.000Z\" (würde als UTC interpretiert)\n */\nexport const convertDatetimeLocalToApi = (datetimeLocalValue: string): string => {\n    if (!datetimeLocalValue) {\n        throw new Error('Datetime-local Wert ist erforderlich');\n    }\n    \n    try {\n        // datetime-local Format: \"YYYY-MM-DDTHH:mm\"\n        // Wir fügen nur Sekunden und Millisekunden hinzu, KEIN 'Z' Suffix\n        const apiFormat = `${datetimeLocalValue}:00.000`;\n        \n        // Zusätzliche Validierung: Prüfe ob das Format gültig ist\n        if (!/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}$/.test(apiFormat)) {\n            throw new Error(`Ungültiges Datumsformat: ${apiFormat}`);\n        }\n        \n        return apiFormat;\n    } catch (error) {\n        console.error('Fehler bei der Datetime-Local Konvertierung:', error);\n        throw new Error(`Konvertierung von datetime-local fehlgeschlagen: ${datetimeLocalValue}`);\n    }\n};\n\n/**\n * KRITISCH: Konvertiert API-Zeitstempel zurück zu datetime-local Format.\n * \n * Wird verwendet beim Bearbeiten von Zeiten - konvertiert DB-Zeit zurück zu Input-Format.\n * Behandelt sowohl UTC-Timestamps (mit 'Z') als auch lokale Timestamps (ohne 'Z').\n * \n * @param apiTimestamp Zeitstempel aus der API (ISO-String)\n * @returns Formatiert für datetime-local Input (Format: \"YYYY-MM-DDTHH:mm\")\n * \n * @example\n * Input: \"2024-01-15T14:01:00.000Z\" (UTC aus DB)\n * Output: \"2024-01-15T14:01\" (für datetime-local Input)\n */\nexport const convertApiToDatetimeLocal = (apiTimestamp: string): string => {\n    if (!apiTimestamp) {\n        throw new Error('API-Timestamp ist erforderlich');\n    }\n    \n    try {\n        // Entferne das 'Z' am Ende des Strings, damit JS den Zeitstempel nicht als UTC interpretiert\n        // Dies ist wichtig für konsistente Zeitbehandlung\n        const localISOString = apiTimestamp.endsWith('Z')\n            ? apiTimestamp.substring(0, apiTimestamp.length - 1)\n            : apiTimestamp;\n        \n        const date = new Date(localISOString);\n        \n        // Validierung: Prüfe ob das Datum gültig ist\n        if (isNaN(date.getTime())) {\n            throw new Error(`Ungültiger Zeitstempel: ${apiTimestamp}`);\n        }\n        \n        // Formatiere für datetime-local Input: \"YYYY-MM-DDTHH:mm\"\n        const formattedDate = format(date, 'yyyy-MM-dd');\n        const formattedTime = format(date, 'HH:mm');\n        \n        return `${formattedDate}T${formattedTime}`;\n    } catch (error) {\n        console.error('Fehler bei der API-zu-Datetime-Local Konvertierung:', error);\n        throw new Error(`Konvertierung von API-Timestamp fehlgeschlagen: ${apiTimestamp}`);\n    }\n};\n\n/**\n * Formatiert die Gesamtdauer einer Liste von Beratungen in Stunden und Minuten.\n * Berücksichtigt nur abgeschlossene Beratungen (mit endTime).\n * \n * @param consultations Array von Consultation-Objekten\n * @returns Formatierte Gesamtdauer als \"Xh Ym\" oder \"0h 0m\" bei leerer Liste\n * \n * @example\n * // Bei Beratungen mit Gesamtdauer von 125 Minuten\n * formatTotalDuration(consultations) // \"2h 5m\"\n */\nexport const formatTotalDuration = (consultations: Array<{ startTime: string; endTime: string | null }>): string => {\n    try {\n        // Berechne die Gesamtdauer in Minuten\n        const totalMinutes = consultations.reduce((total, consultation) => {\n            // Nur abgeschlossene Beratungen berücksichtigen\n            if (!consultation.endTime) return total;\n            \n            // Berechne Dauer dieser Beratung in Minuten\n            const startTime = consultation.startTime.endsWith('Z') \n                ? consultation.startTime.substring(0, consultation.startTime.length - 1)\n                : consultation.startTime;\n            \n            const endTime = consultation.endTime.endsWith('Z') \n                ? consultation.endTime.substring(0, consultation.endTime.length - 1)\n                : consultation.endTime;\n            \n            const start = new Date(startTime);\n            const end = new Date(endTime);\n            \n            const durationMs = end.getTime() - start.getTime();\n            const durationMinutes = Math.floor(durationMs / (1000 * 60));\n            \n            return total + durationMinutes;\n        }, 0);\n        \n        // Konvertiere zu Stunden und Minuten\n        const hours = Math.floor(totalMinutes / 60);\n        const minutes = totalMinutes % 60;\n        \n        return `${hours}h ${minutes}m`;\n    } catch (error) {\n        console.error('Fehler bei der Formatierung der Gesamtdauer:', error);\n        return '0h 0m';\n    }\n};\n\n/**\n * Prüft, ob eine Beratung bereits abgerechnet wurde.\n * \n * @param consultation Consultation-Objekt\n * @returns true wenn abgerechnet, false wenn nicht\n */\nexport const isConsultationInvoiced = (consultation: { invoiceItems?: Array<{ invoice: { status: string } }> }): boolean => {\n    return !!(consultation.invoiceItems && consultation.invoiceItems.length > 0);\n};\n\n/**\n * Holt die Rechnungsinformationen einer Beratung.\n * \n * @param consultation Consultation-Objekt\n * @returns Rechnungsinfo oder null wenn nicht abgerechnet\n */\nexport const getConsultationInvoiceInfo = (consultation: { invoiceItems?: Array<{ invoice: { id: number; invoiceNumber: string; status: string; issueDate: string; total: number } }> }) => {\n    if (!consultation.invoiceItems || consultation.invoiceItems.length === 0) {\n        return null;\n    }\n    \n    // Nimm die erste (und normalerweise einzige) Rechnung\n    const firstItem = consultation.invoiceItems[0];\n    return firstItem.invoice;\n};\n\n/**\n * Erstellt einen benutzerfreundlichen Text für den Rechnungsstatus.\n * \n * @param status Rechnungsstatus\n * @returns Deutscher Status-Text\n */\nexport const getInvoiceStatusText = (status: 'DRAFT' | 'SENT' | 'PAID' | 'OVERDUE' | 'CANCELLED'): string => {\n    const statusMap = {\n        'DRAFT': 'Entwurf',\n        'SENT': 'Gesendet',\n        'PAID': 'Bezahlt',\n        'OVERDUE': 'Überfällig',\n        'CANCELLED': 'Storniert'\n    };\n    return statusMap[status] || status;\n};\n\n/**\n * Gibt die Farbe für einen Rechnungsstatus zurück.\n * \n * @param status Rechnungsstatus\n * @returns CSS-Klassen für die Statusfarbe\n */\nexport const getInvoiceStatusColor = (status: 'DRAFT' | 'SENT' | 'PAID' | 'OVERDUE' | 'CANCELLED'): string => {\n    const colorMap = {\n        'DRAFT': 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',\n        'SENT': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',\n        'PAID': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',\n        'OVERDUE': 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300',\n        'CANCELLED': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300'\n    };\n    return colorMap[status] || 'bg-gray-100 text-gray-800';\n}; ","import React, { useState, useEffect } from 'react';\nimport api from '../api/apiClient.ts';\n\ninterface MarkdownPreviewProps {\n  content: string;\n  className?: string;\n  maxHeight?: string | number;\n  temporaryAttachments?: Array<{\n    fileName: string;\n    fileType: string;\n    fileSize: number;\n    file?: File;\n  }>;\n  showImagePreview?: boolean;\n  onlyAttachments?: boolean; // Nur Anhänge rendern, ohne Text\n  attachmentMetadata?: Array<{\n    id: number;\n    fileName: string;\n    fileType: string;\n    url: string;\n  }>; // Attachment-Metadaten für bessere Dateityp-Erkennung\n}\n\n// Komponente für externe Link-Vorschau (wie X.com)\ninterface ExternalLinkPreviewProps {\n  url: string;\n  alt: string;\n}\n\nconst ExternalLinkPreview: React.FC<ExternalLinkPreviewProps> = ({ url, alt }) => {\n  const [preview, setPreview] = useState<{ title: string; thumbnail: string | null; type: string | null } | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  \n  useEffect(() => {\n    const fetchPreview = async () => {\n      try {\n        setLoading(true);\n        setError(false);\n        console.log('🔗 Lade Link-Vorschau für URL:', url);\n        // Verwende Backend-API für Link-Preview\n        const response = await api.get(`/cerebro/links/preview?url=${encodeURIComponent(url)}`);\n        console.log('✅ Link-Vorschau erhalten:', response.data);\n        setPreview(response.data);\n      } catch (err: any) {\n        console.error('❌ Fehler beim Abrufen der Link-Vorschau:', err);\n        console.error('   URL:', url);\n        console.error('   Error Details:', err?.response?.data || err?.message);\n        setError(true);\n        // Fallback: Setze Preview mit URL als Titel\n        setPreview({ title: alt || url, thumbnail: null, type: 'link' });\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    if (url && url.match(/^https?:\\/\\//)) {\n      fetchPreview();\n    } else {\n      setLoading(false);\n    }\n  }, [url, alt]);\n  \n  // Domain extrahieren für Fallback\n  const getDomain = (url: string): string => {\n    try {\n      return new URL(url).hostname.replace('www.', '');\n    } catch {\n      return url;\n    }\n  };\n  \n  const handleClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    window.open(url, '_blank', 'noopener,noreferrer');\n  };\n  \n  const displayTitle = preview?.title || alt || getDomain(url);\n  const displayThumbnail = preview?.thumbnail;\n  \n  return (\n    <div \n      onClick={handleClick}\n      className=\"border border-gray-300 dark:border-gray-600 rounded-xl overflow-hidden bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-all hover:shadow-md\"\n    >\n      {/* Thumbnail-Bild (wenn verfügbar) */}\n      {displayThumbnail ? (\n        <div className=\"w-full h-48 bg-gray-200 dark:bg-gray-700 overflow-hidden relative\">\n          <img \n            src={displayThumbnail} \n            alt={displayTitle}\n            className=\"w-full h-full object-cover\"\n            onError={(e) => {\n              // Fallback bei Bildfehler: Zeige Platzhalter\n              const target = e.target as HTMLImageElement;\n              target.style.display = 'none';\n              const parent = target.parentElement;\n              if (parent) {\n                parent.innerHTML = `\n                  <div class=\"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700 flex items-center justify-center\">\n                    <div class=\"text-white text-center\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-12 w-12 mx-auto mb-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n                      </svg>\n                      <p class=\"text-sm font-medium\">${getDomain(url)}</p>\n                    </div>\n                  </div>\n                `;\n              }\n            }}\n          />\n        </div>\n      ) : (\n        // Fallback: Farbiger Platzhalter mit Domain\n        <div className=\"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700 flex items-center justify-center\">\n          <div className=\"text-white text-center\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-12 w-12 mx-auto mb-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n            </svg>\n            <p className=\"text-sm font-medium\">{getDomain(url)}</p>\n          </div>\n        </div>\n      )}\n      \n      {/* Titel und URL */}\n      <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\n        {loading ? (\n          <div className=\"flex items-center\">\n            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2\"></div>\n            <span className=\"text-sm text-gray-500 dark:text-gray-400\">Lade Vorschau...</span>\n          </div>\n        ) : (\n          <>\n            <h4 className=\"font-semibold text-gray-900 dark:text-white mb-1 line-clamp-2\">\n              {displayTitle}\n            </h4>\n            <div className=\"flex items-center mt-1\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-3 w-3 mr-1 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n              </svg>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">\n                {getDomain(url)}\n              </p>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst MarkdownPreview: React.FC<MarkdownPreviewProps> = ({ \n  content, \n  className = \"\", \n  maxHeight = \"150px\",\n  temporaryAttachments = [],\n  showImagePreview = false,\n  onlyAttachments = false,\n  attachmentMetadata = []\n}) => {\n  // Extrahiere alle Anhänge aus dem Markdown\n  const extractAttachments = () => {\n    const imageMatches = Array.from(content.matchAll(/!\\[(.*?)\\]\\((.*?)\\)/g)).map(match => ({\n      type: 'image',\n      alt: match[1],\n      url: match[2],\n      isTemporary: match[2] === \"wird nach dem Erstellen hochgeladen\"\n    }));\n    \n    // Markdown-Links: [Text](URL)\n    const markdownLinkMatches = Array.from(content.matchAll(/\\[(.*?)\\]\\((.*?)\\)/g))\n      .filter(match => !match[0].startsWith('!')) // Bilder ausschließen\n      .map(match => ({\n        type: 'link',\n        alt: match[1],\n        url: match[2],\n        isTemporary: match[2] === \"wird nach dem Erstellen hochgeladen\"\n      }));\n    \n    // Reine URLs (ohne Markdown-Format): \n    // 1. Mit Protokoll: http:// oder https://\n    // 2. Ohne Protokoll: www.example.com oder example.com\n    // WICHTIG: Nur URLs die nicht bereits in Markdown-Links enthalten sind\n    const rawUrlMatches: Array<{ type: string; alt: string; url: string; isTemporary: boolean }> = [];\n    const allMarkdownUrls = new Set([...imageMatches, ...markdownLinkMatches].map(m => m.url));\n    \n    // Regex für URLs mit Protokoll: https?://...\n    const urlWithProtocolRegex = /(?:^|[\\s\\n])(https?:\\/\\/[^\\s\\n\\)\\]\\>]+)/g;\n    let urlMatch;\n    while ((urlMatch = urlWithProtocolRegex.exec(content)) !== null) {\n      const url = urlMatch[1].trim();\n      // Überspringe URLs, die bereits in Markdown-Links enthalten sind\n      if (!allMarkdownUrls.has(url)) {\n        rawUrlMatches.push({\n          type: 'link',\n          alt: url,\n          url: url,\n          isTemporary: false\n        });\n      }\n    }\n    \n    // Regex für URLs ohne Protokoll: www.example.com oder example.com\n    // Pattern: (www\\.)?[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+\n    // Mindestens 2 Teile (Domain + TLD), z.B. \"example.com\" oder \"www.example.com\"\n    // Stoppt bei Whitespace, Zeilenende, oder schließenden Klammern\n    const urlWithoutProtocolRegex = /(?:^|[\\s\\n])((?:www\\.)?[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?:\\/[^\\s\\n\\)\\]\\>]*)?)(?=[\\s\\n\\)\\]\\>]|$)/g;\n    let urlMatchNoProtocol;\n    while ((urlMatchNoProtocol = urlWithoutProtocolRegex.exec(content)) !== null) {\n      const url = urlMatchNoProtocol[1].trim();\n      \n      // Überspringe, wenn bereits in Markdown-Links enthalten\n      if (allMarkdownUrls.has(url) || allMarkdownUrls.has(`https://${url}`) || allMarkdownUrls.has(`http://${url}`)) {\n        continue;\n      }\n      \n      // Überspringe, wenn bereits als URL mit Protokoll erkannt\n      if (rawUrlMatches.some(m => m.url === url || m.url === `https://${url}` || m.url === `http://${url}`)) {\n        continue;\n      }\n      \n      // Prüfe, ob es wirklich eine URL ist (nicht nur ein Wort)\n      // Mindestens ein Punkt muss vorhanden sein (für TLD)\n      if (url.includes('.')) {\n        // Füge https:// hinzu, wenn kein Protokoll vorhanden ist\n        const fullUrl = url.startsWith('http://') || url.startsWith('https://') ? url : `https://${url}`;\n        rawUrlMatches.push({\n          type: 'link',\n          alt: url,\n          url: fullUrl, // Speichere mit Protokoll für iframe\n          isTemporary: false\n        });\n      }\n    }\n    \n    \n    const allAttachments = [...imageMatches, ...markdownLinkMatches, ...rawUrlMatches];\n    \n    // Duplikate entfernen - gruppieren nach alt (Dateiname) und URL, nur eindeutige behalten\n    const uniqueAttachments = allAttachments.reduce((acc, current) => {\n      const key = `${current.type}-${current.alt}-${current.url}`;\n      if (!acc.some(item => `${item.type}-${item.alt}-${item.url}` === key)) {\n        acc.push(current);\n      }\n      return acc;\n    }, [] as typeof allAttachments);\n    \n    return uniqueAttachments;\n  };\n  \n  // Erstellt temporäre URLs für Dateien\n  const getTemporaryFileUrl = (filename: string): string | null => {\n    const attachment = temporaryAttachments.find(att => att.fileName === filename);\n    if (attachment?.file) {\n      return URL.createObjectURL(attachment.file);\n    }\n    return null;\n  };\n  \n  // Rendere die Anhänge als Tags\n  const renderAttachmentTags = () => {\n    const attachments = extractAttachments();\n    \n    // Keine Anhänge gefunden\n    if (attachments.length === 0) return null;\n    \n    return (\n      <div className=\"flex flex-wrap gap-2 mt-2\">\n        {attachments.map((attachment, index) => {\n          // URL für temporäre Anhänge\n          let url = attachment.url;\n          if (attachment.isTemporary) {\n            const tempUrl = getTemporaryFileUrl(attachment.alt);\n            if (tempUrl) url = tempUrl;\n          }\n          \n          return (\n            <div key={index} className=\"group relative\">\n              {/* Tag */}\n              <div className=\"bg-gray-100 dark:bg-gray-700 rounded px-2 py-1 text-sm flex items-center dark:text-gray-200\">\n                <span className=\"mr-1\">\n                  {attachment.type === 'image' ? \n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                    </svg> : \n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n                    </svg>\n                  }\n                </span>\n                {attachment.alt}\n              </div>\n              \n              {/* Vorschau beim Hover - nur anzeigen wenn URL verfügbar */}\n              {url && url !== \"wird nach dem Erstellen hochgeladen\" && (\n                <div className=\"absolute z-10 bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-lg p-2 rounded-md -bottom-2 left-1/2 transform -translate-x-1/2 translate-y-full max-w-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none\">\n                  {attachment.type === 'image' ? (\n                    <img \n                      src={url} \n                      alt={attachment.alt} \n                      className=\"max-w-full border rounded dark:border-gray-700\" \n                      style={{ maxHeight: '200px', objectFit: 'contain' }}\n                    />\n                  ) : url.match(/^(https?:\\/\\/|blob:)/) ? (\n                    // Für Links mit http/https einen Preview anzeigen\n                    <div className=\"flex items-center\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n                      </svg>\n                      <a \n                        href={url} \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\"\n                        className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n                      >\n                        {attachment.alt}\n                      </a>\n                    </div>\n                  ) : (\n                    // Für andere Dateitypen (PDF, DOC, etc.)\n                    <div className=\"flex items-center\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                      </svg>\n                      <span className=\"dark:text-gray-200\">{attachment.alt}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n\n  // Finde Attachment-Metadaten für einen Dateinamen oder URL\n  const getAttachmentMetadata = (fileName: string, url?: string) => {\n    // Entferne Emojis und Whitespace vom Dateinamen für bessere Erkennung\n    const cleanFileName = fileName.replace(/^[\\u{1F300}-\\u{1F9FF}\\s]+/u, '').trim();\n    \n    // Versuche zuerst nach Dateiname zu suchen\n    let metadata = attachmentMetadata.find(meta => meta.fileName === fileName);\n    \n    // Falls nicht gefunden, versuche mit bereinigtem Dateinamen\n    if (!metadata && cleanFileName !== fileName) {\n      metadata = attachmentMetadata.find(meta => meta.fileName === cleanFileName);\n    }\n    \n    // Falls nicht gefunden, versuche auch nach Dateiname ohne Groß-/Kleinschreibung\n    if (!metadata) {\n      metadata = attachmentMetadata.find(meta => meta.fileName.toLowerCase() === fileName.toLowerCase());\n    }\n    \n    // Falls immer noch nicht gefunden, versuche mit bereinigtem Dateinamen ohne Groß-/Kleinschreibung\n    if (!metadata && cleanFileName !== fileName) {\n      metadata = attachmentMetadata.find(meta => meta.fileName.toLowerCase() === cleanFileName.toLowerCase());\n    }\n    \n    // Falls immer noch nicht gefunden und URL vorhanden, versuche die ID aus der URL zu extrahieren\n    if (!metadata && url && attachmentMetadata.length > 0) {\n      // Versuche Attachment-ID aus URL zu extrahieren\n      // Format: /api/tasks/123/attachments/456 oder /api/requests/123/attachments/456\n      let attachmentIdMatch = url.match(/\\/(?:tasks|requests)\\/\\d+\\/attachments\\/(\\d+)/);\n      if (attachmentIdMatch) {\n        const attachmentId = parseInt(attachmentIdMatch[1], 10);\n        metadata = attachmentMetadata.find(meta => meta.id === attachmentId);\n      }\n      \n      // Auch für Cerebro-Media-URLs: /api/cerebro/media/123/file\n      if (!metadata) {\n        attachmentIdMatch = url.match(/\\/cerebro\\/media\\/(\\d+)\\/file/);\n        if (attachmentIdMatch) {\n          const mediaId = parseInt(attachmentIdMatch[1], 10);\n          metadata = attachmentMetadata.find(meta => meta.id === mediaId);\n        }\n      }\n    }\n    \n    return metadata;\n  };\n  \n  // Rendere Anhänge direkt als Vorschau\n  const renderInlineAttachments = () => {\n    const attachments = extractAttachments();\n    \n    // DEBUG: Logging für Diagnose\n    console.log('📦 renderInlineAttachments aufgerufen:', {\n      contentLength: content.length,\n      attachmentsFound: attachments.length,\n      attachmentMetadataCount: attachmentMetadata.length,\n      attachmentMetadata: attachmentMetadata\n    });\n    \n    // Filtere ungültige Anhänge heraus\n    const validAttachments = attachments.filter(attachment => {\n      let url = attachment.url;\n      if (attachment.isTemporary) {\n        const tempUrl = getTemporaryFileUrl(attachment.alt);\n        if (tempUrl) url = tempUrl;\n      }\n      return url && url !== \"wird nach dem Erstellen hochgeladen\";\n    });\n    \n    if (validAttachments.length === 0) return null;\n    \n    // Rendere alle Anhänge und filtere null-Werte heraus\n    const renderedAttachments = validAttachments\n      .map((attachment, index) => {\n        // Hole Metadaten für diesen Anhang (mit URL als Fallback)\n        let metadata = getAttachmentMetadata(attachment.alt, attachment.url);\n        \n        // Falls Metadaten nicht per Dateiname gefunden wurden, versuche per URL-ID\n        if (!metadata && attachment.url) {\n          // Versuche Task/Request Attachment-ID\n          let attachmentIdMatch = attachment.url.match(/\\/attachments\\/(\\d+)/);\n          if (attachmentIdMatch) {\n            const attachmentId = parseInt(attachmentIdMatch[1]);\n            metadata = attachmentMetadata.find(meta => meta.id === attachmentId);\n          }\n          \n          // Falls nicht gefunden, versuche Cerebro-Media-ID\n          if (!metadata) {\n            attachmentIdMatch = attachment.url.match(/\\/cerebro\\/media\\/(\\d+)\\/file/);\n            if (attachmentIdMatch) {\n              const mediaId = parseInt(attachmentIdMatch[1]);\n              metadata = attachmentMetadata.find(meta => meta.id === mediaId);\n            }\n          }\n        }\n        \n        // WICHTIG: Wenn es ein Cerebro-Media ist, zeige es NICHT als Vorschau an,\n        // sondern nur als einfachen Link, da es bereits separat angezeigt wird\n        // (wie bei Requests & Tasks - siehe IMAGE_PREVIEW_IMPLEMENTATION.md)\n        const isCerebroMedia = attachment.url?.includes('/cerebro/media/');\n        \n        // Bestimme URL: Priorität: Metadaten-URL > Markdown-URL > Temporäre URL\n        let url: string = '';\n        if (metadata?.url) {\n          // Verwende URL aus Metadaten (falls verfügbar)\n          url = metadata.url;\n        } else {\n          // Verwende URL aus Markdown\n          url = attachment.url || '';\n        }\n        \n        // Temporäre URLs haben Vorrang (für neue Uploads)\n        if (attachment.isTemporary) {\n          const tempUrl = getTemporaryFileUrl(attachment.alt);\n          if (tempUrl) url = tempUrl;\n        }\n        \n        // Sicherstellen, dass url definiert ist\n        if (!url || url === \"wird nach dem Erstellen hochgeladen\") {\n          return null;\n        }\n        \n        // Prüfe Dateityp basierend auf Metadaten, URL und Dateiname\n        const fileName = attachment.alt.toLowerCase();\n        \n        // Bestimme Dateityp: Priorität: Metadaten > Markdown-Type > URL/Dateiname\n        let isImage = false;\n        let isPdf = false;\n        \n        // DEBUG: Logging für Diagnose\n        console.log('🔍 Attachment Debug:', {\n          alt: attachment.alt,\n          fileName: fileName,\n          url: url,\n          metadata: metadata,\n          attachmentType: attachment.type\n        });\n        \n        // 1. Prüfe Metadaten (höchste Priorität)\n        if (metadata?.fileType) {\n          isImage = metadata.fileType.startsWith('image/');\n          isPdf = metadata.fileType === 'application/pdf';\n          console.log('✅ Metadaten gefunden:', { fileType: metadata.fileType, isImage, isPdf });\n        }\n        \n        // 2. Falls keine Metadaten, prüfe Markdown-Type\n        if (!metadata && attachment.type === 'image') {\n          isImage = true;\n        }\n        \n        // 3. Falls immer noch nicht bestimmt, prüfe URL und Dateiname\n        if (!metadata) {\n          const urlEndsWithPdf = url && url.toLowerCase().endsWith('.pdf');\n          const urlMatchesPdf = url && url.match(/\\.pdf(\\?|$)/i);\n          const fileNameEndsWithPdf = fileName.endsWith('.pdf');\n          const isApiAttachmentPdf = url && (url.includes('/api/requests/attachments/') || url.includes('/api/tasks/attachments/')) && fileNameEndsWithPdf;\n          const isCerebroMediaPdf = url && url.includes('/cerebro/media/') && fileNameEndsWithPdf;\n          \n          isPdf = urlEndsWithPdf || urlMatchesPdf || fileNameEndsWithPdf || isApiAttachmentPdf || isCerebroMediaPdf;\n          \n          console.log('🔍 PDF-Erkennung (ohne Metadaten):', {\n            urlEndsWithPdf,\n            urlMatchesPdf,\n            fileNameEndsWithPdf,\n            isApiAttachmentPdf,\n            isPdf\n          });\n        }\n        \n        console.log('📄 Finale Entscheidung:', { isImage, isPdf, isExternalLink: url && url.match(/^https?:\\/\\//) && !isImage && !isPdf });\n        \n        const isExternalLink = url && url.match(/^https?:\\/\\//) && !isImage && !isPdf;\n        \n        // WICHTIG: Cerebro-Media-Links werden NICHT als Vorschau angezeigt,\n        // sondern nur als einfacher Link, da sie bereits separat angezeigt werden\n        if (isCerebroMedia) {\n          return (\n            <div key={index} className=\"p-3 flex items-center border rounded-lg bg-gray-50 dark:bg-gray-700/50\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n              </svg>\n              <a \n                href={url} \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n              >\n                {attachment.alt}\n              </a>\n            </div>\n          );\n        }\n        \n        return (\n          <div key={index} className=\"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50\">\n            {isImage ? (\n              // Bild-Vorschau - groß und prominent\n              <div>\n                <img \n                  src={url} \n                  alt={attachment.alt} \n                  className=\"w-full h-auto max-h-96 object-contain\" \n                  style={{ display: 'block' }}\n                />\n              </div>\n            ) : isPdf ? (\n              // PDF-Vorschau\n              <div className=\"p-3\">\n                <div className=\"flex items-center mb-2\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                  </svg>\n                  <span className=\"text-sm font-medium dark:text-gray-200\">{attachment.alt}</span>\n                  <a \n                    href={url} \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"ml-auto text-blue-600 dark:text-blue-400 hover:underline text-sm\"\n                  >\n                    Öffnen\n                  </a>\n                </div>\n                <iframe \n                  src={`${url}#view=FitH`} \n                  className=\"w-full rounded border dark:border-gray-600\"\n                  style={{ height: '400px' }}\n                  title={attachment.alt}\n                />\n              </div>\n            ) : isExternalLink ? (\n              // Externer Link-Vorschau mit iframe\n              <div className=\"p-3\">\n                <div className=\"flex items-center mb-2\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\" />\n                  </svg>\n                  <span className=\"text-sm font-medium dark:text-gray-200 flex-grow\">{attachment.alt || url}</span>\n                  <a \n                    href={url} \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"ml-2 text-blue-600 dark:text-blue-400 hover:underline text-sm\"\n                  >\n                    Öffnen\n                  </a>\n                </div>\n                <iframe \n                  src={url}\n                  className=\"w-full rounded border dark:border-gray-600\"\n                  style={{ height: '400px' }}\n                  title={attachment.alt || 'Web-Vorschau'}\n                  sandbox=\"allow-same-origin allow-scripts allow-popups allow-forms\"\n                />\n              </div>\n            ) : (\n              // Andere Dateitypen\n              <div className=\"p-3 flex items-center\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 mr-2 dark:text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                </svg>\n                <a \n                  href={url} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n                >\n                  {attachment.alt}\n                </a>\n              </div>\n            )}\n          </div>\n        );\n      })\n      .filter((item): item is React.ReactElement => item !== null);\n    \n    // Wenn nach dem Filtern keine Anhänge mehr vorhanden sind, null zurückgeben\n    if (renderedAttachments.length === 0) return null;\n    \n    return (\n      <div className=\"flex flex-col gap-3 mt-2\">\n        {renderedAttachments}\n      </div>\n    );\n  };\n\n  // Nur Anhänge rendern (ohne Text)\n  if (onlyAttachments) {\n    const attachments = renderInlineAttachments();\n    if (!attachments) return <div className={className}></div>;\n    return (\n      <div className={className}>\n        {attachments}\n      </div>\n    );\n  }\n\n  // Für Worktracker-Tooltips den gesamten Inhalt rendern mit Anhang-Vorschauen\n  if (showImagePreview) {\n    const style: React.CSSProperties = {};\n    if (maxHeight === \"none\") {\n      // Keine maxHeight und kein Overflow wenn maxHeight=\"none\"\n      style.overflowY = 'visible';\n    } else {\n      style.maxHeight = maxHeight !== \"150px\" ? maxHeight : \"100%\";\n      style.overflowY = 'auto';\n    }\n    \n    // Extrahiere Anhänge aus dem originalen content\n    const attachments = extractAttachments();\n    \n    // Filtere Bilder heraus, die als große Vorschau gerendert werden sollen\n    const imagesToRender = attachments.filter(attachment => {\n      // WICHTIG: Cerebro-Media-Links werden NICHT als Vorschau gerendert,\n      // da sie bereits separat angezeigt werden (wie bei Requests & Tasks)\n      const isCerebroMedia = attachment.url?.includes('/cerebro/media/');\n      if (isCerebroMedia) {\n        return false; // Cerebro-Media ausschließen\n      }\n      \n      // Hole Metadaten für diesen Anhang (mit URL als Fallback)\n      let metadata = getAttachmentMetadata(attachment.alt, attachment.url);\n      \n      // DEBUG: Logging für Diagnose\n      if (process.env.NODE_ENV === 'development') {\n        console.log('🔍 Bild-Filterung:', {\n          alt: attachment.alt,\n          url: attachment.url,\n          metadata: metadata,\n          attachmentMetadataCount: attachmentMetadata.length,\n          attachmentMetadata: attachmentMetadata\n        });\n      }\n      \n      // Bestimme URL\n      let url: string = '';\n      if (metadata?.url) {\n        url = metadata.url;\n      } else {\n        url = attachment.url || '';\n      }\n      \n      if (attachment.isTemporary) {\n        const tempUrl = getTemporaryFileUrl(attachment.alt);\n        if (tempUrl) url = tempUrl;\n      }\n      \n      if (!url || url === \"wird nach dem Erstellen hochgeladen\") {\n        return false;\n      }\n      \n      // Prüfe ob es ein Bild ist (nicht PDF)\n      let isImage = false;\n      let isPdf = false;\n      \n      if (metadata?.fileType) {\n        isImage = metadata.fileType.startsWith('image/');\n        isPdf = metadata.fileType === 'application/pdf';\n      } else if (attachment.type === 'image') {\n        // Fallback: Wenn kein Metadata, aber type ist 'image', dann ist es ein Bild\n        isImage = true;\n      } else {\n        // Fallback: Prüfe Dateiname oder URL auf Bild-Endungen\n        const imageExtensions = /\\.(jpg|jpeg|png|gif|webp|svg|bmp)(\\?|$)/i;\n        isImage = imageExtensions.test(attachment.alt) || imageExtensions.test(url);\n      }\n      \n      // Nur Bilder rendern, keine PDFs (PDFs werden separat behandelt)\n      return isImage && !isPdf;\n    });\n    \n    // Ersetze Markdown-Links und Bilder im Text durch Platzhalter\n    let processedContent = content;\n    const imageRegex = /!\\[([^\\]]*)\\]\\(([^)]+)\\)/g;\n    const linkRegex = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\n    \n    // Ersetze ALLE Bilder komplett aus dem Text (werden separat als große Vorschau gerendert)\n    // WICHTIG: Muss GLOBAL sein, damit alle Bilder entfernt werden\n    processedContent = processedContent.replace(imageRegex, () => {\n      // Entferne ALLE Bilder komplett - sie werden durch renderFilteredAttachments() gerendert\n      return '';\n    });\n    \n    // Entferne auch alle Leerzeilen, die durch das Entfernen der Bilder entstehen könnten\n    processedContent = processedContent.replace(/\\n{3,}/g, '\\n\\n').trim();\n    \n    // Filtere externe Links heraus, die als Web-Vorschau gerendert werden sollen\n    const externalLinksToRender = attachments.filter(attachment => {\n      // WICHTIG: Cerebro-Media-Links werden NICHT als Web-Vorschau gerendert\n      const isCerebroMedia = attachment.url?.includes('/cerebro/media/');\n      if (isCerebroMedia) {\n        return false;\n      }\n      \n      // Bestimme URL\n      let url: string = '';\n      let metadata = getAttachmentMetadata(attachment.alt, attachment.url);\n      if (metadata?.url) {\n        url = metadata.url;\n      } else {\n        url = attachment.url || '';\n      }\n      \n      if (attachment.isTemporary) {\n        const tempUrl = getTemporaryFileUrl(attachment.alt);\n        if (tempUrl) url = tempUrl;\n      }\n      \n      if (!url || url === \"wird nach dem Erstellen hochgeladen\") {\n        return false;\n      }\n      \n      // Prüfe ob es ein externer Link ist (http://, https://, oder www./Domain ohne Protokoll)\n      // URLs ohne Protokoll werden bereits mit https:// gespeichert (siehe extractAttachments)\n      const isExternalLink = url.match(/^https?:\\/\\//);\n      if (!isExternalLink) {\n        return false;\n      }\n      \n      // Prüfe ob es ein Bild ist (sollte nicht als externer Link behandelt werden)\n      let isImage = false;\n      let isPdf = false;\n      \n      if (metadata?.fileType) {\n        isImage = metadata.fileType.startsWith('image/');\n        isPdf = metadata.fileType === 'application/pdf';\n      } else if (attachment.type === 'image') {\n        isImage = true;\n      } else {\n        // Prüfe URL auf Bild-Endungen\n        const imageExtensions = /\\.(jpg|jpeg|png|gif|webp|svg|bmp)(\\?|$)/i;\n        isImage = imageExtensions.test(url);\n        // Prüfe URL auf PDF\n        const pdfExtensions = /\\.pdf(\\?|$)/i;\n        isPdf = pdfExtensions.test(url);\n      }\n      \n      // Prüfe ob es eine Attachment-URL ist (Tasks/Requests)\n      const isAttachmentUrl = url.includes('/api/requests/attachments/') || \n                             url.includes('/api/tasks/attachments/');\n      \n      // Nur echte externe Links rendern (keine Bilder, PDFs, Attachments)\n      return isExternalLink && !isImage && !isPdf && !isAttachmentUrl;\n    });\n    \n    // Ersetze externe Links aus dem Text (werden separat als Vorschau gerendert)\n    // 1. Markdown-Links: [Text](URL)\n    processedContent = processedContent.replace(linkRegex, (match, alt, url) => {\n      // Überspringe Links, die bereits als Bilder behandelt wurden\n      if (match.startsWith('![')) {\n        return match;\n      }\n      \n      // Prüfe ob es ein externer Link ist, der als Vorschau gerendert wird\n      const isExternalLink = url.match(/^https?:\\/\\//);\n      const isCerebroMedia = url.includes('/cerebro/media/');\n      const isAttachmentUrl = url.includes('/api/requests/attachments/') || \n                             url.includes('/api/tasks/attachments/');\n      \n      // Prüfe ob es ein Bild oder PDF ist\n      const imageExtensions = /\\.(jpg|jpeg|png|gif|webp|svg|bmp)(\\?|$)/i;\n      const pdfExtensions = /\\.pdf(\\?|$)/i;\n      const isImage = imageExtensions.test(url);\n      const isPdf = pdfExtensions.test(url);\n      \n      // Prüfe ob dieser Link in externalLinksToRender enthalten ist\n      const isInExternalLinks = externalLinksToRender.some(link => link.url === url);\n      \n      // Entferne externe Links komplett (werden als Vorschau gerendert)\n      if (isExternalLink && !isCerebroMedia && !isAttachmentUrl && !isImage && !isPdf && isInExternalLinks) {\n        return '';\n      }\n      \n      // Andere Links als Text mit Link-Referenz\n      return `${alt} [Link]`;\n    });\n    \n    // 2. Reine URLs (ohne Markdown-Format): http://, https://, oder www.example.com\n    // Entferne URLs, die in externalLinksToRender enthalten sind\n    externalLinksToRender.forEach(link => {\n      // link.url enthält bereits https:// (wenn ursprünglich ohne Protokoll)\n      // link.alt enthält die ursprüngliche URL (mit oder ohne Protokoll)\n      const originalUrl = link.alt; // Ursprüngliche URL wie im Text\n      const fullUrl = link.url; // URL mit Protokoll für iframe\n      \n      // Erstelle Regex, die die ursprüngliche URL findet (am Zeilenanfang, nach Whitespace, oder am Zeilenende)\n      const urlEscaped = originalUrl.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n      // Finde URL mit optionalem Whitespace davor und danach\n      const urlRegex = new RegExp(`(?:^|[\\\\s\\\\n])(${urlEscaped})(?:[\\\\s\\\\n]|$)`, 'g');\n      processedContent = processedContent.replace(urlRegex, (match, urlMatch) => {\n        // Entferne die URL komplett (wird als Vorschau gerendert)\n        // Behalte nur Whitespace, wenn vorhanden\n        const before = match.substring(0, match.indexOf(urlMatch));\n        const after = match.substring(match.indexOf(urlMatch) + urlMatch.length);\n        return (before.trim() + ' ' + after.trim()).trim() || '';\n      });\n    });\n    \n    // Entferne auch alle Leerzeilen, die durch das Entfernen der Links entstehen könnten\n    processedContent = processedContent.replace(/\\n{3,}/g, '\\n\\n').trim();\n    \n    // Rendere nur die Bilder aus imagesToRender als große Vorschau\n    const renderFilteredAttachments = () => {\n      if (imagesToRender.length === 0) return null;\n      \n      // Entferne Duplikate basierend auf Dateiname und URL\n      const uniqueImages = imagesToRender.reduce((acc, current) => {\n        const key = `${current.alt}-${current.url || ''}`;\n        if (!acc.some(img => `${img.alt}-${img.url || ''}` === key)) {\n          acc.push(current);\n        }\n        return acc;\n      }, [] as typeof imagesToRender);\n      \n      return (\n        <div className=\"flex flex-col gap-3 mt-2\">\n          {uniqueImages.map((attachment, index) => {\n            // Hole Metadaten für diesen Anhang (mit URL als Fallback)\n            let metadata = getAttachmentMetadata(attachment.alt, attachment.url);\n            \n            // Bestimme URL\n            let url: string = '';\n            if (metadata?.url) {\n              url = metadata.url;\n            } else {\n              url = attachment.url || '';\n            }\n            \n            if (attachment.isTemporary) {\n              const tempUrl = getTemporaryFileUrl(attachment.alt);\n              if (tempUrl) url = tempUrl;\n            }\n            \n            if (!url || url === \"wird nach dem Erstellen hochgeladen\") {\n              return null;\n            }\n            \n            return (\n              <div key={`img-${attachment.alt}-${url}-${index}`} className=\"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50\">\n                <img \n                  src={url} \n                  alt={attachment.alt} \n                  className=\"w-full h-auto max-h-96 object-contain\" \n                  style={{ display: 'block' }}\n                />\n              </div>\n            );\n          }).filter((item): item is React.ReactElement => item !== null)}\n        </div>\n      );\n    };\n    \n    // Rendere externe Links als statische Bildvorschau (wie X.com)\n    const renderExternalLinks = () => {\n      if (externalLinksToRender.length === 0) {\n        return null;\n      }\n      \n      // Entferne Duplikate basierend auf URL\n      const uniqueLinks = externalLinksToRender.reduce((acc, current) => {\n        const url = current.url || '';\n        if (!acc.some(link => (link.url || '') === url)) {\n          acc.push(current);\n        }\n        return acc;\n      }, [] as typeof externalLinksToRender);\n      \n      return (\n        <div className=\"flex flex-col gap-3 mt-2\">\n          {uniqueLinks.map((attachment, index) => {\n            // Bestimme URL - prüfe zuerst metadata, dann attachment.url\n            let url: string = '';\n            let metadata = getAttachmentMetadata(attachment.alt, attachment.url);\n            if (metadata?.url) {\n              url = metadata.url;\n            } else {\n              url = attachment.url || '';\n            }\n            \n            if (attachment.isTemporary) {\n              const tempUrl = getTemporaryFileUrl(attachment.alt);\n              if (tempUrl) url = tempUrl;\n            }\n            \n            console.log('🔗 Rendere ExternalLinkPreview:', { url, alt: attachment.alt });\n            \n            return (\n              <ExternalLinkPreview \n                key={`link-${attachment.alt}-${url}-${index}`}\n                url={url}\n                alt={attachment.alt || url || ''}\n              />\n            );\n          })}\n        </div>\n      );\n    };\n    \n    return (\n      <div className={`markdown-preview ${className} dark:text-gray-200`} style={style}>\n        {/* Text-Inhalt ohne Bilder und externe Links */}\n        {processedContent && (\n          <div dangerouslySetInnerHTML={{ __html: processedContent.replace(/\\n/g, '<br/>') }} />\n        )}\n        {/* Bilder als große Vorschau */}\n        {renderFilteredAttachments()}\n        {/* Externe Links als Web-Vorschau */}\n        {renderExternalLinks()}\n      </div>\n    );\n  }\n\n  // Für Modals nur die Anhang-Tags rendern\n  return (\n    <div className={`markdown-preview ${className}`}>\n      {renderAttachmentTags()}\n    </div>\n  );\n};\n\nexport default MarkdownPreview; "],"names":["console","log","API_URL","apiClient","axiosInstance","interceptors","request","use","config","_config$method","fullUrl","concat","baseURL","url","method","toUpperCase","headers","data","token","localStorage","getItem","error","Promise","reject","response","status","message","userApi","getAll","get","getById","id","create","post","then","catch","initError","update","put","updateRoles","roleIds","updateBranches","branchIds","roleApi","branchId","length","delete","getRoleBranches","updateRoleBranches","branchApi","roleId","getUserBranches","switchBranch","formatDate","dateString","dateParts","split","year","parseInt","month","day","Date","toLocaleDateString","formatTime","date","parseISO","hours","getUTCHours","toString","padStart","minutes","getUTCMinutes","calculateDuration","startTime","endTime","startISOString","endsWith","substring","endISOString","start","durationMs","getTime","durationMinutes","Math","floor","convertWeekToDate","weekString","week","dayOfWeek","UTC","getUTCDay","daysToThursday","firstThursday","targetThursday","getUTCFullYear","getUTCMonth","getUTCDate","monday","formattedDate","format","locale","de","warn","correctedMonday","startOfWeek","weekStartsOn","fallbackMonday","isWorktimeRelevantForSelectedDate","worktime","selectedDate","getWeekDays","weekStartDate","weekStart","weekDays","i","addDays","dayInfo","push","formatDateTimeForCerebro","dateTimeString","hour","minute","convertQuinzenaToDate","quinzenaString","quinzena","includes","Error","parts","datePart","ceil","startDay","quinzenaStart","fallback","getQuinzenaDays","quinzenaStartDate","getFullYear","getMonth","daysCount","getDate","quinzenaDays","currentDay","getCurrentQuinzena","today","dateObj","String","getQuinzenaFromDate","createLocalDate","getTimezoneOffset","formatTotalDuration","consultations","totalMinutes","reduce","total","consultation","isConsultationInvoiced","invoiceItems","getConsultationInvoiceInfo","invoice","getInvoiceStatusText","getInvoiceStatusColor","ExternalLinkPreview","_ref","alt","preview","setPreview","useState","loading","setLoading","setError","useEffect","match","async","api","encodeURIComponent","err","_err$response","title","thumbnail","type","fetchPreview","getDomain","URL","hostname","replace","_unused","displayTitle","displayThumbnail","_jsxs","onClick","e","preventDefault","window","open","className","children","_jsx","src","onError","target","style","display","parent","parentElement","innerHTML","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","_Fragment","_ref2","content","maxHeight","temporaryAttachments","showImagePreview","onlyAttachments","attachmentMetadata","extractAttachments","imageMatches","Array","from","matchAll","map","isTemporary","markdownLinkMatches","filter","startsWith","rawUrlMatches","allMarkdownUrls","Set","m","urlWithProtocolRegex","urlMatch","exec","trim","has","urlWithoutProtocolRegex","urlMatchNoProtocol","some","acc","current","key","item","getTemporaryFileUrl","filename","attachment","find","att","fileName","file","createObjectURL","getAttachmentMetadata","cleanFileName","metadata","meta","toLowerCase","attachmentIdMatch","attachmentId","mediaId","attachments","renderInlineAttachments","contentLength","attachmentsFound","attachmentMetadataCount","validAttachments","tempUrl","renderedAttachments","index","_attachment$url","_metadata","_metadata2","isCerebroMedia","isImage","isPdf","attachmentType","fileType","urlEndsWithPdf","urlMatchesPdf","fileNameEndsWithPdf","isApiAttachmentPdf","isCerebroMediaPdf","isExternalLink","href","rel","height","sandbox","overflowY","imagesToRender","_attachment$url2","imageExtensions","test","processedContent","imageRegex","linkRegex","externalLinksToRender","_attachment$url3","isAttachmentUrl","isInExternalLinks","link","forEach","originalUrl","urlEscaped","urlRegex","RegExp","before","indexOf","after","renderFilteredAttachments","uniqueImages","img","renderExternalLinks","uniqueLinks","dangerouslySetInnerHTML","__html","renderAttachmentTags","objectFit"],"sourceRoot":""}