"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[256],{256:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ie});var s=a(5043),r=a(4117),i=a(5590),l=a(1923),d=a(1801),n=a(9837),o=a(9379),c=a(8756),m=a(6981),x=a(4399),u=a(887),g=a(1909),h=a(4850),p=a(1663),b=a(8010),y=a(2302),f=a(2811),v=a(4129),k=a(7012),j=a(6238),w=a(6018),N=a(6443),S=a(7591),W=a(1816),A=a(9422),T=a(579);const C=e=>{let{isOpen:t,onClose:a,onConfirm:i,userName:l}=e;const{t:d}=(0,r.Bd)(),o=new Date,c=(0,n.GP)(o,"yyyy-MM-dd"),m=(0,n.GP)(o,"HH:mm:ss"),[x,u]=(0,s.useState)(c),[g,h]=(0,s.useState)(m),[p,b]=(0,s.useState)(!1);return(0,T.jsx)(w.e,{appear:!0,show:t,as:s.Fragment,children:(0,T.jsxs)(N.lG,{as:"div",className:"relative z-10",onClose:a,children:[(0,T.jsx)(w.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,T.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,T.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,T.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,T.jsx)(w.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,T.jsxs)(N.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all",children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)(N.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 dark:text-white",children:d("teamWorktime.modal.stopTracking.title")}),(0,T.jsxs)("button",{type:"button",className:"bg-white dark:bg-gray-800 rounded-md text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:a,children:[(0,T.jsx)("span",{className:"sr-only",children:d("common.close")}),(0,T.jsx)(S.A,{className:"h-6 w-6","aria-hidden":"true"})]})]}),(0,T.jsx)("div",{className:"mt-2",children:(0,T.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("teamWorktime.modal.stopTracking.description",{userName:l})})}),(0,T.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("teamWorktime.modal.stopTracking.date")}),(0,T.jsx)("input",{type:"date",id:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",value:x,onChange:e=>u(e.target.value)})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("teamWorktime.modal.stopTracking.time")}),(0,T.jsx)("input",{type:"time",id:"time",step:"1",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",value:g,onChange:e=>h(e.target.value)})]})]}),(0,T.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,T.jsx)("button",{type:"button",className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:a,disabled:p,title:d("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{type:"button",className:"p-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{try{b(!0);const e="".concat(x,"T").concat(g);await i(e)}catch(e){console.error("Fehler beim Stoppen der Zeiterfassung:",e)}finally{b(!1)}},disabled:p,title:d(p?"teamWorktime.modal.stopTracking.stopping":"teamWorktime.modal.stopTracking.stop"),children:p?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})})]})]})})})})]})})};var D=a(9248);const E=e=>{let{isOpen:t,onClose:a,onSave:i,userName:l,entries:d,selectedDate:n}=e;const{t:c}=(0,r.Bd)(),[m,x]=(0,s.useState)([]),[u,g]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(d&&d.length>0){const e=d.map((e=>{const t=e.startTime.split("T")[0],a=e.startTime.split("T")[1].substring(0,8),s=e.endTime?e.endTime.split("T")[1].substring(0,8):null;return(0,o.A)((0,o.A)({},e),{},{date:t,startTimeTime:a,endTimeTime:s,isDeleted:!1,isModified:!1})}));x(e)}else x([])}),[d]);const b=e=>{const t=e.filter((e=>!e.isDeleted));for(let a=0;a<t.length;a++){const e=t[a],s=e.startTimeTime,r=e.endTimeTime;if(r&&s>=r)return p("Eintrag ".concat(a+1,": Die Endzeit muss nach der Startzeit liegen.")),!1;for(let i=a+1;i<t.length;i++){const e=t[i],l=e.startTimeTime,d=e.endTimeTime;if(r&&d&&s<d&&r>l||r&&!d&&r>l||d&&!r&&d>s)return p("Es gibt eine \xdcberlappung zwischen Eintrag ".concat(a+1," und Eintrag ").concat(i+1,".")),!1}}return p(null),!0};return(0,T.jsx)(w.e,{appear:!0,show:t,as:s.Fragment,children:(0,T.jsxs)(N.lG,{as:"div",className:"relative z-10",onClose:a,children:[(0,T.jsx)(w.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,T.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,T.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,T.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,T.jsx)(w.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,T.jsxs)(N.lG.Panel,{className:"w-full max-w-xl transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all",children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)(N.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 dark:text-white",children:c("teamWorktime.modal.editWorktimes.title")}),(0,T.jsxs)("button",{type:"button",className:"bg-white dark:bg-gray-800 rounded-md text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:a,children:[(0,T.jsx)("span",{className:"sr-only",children:c("common.close")}),(0,T.jsx)(S.A,{className:"h-6 w-6","aria-hidden":"true"})]})]}),(0,T.jsx)("div",{className:"mt-2",children:(0,T.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c("teamWorktime.modal.editWorktimes.description",{userName:l,date:n.split("-").reverse().join(".")})})}),h&&(0,T.jsx)("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:h}),(0,T.jsx)("div",{className:"mt-4",children:(0,T.jsx)("div",{className:"overflow-hidden border dark:border-gray-700 rounded-lg",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:c("teamWorktime.modal.editWorktimes.columns.number")}),(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:c("teamWorktime.modal.editWorktimes.columns.startTime")}),(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:c("teamWorktime.modal.editWorktimes.columns.endTime")}),(0,T.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:c("common.actions")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===m.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:4,className:"px-4 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:c("teamWorktime.modal.editWorktimes.noEntries")})}):m.map(((e,t)=>(0,T.jsxs)("tr",{className:e.isDeleted?"bg-red-50 dark:bg-red-900":"",children:[(0,T.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t+1}),(0,T.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,T.jsx)("input",{type:"time",step:"1",className:"rounded-md border ".concat(e.isDeleted?"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900":"border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"," shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"),value:e.startTimeTime.substring(0,5),onChange:e=>((e,t)=>{const a=[...m];a[e].startTimeTime!==t&&(a[e].startTimeTime=t,a[e].isModified=!0,x(a),b(a))})(t,e.target.value+":00"),disabled:e.isDeleted})}),(0,T.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,T.jsx)("input",{type:"time",step:"1",className:"rounded-md border ".concat(e.isDeleted?"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900":"border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"," shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"),value:e.endTimeTime?e.endTimeTime.substring(0,5):"",onChange:e=>{const a=e.target.value?e.target.value+":00":null;((e,t)=>{const a=[...m];a[e].endTimeTime!==t&&(a[e].endTimeTime=t,a[e].isModified=!0,x(a),b(a))})(t,a)},disabled:e.isDeleted})}),(0,T.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-right text-sm font-medium",children:(0,T.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...m];t[e].isDeleted=!t[e].isDeleted,t[e].isModified=!0,x(t)})(t),className:"p-1 rounded ".concat(e.isDeleted?"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300":"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300"),title:e.isDeleted?c("teamWorktime.modal.editWorktimes.restore"):c("teamWorktime.modal.editWorktimes.markForDelete"),children:(0,T.jsx)(D.A,{className:"h-5 w-5"})})})]},e.id)))})]})})}),(0,T.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,T.jsx)("button",{type:"button",className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:a,disabled:u,title:c("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{type:"button",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{if(b(m))try{g(!0);const e=m.filter((e=>e.isModified||e.isDeleted)).map((e=>{const t="".concat(e.date,"T").concat(e.startTimeTime),a=e.endTimeTime?"".concat(e.date,"T").concat(e.endTimeTime):null;return(0,o.A)((0,o.A)({},e),{},{startTime:t,endTime:a})}));e.length>0&&await i(e),a()}catch(h){console.error("Fehler beim Speichern der Zeiterfassungen:",h),p(c("teamWorktime.modal.editWorktimes.saveError"))}finally{g(!1)}},disabled:u||Boolean(h),title:c(u?"common.saving":"common.save"),children:u?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})})]})]})})})})]})})};var I=a(4426),L=a(7829),F=a(6400),M=a(2023),q=a(2760),P=a(1713);var z=a(8897),H=a(957),O=a(637);const R=["name","startTime","duration","pauseTime","branch","actions"],G={name:"asc",startTime:"asc",duration:"asc",pauseTime:"asc",branch:"asc"},B={name:["name"],startTime:["startTime"],duration:["duration"],pauseTime:["pauseTime"],branch:["branch"],actions:[]},_={name:"name",startTime:"startTime",duration:"duration",pauseTime:"pauseTime",branch:"branch"},V="workcenter-table",U=e=>{let{activeUsers:t,allWorktimes:a,loading:i,selectedDate:w,onDateChange:N,onStopWorktime:S,onRefresh:W,showTodos:A=!1,showRequests:D=!1}=e;const{t:U}=(0,r.Bd)(),Y=(0,s.useMemo)((()=>[{id:"name",label:U("teamWorktime.columns.name")},{id:"startTime",label:U("teamWorktime.columns.startTime")},{id:"duration",label:U("teamWorktime.columns.duration")},{id:"pauseTime",label:U("teamWorktime.columns.pauseTime")},{id:"branch",label:U("teamWorktime.columns.branch")},{id:"actions",label:U("teamWorktime.columns.actions")}]),[U]),[K,Z]=(0,s.useState)(!1),[Q,$]=(0,s.useState)(!1),[J,X]=(0,s.useState)(null),[ee,te]=(0,s.useState)(""),[ae,se]=(0,s.useState)({key:"startTime",direction:"asc"}),[re,ie]=(0,s.useState)(!1),[le,de]=(0,s.useState)(null),[ne,oe]=(0,s.useState)(!1),[ce,me]=(0,s.useState)(10),[xe,ue]=(0,s.useState)([]),[ge,he]=(0,s.useState)([]),[pe,be]=(0,s.useState)(U("teamWorktime.filters.active")),[ye,fe]=(0,s.useState)(null),[ve,ke]=(0,s.useState)({}),[je,we]=(0,s.useState)({}),[Ne,Se]=(0,s.useState)(new Set),[We,Ae]=(0,s.useState)(!1),[Te,Ce]=(0,s.useState)(!1),{hasPermission:De}=(0,q.S)();(0,s.useEffect)((()=>{(async()=>{if(A&&w)try{Ae(!0);const e=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_BY_USER,{params:{date:w}}),t={};e.data.forEach((e=>{t[e.userId]=e.todos})),ke(t)}catch(e){console.error("Fehler beim Laden der To-Dos:",e)}finally{Ae(!1)}})()}),[A,w]),(0,s.useEffect)((()=>{(async()=>{if(D&&w)try{Ce(!0);const e=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.REQUESTS_BY_USER,{params:{date:w}}),t={};e.data.forEach((e=>{t[e.userId]=e.requests})),we(t)}catch(e){console.error("Fehler beim Laden der Requests:",e)}finally{Ce(!1)}})()}),[D,w]);const Ee=e=>{Se((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},{settings:Ie,updateColumnOrder:Le,updateHiddenColumns:Fe,isColumnVisible:Me,updateViewMode:qe}=(0,M.F)("team_worktime_active",{defaultColumnOrder:R,defaultHiddenColumns:[],defaultViewMode:"cards"}),Pe=Ie.columnOrder,ze=Ie.hiddenColumns,He=Ie.viewMode||"cards",[Oe,Re]=(0,s.useState)((()=>G)),Ge=(0,s.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const a=B[e];a&&a.length>0&&t.push(...a)})),t})(Ie.columnOrder||R)),[Ie.columnOrder]),Be=(0,s.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(B[e]||[]).forEach((e=>t.add(e)))})),t})(Ie.hiddenColumns||[])),[Ie.hiddenColumns]),_e=(0,s.useMemo)((()=>new Set(Ge.filter((e=>!Be.has(e))))),[Ge,Be]);(0,s.useEffect)((()=>{document.querySelectorAll(".dashboard-workcenter-wrapper").forEach((e=>{"cards"===He?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[He]);const Ve=e=>{X(e),Z(!0)},Ue=()=>{Z(!1),X(null)},Ye=e=>{X(e),$(!0)},Ke=()=>{$(!1),X(null)},Ze=e=>{de(e)},Qe=(0,s.useCallback)((e=>{e.preventDefault()}),[]),$e=(0,s.useCallback)(((e,t)=>{if(e.preventDefault(),!le||le===t)return;const a=[...Pe],s=a.indexOf(le),r=a.indexOf(t);a.splice(s,1),a.splice(r,0,le),Le(a)}),[le,Pe,Le]),Je=()=>{de(null)},Xe=()=>xe.length,et=(0,s.useMemo)((()=>{const e=[...a];t.filter((e=>e.startTime.split("T")[0]===w)).forEach((t=>{e.find((e=>e.id===t.id))||e.push(t)}));const s=e.reduce(((e,t)=>{const a=t.user.id;e[a]||(e[a]={user:t.user,branch:t.branch,entries:[],startTime:(0,P.IF)(t.startTime),endTime:t.endTime?(0,P.IF)(t.endTime):null,totalDuration:0,activeEntries:[],hasActiveWorktime:!1});const s=e[a];s.entries.push(t);const r=(0,P.IF)(t.startTime);if(r<s.startTime&&(s.startTime=r),t.endTime){const e=(0,P.IF)(t.endTime);(!s.endTime||e>s.endTime)&&(s.endTime=e)}else s.hasActiveWorktime=!0,s.activeEntries.push(t);if(t.endTime){const e=(0,P.IF)(t.endTime).getTime()-(0,P.IF)(t.startTime).getTime();s.totalDuration+=e}return e}),{});let r=Object.values(s).filter((e=>{const t="".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase(),a=e.user.username.toLowerCase(),s=e.branch.name.toLowerCase(),r=ee.toLowerCase();return!(ee&&!(t.includes(r)||a.includes(r)||s.includes(r)))}));if(xe.length>0){const e={name:(e,t)=>{const a="".concat(e.user.firstName," ").concat(e.user.lastName).toLowerCase(),s=(t.value||"").toLowerCase();return"equals"===t.operator?a===s:"contains"===t.operator?a.includes(s):"startsWith"===t.operator?a.startsWith(s):"endsWith"===t.operator?a.endsWith(s):null},branch:(e,t)=>{const a=e.branch.name.toLowerCase(),s=(t.value||"").toLowerCase();return"equals"===t.operator?a===s:"contains"===t.operator?a.includes(s):"startsWith"===t.operator?a.startsWith(s):"endsWith"===t.operator?a.endsWith(s):null},hasActiveWorktime:(e,t)=>{if("equals"===t.operator){const a="true"===t.value||!0===t.value;return e.hasActiveWorktime===a}return null},duration:(e,t)=>{const a=60*parseInt(t.value||"0")*60*1e3;if("greaterThan"===t.operator)return e.totalDuration>a;if("lessThan"===t.operator)return e.totalDuration<a;if("equals"===t.operator){const t=18e5;return Math.abs(e.totalDuration-a)<=t}return null}},t=(e,t)=>{switch(t){case"name":return"".concat(e.user.firstName," ").concat(e.user.lastName);case"branch":return e.branch.name;case"hasActiveWorktime":return e.hasActiveWorktime;case"duration":return e.totalDuration;case"startTime":return e.startTime;case"endTime":return e.endTime;default:return e[t]}};r=(0,F.W5)(r,xe,ge,t,e)}if("cards"===He){const e=Ge.filter((e=>_e.has(e)));r.sort(((t,a)=>{for(const s of e){const e=Oe[s]||"asc";let r,i;switch(s){case"name":r="".concat(t.user.firstName," ").concat(t.user.lastName).toLowerCase(),i="".concat(a.user.firstName," ").concat(a.user.lastName).toLowerCase();break;case"startTime":r=t.startTime.getTime(),i=a.startTime.getTime();break;case"duration":r=t.totalDuration,i=a.totalDuration;break;case"pauseTime":r=t.endTime?t.endTime.getTime()-t.startTime.getTime()-t.totalDuration:0,i=a.endTime?a.endTime.getTime()-a.startTime.getTime()-a.totalDuration:0;break;case"branch":r=t.branch.name.toLowerCase(),i=a.branch.name.toLowerCase();break;default:continue}let l=0;if(l="number"===typeof r&&"number"===typeof i?r-i:String(r).localeCompare(String(i)),"desc"===e&&(l=-l),0!==l)return l}return 0}))}else ae.key&&r.sort(((e,t)=>{let a,s;return"name"===ae.key?(a="".concat(e.user.firstName," ").concat(e.user.lastName),s="".concat(t.user.firstName," ").concat(t.user.lastName)):"startTime"===ae.key?(a=e.startTime.getTime(),s=t.startTime.getTime()):"duration"===ae.key?(a=e.totalDuration,s=t.totalDuration):"branch"===ae.key?(a=e.branch.name,s=t.branch.name):(a=e[ae.key],s=t[ae.key]),a<s?"asc"===ae.direction?-1:1:a>s?"asc"===ae.direction?1:-1:0}));return r}),[a,t,ee,ae,w,xe,ge,He,Ge,_e,Oe]),tt=(e,t)=>{const a=(null===ae||void 0===ae?void 0:ae.key)===e;return(0,T.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer group relative",onClick:()=>{return t=e,void se((e=>({key:t,direction:e.key===t&&"asc"===e.direction?"desc":"asc"})));var t},draggable:!0,onDragStart:()=>Ze(e),onDragOver:Qe,onDrop:t=>$e(t,e),onDragEnd:Je,children:(0,T.jsxs)("div",{className:"flex items-center ".concat(le===e?"opacity-50":""),children:[(0,T.jsx)(g.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),t," ",a&&("asc"===ae.direction?"\u2191":"\u2193")]})},e)};s.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("Nicht authentifiziert");const t=(await l.A.get("".concat(d.Sn.SAVED_FILTERS.BY_TABLE(V)),{headers:{Authorization:"Bearer ".concat(e)}})).data||[],a=t.some((e=>"Aktive"===e.name||e.name===U("teamWorktime.filters.active")||"Active"===e.name||"Activo"===e.name)),s=t.some((e=>"Alle"===e.name||e.name===U("teamWorktime.filters.all")||"All"===e.name||"Todos"===e.name));if(!a){const t={tableId:V,name:U("teamWorktime.filters.active"),conditions:[{column:"hasActiveWorktime",operator:"equals",value:"true"}],operators:[]};await l.A.post("".concat(d.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),console.log("Aktive-Filter f\xfcr Workcenter erstellt")}if(!s){const t={tableId:V,name:U("teamWorktime.filters.all"),conditions:[],operators:[]};await l.A.post("".concat(d.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),console.log("Alle-Filter f\xfcr Workcenter erstellt")}}catch(e){console.error("Fehler beim Erstellen der Standard-Filter:",e)}})()}),[U]),s.useEffect((()=>{(async()=>{try{const e=await l.A.get(d.Sn.SAVED_FILTERS.BY_TABLE(V)),t=e.data.find((e=>e.name===U("teamWorktime.filters.active")||"Aktive"===e.name||"Active"===e.name||"Activo"===e.name));t&&(be(U("teamWorktime.filters.active")),fe(t.id),at(t.conditions,t.operators))}catch(e){console.error("Fehler beim Setzen des initialen Filters:",e)}})()}),[U]);const at=(e,t)=>{ue(e),he(t)},st=()=>{ue([]),he([]),be(""),fe(null)},rt=(0,s.useMemo)((()=>{const e=new Date;e.setHours(0,0,0,0);const[t,a,s]=w.split("-").map(Number),r=new Date(t,a-1,s);return r.setHours(0,0,0,0),r.getTime()<e.getTime()}),[w]);return(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{const[e,t,a]=w.split("-").map(Number),s=new Date(e,t-1,a),r=(0,c.e)(s,1);N((0,n.GP)(r,"yyyy-MM-dd"))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("common.previousDay")})]}),(0,T.jsx)("div",{className:"relative w-[180px]",children:(0,T.jsx)("input",{type:"date",id:"date-select",className:"block w-full pl-3 pr-8 py-2 text-base border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:w,onChange:e=>N(e.target.value)})}),rt&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{const[e,t,a]=w.split("-").map(Number),s=new Date(e,t-1,a),r=(0,m.f)(s,1);N((0,n.GP)(r,"yyyy-MM-dd"))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("common.nextDay")})]})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"text",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:U("common.searchPlaceholder"),value:ee,onChange:e=>te(e.target.value)}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsx)("button",{type:"button",className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===He?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>qe("table"===He?"cards":"table"),children:"table"===He?(0,T.jsx)(h.A,{className:"h-5 w-5"}):(0,T.jsx)(p.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("table"===He?"common.viewAsCards":"common.viewAsTable")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsxs)("button",{type:"button",className:"p-2 rounded-md ".concat(Xe()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>ie(!re),children:[(0,T.jsx)(b.A,{className:"h-5 w-5"}),Xe()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",style:{position:"absolute",top:"-0.25rem",right:"-0.25rem"},children:Xe()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("common.showFilter")})]}),(0,T.jsx)("div",{className:"ml-1",children:(0,T.jsx)(z.A,{columns:"cards"===He?[{id:"name",label:U("teamWorktime.columns.name")},{id:"startTime",label:U("teamWorktime.columns.startTime")},{id:"duration",label:U("teamWorktime.columns.duration")},{id:"pauseTime",label:U("teamWorktime.columns.pauseTime")},{id:"branch",label:U("teamWorktime.columns.branch")}]:Y,visibleColumns:"cards"===He?Array.from(_e):Pe.filter((e=>!ze.includes(e))),columnOrder:"cards"===He?Ge:Pe,onToggleColumnVisibility:e=>{if("cards"===He){const t=_[e];if(t){const e=ze.includes(t)?ze.filter((e=>e!==t)):[...ze,t];Fe(e)}}else{const t=ze.includes(e)?ze.filter((t=>t!==e)):[...ze,e];Fe(t)}},onMoveColumn:(e,t)=>{if("cards"===He){const a=[...Ge],s=a[e];a.splice(e,1),a.splice(t,0,s);const r=[],i=new Set;a.forEach((e=>{const t=_[e];t&&!i.has(t)&&(i.add(t),r.push(t))})),Y.forEach((e=>{r.includes(e.id)||"actions"===e.id||r.push(e.id)})),Le(r)}else{const a=[...Pe],s=a[e];a.splice(e,1),a.splice(t,0,s),Le(a)}},sortDirections:"cards"===He?Oe:void 0,onSortDirectionChange:"cards"===He?(e,t)=>{Re((a=>(0,o.A)((0,o.A)({},a),{},{[e]:t})))}:void 0,showSortDirection:"cards"===He,buttonTitle:U("cards"===He?"teamWorktime.sortAndDisplay":"teamWorktime.configureColumns"),modalTitle:U("cards"===He?"teamWorktime.sortAndDisplay":"teamWorktime.configureColumns"),onClose:()=>{}})})]})]}),re&&(0,T.jsx)("div",{className:"cards"===He?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(I.A,{columns:[{id:"name",label:U("teamWorktime.columns.name")},{id:"branch",label:U("teamWorktime.columns.branch")},{id:"hasActiveWorktime",label:U("worktime.active")},{id:"duration",label:U("teamWorktime.columns.duration")}],onApply:at,onReset:st,savedConditions:xe,savedOperators:ge,tableId:V})}),(0,T.jsx)("div",{className:"cards"===He?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:V,onSelectFilter:at,onReset:st,activeFilterName:pe,selectedFilterId:ye,onFilterChange:(e,t,a,s)=>{be(e),fe(t),at(a,s)},defaultFilterName:U("teamWorktime.filters.active")})}),"table"===He?(0,T.jsx)("div",{className:"dashboard-workcenter-wrapper border-0 rounded-lg overflow-hidden -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,T.jsx)("tr",{children:Pe.filter((e=>!ze.includes(e))).map((e=>{const t=Y.find((t=>t.id===e));return t?"actions"===e?(0,T.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",draggable:!0,onDragStart:()=>Ze(e),onDragOver:Qe,onDrop:t=>$e(t,e),onDragEnd:Je,children:t.label},e):tt(e,t.label):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===et.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:Pe.filter((e=>!ze.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"Keine Zeiterfassungen gefunden"})}):et.slice(0,ce).map((e=>{const t=e.endTime?e.endTime.getTime()-e.startTime.getTime()-e.totalDuration:0,a=ve[e.user.id]||null,r=je[e.user.id]||null,i=Ne.has(e.user.id),l=A&&a&&a.total>0||D&&r&&r.total>0;return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)("tr",{children:Pe.filter((e=>!ze.includes(e))).map((a=>"name"===a?(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"flex items-center",children:(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.user.firstName," ",e.user.lastName]}),(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.user.username})]})})},a):"startTime"===a?(0,T.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,n.GP)(e.startTime,"dd.MM.yyyy")}),(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,n.GP)(e.startTime,"HH:mm:ss")})]},a):"duration"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,x.m)(new Date(Date.now()-e.totalDuration),{locale:u.de,addSuffix:!1})})},a):"pauseTime"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t>0?(0,x.m)(new Date(Date.now()-t),{locale:u.de,addSuffix:!1}):"-"})},a):"branch"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},a):"actions"===a?(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,T.jsxs)("div",{className:"flex flex-row space-x-2 justify-end items-center",children:[e.hasActiveWorktime&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ve(e),className:"p-1 bg-red-600 text-white rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",children:(0,T.jsx)(y.A,{className:"h-5 w-5 text-white fill-white"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("teamWorktime.actions.stopTracking")})]}),De("team_worktime_control","both","page")&&De("team_worktime","both","table")&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ye(e),className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 edit-button",children:(0,T.jsx)(f.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("teamWorktime.actions.editWorktimes")})]})]})},a):null))}),(A||D)&&l&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:Pe.filter((e=>!ze.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-3",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[A&&a&&a.total>0&&(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["To-Dos (",w,"): ",a.completed," erledigt | ",a.open," offen | ",a.inProgress," in Bearbeitung"]}),(0,T.jsx)("button",{onClick:()=>Ee(e.user.id),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:i?"Weniger anzeigen \u25b2":"Details anzeigen \u25bc"})]}),i&&a.details&&a.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:a.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"done"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"done"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,n.GP)(new Date(e.updatedAt),"HH:mm")]})]},e.id)))})]}),D&&r&&r.total>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Requests (",w,"): ",r.approved," genehmigt | ",r.pending," offen"]}),!A&&(0,T.jsx)("button",{onClick:()=>Ee(e.user.id),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:i?"Weniger anzeigen \u25b2":"Details anzeigen \u25bc"})]}),i&&r.details&&r.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:r.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"approved"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"approved"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,n.GP)(new Date(e.createdAt),"HH:mm")]})]},e.id)))})]})]})})})]},e.user.id)}))})]})}):(0,T.jsx)("div",{className:"dashboard-workcenter-wrapper -mx-3 sm:-mx-4 md:-mx-6",children:0===et.length?(0,T.jsx)("div",{className:"text-center py-8 text-sm text-gray-500 dark:text-gray-400",children:"Keine Zeiterfassungen gefunden"}):(0,T.jsx)(O.A,{gap:"md",children:et.slice(0,ce).map((e=>{const t=e.endTime?e.endTime.getTime()-e.startTime.getTime()-e.totalDuration:0,a=ve[e.user.id]||null,s=je[e.user.id]||null,r=Ne.has(e.user.id),i=A&&a&&a.total>0||D&&s&&s.total>0,l=[],d=[],o=[];_e.has("name")&&d.push({label:"Name",value:"".concat(e.user.firstName," ").concat(e.user.lastName," (").concat(e.user.username,")"),icon:(0,T.jsx)(v.A,{className:"h-4 w-4"})}),_e.has("startTime")&&d.push({label:"Startzeit",value:"".concat((0,n.GP)(e.startTime,"dd.MM.yyyy")," ").concat((0,n.GP)(e.startTime,"HH:mm:ss")),icon:(0,T.jsx)(k.A,{className:"h-4 w-4"})}),_e.has("duration")&&o.push({label:"Arbeitszeit",value:(0,x.m)(new Date(Date.now()-e.totalDuration),{locale:u.de,addSuffix:!1}),icon:(0,T.jsx)(k.A,{className:"h-4 w-4"})}),_e.has("pauseTime")&&o.push({label:"Pausen",value:t>0?(0,x.m)(new Date(Date.now()-t),{locale:u.de,addSuffix:!1}):"-",icon:(0,T.jsx)(k.A,{className:"h-4 w-4"})}),_e.has("branch")&&l.push({label:"Niederlassung",value:e.branch.name,icon:(0,T.jsx)(j.A,{className:"h-4 w-4"})});const c=(0,T.jsxs)("div",{className:"flex flex-row space-x-2 justify-end items-center",children:[e.hasActiveWorktime&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ve(e),className:"p-1 bg-red-600 text-white rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",children:(0,T.jsx)(y.A,{className:"h-5 w-5 text-white fill-white"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("teamWorktime.actions.stopTracking")})]}),De("team_worktime_control","both","page")&&De("team_worktime","both","table")&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>Ye(e),className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:(0,T.jsx)(f.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:U("teamWorktime.actions.editWorktimes")})]})]}),m=i?(0,T.jsxs)("div",{children:[A&&a&&a.total>0&&(0,T.jsxs)("div",{className:"mb-3",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["To-Dos (",w,"): ",a.completed," erledigt | ",a.open," offen | ",a.inProgress," in Bearbeitung"]}),a.details&&a.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:a.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"done"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"done"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,n.GP)(new Date(e.updatedAt),"HH:mm")]})]},e.id)))})]}),D&&s&&s.total>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Requests (",w,"): ",s.approved," genehmigt | ",s.pending," offen"]}),s.details&&s.details.length>0&&(0,T.jsx)("div",{className:"mt-2 space-y-1",children:s.details.map((e=>(0,T.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-2",children:[(0,T.jsx)("span",{className:"approved"===e.status?"text-green-600 dark:text-green-400":"text-gray-400",children:"approved"===e.status?"\u2713":"\u25cb"}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.status,")"]}),(0,T.jsxs)("span",{className:"text-gray-400",children:["- ",(0,n.GP)(new Date(e.createdAt),"HH:mm")]})]},e.id)))})]})]}):null;return(0,T.jsxs)(H.A,{title:"".concat(e.user.firstName," ").concat(e.user.lastName),metadata:l,actions:c,expandable:m?{isExpanded:r,content:m,onToggle:()=>Ee(e.user.id)}:void 0,children:[d.length>0&&(0,T.jsx)("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 mb-3 sm:mb-4",children:d.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-600 dark:text-gray-400",children:[e.icon&&(0,T.jsx)("span",{className:"flex-shrink-0",children:e.icon}),(0,T.jsxs)("span",{className:"font-medium mr-1 whitespace-nowrap",children:[e.label,":"]}),(0,T.jsx)("span",{className:e.className||"text-gray-900 dark:text-white",children:(e.value,e.value)})]},t)))}),o.length>0&&(0,T.jsx)("div",{className:"flex flex-col gap-2 mb-3 sm:mb-4",children:o.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-600 dark:text-gray-400",children:[e.icon&&(0,T.jsx)("span",{className:"flex-shrink-0",children:e.icon}),(0,T.jsxs)("span",{className:"font-medium mr-1 whitespace-nowrap",children:[e.label,":"]}),(0,T.jsx)("span",{className:e.className||"text-gray-900 dark:text-white",children:(e.value,e.value)})]},t)))})]},e.user.id)}))})}),et.length>ce&&(0,T.jsx)("div",{className:"mt-4 flex justify-center",children:(0,T.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-blue-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>me((e=>e+10)),children:["Mehr anzeigen (",et.length-ce," verbleibend)"]})}),K&&J&&(0,T.jsx)(C,{isOpen:K,onClose:Ue,onConfirm:async e=>{if(!J)return;const t=J.activeEntries.length>0?J.activeEntries.reduce(((e,t)=>{const a=(0,P.IF)(e.startTime);return(0,P.IF)(t.startTime)>a?t:e}),J.activeEntries[0]):null;t?await S(t.user.id,e):await S(J.user.id,e),Ue()},userName:"".concat(J.user.firstName," ").concat(J.user.lastName)}),Q&&J&&(0,T.jsx)(E,{isOpen:Q,onClose:Ke,onSave:async e=>{try{await(async e=>{try{const t=e.filter((e=>!e.isDeleted)),a=e.filter((e=>e.isDeleted)).map((e=>e.id)),s=t.map((e=>l.A.put("/worktime/".concat(e.id),{startTime:e.startTime,endTime:e.endTime}))),r=a.map((e=>l.A.delete("/worktime/".concat(e))));return await Promise.all([...s,...r]),{success:!0}}catch(t){throw console.error("Fehler beim Aktualisieren der Zeiterfassungen:",t),t}})(e),W(),alert(U("teamWorktime.messages.saveSuccess")),Ke()}catch(t){console.error("Fehler beim Aktualisieren der Zeiterfassungen:",t);let e=U("teamWorktime.messages.unknownError");t.response?401===t.response.status?e=U("teamWorktime.messages.unauthorized"):403===t.response.status?e=U("teamWorktime.messages.forbidden"):404===t.response.status?e=U("teamWorktime.messages.notFound"):500===t.response.status?e=U("teamWorktime.messages.serverError"):t.response.data&&t.response.data.message&&(e=t.response.data.message):e=t.request?U("teamWorktime.messages.noResponse"):t.message||U("teamWorktime.messages.error"),alert(U("teamWorktime.messages.saveError")+" "+e)}},userName:"".concat(J.user.firstName," ").concat(J.user.lastName),entries:J.entries,selectedDate:w})]})};var Y=a(1369),K=a(3332),Z=a(2517),Q=a(3315);const $="todo-analytics-table",J=["time","title","status","responsible","qualityControl","branch"],X=e=>{let{selectedDate:t}=e;const{t:a}=(0,r.Bd)(),[i,o]=(0,s.useState)([]),[c,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)(null),[g,y]=(0,s.useState)(""),[f,w]=(0,s.useState)([]),[N,S]=(0,s.useState)([]),[A,C]=(0,s.useState)(""),[D,E]=(0,s.useState)(null),[F,q]=(0,s.useState)(!1),{settings:P,isLoading:z,updateColumnOrder:R,updateHiddenColumns:G,toggleColumnVisibility:B,isColumnVisible:_,updateViewMode:V}=(0,M.F)($,{defaultColumnOrder:J,defaultViewMode:"table"}),U=(null===P||void 0===P?void 0:P.columnOrder)||J,X=(null===P||void 0===P?void 0:P.hiddenColumns)||[],ee=U.filter((e=>!X.includes(e))),te=(null===P||void 0===P?void 0:P.viewMode)||"table",[ae,se]=(0,s.useState)(te);(0,s.useEffect)((()=>{null!==P&&void 0!==P&&P.viewMode&&P.viewMode!==ae&&se(P.viewMode)}),[null===P||void 0===P?void 0:P.viewMode]);const[re,ie]=(0,s.useState)(new Set),le=e=>{ie((t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}))},[de,ne]=(0,s.useState)(null),[oe,ce]=(0,s.useState)(!1),[me,xe]=(0,s.useState)(!1),[ue,ge]=(0,s.useState)(null),[he,pe]=(0,s.useState)(!1),[be,ye]=(0,s.useState)(!1),[fe,ve]=(0,s.useState)(new Set),ke=(0,s.useMemo)((()=>[{id:"time",label:a("analytics.todo.columns.time")},{id:"title",label:a("analytics.todo.columns.title")},{id:"status",label:a("analytics.todo.columns.status")},{id:"responsible",label:a("analytics.todo.columns.responsible")},{id:"qualityControl",label:a("analytics.todo.columns.qualityControl")},{id:"branch",label:a("analytics.todo.columns.branch")}]),[a]);(0,s.useEffect)((()=>{t&&(async()=>{try{m(!0),u(null);const e={date:t};f.forEach((t=>{"branch"===t.column&&t.value&&(e.branchId=t.value),"responsible"===t.column&&t.value&&(e.userId=t.value),"status"===t.column&&t.value}));const a=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_CHRONOLOGICAL,{params:e});o(a.data||[])}catch(x){console.error("Fehler beim Laden der To-Dos:",x),u(a("analytics.todo.loadError"))}finally{m(!1)}})()}),[t,f]),(0,s.useEffect)((()=>{(async()=>{if(t&&me)try{ce(!0);const e=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_FREQUENCY,{params:{date:t}});ne(e.data)}catch(x){console.error("Fehler beim Laden der H\xe4ufigkeitsanalyse:",x)}finally{ce(!1)}})()}),[t,me]),(0,s.useEffect)((()=>{(async()=>{if(t&&be)try{pe(!0);const e=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.TODOS_SHIFTS,{params:{date:t}});ge(e.data)}catch(x){console.error("Fehler beim Laden der Schicht-Analyse:",x)}finally{pe(!1)}})()}),[t,be]);const je=(0,s.useCallback)(((e,t)=>{w(e),S(t),q(!1)}),[]),we=(0,s.useCallback)((()=>{w([]),S([]),C(""),E(null)}),[]),Ne=(0,s.useCallback)(((e,t,a,s)=>{C(e),E(t),je(a,s)}),[je]),Se=(0,s.useCallback)((()=>f.filter((e=>""!==e.column&&null!==e.value)).length),[f]),We=e=>{switch(e){case"done":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"quality_control":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"open":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"improval":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Ae=e=>({done:"Erledigt",in_progress:"In Bearbeitung",quality_control:"Qualit\xe4tskontrolle",open:"Offen",improval:"Nachbesserung"}[e]||e),Te=(0,s.useMemo)((()=>{let e=[...i];if(g){const t=g.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)||e.responsible&&"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)))}return f.forEach(((t,a)=>{if(""===t.column||null===t.value)return;const s=t.operator||"equals",r=t.value;e=e.filter((e=>{switch(t.column){case"status":return"equals"!==s||e.status===r;case"title":return"contains"!==s||e.title.toLowerCase().includes(String(r).toLowerCase());default:return!0}}))})),e}),[i,g,f]),Ce=(0,s.useMemo)((()=>({total:Te.length,done:Te.filter((e=>"done"===e.status)).length,inProgress:Te.filter((e=>"in_progress"===e.status)).length,open:Te.filter((e=>"open"===e.status)).length,qualityControl:Te.filter((e=>"quality_control"===e.status)).length,improval:Te.filter((e=>"improval"===e.status)).length})),[Te]);return x?(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:x}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 todo-analytics-wrapper",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)(Y.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,T.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:a("analytics.todo.title")})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,T.jsx)("input",{type:"text",placeholder:a("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:g,onChange:e=>y(e.target.value)}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===ae?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>{const e="table"===ae?"cards":"table";se(e),V&&V(e)},children:"table"===ae?(0,T.jsx)(h.A,{className:"h-5 w-5"}):(0,T.jsx)(p.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("table"===ae?"common.viewAsCards":"common.viewAsTable")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsxs)("button",{className:"p-2 rounded-md ".concat(Se()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>q(!F),style:{position:"relative"},children:[(0,T.jsx)(b.A,{className:"h-5 w-5"}),Se()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:Se()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.filter")})]})]})]}),F&&(0,T.jsx)("div",{className:"cards"===ae?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(I.A,{columns:ke,onApply:je,onReset:we,savedConditions:f,savedOperators:N,tableId:$})}),(0,T.jsx)("div",{className:"cards"===ae?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:$,onSelectFilter:je,onReset:we,activeFilterName:A,selectedFilterId:D,onFilterChange:Ne,defaultFilterName:a("teamWorktime.filters.all")})}),(0,T.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,T.jsxs)("button",{onClick:()=>xe(!me),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,T.jsx)(W.A,{className:"h-4 w-4 transition-transform ".concat(me?"rotate-180":"")}),a("analytics.todo.frequencyAnalysis")," ",a(me?"common.collapse":"common.expand")]}),(0,T.jsxs)("button",{onClick:()=>ye(!be),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,T.jsx)(k.A,{className:"h-4 w-4 transition-transform ".concat(be?"rotate-180":"")}),a("analytics.todo.shiftAnalysis")," ",a(be?"common.collapse":"common.expand")]})]}),me&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(W.A,{className:"h-5 w-5"}),a("analytics.todo.frequencyAnalysis")]}),oe?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.todo.loadingAnalysis")})}):de?(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.frequency.totalTodos")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:de.summary.totalTasks})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:de.summary.completedTasks})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.todo.frequency.neverCompleted")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:de.summary.neverCompletedTasks})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.frequency.completionRate")}),(0,T.jsxs)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[de.summary.completionRate,"%"]})]})]}),de.userStats&&de.userStats.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.completionsPerUser")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.user")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.lastCompletion")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:de.userStats.slice(0,10).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):a("analytics.todo.unknown")}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.completedCount}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.lastCompletedAt?(0,n.GP)(new Date(e.lastCompletedAt),"HH:mm"):"-"})]},e.userId)))})]})})]}),de.taskStats&&de.taskStats.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.frequentCompleted")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.status")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.branch")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.completed")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:de.taskStats.slice(0,20).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 ".concat(e.neverCompleted?"bg-red-50 dark:bg-red-900/10":""),children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.title}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(We(e.currentStatus)),children:Ae(e.currentStatus)})}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.completedCount,"x ",e.neverCompleted&&(0,T.jsx)("span",{className:"text-red-600 dark:text-red-400",children:a("analytics.todo.never")})]})]},e.taskId)))})]})})]}),de.statusAverages&&Object.keys(de.statusAverages).length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.averageTimePerStatus")}),(0,T.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(de.statusAverages).map((e=>{let[t,a]=e;return(0,T.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:Ae(t)}),(0,T.jsxs)("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[a.averageHours.toFixed(1),"h"]}),(0,T.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[a.taskCount," To-Do(s)"]})]},t)}))})]}),de.summary&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.frequency.statusDistribution")}),(0,T.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:(0,T.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,T.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,T.jsx)("span",{children:de.summary.totalTasks}),(0,T.jsx)("span",{children:Math.round(.75*de.summary.totalTasks)}),(0,T.jsx)("span",{children:Math.round(.5*de.summary.totalTasks)}),(0,T.jsx)("span",{children:Math.round(.25*de.summary.totalTasks)}),(0,T.jsx)("span",{children:"0"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex items-end justify-around gap-2 pr-8 pb-1",children:[(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-green-500 dark:bg-green-600 rounded-t",style:{height:"".concat(de.summary.completedTasks>0?de.summary.completedTasks/de.summary.totalTasks*100:0,"%"),minHeight:de.summary.completedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.completed"),": ").concat(de.summary.completedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:de.summary.completedTasks})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-yellow-500 dark:bg-yellow-600 rounded-t",style:{height:"".concat(de.summary.totalTasks-de.summary.completedTasks-de.summary.neverCompletedTasks>0?(de.summary.totalTasks-de.summary.completedTasks-de.summary.neverCompletedTasks)/de.summary.totalTasks*100:0,"%"),minHeight:de.summary.totalTasks-de.summary.completedTasks-de.summary.neverCompletedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.open"),": ").concat(de.summary.totalTasks-de.summary.completedTasks-de.summary.neverCompletedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("tasks.status.open")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:de.summary.totalTasks-de.summary.completedTasks-de.summary.neverCompletedTasks})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-red-500 dark:bg-red-600 rounded-t",style:{height:"".concat(de.summary.neverCompletedTasks>0?de.summary.neverCompletedTasks/de.summary.totalTasks*100:0,"%"),minHeight:de.summary.neverCompletedTasks>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.neverCompleted"),": ").concat(de.summary.neverCompletedTasks)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:a("analytics.todo.frequency.neverCompleted")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:de.summary.neverCompletedTasks})]})]})]})})]})]}):(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:a("analytics.todo.noData")})]}),be&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(k.A,{className:"h-5 w-5"}),a("analytics.todo.shift.shiftBased")]}),he?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.todo.loadingAnalysis")})}):ue?(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.shift.totalShifts")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:ue.summary.totalShifts})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.shift.todosInShifts")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:ue.summary.totalTasksInShifts})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.shift.totalHours")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:ue.summary.totalDurationHours||"0.00"})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.todo.shift.averageDuration")}),(0,T.jsxs)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[ue.summary.averageDurationHours||"-","h"]})]}),(0,T.jsxs)("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800",children:[(0,T.jsx)("div",{className:"text-sm text-indigo-600 dark:text-indigo-400",children:a("analytics.todo.shift.averageTodosPerShift")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-indigo-700 dark:text-indigo-300",children:ue.summary.totalShifts>0?(ue.summary.totalTasksInShifts/ue.summary.totalShifts).toFixed(1):"0"})]})]}),ue.shifts&&ue.shifts.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.shift.shiftsWithTodos")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.frequency.user")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.branch")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.time")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.duration")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:ue.shifts.map((e=>{const t=fe.has(e.workTimeId);return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:[e.user.firstName," ",e.user.lastName]}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[(0,n.GP)(new Date(e.startTime),"HH:mm"),e.endTime&&" - ".concat((0,n.GP)(new Date(e.endTime),"HH:mm"))]}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.durationHours?"".concat(e.durationHours,"h"):a("worktime.running")}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("span",{children:e.linkedTasksCount}),e.linkedTasksCount>0&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>{return t=e.workTimeId,void ve((e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a}));var t},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t?(0,T.jsx)(K.A,{className:"h-4 w-4"}):(0,T.jsx)(Z.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("analytics.todo.shift.showTodos")})]})]})})]}),t&&e.linkedTasksCount>0&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:5,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[(0,T.jsx)("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("analytics.todo.shift.linkedTasks")}),(0,T.jsx)("div",{className:"space-y-2",children:e.linkedTasks.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(We(e.status)),children:Ae(e.status)}),(0,T.jsx)("span",{className:"font-medium",children:e.title}),e.responsible&&(0,T.jsxs)("span",{className:"text-gray-400",children:["(",e.responsible.firstName," ",e.responsible.lastName,")"]})]},e.id)))})]})})})]},e.workTimeId)}))})]})})]}),ue.tasksWithShifts&&ue.tasksWithShifts.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-3",children:a("analytics.todo.shift.tasksWithShiftDistribution")}),(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.title")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.columns.status")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.totalShifts")}),(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:a("analytics.todo.shift.totalTime")})]})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:ue.tasksWithShifts.slice(0,30).map((e=>(0,T.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.task.title}),(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(We(e.task.status)),children:Ae(e.task.status)})}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.shiftCount,"x"]}),(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.totalDurationHours,"h"]})]},e.task.id)))})]})})]})]}):(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:a("analytics.todo.noShiftData")})]}),(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("analytics.todo.stats.total")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:Ce.total})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:Ce.done})]}),(0,T.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,T.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:a("analytics.todo.stats.inProgress")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:Ce.inProgress})]}),(0,T.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:[(0,T.jsx)("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:a("analytics.todo.stats.qualityControl")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:Ce.qualityControl})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("tasks.status.open")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:Ce.open})]}),(0,T.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800",children:[(0,T.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:a("tasks.status.improval")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:Ce.improval})]})]}),Te.length>0&&(0,T.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,T.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,T.jsx)(Q.A,{className:"h-5 w-5"}),a("analytics.todo.statusDistribution")]}),(0,T.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:(0,T.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,T.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,T.jsx)("span",{children:Ce.total}),(0,T.jsx)("span",{children:Math.round(.75*Ce.total)}),(0,T.jsx)("span",{children:Math.round(.5*Ce.total)}),(0,T.jsx)("span",{children:Math.round(.25*Ce.total)}),(0,T.jsx)("span",{children:"0"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),(0,T.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})]}),(0,T.jsxs)("div",{className:"absolute inset-0 flex items-end justify-around gap-1 sm:gap-2 pr-8 pb-1",children:[(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-green-500 dark:bg-green-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(Ce.total>0?Ce.done/Ce.total*100:0,"%"),minHeight:Ce.done>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.frequency.completed"),": ").concat(Ce.done)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.frequency.completed")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ce.done})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-blue-500 dark:bg-blue-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(Ce.total>0?Ce.inProgress/Ce.total*100:0,"%"),minHeight:Ce.inProgress>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.stats.inProgress"),": ").concat(Ce.inProgress)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.stats.inProgress")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ce.inProgress})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-purple-500 dark:bg-purple-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(Ce.total>0?Ce.qualityControl/Ce.total*100:0,"%"),minHeight:Ce.qualityControl>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("analytics.todo.stats.qualityControl"),": ").concat(Ce.qualityControl)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("analytics.todo.columns.qualityControl")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ce.qualityControl})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-yellow-500 dark:bg-yellow-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(Ce.total>0?Ce.open/Ce.total*100:0,"%"),minHeight:Ce.open>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.open"),": ").concat(Ce.open)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("tasks.status.open")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ce.open})]}),(0,T.jsxs)("div",{className:"flex flex-col items-center gap-1 flex-1",children:[(0,T.jsxs)("div",{className:"relative group w-full",children:[(0,T.jsx)("div",{className:"w-full bg-red-500 dark:bg-red-600 rounded-t transition-all hover:opacity-80",style:{height:"".concat(Ce.total>0?Ce.improval/Ce.total*100:0,"%"),minHeight:Ce.improval>0?"4px":"0px"}}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"".concat(a("tasks.status.improval"),": ").concat(Ce.improval)})]}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium text-center",children:a("tasks.status.improval")}),(0,T.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ce.improval})]})]})]})})]}),c?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("common.loading")})}):"table"===ae?(0,T.jsx)("div",{className:"overflow-x-auto",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsx)("tr",{children:U.filter((e=>ee.includes(e))).map((e=>{const t=ke.find((t=>t.id===e));return t?(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t.label},e):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:0===Te.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:U.filter((e=>ee.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"Keine To-Dos f\xfcr dieses Datum gefunden"})}):Te.map((e=>{const t=re.has(e.id),a=e.statusHistory&&e.statusHistory.length>0;return(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:U.filter((e=>ee.includes(e))).map((s=>{switch(s){case"time":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,n.GP)(new Date(e.updatedAt),"HH:mm")},s);case"title":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{onClick:()=>le(e.id),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t?(0,T.jsx)(K.A,{className:"h-4 w-4"}):(0,T.jsx)(Z.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Status-Historie anzeigen"})]}),(0,T.jsx)("span",{children:e.title})]})},s);case"status":return(0,T.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(We(e.status)),children:Ae(e.status)})},s);case"responsible":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):"-"},s);case"qualityControl":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"-"},s);case"branch":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},s);default:return null}}))}),t&&a&&(0,T.jsx)("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:(0,T.jsx)("td",{colSpan:U.filter((e=>ee.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4",children:(0,T.jsxs)("div",{className:"ml-4 border-l-2 border-blue-200 dark:border-blue-700 pl-4",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,T.jsx)(W.A,{className:"h-4 w-4"}),"Status-Wechsel"]}),(0,T.jsx)("div",{className:"space-y-2",children:e.statusHistory.map(((e,t)=>(0,T.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"font-medium",children:(0,n.GP)(new Date(e.changedAt),"HH:mm:ss")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(We(e.oldStatus||"open")),children:Ae(e.oldStatus||"open")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(We(e.newStatus)),children:Ae(e.newStatus)}),(0,T.jsx)("span",{className:"text-gray-400",children:"von"}),(0,T.jsxs)("span",{className:"font-medium",children:[e.user.firstName," ",e.user.lastName]})]},e.id)))})]})})})]},e.id)}))})]})}):(0,T.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:0===Te.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,T.jsx)(Y.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,T.jsx)("div",{className:"text-sm",children:"Keine To-Dos gefunden"})]}):(0,T.jsx)(O.A,{children:Te.map((e=>{const t=[];ee.includes("branch")&&t.push({icon:(0,T.jsx)(j.A,{className:"h-4 w-4"}),label:"Niederlassung",value:e.branch.name,section:"left"}),ee.includes("responsible")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:"Verantwortlich",value:e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):"-",section:"main"}),ee.includes("qualityControl")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:"Qualit\xe4tskontrolle",value:e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"-",section:"main"}),ee.includes("time")&&t.push({icon:(0,T.jsx)(k.A,{className:"h-4 w-4"}),label:"Zeit",value:(0,n.GP)(new Date(e.updatedAt),"HH:mm"),section:"right"});const a=e.statusHistory&&e.statusHistory.length>0,s=re.has(e.id),r=a?(0,T.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,T.jsxs)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[(0,T.jsx)(W.A,{className:"h-4 w-4"}),"Status-Wechsel"]}),(0,T.jsx)("div",{className:"space-y-2",children:e.statusHistory.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[(0,T.jsx)("span",{className:"font-medium",children:(0,n.GP)(new Date(e.changedAt),"HH:mm:ss")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(We(e.oldStatus||"open")),children:Ae(e.oldStatus||"open")}),(0,T.jsx)("span",{className:"text-gray-400",children:"\u2192"}),(0,T.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(We(e.newStatus)),children:Ae(e.newStatus)}),(0,T.jsx)("span",{className:"text-gray-400",children:"von"}),(0,T.jsxs)("span",{className:"font-medium",children:[e.user.firstName," ",e.user.lastName]})]},e.id)))})]}):null;return(0,T.jsx)(H.A,{title:(0,T.jsxs)("span",{children:[(0,T.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.id,":"]})," ",(0,T.jsx)("span",{children:e.title})]}),status:{label:Ae(e.status),color:We(e.status)},metadata:t,expandable:r?{isExpanded:s,content:r,onToggle:()=>le(e.id)}:void 0},e.id)}))})})]})};var ee=a(2704);const te="request-analytics-table",ae=["time","title","status","requester","responsible","branch"],se=e=>{let{selectedDate:t}=e;const{t:a}=(0,r.Bd)(),[i,o]=(0,s.useState)([]),[c,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)(null),[g,y]=(0,s.useState)(""),[f,w]=(0,s.useState)([]),[N,S]=(0,s.useState)([]),[W,A]=(0,s.useState)(""),[C,D]=(0,s.useState)(null),[E,F]=(0,s.useState)(!1),{settings:q,isLoading:P,updateColumnOrder:z,updateHiddenColumns:R,toggleColumnVisibility:G,isColumnVisible:B,updateViewMode:_}=(0,M.F)(te,{defaultColumnOrder:ae,defaultViewMode:"table"}),V=(null===q||void 0===q?void 0:q.columnOrder)||ae,U=(null===q||void 0===q?void 0:q.hiddenColumns)||[],Y=V.filter((e=>!U.includes(e))),K=(null===q||void 0===q?void 0:q.viewMode)||"table",[Z,Q]=(0,s.useState)(K);(0,s.useEffect)((()=>{null!==q&&void 0!==q&&q.viewMode&&q.viewMode!==Z&&Q(q.viewMode)}),[null===q||void 0===q?void 0:q.viewMode]);const $=(0,s.useMemo)((()=>[{id:"time",label:a("analytics.request.columns.time")},{id:"title",label:a("analytics.request.columns.title")},{id:"status",label:a("analytics.request.columns.status")},{id:"requester",label:a("analytics.request.columns.requester")},{id:"responsible",label:a("analytics.request.columns.responsible")},{id:"branch",label:a("analytics.request.columns.branch")}]),[a]);(0,s.useEffect)((()=>{t&&(async()=>{try{m(!0),u(null);const e={date:t};f.forEach((t=>{"branch"===t.column&&t.value&&(e.branchId=t.value),"requester"===t.column&&t.value&&(e.userId=t.value),"status"===t.column&&t.value}));const a=await l.A.get(d.Sn.TEAM_WORKTIME.ANALYTICS.REQUESTS_CHRONOLOGICAL,{params:e});o(a.data||[])}catch(x){console.error("Fehler beim Laden der Requests:",x),u(a("analytics.request.loadError"))}finally{m(!1)}})()}),[t,f]);const J=(0,s.useCallback)(((e,t)=>{w(e),S(t),F(!1)}),[]),X=(0,s.useCallback)((()=>{w([]),S([]),A(""),D(null)}),[]),se=(0,s.useCallback)(((e,t,a,s)=>{A(e),D(t),J(a,s)}),[J]),re=(0,s.useCallback)((()=>f.filter((e=>""!==e.column&&null!==e.value)).length),[f]),ie=e=>{switch(e){case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"approval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"denied":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"to_improve":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},le=e=>({approved:a("analytics.request.status.approved"),approval:a("analytics.request.status.approval"),denied:a("analytics.request.status.denied"),to_improve:a("analytics.request.status.to_improve")}[e]||e),de=(0,s.useMemo)((()=>{let e=[...i];if(g){const t=g.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)||"".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase().includes(t)||"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)))}return f.forEach((t=>{if(""===t.column||null===t.value)return;const a=t.operator||"equals",s=t.value;e=e.filter((e=>{switch(t.column){case"status":return"equals"!==a||e.status===s;case"title":return"contains"!==a||e.title.toLowerCase().includes(String(s).toLowerCase());default:return!0}}))})),e}),[i,g,f]),ne=(0,s.useMemo)((()=>({total:de.length,approved:de.filter((e=>"approved"===e.status)).length,pending:de.filter((e=>"approval"===e.status)).length,denied:de.filter((e=>"denied"===e.status)).length,toImprove:de.filter((e=>"to_improve"===e.status)).length})),[de]);return x?(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:x}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 request-analytics-wrapper",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)(ee.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,T.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:a("analytics.request.title")})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,T.jsx)("input",{type:"text",placeholder:a("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:g,onChange:e=>y(e.target.value)}),(0,T.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Z?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>{const e="table"===Z?"cards":"table";Q(e),_&&_(e)},title:a("table"===Z?"common.viewAsCards":"common.viewAsTable"),children:"table"===Z?(0,T.jsx)(h.A,{className:"h-5 w-5"}):(0,T.jsx)(p.A,{className:"h-5 w-5"})}),(0,T.jsxs)("button",{className:"p-2 rounded-md ".concat(re()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>F(!E),title:a("common.filter"),style:{position:"relative"},children:[(0,T.jsx)(b.A,{className:"h-5 w-5"}),re()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:re()})]})]})]}),E&&(0,T.jsx)("div",{className:"cards"===Z?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(I.A,{columns:$,onApply:J,onReset:X,savedConditions:f,savedOperators:N,tableId:te})}),(0,T.jsx)("div",{className:"cards"===Z?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,T.jsx)(L.A,{tableId:te,onSelectFilter:J,onReset:X,activeFilterName:W,selectedFilterId:C,onFilterChange:se,defaultFilterName:a("teamWorktime.filters.all")})}),(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[(0,T.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("analytics.request.stats.total")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:ne.total})]}),(0,T.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,T.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:a("analytics.request.status.approved")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:ne.approved})]}),(0,T.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800",children:[(0,T.jsx)("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:a("analytics.request.status.approval")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:ne.pending})]}),(0,T.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800",children:[(0,T.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:a("analytics.request.status.denied")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:ne.denied})]}),(0,T.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:[(0,T.jsx)("div",{className:"text-sm text-orange-600 dark:text-orange-400",children:a("analytics.request.status.to_improve")}),(0,T.jsx)("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:ne.toImprove})]})]}),c?(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:a("analytics.request.loading")})}):"table"===Z?(0,T.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,T.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,T.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,T.jsx)("tr",{children:V.filter((e=>Y.includes(e))).map((e=>{const t=$.find((t=>t.id===e));return t?(0,T.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t.label},e):null}))})}),(0,T.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:0===de.length?(0,T.jsx)("tr",{children:(0,T.jsx)("td",{colSpan:V.filter((e=>Y.includes(e))).length,className:"px-3 sm:px-4 md:px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:a("analytics.request.noRequestsForDate")})}):de.map((e=>(0,T.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:V.filter((e=>Y.includes(e))).map((t=>{switch(t){case"time":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(0,n.GP)(new Date(e.createdAt),"HH:mm")},t);case"title":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.title},t);case"status":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(ie(e.status)),children:le(e.status)})},t);case"requester":return(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.requester.firstName," ",e.requester.lastName]},t);case"responsible":return(0,T.jsxs)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.responsible.firstName," ",e.responsible.lastName]},t);case"branch":return(0,T.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.branch.name},t);default:return null}}))},e.id)))})]})}):(0,T.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:0===de.length?(0,T.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,T.jsx)(ee.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,T.jsx)("div",{className:"text-sm",children:a("analytics.request.noRequests")})]}):(0,T.jsx)(O.A,{children:de.map((e=>{const t=[];return Y.includes("branch")&&t.push({icon:(0,T.jsx)(j.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.branch"),value:e.branch.name,section:"left"}),Y.includes("requester")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.requester"),value:"".concat(e.requester.firstName," ").concat(e.requester.lastName),section:"main"}),Y.includes("responsible")&&t.push({icon:(0,T.jsx)(v.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.responsible"),value:"".concat(e.responsible.firstName," ").concat(e.responsible.lastName),section:"main"}),Y.includes("time")&&t.push({icon:(0,T.jsx)(k.A,{className:"h-4 w-4"}),label:a("analytics.request.metadata.time"),value:(0,n.GP)(new Date(e.createdAt),"HH:mm"),section:"right"}),(0,T.jsx)(H.A,{title:(0,T.jsxs)("span",{children:[(0,T.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.id,":"]})," ",(0,T.jsx)("span",{children:e.title})]}),status:{label:le(e.status),color:ie(e.status)},metadata:t},e.id)}))})})]})};var re=a(8662),ie=a(7988),le=a(1620),de=a(8605),ne=a(8018),oe=a(1821),ce=a(2672),me=a(7285),xe=a(3805),ue=a(4625),ge=a(7807),he=a(5657);const pe=e=>{let{isOpen:t,onClose:a,onShiftCreated:i,initialDate:o,initialBranchId:c,initialRoleId:m}=e;const{t:x}=(0,r.Bd)(),{user:u}=(0,ce.As)(),{openSidepane:g,closeSidepane:h}=(0,he.N)(),[p,b]=(0,s.useState)(window.innerWidth>1070),[y,f]=(0,s.useState)(window.innerWidth<640),[v,k]=(0,s.useState)(""),[j,w]=(0,s.useState)(c||""),[C,D]=(0,s.useState)(m||""),[E,I]=(0,s.useState)(""),[L,F]=(0,s.useState)(o?(0,n.GP)(o,"yyyy-MM-dd"):(0,n.GP)(new Date,"yyyy-MM-dd")),[M,q]=(0,s.useState)(""),[P,z]=(0,s.useState)([]),[H,O]=(0,s.useState)([]),[R,G]=(0,s.useState)([]),[B,_]=(0,s.useState)([]),[V,U]=(0,s.useState)(null),[Y,K]=(0,s.useState)(!1),[Z,Q]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=()=>{f(window.innerWidth<640),b(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(g(),$()):h(),()=>{h()})),[t,g,h]),(0,s.useEffect)((()=>{t&&j&&C&&J()}),[t,j,C]),(0,s.useEffect)((()=>{if(B.length>0&&""===j){const e=c&&B.find((e=>e.id===c))||B[0];w(e.id)}}),[B,j,c]),(0,s.useEffect)((()=>{if(R.length>0&&""===C){const e=m&&R.find((e=>e.id===m))||R[0];D(e.id)}}),[R,C,m]);const $=async()=>{Q(!0),U(null);try{if(!localStorage.getItem("token"))return U("Nicht authentifiziert"),void Q(!1);const[e,t,a]=await Promise.all([l.A.get(d.Sn.BRANCHES.BASE),l.A.get(d.Sn.ROLES.BASE),l.A.get(d.Sn.USERS.DROPDOWN)]);_(e.data||[]),G(t.data||[]),O(a.data||[]),j&&C&&await J()}catch(a){var e,t;console.error("Fehler beim Laden der Daten:",a),U((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||x("teamWorktime.shifts.modal.errors.loadDataError"))}finally{Q(!1)}},J=async()=>{if(j&&C)try{U(null);const e=await l.A.get(d.Sn.SHIFTS.TEMPLATES.BASE,{params:{branchId:Number(j),roleId:Number(C),includeInactive:!1}}),t=e.data.data||e.data||[];z(t),1!==t.length||v||k(t[0].id)}catch(a){var e,t;console.error("Fehler beim Laden der Templates:",a),U((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||x("teamWorktime.shifts.modal.errors.loadTemplatesError"))}},X=async e=>{e.preventDefault(),U(null),K(!0);try{if(!v||!j||!C||!L)return U(x("teamWorktime.shifts.modal.errors.fillRequiredFields")),void K(!1);if(!localStorage.getItem("token"))return U("Nicht authentifiziert"),void K(!1);const e={shiftTemplateId:Number(v),branchId:Number(j),roleId:Number(C),date:L,notes:M||null};E&&(e.userId=Number(E));const t=await l.A.post(d.Sn.SHIFTS.BASE,e);console.log("Schicht erfolgreich erstellt:",t.data),i(t.data.data||t.data),ee()}catch(s){var t,a;console.error("Fehler beim Erstellen der Schicht:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||x("teamWorktime.shifts.modal.errors.createError");U(e)}finally{K(!1)}},ee=()=>{U(null),k(""),w(c||""),D(m||""),I(""),F(o?(0,n.GP)(o,"yyyy-MM-dd"):(0,n.GP)(new Date,"yyyy-MM-dd")),q(""),a()};P.find((e=>e.id===Number(v)));return y?(0,T.jsxs)(N.lG,{open:t,onClose:ee,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:x("teamWorktime.shifts.modal.create.title")}),(0,T.jsx)("button",{onClick:ee,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:X,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[V&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:V}),Z?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:x("common.loading")}):(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectBranch")}),B.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.role")," *"]}),(0,T.jsxs)("select",{value:C,onChange:e=>{D(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectRole")}),R.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.template")," *"]}),(0,T.jsxs)("select",{value:v,onChange:e=>k(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!j||!C,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectTemplate")}),P.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.name," (",e.startTime," - ",e.endTime,")"]},e.id)))]}),(!j||!C)&&(0,T.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:x("teamWorktime.shifts.modal.create.selectBranchRoleFirst")})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.date")," *"]}),(0,T.jsx)("input",{type:"date",value:L,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.user")}),(0,T.jsxs)("select",{value:E,onChange:e=>I(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectUser")}),H.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.notes")}),(0,T.jsx)("textarea",{value:M,onChange:e=>q(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:x("teamWorktime.shifts.modal.create.notesPlaceholder")})]})]})]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:ee,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:x("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Y||Z,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x(Y?"common.saving":"common.save"),children:Y?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x(Y?"common.saving":"common.save")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!p&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:ee,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:x("teamWorktime.shifts.modal.create.title")}),(0,T.jsx)("button",{onClick:ee,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:X,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[V&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:V}),Z?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:x("common.loading")}):(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectBranch")}),B.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.role")," *"]}),(0,T.jsxs)("select",{value:C,onChange:e=>{D(Number(e.target.value)),k("")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectRole")}),R.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.template")," *"]}),(0,T.jsxs)("select",{value:v,onChange:e=>k(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!j||!C,children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectTemplate")}),P.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.name," (",e.startTime," - ",e.endTime,")"]},e.id)))]}),(!j||!C)&&(0,T.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:x("teamWorktime.shifts.modal.create.selectBranchRoleFirst")})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[x("teamWorktime.shifts.modal.create.date")," *"]}),(0,T.jsx)("input",{type:"date",value:L,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.user")}),(0,T.jsxs)("select",{value:E,onChange:e=>I(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:x("teamWorktime.shifts.modal.create.selectUser")}),H.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:x("teamWorktime.shifts.modal.create.notes")}),(0,T.jsx)("textarea",{value:M,onChange:e=>q(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:x("teamWorktime.shifts.modal.create.notesPlaceholder")})]})]})]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:ee,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:x("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Y||Z,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x(Y?"common.saving":"common.save"),children:Y?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:x(Y?"common.saving":"common.save")})]})]})]})]})]})};var be=a(6011);const ye=e=>{let{isOpen:t,onClose:a,onSwapRequestCreated:i,originalShift:o}=e;const{t:c}=(0,r.Bd)(),{user:m}=(0,ce.As)(),{openSidepane:x,closeSidepane:u}=(0,he.N)(),[g,h]=(0,s.useState)(window.innerWidth>1070),[p,b]=(0,s.useState)(window.innerWidth<640),[y,f]=(0,s.useState)(""),[v,k]=(0,s.useState)(""),[j,w]=(0,s.useState)([]),[C,D]=(0,s.useState)(!1),[E,I]=(0,s.useState)(!1),[L,F]=(0,s.useState)(null),[M,q]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(x(),P()):(u(),f(""),k(""),F(null)),()=>{u()})),[t,x,u,o]);const P=async()=>{if(o){I(!0),F(null);try{var e;const t=new Date(o.date);t.setDate(t.getDate()-t.getDay()+1);const a=new Date(t);a.setDate(a.getDate()+6);const s=await l.A.get(d.Sn.SHIFTS.BASE,{params:{startDate:(0,n.GP)(t,"yyyy-MM-dd"),endDate:(0,n.GP)(a,"yyyy-MM-dd")}}),r=((null===(e=s.data)||void 0===e?void 0:e.data)||s.data||[]).filter((e=>e.id!==o.id&&null!==e.userId&&"cancelled"!==e.status&&"swapped"!==e.status&&e.roleId===o.roleId&&e.branchId===o.branchId));w(r)}catch(s){var t,a;console.error("Fehler beim Laden der verf\xfcgbaren Schichten:",s),F((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||c("teamWorktime.shifts.swap.errors.loadShiftsError"))}finally{I(!1)}}},z=async e=>{e.preventDefault(),F(null),q(!0);try{if(!y)return F(c("teamWorktime.shifts.swap.errors.selectTargetShift")),void q(!1);const e=await l.A.post(d.Sn.SHIFTS.SWAPS.BASE,{originalShiftId:o.id,targetShiftId:Number(y),message:v.trim()||null});if(e.data&&!1!==e.data.success)i(),a();else{var t;const a=(null===(t=e.data)||void 0===t?void 0:t.message)||c("teamWorktime.shifts.swap.errors.createError");F(a)}}catch(n){var s,r;console.error("Fehler beim Erstellen der Tausch-Anfrage:",n);const e=(null===(s=n.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||n.message||c("teamWorktime.shifts.swap.errors.createError");F(e)}finally{q(!1)}},H=()=>{F(null),f(""),k(""),a()},O=()=>{var e;return(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:c("teamWorktime.shifts.swap.form.yourShift")}),(0,T.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-400",children:[(0,T.jsx)("div",{children:(null===(e=o.shiftTemplate)||void 0===e?void 0:e.name)||c("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,n.GP)(new Date(o.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,n.GP)(new Date(o.startTime),"HH:mm")," - ",(0,n.GP)(new Date(o.endTime),"HH:mm")]}),o.branch&&(0,T.jsx)("div",{children:o.branch.name}),o.role&&(0,T.jsx)("div",{children:o.role.name})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[c("teamWorktime.shifts.swap.form.targetShift")," *"]}),E?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:c("common.loading")}):0===j.length?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:c("teamWorktime.shifts.swap.form.noShiftsAvailable")}):(0,T.jsxs)("select",{value:y,onChange:e=>f(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:c("teamWorktime.shifts.swap.form.selectTargetShift")}),j.map((e=>(0,T.jsxs)("option",{value:e.id,children:[(0,n.GP)(new Date(e.date),"dd.MM.yyyy")," - ",(0,n.GP)(new Date(e.startTime),"HH:mm")," - ",(0,n.GP)(new Date(e.endTime),"HH:mm"),e.user&&" (".concat(e.user.firstName," ").concat(e.user.lastName,")")]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("teamWorktime.shifts.swap.form.message")}),(0,T.jsx)("textarea",{value:v,onChange:e=>k(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:c("teamWorktime.shifts.swap.form.messagePlaceholder")})]})]})};return p?(0,T.jsxs)(N.lG,{open:t,onClose:H,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:c("teamWorktime.shifts.swap.title")}),(0,T.jsx)("button",{onClick:H,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:z,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[L&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:L}),O()]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:H,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:c("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:M||E||!y,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:c(M?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit"),children:M?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c(M?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!g&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:H,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:c("teamWorktime.shifts.swap.title")}),(0,T.jsx)("button",{onClick:H,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:z,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[L&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:L}),O()]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:H,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:c("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:M||E||!y,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:c(M?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit"),children:M?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:c(M?"teamWorktime.shifts.swap.submitting":"teamWorktime.shifts.swap.submit")})]})]})]})]})]})},fe=e=>{let{isOpen:t,onClose:a,onShiftUpdated:i,onShiftDeleted:o,shift:c}=e;const{t:m}=(0,r.Bd)(),{user:x}=(0,ce.As)(),{openSidepane:u,closeSidepane:g}=(0,he.N)(),[h,p]=(0,s.useState)(window.innerWidth>1070),[b,y]=(0,s.useState)(window.innerWidth<640),[f,v]=(0,s.useState)(c.shiftTemplateId),[k,j]=(0,s.useState)(c.branchId),[w,C]=(0,s.useState)(c.roleId),[E,I]=(0,s.useState)(c.userId||""),[L,F]=(0,s.useState)((0,n.GP)(new Date(c.date),"yyyy-MM-dd")),[M,q]=(0,s.useState)(c.notes||""),[P,z]=(0,s.useState)(c.status),[H,O]=(0,s.useState)([]),[R,G]=(0,s.useState)([]),[B,_]=(0,s.useState)([]),[V,U]=(0,s.useState)([]),[Y,K]=(0,s.useState)(null),[Z,Q]=(0,s.useState)(!1),[$,J]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[te,ae]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=()=>{y(window.innerWidth<640),p(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(u(),v(c.shiftTemplateId),j(c.branchId),C(c.roleId),I(c.userId||""),F((0,n.GP)(new Date(c.date),"yyyy-MM-dd")),q(c.notes||""),z(c.status),K(null),se()):(g(),ee(!1)),()=>{g()})),[t,c,u,g]),(0,s.useEffect)((()=>{t&&k&&w&&re()}),[t,k,w]);const se=async()=>{J(!0),K(null);try{if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void J(!1);const[e,t,a]=await Promise.all([l.A.get(d.Sn.BRANCHES.BASE),l.A.get(d.Sn.ROLES.BASE),l.A.get(d.Sn.USERS.DROPDOWN)]);U(e.data||[]),_(t.data||[]),G(a.data||[]),k&&w&&await re()}catch(a){var e,t;console.error("Fehler beim Laden der Daten:",a),K((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.loadDataError"))}finally{J(!1)}},re=async()=>{if(k&&w)try{K(null);const e=await l.A.get(d.Sn.SHIFTS.TEMPLATES.BASE,{params:{branchId:Number(k),roleId:Number(w),includeInactive:!0}}),t=e.data.data||e.data||[];O(t)}catch(a){var e,t;console.error("Fehler beim Laden der Templates:",a),K((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.loadTemplatesError"))}},ie=async e=>{e.preventDefault(),K(null),Q(!0);try{if(!f||!k||!w||!L)return K(m("teamWorktime.shifts.modal.errors.fillRequiredFields")),void Q(!1);if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void Q(!1);const e={userId:E?Number(E):null,date:L,notes:M||null,status:P},t=await l.A.put(d.Sn.SHIFTS.BY_ID(c.id),e);console.log("Schicht erfolgreich aktualisiert:",t.data),i(t.data.data||t.data),de()}catch(s){var t,a;console.error("Fehler beim Aktualisieren der Schicht:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||m("teamWorktime.shifts.modal.errors.updateError");K(e)}finally{Q(!1)}},le=async()=>{K(null),Q(!0);try{if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void Q(!1);await l.A.delete(d.Sn.SHIFTS.BY_ID(c.id)),console.log("Schicht erfolgreich gel\xf6scht"),o(c.id),de()}catch(a){var e,t;console.error("Fehler beim L\xf6schen der Schicht:",a);const s=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.modal.errors.deleteError");K(s)}finally{Q(!1),ee(!1)}},de=()=>{K(null),ee(!1),a()},ne=()=>{var e,t,a;return(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.branch")}),(0,T.jsx)("input",{type:"text",value:(null===(e=V.find((e=>e.id===k)))||void 0===e?void 0:e.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.role")}),(0,T.jsx)("input",{type:"text",value:(null===(t=B.find((e=>e.id===w)))||void 0===t?void 0:t.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.template")}),(0,T.jsx)("input",{type:"text",value:(null===(a=c.shiftTemplate)||void 0===a?void 0:a.name)||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.modal.edit.date")," *"]}),(0,T.jsx)("input",{type:"date",value:L,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.user")}),(0,T.jsxs)("select",{value:E,onChange:e=>I(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:m("teamWorktime.shifts.modal.edit.selectUser")}),R.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.modal.edit.status")," *"]}),(0,T.jsxs)("select",{value:P,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"scheduled",children:m("teamWorktime.shifts.status.scheduled")}),(0,T.jsx)("option",{value:"confirmed",children:m("teamWorktime.shifts.status.confirmed")}),(0,T.jsx)("option",{value:"cancelled",children:m("teamWorktime.shifts.status.cancelled")}),(0,T.jsx)("option",{value:"swapped",children:m("teamWorktime.shifts.status.swapped")})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("teamWorktime.shifts.modal.edit.notes")}),(0,T.jsx)("textarea",{value:M,onChange:e=>q(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:m("teamWorktime.shifts.modal.edit.notesPlaceholder")})]}),c.userId===(null===x||void 0===x?void 0:x.id)&&"cancelled"!==c.status&&"swapped"!==c.status&&(0,T.jsx)("div",{className:"pt-4 border-t dark:border-gray-700",children:(0,T.jsxs)("button",{type:"button",onClick:()=>ae(!0),className:"w-full px-4 py-2 text-sm font-medium text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center justify-center gap-2",children:[(0,T.jsx)(be.A,{className:"h-5 w-5"}),m("teamWorktime.shifts.actions.swap")]})}),(0,T.jsx)("div",{className:"pt-4 border-t dark:border-gray-700",children:(0,T.jsxs)("button",{type:"button",onClick:()=>ee(!0),className:"w-full px-4 py-2 text-sm font-medium text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md hover:bg-red-100 dark:hover:bg-red-900/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 flex items-center justify-center gap-2",children:[(0,T.jsx)(D.A,{className:"h-5 w-5"}),m("teamWorktime.shifts.modal.edit.delete")]})}),X&&(0,T.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[(0,T.jsx)("p",{className:"text-sm text-red-700 dark:text-red-400 mb-3",children:m("teamWorktime.shifts.modal.edit.deleteConfirm")}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{type:"button",onClick:le,disabled:Z,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:m("common.yes")}),(0,T.jsx)("button",{type:"button",onClick:()=>ee(!1),className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:m("common.no")})]})]})]})};return b?(0,T.jsxs)(N.lG,{open:t,onClose:de,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.modal.edit.title")}),(0,T.jsx)("button",{onClick:de,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:ie,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[Y&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:Y}),$?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):ne()]}),(0,T.jsxs)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:de,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Z||$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(Z?"common.saving":"common.save"),children:Z?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(Z?"common.saving":"common.save")})]})]})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!h&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:de,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.modal.edit.title")}),(0,T.jsx)("button",{onClick:de,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:ie,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Y&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:Y}),$?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):ne()]}),(0,T.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:de,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:Z||$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(Z?"common.saving":"common.save"),children:Z?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(Z?"common.saving":"common.save")})]})]})]})]}),c.userId===(null===x||void 0===x?void 0:x.id)&&(0,T.jsx)(ye,{isOpen:te,onClose:()=>ae(!1),onSwapRequestCreated:()=>{ae(!1),i(c)},originalShift:c})]})};var ve=a(9399),ke=a(4538);const je=e=>{let{isOpen:t,onClose:a,onPlanGenerated:i,initialStartDate:o,initialEndDate:c}=e;const{t:m}=(0,r.Bd)(),{openSidepane:x,closeSidepane:u}=(0,he.N)(),[g,h]=(0,s.useState)(window.innerWidth>1070),[p,b]=(0,s.useState)(window.innerWidth<640),[y,f]=(0,s.useState)(o?(0,n.GP)(o,"yyyy-MM-dd"):(0,n.GP)((0,le.k)(new Date,{weekStartsOn:1}),"yyyy-MM-dd")),[v,k]=(0,s.useState)(c?(0,n.GP)(c,"yyyy-MM-dd"):(0,n.GP)((0,de.$)(new Date,{weekStartsOn:1}),"yyyy-MM-dd")),[j,w]=(0,s.useState)(""),[C,D]=(0,s.useState)([]),[E,I]=(0,s.useState)([]),[L,F]=(0,s.useState)([]),[M,q]=(0,s.useState)(null),[P,z]=(0,s.useState)(!1),[H,O]=(0,s.useState)(!1),[R,G]=(0,s.useState)(!1),[B,_]=(0,s.useState)(null),[V,U]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(x(),Y(),_(null),U(!1)):u(),()=>{u()})),[t,x,u]),(0,s.useEffect)((()=>{t&&j?K():(F([]),D([]))}),[t,j]),(0,s.useEffect)((()=>{E.length>0&&""===j&&w(E[0].id)}),[E,j]);const Y=async()=>{O(!0),q(null);try{if(!localStorage.getItem("token"))return q("Nicht authentifiziert"),void O(!1);const e=await l.A.get(d.Sn.BRANCHES.BASE);I(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der Branches:",a),q((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.generate.errors.loadBranchesError"))}finally{O(!1)}},K=async()=>{if(j)try{q(null);const e=(await l.A.get(d.Sn.ROLES.BASE)).data||[];F(e)}catch(a){var e,t;console.error("Fehler beim Laden der Rollen:",a),q((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||m("teamWorktime.shifts.generate.errors.loadRolesError"))}},Z=()=>{C.length===L.length?D([]):D(L.map((e=>e.id)))},Q=async e=>{e.preventDefault(),q(null),G(!0),_(null),U(!1);try{if(!y||!v||!j)return q(m("teamWorktime.shifts.generate.errors.fillRequiredFields")),void G(!1);const e=new Date(y),t=new Date(v);if(isNaN(e.getTime())||isNaN(t.getTime()))return q(m("teamWorktime.shifts.generate.errors.invalidDates")),void G(!1);if(e>=t)return q(m("teamWorktime.shifts.generate.errors.startDateAfterEndDate")),void G(!1);if(!localStorage.getItem("token"))return q("Nicht authentifiziert"),void G(!1);const a={startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0],branchId:Number(j)};C.length>0&&(a.roleIds=C);const s=await l.A.post(d.Sn.SHIFTS.GENERATE,a),r=s.data.data||s.data;_(r),U(!0),i()}catch(s){var t,a;console.error("Fehler beim Generieren des Schichtplans:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||m("teamWorktime.shifts.generate.errors.generateError");q(e)}finally{G(!1)}},$=()=>{q(null),_(null),U(!1),D([]),a()},J=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.startDate")," *"]}),(0,T.jsx)("input",{type:"date",value:y,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.endDate")," *"]}),(0,T.jsx)("input",{type:"date",value:v,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[m("teamWorktime.shifts.generate.form.branch")," *"]}),(0,T.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),D([])},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,T.jsx)("option",{value:"",children:m("teamWorktime.shifts.generate.form.selectBranch")}),E.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:m("teamWorktime.shifts.generate.form.roles")}),L.length>0&&(0,T.jsx)("button",{type:"button",onClick:Z,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:C.length===L.length?m("teamWorktime.shifts.generate.form.deselectAll"):m("teamWorktime.shifts.generate.form.selectAll")})]}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:m("teamWorktime.shifts.generate.form.rolesHint")}),j?0===L.length?(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:m("teamWorktime.shifts.generate.form.noRolesAvailable")}):(0,T.jsx)("div",{className:"max-h-48 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 space-y-2",children:L.map((e=>(0,T.jsxs)("label",{className:"flex items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[(0,T.jsx)("input",{type:"checkbox",checked:C.includes(e.id),onChange:()=>{return t=e.id,void D((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))}):(0,T.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md text-sm text-gray-500 dark:text-gray-400",children:m("teamWorktime.shifts.generate.form.selectBranchFirst")})]})]}),X=()=>B?(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-3",children:m("teamWorktime.shifts.generate.result.summary")}),(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-blue-700 dark:text-blue-400",children:m("teamWorktime.shifts.generate.result.total")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-blue-900 dark:text-blue-300",children:B.summary.total})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-green-700 dark:text-green-400",children:m("teamWorktime.shifts.generate.result.assigned")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-green-900 dark:text-green-300",children:B.summary.assigned})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-orange-700 dark:text-orange-400",children:m("teamWorktime.shifts.generate.result.unassigned")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-orange-900 dark:text-orange-300",children:B.summary.unassigned})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{className:"text-xs text-red-700 dark:text-red-400",children:m("teamWorktime.shifts.generate.result.conflicts")}),(0,T.jsx)("div",{className:"text-lg font-semibold text-red-900 dark:text-red-300",children:B.summary.conflicts})]})]})]}),B.conflicts&&B.conflicts.length>0&&(0,T.jsxs)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md",children:[(0,T.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,T.jsx)(ve.A,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),(0,T.jsxs)("h3",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-300",children:[m("teamWorktime.shifts.generate.result.conflictsTitle")," (",B.conflicts.length,")"]})]}),(0,T.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-1",children:B.conflicts.map(((e,t)=>(0,T.jsxs)("div",{className:"text-xs text-yellow-800 dark:text-yellow-400",children:[(0,n.GP)(new Date(e.date),"dd.MM.yyyy"),": ",e.reason]},t)))})]}),0===B.summary.conflicts&&0===B.summary.unassigned&&(0,T.jsx)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)(ke.A,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),(0,T.jsx)("span",{className:"text-sm font-medium text-green-900 dark:text-green-300",children:m("teamWorktime.shifts.generate.result.success")})]})})]}):null;return p?(0,T.jsxs)(N.lG,{open:t,onClose:$,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.generate.title")}),(0,T.jsx)("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsxs)("form",{onSubmit:Q,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:[M&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:M}),V&&B?X():H?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):J()]}),(0,T.jsx)("div",{className:"px-6 py-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:V?(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",title:m("common.close"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.close")})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:R||H,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(R?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate"),children:R?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(R?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate")})]})]})})]})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!g&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:$,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:m("teamWorktime.shifts.generate.title")}),(0,T.jsx)("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:Q,className:"flex flex-col flex-1 min-h-0",children:[(0,T.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[M&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:M}),V&&B?X():H?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:m("common.loading")}):J()]}),(0,T.jsx)("div",{className:"p-4 border-t dark:border-gray-700 flex-shrink-0 flex justify-end gap-2",children:V?(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",title:m("common.close"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.close")})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:$,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:m("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:R||H,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:m(R?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate"),children:R?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:m(R?"teamWorktime.shifts.generate.generating":"teamWorktime.shifts.generate.generate")})]})]})})]})]})]})};var we=a(7098);const Ne=e=>{let{isOpen:t,onClose:a,onSwapRequestUpdated:i}=e;const{t:o}=(0,r.Bd)(),{user:c}=(0,ce.As)(),{openSidepane:m,closeSidepane:x}=(0,he.N)(),[u,g]=(0,s.useState)(window.innerWidth>1070),[h,p]=(0,s.useState)(window.innerWidth<640),[b,y]=(0,s.useState)([]),[f,v]=(0,s.useState)(!1),[k,j]=(0,s.useState)(null),[w,C]=(0,s.useState)(null),[D,E]=(0,s.useState)("all");(0,s.useEffect)((()=>{const e=()=>{p(window.innerWidth<640),g(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(m(),I()):x(),()=>{x()})),[t,m,x]);const I=async()=>{v(!0),j(null);try{var e;const t=await l.A.get(d.Sn.SHIFTS.SWAPS.BASE,{params:null!==c&&void 0!==c&&c.id?{userId:c.id}:{}}),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];y(Array.isArray(a)?a:[])}catch(s){var t,a;console.error("Fehler beim Laden der Tausch-Anfragen:",s),j((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||o("teamWorktime.shifts.swapList.errors.loadError"))}finally{v(!1)}},L=b.filter((e=>"all"===D||e.status===D)),F=L.filter((e=>e.requestedBy===(null===c||void 0===c?void 0:c.id))),M=L.filter((e=>e.requestedFrom===(null===c||void 0===c?void 0:c.id))),q=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},P=e=>{switch(e){case"pending":return o("teamWorktime.shifts.swapList.status.pending");case"approved":return o("teamWorktime.shifts.swapList.status.approved");case"rejected":return o("teamWorktime.shifts.swapList.status.rejected");default:return e}},z=(e,t)=>{var a,s;return(0,T.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg mb-4",children:[(0,T.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(q(e.status)),children:P(e.status)}),(0,T.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,n.GP)(new Date(e.createdAt),"dd.MM.yyyy HH:mm")})]}),t?(0,T.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[e.requester.firstName," ",e.requester.lastName]})," ",o("teamWorktime.shifts.swapList.wantsToSwap")]}):(0,T.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[o("teamWorktime.shifts.swapList.youRequestedSwap")," ",(0,T.jsxs)("span",{className:"font-medium",children:[e.requestee.firstName," ",e.requestee.lastName]})]})]})}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,T.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,T.jsx)("h4",{className:"text-xs font-semibold text-blue-900 dark:text-blue-300 mb-1",children:o(t?"teamWorktime.shifts.swapList.theirShift":"teamWorktime.shifts.swapList.yourShift")}),(0,T.jsxs)("div",{className:"text-xs text-blue-800 dark:text-blue-400",children:[(0,T.jsx)("div",{children:(null===(a=e.originalShift.shiftTemplate)||void 0===a?void 0:a.name)||o("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,n.GP)(new Date(e.originalShift.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,n.GP)(new Date(e.originalShift.startTime),"HH:mm")," - ",(0,n.GP)(new Date(e.originalShift.endTime),"HH:mm")]}),e.originalShift.branch&&(0,T.jsx)("div",{children:e.originalShift.branch.name})]})]}),(0,T.jsxs)("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[(0,T.jsx)("h4",{className:"text-xs font-semibold text-green-900 dark:text-green-300 mb-1",children:o(t?"teamWorktime.shifts.swapList.theirShift":"teamWorktime.shifts.swapList.yourShift")}),(0,T.jsxs)("div",{className:"text-xs text-green-800 dark:text-green-400",children:[(0,T.jsx)("div",{children:(null===(s=e.targetShift.shiftTemplate)||void 0===s?void 0:s.name)||o("teamWorktime.shifts.swap.form.shift")}),(0,T.jsx)("div",{children:(0,n.GP)(new Date(e.targetShift.date),"dd.MM.yyyy")}),(0,T.jsxs)("div",{children:[(0,n.GP)(new Date(e.targetShift.startTime),"HH:mm")," - ",(0,n.GP)(new Date(e.targetShift.endTime),"HH:mm")]}),e.targetShift.branch&&(0,T.jsx)("div",{children:e.targetShift.branch.name})]})]})]}),e.message&&(0,T.jsxs)("div",{className:"mb-3 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm text-gray-700 dark:text-gray-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[o("teamWorktime.shifts.swapList.message"),":"]})," ",e.message]}),e.responseMessage&&(0,T.jsxs)("div",{className:"mb-3 p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-sm text-blue-700 dark:text-blue-300",children:[(0,T.jsxs)("span",{className:"font-medium",children:[o("teamWorktime.shifts.swapList.response"),":"]})," ",e.responseMessage]}),t&&"pending"===e.status&&(0,T.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,T.jsx)("button",{onClick:()=>(async e=>{if(c){C(e.id),j(null);try{await l.A.put(d.Sn.SHIFTS.SWAPS.APPROVE(e.id),{responseMessage:null}),await I(),i()}catch(s){var t,a;console.error("Fehler beim Genehmigen der Tausch-Anfrage:",s),j((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||o("teamWorktime.shifts.swapList.errors.approveError"))}finally{C(null)}}})(e),disabled:w===e.id,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===e.id?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(W.A,{className:"h-4 w-4 animate-spin"}),o("teamWorktime.shifts.swapList.approving")]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A.A,{className:"h-4 w-4"}),o("teamWorktime.shifts.swapList.approve")]})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(c){C(e.id),j(null);try{await l.A.put(d.Sn.SHIFTS.SWAPS.REJECT(e.id),{responseMessage:null}),await I(),i()}catch(s){var t,a;console.error("Fehler beim Ablehnen der Tausch-Anfrage:",s),j((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||o("teamWorktime.shifts.swapList.errors.rejectError"))}finally{C(null)}}})(e),disabled:w===e.id,className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w===e.id?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(W.A,{className:"h-4 w-4 animate-spin"}),o("teamWorktime.shifts.swapList.rejecting")]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(we.A,{className:"h-4 w-4"}),o("teamWorktime.shifts.swapList.reject")]})})]})]},e.id)},H=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>E("all"),className:"px-3 py-1 text-sm rounded-md ".concat("all"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.all")}),(0,T.jsx)("button",{onClick:()=>E("pending"),className:"px-3 py-1 text-sm rounded-md ".concat("pending"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.pending")}),(0,T.jsx)("button",{onClick:()=>E("approved"),className:"px-3 py-1 text-sm rounded-md ".concat("approved"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.approved")}),(0,T.jsx)("button",{onClick:()=>E("rejected"),className:"px-3 py-1 text-sm rounded-md ".concat("rejected"===D?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:o("teamWorktime.shifts.swapList.filter.rejected")})]}),k&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:k}),f?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:o("common.loading")}):(0,T.jsxs)(T.Fragment,{children:[M.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:[o("teamWorktime.shifts.swapList.receivedRequests")," (",M.length,")"]}),M.map((e=>z(e,!0)))]}),F.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:[o("teamWorktime.shifts.swapList.yourRequests")," (",F.length,")"]}),F.map((e=>z(e,!1)))]}),0===L.length&&(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("teamWorktime.shifts.swapList.noRequests")})]})]});return h?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.shifts.swapList.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:H()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!u&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("teamWorktime.shifts.swapList.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:H()})]})]})},Se=e=>{let{isOpen:t,onClose:a}=e;const{t:i}=(0,r.Bd)(),{openSidepane:n,closeSidepane:c}=(0,he.N)(),[m,x]=(0,s.useState)(window.innerWidth>1070),[u,g]=(0,s.useState)(window.innerWidth<640),[h,p]=(0,s.useState)([]),[b,y]=(0,s.useState)([]),[v,k]=(0,s.useState)([]),[j,w]=(0,s.useState)(!1),[C,E]=(0,s.useState)(!1),[I,L]=(0,s.useState)(null),[F,M]=(0,s.useState)(!1),[q,P]=(0,s.useState)(null),[z,H]=(0,s.useState)({name:"",roleId:"",branchId:"",startTime:"",endTime:"",duration:"",isActive:!0});(0,s.useEffect)((()=>{const e=()=>{g(window.innerWidth<640),x(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(n(),O()):(c(),M(!1),P(null),R()),()=>{c()})),[t,n,c]);const O=async()=>{E(!0),L(null);try{var e;const[t,a,s]=await Promise.all([l.A.get(d.Sn.SHIFTS.TEMPLATES.BASE,{params:{includeInactive:!0}}),l.A.get(d.Sn.ROLES.BASE),l.A.get(d.Sn.BRANCHES.BASE)]);p((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[]),y(a.data||[]),k(s.data||[])}catch(s){var t,a;console.error("Fehler beim Laden der Daten:",s),L((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.templates.errors.loadError"))}finally{E(!1)}},R=()=>{H({name:"",roleId:"",branchId:"",startTime:"",endTime:"",duration:"",isActive:!0}),P(null)},G=async e=>{e.preventDefault(),L(null),w(!0);try{if(!z.name||!z.roleId||!z.branchId||!z.startTime||!z.endTime)return L(i("teamWorktime.shifts.templates.errors.fillRequiredFields")),void w(!1);const e={name:z.name.trim(),roleId:Number(z.roleId),branchId:Number(z.branchId),startTime:z.startTime,endTime:z.endTime,duration:z.duration?Number(z.duration):null,isActive:z.isActive};q?await l.A.put(d.Sn.SHIFTS.TEMPLATES.BY_ID(q.id),e):await l.A.post(d.Sn.SHIFTS.TEMPLATES.BASE,e),await O(),M(!1),R()}catch(s){var t,a;console.error("Fehler beim Speichern des Templates:",s),L((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.templates.errors.saveError"))}finally{w(!1)}},B=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[I&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:I}),F?(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i(q?"teamWorktime.shifts.templates.editTitle":"teamWorktime.shifts.templates.createTitle")}),(0,T.jsx)("button",{onClick:()=>{M(!1),R()},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:G,className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.name")," *"]}),(0,T.jsx)("input",{type:"text",value:z.name,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.branch")," *"]}),(0,T.jsxs)("select",{value:z.branchId,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{branchId:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!!q,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.templates.form.selectBranch")}),v.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.role")," *"]}),(0,T.jsxs)("select",{value:z.roleId,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{roleId:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,disabled:!!q,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.templates.form.selectRole")}),b.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.startTime")," *"]}),(0,T.jsx)("input",{type:"time",value:z.startTime,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.templates.form.endTime")," *"]}),(0,T.jsx)("input",{type:"time",value:z.endTime,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.templates.form.duration")}),(0,T.jsx)("input",{type:"number",value:z.duration,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{duration:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:i("teamWorktime.shifts.templates.form.durationPlaceholder"),min:"0"})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"checkbox",id:"isActive",checked:z.isActive,onChange:e=>H((0,o.A)((0,o.A)({},z),{},{isActive:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("teamWorktime.shifts.templates.form.isActive")})]}),(0,T.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{M(!1),R()},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:i(j?"common.saving":"common.save"),children:j?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i(j?"common.saving":"common.save")})]})]})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:()=>M(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,T.jsx)(re.A,{className:"h-5 w-5"})})]}),C?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:i("common.loading")}):0===h.length?(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i("teamWorktime.shifts.templates.noTemplates")}):(0,T.jsx)("div",{className:"space-y-2",children:h.map((e=>{var t,a;return(0,T.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg flex items-center justify-between",children:[(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),!e.isActive&&(0,T.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:i("teamWorktime.shifts.templates.inactive")})]}),(0,T.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[null===(t=e.branch)||void 0===t?void 0:t.name," - ",null===(a=e.role)||void 0===a?void 0:a.name]}),(0,T.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:[e.startTime," - ",e.endTime,e.duration&&" (".concat(e.duration," ").concat(i("teamWorktime.shifts.templates.minutes"),")")]})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>(e=>{P(e),H({name:e.name,roleId:e.roleId,branchId:e.branchId,startTime:e.startTime,endTime:e.endTime,duration:e.duration||"",isActive:e.isActive}),M(!0)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:(0,T.jsx)(f.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(i("teamWorktime.shifts.templates.deleteConfirm"))){L(null),w(!0);try{await l.A.delete(d.Sn.SHIFTS.TEMPLATES.BY_ID(e)),await O()}catch(s){var t,a;console.error("Fehler beim L\xf6schen des Templates:",s),L((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.templates.errors.deleteError"))}finally{w(!1)}}})(e.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:(0,T.jsx)(D.A,{className:"h-5 w-5"})})]})]},e.id)}))})]})]});return u?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:B()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!m&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.templates.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:B()})]})]})},We=e=>{let{isOpen:t,onClose:a}=e;const{t:i}=(0,r.Bd)(),{user:c}=(0,ce.As)(),{hasPermission:m}=(0,q.S)(),{openSidepane:x,closeSidepane:u}=(0,he.N)(),[g,h]=(0,s.useState)(window.innerWidth>1070),[p,b]=(0,s.useState)(window.innerWidth<640),y=m("availability_management","write","page"),[v,k]=(0,s.useState)([]),[j,w]=(0,s.useState)([]),[C,E]=(0,s.useState)([]),[I,L]=(0,s.useState)([]),[F,M]=(0,s.useState)(null),[P,z]=(0,s.useState)(!1),[H,O]=(0,s.useState)(!1),[R,G]=(0,s.useState)(null),[B,_]=(0,s.useState)(!1),[V,U]=(0,s.useState)(null),[Y,K]=(0,s.useState)({userId:null,branchId:"",roleId:"",dayOfWeek:"",startTime:"",endTime:"",startDate:"",endDate:"",type:"available",priority:5,notes:"",isActive:!0}),Z=[{value:"",label:i("teamWorktime.shifts.availabilities.form.allDays")},{value:0,label:i("teamWorktime.shifts.availabilities.form.sunday")},{value:1,label:i("teamWorktime.shifts.availabilities.form.monday")},{value:2,label:i("teamWorktime.shifts.availabilities.form.tuesday")},{value:3,label:i("teamWorktime.shifts.availabilities.form.wednesday")},{value:4,label:i("teamWorktime.shifts.availabilities.form.thursday")},{value:5,label:i("teamWorktime.shifts.availabilities.form.friday")},{value:6,label:i("teamWorktime.shifts.availabilities.form.saturday")}];(0,s.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?(x(),Q()):(u(),_(!1),U(null),$(),M(null)),()=>{u()})),[t,x,u,F,y]);const Q=async()=>{O(!0),G(null);try{var e;if(y)try{const e=await l.A.get(d.Sn.USERS.DROPDOWN);L(e.data||[])}catch(s){console.error("Fehler beim Laden der User:",s)}const t={includeInactive:!0};y&&F?t.userId=F:y&&!F||null!==c&&void 0!==c&&c.id&&(t.userId=c.id);const[a,r,i]=await Promise.all([l.A.get(d.Sn.SHIFTS.AVAILABILITIES.BASE,{params:t}),l.A.get(d.Sn.ROLES.BASE),l.A.get(d.Sn.BRANCHES.BASE)]);k((null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[]),w(r.data||[]),E(i.data||[])}catch(s){var t,a;console.error("Fehler beim Laden der Daten:",s),G((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.availabilities.errors.loadError"))}finally{O(!1)}},$=()=>{K({userId:null,branchId:"",roleId:"",dayOfWeek:"",startTime:"",endTime:"",startDate:"",endDate:"",type:"available",priority:5,notes:"",isActive:!0}),U(null)},J=async e=>{e.preventDefault(),G(null),z(!0);try{const e={branchId:Y.branchId?Number(Y.branchId):null,roleId:Y.roleId?Number(Y.roleId):null,dayOfWeek:""===Y.dayOfWeek||null===Y.dayOfWeek?null:Number(Y.dayOfWeek),startTime:Y.startTime||null,endTime:Y.endTime||null,startDate:Y.startDate||null,endDate:Y.endDate||null,type:Y.type,priority:Y.priority,notes:Y.notes.trim()||null,isActive:Y.isActive};y&&Y.userId&&(e.userId=Y.userId),V?await l.A.put(d.Sn.SHIFTS.AVAILABILITIES.BY_ID(V.id),e):await l.A.post(d.Sn.SHIFTS.AVAILABILITIES.BASE,e),await Q(),_(!1),$()}catch(s){var t,a;console.error("Fehler beim Speichern der Verf\xfcgbarkeit:",s),G((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.availabilities.errors.saveError"))}finally{z(!1)}},X=e=>{if(null===e)return i("teamWorktime.shifts.availabilities.form.allDays");return[i("teamWorktime.shifts.availabilities.form.sunday"),i("teamWorktime.shifts.availabilities.form.monday"),i("teamWorktime.shifts.availabilities.form.tuesday"),i("teamWorktime.shifts.availabilities.form.wednesday"),i("teamWorktime.shifts.availabilities.form.thursday"),i("teamWorktime.shifts.availabilities.form.friday"),i("teamWorktime.shifts.availabilities.form.saturday")][e]},ee=e=>{switch(e){case"available":return i("teamWorktime.shifts.availabilities.type.available");case"preferred":return i("teamWorktime.shifts.availabilities.type.preferred");case"unavailable":return i("teamWorktime.shifts.availabilities.type.unavailable");default:return e}},te=e=>{switch(e){case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"preferred":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"unavailable":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},ae=()=>(0,T.jsxs)("div",{className:"space-y-4",children:[R&&(0,T.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded",children:R}),y&&!B&&(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("teamWorktime.shifts.availabilities.filter.user")}),(0,T.jsxs)("select",{value:F||"",onChange:e=>{const t=e.target.value?parseInt(e.target.value,10):null;M(t)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.filter.allUsers")}),I.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),B?(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i(V?"teamWorktime.shifts.availabilities.editTitle":"teamWorktime.shifts.availabilities.createTitle")}),(0,T.jsx)("button",{onClick:()=>{_(!1),$()},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[y&&(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.user")}),(0,T.jsxs)("select",{value:Y.userId||"",onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{userId:e.target.value?Number(e.target.value):null})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!!V,children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectUser")}),I.map((e=>(0,T.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]}),V&&(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.userReadOnly")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.branch")}),(0,T.jsxs)("select",{value:Y.branchId,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{branchId:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectBranch")}),C.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.role")}),(0,T.jsxs)("select",{value:Y.roleId,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{roleId:e.target.value?Number(e.target.value):""})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"",children:i("teamWorktime.shifts.availabilities.form.selectRole")}),j.map((e=>(0,T.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.dayOfWeek")}),(0,T.jsx)("select",{value:null===Y.dayOfWeek?"":Y.dayOfWeek,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{dayOfWeek:""===e.target.value?null:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Z.map((e=>(0,T.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.startTime")}),(0,T.jsx)("input",{type:"time",value:Y.startTime,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.startTimeHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.endTime")}),(0,T.jsx)("input",{type:"time",value:Y.endTime,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.endTimeHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.startDate")}),(0,T.jsx)("input",{type:"date",value:Y.startDate,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{startDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.startDateHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.endDate")}),(0,T.jsx)("input",{type:"date",value:Y.endDate,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{endDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,T.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i("teamWorktime.shifts.availabilities.form.endDateHint")})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.type")}),(0,T.jsxs)("select",{value:Y.type,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,T.jsx)("option",{value:"available",children:i("teamWorktime.shifts.availabilities.type.available")}),(0,T.jsx)("option",{value:"preferred",children:i("teamWorktime.shifts.availabilities.type.preferred")}),(0,T.jsx)("option",{value:"unavailable",children:i("teamWorktime.shifts.availabilities.type.unavailable")})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("teamWorktime.shifts.availabilities.form.priority")," (1-10)"]}),(0,T.jsx)("input",{type:"number",value:Y.priority,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{priority:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"10"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("teamWorktime.shifts.availabilities.form.notes")}),(0,T.jsx)("textarea",{value:Y.notes,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{notes:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:i("teamWorktime.shifts.availabilities.form.notesPlaceholder")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("input",{type:"checkbox",id:"isActive",checked:Y.isActive,onChange:e=>K((0,o.A)((0,o.A)({},Y),{},{isActive:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:i("teamWorktime.shifts.availabilities.form.isActive")})]}),(0,T.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{_(!1),$()},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,T.jsx)(S.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i("common.cancel")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"submit",disabled:P,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:i(P?"common.saving":"common.save"),children:P?(0,T.jsx)(W.A,{className:"h-5 w-5 animate-spin"}):(0,T.jsx)(A.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:i(P?"common.saving":"common.save")})]})]})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:()=>_(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,T.jsx)(re.A,{className:"h-5 w-5"})})]}),H?(0,T.jsx)("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400",children:i("common.loading")}):0===v.length?(0,T.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i("teamWorktime.shifts.availabilities.noAvailabilities")}):(0,T.jsx)("div",{className:"space-y-2",children:v.map((e=>(0,T.jsx)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:(0,T.jsxs)("div",{className:"flex items-start justify-between",children:[(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,T.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(te(e.type)),children:ee(e.type)}),!e.isActive&&(0,T.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:i("teamWorktime.shifts.availabilities.inactive")}),e.priority&&(0,T.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i("teamWorktime.shifts.availabilities.priority"),": ",e.priority]})]}),(0,T.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[e.user&&y&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.userLabel"),":"]})," ",e.user.firstName," ",e.user.lastName]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.dayOfWeek"),":"]})," ",X(e.dayOfWeek)]}),e.startTime&&e.endTime&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.startTime")," - ",i("teamWorktime.shifts.availabilities.form.endTime"),":"]})," ",e.startTime," - ",e.endTime]}),e.startDate&&e.endDate&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.startDate")," - ",i("teamWorktime.shifts.availabilities.form.endDate"),":"]})," ",(0,n.GP)(new Date(e.startDate),"dd.MM.yyyy")," - ",(0,n.GP)(new Date(e.endDate),"dd.MM.yyyy")]}),e.branch&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.branch"),":"]})," ",e.branch.name]}),e.role&&(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-medium",children:[i("teamWorktime.shifts.availabilities.form.role"),":"]})," ",e.role.name]}),e.notes&&(0,T.jsx)("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-700 rounded text-xs",children:e.notes})]})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("button",{onClick:()=>(e=>{U(e),K({userId:e.userId,branchId:e.branchId||"",roleId:e.roleId||"",dayOfWeek:null!==e.dayOfWeek?e.dayOfWeek:"",startTime:e.startTime||"",endTime:e.endTime||"",startDate:e.startDate?(0,n.GP)(new Date(e.startDate),"yyyy-MM-dd"):"",endDate:e.endDate?(0,n.GP)(new Date(e.endDate),"yyyy-MM-dd"):"",type:e.type,priority:e.priority,notes:e.notes||"",isActive:e.isActive}),_(!0)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:(0,T.jsx)(f.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(i("teamWorktime.shifts.availabilities.deleteConfirm"))){G(null),z(!0);try{await l.A.delete(d.Sn.SHIFTS.AVAILABILITIES.BY_ID(e)),await Q()}catch(s){var t,a;console.error("Fehler beim L\xf6schen der Verf\xfcgbarkeit:",s),G((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message||i("teamWorktime.shifts.availabilities.errors.deleteError"))}finally{z(!1)}}})(e.id),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:(0,T.jsx)(D.A,{className:"h-5 w-5"})})]})]})},e.id)))})]})]});return p?(0,T.jsxs)(N.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,T.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,T.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,T.jsxs)(N.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,T.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,T.jsxs)("div",{className:"flex items-center justify-between",children:[(0,T.jsx)(N.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]})}),(0,T.jsx)("div",{className:"p-6 overflow-y-auto flex-1 min-h-0",children:ae()})]})})]}):(0,T.jsxs)(T.Fragment,{children:[t&&!g&&(0,T.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:a,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,T.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,T.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("teamWorktime.shifts.availabilities.title")}),(0,T.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,T.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:ae()})]})]})},Ae=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1","#14b8a6","#a855f7","#eab308","#22c55e","#64748b"],Te={scheduled:"#3b82f6",confirmed:"#10b981",cancelled:"#ef4444",swapped:"#f59e0b"};function Ce(e){return e?Ae[e%Ae.length]:"#64748b"}function De(e){return Te[e]||"#64748b"}const Ee=e=>{let{selectedDate:t}=e;const{t:a}=(0,r.Bd)(),{user:i}=(0,ce.As)(),[o,c]=(0,s.useState)([]),[m,x]=(0,s.useState)([]),[u,g]=(0,s.useState)(!1),[p,y]=(0,s.useState)(null),[f,v]=(0,s.useState)(new Date),[k,j]=(0,s.useState)("timeGridWeek"),w=(0,s.useRef)(null),N=(0,s.useRef)(!1),[A,C]=(0,s.useState)(!1),[D,E]=(0,s.useState)([]),[I,L]=(0,s.useState)([]),[F,M]=(0,s.useState)([]),[q,P]=(0,s.useState)([]),[z,H]=(0,s.useState)([]),[O,R]=(0,s.useState)([]),[G,B]=(0,s.useState)([]),[_,V]=(0,s.useState)(!1),[U,Y]=(0,s.useState)(!1),[K,Z]=(0,s.useState)(!1),[Q,$]=(0,s.useState)(!1),[J,X]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),[ae,se]=(0,s.useState)(null),[he,be]=(0,s.useState)(void 0),ye=(0,s.useCallback)((async e=>{try{g(!0),y(null);const s=(0,le.k)(e,{weekStartsOn:1}),r=(0,de.$)(e,{weekStartsOn:1}),i=d.Sn.SHIFTS.BASE,o={startDate:(0,n.GP)(s,"yyyy-MM-dd"),endDate:(0,n.GP)(r,"yyyy-MM-dd")};console.log("[ShiftPlanner] Fetching shifts from:",i),console.log("[ShiftPlanner] Params:",o),console.log("[ShiftPlanner] Full URL:","".concat(l.A.defaults.baseURL).concat(i));const c=await l.A.get(i,{params:o});if(console.log("[ShiftPlanner] Response status:",c.status),console.log("[ShiftPlanner] Response data:",c.data),c.data&&!1!==c.data.success){const e=c.data.data||c.data||[],t=Array.isArray(e)?e:[];x(t),console.log("[ShiftPlanner] Loaded shifts:",t.length)}else{var t;const e=(null===(t=c.data)||void 0===t?void 0:t.message)||a("teamWorktime.shifts.messages.loadError");console.error("[ShiftPlanner] Error in response:",e),y(e)}}catch(p){var s,r,i,o,c;if(console.error("[ShiftPlanner] Fehler beim Laden der Schichten:",p),console.error("[ShiftPlanner] Error details:",{message:p.message,response:p.response,status:null===(s=p.response)||void 0===s?void 0:s.status,statusText:null===(r=p.response)||void 0===r?void 0:r.statusText,data:null===(i=p.response)||void 0===i?void 0:i.data,url:null===(o=p.config)||void 0===o?void 0:o.url,baseURL:null===(c=p.config)||void 0===c?void 0:c.baseURL,fullURL:p.config?"".concat(p.config.baseURL).concat(p.config.url):"unknown"}),p.response){const t=p.response.status,s=p.response.data;var m;if(404===t)console.error("[ShiftPlanner] 404 - Route nicht gefunden. URL:",null===(m=p.config)||void 0===m?void 0:m.url),y(a("teamWorktime.shifts.messages.routeNotFound"));else if(401===t)console.error("[ShiftPlanner] 401 - Nicht authentifiziert"),y(a("teamWorktime.shifts.messages.unauthorized"));else if(403===t)console.error("[ShiftPlanner] 403 - Keine Berechtigung"),y(a("teamWorktime.shifts.messages.forbidden"));else{const r=(null===s||void 0===s?void 0:s.message)||p.message||a("teamWorktime.shifts.messages.loadError");console.error("[ShiftPlanner] Anderer Fehler:",t,r),y(r)}}else p.request?(console.error("[ShiftPlanner] Keine Response erhalten. Request:",p.request),y(a("teamWorktime.shifts.messages.loadError")+" (Keine Verbindung zum Server)")):(console.error("[ShiftPlanner] Fehler beim Setup der Request:",p.message),y(p.message||a("teamWorktime.shifts.messages.loadError")))}finally{g(!1)}}),[a]);(0,s.useEffect)((()=>{ye(f)}),[f,ye]),(0,s.useEffect)((()=>{(async()=>{try{const[e,t,a]=await Promise.all([l.A.get(d.Sn.BRANCHES.BASE),l.A.get(d.Sn.ROLES.BASE),l.A.get(d.Sn.USERS.DROPDOWN)]);H(e.data||[]),R(t.data||[]),B(a.data||[])}catch(e){console.error("Fehler beim Laden der Filter-Daten:",e)}})()}),[]),(0,s.useEffect)((()=>{let e=[...m];D.length>0&&(e=e.filter((e=>D.includes(e.branchId)))),I.length>0&&(e=e.filter((e=>I.includes(e.roleId)))),F.length>0&&(e=e.filter((e=>F.includes(e.status)))),q.length>0&&(e=e.filter((e=>e.userId&&q.includes(e.userId)))),c(e)}),[m,D,I,F,q]);const ve=(0,le.k)(f,{weekStartsOn:1}),ke=(0,de.$)(f,{weekStartsOn:1}),we=(0,s.useMemo)((()=>o.map((e=>{var t,a;const s=new Date(e.startTime),r=new Date(e.endTime),i=Ce(e.branchId),l=De(e.status);return{id:e.id.toString(),title:e.user?"".concat((null===(t=e.shiftTemplate)||void 0===t?void 0:t.name)||"Schicht"," - ").concat(e.user.firstName," ").concat(e.user.lastName):"".concat((null===(a=e.shiftTemplate)||void 0===a?void 0:a.name)||"Schicht"," - Nicht zugewiesen"),start:s.toISOString(),end:r.toISOString(),backgroundColor:i,borderColor:l,borderWidth:3,textColor:"#ffffff",extendedProps:{shift:e}}}))),[o]),Ae=()=>D.length+I.length+F.length+q.length,Te=[{value:"scheduled",label:a("teamWorktime.shifts.status.scheduled")},{value:"confirmed",label:a("teamWorktime.shifts.status.confirmed")},{value:"cancelled",label:a("teamWorktime.shifts.status.cancelled")},{value:"swapped",label:a("teamWorktime.shifts.status.swapped")}];return(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4 px-3 sm:px-4 md:px-6",children:[(0,T.jsx)("div",{className:"flex items-center",children:(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{be(f),V(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":a("teamWorktime.shifts.actions.add"),children:(0,T.jsx)(re.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.actions.add")})]})}),(0,T.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v((0,ne.k)(f,1))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.previousDay")})]}),(0,T.jsxs)("div",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white px-2 sm:px-3",children:[(0,n.GP)(ve,"dd.MM.yyyy")," - ",(0,n.GP)(ke,"dd.MM.yyyy")]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v((0,oe.J)(f,1))},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.nextDay")})]}),(0,T.jsxs)("div",{className:"relative group ml-1",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{N.current=!0,v(new Date)},className:"p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)(ie.A,{className:"h-4 w-4"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.today")})]})]}),(0,T.jsxs)("div",{className:"flex items-center gap-1",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsxs)("button",{type:"button",onClick:()=>C(!A),className:"p-2 rounded-md ".concat(Ae()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"," focus:outline-none focus:ring-2 focus:ring-blue-500 relative"),children:[(0,T.jsx)(b.A,{className:"h-5 w-5"}),Ae()>0&&(0,T.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",children:Ae()})]}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.filter")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>te(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.availabilities.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>X(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.templates.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>$(!0),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.swapList.title")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>{Z(!0)},className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("teamWorktime.shifts.actions.generate")})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("button",{type:"button",onClick:()=>ye(f),className:"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,T.jsx)(W.A,{className:"h-5 w-5"})}),(0,T.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:a("common.refresh")})]})]})]}),p&&(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:p}),!u&&o.length>0&&(()=>{const e=new Map,t=new Map;o.forEach((s=>{if(s.branch&&!e.has(s.branch.id)&&e.set(s.branch.id,{id:s.branch.id,name:s.branch.name,color:Ce(s.branch.id)}),!t.has(s.status)){const e={scheduled:a("teamWorktime.shifts.status.scheduled"),confirmed:a("teamWorktime.shifts.status.confirmed"),cancelled:a("teamWorktime.shifts.status.cancelled"),swapped:a("teamWorktime.shifts.status.swapped")};t.set(s.status,{status:s.status,label:e[s.status]||s.status,color:De(s.status)})}}));const s=Array.from(e.values()),r=Array.from(t.values());return 0===s.length&&0===r.length?null:(0,T.jsx)("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,T.jsxs)("div",{className:"flex flex-wrap gap-6",children:[s.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:a("teamWorktime.shifts.legend.branches")}),(0,T.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color}}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.name})]},e.id)))})]}),r.length>0&&(0,T.jsxs)("div",{children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:a("teamWorktime.shifts.legend.statuses")}),(0,T.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e=>(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-4 h-4 rounded border-2",style:{backgroundColor:"transparent",borderColor:e.color}}),(0,T.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.label})]},e.status)))})]})]})})})(),u?(0,T.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,T.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:a("teamWorktime.shifts.messages.loading")})}):(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:[(0,T.jsx)("div",{className:"flex justify-end mb-4",children:(0,T.jsxs)("div",{className:"inline-flex rounded-md shadow-sm gap-1",role:"group",children:[(0,T.jsx)("button",{onClick:()=>{var e;j("timeGridWeek"),null===(e=w.current)||void 0===e||e.getApi().changeView("timeGridWeek")},className:"p-2 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat("timeGridWeek"===k?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"),title:a("common.week","Woche"),children:(0,T.jsx)(ie.A,{className:"h-5 w-5"})}),(0,T.jsx)("button",{onClick:()=>{var e;j("dayGridMonth"),null===(e=w.current)||void 0===e||e.getApi().changeView("dayGridMonth")},className:"p-2 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat("dayGridMonth"===k?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"),title:a("common.month","Monat"),children:(0,T.jsx)(h.A,{className:"h-5 w-5"})})]})}),A&&(0,T.jsx)("div",{className:"mb-4 px-3 sm:px-4 md:px-6",children:(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a("teamWorktime.shifts.filters.title")}),(0,T.jsx)("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,T.jsx)(S.A,{className:"h-5 w-5"})})]}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.branch")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:z.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:t=>{t.target.checked?E([...D,e.id]):E(D.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.role")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:O.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:I.includes(e.id),onChange:t=>{t.target.checked?L([...I,e.id]):L(I.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.status")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:Te.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:F.includes(e.value),onChange:t=>{t.target.checked?M([...F,e.value]):M(F.filter((t=>t!==e.value)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.label})]},e.value)))})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("teamWorktime.shifts.filters.user")}),(0,T.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700",children:G.map((e=>(0,T.jsxs)("label",{className:"flex items-center space-x-2 py-1",children:[(0,T.jsx)("input",{type:"checkbox",checked:q.includes(e.id),onChange:t=>{t.target.checked?P([...q,e.id]):P(q.filter((t=>t!==e.id)))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,T.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.firstName," ",e.lastName]})]},e.id)))})]})]}),(0,T.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,T.jsx)("button",{onClick:()=>{E([]),L([]),M([]),P([])},className:"px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:a("teamWorktime.shifts.filters.reset")}),(0,T.jsx)("button",{onClick:()=>C(!1),className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:a("common.apply")})]})]})}),(0,T.jsx)("div",{className:"fullcalendar-container",children:(0,T.jsx)(me.A,{ref:w,plugins:[xe.A,ue.A,ge.Ay],initialView:k,initialDate:f,headerToolbar:{left:"prev,next today",center:"title",right:""},locale:"de",firstDay:1,weekNumbers:!0,weekNumberCalculation:"ISO",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",slotDuration:"01:00:00",slotLabelInterval:"01:00:00",allDaySlot:!1,height:"auto",events:we,eventClick:e=>{const t=e.event.extendedProps.shift;console.log("Shift clicked:",t),se(t),Y(!0)},dateClick:e=>{console.log("Date clicked:",e.date),be(e.date),V(!0)},datesSet:e=>{var t;const a=null===(t=w.current)||void 0===t?void 0:t.getApi().view.type;if(a&&a!==k&&j(a),"timeGridWeek"===a&&!N.current){const t=(0,le.k)(e.start,{weekStartsOn:1}),a=(0,le.k)(f,{weekStartsOn:1});t.getTime()!==a.getTime()&&v(e.start)}N.current=!1},eventDisplay:"block",eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClassNames:"cursor-pointer",eventContent:e=>{var t;const s=e.event.extendedProps.shift;return(0,T.jsxs)("div",{className:"p-1 text-xs",children:[(0,T.jsx)("div",{className:"font-semibold truncate",children:(null===(t=s.shiftTemplate)||void 0===t?void 0:t.name)||"Schicht"}),s.user&&(0,T.jsxs)("div",{className:"truncate text-gray-600 dark:text-gray-300",children:[s.user.firstName," ",s.user.lastName]}),!s.user&&(0,T.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:a("teamWorktime.shifts.legend.unassigned")})]})}})}),(0,T.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4 text-sm",children:[(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.scheduled")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.confirmed")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.cancelled")})]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("div",{className:"w-4 h-4 bg-orange-500 rounded mr-2"}),(0,T.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a("teamWorktime.shifts.legend.swapped")})]})]})]}),(0,T.jsx)(pe,{isOpen:_,onClose:()=>{V(!1),be(void 0)},onShiftCreated:e=>{c((t=>[...t,e])),ye(f)},initialDate:he}),ae&&(0,T.jsx)(fe,{isOpen:U,onClose:()=>{Y(!1),se(null)},onShiftUpdated:e=>{c((t=>t.map((t=>t.id===e.id?e:t)))),ye(f)},onShiftDeleted:e=>{c((t=>t.filter((t=>t.id!==e)))),ye(f)},shift:ae}),(0,T.jsx)(je,{isOpen:K,onClose:()=>Z(!1),onPlanGenerated:()=>{ye(f)},initialStartDate:(0,le.k)(f,{weekStartsOn:1}),initialEndDate:(0,de.$)(f,{weekStartsOn:1})}),(0,T.jsx)(Ne,{isOpen:Q,onClose:()=>$(!1),onSwapRequestUpdated:()=>{ye(f)}}),(0,T.jsx)(Se,{isOpen:J,onClose:()=>X(!1)}),(0,T.jsx)(We,{isOpen:ee,onClose:()=>te(!1)})]})},Ie=()=>{const{t:e}=(0,r.Bd)(),{hasPermission:t}=(0,q.S)(),a=t("team_worktime_control","read","page"),o=t("team_worktime","read","table"),c=a&&o,[m,x]=(0,s.useState)([]),[u,g]=(0,s.useState)([]),[h,p]=(0,s.useState)((0,n.GP)(new Date,"yyyy-MM-dd")),[b,y]=(0,s.useState)("worktimes"),[f,v]=(0,s.useState)(!1),[k,j]=(0,s.useState)(null),w=(0,s.useCallback)((async()=>{try{v(!0),j(null);const e=await l.A.get(d.Sn.TEAM_WORKTIME.ACTIVE);x(e.data)}catch(k){var t,a,s;console.error("Fehler beim Laden der aktiven Benutzer:",k);let l=e("teamWorktime.messages.loadActiveUsersError");if(k.response){var r;const t=k.response.status,a=null===(r=k.response.data)||void 0===r?void 0:r.message;403===t?l=a||e("teamWorktime.permissions.insufficientShort"):401===t?l=e("teamWorktime.messages.unauthorized",{defaultValue:"Nicht autorisiert"}):500===t?l=e("teamWorktime.messages.serverError",{defaultValue:"Serverfehler"}):a&&(l=a)}else k.message&&(l=k.message);j(l),console.error("Fehlerdetails:",{status:null===(t=k.response)||void 0===t?void 0:t.status,statusText:null===(a=k.response)||void 0===a?void 0:a.statusText,data:null===(s=k.response)||void 0===s?void 0:s.data,message:k.message})}finally{v(!1)}}),[e]),N=(0,s.useCallback)((async()=>{try{v(!0),j(null);const e=await l.A.get("".concat(d.Sn.TEAM_WORKTIME.USER_DAY,"?date=").concat(h));g(e.data)}catch(k){console.error("Fehler beim Laden der Zeiterfassungen:",k),j(e("teamWorktime.messages.loadWorktimesError"))}finally{v(!1)}}),[h,e]);return(0,s.useEffect)((()=>{if(!c)return void j(e("teamWorktime.permissions.insufficientDetails"));w(),N();const t=setInterval(w,3e4);return()=>clearInterval(t)}),[w,N,c]),(0,s.useEffect)((()=>{N()}),[h,N]),(0,T.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,T.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,T.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,T.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,T.jsxs)("div",{className:"flex items-center pl-2 sm:pl-0",children:[(0,T.jsx)(i.A,{className:"h-6 w-6 text-gray-900 dark:text-white mr-2"}),(0,T.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:e("teamWorktime.title")})]})}),!c&&(0,T.jsxs)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:[(0,T.jsx)("p",{className:"font-medium mb-2",children:e("teamWorktime.permissions.insufficient")}),(0,T.jsxs)("ul",{className:"list-disc list-inside text-sm space-y-1",children:[!a&&(0,T.jsx)("li",{children:e("teamWorktime.permissions.missingPage")}),!o&&(0,T.jsx)("li",{children:e("teamWorktime.permissions.missingTable")})]}),(0,T.jsx)("p",{className:"text-sm mt-2",children:e("teamWorktime.permissions.contactAdmin")})]}),k&&(0,T.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 px-4 py-3 rounded mb-4",children:k}),(0,T.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,T.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,T.jsx)("button",{onClick:()=>y("worktimes"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("worktimes"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.worktimes")}),(0,T.jsx)("button",{onClick:()=>y("shifts"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("shifts"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.shifts")}),(0,T.jsx)("button",{onClick:()=>y("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("todos"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.todos")}),(0,T.jsx)("button",{onClick:()=>y("requests"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 ".concat("requests"===b?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:e("teamWorktime.tabs.requests")})]})}),"worktimes"===b&&(0,T.jsx)(U,{activeUsers:m,allWorktimes:u,loading:f,selectedDate:h,onDateChange:p,onStopWorktime:async(t,a)=>{try{v(!0),j(null),await l.A.post(d.Sn.TEAM_WORKTIME.STOP_USER,{userId:t,endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())}),w()}catch(k){console.error("Fehler beim Stoppen der Benutzer-Zeiterfassung:",k),j(e("teamWorktime.messages.stopWorktimeError"))}finally{v(!1)}},onRefresh:w,showTodos:!0,showRequests:!0}),"shifts"===b&&(0,T.jsx)(Ee,{selectedDate:h}),"todos"===b&&(0,T.jsx)(X,{selectedDate:h}),"requests"===b&&(0,T.jsx)(se,{selectedDate:h})]})})})}}}]);
//# sourceMappingURL=256.415caf8d.chunk.js.map