"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[541],{1541:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ve});var a=r(9379),s=r(5043),n=r(4117),o=r(3216),l=r(2672),i=r(2760),d=r(2023),c=r(8897),u=r(5442),m=r(6287),x=r(8662),g=r(4538),h=r(7988),p=r(4468),b=r(1816),y=r(4850),v=r(1663),f=r(8010),k=r(4791),N=r(1909),j=r(1369),w=r(1252),S=r(2811),C=r(3744),A=r(9248),T=r(6238),E=r(4129),D=r(5501),P=r(8682),I=r(9850),L=r(9670),R=r(2683),O=r(7012),F=r(6693),B=r(7438),z=r(1923),M=r(6443),q=r(7591),_=r(9422),U=r(1801),W=r(579);const V=e=>{let{onArticleSelected:t,excludeArticleIds:r=[],selectedArticles:a,onArticleRemove:n}=e;const[o,l]=(0,s.useState)([]),[i,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{try{x(!0),h(null);const e=(await z.A.get(U.Sn.CEREBRO.ARTICLES.BASE)).data.filter((e=>!r.includes(e.id)));l(e)}catch(a){var e,t;console.error("Fehler beim Abrufen der Artikel:",a);const r=a;h((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{x(!1)}})()}),[r]);return(0,W.jsxs)("div",{className:"mt-4",children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cerebro-Artikel verkn\xfcpfen"}),(0,W.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,W.jsxs)("div",{className:"flex items-center gap-2",children:[(0,W.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:i||"",onChange:e=>{const t=parseInt(e.target.value,10);if(isNaN(t))d(null),u(null);else{d(t);o.find((e=>e.id===t))&&(async e=>{try{x(!0);const t=await z.A.get(U.Sn.CEREBRO.ARTICLES.BY_ID(e));u(t.data)}catch(t){console.error("Fehler beim Abrufen der Artikeldetails:",t)}finally{x(!1)}})(t)}},children:[(0,W.jsx)("option",{value:"",children:"-- Artikel ausw\xe4hlen --"}),o.map((e=>(0,W.jsx)("option",{value:e.id,children:e.title},e.id)))]}),(0,W.jsx)("button",{type:"button",onClick:()=>{if(null!==i){const e=o.find((e=>e.id===i));e&&(t(e),d(null),u(null))}},disabled:null===i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Verkn\xfcpfen"})]}),m&&(0,W.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Artikel..."}),g&&(0,W.jsx)("div",{className:"text-sm text-red-600",children:g}),c&&(0,W.jsxs)("div",{className:"mt-2 p-4 border border-gray-300 rounded-md bg-gray-50",children:[(0,W.jsx)("h4",{className:"font-medium text-lg mb-2",children:c.title}),(0,W.jsx)("div",{className:"prose prose-sm max-w-none",children:c.content?(0,W.jsxs)("div",{className:"text-sm text-gray-700 max-h-40 overflow-y-auto",children:[c.content.substring(0,300),c.content.length>300&&"..."]}):(0,W.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Kein Inhalt verf\xfcgbar"})}),(0,W.jsx)("div",{className:"mt-2",children:(0,W.jsx)("a",{href:"/cerebro/articles/".concat(c.slug),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"Artikel \xf6ffnen"})})]})]})]})};var G=r(5657);const K=e=>{let{error:t,title:r,setTitle:a,description:o,setDescription:l,assigneeType:i,setAssigneeType:d,responsibleId:c,setResponsibleId:u,roleId:m,setRoleId:x,qualityControlId:g,setQualityControlId:h,branchId:p,setBranchId:y,dueDate:v,setDueDate:f,users:k,roles:N,branches:j,loading:w,handleSubmit:S,handleClose:C,selectedArticles:A,onArticleSelect:T,onArticleRemove:E,uploading:D=!1,temporaryAttachments:P=[],onFileUpload:I,onRemoveAttachment:L,textareaRef:R,fileInputRef:O,handlePaste:F,handleDrop:B,handleDragOver:z}=e;const{t:M}=(0,n.Bd)(),[U,G]=(0,s.useState)("data");return(0,W.jsxs)("form",{onSubmit:S,className:"space-y-4",noValidate:!0,children:[t&&(0,W.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 dark:border-red-700 text-red-700 dark:text-red-300 p-4 mb-4",children:(0,W.jsx)("p",{children:t})}),(0,W.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,W.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,W.jsx)("button",{type:"button",className:"".concat("data"===U?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>G("data"),children:"Daten"}),(0,W.jsx)("button",{type:"button",className:"".concat("cerebro"===U?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>G("cerebro"),children:"Cerebro Artikel"})]})}),"data"===U&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[M("tasks.createTask.form.title")," *"]}),(0,W.jsx)("input",{type:"text",id:"title",value:r,onChange:e=>a(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsx)("div",{className:"space-y-4",children:(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"description_sidepane",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:M("tasks.createTask.form.description")}),(0,W.jsxs)("div",{className:"relative",children:[(0,W.jsx)("textarea",{ref:R,id:"description_task_create",rows:6,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",value:o,onChange:e=>l(e.target.value),onPaste:F,onDrop:B,onDragOver:z,placeholder:M("tasks.createTask.form.descriptionPlaceholder")}),(0,W.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,W.jsx)("button",{type:"button",onClick:()=>{var e;return null===O||void 0===O||null===(e=O.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:M("tasks.createTask.form.fileUpload")})]}),(0,W.jsx)("input",{ref:O,type:"file",onChange:I,className:"hidden"}),D&&(0,W.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,W.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:M("tasks.createTask.form.uploading")})})]}),P&&P.length>0&&(0,W.jsx)("div",{className:"mt-2",children:(0,W.jsx)("ul",{className:"flex flex-wrap gap-2",children:P.map(((e,t)=>(0,W.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,W.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,W.jsx)("div",{className:"flex ml-2",children:(0,W.jsxs)("div",{className:"relative group ml-1",children:[(0,W.jsx)("button",{type:"button",onClick:()=>null===L||void 0===L?void 0:L(t),className:"text-red-600 hover:text-red-900",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:M("tasks.createTask.form.remove")})]})}),e.fileType.startsWith("image/")&&e.file&&(0,W.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-700 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,W.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},t)))})})]})}),(0,W.jsxs)("div",{className:"space-y-2",children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[M("tasks.createTask.form.responsibleFor")," *"]}),(0,W.jsxs)("div",{className:"flex space-x-4",children:[(0,W.jsxs)("label",{className:"inline-flex items-center",children:[(0,W.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===i,onChange:()=>{d("user"),x("")}}),(0,W.jsx)("span",{className:"ml-2 dark:text-gray-300",children:M("tasks.createTask.form.user")})]}),(0,W.jsxs)("label",{className:"inline-flex items-center",children:[(0,W.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===i,onChange:()=>{d("role"),u("")}}),(0,W.jsx)("span",{className:"ml-2 dark:text-gray-300",children:M("tasks.createTask.form.role")})]})]})]}),"user"===i?(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[M("tasks.createTask.form.responsibleUser")," *"]}),(0,W.jsxs)("select",{id:"responsible",value:c,onChange:e=>u(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,W.jsx)("option",{value:"",children:M("tasks.createTask.form.pleaseSelect")}),Array.isArray(k)&&k.map((e=>(0,W.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[M("tasks.createTask.form.responsibleRole")," *"]}),(0,W.jsxs)("select",{id:"role",value:m,onChange:e=>x(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,W.jsx)("option",{value:"",children:M("tasks.createTask.form.pleaseSelect")}),Array.isArray(N)&&N.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:M("tasks.createTask.form.qualityControl")}),(0,W.jsxs)("select",{id:"qualityControl",value:g,onChange:e=>h(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:M("tasks.createTask.form.noQualityControl")}),Array.isArray(k)&&k.map((e=>(0,W.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[M("tasks.createTask.form.branch")," *"]}),(0,W.jsxs)("select",{id:"branch",value:p,onChange:e=>y(Number(e.target.value)),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,W.jsx)("option",{value:"",children:M("common.pleaseSelect")}),Array.isArray(j)&&j.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:M("tasks.createTask.form.dueDate")}),(0,W.jsx)("input",{type:"date",id:"dueDate",value:v,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===U&&(0,W.jsxs)("div",{children:[(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Verkn\xfcpfte Cerebro-Artikel"}),A.length>0?(0,W.jsx)("ul",{className:"mt-2 space-y-2",children:A.map((e=>(0,W.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,W.jsx)("span",{className:"dark:text-gray-300",children:e.title}),(0,W.jsx)("button",{type:"button",onClick:()=>E(e.id),className:"text-red-600 hover:text-red-800",children:M("tasks.createTask.form.remove")})]},e.id)))}):(0,W.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:M("tasks.createTask.form.noArticlesLinked")})]}),(0,W.jsx)(V,{onArticleSelected:T,excludeArticleIds:A.map((e=>e.id)),selectedArticles:A,onArticleRemove:E})]}),(0,W.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{type:"button",onClick:C,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,W.jsx)(q.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:M("tasks.createTask.form.cancel")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:w,children:w?(0,W.jsx)(b.A,{className:"h-5 w-5 animate-spin"}):(0,W.jsx)(_.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:M(w?"tasks.createTask.form.creating":"tasks.createTask.form.create")})]})]})]})},H=e=>{let{isOpen:t,onClose:r,onTaskCreated:a}=e;const{t:o}=(0,n.Bd)(),{user:i}=(0,l.As)(),{openSidepane:d,closeSidepane:c}=(0,G.N)(),[u,m]=(0,s.useState)(window.innerWidth>1070),[x,g]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[b,y]=(0,s.useState)("user"),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(""),[j,w]=(0,s.useState)(""),[S,C]=(0,s.useState)(""),[A,T]=(0,s.useState)(""),[E,D]=(0,s.useState)([]),[P,I]=(0,s.useState)([]),[L,R]=(0,s.useState)([]),[O,F]=(0,s.useState)(null),[B,_]=(0,s.useState)(!1),[V,H]=(0,s.useState)(window.innerWidth<640),[Z,Y]=(0,s.useState)([]),[Q,$]=(0,s.useState)("data"),[X,J]=(0,s.useState)([]),[ee,te]=(0,s.useState)(!1),re=(0,s.useRef)(null),ae=(0,s.useRef)(null);(0,s.useEffect)((()=>{t&&(se(),ne(),oe(),i&&w(i.id),T((()=>{const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]})()))}),[t,i]),(0,s.useEffect)((()=>{L.length>0&&""===S&&(1===L.length||L.length>1)&&C(L[0].id)}),[L,S]),(0,s.useEffect)((()=>{const e=()=>{H(window.innerWidth<640),m(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]);const se=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");console.log("Lade Benutzer f\xfcr CreateTaskModal...");const e=await z.A.get(U.Sn.USERS.DROPDOWN);console.log("Benutzer geladen:",e.data.length),D(e.data||[])}catch(r){console.error("Fehler beim Laden der Benutzer:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadUsersError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},ne=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");const e=await z.A.get(U.Sn.ROLES.BASE);I(e.data||[])}catch(r){console.error("Fehler beim Laden der Rollen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadRolesError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},oe=async()=>{try{F(null);if(!localStorage.getItem("token"))return void F("Nicht authentifiziert");console.log("Lade Niederlassungen f\xfcr CreateTaskModal...");const e=await z.A.get(U.Sn.BRANCHES.BASE);console.log("Niederlassungen geladen:",e.data.length),R(e.data||[])}catch(r){console.error("Fehler beim Laden der Niederlassungen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)F(o("tasks.createTask.errors.connectionError"));else F("".concat(o("tasks.createTask.errors.loadBranchesError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},le=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const a=t[r];if(0===a.type.indexOf("image")){e.preventDefault();const t=a.getAsFile();return void(t&&await ce(t))}}},ie=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await ce(t)}},de=e=>{e.preventDefault(),e.stopPropagation()},ce=async e=>{te(!0),F(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};J((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?"\n![".concat(e.name,"](").concat(o("tasks.createTask.form.uploadAfterCreate"),")\n"):"\n[".concat(e.name,"](").concat(o("tasks.createTask.form.uploadAfterCreate"),")\n"),ae.current){const e=ae.current.selectionStart,t=h.substring(0,e),a=h.substring(e);p(t+r+a),setTimeout((()=>{if(ae.current){const t=e+r.length;ae.current.selectionStart=t,ae.current.selectionEnd=t,ae.current.focus()}}),0)}else p(h+r)}catch(a){var t,r;console.error("Fehler beim Verarbeiten der Datei:",a);const e=a;F((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{te(!1)}},ue=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await ce(r),re.current&&(re.current.value="")},me=e=>{const t=X[e];if(t&&(J(X.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=o("tasks.createTask.form.uploadAfterCreate"),a=new RegExp("!\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=h.replace(a,"").replace(s,"").replace(/\n{3,}/g,"\n\n");p(n)}},xe=async e=>{e.preventDefault(),F(null),_(!0);try{if(!x||!v&&!k||!S)return F(o("tasks.createTask.errors.fillAllFields")),void _(!1);if(v&&k)return F(o("tasks.createTask.errors.chooseUserOrRole")),void _(!1);if(!localStorage.getItem("token"))return F("Nicht authentifiziert"),void _(!1);const e=Number(S),t=j?Number(j):null,r=v?Number(v):null,s=k?Number(k):null;if(v&&isNaN(r)||k&&isNaN(s)||isNaN(e)||j&&isNaN(t))return F(o("tasks.createTask.errors.invalidIds")),void _(!1);const n={title:x,description:h,status:"open",qualityControlId:t,branchId:e,dueDate:A};"user"===b&&v?n.responsibleId=v:"role"===b&&k&&(n.roleId=k);const l=await z.A.post(U.Sn.TASKS.BASE,n),i=l.data.id;Z.length>0&&await Promise.all(Z.map((e=>z.A.post(U.Sn.TASKS.LINK_CARTICLE(i,e.id))))),await(async e=>{if(0!==X.length)try{_(!0);for(const t of X){if(!t.file)continue;const r=new FormData;r.append("file",t.file),await z.A.post(U.Sn.TASKS.ATTACHMENTS(e),r,{headers:{"Content-Type":"multipart/form-data"}})}console.log("".concat(X.length," Anh\xe4nge erfolgreich hochgeladen."))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{_(!1)}})(i),console.log("Task erfolgreich erstellt:",l.data),a(l.data),ge()}catch(s){var t,r;console.error("Fehler beim Erstellen des Tasks:",s);const e=s;F((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.error)||e.message||o("tasks.createTask.errors.createError"))}finally{_(!1)}},ge=()=>{g(""),p(""),y("user"),f(""),N(""),w(""),C(""),T(""),F(null),Y([]),J([]),r()},he=e=>{Y((t=>[...t,e]))},pe=e=>{Y((t=>t.filter((t=>t.id!==e))))};return V?(0,W.jsxs)(M.lG,{open:t,onClose:ge,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,W.jsx)(M.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("tasks.createTask.title")}),(0,W.jsx)("button",{onClick:ge,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)(K,{error:O,title:x,setTitle:g,description:h,setDescription:p,assigneeType:b,setAssigneeType:y,responsibleId:v,setResponsibleId:f,roleId:k,setRoleId:N,qualityControlId:j,setQualityControlId:w,branchId:S,setBranchId:C,dueDate:A,setDueDate:T,users:E,roles:P,branches:L,loading:B,handleSubmit:xe,handleClose:ge,selectedArticles:Z,onArticleSelect:he,onArticleRemove:pe,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:ae,fileInputRef:re,handlePaste:le,handleDrop:ie,handleDragOver:de})]})})]}):(0,W.jsxs)(W.Fragment,{children:[t&&!u&&(0,W.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,W.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("tasks.createTask.title")}),(0,W.jsx)("button",{onClick:ge,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,W.jsx)(K,{error:O,title:x,setTitle:g,description:h,setDescription:p,assigneeType:b,setAssigneeType:y,responsibleId:v,setResponsibleId:f,roleId:k,setRoleId:N,qualityControlId:j,setQualityControlId:w,branchId:S,setBranchId:C,dueDate:A,setDueDate:T,users:E,roles:P,branches:L,loading:B,handleSubmit:xe,handleClose:ge,selectedArticles:Z,onArticleSelect:he,onArticleRemove:pe,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:ae,fileInputRef:re,handlePaste:le,handleDrop:ie,handleDragOver:de})})]})]})};var Z=r(5377),Y=r(7855);const Q=e=>{var t,r,a,s,o;let{task:l}=e;const{t:i}=(0,n.Bd)(),{showMessage:d}=(0,Y.A)(),c=(null===(t=l.title)||void 0===t?void 0:t.includes("ARL"))||(null===(r=l.title)||void 0===r?void 0:r.includes("EPS"))||(null===(a=l.title)||void 0===a?void 0:a.includes("Pension"))||(null===(s=l.title)||void 0===s?void 0:s.includes("Caja"))||(null===(o=l.description)||void 0===o?void 0:o.includes("lifecycle"));let u={};if(l.description)try{const e=l.description.match(/\{[\s\S]*\}/);e&&(u=JSON.parse(e[0]))}catch(m){l.description.split("\n").forEach((e=>{const t=e.match(/([^:]+):\s*(.+)/);if(t){const e=t[1].trim(),r=t[2].trim();u[e]=r}}))}0===Object.keys(u).length&&c&&(u={taskType:l.title,description:l.description||i("lifecycle.noDataAvailable")});return c||0!==Object.keys(u).length?(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,W.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,W.jsx)(Z.A,{className:"h-5 w-5 mr-2"}),i("lifecycle.autoGeneratedData",{defaultValue:"Automatisch generierte Daten"})]}),(0,W.jsx)("button",{onClick:async()=>{try{const e=JSON.stringify(u,null,2);await navigator.clipboard.writeText(e),d(i("lifecycle.dataCopied",{defaultValue:"Daten in Zwischenablage kopiert"}),"success")}catch(e){console.error("Fehler beim Kopieren:",e),d(i("lifecycle.copyError",{defaultValue:"Fehler beim Kopieren"}),"error")}},className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:i("lifecycle.copyData",{defaultValue:"Daten kopieren"})})]}),(0,W.jsx)("div",{className:"space-y-2",children:Object.keys(u).length>0?Object.entries(u).map((e=>{let[t,r]=e;return(0,W.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[(0,W.jsxs)("span",{className:"font-medium w-full sm:w-1/3 dark:text-gray-300",children:[i("lifecycle.".concat(t))||t,":"]}),(0,W.jsx)("span",{className:"text-gray-600 dark:text-gray-400 flex-1 break-words",children:"object"===typeof r?JSON.stringify(r,null,2):String(r)})]},t)})):(0,W.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:i("lifecycle.noDataAvailable",{defaultValue:"Keine automatisch generierten Daten verf\xfcgbar"})})})]}):null},$=e=>{var t,r,a,o,l;let{task:i}=e;const{t:d}=(0,n.Bd)(),{showMessage:c}=(0,Y.A)(),[u,m]=(0,s.useState)(""),[x,g]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1);if(!((null===(t=i.title)||void 0===t?void 0:t.includes("ARL"))||(null===(r=i.title)||void 0===r?void 0:r.includes("EPS"))||(null===(a=i.title)||void 0===a?void 0:a.includes("Pension"))||(null===(o=i.title)||void 0===o?void 0:o.includes("Caja"))||(null===(l=i.description)||void 0===l?void 0:l.includes("lifecycle"))))return null;return(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,W.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,W.jsx)(P.A,{className:"h-5 w-5 mr-2"}),d("lifecycle.emailTemplate",{defaultValue:"Email-Vorlage"})]}),(0,W.jsx)("button",{onClick:async()=>{v(!0);try{const e="Sehr geehrte Damen und Herren,\n\nim Rahmen des Onboarding-Prozesses ben\xf6tigen wir die Anmeldung f\xfcr ".concat(i.title,".\n\nBitte senden Sie uns die erforderlichen Informationen zur\xfcck.\n\nMit freundlichen Gr\xfc\xdfen\nIhr Team");m(e),c(d("lifecycle.templateGenerated",{defaultValue:"Email-Vorlage generiert"}),"success")}catch(r){var e,t;console.error("Fehler beim Generieren der Email-Vorlage:",r),c((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("lifecycle.templateGenerationError",{defaultValue:"Fehler beim Generieren der Vorlage"}),"error")}finally{v(!1)}},disabled:y,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center text-sm",children:y?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),d("common.generating",{defaultValue:"Generiere..."})]}):d("lifecycle.generateTemplate",{defaultValue:"Vorlage generieren"})})]}),u&&(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("textarea",{value:u,onChange:e=>{m(e.target.value),p(!1)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:10,placeholder:d("lifecycle.templatePlaceholder",{defaultValue:"Email-Vorlage wird hier angezeigt..."})}),(0,W.jsx)("div",{className:"flex justify-end",children:(0,W.jsx)("button",{onClick:async()=>{if(u.trim()){g(!0);try{await new Promise((e=>setTimeout(e,1e3))),p(!0),c(d("lifecycle.emailSent",{defaultValue:"Email erfolgreich versendet"}),"success")}catch(r){var e,t;console.error("Fehler beim Versenden der Email:",r),c((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("lifecycle.emailSendError",{defaultValue:"Fehler beim Versenden der Email"}),"error")}finally{g(!1)}}else c(d("lifecycle.templateRequired",{defaultValue:"Bitte generieren Sie zuerst eine Vorlage"}),"warning")},disabled:x||h,className:"p-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",title:x?d("common.sending",{defaultValue:"Sende..."}):h?d("lifecycle.emailSent",{defaultValue:"Versendet"}):d("lifecycle.sendEmail",{defaultValue:"Email versenden"}),children:x?(0,W.jsx)(b.A,{className:"h-5 w-5 animate-spin"}):h?(0,W.jsx)(_.A,{className:"h-5 w-5"}):(0,W.jsx)(B.A,{className:"h-5 w-5"})})})]}),!u&&(0,W.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-sm text-center py-4",children:d("lifecycle.noTemplate",{defaultValue:'Klicken Sie auf "Vorlage generieren" um eine Email-Vorlage zu erstellen'})})]})},X=e=>{var t,r,o,l,i;let{task:d,onComplete:c}=e;const{t:u}=(0,n.Bd)(),{showMessage:m}=(0,Y.A)(),[x,g]=(0,s.useState)({registrationNumber:"",provider:"",registrationDate:"",notes:""}),[h,p]=(0,s.useState)(!1);if(!((null===(t=d.title)||void 0===t?void 0:t.includes("ARL"))||(null===(r=d.title)||void 0===r?void 0:r.includes("EPS"))||(null===(o=d.title)||void 0===o?void 0:o.includes("Pension"))||(null===(l=d.title)||void 0===l?void 0:l.includes("Caja"))||(null===(i=d.description)||void 0===i?void 0:i.includes("lifecycle"))))return null;const y=(()=>{var e,t,r,a;return null!==(e=d.title)&&void 0!==e&&e.includes("ARL")?"arl":null!==(t=d.title)&&void 0!==t&&t.includes("EPS")?"eps":null!==(r=d.title)&&void 0!==r&&r.includes("Pension")?"pension":null!==(a=d.title)&&void 0!==a&&a.includes("Caja")?"caja":null})();return(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-4",children:[(0,W.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:u("lifecycle.completeRegistration",{defaultValue:"Anmeldung abschlie\xdfen"})}),(0,W.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(!0);try{const e=(()=>{if(d.description){const e=d.description.match(/userId[:\s]+(\d+)/i);if(e)return parseInt(e[1],10)}return d.responsibleId})();if(!e||!y)return void m(u("lifecycle.missingData",{defaultValue:"Benutzer-ID oder Sozialversicherungs-Typ fehlt"}),"error");await z.A.put(U.Sn.LIFECYCLE.SOCIAL_SECURITY(e,y),{status:"registered",registrationNumber:x.registrationNumber,provider:x.provider,registrationDate:x.registrationDate,notes:x.notes,completedAt:(new Date).toISOString()}),m(u("lifecycle.registrationCompleted",{defaultValue:"Anmeldung erfolgreich abgeschlossen"}),"success"),g({registrationNumber:"",provider:"",registrationDate:"",notes:""}),c&&c()}catch(a){var t,r;console.error("Fehler beim Abschlie\xdfen der Anmeldung:",a),m((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||u("lifecycle.registrationError",{defaultValue:"Fehler beim Abschlie\xdfen der Anmeldung"}),"error")}finally{p(!1)}},className:"space-y-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.registrationNumber",{defaultValue:"Registrierungsnummer"})," *"]}),(0,W.jsx)("input",{type:"text",value:x.registrationNumber,onChange:e=>g((0,a.A)((0,a.A)({},x),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,placeholder:u("lifecycle.registrationNumberPlaceholder",{defaultValue:"z.B. 123456789"})})]}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.provider",{defaultValue:"Anbieter"})," *"]}),(0,W.jsx)("input",{type:"text",value:x.provider,onChange:e=>g((0,a.A)((0,a.A)({},x),{},{provider:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,placeholder:u("lifecycle.providerPlaceholder",{defaultValue:"z.B. ARL Sura, EPS Sanitas"})})]}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[u("lifecycle.registrationDate",{defaultValue:"Anmeldedatum"})," *"]}),(0,W.jsx)("input",{type:"date",value:x.registrationDate,onChange:e=>g((0,a.A)((0,a.A)({},x),{},{registrationDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u("lifecycle.notes",{defaultValue:"Notizen"})}),(0,W.jsx)("textarea",{value:x.notes,onChange:e=>g((0,a.A)((0,a.A)({},x),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:u("lifecycle.notesPlaceholder",{defaultValue:"Zus\xe4tzliche Informationen..."})})]}),(0,W.jsx)("div",{className:"flex justify-end",children:(0,W.jsx)("button",{type:"submit",disabled:h,className:"p-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",title:h?u("common.saving",{defaultValue:"Speichere..."}):u("lifecycle.complete",{defaultValue:"Abschlie\xdfen"}),children:h?(0,W.jsx)(b.A,{className:"h-5 w-5 animate-spin"}):(0,W.jsx)(_.A,{className:"h-5 w-5"})})})]})]})},J=e=>{var t,r;let{isOpen:a,onClose:o,onTaskUpdated:d,task:c}=e;const{t:u}=(0,n.Bd)(),{hasPermission:m}=(0,i.S)(),{user:x}=(0,l.As)(),{openSidepane:g,closeSidepane:h}=(0,G.N)(),[p,y]=(0,s.useState)(window.innerWidth>1070),[v,f]=(0,s.useState)(c.title||""),[k,N]=(0,s.useState)((j=c.description||"")?j.replace(/!\[([^\]]*)\]\([^)]+\)/g,"").trim():"");var j;const w=c.description||"",[S,C]=(0,s.useState)(c.status||"open"),[T,E]=(0,s.useState)(c.roleId?"role":"user"),[D,P]=(0,s.useState)(c.responsibleId||null),[I,L]=(0,s.useState)(c.roleId||null),[R,O]=(0,s.useState)((null===(t=c.qualityControl)||void 0===t?void 0:t.id)||null),[F,B]=(0,s.useState)((null===(r=c.branch)||void 0===r?void 0:r.id)||0),[K,H]=(0,s.useState)(c.attachments||[]),[Z,Y]=(0,s.useState)([]),[J,ee]=(0,s.useState)(!1),[te,re]=(0,s.useState)([]),ae=(0,s.useRef)(null),se=(0,s.useRef)(null),[ne,oe]=(0,s.useState)((e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]})(c.dueDate)),[le,ie]=(0,s.useState)([]),[de,ce]=(0,s.useState)([]),[ue,me]=(0,s.useState)([]),[xe,ge]=(0,s.useState)(null),[he,pe]=(0,s.useState)(!1),[be,ye]=(0,s.useState)(!1),[ve,fe]=(0,s.useState)(window.innerWidth<640),[ke,Ne]=(0,s.useState)([]),[je,we]=(0,s.useState)("data"),Se=m("tasks","both","table");(0,s.useEffect)((()=>{const e=()=>{fe(window.innerWidth<640),y(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,s.useEffect)((()=>{if(!a&&te.length>0){(async()=>{for(const t of te)try{await z.A.delete(U.Sn.TASKS.ATTACHMENT(c.id,t)),console.log("Task Attachment ".concat(t," gel\xf6scht (Modal ohne Speichern geschlossen)"))}catch(e){console.error("Fehler beim L\xf6schen von Task Attachment ".concat(t,":"),e)}re([])})()}}),[a,te,c.id]),(0,s.useEffect)((()=>(a?g():h(),()=>{h()})),[a,g,h]),(0,s.useEffect)((()=>{a&&(Ce(),Ae(),Te(),Ee(),De())}),[a,c.id]);const Ce=async()=>{try{ge(null);if(!localStorage.getItem("token"))return void ge("Nicht authentifiziert");const e=await z.A.get(U.Sn.USERS.DROPDOWN);ie(e.data||[])}catch(r){console.error("Fehler beim Laden der Benutzer:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)ge(u("tasks.editTask.errors.connectionError"));else ge("".concat(u("tasks.editTask.errors.loadUsersError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},Ae=async()=>{try{ge(null);if(!localStorage.getItem("token"))return void ge("Nicht authentifiziert");const e=await z.A.get(U.Sn.ROLES.BASE);ce(e.data||[])}catch(r){console.error("Fehler beim Laden der Rollen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)ge(u("tasks.editTask.errors.connectionError"));else ge("".concat(u("tasks.editTask.errors.loadRolesError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},Te=async()=>{try{ge(null);if(!localStorage.getItem("token"))return void ge("Nicht authentifiziert");const e=await z.A.get(U.Sn.BRANCHES.BASE);me(e.data||[])}catch(r){console.error("Fehler beim Laden der Niederlassungen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)ge(u("tasks.editTask.errors.connectionError"));else ge("".concat(u("tasks.editTask.errors.loadBranchesError"),": ").concat((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}},Ee=async()=>{try{ge(null);const e=await z.A.get(U.Sn.TASKS.CARTICLES(c.id));Ne(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der verkn\xfcpften Artikel:",r);const a=r;ge((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}},De=async()=>{try{ge(null);const e=await z.A.get(U.Sn.TASKS.ATTACHMENTS(c.id));H(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",r);const a=r;ge((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten"),H([])}},Pe=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const a=t[r];if(0===a.type.indexOf("image")){e.preventDefault();const t=a.getAsFile();return void(t&&await Re(t))}}},Ie=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await Re(t)}},Le=e=>{e.preventDefault(),e.stopPropagation()},Re=async e=>{ee(!0),ge(null);try{const t=new FormData;t.append("file",e);const r=(await z.A.post(U.Sn.TASKS.ATTACHMENTS(c.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;if(H([...K,r]),re((e=>[...e,r.id])),!r.fileType.startsWith("image/")){const e="\n[".concat(r.fileName,"](").concat((0,U._y)(c.id,r.id),")\n");if(se.current){const t=se.current.selectionStart,r=k.substring(0,t),a=k.substring(t);N(r+e+a),setTimeout((()=>{if(se.current){const r=t+e.length;se.current.selectionStart=r,se.current.selectionEnd=r,se.current.focus()}}),0)}else N(k+e)}}catch(a){var t,r;console.error("Fehler beim Verarbeiten der Datei:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{ee(!1)}},Oe=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await Re(r),ae.current&&(ae.current.value="")},Fe=async e=>{e.preventDefault(),ge(null),pe(!0);try{if(!v||!S||!F)return ge(u("tasks.editTask.errors.fillAllFields")),void pe(!1);if("user"===T&&!D)return ge(u("tasks.editTask.form.chooseUser")),void pe(!1);if("role"===T&&!I)return ge(u("tasks.editTask.form.chooseRole")),void pe(!1);let e=k||"";const t=K.filter((e=>{var t;return(null===(t=e.fileType)||void 0===t?void 0:t.startsWith("image/"))&&e.id})),r=/!\[([^\]]*)\]\([^)]+\)/g,a=[];let s;if(w)for(;null!==(s=r.exec(w));)a.push(s[0]);for(const o of t){const t=(0,U._y)(c.id,o.id),r="![".concat(o.fileName,"](").concat(t,")"),a=o.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp("!\\[".concat(a,"\\]\\([^)]+\\)"),"g").test(e)||(e=e?"".concat(e,"\n").concat(r):r)}for(const o of a)e.includes(o)||(e=e?"".concat(e,"\n").concat(o):o);const n={title:v,description:e,status:S,qualityControlId:R,branchId:F,dueDate:ne};"user"===T?(n.responsibleId=D,n.roleId=null):"role"===T&&(n.roleId=I,n.responsibleId=null);const l=await z.A.put("".concat(U.Sn.TASKS.BASE,"/").concat(c.id),n);console.log("Task aktualisiert:",l.data);const i=await z.A.get(U.Sn.TASKS.BY_ID(c.id));i.data.attachments?i.data.attachments=i.data.attachments.map((e=>({id:e.id,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,filePath:e.filePath,uploadedAt:e.uploadedAt,url:(0,U._y)(c.id,e.id)}))):i.data.attachments=[],re([]),d(i.data),o()}catch(a){var t,r;console.error("Fehler beim Aktualisieren des Tasks:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{pe(!1)}},Be=async()=>{if(be)try{if(!localStorage.getItem("token"))return void ge("Nicht authentifiziert");await z.A.delete(U.Sn.TASKS.BY_ID(c.id)),d(void 0),o()}catch(r){var e,t;console.error("Delete Error:",r);const a=r;ge((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}else ye(!0)},ze=async e=>{try{ge(null),await z.A.post(U.Sn.TASKS.LINK_CARTICLE(c.id,e.id)),Ne((t=>[...t,e]))}catch(a){var t,r;console.error("Fehler beim Verkn\xfcpfen des Artikels:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Me=async e=>{try{ge(null),await z.A.delete(U.Sn.TASKS.UNLINK_CARTICLE(c.id,e)),Ne((t=>t.filter((t=>t.id!==e))))}catch(a){var t,r;console.error("Fehler beim Entfernen der Artikelverkn\xfcpfung:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},qe=()=>{var e,t,r,a,s;return(0,W.jsxs)("form",{onSubmit:Fe,className:"space-y-4",children:[(0,W.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,W.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,W.jsx)("button",{type:"button",className:"".concat("data"===je?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>we("data"),children:u("tasks.editTask.tabs.data")}),(0,W.jsx)("button",{type:"button",className:"".concat("cerebro"===je?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>we("cerebro"),children:u("tasks.editTask.tabs.cerebro")})]})}),"data"===je&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.title")}),(0,W.jsx)("input",{type:"text",id:"title",value:v,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"description_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.description")}),(0,W.jsxs)("div",{className:"relative",children:[(0,W.jsx)("textarea",{ref:se,id:"description_edit",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:k,onChange:e=>N(e.target.value),onPaste:Pe,onDrop:Ie,onDragOver:Le,placeholder:u("tasks.editTask.form.descriptionPlaceholder")}),(0,W.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,W.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ae.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.fileUpload")})]}),(0,W.jsx)("input",{ref:ae,type:"file",onChange:Oe,className:"hidden"}),J&&(0,W.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,W.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("tasks.editTask.form.uploading")})})]}),_e(),Ue()]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.status")}),(0,W.jsxs)("select",{id:"status",value:S,onChange:e=>C(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"open",children:u("tasks.status.open")}),(0,W.jsx)("option",{value:"in_progress",children:u("tasks.status.in_progress")}),(0,W.jsx)("option",{value:"improval",children:u("tasks.status.improval")}),(0,W.jsx)("option",{value:"quality_control",children:u("tasks.status.quality_control")}),(0,W.jsx)("option",{value:"done",children:u("tasks.status.done")})]})]}),(0,W.jsxs)("div",{className:"space-y-2",children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleFor")," *"]}),(0,W.jsxs)("div",{className:"flex space-x-4",children:[(0,W.jsxs)("label",{className:"inline-flex items-center",children:[(0,W.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===T,onChange:()=>{E("user"),L(null)}}),(0,W.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.user")})]}),(0,W.jsxs)("label",{className:"inline-flex items-center",children:[(0,W.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===T,onChange:()=>{E("role"),P(null)}}),(0,W.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.role")})]})]})]}),"user"===T?(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleUser")," *"]}),(0,W.jsxs)("select",{id:"responsible",value:null===D?"":D,onChange:e=>P(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"user"===T,children:[(0,W.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(le)&&le.map((e=>(0,W.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleRole")," *"]}),(0,W.jsxs)("select",{id:"role",value:null===I?"":I,onChange:e=>L(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"role"===T,children:[(0,W.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(de)&&de.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.qualityControl")}),(0,W.jsxs)("select",{id:"qualityControl",value:null===R?"":R,onChange:e=>O(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:u("tasks.editTask.form.noQualityControl")}),Array.isArray(le)&&le.map((e=>(0,W.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.branch")}),(0,W.jsxs)("select",{id:"branch",value:0===F?"":F,onChange:e=>B(e.target.value?Number(e.target.value):0),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,W.jsx)("option",{value:"",children:u("common.pleaseSelect")}),Array.isArray(ue)&&ue.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.dueDate")}),(0,W.jsx)("input",{type:"date",id:"dueDate",value:ne||"",onChange:e=>{e.target.value?oe(e.target.value):oe(null)},className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===je&&(0,W.jsxs)("div",{children:[ke.length>0&&(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:u("tasks.editTask.form.linkedCerebroArticles")}),(0,W.jsx)("ul",{className:"space-y-2",children:ke.map((e=>(0,W.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,W.jsx)("a",{href:"/cerebro/articles/".concat(e.slug),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:e.title}),(0,W.jsx)("button",{type:"button",onClick:()=>Me(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:u("tasks.editTask.form.remove")})]},e.id)))})]}),(0,W.jsx)(V,{onArticleSelected:ze,excludeArticleIds:ke.map((e=>e.id)),selectedArticles:ke,onArticleRemove:Me})]}),"data"===je&&((null===(e=c.title)||void 0===e?void 0:e.includes("ARL"))||(null===(t=c.title)||void 0===t?void 0:t.includes("EPS"))||(null===(r=c.title)||void 0===r?void 0:r.includes("Pension"))||(null===(a=c.title)||void 0===a?void 0:a.includes("Caja"))||(null===(s=c.description)||void 0===s?void 0:s.includes("lifecycle")))&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Q,{task:c}),(0,W.jsx)($,{task:c}),(0,W.jsx)(X,{task:c,onComplete:()=>{}})]}),(0,W.jsxs)("div",{className:"flex justify-between pt-4",children:[Se&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{type:"button",onClick:Be,className:"p-2 rounded-md ".concat(be?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),children:be?(0,W.jsx)(_.A,{className:"h-5 w-5"}):(0,W.jsx)(A.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u(be?"tasks.editTask.form.confirmDelete":"tasks.editTask.form.delete")})]}),(0,W.jsxs)("div",{className:"flex gap-2",children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{type:"button",onClick:o,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,W.jsx)(q.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.cancel")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:he,children:he?(0,W.jsx)(b.A,{className:"h-5 w-5 animate-spin"}):(0,W.jsx)(_.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u(he?"tasks.editTask.form.saving":"tasks.editTask.form.save")})]})]})]})]})},_e=()=>0===K.length?null:(0,W.jsx)("div",{className:"mt-2",children:(0,W.jsx)("ul",{className:"flex flex-wrap gap-2",children:K.map((e=>(0,W.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,W.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,W.jsxs)("div",{className:"flex ml-2",children:[(0,W.jsxs)("div",{className:"relative group mr-1",children:[(0,W.jsx)("button",{type:"button",onClick:()=>(async e=>{try{const t=await z.A.get(U.Sn.TASKS.ATTACHMENT(c.id,e.id),{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=r,a.setAttribute("download",e.fileName),document.body.appendChild(a),a.click(),a.remove()}catch(a){var t,r;console.error("Fehler beim Herunterladen des Anhangs:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.download")})]}),(0,W.jsxs)("div",{className:"relative group ml-1",children:[(0,W.jsx)("button",{type:"button",onClick:()=>(async e=>{try{ge(null);const t=K.find((t=>t.id===e));if(t&&(await z.A.delete(U.Sn.TASKS.ATTACHMENT(c.id,e)),H(K.filter((t=>t.id!==e))),t.fileName)){const t=(0,U._y)(c.id,e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp("!\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),a=new RegExp("\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),s=k.replace(r,"").replace(a,"").replace(/\n{3,}/g,"\n\n");N(s)}}catch(a){var t,r;console.error("Fehler beim L\xf6schen des Anhangs:",a);const e=a;ge((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.remove")})]})]}),e.fileType.startsWith("image/")&&(0,W.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,W.jsx)("img",{src:(0,U._y)(c.id,e.id),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id)))})}),Ue=()=>0===Z.length?null:(0,W.jsx)("div",{className:"mt-2",children:(0,W.jsx)("ul",{className:"flex flex-wrap gap-2",children:Z.map(((e,t)=>{var r;return(0,W.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,W.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,W.jsx)("div",{className:"flex ml-2",children:(0,W.jsxs)("div",{className:"relative group ml-1",children:[(0,W.jsx)("button",{type:"button",onClick:()=>(e=>{const t=Z[e];if(t&&(Y(Z.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=u("tasks.editTask.form.uploadAfterCreate"),a=new RegExp("!\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=k.replace(a,"").replace(s,"").replace(/\n{3,}/g,"\n\n");N(n)}})(t),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:(0,W.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,W.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:u("tasks.editTask.form.remove")})]})}),(null===(r=e.fileType)||void 0===r?void 0:r.startsWith("image/"))&&e.file&&(0,W.jsx)("div",{className:"absolute z-10 bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,W.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},"temp-".concat(t))}))})});return a?ve?(0,W.jsxs)(M.lG,{open:a,onClose:o,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,W.jsx)(M.lG.Title,{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,W.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("div",{className:"p-4",children:[xe&&(0,W.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:xe}),qe()]})]})})]}):(0,W.jsxs)(W.Fragment,{children:[a&&!p&&(0,W.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:o,style:{opacity:a?1:0,transition:"opacity 300ms ease-out"}}),(0,W.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(a?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:a?"auto":"none"},"aria-hidden":!a,role:"dialog","aria-modal":a,children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,W.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[xe&&(0,W.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:xe}),qe()]})]})]}):null};var ee=r(4450);const te=e=>{let{isOpen:t,onClose:r,onReservationCreated:a}=e;const{t:o}=(0,n.Bd)(),{showMessage:l}=(0,Y.A)(),{openSidepane:i,closeSidepane:d}=(0,G.N)(),[c,u]=(0,s.useState)(window.innerWidth<640),[m,x]=(0,s.useState)(window.innerWidth>1070),[g,h]=(0,s.useState)(""),[p,b]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[f,k]=(0,s.useState)("COP"),[N,j]=(0,s.useState)(null),[w,S]=(0,s.useState)(null),[C,A]=(0,s.useState)(!1),T=e=>{const t=e.target.value;b(t),j((e=>e&&0!==e.trim().length?e.includes("@")&&e.includes(".")?"email":"phone":null)(t))},E=e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&v(t)};(0,s.useEffect)((()=>{const e=()=>{u(window.innerWidth<640),x(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!c?i():d(),()=>{d()})),[t,c,i,d]),(0,s.useEffect)((()=>{t||(h(""),b(""),v(""),k("COP"),j(null),S(null))}),[t]);const D=async e=>{if(e.preventDefault(),S(null),g&&0!==g.trim().length)if(p&&0!==p.trim().length)if(!y||parseFloat(y)<=0)S(o("reservations.createReservation.errors.amountRequired","Betrag muss eine positive Zahl sein"));else try{A(!0);const e={guestName:g.trim(),contact:p.trim(),amount:parseFloat(y),currency:f};console.log("[CreateReservationModal] Sende Daten:",e),console.log("[CreateReservationModal] API Endpoint:","/api/reservations");const t=await ee.u.create(e);console.log("[CreateReservationModal] Reservierung erstellt:",t),l(o("reservations.createReservation.success","Reservierung erfolgreich erstellt"),"success"),a(t),r()}catch(d){var t,s,n,i;console.error("[CreateReservationModal] Fehler beim Erstellen der Reservierung:",d),console.error("[CreateReservationModal] Error Response:",d.response),console.error("[CreateReservationModal] Error Status:",null===(t=d.response)||void 0===t?void 0:t.status),console.error("[CreateReservationModal] Error Data:",null===(s=d.response)||void 0===s?void 0:s.data);const e=(null===(n=d.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||d.message||o("reservations.createReservation.errors.createError","Fehler beim Erstellen der Reservierung");S(e),l(e,"error")}finally{A(!1)}else S(o("reservations.createReservation.errors.contactRequired","Kontaktinformation ist erforderlich"));else S(o("reservations.createReservation.errors.guestNameRequired","Gast-Name ist erforderlich"))},P=()=>{r()};return c?(0,W.jsxs)(M.lG,{open:t,onClose:P,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsx)(M.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,W.jsx)(M.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("reservations.createReservation.title","Neue Reservierung")}),(0,W.jsx)("button",{onClick:P,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),w&&(0,W.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:w}),(0,W.jsxs)("form",{onSubmit:D,children:[(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsxs)("label",{htmlFor:"guestName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.guestName","Gast-Name")," *"]}),(0,W.jsx)("input",{type:"text",id:"guestName",value:g,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsxs)("label",{htmlFor:"contact",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.contact","Telefonnummer oder Email")," *"]}),(0,W.jsx)("input",{type:"text",id:"contact",value:p,onChange:T,placeholder:o("reservations.createReservation.contactPlaceholder","z.B. +573001234567 oder email@example.com"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),N&&(0,W.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"email"===N?o("reservations.createReservation.detectedEmail","Email erkannt"):o("reservations.createReservation.detectedPhone","Telefonnummer erkannt")})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.amount","Betrag")," *"]}),(0,W.jsx)("input",{type:"text",id:"amount",value:y,onChange:E,placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("reservations.createReservation.currency","W\xe4hrung")}),(0,W.jsxs)("select",{id:"currency",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"COP",children:"COP"}),(0,W.jsx)("option",{value:"USD",children:"USD"}),(0,W.jsx)("option",{value:"EUR",children:"EUR"})]})]})]}),(0,W.jsx)("p",{className:"mb-4 text-sm text-gray-500 dark:text-gray-400",children:o("reservations.createReservation.hint","Nach der Erstellung wird automatisch eine WhatsApp-Nachricht mit Zahlungslink versendet (wenn Telefonnummer angegeben).")}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,W.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:o("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:C,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:C?o("common.creating","Wird erstellt..."):o("common.create","Erstellen")})]})]})]})})})]}):(0,W.jsxs)(W.Fragment,{children:[t&&!m&&(0,W.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,W.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("reservations.createReservation.title","Neue Reservierung")}),(0,W.jsx)("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[w&&(0,W.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:w}),(0,W.jsxs)("form",{onSubmit:D,children:[(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsxs)("label",{htmlFor:"guestName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.guestName","Gast-Name")," *"]}),(0,W.jsx)("input",{type:"text",id:"guestName",value:g,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsxs)("div",{className:"mb-4",children:[(0,W.jsxs)("label",{htmlFor:"contact",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.contact","Telefonnummer oder Email")," *"]}),(0,W.jsx)("input",{type:"text",id:"contact",value:p,onChange:T,placeholder:o("reservations.createReservation.contactPlaceholder","z.B. +573001234567 oder email@example.com"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),N&&(0,W.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"email"===N?o("reservations.createReservation.detectedEmail","Email erkannt"):o("reservations.createReservation.detectedPhone","Telefonnummer erkannt")})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[o("reservations.createReservation.amount","Betrag")," *"]}),(0,W.jsx)("input",{type:"text",id:"amount",value:y,onChange:E,placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("reservations.createReservation.currency","W\xe4hrung")}),(0,W.jsxs)("select",{id:"currency",value:f,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"COP",children:"COP"}),(0,W.jsx)("option",{value:"USD",children:"USD"}),(0,W.jsx)("option",{value:"EUR",children:"EUR"})]})]})]}),(0,W.jsx)("p",{className:"mb-4 text-sm text-gray-500 dark:text-gray-400",children:o("reservations.createReservation.hint","Nach der Erstellung wird automatisch eine WhatsApp-Nachricht mit Zahlungslink versendet (wenn Telefonnummer angegeben).")}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,W.jsx)("button",{type:"button",onClick:P,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:o("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:C,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:C?o("common.creating","Wird erstellt..."):o("common.create","Erstellen")})]})]})]})]})]})};let re=function(e){return e.OWN="own",e.EXTERNAL="external",e}({}),ae=function(e){return e.CONFIRMED="confirmed",e.CANCELLED="cancelled",e.COMPLETED="completed",e.NO_SHOW="no_show",e}({});const se=e=>{let{isOpen:t,onClose:r,onTourCreated:a}=e;const{t:o}=(0,n.Bd)(),{user:i}=(0,l.As)(),{showMessage:d}=(0,Y.A)(),[c,u]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[g,h]=(0,s.useState)(re.OWN),[p,b]=(0,s.useState)(!0),[y,v]=(0,s.useState)(""),[f,k]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[w,S]=(0,s.useState)(""),[C,A]=(0,s.useState)("COP"),[T,E]=(0,s.useState)(""),[D,P]=(0,s.useState)(""),[I,L]=(0,s.useState)(""),[R,O]=(0,s.useState)(""),[F,B]=(0,s.useState)(""),[_,V]=(0,s.useState)(""),[G,K]=(0,s.useState)(""),[H,Z]=(0,s.useState)(""),[Q,$]=(0,s.useState)(""),[X,J]=(0,s.useState)(""),[ee,te]=(0,s.useState)(""),[ae,se]=(0,s.useState)(""),[ne,oe]=(0,s.useState)(null),[le,ie]=(0,s.useState)(null),[de,ce]=(0,s.useState)([]),[ue,me]=(0,s.useState)([]),[xe,ge]=(0,s.useState)(!1),[he,pe]=(0,s.useState)([]),[be,ye]=(0,s.useState)([]),[ve,fe]=(0,s.useState)(null),[ke,Ne]=(0,s.useState)(!1),[je,we]=(0,s.useState)(!0);(0,s.useEffect)((()=>{t&&(async()=>{try{var e,t,r;we(!0);const[a,s]=await Promise.all([z.A.get(U.Sn.BRANCHES.BASE),z.A.get((null===(e=U.Sn.TOUR_PROVIDERS)||void 0===e?void 0:e.BASE)||"/api/tour-providers")]);pe((null===(t=a.data)||void 0===t?void 0:t.data)||a.data||[]),ye((null===(r=s.data)||void 0===r?void 0:r.data)||s.data||[])}catch(a){console.error("Fehler beim Laden der Daten:",a),d(o("errors.loadError"),"error")}finally{we(!1)}})()}),[t,o,d]),(0,s.useEffect)((()=>{t||(u(""),x(""),h(re.OWN),b(!0),v(""),k(""),j(""),S(""),A("COP"),E(""),P(""),L(""),O(""),B(""),V(""),K(""),Z(""),$(""),J(""),te(""),se(""),oe(null),ie(null),ce([]),me([]),fe(null))}),[t]);return t?(0,W.jsxs)(M.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsx)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:o("tours.create","Neue Tour erstellen")}),(0,W.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),fe(null),Ne(!0);try{const e={title:c,description:m||null,type:g,isActive:p,duration:y?Number(y):null,maxParticipants:f?Number(f):null,minParticipants:N?Number(N):null,price:w?Number(w):null,currency:C||"COP",location:T||null,meetingPoint:D||null,includes:I||null,excludes:R||null,requirements:F||null,totalCommission:_?Number(_):null,totalCommissionPercent:G?Number(G):null,sellerCommissionPercent:H?Number(H):null,sellerCommissionFixed:Q?Number(Q):null,externalProviderId:X?Number(X):null,externalBookingUrl:ee||null,branchId:ae?Number(ae):null},t=await z.A.post(U.Sn.TOURS.BASE,e);if(t.data.success){const e=t.data.data;if(ne&&e.id)try{ge(!0);const t=new FormData;t.append("image",ne),await z.A.post(U.Sn.TOURS.UPLOAD_IMAGE(e.id),t,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){console.error("Fehler beim Hochladen des Hauptbildes:",n),d(o("tours.imageUploadError","Tour erstellt, aber Fehler beim Hochladen des Bildes"),"warning")}finally{ge(!1)}if(de.length>0&&e.id)try{ge(!0);for(const t of de){const r=new FormData;r.append("image",t),await z.A.post(U.Sn.TOURS.UPLOAD_GALLERY(e.id),r,{headers:{"Content-Type":"multipart/form-data"}})}}catch(l){console.error("Fehler beim Hochladen der Galerie-Bilder:",l),d(o("tours.galleryUploadError","Tour erstellt, aber Fehler beim Hochladen der Galerie-Bilder"),"warning")}finally{ge(!1)}d(o("tours.createSuccess","Tour erfolgreich erstellt"),"success");const s=await z.A.get(U.Sn.TOURS.BY_ID(e.id));a(s.data.data),r()}else fe(t.data.message||o("errors.saveError"))}catch(i){var t,s;console.error("Fehler beim Erstellen der Tour:",i);const e=(null===(t=i.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||o("errors.saveError");fe(e),d(e,"error")}finally{Ne(!1)}},className:"p-6 space-y-6",children:[ve&&(0,W.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:ve}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("tours.basicInfo","Grundinformationen")}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("tours.name","Titel")," *"]}),(0,W.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.description","Beschreibung")}),(0,W.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("tours.type","Typ")," *"]}),(0,W.jsxs)("select",{value:g,onChange:e=>h(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:re.OWN,children:o("tours.typeOwn","Eigene Tour")}),(0,W.jsx)("option",{value:re.EXTERNAL,children:o("tours.typeExternal","Externe Tour")})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.status","Status")}),(0,W.jsxs)("select",{value:p?"true":"false",onChange:e=>b("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"true",children:o("tours.statusActive","Aktiv")}),(0,W.jsx)("option",{value:"false",children:o("tours.statusInactive","Inaktiv")})]})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.branch","Niederlassung")}),(0,W.jsxs)("select",{value:ae,onChange:e=>se(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:o("common.all","Alle")}),he.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("tours.details","Tour-Details")}),(0,W.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.duration","Dauer (Stunden)")}),(0,W.jsx)("input",{type:"number",value:y,onChange:e=>v(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.minParticipants","Min. Teilnehmer")}),(0,W.jsx)("input",{type:"number",value:N,onChange:e=>j(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.maxParticipants","Max. Teilnehmer")}),(0,W.jsx)("input",{type:"number",value:f,onChange:e=>k(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.price","Preis")}),(0,W.jsx)("input",{type:"number",value:w,onChange:e=>S(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.currency","W\xe4hrung")}),(0,W.jsx)("input",{type:"text",value:C,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.location","Ort")}),(0,W.jsx)("input",{type:"text",value:T,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.meetingPoint","Treffpunkt")}),(0,W.jsx)("input",{type:"text",value:D,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),g===re.EXTERNAL&&(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("tours.externalInfo","Externe Tour-Informationen")}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.externalProvider","Externer Anbieter")}),(0,W.jsxs)("select",{value:X,onChange:e=>J(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:o("common.select","Ausw\xe4hlen")}),be.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,W.jsx)("input",{type:"url",value:ee,onChange:e=>te(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("tours.commissions","Kommissionen")}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.totalCommission","Gesamtkommission")}),(0,W.jsx)("input",{type:"number",value:_,onChange:e=>V(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,W.jsx)("input",{type:"number",value:G,onChange:e=>K(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,W.jsx)("input",{type:"number",value:H,onChange:e=>Z(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,W.jsx)("input",{type:"number",value:Q,onChange:e=>$(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.includes","Enth\xe4lt")}),(0,W.jsx)("textarea",{value:I,onChange:e=>L(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.excludes","Nicht enthalten")}),(0,W.jsx)("textarea",{value:R,onChange:e=>O(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o("tours.requirements","Anforderungen")}),(0,W.jsx)("textarea",{value:F,onChange:e=>B(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:o("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:ke||je,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ke?o("common.saving","Speichere..."):o("common.save","Speichern")})]})]})]})})]}):null},ne=e=>{var t,r;let{isOpen:a,onClose:o,onTourUpdated:i,tour:d}=e;const{t:c}=(0,n.Bd)(),{user:u}=(0,l.As)(),{showMessage:m}=(0,Y.A)(),[x,g]=(0,s.useState)(d.title||""),[h,p]=(0,s.useState)(d.description||""),[b,y]=(0,s.useState)(d.type||re.OWN),[v,f]=(0,s.useState)(null===(t=d.isActive)||void 0===t||t),[k,N]=(0,s.useState)(d.duration||""),[j,w]=(0,s.useState)(d.maxParticipants||""),[S,C]=(0,s.useState)(d.minParticipants||""),[A,T]=(0,s.useState)(d.price?"string"===typeof d.price?parseFloat(d.price):d.price:""),[E,D]=(0,s.useState)(d.currency||"COP"),[P,I]=(0,s.useState)(d.location||""),[L,R]=(0,s.useState)(d.meetingPoint||""),[O,F]=(0,s.useState)(d.includes||""),[B,_]=(0,s.useState)(d.excludes||""),[V,G]=(0,s.useState)(d.requirements||""),[K,H]=(0,s.useState)(d.totalCommission?"string"===typeof d.totalCommission?parseFloat(d.totalCommission):d.totalCommission:""),[Z,Q]=(0,s.useState)(d.totalCommissionPercent?"string"===typeof d.totalCommissionPercent?parseFloat(d.totalCommissionPercent):d.totalCommissionPercent:""),[$,X]=(0,s.useState)(d.sellerCommissionPercent?"string"===typeof d.sellerCommissionPercent?parseFloat(d.sellerCommissionPercent):d.sellerCommissionPercent:""),[J,ee]=(0,s.useState)(d.sellerCommissionFixed?"string"===typeof d.sellerCommissionFixed?parseFloat(d.sellerCommissionFixed):d.sellerCommissionFixed:""),[te,ae]=(0,s.useState)(d.externalProviderId||""),[se,ne]=(0,s.useState)(d.externalBookingUrl||""),[oe,le]=(0,s.useState)(d.branchId||""),[ie,de]=(0,s.useState)(null),[ce,ue]=(0,s.useState)(d.imageUrl?"".concat(API_BASE_URL||"").concat(d.imageUrl):null),[me,xe]=(0,s.useState)([]),[ge,he]=(0,s.useState)((null===(r=d.galleryUrls)||void 0===r?void 0:r.map((e=>"".concat(API_BASE_URL||"").concat(e))))||[]),[pe,be]=(0,s.useState)(!1),[ye,ve]=(0,s.useState)([]),[fe,ke]=(0,s.useState)([]),[Ne,je]=(0,s.useState)(null),[we,Se]=(0,s.useState)(!1),[Ce,Ae]=(0,s.useState)(!0);(0,s.useEffect)((()=>{a&&(async()=>{try{var e,t,r;Ae(!0);const[a,s]=await Promise.all([z.A.get(U.Sn.BRANCHES.BASE),z.A.get((null===(e=U.Sn.TOUR_PROVIDERS)||void 0===e?void 0:e.BASE)||"/api/tour-providers")]);ve((null===(t=a.data)||void 0===t?void 0:t.data)||a.data||[]),ke((null===(r=s.data)||void 0===r?void 0:r.data)||s.data||[])}catch(a){console.error("Fehler beim Laden der Daten:",a),m(c("errors.loadError"),"error")}finally{Ae(!1)}})()}),[a,c,m]),(0,s.useEffect)((()=>{var e,t;d&&(g(d.title||""),p(d.description||""),y(d.type||re.OWN),f(null===(e=d.isActive)||void 0===e||e),N(d.duration||""),w(d.maxParticipants||""),C(d.minParticipants||""),T(d.price?"string"===typeof d.price?parseFloat(d.price):d.price:""),D(d.currency||"COP"),I(d.location||""),R(d.meetingPoint||""),F(d.includes||""),_(d.excludes||""),G(d.requirements||""),H(d.totalCommission?"string"===typeof d.totalCommission?parseFloat(d.totalCommission):d.totalCommission:""),Q(d.totalCommissionPercent?"string"===typeof d.totalCommissionPercent?parseFloat(d.totalCommissionPercent):d.totalCommissionPercent:""),X(d.sellerCommissionPercent?"string"===typeof d.sellerCommissionPercent?parseFloat(d.sellerCommissionPercent):d.sellerCommissionPercent:""),ee(d.sellerCommissionFixed?"string"===typeof d.sellerCommissionFixed?parseFloat(d.sellerCommissionFixed):d.sellerCommissionFixed:""),ae(d.externalProviderId||""),ne(d.externalBookingUrl||""),le(d.branchId||""),ue(d.imageUrl?"".concat(API_BASE_URL||"").concat(d.imageUrl):null),he((null===(t=d.galleryUrls)||void 0===t?void 0:t.map((e=>"".concat(API_BASE_URL||"").concat(e))))||[]))}),[d]);return a?(0,W.jsxs)(M.lG,{open:a,onClose:o,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsx)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:c("tours.edit","Tour bearbeiten")}),(0,W.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),je(null),Se(!0);try{const e={title:x,description:h||null,type:b,isActive:v,duration:k?Number(k):null,maxParticipants:j?Number(j):null,minParticipants:S?Number(S):null,price:A?Number(A):null,currency:E||"COP",location:P||null,meetingPoint:L||null,includes:O||null,excludes:B||null,requirements:V||null,totalCommission:K?Number(K):null,totalCommissionPercent:Z?Number(Z):null,sellerCommissionPercent:$?Number($):null,sellerCommissionFixed:J?Number(J):null,externalProviderId:te?Number(te):null,externalBookingUrl:se||null,branchId:oe?Number(oe):null},t=await z.A.put(U.Sn.TOURS.BY_ID(d.id),e);if(t.data.success){t.data.data;if(ie)try{be(!0);const e=new FormData;e.append("image",ie),await z.A.post(U.Sn.TOURS.UPLOAD_IMAGE(d.id),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(a){console.error("Fehler beim Hochladen des Hauptbildes:",a),m(c("tours.imageUploadError","Tour aktualisiert, aber Fehler beim Hochladen des Bildes"),"warning")}finally{be(!1)}if(me.length>0)try{be(!0);for(const e of me){const t=new FormData;t.append("image",e),await z.A.post(U.Sn.TOURS.UPLOAD_GALLERY(d.id),t,{headers:{"Content-Type":"multipart/form-data"}})}}catch(s){console.error("Fehler beim Hochladen der Galerie-Bilder:",s),m(c("tours.galleryUploadError","Tour aktualisiert, aber Fehler beim Hochladen der Galerie-Bilder"),"warning")}finally{be(!1)}m(c("tours.updateSuccess","Tour erfolgreich aktualisiert"),"success");const e=await z.A.get(U.Sn.TOURS.BY_ID(d.id));i(e.data.data),o()}else je(t.data.message||c("errors.saveError"))}catch(n){var t,r;console.error("Fehler beim Aktualisieren der Tour:",n);const e=(null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||c("errors.saveError");je(e),m(e,"error")}finally{Se(!1)}},className:"p-6 space-y-6",children:[Ne&&(0,W.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded",children:Ne}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.basicInfo","Grundinformationen")}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[c("tours.name","Titel")," *"]}),(0,W.jsx)("input",{type:"text",value:x,onChange:e=>g(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.description","Beschreibung")}),(0,W.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[c("tours.type","Typ")," *"]}),(0,W.jsxs)("select",{value:b,onChange:e=>y(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:re.OWN,children:c("tours.typeOwn","Eigene Tour")}),(0,W.jsx)("option",{value:re.EXTERNAL,children:c("tours.typeExternal","Externe Tour")})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.status","Status")}),(0,W.jsxs)("select",{value:v?"true":"false",onChange:e=>f("true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"true",children:c("tours.statusActive","Aktiv")}),(0,W.jsx)("option",{value:"false",children:c("tours.statusInactive","Inaktiv")})]})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.branch","Niederlassung")}),(0,W.jsxs)("select",{value:oe,onChange:e=>le(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:c("common.all","Alle")}),ye.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.details","Tour-Details")}),(0,W.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.duration","Dauer (Stunden)")}),(0,W.jsx)("input",{type:"number",value:k,onChange:e=>N(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.minParticipants","Min. Teilnehmer")}),(0,W.jsx)("input",{type:"number",value:S,onChange:e=>C(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.maxParticipants","Max. Teilnehmer")}),(0,W.jsx)("input",{type:"number",value:j,onChange:e=>w(e.target.value?Number(e.target.value):""),min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.price","Preis")}),(0,W.jsx)("input",{type:"number",value:A,onChange:e=>T(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.currency","W\xe4hrung")}),(0,W.jsx)("input",{type:"text",value:E,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.location","Ort")}),(0,W.jsx)("input",{type:"text",value:P,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.meetingPoint","Treffpunkt")}),(0,W.jsx)("input",{type:"text",value:L,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),b===re.EXTERNAL&&(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.externalInfo","Externe Tour-Informationen")}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.externalProvider","Externer Anbieter")}),(0,W.jsxs)("select",{value:te,onChange:e=>ae(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,W.jsx)("option",{value:"",children:c("common.select","Ausw\xe4hlen")}),fe.map((e=>(0,W.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.externalBookingUrl","Externe Buchungs-URL")}),(0,W.jsx)("input",{type:"url",value:se,onChange:e=>ne(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.commissions","Kommissionen")}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.totalCommission","Gesamtkommission")}),(0,W.jsx)("input",{type:"number",value:K,onChange:e=>H(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.totalCommissionPercent","Gesamtkommission (%)")}),(0,W.jsx)("input",{type:"number",value:Z,onChange:e=>Q(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.sellerCommissionPercent","Verk\xe4ufer-Kommission (%)")}),(0,W.jsx)("input",{type:"number",value:$,onChange:e=>X(e.target.value?Number(e.target.value):""),min:"0",max:"100",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.sellerCommissionFixed","Verk\xe4ufer-Kommission (Fix)")}),(0,W.jsx)("input",{type:"number",value:J,onChange:e=>ee(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.additionalInfo","Zus\xe4tzliche Informationen")}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.includes","Enth\xe4lt")}),(0,W.jsx)("textarea",{value:O,onChange:e=>F(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.excludes","Nicht enthalten")}),(0,W.jsx)("textarea",{value:B,onChange:e=>_(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.requirements","Anforderungen")}),(0,W.jsx)("textarea",{value:V,onChange:e=>G(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:c("tours.images","Bilder")}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.mainImage","Hauptbild")}),(0,W.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){de(r);const e=new FileReader;e.onloadend=()=>{ue(e.result)},e.readAsDataURL(r)}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),ce&&(0,W.jsx)("div",{className:"mt-2",children:(0,W.jsx)("img",{src:ce,alt:"Vorschau",className:"max-w-xs h-48 object-cover rounded-md border border-gray-300 dark:border-gray-600"})})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:c("tours.gallery","Galerie")}),(0,W.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);t.length>0&&(xe((e=>[...e,...t])),t.forEach((e=>{const t=new FileReader;t.onloadend=()=>{he((e=>[...e,t.result]))},t.readAsDataURL(e)})))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),ge.length>0&&(0,W.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:ge.map(((e,t)=>(0,W.jsxs)("div",{className:"relative",children:[(0,W.jsx)("img",{src:e,alt:"Galerie ".concat(t+1),className:"w-full h-32 object-cover rounded-md border border-gray-300 dark:border-gray-600"}),(0,W.jsx)("button",{type:"button",onClick:()=>(async e=>{const t=d.galleryUrls||[];if(e<t.length)try{await z.A.delete(U.Sn.TOURS.DELETE_GALLERY_IMAGE(d.id,e));const t=await z.A.get(U.Sn.TOURS.BY_ID(d.id));t.data.success&&i(t.data.data)}catch(s){var r,a;console.error("Fehler beim L\xf6schen des Galerie-Bildes:",s),m((null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||c("errors.deleteError"),"error")}else{const r=e-t.length;xe((e=>e.filter(((e,t)=>t!==r)))),he((t=>t.filter(((t,r)=>r!==e))))}})(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,W.jsx)(q.A,{className:"h-4 w-4"})})]},t)))})]})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:c("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:we||Ce||pe,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:we?c("common.saving","Speichere..."):c("common.save","Speichern")})]})]})]})})]}):null};var oe=r(5590),le=r(7459),ie=r(9837),de=r(887);const ce=e=>{let{isOpen:t,onClose:r,tourId:a,onTourUpdated:o}=e;const{t:l}=(0,n.Bd)(),{showMessage:i}=(0,Y.A)(),[d,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null);(0,s.useEffect)((()=>{t&&a&&h()}),[t,a]);const h=async()=>{try{m(!0),g(null);const e=await z.A.get(U.Sn.TOURS.BY_ID(a));e.data.success?c(e.data.data):g(e.data.message||l("errors.loadError"))}catch(r){var e,t;console.error("Fehler beim Laden der Tour:",r);const a=(null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||l("errors.loadError");g(a),i(a,"error")}finally{m(!1)}};return t?(0,W.jsxs)(M.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsx)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:l("tours.details","Tour-Details")}),(0,W.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-6",children:u?(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:l("common.loading")}):x?(0,W.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:x}):d?(0,W.jsxs)("div",{className:"space-y-6",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:d.title}),(0,W.jsxs)("div",{className:"flex items-center gap-2",children:[(0,W.jsx)("span",{className:"px-3 py-1 text-sm rounded-full ".concat(d.type===re.OWN?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"),children:d.type===re.OWN?l("tours.typeOwn"):l("tours.typeExternal")}),(0,W.jsx)("span",{className:"px-3 py-1 text-sm rounded-full ".concat(d.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:d.isActive?l("tours.statusActive"):l("tours.statusInactive")})]})]}),d.description&&(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:l("tours.description")}),(0,W.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:d.description})]}),(0,W.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,W.jsxs)("div",{className:"space-y-4",children:[d.duration&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(O.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.duration")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[d.duration," ",l("common.hours","h")]})]})]}),(d.minParticipants||d.maxParticipants)&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(oe.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.participants","Teilnehmer")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:d.minParticipants&&d.maxParticipants?"".concat(d.minParticipants," - ").concat(d.maxParticipants):d.minParticipants?"".concat(d.minParticipants,"+"):d.maxParticipants?"bis ".concat(d.maxParticipants):"-"})]})]}),d.price&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(R.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.price")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white font-semibold",children:[Number(d.price).toLocaleString()," ",d.currency||"COP"]})]})]}),d.location&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(le.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.location")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:d.location})]})]}),d.meetingPoint&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(le.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.meetingPoint")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:d.meetingPoint})]})]})]}),(0,W.jsxs)("div",{className:"space-y-4",children:[d.branch&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(T.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.branch")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:d.branch.name})]})]}),d.createdBy&&(0,W.jsxs)("div",{className:"flex items-start gap-3",children:[(0,W.jsx)(E.A,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.columns.createdBy")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[d.createdBy.firstName," ",d.createdBy.lastName]})]})]}),d.createdAt&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("common.createdAt","Erstellt am")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,ie.GP)(new Date(d.createdAt),"dd.MM.yyyy HH:mm",{locale:de.de})})]}),d.externalProvider&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.externalProvider")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:d.externalProvider.name})]}),d.externalBookingUrl&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.externalBookingUrl")}),(0,W.jsx)("a",{href:d.externalBookingUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:d.externalBookingUrl})]})]})]}),(d.totalCommission||d.totalCommissionPercent||d.sellerCommissionPercent||d.sellerCommissionFixed)&&(0,W.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,W.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:l("tours.commissions")}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[d.totalCommission&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.totalCommission")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(d.totalCommission).toLocaleString()," ",d.currency||"COP"]})]}),d.totalCommissionPercent&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.totalCommissionPercent")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(d.totalCommissionPercent),"%"]})]}),d.sellerCommissionPercent&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.sellerCommissionPercent")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(d.sellerCommissionPercent),"%"]})]}),d.sellerCommissionFixed&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.sellerCommissionFixed")}),(0,W.jsxs)("div",{className:"text-gray-900 dark:text-white",children:[Number(d.sellerCommissionFixed).toLocaleString()," ",d.currency||"COP"]})]})]})]}),(d.includes||d.excludes||d.requirements)&&(0,W.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,W.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:l("tours.additionalInfo")}),(0,W.jsxs)("div",{className:"space-y-4",children:[d.includes&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("tours.includes")}),(0,W.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:d.includes})]}),d.excludes&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("tours.excludes")}),(0,W.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:d.excludes})]}),d.requirements&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("tours.requirements")}),(0,W.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:d.requirements})]})]})]}),(d.availableFrom||d.availableTo)&&(0,W.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,W.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:l("tours.availability","Verf\xfcgbarkeit")}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[d.availableFrom&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.availableFrom","Verf\xfcgbar ab")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,ie.GP)(new Date(d.availableFrom),"dd.MM.yyyy",{locale:de.de})})]}),d.availableTo&&(0,W.jsxs)("div",{children:[(0,W.jsx)("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l("tours.availableTo","Verf\xfcgbar bis")}),(0,W.jsx)("div",{className:"text-gray-900 dark:text-white",children:(0,ie.GP)(new Date(d.availableTo),"dd.MM.yyyy",{locale:de.de})})]})]})]})]}):(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:l("tours.notFound","Tour nicht gefunden")})}),(0,W.jsx)("div",{className:"flex justify-end p-6 border-t border-gray-200 dark:border-gray-700",children:(0,W.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:l("common.close","Schlie\xdfen")})})]})})]}):null},ue=e=>{let{isOpen:t,onClose:r,tourId:a}=e;const{t:o}=(0,n.Bd)(),{showMessage:l}=(0,Y.A)(),[i,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null);(0,s.useEffect)((()=>{t&&a&&g()}),[t,a]);const g=async()=>{try{u(!0),x(null);const e=await z.A.get(U.Sn.TOURS.BOOKINGS(a));e.data.success?d(e.data.data||[]):x(e.data.message||o("errors.loadError"))}catch(r){var e,t;console.error("Fehler beim Laden der Buchungen:",r);const a=(null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||o("errors.loadError");x(a),l(a,"error")}finally{u(!1)}},h=e=>{switch(e){case ae.CONFIRMED:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case ae.CANCELLED:return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case ae.COMPLETED:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case ae.NO_SHOW:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}},p=e=>{switch(e){case"paid":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"partially_paid":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"pending":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"refunded":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}};return t?(0,W.jsxs)(M.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-6xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsxs)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[o("tours.bookings","Buchungen")," (",i.length,")"]}),(0,W.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-6",children:c?(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("common.loading")}):m?(0,W.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:m}):0===i.length?(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("tourBookings.noBookings","Keine Buchungen vorhanden")}):(0,W.jsx)("div",{className:"overflow-x-auto",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,W.jsxs)("tr",{children:[(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.customerName","Kunde")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.tourDate","Tour-Datum")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.numberOfParticipants","Teilnehmer")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.totalPrice","Gesamtpreis")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.paymentStatus","Zahlungsstatus")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.status","Status")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o("tourBookings.bookedBy","Gebucht von")})]})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:i.map((e=>(0,W.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,W.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:e.customerName}),e.customerEmail&&(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.customerEmail}),e.customerPhone&&(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.customerPhone})]}),(0,W.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,ie.GP)(new Date(e.tourDate),"dd.MM.yyyy",{locale:de.de})}),(0,W.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o("tourBookings.bookingDate","Gebucht"),": ",(0,ie.GP)(new Date(e.bookingDate),"dd.MM.yyyy",{locale:de.de})]})]}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:e.numberOfParticipants})}),(0,W.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white font-semibold",children:[Number(e.totalPrice).toLocaleString()," ",e.currency]}),e.amountPaid&&e.amountPending&&(0,W.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o("tourBookings.amountPaid","Bezahlt"),": ",Number(e.amountPaid).toLocaleString()," ",e.currency,(0,W.jsx)("br",{}),o("tourBookings.amountPending","Ausstehend"),": ",Number(e.amountPending).toLocaleString()," ",e.currency]})]}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(p(e.paymentStatus)),children:o("tourBookings.paymentStatus.".concat(e.paymentStatus),e.paymentStatus)})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(h(e.status)),children:o("tourBookings.status.".concat(e.status),e.status)})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.bookedBy?(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[e.bookedBy.firstName," ",e.bookedBy.lastName]}):(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"-"})})]},e.id)))})]})})}),(0,W.jsx)("div",{className:"flex justify-end p-6 border-t border-gray-200 dark:border-gray-700",children:(0,W.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:o("common.close","Schlie\xdfen")})})]})})]}):null},me=e=>{let{isOpen:t,onClose:r,tourCount:a}=e;const{t:o}=(0,n.Bd)(),{showMessage:l}=(0,Y.A)(),[i,d]=(0,s.useState)(["id","title","description","type","price","currency","duration","maxParticipants","minParticipants","location","meetingPoint","imageUrl","galleryUrls","availableFrom","availableTo"]),[c,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)("json"),g=[{id:"id",label:o("tours.columns.title","Titel")},{id:"title",label:o("tours.name","Titel")},{id:"description",label:o("tours.description","Beschreibung")},{id:"type",label:o("tours.type","Typ")},{id:"price",label:o("tours.price","Preis")},{id:"currency",label:o("tours.currency","W\xe4hrung")},{id:"duration",label:o("tours.duration","Dauer")},{id:"maxParticipants",label:o("tours.maxParticipants","Max. Teilnehmer")},{id:"minParticipants",label:o("tours.minParticipants","Min. Teilnehmer")},{id:"location",label:o("tours.location","Ort")},{id:"meetingPoint",label:o("tours.meetingPoint","Treffpunkt")},{id:"includes",label:o("tours.includes","Enth\xe4lt")},{id:"excludes",label:o("tours.excludes","Nicht enthalten")},{id:"requirements",label:o("tours.requirements","Anforderungen")},{id:"imageUrl",label:o("tours.mainImage","Hauptbild")},{id:"galleryUrls",label:o("tours.gallery","Galerie")},{id:"availableFrom",label:o("tours.availableFrom","Verf\xfcgbar ab")},{id:"availableTo",label:o("tours.availableTo","Verf\xfcgbar bis")},{id:"externalBookingUrl",label:o("tours.externalBookingUrl","Externe Buchungs-URL")},{id:"branch",label:o("tours.branch","Niederlassung")},{id:"externalProvider",label:o("tours.externalProvider","Externer Anbieter")}];return t?(0,W.jsxs)(M.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsxs)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[o("tours.export.title","Touren exportieren")," (",a,")"]}),(0,W.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("div",{className:"p-6 space-y-6",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("tours.export.format","Export-Format")}),(0,W.jsxs)("div",{className:"flex gap-4",children:[(0,W.jsxs)("label",{className:"flex items-center",children:[(0,W.jsx)("input",{type:"radio",value:"json",checked:"json"===m,onChange:e=>x(e.target.value),className:"mr-2"}),"JSON"]}),(0,W.jsxs)("label",{className:"flex items-center",children:[(0,W.jsx)("input",{type:"radio",value:"csv",checked:"csv"===m,onChange:e=>x(e.target.value),className:"mr-2"}),"CSV"]})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("tours.export.selectFields","Felder ausw\xe4hlen")}),(0,W.jsxs)("div",{className:"flex gap-2",children:[(0,W.jsx)("button",{type:"button",onClick:()=>{d(g.map((e=>e.id)))},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:o("common.selectAll","Alle ausw\xe4hlen")}),(0,W.jsx)("span",{className:"text-gray-400",children:"|"}),(0,W.jsx)("button",{type:"button",onClick:()=>{d([])},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:o("common.deselectAll","Alle abw\xe4hlen")})]})]}),(0,W.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md p-4 max-h-96 overflow-y-auto",children:(0,W.jsx)("div",{className:"grid grid-cols-2 gap-2",children:g.map((e=>(0,W.jsxs)("label",{className:"flex items-center",children:[(0,W.jsx)("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>{return t=e.id,void d((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},className:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,W.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.label})]},e.id)))})})]})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:o("common.cancel","Abbrechen")}),(0,W.jsxs)("button",{type:"button",onClick:async()=>{if(0!==i.length){u(!0);try{const e=i.join(","),t=await z.A.get(U.Sn.TOURS.EXPORT,{params:{fields:e}}),a=t.data.tours||t.data;if("json"===m){const e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=window.URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="tours-export-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)}else{if(!Array.isArray(a)||0===a.length)return void l(o("tours.export.noData","Keine Daten zum Exportieren"),"warning");const e=i.map((e=>{const t=g.find((t=>t.id===e));return(null===t||void 0===t?void 0:t.label)||e})),t=a.map((e=>i.map((t=>{let r=e[t];return null===r||void 0===r?"":"object"===typeof r?"branch"===t||"externalProvider"===t?(null===r||void 0===r?void 0:r.name)||"":"galleryUrls"===t&&Array.isArray(r)?r.join("; "):JSON.stringify(r):"boolean"===typeof r?r?"Ja":"Nein":String(r)})))),r=[e.join(","),...t.map((e=>e.map((e=>'"'.concat(String(e).replace(/"/g,'""'),'"'))).join(",")))].join("\n"),s=new Blob([r],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(s),d=document.createElement("a");d.href=n,d.download="tours-export-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(n)}l(o("tours.export.success","Export erfolgreich"),"success"),r()}catch(a){var e,t;console.error("Fehler beim Exportieren:",a),l((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||o("tours.export.error","Fehler beim Exportieren"),"error")}finally{u(!1)}}else l(o("tours.export.noFieldsSelected","Bitte w\xe4hlen Sie mindestens ein Feld aus"),"error")},disabled:c||0===i.length,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,W.jsx)(k.A,{className:"h-4 w-4"}),c?o("common.exporting","Exportiere..."):o("common.export","Exportieren")]})]})]})})]}):null},xe=e=>{let{isOpen:t,onClose:r,booking:a,onLinked:o}=e;const{t:l}=(0,n.Bd)(),{showMessage:i}=(0,Y.A)(),[d,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(""),[x,g]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),[v,f]=(0,s.useState)(!1),[k,N]=(0,s.useState)([]);(0,s.useEffect)((()=>{t&&a&&(j(),w(),a.totalPrice&&g("string"===typeof a.totalPrice?parseFloat(a.totalPrice):a.totalPrice))}),[t,a]);const j=async()=>{try{f(!0);const e=await z.A.get(U.Sn.RESERVATION.BASE);if(e.data.success||Array.isArray(e.data)){const t=e.data.success?e.data.data:e.data;c(Array.isArray(t)?t:[])}}catch(e){console.error("Fehler beim Laden der Reservations:",e),i(l("errors.loadError"),"error")}finally{f(!1)}},w=async()=>{if(a)try{const e=await z.A.get(U.Sn.TOUR_RESERVATIONS.BY_BOOKING(a.id));e.data.success&&N(e.data.data||[])}catch(e){console.error("Fehler beim Laden der Verkn\xfcpfungen:",e)}};if(!t||!a)return null;const S=d.find((e=>e.id===Number(u))),C=null!==S&&void 0!==S&&S.amount?Number(S.amount):0,A=(Number(x)||0)+(Number(h)||0),T=A<=C&&A>0;return(0,W.jsxs)(M.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,W.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,W.jsxs)(M.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,W.jsxs)(M.lG.Title,{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[(0,W.jsx)(L.A,{className:"h-6 w-6"}),l("tours.reservationLink.title","Tour mit Reservation verkn\xfcpfen")]}),(0,W.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),a&&u&&x&&h){y(!0);try{const e=await z.A.post(U.Sn.TOUR_RESERVATIONS.BASE,{tourId:a.tourId,bookingId:a.id,reservationId:u,tourPrice:Number(x),accommodationPrice:Number(h),currency:a.currency||"COP"});e.data.success?(i(l("tours.reservationLink.success","Verkn\xfcpfung erfolgreich erstellt"),"success"),o(),r()):i(e.data.message||l("errors.saveError"),"error")}catch(n){var t,s;console.error("Fehler beim Erstellen der Verkn\xfcpfung:",n),i((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||l("errors.saveError"),"error")}finally{y(!1)}}else i(l("tours.reservationLink.fillAllFields","Bitte f\xfcllen Sie alle Felder aus"),"error")},className:"p-6 space-y-6",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[l("tours.reservationLink.reservation","Reservation")," *"]}),(0,W.jsxs)("select",{value:u,onChange:e=>{m(e.target.value?Number(e.target.value):"");const t=d.find((t=>t.id===Number(e.target.value)));if(null!==t&&void 0!==t&&t.amount){const e=Number(t.amount),r=Number(x)||0;p(e-r)}},required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",disabled:v,children:[(0,W.jsx)("option",{value:"",children:l("common.select","Ausw\xe4hlen")}),d.map((e=>(0,W.jsxs)("option",{value:e.id,children:[e.guestName," - ",e.checkInDate," bis ",e.checkOutDate," (",Number(e.amount||0).toLocaleString()," ",e.currency||"COP",")"]},e.id)))]}),S&&(0,W.jsxs)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:[l("tours.reservationLink.reservationAmount","Reservationsbetrag"),": ",C.toLocaleString()," ",S.currency||"COP"]})]}),(0,W.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[l("tours.reservationLink.tourPrice","Tour-Preis")," *"]}),(0,W.jsx)("input",{type:"number",value:x,onChange:e=>g(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[l("tours.reservationLink.accommodationPrice","Betten-Preis")," *"]}),(0,W.jsx)("input",{type:"number",value:h,onChange:e=>p(e.target.value?Number(e.target.value):""),min:"0",step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),S&&(0,W.jsx)("div",{className:"p-3 rounded-md ".concat(T?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"),children:(0,W.jsxs)("p",{className:"text-sm ".concat(T?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"),children:[l("tours.reservationLink.totalPrice","Gesamtpreis"),": ",A.toLocaleString()," ",a.currency||"COP",!T&&A>C&&(0,W.jsx)("span",{className:"block mt-1",children:l("tours.reservationLink.exceedsAmount","\xdcberschreitet Reservationsbetrag")})]})}),k.length>0&&(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("tours.reservationLink.existingLinks","Bestehende Verkn\xfcpfungen")}),(0,W.jsx)("div",{className:"space-y-2",children:k.map((e=>{var t;return(0,W.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("p",{className:"text-sm font-medium dark:text-white",children:(null===(t=e.reservation)||void 0===t?void 0:t.guestName)||"Reservation #".concat(e.reservationId)}),(0,W.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tour: ",Number(e.tourPrice||0).toLocaleString()," ",e.currency," | Betten: ",Number(e.accommodationPrice||0).toLocaleString()," ",e.currency]})]}),(0,W.jsx)("button",{type:"button",onClick:()=>(async e=>{if(window.confirm(l("tours.reservationLink.confirmDelete","M\xf6chten Sie diese Verkn\xfcpfung wirklich l\xf6schen?")))try{const t=await z.A.delete(U.Sn.TOUR_RESERVATIONS.BY_ID(e));t.data.success?(i(l("tours.reservationLink.deleted","Verkn\xfcpfung gel\xf6scht"),"success"),w(),o()):i(t.data.message||l("errors.deleteError"),"error")}catch(a){var t,r;console.error("Fehler beim L\xf6schen der Verkn\xfcpfung:",a),i((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("errors.deleteError"),"error")}})(e.id),className:"px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-md",children:l("common.delete","L\xf6schen")})]},e.id)}))})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:l("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:b||!T||!u,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:b?l("common.saving","Wird gespeichert..."):l("common.save","Speichern")})]})]})]})})]})},ge=e=>{let{isOpen:t,onClose:r,reservation:a,onSuccess:o}=e;const{t:l}=(0,n.Bd)(),{showMessage:i}=(0,Y.A)(),{openSidepane:d,closeSidepane:c}=(0,G.N)(),[u,m]=(0,s.useState)(window.innerWidth<640),[x,g]=(0,s.useState)(window.innerWidth>1070),[h,p]=(0,s.useState)(a.guestPhone||""),[b,y]=(0,s.useState)(a.guestEmail||""),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),[S,C]=(0,s.useState)("");(0,s.useEffect)((()=>{t&&!v&&f("Hola {{guestName}},\n\n\xa1Nos complace darte la bienvenida a La Familia Hostel!\n\nComo llegar\xe1s despu\xe9s de las 22:00, puedes realizar el check-in en l\xednea ahora:\n{{checkInLink}}\n\nPor favor, realiza el pago por adelantado:\n{{paymentLink}}\n\nPor favor, escr\xedbenos brevemente una vez que hayas completado tanto el check-in como el pago. \xa1Gracias!\n\n\xa1Te esperamos ma\xf1ana!")}),[t,a]),(0,s.useEffect)((()=>{if(v){const e=a.guestEmail||"";let t="[Check-in-Link wird generiert]";if(e){const r=a.lobbyReservationId||a.id.toString(),s="https://app.lobbypms.com/checkinonline/confirmar",n=new URLSearchParams;n.append("codigo",r),n.append("email",e),n.append("lg","GB"),t="".concat(s,"?").concat(n.toString())}const r=a.paymentLink||"[Zahlungslink wird erstellt]";let s=v.replace(/\{\{guestName\}\}/g,a.guestName).replace(/\{\{checkInLink\}\}/g,t).replace(/\{\{paymentLink\}\}/g,r);C(s)}}),[v,a.guestName,a.paymentLink,a.id,a.guestEmail]),(0,s.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),g(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!u?d():c(),()=>{c()})),[t,u,d,c]),(0,s.useEffect)((()=>{t||(p(a.guestPhone||""),y(a.guestEmail||""),f(""),w(null),C(""))}),[t,a]);const A=()=>{w(null),r()},T=async e=>{if(e.preventDefault(),w(null),h||b)try{N(!0),await ee.u.sendInvitation(a.id,{guestPhone:h||void 0,guestEmail:b||void 0,customMessage:v||void 0}),i(l("reservations.sendInvitation.success","Einladung erfolgreich versendet"),"success"),o(),A()}catch(s){var t,r;console.error("Fehler beim Versenden der Einladung:",s);const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("reservations.sendInvitation.error","Fehler beim Versenden der Einladung");w(e),i(e,"error")}finally{N(!1)}else w(l("reservations.sendInvitation.noContact","Bitte geben Sie mindestens eine Telefonnummer oder E-Mail-Adresse an."))},E=a.sentMessageAt;return u?(0,W.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto ".concat(t?"":"hidden"),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,W.jsxs)("div",{className:"flex min-h-screen items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:A}),(0,W.jsxs)("div",{className:"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("reservations.sendInvitation.title","Einladung senden")}),(0,W.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(100vh-200px)]",children:D()})]})]})}):(0,W.jsxs)(W.Fragment,{children:[t&&!x&&(0,W.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,W.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("reservations.sendInvitation.title","Einladung senden")}),(0,W.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:D()})]})]});function D(){return(0,W.jsxs)(W.Fragment,{children:[j&&(0,W.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:j}),E&&(0,W.jsxs)("div",{className:"mb-4 p-3 bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-200 rounded",children:[(0,W.jsxs)("p",{className:"text-sm",children:[l("reservations.sendInvitation.alreadySent","Bereits versendet am"),": ",new Date(a.sentMessageAt).toLocaleString()]}),(0,W.jsx)("p",{className:"text-xs mt-1",children:l("reservations.sendInvitation.canResend","Sie k\xf6nnen die Einladung erneut senden.")})]}),(0,W.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:l("reservations.sendInvitation.contactInfo","Kontaktinformationen")}),(0,W.jsxs)("div",{className:"space-y-3",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"guestPhone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.phone","Telefonnummer")}),(0,W.jsx)("input",{type:"tel",id:"guestPhone",value:h,onChange:e=>p(e.target.value),placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"guestEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.email","E-Mail")}),(0,W.jsx)("input",{type:"email",id:"guestEmail",value:b,onChange:e=>y(e.target.value),placeholder:"email@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:l("reservations.sendInvitation.message","Nachricht")}),(0,W.jsxs)("div",{className:"space-y-3",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"customMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.sendInvitation.messageLabel","Nachricht (editierbar)")}),(0,W.jsx)("textarea",{id:"customMessage",value:v,onChange:e=>f(e.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white font-mono text-xs",placeholder:"Hola {{guestName}},\n\n\xa1Nos complace darte la bienvenida a La Familia Hostel!\n\nComo llegar\xe1s despu\xe9s de las 22:00, puedes realizar el check-in en l\xednea ahora:\n{{checkInLink}}\n\nPor favor, realiza el pago por adelantado:\n{{paymentLink}}\n\nPor favor, escr\xedbenos brevemente una vez que hayas completado tanto el check-in como el pago. \xa1Gracias!\n\n\xa1Te esperamos ma\xf1ana!"}),(0,W.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("reservations.sendInvitation.messageVariables","Verf\xfcgbare Variablen: {{guestName}}, {{checkInLink}}, {{paymentLink}}")})]}),S&&(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.sendInvitation.preview","Vorschau")}),(0,W.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:S})]})]})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:A,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:l("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:k||!h&&!b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:k?l("reservations.sendInvitation.sending","Wird gesendet..."):l("reservations.sendInvitation.send","Senden")})]})]})]})}},he=e=>{let{isOpen:t,onClose:r,reservation:a,onSuccess:o}=e;const{t:l}=(0,n.Bd)(),{showMessage:i}=(0,Y.A)(),{openSidepane:d,closeSidepane:c}=(0,G.N)(),[u,m]=(0,s.useState)(window.innerWidth<640),[x,g]=(0,s.useState)(window.innerWidth>1070),[h,p]=(0,s.useState)(a.guestPhone||""),[b,y]=(0,s.useState)(a.guestEmail||""),[v,f]=(0,s.useState)(""),[k,N]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),[S,C]=(0,s.useState)("");(0,s.useEffect)((()=>{t&&!v&&f("Bienvenido,\n\nHola {{guestName}},\n\n\xa1Tu check-in se ha completado exitosamente! Informaci\xf3n de tu habitaci\xf3n: - Habitaci\xf3n: {{roomNumber}} - Descripci\xf3n: {{roomDescription}} Acceso: - PIN de la puerta: {{passcode}} - App: TTLock\n\n\xa1Te deseamos una estancia agradable!")}),[t,a]),(0,s.useEffect)((()=>{if(v){const e=a.doorPin||a.ttlLockPassword||"[Passcode wird generiert]",t=a.roomNumber||"[Zimmernummer]",r=a.roomDescription||"[Zimmerbeschreibung]";let s=v.replace(/\{\{guestName\}\}/g,a.guestName).replace(/\{\{passcode\}\}/g,e).replace(/\{\{roomNumber\}\}/g,t).replace(/\{\{roomDescription\}\}/g,r);C(s)}}),[v,a.guestName,a.doorPin,a.ttlLockPassword,a.roomNumber,a.roomDescription]),(0,s.useEffect)((()=>{const e=()=>{m(window.innerWidth<640),g(window.innerWidth>1070)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t&&!u?d():c(),()=>{c()})),[t,u,d,c]),(0,s.useEffect)((()=>{t||(p(a.guestPhone||""),y(a.guestEmail||""),f(""),w(null),C(""))}),[t,a]);const A=()=>{w(null),r()},T=async e=>{if(e.preventDefault(),w(null),h||b)try{N(!0),await ee.u.sendPasscode(a.id,{guestPhone:h||void 0,guestEmail:b||void 0,customMessage:v||void 0}),i(l("reservations.sendPasscode.success","Passcode erfolgreich versendet"),"success"),o(),A()}catch(s){var t,r;console.error("Fehler beim Versenden des Passcodes:",s);const e=(null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("reservations.sendPasscode.error","Fehler beim Versenden des Passcodes");w(e),i(e,"error")}finally{N(!1)}else w(l("reservations.sendPasscode.noContact","Bitte geben Sie mindestens eine Telefonnummer oder E-Mail-Adresse an."))};return u?(0,W.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto ".concat(t?"":"hidden"),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,W.jsxs)("div",{className:"flex min-h-screen items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[(0,W.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:A}),(0,W.jsxs)("div",{className:"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("reservations.sendPasscode.title","Passcode senden")}),(0,W.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(100vh-200px)]",children:E()})]})]})}):(0,W.jsxs)(W.Fragment,{children:[t&&!x&&(0,W.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,W.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,W.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,W.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("reservations.sendPasscode.title","Passcode senden")}),(0,W.jsx)("button",{onClick:A,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(q.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:E()})]})]});function E(){return(0,W.jsxs)(W.Fragment,{children:[j&&(0,W.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded",children:j}),(0,W.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:l("reservations.sendPasscode.contactInfo","Kontaktinformationen")}),(0,W.jsxs)("div",{className:"space-y-3",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"guestPhone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.phone","Telefonnummer")}),(0,W.jsx)("input",{type:"tel",id:"guestPhone",value:h,onChange:e=>p(e.target.value),placeholder:"+573001234567",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"guestEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.email","E-Mail")}),(0,W.jsx)("input",{type:"email",id:"guestEmail",value:b,onChange:e=>y(e.target.value),placeholder:"email@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:l("reservations.sendPasscode.message","Nachricht")}),(0,W.jsxs)("div",{className:"space-y-3",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{htmlFor:"customMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.sendPasscode.messageLabel","Nachricht (editierbar)")}),(0,W.jsx)("textarea",{id:"customMessage",value:v,onChange:e=>f(e.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white font-mono text-xs",placeholder:"Bienvenido,\n\nHola {{guestName}},\n\n\xa1Tu check-in se ha completado exitosamente! Informaci\xf3n de tu habitaci\xf3n: - Habitaci\xf3n: {{roomNumber}} - Descripci\xf3n: {{roomDescription}} Acceso: - PIN de la puerta: {{passcode}} - App: TTLock\n\n\xa1Te deseamos una estancia agradable!"}),(0,W.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("reservations.sendPasscode.messageVariables","Verf\xfcgbare Variablen: {{guestName}}, {{passcode}}, {{roomNumber}}, {{roomDescription}}")})]}),S&&(0,W.jsxs)("div",{children:[(0,W.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("reservations.sendPasscode.preview","Vorschau")}),(0,W.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:S})]})]})]}),(0,W.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700",children:[(0,W.jsx)("button",{type:"button",onClick:A,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:l("common.cancel","Abbrechen")}),(0,W.jsx)("button",{type:"submit",disabled:k||!h&&!b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:k?l("reservations.sendPasscode.sending","Wird gesendet..."):l("reservations.sendPasscode.send","Senden")})]})]})]})}};var pe=r(7935),be=r(1726),ye=r(9399),ve=r(8526),fe=r(7460),ke=r(7952),Ne=r(2395),je=r(8658);const we=()=>{const{t:e}=(0,n.Bd)(),[t,r]=(0,s.useState)(!1),[a,o]=(0,s.useState)(null),[i,d]=(0,s.useState)("00:00:00"),[c,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[g,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),{user:y}=(0,l.As)(),{isTracking:v,updateTrackingStatus:f,checkTrackingStatus:k}=(0,fe.S)(),{branches:N,selectedBranch:j,setSelectedBranch:w}=(0,ke.O)(),{organization:S}=(0,Ne.Z)(),C=(0,s.useMemo)((()=>!(!c||!S)&&((null!==c.organizationId||void 0!==S.id)&&c.organizationId!==S.id)),[c,S]);(0,s.useCallback)((async()=>{try{x(!0),b(null),console.log("Pr\xfcfe aktive Zeiterfassung..."),console.log("Benutzer geladen:",null===y||void 0===y?void 0:y.id);const n=localStorage.getItem("token");if(console.log("Token vorhanden:",n?"Ja":"Nein"),!n)return console.error("Kein Authentifizierungstoken gefunden"),b(e("worktime.tracker.notAuthenticated")),void x(!1);try{const e=await z.A.get(U.Sn.WORKTIME.ACTIVE);console.log("API-Antwort Status:",e.status);const t=e.data;if(console.log("Aktive Zeiterfassung Daten:",t),t&&!0===t.active){console.log("Aktive Zeiterfassung gefunden:",t.id);const e=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,a=new Date(e),s=(new Date).getTime()-a.getTime(),n=Math.floor(s/1e3),l=Math.floor(n/3600),i=Math.floor(n%3600/60),c=n%60;u(t),o(a),d("".concat(l.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),":").concat(c.toString().padStart(2,"0"))),r(!0),j!==t.branchId&&w(t.branchId),f(!0)}else console.log("Keine aktive Zeiterfassung vorhanden"),r(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(s){console.error("Fehler beim Abrufen der aktiven Zeiterfassung:",s);const r=s;var t,a;if("ERR_NETWORK"===r.code)b(e("worktime.tracker.connectionError"));else b("".concat(e("worktime.tracker.errorFetch"),": ").concat((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message))}}finally{x(!1)}}),[null===y||void 0===y?void 0:y.id,f,j,S]);(0,s.useEffect)((()=>{y?void 0!==v&&(r(v),x(!1)):x(!1)}),[y,v]),(0,s.useEffect)((()=>{let e;return t&&a&&(e=window.setInterval((()=>{const e=(new Date).getTime()-a.getTime(),t=Math.floor(e/1e3),r=Math.floor(t/3600),s=Math.floor(t%3600/60),n=t%60;d("".concat(r.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")))}),1e3)),()=>{e&&clearInterval(e)}}),[t,a]);const A=async()=>{if(j)try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));const a=(await z.A.post(U.Sn.WORKTIME.START,{branchId:j,startTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data,s=a.startTime.endsWith("Z")?a.startTime.substring(0,a.startTime.length-1):a.startTime,n=new Date(s);u(a),o(n),d("00:00:00"),r(!0),f(!0)}catch(a){console.error("Fehler:",a);let r=e("worktime.tracker.errorStart");var t;if(a.response)r=(null===(t=a.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(a.response.status,")");alert(r)}else alert(e("worktime.tracker.selectBranch"))},T=async()=>{try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await z.A.post(U.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});r(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(a){console.error("Fehler:",a);let r=e("worktime.tracker.errorStop");var t;if(a.response)r=(null===(t=a.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(a.response.status,")");alert(r)}},E=(0,s.useMemo)((()=>{var t;return c?(null===(t=N.find((e=>e.id===c.branchId)))||void 0===t?void 0:t.name)||e("worktime.tracker.unknown"):null}),[N,c]);return m?(0,W.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-6",children:(0,W.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})})}):(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 sm:mb-6",children:[(0,W.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,W.jsxs)("h2",{className:"text-xl font-semibold flex items-center dark:text-white",children:[(0,W.jsx)(O.A,{className:"h-6 w-6 mr-2"}),e("worktime.tracker.title")]})}),p&&(0,W.jsxs)("div",{className:"mb-4 p-2 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 border border-red-200 dark:border-red-700 rounded-md flex justify-between items-center",children:[(0,W.jsx)("span",{children:p}),p!==e("worktime.tracker.noActiveTracking")&&(0,W.jsxs)("button",{onClick:async()=>{if(window.confirm(e("worktime.tracker.forceStopConfirm")))try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await z.A.post(U.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),force:!0},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});r(!1),o(null),d("00:00:00"),u(null),b(null),alert(e("worktime.tracker.forceStopSuccess")),f(!1)}catch(a){var t;console.error("Fehler:",a),b("Fehler beim Stoppen: ".concat((null===(t=a.response)||void 0===t?void 0:t.status)||"Netzwerkfehler")),alert(e("worktime.tracker.forceStopError"))}},className:"text-sm bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-800 dark:hover:bg-red-700 dark:text-red-300 px-2 py-1 rounded-md",children:[e("worktime.tracker.stop")," ",e("common.force","Erzwingen")]})]}),t&&C&&(0,W.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 border border-yellow-200 dark:border-yellow-700 rounded-md flex items-start",children:[(0,W.jsx)(ye.A,{className:"h-5 w-5 mr-2 mt-0.5 flex-shrink-0"}),(0,W.jsxs)("div",{className:"flex-1",children:[(0,W.jsx)("p",{className:"font-medium",children:e("worktime.tracker.differentOrganizationWarning.title","Hinweis: Andere Organisation")}),(0,W.jsx)("p",{className:"text-sm mt-1",children:e("worktime.tracker.differentOrganizationWarning.message","Diese Zeiterfassung wurde in einer anderen Organisation gestartet. Sie wird nach dem Stoppen der Organisation zugeordnet, in der sie gestartet wurde.")})]})]}),(0,W.jsxs)("div",{className:"flex items-start justify-center mb-4",children:[(0,W.jsxs)("div",{className:"flex flex-col items-center",children:[(0,W.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,W.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:t,onChange:async()=>{t?await T():await A()},disabled:!j&&!t,"data-onboarding":t?"stop-worktime":"start-worktime"}),(0,W.jsx)("div",{className:"w-20 h-10 rounded-full \n                            ".concat(t?"bg-green-500 shadow-lg shadow-green-200 dark:shadow-green-900/20":"bg-gray-300 dark:bg-gray-600","\n                            before:content-[''] before:absolute before:top-0 before:left-0 before:bottom-0 before:right-0 \n                            peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-700\n                            peer-checked:after:translate-x-10\n                            after:content-[''] after:absolute after:top-1 after:left-1\n                            after:bg-white dark:after:bg-gray-200 after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full\n                            after:h-8 after:w-8 after:transition-all after:duration-300 ease-in-out\n                            transition-colors duration-300")})]}),(0,W.jsx)("span",{className:"mt-2 text-sm font-medium",children:t?(0,W.jsx)("span",{className:"text-green-600 dark:text-green-400 font-bold",children:e("worktime.tracker.running")}):(0,W.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:e("worktime.tracker.start")})})]}),(0,W.jsx)("button",{onClick:()=>{h(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-2 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-blue-700 shadow-sm flex items-center justify-center ml-8 mt-1",title:e("worktime.tracker.showTimes"),children:(0,W.jsx)(ve.A,{className:"h-6 w-6"})})]}),(0,W.jsx)("div",{className:"p-2 my-2 rounded-md text-sm ".concat(t&&c?"bg-green-50 dark:bg-green-900/20 dark:text-green-200":"bg-gray-50 dark:bg-gray-700 dark:text-gray-300"),children:t&&c?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("p",{children:[(0,W.jsx)("strong",{children:e("worktime.tracker.activeTracking")})," ",i]}),(0,W.jsxs)("p",{children:[(0,W.jsx)("strong",{children:e("worktime.tracker.started")})," ",(e=>{"string"===typeof e&&e.endsWith("Z")&&(e=e.substring(0,e.length-1));const t=new Date(e),r=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),n=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),l=t.getSeconds().toString().padStart(2,"0");return"".concat(r,".").concat(a,".").concat(s,", ").concat(n,":").concat(o,":").concat(l)})(a||Date.now())]}),(0,W.jsxs)("p",{children:[(0,W.jsxs)("strong",{children:[e("worktime.tracker.selectBranchLabel"),":"]})," ",E||e("worktime.tracker.unknown")]})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("p",{children:"\xa0"}),(0,W.jsx)("p",{children:"\xa0"}),(0,W.jsx)("p",{children:"\xa0"})]})}),g&&(0,W.jsx)(je.G,{isOpen:g,onClose:()=>{h(!1)}})]})};var Se=r(4426),Ce=r(7829),Ae=r(6400),Te=r(7488),Ee=r(6896),De=r(1052),Pe=r(1853),Ie=r(957),Le=r(637);const Re=["title","responsibleAndQualityControl","status","dueDate","branch","actions"],Oe="worktracker-todos",Fe="worktracker-reservations",Be="worktracker-tours",ze={title:"asc",status:"asc",responsible:"asc",qualityControl:"asc",branch:"asc",dueDate:"asc",description:"asc"},Me={guestName:"asc",status:"asc",paymentStatus:"asc",checkInDate:"desc",checkOutDate:"desc",roomNumber:"asc",branch:"asc",guestEmail:"asc",guestPhone:"asc",amount:"desc",arrivalTime:"desc"},qe={title:["title"],status:["status"],responsibleAndQualityControl:["responsible","qualityControl"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},_e={title:"title",status:"status",responsible:"responsibleAndQualityControl",qualityControl:"responsibleAndQualityControl",branch:"branch",dueDate:"dueDate",description:"description"},Ue={guestName:["guestName"],status:["status"],paymentStatus:["paymentStatus"],checkInDate:["checkInDate"],checkOutDate:["checkOutDate"],roomNumber:["roomNumber"],branch:["branch"],guestEmail:["guestEmail"],guestPhone:["guestPhone"],amount:["amount"],arrivalTime:["arrivalTime"],actions:[]},We={guestName:"guestName",status:"status",paymentStatus:"paymentStatus",checkInDate:"checkInDate",checkOutDate:"checkOutDate",roomNumber:"roomNumber",branch:"branch",guestEmail:"guestEmail",guestPhone:"guestPhone",amount:"amount",arrivalTime:"arrivalTime"},Ve=()=>{const{t:e}=(0,n.Bd)(),{user:t}=(0,l.As)(),{hasPermission:r,permissions:M}=(0,i.S)(),q=(0,o.zy)(),_=(0,o.Zp)(),{showMessage:V}=(0,Y.A)(),G=(0,s.useMemo)((()=>[{id:"title",label:e("tasks.columns.title"),shortLabel:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status"),shortLabel:e("tasks.columns.status")},{id:"responsibleAndQualityControl",label:e("tasks.columns.responsibleAndQualityControl"),shortLabel:e("tasks.columns.responsibleAndQualityControl").split("/")[0]},{id:"branch",label:e("tasks.columns.branch"),shortLabel:e("tasks.columns.branch").substring(0,5)},{id:"dueDate",label:e("tasks.columns.dueDate"),shortLabel:e("tasks.columns.dueDate").substring(0,5)},{id:"actions",label:e("tasks.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),K=(0,s.useMemo)((()=>[{id:"responsible",label:e("tasks.columns.responsible"),shortLabel:e("tasks.columns.responsible").substring(0,3)},{id:"qualityControl",label:e("tasks.columns.qualityControl"),shortLabel:e("tasks.columns.qualityControl").substring(0,2)}]),[e]),Z=(0,s.useMemo)((()=>[{id:"guestName",label:e("reservations.columns.guestName","Gast"),shortLabel:e("reservations.columns.guestName","Gast").substring(0,4)},{id:"status",label:e("reservations.columns.status","Status"),shortLabel:e("reservations.columns.status","Status").substring(0,3)},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus"),shortLabel:e("reservations.columns.paymentStatus","Zahlungsstatus").substring(0,3)},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in"),shortLabel:e("reservations.columns.checkInDate","Check-in").substring(0,5)},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out"),shortLabel:e("reservations.columns.checkOutDate","Check-out").substring(0,5)},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer"),shortLabel:e("reservations.columns.roomNumber","Zimmer").substring(0,3)},{id:"branch",label:e("reservations.columns.branch","Niederlassung"),shortLabel:e("reservations.columns.branch","Niederlassung").substring(0,5)},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail"),shortLabel:e("reservations.columns.guestEmail","E-Mail").substring(0,3)},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon"),shortLabel:e("reservations.columns.guestPhone","Telefon").substring(0,3)},{id:"amount",label:e("reservations.columns.amount","Betrag"),shortLabel:e("reservations.columns.amount","Betrag").substring(0,3)},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit"),shortLabel:e("reservations.columns.arrivalTime","Ankunftszeit").substring(0,3)},{id:"actions",label:e("reservations.columns.actions","Aktionen"),shortLabel:e("common.actions").substring(0,3)}]),[e]),Q=(0,s.useMemo)((()=>[{id:"onlineCheckInCompleted",label:e("reservations.columns.onlineCheckInCompleted","Online Check-in"),shortLabel:e("reservations.columns.onlineCheckInCompleted","Online Check-in").substring(0,3)},{id:"doorPin",label:e("reservations.columns.doorPin","T\xfcr-PIN"),shortLabel:e("reservations.columns.doorPin","T\xfcr-PIN").substring(0,3)}]),[e]),$=(0,s.useMemo)((()=>[{id:"title",label:e("tours.columns.title","Titel"),shortLabel:e("tours.columns.title","Titel").substring(0,4)},{id:"type",label:e("tours.columns.type","Typ"),shortLabel:e("tours.columns.type","Typ").substring(0,3)},{id:"price",label:e("tours.columns.price","Preis"),shortLabel:e("tours.columns.price","Preis").substring(0,3)},{id:"location",label:e("tours.columns.location","Ort"),shortLabel:e("tours.columns.location","Ort").substring(0,3)},{id:"duration",label:e("tours.columns.duration","Dauer"),shortLabel:e("tours.columns.duration","Dauer").substring(0,3)},{id:"branch",label:e("tours.columns.branch","Niederlassung"),shortLabel:e("tours.columns.branch","Niederlassung").substring(0,5)},{id:"createdBy",label:e("tours.columns.createdBy","Erstellt von"),shortLabel:e("tours.columns.createdBy","Erstellt von").substring(0,5)},{id:"isActive",label:e("tours.columns.status","Status"),shortLabel:e("tours.columns.status","Status").substring(0,3)},{id:"actions",label:e("tours.columns.actions","Aktionen"),shortLabel:e("common.actions").substring(0,3)}]),[e]),[X,ee]=((0,s.useMemo)((()=>[{id:"description",label:e("tours.columns.description","Beschreibung"),shortLabel:e("tours.columns.description","Beschreibung").substring(0,3)},{id:"maxParticipants",label:e("tours.columns.maxParticipants","Max. Teilnehmer"),shortLabel:e("tours.columns.maxParticipants","Max. Teilnehmer").substring(0,3)},{id:"minParticipants",label:e("tours.columns.minParticipants","Min. Teilnehmer"),shortLabel:e("tours.columns.minParticipants","Min. Teilnehmer").substring(0,3)}]),[e]),(0,s.useState)("todos")),[ae,oe]=(0,s.useState)([]),[le,ye]=(0,s.useState)([]),[ve,fe]=(0,s.useState)(!0),[ke,Ne]=(0,s.useState)(null),[je,Ve]=(0,s.useState)(""),[Ge,Ke]=(0,s.useState)("all"),[He,Ze]=(0,s.useState)([]),[Ye,Qe]=(0,s.useState)(!1),[$e,Xe]=(0,s.useState)(null),[Je,et]=(0,s.useState)(""),[tt,rt]=(0,s.useState)("all"),[at,st]=(0,s.useState)("all"),[nt,ot]=(0,s.useState)([]),[lt,it]=(0,s.useState)([]),[dt,ct]=(0,s.useState)(!1),[ut,mt]=(0,s.useState)(null),[xt,gt]=(0,s.useState)(""),[ht,pt]=(0,s.useState)([]),[bt,yt]=(0,s.useState)([]),[vt,ft]=(0,s.useState)([]),[kt,Nt]=(0,s.useState)(e("tours.filters.current","Aktuell")),[jt,wt]=(0,s.useState)(null),[St,Ct]=(0,s.useState)(!1),[At,Tt]=(0,s.useState)(!1),[Et,Dt]=(0,s.useState)(!1),[Pt,It]=(0,s.useState)(!1),[Lt,Rt]=(0,s.useState)(!1),[Ot,Ft]=(0,s.useState)(null),[Bt,zt]=(0,s.useState)(null),[Mt,qt]=(0,s.useState)(!1),[_t,Ut]=(0,s.useState)(!1),[Wt,Vt]=(0,s.useState)(null),[Gt,Kt]=(0,s.useState)(null),[Ht,Zt]=(0,s.useState)(!1),[Yt,Qt]=(0,s.useState)(null),[$t,Xt]=(0,s.useState)(!1),[Jt,er]=(0,s.useState)([]),[tr,rr]=(0,s.useState)([]),[ar,sr]=(0,s.useState)(!1),[nr,or]=(0,s.useState)(null),[lr,ir]=(0,s.useState)(""),[dr,cr]=(0,s.useState)(null),[ur,mr]=(0,s.useState)(!1),[xr,gr]=(0,s.useState)([]),[hr,pr]=(0,s.useState)([]),[br,yr]=(0,s.useState)([]),[vr,fr]=(0,s.useState)(""),[kr,Nr]=(0,s.useState)(null),[jr,wr]=(0,s.useState)([]),[Sr,Cr]=(0,s.useState)([]),[Ar,Tr]=(0,s.useState)([]),[Er,Dr]=(0,s.useState)(""),[Pr,Ir]=(0,s.useState)(null),[Lr,Rr]=(0,s.useState)(!1),[Or,Fr]=(0,s.useState)({key:"dueDate",direction:"asc"}),[Br,zr]=(0,s.useState)({key:"checkInDate",direction:"desc"}),[Mr,qr]=(0,s.useState)({key:"title",direction:"asc"}),[_r,Ur]=(0,s.useState)(!1),[Wr,Vr]=(0,s.useState)(!1),[Gr,Kr]=(0,s.useState)(null),[Hr,Zr]=(0,s.useState)(null),{settings:Yr,isLoading:Qr,updateColumnOrder:$r,updateHiddenColumns:Xr,toggleColumnVisibility:Jr,isColumnVisible:ea,updateViewMode:ta}=(0,d.F)("worktracker_tasks",{defaultColumnOrder:Re,defaultHiddenColumns:[],defaultViewMode:"cards"}),ra=["guestName","status","paymentStatus","checkInDate","checkOutDate","roomNumber","branch","actions"],{settings:aa,isLoading:sa,updateColumnOrder:na,updateHiddenColumns:oa,toggleColumnVisibility:la,isColumnVisible:ia,updateViewMode:da}=(0,d.F)("worktracker-reservations",{defaultColumnOrder:ra,defaultHiddenColumns:[],defaultViewMode:"cards"}),ca=["title","type","price","location","duration","branch","isActive","actions"],{settings:ua,isLoading:ma,updateColumnOrder:xa,updateHiddenColumns:ga,toggleColumnVisibility:ha,isColumnVisible:pa,updateViewMode:ba}=(0,d.F)("worktracker-tours",{defaultColumnOrder:ca,defaultHiddenColumns:[],defaultViewMode:"cards"}),ya="todos"===X?Yr:"reservations"===X?aa:ua,va="todos"===X?$r:"reservations"===X?na:xa,fa="todos"===X?Jr:"reservations"===X?la:ha,ka="todos"===X?ea:"reservations"===X?ia:pa,Na="todos"===X?ta:"reservations"===X?da:ba,[ja,wa]=(0,s.useState)(null),[Sa,Ca]=(0,s.useState)(null),[Aa,Ta]=(0,s.useState)(10),[Ea,Da]=(0,s.useState)(new Set),Pa=ya.viewMode||"cards",Ia=(0,s.useMemo)((()=>"todos"===X?(e=>{const t=[];return e.forEach((e=>{const r=qe[e];r&&r.length>0&&t.push(...r)})),t.includes("description")||t.push("description"),t})(ya.columnOrder||Re):(e=>{const t=[];return e.forEach((e=>{const r=Ue[e];r&&r.length>0&&t.push(...r)})),t})(ya.columnOrder||ra)),[ya.columnOrder,X]),La=(0,s.useMemo)((()=>"todos"===X?(e=>{const t=new Set;return e.forEach((e=>{(qe[e]||[]).forEach((e=>t.add(e)))})),t})(ya.hiddenColumns||[]):(e=>{const t=new Set;return e.forEach((e=>{(Ue[e]||[]).forEach((e=>t.add(e)))})),t})(ya.hiddenColumns||[])),[ya.hiddenColumns,X]),Ra=(0,s.useMemo)((()=>new Set(Ia.filter((e=>!La.has(e))))),[Ia,La]),[Oa,Fa]=(0,s.useState)((()=>ze)),Ba=(e,t)=>{Fa((r=>(0,a.A)((0,a.A)({},r),{},{[e]:t})))},[za,Ma]=(0,s.useState)((()=>Me)),qa=(e,t)=>{Ma((r=>(0,a.A)((0,a.A)({},r),{},{[e]:t})))},_a={title:"asc",type:"asc",price:"asc",location:"asc",duration:"asc",branch:"asc",createdBy:"asc",isActive:"asc"},[Ua,Wa]=(0,s.useState)((()=>_a)),Va=e=>{Da((t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r}))};(0,s.useEffect)((()=>{document.querySelectorAll(".dashboard-tasks-wrapper").forEach((e=>{"cards"===Pa?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[Pa]);const Ga=(0,s.useRef)(!1),Ka=async function(t,r){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{s||fe(!0);const e={};t?e.filterId=t:r&&r.length>0&&(e.filterConditions=JSON.stringify({conditions:r,operators:Sr}));const n=await z.A.get(U.Sn.TASKS.BASE,{params:e}),o=n.data.filter((e=>null!=e)).map((e=>{const t=(e.attachments||[]).filter((e=>null!=e)).map((t=>({id:t.id,fileName:t.fileName,fileType:t.fileType,fileSize:t.fileSize,filePath:t.filePath,uploadedAt:t.uploadedAt,url:(0,U._y)(e.id,t.id)})));return(0,a.A)((0,a.A)({},e),{},{attachments:t})}));s?(console.log("\ud83d\udccb Alle Tasks im Hintergrund geladen:",o.length,"Tasks"),ye(o)):(console.log("\ud83d\udccb Tasks geladen:",o.length,"Tasks"),oe(o)),Ne(null)}catch(ke){console.error("Fehler beim Laden der Tasks:",ke),s||Ne(e("worktime.messages.tasksLoadError"))}finally{s||fe(!1)}},Ha=async()=>{try{var t;Qe(!0),Xe(null);const e=await z.A.get(U.Sn.RESERVATION.BASE),r=(null===(t=e.data)||void 0===t?void 0:t.data)||e.data||[];console.log("\ud83d\udccb Reservations geladen:",r.length,"Reservations"),Ze(r)}catch(s){var r,a;console.error("Fehler beim Laden der Reservations:",s);const t=(null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||e("reservations.loadError","Fehler beim Laden der Reservations");Xe(t),V(t,"error")}finally{Qe(!1)}};(0,s.useEffect)((()=>{"reservations"===X&&r("reservations","read","table")&&Ha()}),[X]);const Za=async function(t,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{a||(ct(!0),mt(null));const s={};t?s.filterId=t:r&&r.length>0&&(s.filterConditions=JSON.stringify({conditions:r,operators:bt}));const n=await z.A.get(U.Sn.TOURS.BASE,{params:s});if(n.data.success){const e=n.data.data||[];it(e),a||ot(e)}else{const t=n.data.message||e("errors.loadError");a||(mt(t),V(t,"error"))}}catch(o){var s,n;console.error("Fehler beim Laden der Touren:",o);const t=(null===(s=o.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||e("errors.loadError");a||(mt(t),V(t,"error"))}finally{a||ct(!1)}};(0,s.useEffect)((()=>{"tours"===X&&r("tours","read","table")&&Za()}),[X]);const Ya=async()=>{try{var t;sr(!0),or(null);const e=await z.A.get(U.Sn.TOUR_BOOKINGS.BASE),r=(null===(t=e.data)||void 0===t?void 0:t.data)||e.data||[];console.log("\ud83d\udccb Tour-Buchungen geladen:",r.length,"Buchungen"),er(r),rr(r)}catch(s){var r,a;console.error("Fehler beim Laden der Tour-Buchungen:",s);const t=(null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||e("tourBookings.loadError","Fehler beim Laden der Tour-Buchungen");or(t),V(t,"error")}finally{sr(!1)}};(0,s.useEffect)((()=>{"tourBookings"===X&&r("tour_bookings","read","table")&&Ya()}),[X]);const Qa=(e,t,r)=>{pt(e),yt(t),ft(r),Za(void 0,e,!1)},$a=()=>{pt([]),yt([]),ft([]),Nt(e("tours.filters.current","Aktuell")),wt(null),Za()},Xa=(e,t)=>{wt(e),Nt(t),e?Za(e):$a()};(0,s.useEffect)((()=>{Ga.current||(Ga.current=!0,Ka())}),[]),(0,s.useEffect)((()=>{if(ae.length>0){const e=new URLSearchParams(q.search).get("editTask");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=ae.find((e=>e.id===t));e&&(Kr(e),Vr(!0))}}}}),[ae,q.search]),(0,s.useEffect)((()=>{(async()=>{try{const t=await z.A.get(U.Sn.SAVED_FILTERS.BY_TABLE(Oe)),r=t.data.find((e=>"Aktuell"===e.name));if(r){Dr(e("tasks.filters.current")),Ir(r.id);let t=r.sortDirections||[];Array.isArray(t)&&t.length>0||t&&"object"===typeof t&&!Array.isArray(t)&&(t=Object.entries(t).map(((e,t)=>{let[r,a]=e;return{column:r,direction:a,priority:t+1,conditionIndex:jr.findIndex((e=>e.column===r))}}))),os(r.conditions,r.operators,t),await Ka(r.id),setTimeout((()=>{Ka(void 0,void 0,!0)}),2e3)}else await Ka()}catch(ke){console.error("Fehler beim Setzen des initialen Filters:",ke),await Ka()}})()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("Nicht authentifiziert");const t=(await z.A.get("".concat(U.Sn.SAVED_FILTERS.BY_TABLE(Oe)),{headers:{Authorization:"Bearer ".concat(e)}})).data||[],r=t.some((e=>"Archiv"===e.name)),a=t.some((e=>"Aktuell"===e.name));if(!r){const t={tableId:Oe,name:"Archiv",conditions:[{column:"status",operator:"equals",value:"done"}],operators:[]};await z.A.post("".concat(U.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e)}})}if(!a){const t={tableId:Oe,name:"Aktuell",conditions:[{column:"status",operator:"notEquals",value:"done"}],operators:[]};await z.A.post("".concat(U.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e)}})}}catch(ke){console.error("Fehler beim Erstellen der Standard-Filter:",ke)}})()}),[]);const Ja=async(t,r)=>{try{oe((e=>e.filter((e=>null!=e)).map((e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{status:r}):e)))),await z.A.patch(U.Sn.TASKS.BY_ID(t),{status:r}),Te.oR.success(e("worktime.messages.taskUpdated"))}catch(ke){console.error("Fehler beim Aktualisieren des Status:",ke),Ka(),Te.oR.error(e("worktime.messages.taskUpdatedError"))}},es=e=>{return e.responsible?e.responsible.id===(null===t||void 0===t?void 0:t.id):e.role&&(null===t||void 0===t||null===(r=t.roles)||void 0===r?void 0:r.some((t=>{var r,a;return(null===(r=t.role)||void 0===r?void 0:r.id)===(null===(a=e.role)||void 0===a?void 0:a.id)})))||!1;var r},ts=e=>{var r;return(null===(r=e.qualityControl)||void 0===r?void 0:r.id)===(null===t||void 0===t?void 0:t.id)},rs=e=>{"table"===Pa&&Fr((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},as=e=>{"table"===Pa&&"reservations"===X&&zr((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},ss=t=>{const a=[];return r("tasks","write","table")?("in_progress"===t.status&&es(t)?a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"open"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,W.jsx)(u.A,{className:"h-5 w-5"})},"back"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToOpen")})]})):"quality_control"===t.status&&es(t)?a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"in_progress"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,W.jsx)(u.A,{className:"h-5 w-5"})},"back"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToInProgress")})]})):"done"===t.status&&ts(t)&&a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"quality_control"),className:"p-2 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,W.jsx)(u.A,{className:"h-6 w-6"})},"back"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.backToQualityControl")})]})),"open"===t.status&&es(t)?a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"in_progress"),className:"p-1.5 bg-blue-600 dark:bg-blue-500 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-600",children:(0,W.jsx)(m.A,{className:"h-5 w-5"})},"forward"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.setInProgress")})]})):"in_progress"===t.status&&es(t)?a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"quality_control"),className:"p-1.5 bg-purple-600 dark:bg-purple-500 text-white rounded hover:bg-purple-700 dark:hover:bg-purple-600",children:(0,W.jsx)(m.A,{className:"h-5 w-5"})},"forward"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.setQualityControl")})]})):"quality_control"===t.status&&ts(t)&&a.push((0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ja(t.id,"done"),className:"p-1.5 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",children:(0,W.jsx)(m.A,{className:"h-5 w-5"})},"forward"),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.markDone")})]})),a):a},ns=()=>"todos"===X?jr.length:"reservations"===X?xr.length:"tours"===X?ht.length:0,os=(e,t,r)=>{if(wr(e),Cr(t),void 0!==r){const e=Array.isArray(r)?r:[];Tr(e)}},ls=()=>{wr([]),Cr([]),Tr([]),Dr(""),Ir(null)},is=(e,t,r)=>{if(gr(e),pr(t),void 0!==r){const e=Array.isArray(r)?r:[];yr(e)}},ds=()=>{gr([]),pr([]),yr([]),fr(""),Nr(null)},cs=async(e,t,r,a,s)=>{"todos"===X?(Dr(e),Ir(t),os(r,a,s),Fr({key:"dueDate",direction:"asc"}),t&&await Ka(t)):"reservations"===X?(fr(e),Nr(t),is(r,a,s),zr({key:"checkInDate",direction:"desc"})):"tours"===X&&(Nt(e),wt(t),Qa(r,a,s||[]),qr({key:"title",direction:"asc"}),t&&await Za(t))},us=async(e,t,r,a,s)=>{fr(e),Nr(t),is(r,a,s),zr({key:"checkInDate",direction:"desc"})},ms=e=>{switch(e){case"open":return 1;case"in_progress":return 2;case"improval":return 3;case"quality_control":return 4;case"done":return 5;default:return 99}},xs=e=>{switch(e){case be.X.CONFIRMED:return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200";case be.X.NOTIFICATION_SENT:return"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200";case be.X.CHECKED_IN:return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case be.X.CHECKED_OUT:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";case be.X.CANCELLED:return"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200";case be.X.NO_SHOW:return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},gs=e=>{switch(e){case be.d.PAID:return"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";case be.d.PARTIALLY_PAID:return"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";case be.d.REFUNDED:return"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200";case be.d.PENDING:default:return"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200"}},hs=(0,s.useMemo)((()=>{const e=le.length>0&&!Pr?le:ae;console.log("\ud83d\udd04 Filtere Tasks:",e.length,"Tasks vorhanden"),console.log("\ud83d\udd04 Filterbedingungen:",jr),console.log("\ud83d\udd04 Verwende:",le.length>0&&!Pr?"allTasks (client-seitig)":"tasks (server-seitig gefiltert)");const t=e.filter((e=>null!=e)).filter((e=>{if(je){const t=je.toLowerCase();if(!(e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||!!e.responsible&&"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)||!!e.role&&e.role.name.toLowerCase().includes(t)||e.qualityControl&&"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)))return!1}if(jr.length>0){const t={title:(e,t)=>{const r=(t.value||"").toLowerCase();if(!e.title||"string"!==typeof e.title)return console.error("title evaluator: task.title ist undefined oder kein String",{task:e,cond:t}),null;const a=e.title.toLowerCase();return a&&"string"===typeof a?"equals"===t.operator?e.title===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?void 0===a||null===a?(console.error("title evaluator: title ist undefined/null vor endsWith",{task:e,cond:t,title:a,value:r}),!1):a.endsWith(r):null:(console.error("title evaluator: title nach toLowerCase() ist undefined oder kein String",{task:e,cond:t,title:a}),null)},status:(e,t)=>"equals"===t.operator?e.status===t.value:"notEquals"===t.operator?e.status!==t.value:null,responsible:(e,t)=>{var r,a;const s=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):e.role?e.role.name:"";return(0,Ae.Ac)((null===(r=e.responsible)||void 0===r?void 0:r.id)||null,(null===(a=e.role)||void 0===a?void 0:a.id)||null,t,s)},qualityControl:(e,t)=>{var r;const a=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"";return(0,Ae.Ac)((null===(r=e.qualityControl)||void 0===r?void 0:r.id)||null,null,t,a)},responsibleAndQualityControl:(e,t)=>{var r,a,s;const n=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):e.role?e.role.name:"",o=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"";return(0,Ae.hw)((null===(r=e.responsible)||void 0===r?void 0:r.id)||null,(null===(a=e.role)||void 0===a?void 0:a.id)||null,(null===(s=e.qualityControl)||void 0===s?void 0:s.id)||null,t,n,o)},branch:(e,t)=>{const r=e.branch.name.toLowerCase(),a=(t.value||"").toLowerCase();return"equals"===t.operator?r===a:"contains"===t.operator?r.includes(a):null},dueDate:(e,t)=>(0,Ae.J1)(e.dueDate,t)},r=(e,t)=>{switch(t){case"title":return e.title;case"status":return e.status;case"responsible":case"responsibleAndQualityControl":return e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):e.role?e.role.name:"";case"qualityControl":return e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"";case"branch":return e.branch.name;case"dueDate":return e.dueDate;default:return e[t]}};if(0===(0,Ae.W5)([e],jr,Sr,r,t).length)return!1}return!0}));console.log("\u2705 Gefilterte Tasks:",t.length,"von",ae.length);const r=(e,t)=>{switch(t){case"title":return e.title.toLowerCase();case"status":return ms(e.status);case"responsible":case"responsibleAndQualityControl":return e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?"Rolle: ".concat(e.role.name).toLowerCase():"";case"qualityControl":return e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"";case"branch":return e.branch.name.toLowerCase();case"dueDate":return e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER;case"description":return(e.description||"").toLowerCase();default:return""}},a=t.sort(((e,t)=>{if("table"===Pa&&Or.key){const a=r(e,Or.key),s=r(t,Or.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Or.direction?n:-n}if(Ar.length>0&&jr.length>0){const a=[...Ar].sort(((e,t)=>e.priority-t.priority));for(const s of a){const a=r(e,s.column),n=r(t,s.column);let o=0;if(o="number"===typeof a&&"number"===typeof n?a-n:String(a).localeCompare(String(n)),"desc"===s.direction&&(o=-o),0!==o)return o}return 0}if("cards"===Pa&&0===jr.length){const a=Ia.filter((e=>Ra.has(e)));for(const s of a){const a=Oa[s]||"asc",n=r(e,s),o=r(t,s);let l=0;if(l="number"===typeof n&&"number"===typeof o?n-o:String(n).localeCompare(String(o)),"desc"===a&&(l=-l),0!==l)return l}return 0}if("table"===Pa&&0===jr.length&&Or.key){const a=r(e,Or.key),s=r(t,Or.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Or.direction?n:-n}const a=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,s=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;if(a!==s)return a-s;const n=ms(e.status),o=ms(t.status);return n!==o?n-o:e.title.localeCompare(t.title)}));return console.log("\u2705 Gefilterte und sortierte Tasks:",a.length),a}),[ae,le,Pr,je,Or,ms,jr,Sr,Ar,Pa,Ia,Ra,Oa]),ps=(0,s.useMemo)((()=>{console.log("\ud83d\udd04 Filtere Reservations:",He.length,"Reservations vorhanden");const e=He.filter((e=>null!=e));let t=e.filter((e=>{if("all"!==tt&&e.status!==tt)return!1;if("all"!==at&&e.paymentStatus!==at)return!1;if(Je){const t=Je.toLowerCase();if(!(e.guestName&&e.guestName.toLowerCase().includes(t)||e.guestEmail&&e.guestEmail.toLowerCase().includes(t)||e.guestPhone&&e.guestPhone.toLowerCase().includes(t)||e.roomNumber&&e.roomNumber.toLowerCase().includes(t)||e.lobbyReservationId&&e.lobbyReservationId.toLowerCase().includes(t)))return!1}return!0}));if(xr.length>0){const e={guestName:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.guestName||"").toLowerCase();return"equals"===t.operator?e.guestName===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},status:(e,t)=>"equals"===t.operator?e.status===t.value:"notEquals"===t.operator?e.status!==t.value:null,paymentStatus:(e,t)=>"equals"===t.operator?e.paymentStatus===t.value:"notEquals"===t.operator?e.paymentStatus!==t.value:null,checkInDate:(e,t)=>(0,Ae.J1)(e.checkInDate,t),checkOutDate:(e,t)=>(0,Ae.J1)(e.checkOutDate,t),arrivalTime:(e,t)=>(0,Ae.J1)(e.arrivalTime,t),amount:(e,t)=>{const r="string"===typeof e.amount?parseFloat(e.amount):e.amount||0,a=parseFloat(String(t.value));return!isNaN(a)&&("equals"===t.operator?Math.abs(r-a)<.01:"greaterThan"===t.operator?r>a:"lessThan"===t.operator?r<a:null)},roomNumber:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.roomNumber||"").toLowerCase();return"equals"===t.operator?e.roomNumber===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},guestEmail:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.guestEmail||"").toLowerCase();return"equals"===t.operator?e.guestEmail===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},guestPhone:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.guestPhone||"").toLowerCase();return"equals"===t.operator?e.guestPhone===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},branch:(e,t)=>{var r;const a=((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase(),s=(t.value||"").toLowerCase();return"equals"===t.operator?a===s:"contains"===t.operator?a.includes(s):null},doorPin:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.doorPin||"").toLowerCase();return"equals"===t.operator?e.doorPin===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},onlineCheckInCompleted:(e,t)=>{const r="true"===t.value||!0===t.value||"1"===t.value;return"equals"===t.operator?e.onlineCheckInCompleted===r:"notEquals"===t.operator?e.onlineCheckInCompleted!==r:null}},r=(e,t)=>{var r;switch(t){case"guestName":return e.guestName||"";case"status":return e.status||"";case"paymentStatus":return e.paymentStatus||"";case"roomNumber":return e.roomNumber||"";case"branch":return(null===(r=e.branch)||void 0===r?void 0:r.name)||"";case"guestEmail":return e.guestEmail||"";case"guestPhone":return e.guestPhone||"";case"lobbyReservationId":return e.lobbyReservationId||"";case"checkInDate":return e.checkInDate;case"checkOutDate":return e.checkOutDate;case"amount":return e.amount;case"arrivalTime":return e.arrivalTime;case"doorPin":return e.doorPin||"";case"onlineCheckInCompleted":return e.onlineCheckInCompleted;default:{const r=e[t];return null==r?"":"string"===typeof r?r:String(r)}}};t=(0,Ae.W5)(t,xr,hr,r,e)}const r=(e,t)=>{var r;switch(t){case"guestName":return(e.guestName||"").toLowerCase();case"status":return e.status.toLowerCase();case"paymentStatus":return e.paymentStatus.toLowerCase();case"checkInDate":return e.checkInDate?new Date(e.checkInDate).getTime():0;case"checkOutDate":return e.checkOutDate?new Date(e.checkOutDate).getTime():0;case"roomNumber":return(e.roomNumber||"").toLowerCase();case"branch":case"branch.name":return((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase();case"guestEmail":return(e.guestEmail||"").toLowerCase();case"guestPhone":return(e.guestPhone||"").toLowerCase();case"amount":return"string"===typeof e.amount?parseFloat(e.amount):e.amount||0;case"arrivalTime":return e.arrivalTime?new Date(e.arrivalTime).getTime():0;default:return""}},a=t.sort(((e,t)=>{if("table"===Pa&&Br.key){const a=r(e,Br.key),s=r(t,Br.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Br.direction?n:-n}if(br.length>0&&xr.length>0){const a=[...br].sort(((e,t)=>e.priority-t.priority));for(const s of a){const a=r(e,s.column),n=r(t,s.column);let o=0;if(o="number"===typeof a&&"number"===typeof n?a-n:String(a).localeCompare(String(n)),"desc"===s.direction&&(o=-o),0!==o)return o}return 0}if("cards"===Pa&&0===xr.length){const a=Ia.filter((e=>Ra.has(e)));for(const s of a){const a=za[s]||"asc",n=r(e,s),o=r(t,s);let l=0;if(l="number"===typeof n&&"number"===typeof o?n-o:String(n).localeCompare(String(o)),"desc"===a&&(l=-l),0!==l)return l}return 0}if("table"===Pa&&0===xr.length&&Br.key){const a=r(e,Br.key),s=r(t,Br.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Br.direction?n:-n}return new Date(t.checkInDate).getTime()-new Date(e.checkInDate).getTime()}));return console.log("\u2705 Gefilterte und sortierte Reservations:",a.length),a}),[He,tt,at,Je,xr,hr,br,Pa,Ia,Ra,za,Br]),bs=(0,s.useMemo)((()=>{console.log("\ud83d\udd04 Filtere Tours:",nt.length,"Tours vorhanden");let e=nt.filter((e=>null!=e)).filter((e=>{if(xt){const t=xt.toLowerCase();if(!(e.title&&e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.location&&e.location.toLowerCase().includes(t)))return!1}return!0}));if(ht.length>0){const t={title:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.title||"").toLowerCase();return"equals"===t.operator?e.title===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},type:(e,t)=>"equals"===t.operator?e.type===t.value:"notEquals"===t.operator?e.type!==t.value:null,isActive:(e,t)=>{const r="true"===t.value||!0===t.value||"1"===t.value;return"equals"===t.operator?e.isActive===r:"notEquals"===t.operator?e.isActive!==r:null},price:(e,t)=>{const r="string"===typeof e.price?parseFloat(e.price):e.price||0,a="string"===typeof t.value?parseFloat(t.value):t.value||0;return!isNaN(r)&&!isNaN(a)&&("equals"===t.operator?Math.abs(r-a)<.01:"greaterThan"===t.operator?r>a:"lessThan"===t.operator?r<a:null)},location:(e,t)=>{const r=(t.value||"").toLowerCase(),a=(e.location||"").toLowerCase();return"equals"===t.operator?e.location===t.value:"contains"===t.operator?a.includes(r):"startsWith"===t.operator?a.startsWith(r):"endsWith"===t.operator?a.endsWith(r):null},branch:(e,t)=>{var r;const a=((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase(),s=(t.value||"").toLowerCase();return"equals"===t.operator?a===s:"contains"===t.operator?a.includes(s):null},createdBy:(e,t)=>{const r=e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName):"";return(0,Ae.Ac)(e.createdById||null,null,t,r)}},r=(e,t)=>{var r;switch(t){case"title":return e.title||"";case"type":return e.type||"";case"price":return"string"===typeof e.price?parseFloat(e.price):e.price||0;case"location":return e.location||"";case"duration":return e.duration||0;case"branch":return(null===(r=e.branch)||void 0===r?void 0:r.name)||"";case"createdBy":return e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName):"";case"isActive":return e.isActive;default:return""}};e=(0,Ae.W5)(e,ht,bt,r,t)}const t=(e,t)=>{var r;switch(t){case"title":return(e.title||"").toLowerCase();case"type":return e.type.toLowerCase();case"price":return"string"===typeof e.price?parseFloat(e.price):e.price||0;case"location":return(e.location||"").toLowerCase();case"duration":return e.duration||0;case"branch":return((null===(r=e.branch)||void 0===r?void 0:r.name)||"").toLowerCase();case"createdBy":return e.createdBy?"".concat(e.createdBy.firstName," ").concat(e.createdBy.lastName).toLowerCase():"";case"isActive":return e.isActive?1:0;default:return""}},r=e.sort(((e,r)=>{if("table"===Pa&&Mr.key){const a=t(e,Mr.key),s=t(r,Mr.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Mr.direction?n:-n}if(vt.length>0&&ht.length>0){const a=[...vt].sort(((e,t)=>e.priority-t.priority));for(const s of a){const a=t(e,s.column),n=t(r,s.column);let o=0;if(o="number"===typeof a&&"number"===typeof n?a-n:String(a).localeCompare(String(n)),"desc"===s.direction&&(o=-o),0!==o)return o}return 0}if("cards"===Pa&&0===ht.length){const a=["title","type","price","location","duration","branch","createdBy","isActive"];for(const s of a){const a=Ua[s]||"asc",n=t(e,s),o=t(r,s);let l=0;if(l="number"===typeof n&&"number"===typeof o?n-o:String(n).localeCompare(String(o)),"desc"===a&&(l=-l),0!==l)return l}return 0}if("table"===Pa&&0===ht.length&&Mr.key){const a=t(e,Mr.key),s=t(r,Mr.key);let n=0;if(n="number"===typeof a&&"number"===typeof s?a-s:String(a).localeCompare(String(s)),0!==n)return"asc"===Mr.direction?n:-n}const a=(e.title||"").toLowerCase(),s=(r.title||"").toLowerCase();return a.localeCompare(s)}));return console.log("\u2705 Gefilterte und sortierte Tours:",r.length),r}),[nt,xt,ht,bt,vt,Pa,Mr,Ua]),ys=(e,t)=>{const r=[...ya.columnOrder],a=r[e];r.splice(e,1),r.splice(t,0,a),va(r)},vs=e=>{wa(e)},fs=(e,t)=>{e.preventDefault(),ja&&ja!==t&&Ca(t)},ks=(e,t)=>{if(e.preventDefault(),ja&&ja!==t){const e=ya.columnOrder.indexOf(ja),r=ya.columnOrder.indexOf(t);e>-1&&r>-1&&ys(e,r)}wa(null),Ca(null)},Ns=()=>{wa(null),Ca(null)},js=(0,s.useMemo)((()=>{const e=(ya.columnOrder||[]).filter((e=>null!=e&&"string"===typeof e)),t=("todos"===X?Re:"reservations"===X?ra:ca).filter((t=>!e.includes(t)));return[...e,...t]}),[ya.columnOrder,X,Re,ra,ca]).filter((e=>null!=e&&"string"===typeof e&&ka(e))),ws=async e=>{try{var t;const r={title:"".concat(e.title,"-Kopie"),description:e.description,status:"open",responsibleId:e.responsible?e.responsible.id:null,roleId:e.role?e.role.id:null,qualityControlId:(null===(t=e.qualityControl)||void 0===t?void 0:t.id)||null,branchId:e.branch.id,dueDate:e.dueDate},a=await z.A.post(U.Sn.TASKS.BASE,r);oe((e=>[a.data,...e])),Kr(a.data),Vr(!0)}catch(s){var r,a;console.error("Fehler beim Kopieren des Tasks:",s);const e=s;Ne((null===(r=e.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Ss=async t=>{if(window.confirm(e("worktime.messages.taskDeleteConfirm"))){console.log("\ud83d\uddd1\ufe0f Starte L\xf6schung von Task:",t),console.log("\ud83d\udccb Aktuelle Tasks vor L\xf6schung:",ae.length),oe((e=>{const r=e.filter((e=>null!=e&&e.id!==t));return console.log("\ud83d\udccb Tasks nach Filterung:",r.length,"von",e.length),r}));try{console.log("\ud83d\udce1 Sende Delete-Request..."),await z.A.delete(U.Sn.TASKS.BY_ID(t)),console.log("\u2705 Delete erfolgreich"),Te.oR.success(e("worktime.messages.taskDeleted"))}catch(ke){console.error("\u274c Fehler beim L\xf6schen der Aufgabe:",ke),Ka(),Te.oR.error(e("worktime.messages.taskDeletedError"))}}};return(0,W.jsxs)("div",{className:"min-h-screen dark:bg-gray-900",children:[(0,W.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,W.jsxs)("div",{className:"w-full mb-4",children:[(0,W.jsxs)("div",{className:"block sm:hidden w-full",children:[(0,W.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,W.jsxs)("div",{className:"flex items-center justify-between px-3 sm:px-4 md:px-6",children:[(0,W.jsx)("div",{className:"flex items-center",children:r("tasks","write","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ur(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tasks.createTask"),children:(0,W.jsx)(x.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.createTask")})]})}),(0,W.jsx)("div",{className:"flex items-center",children:(0,W.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,W.jsxs)("button",{onClick:()=>ee("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("todos"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(g.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tasks.title","To Do's")]}),r("reservations","read","table")&&(0,W.jsxs)("button",{onClick:()=>ee("reservations"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("reservations"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(h.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("reservations.title","Reservations")]}),r("tours","read","table")&&(0,W.jsxs)("button",{onClick:()=>ee("tours"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("tours"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(p.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tours.title","Touren")]})]})}),(0,W.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,W.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[120px] sm:w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:"todos"===X?je:"reservations"===X?Je:xt,onChange:e=>{"todos"===X?Ve(e.target.value):"reservations"===X?et(e.target.value):gt(e.target.value)}}),"reservations"===X&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:async()=>{try{Ut(!0),await z.A.post(U.Sn.RESERVATIONS.SYNC),V(e("reservations.syncSuccess","Reservations erfolgreich synchronisiert"),"success"),await Ha()}catch(a){var t,r;console.error("Fehler beim Synchronisieren:",a),V((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e("reservations.syncError","Fehler beim Synchronisieren"),"error")}finally{Ut(!1)}},disabled:_t,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,W.jsx)(b.A,{className:"h-5 w-5 ".concat(_t?"animate-spin":"")})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_t?e("reservations.syncing","Synchronisiere..."):e("reservations.sync","Synchronisieren")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Pa?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Na("table"===Pa?"cards":"table"),children:"table"===Pa?(0,W.jsx)(y.A,{className:"h-5 w-5"}):(0,W.jsx)(v.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===Pa?"common.viewAsCards":"common.viewAsTable")})]}),(0,W.jsxs)("div",{className:"relative group ml-1",children:[(0,W.jsxs)("button",{className:"p-2 rounded-md ".concat(ns()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>Rr(!Lr),children:[(0,W.jsx)(f.A,{className:"h-5 w-5"}),ns()>0&&(0,W.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:ns()})]}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),"tours"===X&&r("tour_edit","write","button")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Rt(!0),className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,W.jsx)(k.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.export","Exportieren")})]}),(0,W.jsx)("div",{className:"ml-1",children:(0,W.jsx)(c.A,{columns:"todos"===X?"cards"===Pa?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:G:"reservations"===X?"cards"===Pa?[{id:"guestName",label:e("reservations.columns.guestName","Gast")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail")},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon")},{id:"amount",label:e("reservations.columns.amount","Betrag")},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit")}]:Z:"tours"===X?"cards"===Pa?[{id:"title",label:e("tours.columns.title","Titel")},{id:"type",label:e("tours.columns.type","Typ")},{id:"price",label:e("tours.columns.price","Preis")},{id:"location",label:e("tours.columns.location","Ort")},{id:"duration",label:e("tours.columns.duration","Dauer")},{id:"branch",label:e("tours.columns.branch","Niederlassung")},{id:"createdBy",label:e("tours.columns.createdBy","Erstellt von")},{id:"isActive",label:e("tours.columns.status","Status")}]:$:[],visibleColumns:"cards"===Pa?Array.from(Ra):js,columnOrder:"cards"===Pa?Ia:ya.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Pa){const t=_e[e];if(t)if("responsibleAndQualityControl"===t){const r="responsible"===e?"qualityControl":"responsible";La.has(r),ya.hiddenColumns.includes(t);fa(t)}else fa(t)}else fa(e)},onMoveColumn:"cards"===Pa?(e,t)=>{const r=[...Ia],a=r[e];r.splice(e,1),r.splice(t,0,a);const s=[],n=new Set;r.forEach((e=>{const t=_e[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),G.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),va(s)}:ys,buttonTitle:e("cards"===Pa?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Pa?"tableColumn.sortAndDisplay":"tableColumn.configure"),sortDirections:"cards"===Pa&&"todos"===X?Oa:"cards"===Pa&&"reservations"===X?za:void 0,onSortDirectionChange:"cards"===Pa&&"todos"===X?Ba:"cards"===Pa&&"reservations"===X?qa:void 0,showSortDirection:"cards"===Pa&&("todos"===X||"reservations"===X),onClose:()=>{}})})]})]}),Lr&&(0,W.jsx)("div",{className:"cards"===Pa?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:"todos"===X?(0,W.jsx)(Se.A,{columns:[...G,...K],onApply:os,onReset:ls,savedConditions:jr,savedOperators:Sr,savedSortDirections:Ar,onSortDirectionsChange:Tr,tableId:Oe}):(0,W.jsx)(Se.A,{columns:[...Z,...Q],onApply:is,onReset:ds,savedConditions:xr,savedOperators:hr,savedSortDirections:br,onSortDirectionsChange:yr,tableId:Fe})}),(0,W.jsx)("div",{className:"cards"===Pa?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,W.jsx)(Ce.A,{tableId:"todos"===X?Oe:"reservations"===X?Fe:Be,onSelectFilter:"todos"===X?os:"reservations"===X?is:Qa,onReset:"todos"===X?ls:"reservations"===X?ds:$a,activeFilterName:"todos"===X?Er:"reservations"===X?vr:kt,selectedFilterId:"todos"===X?Pr:"reservations"===X?kr:jt,onFilterChange:"todos"===X?cs:"reservations"===X?us:Xa,defaultFilterName:"todos"===X?e("tasks.filters.current"):e("reservations"===X?"reservations.filters.current":"tours.filters.current","Aktuell")})}),"todos"===X&&"table"===Pa?(0,W.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,W.jsx)("tr",{children:js.map((e=>{const t=G.find((t=>t.id===e));return t?(0,W.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Sa?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>vs(e),onDragOver:t=>fs(t,e),onDrop:t=>ks(t,e),onDragEnd:Ns,children:(0,W.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,W.jsx)("button",{onClick:()=>rs(e),className:"ml-1 focus:outline-none",children:(0,W.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:ve?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,W.jsx)("div",{className:"flex justify-center",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):ke?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:ke})}):0===hs.length?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,W.jsx)(j.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,W.jsx)(W.Fragment,{children:hs.slice(0,Aa).map((t=>{const a=(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,De.F2)(a);return(0,W.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==a?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:js.map((a=>{switch(a){case"title":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,W.jsxs)("div",{className:"ml-2 relative group",children:[(0,W.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(w.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.showDescription")}),(0,W.jsx)("div",{className:"absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,W.jsx)(Ee.A,{content:t.description,showImagePreview:!0})})]})]})},a);case"status":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,Pe.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},a);case"responsibleAndQualityControl":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"flex flex-col",children:[(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,W.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,W.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,W.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},a);case"branch":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},a);case"dueDate":const s=(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description),n=(0,De.F2)(s);return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"text-sm ".concat("none"!==s?n.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,W.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},a);case"actions":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,W.jsx)("div",{className:"status-buttons",children:ss(t)}),r("tasks","write","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>{Kr(t),Vr(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(S.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.edit")})]}),r("tasks","both","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>ws(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,W.jsx)(C.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]}),r("tasks","delete","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ss(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,W.jsx)(A.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.delete")})]})]})},a);default:return null}}))},t.id)}))})})]})}):"todos"===X?(0,W.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:ve&&0===ae.length?(0,W.jsx)(Le.A,{children:Array(3).fill(null).map(((e,t)=>(0,W.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,W.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,W.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,W.jsxs)("div",{className:"space-y-2",children:[(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))}):ke?(0,W.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:ke}):0===hs.length?(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,W.jsx)(j.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,W.jsx)(Le.A,{children:hs.slice(0,Aa).map((t=>{(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(Ra.has("branch")&&s.push({icon:(0,W.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ra.has("responsible")){const r=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",a=r.length>4&&"-"!==r?r.substring(0,4):r;s.push({icon:(0,W.jsx)(E.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:a,section:"main"})}if(Ra.has("qualityControl")){const r=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",a=r.length>4&&"-"!==r?r.substring(0,4):r;s.push({icon:(0,W.jsx)(E.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:a,section:"main-second"})}if(Ra.has("dueDate")){const r=(0,De.Rj)(t.dueDate,"todo",t.title,t.description,(0,W.jsx)(h.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,ie.GP)(e,"dd.MM.yyyy",{locale:de.de})),!1);s.push((0,a.A)((0,a.A)({},r),{},{section:"right-inline"}))}Ra.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const n=(0,W.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,W.jsx)("div",{className:"status-buttons",children:ss(t)}),r("tasks","write","table")&&(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kr(t),Vr(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(S.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),ws(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,W.jsx)(C.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]})]});return(0,W.jsx)(Ie.A,{title:(0,W.jsxs)("span",{children:[(0,W.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[t.id,":"]})," ",(0,W.jsx)("span",{children:t.title})]}),status:{label:(0,Pe.Iw)(t.status,"task",e),color:(0,Pe.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:n},t.id)}))})}):null,"todos"===X&&hs.length>Aa&&(0,W.jsx)("div",{className:"mt-4 flex justify-center",children:(0,W.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ta((e=>e+10)),children:[e("common.showMore")," (",hs.length-Aa," ",e("common.remaining"),")"]})}),"reservations"===X&&"cards"===Pa&&(0,W.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:Ye?(0,W.jsx)("div",{className:"flex justify-center py-12",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):$e?(0,W.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:$e}):0===ps.length?(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,W.jsx)(h.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:Je||"all"!==tt||"all"!==at?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]}):(0,W.jsx)(Le.A,{children:ps.slice(0,Aa).map((t=>{var a;const s=e=>{try{const t=new Date(e),r=t.getUTCFullYear(),a=t.getUTCMonth(),s=t.getUTCDate(),n=new Date(r,a,s);return(0,ie.GP)(n,"dd.MM.yyyy",{locale:de.de})}catch(t){return e}},n=[];n.push({icon:(0,W.jsx)(h.A,{className:"h-4 w-4"}),label:e("reservations.checkInOut","Check-in/Check-out"),value:"".concat(s(t.checkInDate)," - ").concat(s(t.checkOutDate)),section:"main"}),t.roomNumber&&n.push({icon:(0,W.jsx)(D.A,{className:"h-4 w-4"}),value:t.roomNumber,section:"main-second"}),t.guestEmail&&n.push({icon:(0,W.jsx)(P.A,{className:"h-4 w-4"}),value:t.guestEmail,section:"left"}),t.guestPhone&&n.push({icon:(0,W.jsx)(I.A,{className:"h-4 w-4"}),value:t.guestPhone,section:"left"}),t.branch&&n.push({icon:(0,W.jsx)(T.A,{className:"h-4 w-4"}),value:t.branch.name,section:"left"}),t.paymentLink&&n.push({icon:(0,W.jsx)(L.A,{className:"h-4 w-4"}),value:(0,W.jsx)("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white break-all",children:e("reservations.paymentLink","Zahlungslink")}),section:"center"});const o=t.lobbyReservationId||t.id.toString(),l=t.guestEmail?"https://app.lobbypms.com/checkinonline/confirmar?codigo=".concat(o,"&email=").concat(encodeURIComponent(t.guestEmail),"&lg=GB"):null;if(l&&n.push({icon:(0,W.jsx)(L.A,{className:"h-4 w-4"}),value:(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white",children:e("reservations.checkInLink","Check-in Link")}),(0,W.jsx)("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l})]}),section:"center"}),n.push({label:e("reservations.status","Status"),value:(0,W.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(xs(t.status)),children:e("reservations.status.".concat(t.status),t.status)}),section:"right"}),n.push({label:e("reservations.paymentStatus","Zahlungsstatus"),value:(0,W.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(gs(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)}),section:"right"}),t.amount){const r="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";n.push({icon:(0,W.jsx)(R.A,{className:"h-4 w-4"}),label:e("reservations.amount","Betrag"),value:"".concat(r," ").concat(t.currency||"COP"),section:"right"})}if(t.arrivalTime){const r=e=>{try{return(0,ie.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:de.de})}catch(t){return e}};n.push({icon:(0,W.jsx)(O.A,{className:"h-4 w-4"}),label:e("reservations.arrivalTime","Ankunftszeit"),value:r(t.arrivalTime),section:"right"})}t.doorPin&&n.push({icon:(0,W.jsx)(F.A,{className:"h-4 w-4"}),label:t.doorAppName||e("reservations.doorPin","T\xfcr-PIN"),value:t.doorPin,section:"right"}),t.onlineCheckInCompleted&&n.push({icon:(0,W.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),label:e("reservations.onlineCheckIn","Online Check-in"),value:e("reservations.completed","Abgeschlossen"),section:"right"});const i=r("reservations","write","table");t.id===(null===(a=ps[0])||void 0===a?void 0:a.id)&&console.log("[Reservations] Berechtigungspr\xfcfung:",{hasWritePermission:i,reservationId:t.id,entity:"reservations",accessLevel:"write",entityType:"table",actionButtonsWillBeCreated:i});const d=i?(0,W.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kt(t),Zt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(B.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Qt(t),Xt(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,W.jsx)(F.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]})]}):null,c=Ea.has(t.id),u=(0,W.jsx)("div",{className:"mt-2 pt-3",children:(0,W.jsx)(pe.A,{reservationId:t.id})});return(0,W.jsx)(Ie.A,{title:t.guestName,subtitle:t.lobbyReservationId?"ID: ".concat(t.lobbyReservationId):void 0,metadata:n,actions:d,expandable:u?{isExpanded:c,content:u,onToggle:()=>Va(t.id)}:void 0},t.id)}))})}),"reservations"===X&&"table"===Pa&&(0,W.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,W.jsx)("tr",{children:js.map((e=>{const t=Z.find((t=>t.id===e));return t?(0,W.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Sa?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>vs(e),onDragOver:t=>fs(t,e),onDrop:t=>ks(t,e),onDragEnd:Ns,children:(0,W.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,W.jsx)("button",{onClick:()=>as(e),className:"ml-1 focus:outline-none",children:(0,W.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Ye?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,W.jsx)("div",{className:"flex justify-center",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):$e?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:$e})}):0===ps.length?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,W.jsx)(h.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:Je||"all"!==tt||"all"!==at?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]})})}):(0,W.jsx)(W.Fragment,{children:ps.slice(0,Aa).map((t=>{const a=e=>{try{return(0,ie.GP)(new Date(e),"dd.MM.yyyy",{locale:de.de})}catch(t){return e}};return(0,W.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>_("/reservations/".concat(t.id)),children:js.map((s=>{var n;switch(s){case"guestName":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:[t.guestName,t.lobbyReservationId&&(0,W.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",t.lobbyReservationId]})]})},s);case"status":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(xs(t.status)),children:e("reservations.status.".concat(t.status),t.status)})},s);case"paymentStatus":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(gs(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})},s);case"checkInDate":case"checkOutDate":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:a("checkInDate"===s?t.checkInDate:t.checkOutDate)})},s);case"roomNumber":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.roomNumber||"-"})},s);case"branch":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(n=t.branch)||void 0===n?void 0:n.name)||"-"})},s);case"guestEmail":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestEmail||"-"})},s);case"guestPhone":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestPhone||"-"})},s);case"amount":const o="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[o," ",t.currency||"COP"]})},s);case"arrivalTime":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.arrivalTime?(0,ie.GP)(new Date(t.arrivalTime),"dd.MM.yyyy HH:mm",{locale:de.de}):"-"})},s);case"actions":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"flex space-x-2 action-buttons",children:r("reservations","write","table")&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kt(t),Zt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(B.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Qt(t),Xt(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,W.jsx)(F.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),_("/reservations/".concat(t.id))},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(w.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails")})]})]})})},s);default:return null}}))},t.id)}))})})]})}),"reservations"===X&&ps.length>Aa&&(0,W.jsx)("div",{className:"mt-4 flex justify-center",children:(0,W.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ta((e=>e+10)),children:[e("common.showMore")," (",ps.length-Aa," ",e("common.remaining"),")"]})})]}),(0,W.jsx)("div",{className:"fixed bottom-13 left-0 right-0 w-full bg-white dark:bg-gray-800 z-9 shadow-lg border-t-0 dark:border-t dark:border-gray-700",children:(0,W.jsx)(we,{})})]}),(0,W.jsxs)("div",{className:"hidden sm:block",children:[(0,W.jsx)("div",{className:"mb-8",children:(0,W.jsx)(we,{})}),(0,W.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,W.jsxs)("div",{className:"flex items-center mb-4 justify-between px-3 sm:px-4 md:px-6",children:[(0,W.jsxs)("div",{className:"flex items-center",children:["todos"===X&&r("tasks","write","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ur(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tasks.createTask"),"data-onboarding":"create-task-button",children:(0,W.jsx)(x.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.createTask")})]}),"reservations"===X&&r("reservations","write","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>qt(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("reservations.createReservation.button","Neue Reservierung"),children:(0,W.jsx)(x.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.createReservation.button","Neue Reservierung")})]}),"tours"===X&&r("tour_create","write","button")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ct(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("tours.create","Neue Tour erstellen"),children:(0,W.jsx)(x.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.create","Neue Tour erstellen")})]})]}),(0,W.jsx)("div",{className:"flex items-center",children:(0,W.jsxs)("nav",{className:"-mb-px flex space-x-4 sm:space-x-8 overflow-x-auto overflow-y-hidden",children:[(0,W.jsxs)("button",{onClick:()=>ee("todos"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("todos"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(g.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tasks.title","To Do's")]}),r("reservations","read","table")&&(0,W.jsxs)("button",{onClick:()=>ee("reservations"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("reservations"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(h.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("reservations.title","Reservations")]}),r("tours","read","table")&&(0,W.jsxs)("button",{onClick:()=>ee("tours"),className:"py-2 px-1 border-b-2 font-medium text-xs sm:text-sm flex-shrink-0 flex items-center gap-1.5 ".concat("tours"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,W.jsx)(p.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e("tours.title","Touren")]})]})}),(0,W.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,W.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[120px] sm:w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:"todos"===X?je:"reservations"===X?Je:xt,onChange:e=>{"todos"===X?Ve(e.target.value):"reservations"===X?et(e.target.value):gt(e.target.value)}}),"reservations"===X&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:async()=>{try{Ut(!0),await z.A.post(U.Sn.RESERVATIONS.SYNC),V(e("reservations.syncSuccess","Reservations erfolgreich synchronisiert"),"success"),await Ha()}catch(a){var t,r;console.error("Fehler beim Synchronisieren:",a),V((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e("reservations.syncError","Fehler beim Synchronisieren"),"error")}finally{Ut(!1)}},disabled:_t,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,W.jsx)(b.A,{className:"h-5 w-5 ".concat(_t?"animate-spin":"")})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:_t?e("reservations.syncing","Synchronisiere..."):e("reservations.sync","Synchronisieren")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Pa?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Na("table"===Pa?"cards":"table"),children:"table"===Pa?(0,W.jsx)(y.A,{className:"h-5 w-5"}):(0,W.jsx)(v.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===Pa?"common.viewAsCards":"common.viewAsTable")})]}),(0,W.jsxs)("div",{className:"relative group ml-1",children:[(0,W.jsxs)("button",{className:"p-2 rounded-md ".concat(ns()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>Rr(!Lr),children:[(0,W.jsx)(f.A,{className:"h-5 w-5"}),ns()>0&&(0,W.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:ns()})]}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),(0,W.jsx)("div",{className:"ml-1",children:(0,W.jsx)(c.A,{columns:"todos"===X?"cards"===Pa?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:G:"reservations"===X?"cards"===Pa?[{id:"guestName",label:e("reservations.columns.guestName","Gast")},{id:"status",label:e("reservations.columns.status","Status")},{id:"paymentStatus",label:e("reservations.columns.paymentStatus","Zahlungsstatus")},{id:"checkInDate",label:e("reservations.columns.checkInDate","Check-in")},{id:"checkOutDate",label:e("reservations.columns.checkOutDate","Check-out")},{id:"roomNumber",label:e("reservations.columns.roomNumber","Zimmer")},{id:"guestEmail",label:e("reservations.columns.guestEmail","E-Mail")},{id:"guestPhone",label:e("reservations.columns.guestPhone","Telefon")},{id:"amount",label:e("reservations.columns.amount","Betrag")},{id:"arrivalTime",label:e("reservations.columns.arrivalTime","Ankunftszeit")}]:Z:"tours"===X?"cards"===Pa?[{id:"title",label:e("tours.columns.title","Titel")},{id:"type",label:e("tours.columns.type","Typ")},{id:"price",label:e("tours.columns.price","Preis")},{id:"location",label:e("tours.columns.location","Ort")},{id:"duration",label:e("tours.columns.duration","Dauer")},{id:"branch",label:e("tours.columns.branch","Niederlassung")},{id:"createdBy",label:e("tours.columns.createdBy","Erstellt von")},{id:"isActive",label:e("tours.columns.status","Status")}]:$:[],visibleColumns:"cards"===Pa?Array.from(Ra):js,columnOrder:"cards"===Pa?Ia:ya.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Pa)if("todos"===X){const t=_e[e];if(t)if("responsibleAndQualityControl"===t){const r="responsible"===e?"qualityControl":"responsible";La.has(r),ya.hiddenColumns.includes(t);fa(t)}else fa(t)}else if("reservations"===X){const t=We[e];t&&fa(t)}else"tours"===X&&fa(e);else fa(e)},onMoveColumn:"cards"===Pa?(e,t)=>{const r=[...Ia],a=r[e];r.splice(e,1),r.splice(t,0,a);const s=[],n=new Set;"todos"===X?(r.forEach((e=>{const t=_e[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),G.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)}))):"reservations"===X?(r.forEach((e=>{const t=We[e];t&&!n.has(t)&&(n.add(t),s.push(t))})),Z.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)}))):"tours"===X&&(r.forEach((e=>{n.has(e)||(n.add(e),s.push(e))})),$.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)}))),va(s)}:ys,buttonTitle:e("cards"===Pa?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Pa?"tableColumn.sortAndDisplay":"tableColumn.configure"),sortDirections:"cards"===Pa&&"todos"===X?Oa:"cards"===Pa&&"reservations"===X?za:"cards"===Pa&&"tours"===X?Ua:void 0,onSortDirectionChange:"cards"===Pa&&"todos"===X?Ba:"cards"===Pa&&"reservations"===X?qa:"cards"===Pa&&"tours"===X?(e,t)=>{Wa((r=>(0,a.A)((0,a.A)({},r),{},{[e]:t})))}:void 0,showSortDirection:"cards"===Pa&&("todos"===X||"reservations"===X||"tours"===X),onClose:()=>{}})})]})]}),Lr&&(0,W.jsx)("div",{className:"cards"===Pa?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:"todos"===X?(0,W.jsx)(Se.A,{columns:[...G,...K],onApply:os,onReset:ls,savedConditions:jr,savedOperators:Sr,savedSortDirections:Ar,onSortDirectionsChange:Tr,tableId:Oe}):(0,W.jsx)(Se.A,{columns:[...Z,...Q],onApply:is,onReset:ds,savedConditions:xr,savedOperators:hr,savedSortDirections:br,onSortDirectionsChange:yr,tableId:Fe})}),(0,W.jsx)(Ce.A,{tableId:"todos"===X?Oe:"reservations"===X?Fe:Be,onSelectFilter:"todos"===X?os:"reservations"===X?is:Qa,onReset:"todos"===X?ls:"reservations"===X?ds:$a,activeFilterName:"todos"===X?Er:"reservations"===X?vr:kt,selectedFilterId:"todos"===X?Pr:"reservations"===X?kr:jt,onFilterChange:"todos"===X?cs:"reservations"===X?us:Xa,defaultFilterName:"todos"===X?e("tasks.filters.current"):e("reservations"===X?"reservations.filters.current":"tours.filters.current","Aktuell")}),"todos"===X&&"table"===Pa?(0,W.jsx)("div",{className:"overflow-x-auto",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700","data-onboarding":"task-list",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,W.jsx)("tr",{children:js.map((e=>{const t=G.find((t=>t.id===e));return t?(0,W.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Sa?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>vs(e),onDragOver:t=>fs(t,e),onDrop:t=>ks(t,e),onDragEnd:Ns,children:(0,W.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,W.jsx)("button",{onClick:()=>rs(e),className:"ml-1 focus:outline-none",children:(0,W.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:ve?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,W.jsx)("div",{className:"flex justify-center",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):ke?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:ke})}):0===hs.length?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,W.jsx)(j.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,W.jsx)(W.Fragment,{children:hs.slice(0,Aa).map((t=>{const a=(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,De.F2)(a);return(0,W.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==a?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:js.map((a=>{switch(a){case"title":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,W.jsxs)("div",{className:"ml-2 relative group",children:[(0,W.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:(0,W.jsx)(w.A,{className:"h-5 w-5"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.showDescription")}),(0,W.jsx)("div",{className:"absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,W.jsx)(Ee.A,{content:t.description,showImagePreview:!0})})]})]})},a);case"status":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,Pe.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},a);case"responsibleAndQualityControl":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"flex flex-col",children:[(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,W.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,W.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,W.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,W.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},a);case"branch":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},a);case"dueDate":const s=(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description),n=(0,De.F2)(s);return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"text-sm ".concat("none"!==s?n.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,W.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},a);case"actions":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,W.jsx)("div",{className:"status-buttons",children:ss(t)}),r("tasks","write","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>{Kr(t),Vr(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(S.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.edit")})]}),r("tasks","both","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>ws(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,W.jsx)(C.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]}),r("tasks","delete","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:()=>Ss(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,W.jsx)(A.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.delete")})]})]})},a);default:return null}}))},t.id)}))})})]})}):"todos"===X?(0,W.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:ve&&0===ae.length?(0,W.jsx)(Le.A,{children:Array(3).fill(null).map(((e,t)=>(0,W.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,W.jsxs)("div",{className:"space-y-4",children:[(0,W.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,W.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,W.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,W.jsxs)("div",{className:"space-y-2",children:[(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,W.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))}):ke?(0,W.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:ke}):0===hs.length?(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,W.jsx)(j.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,W.jsx)(Le.A,{children:hs.slice(0,Aa).map((t=>{(0,De.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(Ra.has("branch")&&s.push({icon:(0,W.jsx)(T.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ra.has("responsible")){const r=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",a=r.length>4&&"-"!==r?r.substring(0,4):r;s.push({icon:(0,W.jsx)(E.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:a,section:"main"})}if(Ra.has("qualityControl")){const r=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",a=r.length>4&&"-"!==r?r.substring(0,4):r;s.push({icon:(0,W.jsx)(E.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:a,section:"main-second"})}if(Ra.has("dueDate")){const r=(0,De.Rj)(t.dueDate,"todo",t.title,t.description,(0,W.jsx)(h.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,ie.GP)(e,"dd.MM.yyyy",{locale:de.de})),!1);s.push((0,a.A)((0,a.A)({},r),{},{section:"right-inline"}))}Ra.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const n=(0,W.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,W.jsx)("div",{className:"status-buttons",children:ss(t)}),r("tasks","write","table")&&(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kr(t),Vr(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(S.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),ws(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,W.jsx)(C.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tasks.actions.copy")})]})]});return(0,W.jsx)(Ie.A,{title:(0,W.jsxs)("span",{children:[(0,W.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[t.id,":"]})," ",(0,W.jsx)("span",{children:t.title})]}),status:{label:(0,Pe.Iw)(t.status,"task",e),color:(0,Pe.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:n},t.id)}))})}):null,"todos"===X&&hs.length>Aa&&(0,W.jsx)("div",{className:"mt-4 flex justify-center",children:(0,W.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ta((e=>e+10)),children:[e("common.showMore")," (",hs.length-Aa," ",e("common.remaining"),")"]})}),"reservations"===X&&"cards"===Pa&&(0,W.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:Ye?(0,W.jsx)("div",{className:"flex justify-center py-12",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):$e?(0,W.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:$e}):0===ps.length?(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,W.jsx)(h.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:Je||"all"!==tt||"all"!==at?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]}):(0,W.jsx)(Le.A,{children:ps.slice(0,Aa).map((t=>{const a=e=>{try{const t=new Date(e),r=t.getUTCFullYear(),a=t.getUTCMonth(),s=t.getUTCDate(),n=new Date(r,a,s);return(0,ie.GP)(n,"dd.MM.yyyy",{locale:de.de})}catch(t){return e}},s=[];s.push({icon:(0,W.jsx)(h.A,{className:"h-4 w-4"}),label:e("reservations.checkInOut","Check-in/Check-out"),value:"".concat(a(t.checkInDate)," - ").concat(a(t.checkOutDate)),section:"main"}),t.roomNumber&&s.push({icon:(0,W.jsx)(D.A,{className:"h-4 w-4"}),value:t.roomNumber,section:"main-second"}),t.guestEmail&&s.push({icon:(0,W.jsx)(P.A,{className:"h-4 w-4"}),value:t.guestEmail,section:"left"}),t.guestPhone&&s.push({icon:(0,W.jsx)(I.A,{className:"h-4 w-4"}),value:t.guestPhone,section:"left"}),t.branch&&s.push({icon:(0,W.jsx)(T.A,{className:"h-4 w-4"}),value:t.branch.name,section:"left"}),t.paymentLink&&s.push({icon:(0,W.jsx)(L.A,{className:"h-4 w-4"}),value:(0,W.jsx)("a",{href:t.paymentLink,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white break-all",children:e("reservations.paymentLink","Zahlungslink")}),section:"center"});const n=t.lobbyReservationId||t.id.toString(),o=t.guestEmail?"https://app.lobbypms.com/checkinonline/confirmar?codigo=".concat(n,"&email=").concat(encodeURIComponent(t.guestEmail),"&lg=GB"):null;if(o&&s.push({icon:(0,W.jsx)(L.A,{className:"h-4 w-4"}),value:(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("a",{href:o,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-gray-900 dark:text-white",children:e("reservations.checkInLink","Check-in Link")}),(0,W.jsx)("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o})]}),section:"center"}),s.push({label:e("reservations.status","Status"),value:(0,W.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(xs(t.status)),children:e("reservations.status.".concat(t.status),t.status)}),section:"right"}),s.push({label:e("reservations.paymentStatus","Zahlungsstatus"),value:(0,W.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(gs(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)}),section:"right"}),t.amount){const r="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";s.push({icon:(0,W.jsx)(R.A,{className:"h-4 w-4"}),label:e("reservations.amount","Betrag"),value:"".concat(r," ").concat(t.currency||"COP"),section:"right"})}if(t.arrivalTime){const r=e=>{try{return(0,ie.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:de.de})}catch(t){return e}};s.push({icon:(0,W.jsx)(O.A,{className:"h-4 w-4"}),label:e("reservations.arrivalTime","Ankunftszeit"),value:r(t.arrivalTime),section:"right"})}t.doorPin&&s.push({icon:(0,W.jsx)(F.A,{className:"h-4 w-4"}),label:t.doorAppName||e("reservations.doorPin","T\xfcr-PIN"),value:t.doorPin,section:"right"}),t.onlineCheckInCompleted&&s.push({icon:(0,W.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),label:e("reservations.onlineCheckIn","Online Check-in"),value:e("reservations.completed","Abgeschlossen"),section:"right"});const l=r("reservations","write","table")?(0,W.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kt(t),Zt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(B.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Qt(t),Xt(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,W.jsx)(F.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]})]}):null,i=Ea.has(t.id),d=(0,W.jsx)("div",{className:"mt-2 pt-3",children:(0,W.jsx)(pe.A,{reservationId:t.id})});return(0,W.jsx)(Ie.A,{title:t.guestName,subtitle:t.lobbyReservationId?"ID: ".concat(t.lobbyReservationId):void 0,metadata:s,actions:l,expandable:d?{isExpanded:i,content:d,onToggle:()=>Va(t.id)}:void 0},t.id)}))})}),"reservations"===X&&"table"===Pa&&(0,W.jsx)("div",{className:"overflow-x-auto",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,W.jsx)("tr",{children:js.map((e=>{const t=Z.find((t=>t.id===e));return t?(0,W.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Sa?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>vs(e),onDragOver:t=>fs(t,e),onDrop:t=>ks(t,e),onDragEnd:Ns,children:(0,W.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,W.jsx)("button",{onClick:()=>as(e),className:"ml-1 focus:outline-none",children:(0,W.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Ye?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,W.jsx)("div",{className:"flex justify-center",children:(0,W.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):$e?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:$e})}):0===ps.length?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,W.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,W.jsx)(h.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,W.jsx)("div",{className:"text-sm",children:Je||"all"!==tt||"all"!==at?e("reservations.noResults","Keine Reservations gefunden"):e("reservations.noReservations","Keine Reservations vorhanden")})]})})}):(0,W.jsx)(W.Fragment,{children:ps.slice(0,Aa).map((t=>{const a=e=>{try{return(0,ie.GP)(new Date(e),"dd.MM.yyyy",{locale:de.de})}catch(t){return e}};return(0,W.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>_("/reservations/".concat(t.id)),children:js.map((s=>{var n;switch(s){case"guestName":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:[t.guestName,t.lobbyReservationId&&(0,W.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",t.lobbyReservationId]})]})},s);case"status":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(xs(t.status)),children:e("reservations.status.".concat(t.status),t.status)})},s);case"paymentStatus":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(gs(t.paymentStatus)),children:e("reservations.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})},s);case"checkInDate":case"checkOutDate":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:a("checkInDate"===s?t.checkInDate:t.checkOutDate)})},s);case"roomNumber":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.roomNumber||"-"})},s);case"branch":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(n=t.branch)||void 0===n?void 0:n.name)||"-"})},s);case"guestEmail":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestEmail||"-"})},s);case"guestPhone":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.guestPhone||"-"})},s);case"amount":const o="string"===typeof t.amount?parseFloat(t.amount).toFixed(2):"number"===typeof t.amount?t.amount.toFixed(2):"0.00";return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[o," ",t.currency||"COP"]})},s);case"arrivalTime":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.arrivalTime?(0,ie.GP)(new Date(t.arrivalTime),"dd.MM.yyyy HH:mm",{locale:de.de}):"-"})},s);case"actions":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"flex space-x-2 action-buttons",children:r("reservations","write","table")&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Kt(t),Zt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(B.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendInvitation.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Qt(t),Xt(!0)},className:"p-1.5 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:(0,W.jsx)(F.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("reservations.sendPasscode.title")})]}),(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),_("/reservations/".concat(t.id))},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(w.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails")})]})]})})},s);default:return null}}))},t.id)}))})})]})}),"reservations"===X&&ps.length>Aa&&(0,W.jsx)("div",{className:"mt-4 flex justify-center",children:(0,W.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ta((e=>e+10)),children:[e("common.showMore")," (",ps.length-Aa," ",e("common.remaining"),")"]})}),"tours"===X&&"table"===Pa&&(0,W.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,W.jsx)("tr",{children:js.map((e=>{const t=$.find((t=>t.id===e));return t?(0,W.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ".concat(e===Sa?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>vs(e),onDragOver:t=>fs(t,e),onDrop:t=>ks(t,e),onDragEnd:Ns,children:(0,W.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,W.jsx)("button",{onClick:()=>{return t=e,void("table"===Pa&&"tours"===X&&qr((e=>({key:t,direction:e.key===t&&"asc"===e.direction?"desc":"asc"}))));var t},className:"ml-1 focus:outline-none",children:(0,W.jsx)(N.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:dt?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:e("common.loading")})}):ut?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-red-500 dark:text-red-400",children:ut})}):0===bs.length?(0,W.jsx)("tr",{children:(0,W.jsx)("td",{colSpan:js.length,className:"px-3 sm:px-4 md:px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:e("tours.noTours")})}):(0,W.jsx)(W.Fragment,{children:bs.slice(0,Aa).map((t=>(0,W.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:js.map((a=>{var s;switch(a){case"title":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words",children:t.title})},a);case"type":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.type===re.OWN?e("tours.typeOwn"):e("tours.typeExternal")})},a);case"price":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.price?"".concat(Number(t.price).toLocaleString()," ").concat(t.currency||"COP"):"-"})},a);case"location":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.location||"-"})},a);case"duration":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.duration?"".concat(t.duration," ").concat(e("common.hours","h")):"-"})},a);case"branch":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:(null===(s=t.branch)||void 0===s?void 0:s.name)||"-"})},a);case"createdBy":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.createdBy?"".concat(t.createdBy.firstName," ").concat(t.createdBy.lastName):"-"})},a);case"isActive":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(t.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:t.isActive?e("tours.statusActive"):e("tours.statusInactive")})},a);case"actions":return(0,W.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),zt(t.id),Dt(!0)},className:"p-1.5 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:(0,W.jsx)(w.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.viewDetails","Details anzeigen")})]}),r("tour_edit","write","button")&&(0,W.jsxs)("div",{className:"relative group",children:[(0,W.jsx)("button",{onClick:e=>{e.stopPropagation(),Ft(t),Tt(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,W.jsx)(S.A,{className:"h-4 w-4"})}),(0,W.jsx)("div",{className:"absolute right-full mr-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("tours.edit","Bearbeiten")})]})]})},a);default:return null}}))},t.id)))})})]})}),"tours"===X&&"cards"===Pa&&(0,W.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:dt?(0,W.jsx)("div",{className:"col-span-full text-center py-8 text-gray-500 dark:text-gray-400",children:e("common.loading")}):ut?(0,W.jsx)("div",{className:"col-span-full text-center py-8 text-red-500 dark:text-red-400",children:ut}):0===bs.length?(0,W.jsx)("div",{className:"col-span-full text-center py-8 text-gray-500 dark:text-gray-400",children:e("tours.noTours")}):bs.slice(0,Aa).map((t=>(0,W.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 p-4 hover:shadow-md transition-shadow",children:[(0,W.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,W.jsx)("h4",{className:"text-lg font-semibold dark:text-white",children:t.title}),(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(t.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:t.isActive?e("tours.statusActive"):e("tours.statusInactive")})]}),t.description&&(0,W.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2 line-clamp-2",children:t.description}),(0,W.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,W.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(0,W.jsxs)("span",{className:"font-medium",children:[e("tours.type"),":"]})," ",t.type===re.OWN?e("tours.typeOwn"):e("tours.typeExternal")]}),t.price&&(0,W.jsxs)("div",{className:"text-sm font-semibold dark:text-white",children:[Number(t.price).toLocaleString()," ",t.currency||"COP"]})]}),r("tour_edit","write","button")&&(0,W.jsx)("div",{className:"mt-4 flex justify-end",children:(0,W.jsx)("button",{onClick:()=>{Ft(t),Tt(!0)},className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm",children:e("tours.edit","Bearbeiten")})})]},t.id)))}),"tours"===X&&bs.length>Aa&&(0,W.jsx)("div",{className:"mt-4 flex justify-center",children:(0,W.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ta((e=>e+10)),children:[e("common.showMore")," (",bs.length-Aa," ",e("common.remaining"),")"]})})]})]})]})}),(0,W.jsx)(H,{isOpen:_r,onClose:()=>Ur(!1),onTaskCreated:e=>{null!=e&&(oe((t=>{const r=t.filter((e=>null!=e));return[e,...r]})),Vr(!0),Kr(e))}}),Gr&&(0,W.jsx)(J,{isOpen:Wr,onClose:()=>{Vr(!1),Kr(null)},onTaskUpdated:t=>{null!=t&&(oe((e=>e.filter((e=>null!=e)).map((e=>e.id===t.id?t:e)))),Vr(!1),Kr(null),Te.oR.success(e("worktime.messages.taskUpdated")))},task:Gr}),(0,W.jsx)(te,{isOpen:Mt,onClose:()=>qt(!1),onReservationCreated:async e=>{ee("reservations"),await Ha()}}),Gt&&(0,W.jsx)(ge,{isOpen:Ht,onClose:()=>{Zt(!1),Kt(null)},reservation:Gt,onSuccess:async()=>{await Ha()}}),Yt&&(0,W.jsx)(he,{isOpen:$t,onClose:()=>{Xt(!1),Qt(null)},reservation:Yt,onSuccess:async()=>{await Ha()}}),(0,W.jsx)(se,{isOpen:St,onClose:()=>Ct(!1),onTourCreated:async e=>{ot((t=>[e,...t])),Ct(!1),await Za()}}),Ot&&(0,W.jsx)(ne,{isOpen:At,onClose:()=>{Tt(!1),Ft(null)},onTourUpdated:async e=>{ot((t=>t.map((t=>t.id===e.id?e:t)))),Tt(!1),Ft(null),await Za()},tour:Ot}),Bt&&(0,W.jsx)(ce,{isOpen:Et,onClose:()=>{Dt(!1),zt(null)},tourId:Bt,onTourUpdated:async e=>{ot((t=>t.map((t=>t.id===e.id?e:t)))),await Za()}}),Bt&&(0,W.jsx)(ue,{isOpen:Pt,onClose:()=>{It(!1),zt(null)},tourId:Bt}),(0,W.jsx)(me,{isOpen:Lt,onClose:()=>Rt(!1),tourCount:bs.length}),"tourBookings"===X&&(0,W.jsx)("div",{className:"space-y-4",children:ar?(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("common.loading")}):nr?(0,W.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:nr}):0===Jt.length?(0,W.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("tourBookings.noBookings","Keine Buchungen vorhanden")}):(0,W.jsx)("div",{className:"overflow-x-auto",children:(0,W.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,W.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,W.jsxs)("tr",{children:[(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.tour","Tour")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.customerName","Kunde")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.tourDate","Tour-Datum")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.numberOfParticipants","Teilnehmer")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.totalPrice","Gesamtpreis")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.paymentStatus","Zahlungsstatus")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.status","Status")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("tourBookings.bookedBy","Gebucht von")}),(0,W.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e("common.actions","Aktionen")})]})}),(0,W.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Jt.filter((e=>{var t,r,a,s,n;if(!lr)return!0;const o=lr.toLowerCase();return(null===(t=e.customerName)||void 0===t?void 0:t.toLowerCase().includes(o))||(null===(r=e.customerEmail)||void 0===r?void 0:r.toLowerCase().includes(o))||(null===(a=e.tour)||void 0===a||null===(s=a.title)||void 0===s?void 0:s.toLowerCase().includes(o))||(null===(n=e.customerPhone)||void 0===n?void 0:n.includes(o))})).map((t=>{var r;return(0,W.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(null===(r=t.tour)||void 0===r?void 0:r.title)||"-"})}),(0,W.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t.customerName}),t.customerEmail&&(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerEmail}),t.customerPhone&&(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerPhone})]}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:(0,ie.GP)(new Date(t.tourDate),"dd.MM.yyyy",{locale:de.de})})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("div",{className:"text-sm text-gray-900 dark:text-white",children:t.numberOfParticipants})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsxs)("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Number(t.totalPrice).toLocaleString()," ",t.currency]})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("paid"===t.paymentStatus?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"partially_paid"===t.paymentStatus?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"pending"===t.paymentStatus?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e("tourBookings.paymentStatus.".concat(t.paymentStatus),t.paymentStatus)})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,W.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("confirmed"===t.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"cancelled"===t.status?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"completed"===t.status?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:e("tourBookings.status.".concat(t.status),t.status)})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.bookedBy?(0,W.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[t.bookedBy.firstName," ",t.bookedBy.lastName]}):(0,W.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"-"})}),(0,W.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,W.jsx)("button",{onClick:()=>{cr(t),mr(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 mr-3",children:(0,W.jsx)(L.A,{className:"h-5 w-5"})})})]},t.id)}))})]})})}),dr&&(0,W.jsx)(xe,{isOpen:ur,onClose:()=>{mr(!1),cr(null)},booking:dr,onLinked:async()=>{await Ya()}})]})}},1726:(e,t,r)=>{r.d(t,{X:()=>a,d:()=>s});let a=function(e){return e.CONFIRMED="confirmed",e.NOTIFICATION_SENT="notification_sent",e.CHECKED_IN="checked_in",e.CHECKED_OUT="checked_out",e.CANCELLED="cancelled",e.NO_SHOW="no_show",e}({}),s=function(e){return e.PENDING="pending",e.PAID="paid",e.PARTIALLY_PAID="partially_paid",e.REFUNDED="refunded",e}({})},4450:(e,t,r)=>{r.d(t,{u:()=>o});var a=r(1923),s=r(1801);const n="/reservations",o={async create(e){console.log("[reservationService] POST zu:",n),console.log("[reservationService] Daten:",e);const t=await a.A.post(n,e);return console.log("[reservationService] Response:",t),t.data.data||t.data},async getById(e){const t=await a.A.get("".concat(n,"/").concat(e));return t.data.data||t.data},async updateGuestContact(e,t){const r=await a.A.put("".concat(n,"/").concat(e,"/guest-contact"),{contact:t});return r.data.data||r.data},async generatePinAndSend(e){const t=await a.A.post(s.Sn.RESERVATION.GENERATE_PIN_AND_SEND(e));return t.data.data||t.data},async sendInvitation(e,t){const r=await a.A.post(s.Sn.RESERVATION.SEND_INVITATION(e),t||{});return r.data.data||r.data},async sendPasscode(e,t){const r=await a.A.post(s.Sn.RESERVATION.SEND_PASSCODE(e),t||{});return r.data.data||r.data},async getNotificationLogs(e){const t=await a.A.get(s.Sn.RESERVATION.NOTIFICATION_LOGS(e));return t.data.data||t.data}}},7935:(e,t,r)=>{r.d(t,{A:()=>y});var a=r(5043),s=r(4117),n=r(4450),o=r(9837),l=r(887),i=r(4057),d=r(6511),c=r(9850),u=r(8682),m=r(7438),x=r(6693),g=r(4538),h=r(7098),p=r(7012),b=r(579);const y=e=>{let{reservationId:t,refreshKey:r}=e;const{t:y,i18n:v}=(0,s.Bd)(),[f,k]=(0,a.useState)([]),[N,j]=(0,a.useState)(!0),[w,S]=(0,a.useState)(null),C=()=>{switch(v.language){case"de":return l.de;case"es":return i.es;default:return d.c}},A=e=>{try{return(0,o.GP)(new Date(e),"dd.MM.yyyy HH:mm",{locale:C()})}catch(t){return e}},T=e=>{switch(e){case"invitation":return y("reservations.notificationLogs.type.invitation","Einladung");case"pin":return y("reservations.notificationLogs.type.pin","PIN-Code");case"checkin_confirmation":return y("reservations.notificationLogs.type.checkinConfirmation","Check-in-Best\xe4tigung");default:return e}},E=e=>{switch(e){case"whatsapp":return(0,b.jsx)(c.A,{className:"h-4 w-4"});case"email":return(0,b.jsx)(u.A,{className:"h-4 w-4"});case"both":return(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,b.jsx)(c.A,{className:"h-4 w-4"}),(0,b.jsx)(u.A,{className:"h-4 w-4"})]});default:return(0,b.jsx)(m.A,{className:"h-4 w-4"})}},D=e=>{switch(e){case"pin":return(0,b.jsx)(x.A,{className:"h-4 w-4"});case"invitation":default:return(0,b.jsx)(m.A,{className:"h-4 w-4"});case"checkin_confirmation":return(0,b.jsx)(g.A,{className:"h-4 w-4"})}};return(0,a.useEffect)((()=>{(async()=>{try{j(!0),S(null);const e=await n.u.getNotificationLogs(t);k(e)}catch(a){var e,r;console.error("Fehler beim Laden der Notification-Logs:",a),S((null===(e=a.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||y("reservations.notificationLogs.loadError","Fehler beim Laden der Logs"))}finally{j(!1)}})()}),[t,y,r]),N?(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),(0,b.jsx)("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"})]})}):w?(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:(0,b.jsx)("div",{className:"text-red-600 dark:text-red-400 text-sm",children:w})}):0===f.length?(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:y("reservations.notificationLogs.title","Benachrichtigungs-Historie")}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:y("reservations.notificationLogs.noLogs","Keine Logs vorhanden")})]}):(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:y("reservations.notificationLogs.title","Benachrichtigungs-Historie")}),(0,b.jsx)("div",{className:"space-y-3",children:f.map((e=>(0,b.jsxs)("div",{className:"border rounded-lg p-3 ".concat(e.success?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[e.success?(0,b.jsx)(g.A,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):(0,b.jsx)(h.A,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[D(e.notificationType),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:T(e.notificationType)})]}),(0,b.jsx)("div",{className:"flex items-center space-x-1 text-gray-500 dark:text-gray-400",children:E(e.channel)})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,b.jsx)(p.A,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:A(e.sentAt)})]})]}),e.sentTo&&(0,b.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-1",children:[(0,b.jsxs)("span",{className:"font-medium",children:[y("reservations.notificationLogs.sentTo","Gesendet an"),":"]})," ",e.sentTo]}),e.message&&(0,b.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2 mt-2 p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,b.jsxs)("div",{className:"font-medium mb-1",children:[y("reservations.notificationLogs.message","Nachricht"),":"]}),(0,b.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e.message})]}),(e.paymentLink||e.checkInLink)&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.paymentLink&&(0,b.jsx)("a",{href:e.paymentLink,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:y("reservations.notificationLogs.paymentLink","Zahlungslink")}),e.checkInLink&&(0,b.jsx)("a",{href:e.checkInLink,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:y("reservations.notificationLogs.checkInLink","Check-in-Link")})]}),e.errorMessage&&(0,b.jsxs)("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded text-xs text-red-700 dark:text-red-300",children:[(0,b.jsxs)("div",{className:"font-medium mb-1",children:[y("reservations.notificationLogs.error","Fehler"),":"]}),(0,b.jsx)("div",{children:e.errorMessage})]})]},e.id)))})]})}}}]);
//# sourceMappingURL=541.1daf05e6.chunk.js.map