"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[450],{2704:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=a.forwardRef(l)},3315:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const o=a.forwardRef(l)},4450:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pe});var s=r(5043),a=r(4117),n=r(3216),l=r(9379),o=r(1923),i=r(2672),d=r(2760),c=r(2023),u=r(1801),m=r(6443),h=r(7591),x=r(1816),g=r(9422),p=r(6896),b=r(5657),y=r(579);const f=e=>{let{isOpen:t,onClose:r,onRequestCreated:n}=e;const{t:d}=(0,a.Bd)(),{user:c}=(0,i.As)(),{openSidepane:f,closeSidepane:v}=(0,b.N)(),[w,k]=(0,s.useState)(window.innerWidth>1070),[j,N]=(0,s.useState)([]),[q,A]=(0,s.useState)([]),[S,R]=(0,s.useState)({title:"",description:"",responsible_id:"",branch_id:"",type:"other",is_private:!1,due_date:"",create_todo:!1}),[C,E]=(0,s.useState)(null),[D,_]=(0,s.useState)(!1),[T,L]=(0,s.useState)(window.innerWidth<640),[B,M]=(0,s.useState)([]),[F,O]=(0,s.useState)(!1),P=(0,s.useRef)(null),W=(0,s.useRef)(null);(0,s.useEffect)((()=>{t&&(async()=>{try{if(E(null),!localStorage.getItem("token"))return void E(d("createRequest.errors.notAuthenticated"));console.log("Lade Daten f\xfcr CreateRequestModal...");try{const[t,r]=await Promise.all([o.A.get(u.Sn.USERS.DROPDOWN),o.A.get(u.Sn.BRANCHES.BASE)]);if(console.log("Benutzer geladen:",t.data.length),console.log("Niederlassungen geladen:",r.data.length),N(t.data||[]),A(r.data||[]),c){if(R((e=>(0,l.A)((0,l.A)({},e),{},{responsible_id:c.id.toString()}))),r.data&&r.data.length>0){var e;const t=null===(e=r.data[0])||void 0===e?void 0:e.id.toString();R((e=>(0,l.A)((0,l.A)({},e),{},{branch_id:t})))}const t=new Date;t.setDate(t.getDate()+14);const s=t.toISOString().split("T")[0];R((e=>(0,l.A)((0,l.A)({},e),{},{due_date:s})))}}catch(s){console.error("Fehler beim Laden der Daten:",s);const e=s;var t,r;"ERR_NETWORK"===e.code?E("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft."):E("Fehler beim Laden der Daten: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}catch(s){console.error("Unerwarteter Fehler:",s),E("Ein unerwarteter Fehler ist aufgetreten")}})()}),[t]),(0,s.useEffect)((()=>{const e=()=>{L(window.innerWidth<640),k(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?f():v(),()=>{v()})),[t,f,v]);const z=e=>{var t,r;const s=null===(t=e.firstName)||void 0===t?void 0:t.split(" ")[0],a=null===(r=e.username)||void 0===r?void 0:r.split(" ")[0];return s?"".concat(s," (").concat(a,")"):a||d("createRequest.errors.unknownUser")},I=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await V(t))}}},U=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await V(t)}},H=e=>{e.preventDefault(),e.stopPropagation()},V=async e=>{O(!0),E(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};M((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?"\n![".concat(e.name,"](").concat(d("createRequest.form.uploadAfterCreate"),")\n"):"\n[".concat(e.name,"](").concat(d("createRequest.form.uploadAfterCreate"),")\n"),W.current){const e=W.current.selectionStart,t=S.description.substring(0,e),s=S.description.substring(e);R((0,l.A)((0,l.A)({},S),{},{description:t+r+s})),setTimeout((()=>{if(W.current){const t=e+r.length;W.current.selectionStart=t,W.current.selectionEnd=t,W.current.focus()}}),0)}else R((0,l.A)((0,l.A)({},S),{},{description:S.description+r}))}catch(s){var t,r;console.error("Fehler beim Verarbeiten der Datei:",s);const e=s;E((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||d("createRequest.errors.unknownError"))}finally{O(!1)}},Q=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await V(r),P.current&&(P.current.value="")},$=async e=>{e.preventDefault(),E(null),_(!0);try{if(!localStorage.getItem("token"))throw new Error(d("createRequest.errors.notAuthenticated"));if(null===c||void 0===c||!c.id)throw new Error(d("createRequest.errors.unknownUser"));const e=parseInt(S.responsible_id),t=parseInt(S.branch_id);if(isNaN(e)||isNaN(t))throw new Error(d("createRequest.errors.invalidIds"));const s=await o.A.post(u.Sn.REQUESTS.BASE,{title:S.title,description:S.description||"",responsible_id:e,branch_id:t,requested_by_id:c.id,type:S.type,is_private:S.is_private,due_date:S.due_date||null,create_todo:S.create_todo,status:"approval"});if(201!==s.status)throw new Error(d("createRequest.errors.createError"));await(async e=>{if(0!==B.length)try{_(!0);for(const t of B){if(!t.file)continue;const r=new FormData;r.append("file",t.file),await o.A.post(u.Sn.REQUESTS.ATTACHMENTS(e),r,{headers:{"Content-Type":"multipart/form-data"}})}console.log(d("createRequest.messages.attachmentsUploaded",{count:B.length}))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{_(!1)}})(s.data.id),n(s.data),r(),R({title:"",description:"",responsible_id:"",branch_id:"",type:"other",is_private:!1,due_date:"",create_todo:!1}),M([])}catch(a){var t,s;console.error("Create Request Error:",a);const e=a;E((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||d("createRequest.errors.createError"))}finally{_(!1)}},Y=()=>0===B.length?null:(0,y.jsx)("div",{className:"mt-2",children:(0,y.jsx)("ul",{className:"flex flex-wrap gap-2",children:B.map(((e,t)=>(0,y.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,y.jsx)("div",{className:"flex ml-2",children:(0,y.jsx)("button",{type:"button",onClick:()=>(e=>{const t=B[e];if(t&&(M((t=>t.filter(((t,r)=>r!==e)))),t.fileName)){const e=d("createRequest.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(t.fileName,"\\]\\(").concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(t.fileName,"\\]\\(").concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),a=S.description.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");R((0,l.A)((0,l.A)({},S),{},{description:a}))}})(t),className:"text-red-600 hover:text-red-900 ml-1",title:d("createRequest.form.remove"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,y.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,y.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},t)))})});return t?T?(0,y.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,y.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,y.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,y.jsxs)(m.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,y.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:d("createRequest.title")}),(0,y.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,y.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,y.jsxs)("div",{className:"p-4",children:[C&&(0,y.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:C}),(0,y.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.title")}),(0,y.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.title,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{title:e.target.value}))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.description")}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("textarea",{ref:W,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.description,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{description:e.target.value})),onPaste:I,onDrop:U,onDragOver:H,placeholder:d("createRequest.form.descriptionPlaceholder")}),(0,y.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:d("createRequest.form.addFile"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,y.jsx)("input",{ref:P,type:"file",onChange:Q,className:"hidden"}),F&&(0,y.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,y.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:d("createRequest.form.uploading")})})]}),Y(),S.description&&(0,y.jsx)("div",{className:"mt-3",children:(0,y.jsx)(p.A,{content:S.description,temporaryAttachments:B,showImagePreview:!0})})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.responsible")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.responsible_id,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{responsible_id:e.target.value})),children:[(0,y.jsx)("option",{value:"",children:d("createRequest.form.select")}),Array.isArray(j)&&j.map((e=>(0,y.jsx)("option",{value:e.id,children:z(e)},e.id)))]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.branch")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.branch_id,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{branch_id:e.target.value})),children:[(0,y.jsx)("option",{value:"",children:d("createRequest.form.select")}),Array.isArray(q)&&q.map((e=>(0,y.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.type")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.type,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{type:e.target.value})),children:[(0,y.jsx)("option",{value:"vacation",children:d("requests.types.vacation")}),(0,y.jsx)("option",{value:"improvement_suggestion",children:d("requests.types.improvement_suggestion")}),(0,y.jsx)("option",{value:"sick_leave",children:d("requests.types.sick_leave")}),(0,y.jsx)("option",{value:"employment_certificate",children:d("requests.types.employment_certificate")}),(0,y.jsx)("option",{value:"other",children:d("requests.types.other")})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.dueDate")}),(0,y.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.due_date,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{due_date:e.target.value}))})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"is_private",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.is_private,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{is_private:e.target.checked}))}),(0,y.jsx)("label",{htmlFor:"is_private",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:d("createRequest.form.isPrivate")})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"create_todo",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.create_todo,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{create_todo:e.target.checked}))}),(0,y.jsx)("label",{htmlFor:"create_todo",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:d("createRequest.form.createTodo")})]}),(0,y.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,y.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:d("createRequest.form.cancel"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:d(D?"createRequest.form.creating":"createRequest.form.create"),disabled:D,children:D?(0,y.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,y.jsx)(g.A,{className:"h-5 w-5"})})]})]})]})]})})]}):(0,y.jsxs)(y.Fragment,{children:[t&&!w&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,y.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,y.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,y.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:d("createRequest.title")}),(0,y.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,y.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,y.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[C&&(0,y.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:C}),(0,y.jsxs)("form",{onSubmit:$,className:"space-y-4","data-onboarding":"request-form",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.title")}),(0,y.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.title,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{title:e.target.value}))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.description")}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("textarea",{ref:W,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.description,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{description:e.target.value})),onPaste:I,onDrop:U,onDragOver:H,placeholder:d("createRequest.form.descriptionPlaceholder")}),(0,y.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:d("createRequest.form.addFile"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,y.jsx)("input",{ref:P,type:"file",onChange:Q,className:"hidden"}),F&&(0,y.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,y.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:d("createRequest.form.uploading")})})]}),Y(),S.description&&(0,y.jsx)("div",{className:"mt-3",children:(0,y.jsx)(p.A,{content:S.description,temporaryAttachments:B,showImagePreview:!0})})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.responsible")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.responsible_id,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{responsible_id:e.target.value})),children:[(0,y.jsx)("option",{value:"",children:d("createRequest.form.select")}),Array.isArray(j)&&j.map((e=>(0,y.jsx)("option",{value:e.id,children:z(e)},e.id)))]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.branch")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.branch_id,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{branch_id:e.target.value})),children:[(0,y.jsx)("option",{value:"",children:d("createRequest.form.select")}),Array.isArray(q)&&q.map((e=>(0,y.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.type")}),(0,y.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.type,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{type:e.target.value})),children:[(0,y.jsx)("option",{value:"vacation",children:d("requests.types.vacation")}),(0,y.jsx)("option",{value:"improvement_suggestion",children:d("requests.types.improvement_suggestion")}),(0,y.jsx)("option",{value:"sick_leave",children:d("requests.types.sick_leave")}),(0,y.jsx)("option",{value:"employment_certificate",children:d("requests.types.employment_certificate")}),(0,y.jsx)("option",{value:"other",children:d("requests.types.other")})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("createRequest.form.dueDate")}),(0,y.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.due_date,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{due_date:e.target.value}))})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"is_private_sidepane",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.is_private,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{is_private:e.target.checked}))}),(0,y.jsx)("label",{htmlFor:"is_private_sidepane",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:d("createRequest.form.isPrivate")})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"create_todo_sidepane",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.create_todo,onChange:e=>R((0,l.A)((0,l.A)({},S),{},{create_todo:e.target.checked}))}),(0,y.jsx)("label",{htmlFor:"create_todo_sidepane",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:d("createRequest.form.createTodo")})]}),(0,y.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,y.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:d("createRequest.form.cancel"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:d(D?"createRequest.form.creating":"createRequest.form.create"),disabled:D,children:D?(0,y.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,y.jsx)(g.A,{className:"h-5 w-5"})})]})]})]})]})]}):null};var v=r(9248);const w=e=>{let{isOpen:t,onClose:r,onRequestUpdated:n,request:l}=e;const{t:c,i18n:p}=(0,a.Bd)(),{user:f}=(0,i.As)(),w=e=>e?e.replace(/!\[([^\]]*)\]\([^)]+\)/g,"").trim():"";(0,s.useEffect)((()=>{0}),[p.language,c]);const{openSidepane:k,closeSidepane:j}=(0,b.N)(),[N,q]=(0,s.useState)(window.innerWidth>1070),[A,S]=(0,s.useState)(l.title),[R,C]=(0,s.useState)(w(l.description||"")),[E,D]=(0,s.useState)(l.responsible.id),[_,T]=(0,s.useState)(l.branch.id),[L,B]=(0,s.useState)(l.type||"other"),[M,F]=(0,s.useState)(l.isPrivate||!1),[O,P]=(0,s.useState)(l.dueDate?l.dueDate.split("T")[0]:""),[W,z]=(0,s.useState)(l.createTodo),[I,U]=(0,s.useState)([]),[H,V]=(0,s.useState)([]),[Q,$]=(0,s.useState)(null),[Y,K]=(0,s.useState)(!1),[G,Z]=(0,s.useState)(!1),[J,X]=(0,s.useState)(window.innerWidth<640),[ee,te]=(0,s.useState)(l.attachments||[]),[re,se]=(0,s.useState)(!1),[ae,ne]=(0,s.useState)([]),[le,oe]=(0,s.useState)([]),ie=(0,s.useRef)(null),de=(0,s.useRef)(null),{hasPermission:ce}=(0,d.S)(),ue=ce("requests","both","table");(0,s.useEffect)((()=>{if(!t&&le.length>0){(async()=>{for(const t of le)try{await o.A.delete(u.Sn.REQUESTS.ATTACHMENT(l.id,t)),console.log("Attachment ".concat(t," gel\xf6scht (Modal ohne Speichern geschlossen)"))}catch(e){console.error("Fehler beim L\xf6schen von Attachment ".concat(t,":"),e)}oe([])})()}}),[t,le,l.id]),(0,s.useEffect)((()=>{const e=()=>{X(window.innerWidth<640),q(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?k():j(),()=>{j()})),[t,k,j]),(0,s.useEffect)((()=>{t&&(me(),he(),S(l.title),C(w(l.description||"")),D(l.responsible.id),T(l.branch.id),B(l.type||"other"),F(l.isPrivate||!1),P(l.dueDate?l.dueDate.split("T")[0]:""),z(l.createTodo))}),[t,l]);const me=async()=>{try{$(null);if(!localStorage.getItem("token"))return void $(c("createRequest.editRequest.errors.notAuthenticated"));const[e,t]=await Promise.all([o.A.get(u.Sn.USERS.DROPDOWN),o.A.get(u.Sn.BRANCHES.BASE)]);U(e.data||[]),V(t.data||[])}catch(r){console.error("Unerwarteter Fehler:",r);const s=r;var e,t;if("ERR_NETWORK"===s.code)$(c("createRequest.editRequest.errors.connectionError"));else $("".concat(c("createRequest.editRequest.errors.loadError"),": ").concat((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message))}},he=async()=>{try{$(null);const e=await o.A.get(u.Sn.REQUESTS.ATTACHMENTS(l.id));te(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",r),te([]);const s=r,a=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message;console.warn("Anh\xe4nge konnten nicht geladen werden: ".concat(a))}},xe=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await be(t))}}},ge=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await be(t)}},pe=e=>{e.preventDefault(),e.stopPropagation()},be=async e=>{se(!0),$(null);try{const t=new FormData;t.append("file",e);const r=(await o.A.post(u.Sn.REQUESTS.ATTACHMENTS(l.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;if(te([...ee,r]),oe((e=>[...e,r.id])),!r.fileType.startsWith("image/")){const e="\n[".concat(r.fileName,"](").concat((0,u.S1)(l.id,r.id),")\n");if(ie.current){const t=ie.current.selectionStart,r=R.substring(0,t),s=R.substring(t);C(r+e+s),setTimeout((()=>{if(ie.current){const r=t+e.length;ie.current.selectionStart=r,ie.current.selectionEnd=r,ie.current.focus()}}),0)}else C(R+e)}const s=document.createElement("img");s.src=(0,u.S1)(l.id,r.id),s.alt=r.fileName,s.classList.add("hidden"),document.body.appendChild(s),s.onload=()=>{document.body.removeChild(s)}}catch(s){var t,r;console.error("Fehler beim Hochladen der Datei:",s);const e=s;$((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||c("createRequest.editRequest.errors.unknownError"))}finally{se(!1)}},ye=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await be(r),de.current&&(de.current.value="")},fe=async e=>{e.preventDefault(),$(null),Z(!0);try{if(!localStorage.getItem("token"))throw new Error(c("createRequest.editRequest.errors.notAuthenticated"));const e=l.description||"";let t=R||"";const s=ee.filter((e=>{var t;return(null===(t=e.fileType)||void 0===t?void 0:t.startsWith("image/"))&&e.id})),a=/!\[([^\]]*)\]\([^)]+\)/g,i=[];let d;if(e)for(;null!==(d=a.exec(e));)i.push(d[0]);for(const r of s){const e=(0,u.S1)(l.id,r.id),s="![".concat(r.fileName,"](").concat(e,")"),a=r.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp("!\\[".concat(a,"\\]\\([^)]+\\)"),"g").test(t)||(t=t?"".concat(t,"\n").concat(s):s)}for(const r of i)t.includes(r)||(t=t?"".concat(t,"\n").concat(r):r);await o.A.put(u.Sn.REQUESTS.BY_ID(l.id),{title:A,description:t,responsible_id:E,branch_id:_,type:L,is_private:M,due_date:O||null,create_todo:W});const m=await o.A.get(u.Sn.REQUESTS.BY_ID(l.id));m.data.attachments?m.data.attachments=m.data.attachments.map((e=>({id:e.id,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,filePath:e.filePath,uploadedAt:e.uploadedAt,url:(0,u.S1)(l.id,e.id)}))):m.data.attachments=[],oe([]),r(),n&&n(m.data)}catch(a){var t,s;console.error("Fehler beim Aktualisieren des Requests:",a);const e=a;$((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||c("createRequest.editRequest.errors.unknownError"))}finally{Z(!1)}},ve=async()=>{if(Y)try{Z(!0),await o.A.delete(u.Sn.REQUESTS.BY_ID(l.id)),r()}catch(s){var e,t;console.error("Delete Error:",s);const r=s;$((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||c("createRequest.editRequest.errors.unknownError"))}finally{Z(!1)}else K(!0)},we=()=>0===ee.length?null:(0,y.jsx)("div",{className:"mt-2",children:(0,y.jsx)("ul",{className:"flex flex-wrap gap-2",children:ee.map((e=>(0,y.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,y.jsxs)("div",{className:"flex ml-2",children:[(0,y.jsx)("button",{type:"button",onClick:()=>(async e=>{try{if(void 0===e.id)throw new Error("Anhang-ID fehlt");const t=await o.A.get(u.Sn.REQUESTS.ATTACHMENT(l.id,e.id),{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=r,s.setAttribute("download",e.fileName),document.body.appendChild(s),s.click(),s.remove()}catch(s){var t,r;console.error("Fehler beim Herunterladen des Anhangs:",s);const e=s;$((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||c("createRequest.editRequest.errors.unknownError"))}})(e),className:"text-blue-600 hover:text-blue-900 mr-1",title:c("createRequest.editRequest.form.download"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,y.jsx)("button",{type:"button",onClick:()=>void 0!==e.id&&(async e=>{try{$(null);const t=ee.find((t=>t.id===e));if(t&&(await o.A.delete(u.Sn.REQUESTS.ATTACHMENT(l.id,e)),te(ee.filter((t=>t.id!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp("!\\[(.*?)\\]\\(".concat(e,"\\)"),"g"),s=new RegExp("\\[(.*?)\\]\\(".concat(e,"\\)"),"g"),a=R.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");C(a)}}catch(s){var t,r;console.error("Fehler beim L\xf6schen des Anhangs:",s);const e=s;$((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||c("createRequest.editRequest.errors.unknownError"))}})(e.id),className:"text-red-600 hover:text-red-900 ml-1",title:c("createRequest.editRequest.form.remove"),disabled:void 0===e.id,children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.fileType.startsWith("image/")&&e.id&&(0,y.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,y.jsx)("img",{src:(0,u.S1)(l.id,e.id),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id||"temp-".concat(e.fileName))))})}),ke=()=>0===ae.length?null:(0,y.jsx)("div",{className:"mt-2",children:(0,y.jsx)("ul",{className:"flex flex-wrap gap-2",children:ae.map(((e,t)=>(0,y.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,y.jsx)("div",{className:"flex ml-2",children:(0,y.jsx)("button",{type:"button",onClick:()=>(e=>{const t=ae[e];if(t&&(ne(ae.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=c("createRequest.editRequest.form.uploadAfterCreate"),s=new RegExp("!\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),a=new RegExp("\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=R.replace(s,"").replace(a,"").replace(/\n{3,}/g,"\n\n");C(n)}})(t),className:"text-red-600 hover:text-red-900 ml-1",title:c("createRequest.editRequest.form.remove"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,y.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,y.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},"temp-".concat(t))))})});if(!t)return null;const je=()=>(0,y.jsxs)("form",{onSubmit:fe,className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.title")}),(0,y.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:A,onChange:e=>S(e.target.value)})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"description_request_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.description")}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("textarea",{ref:ie,rows:J?5:10,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:R,onChange:e=>C(e.target.value),onPaste:xe,onDrop:ge,onDragOver:pe}),(0,y.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=de.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:c("createRequest.editRequest.form.fileUpload"),children:(0,y.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,y.jsx)("input",{ref:de,type:"file",onChange:ye,className:"hidden"}),re&&(0,y.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,y.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:c("createRequest.editRequest.form.uploading")})})]}),we(),ke()]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.responsible")}),(0,y.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:E,onChange:e=>D(Number(e.target.value)),children:I.map((e=>(0,y.jsxs)("option",{value:e.id,children:[e.firstName," (",e.username,")"]},e.id)))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.branch")}),(0,y.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:_,onChange:e=>T(Number(e.target.value)),children:H.map((e=>(0,y.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.type")}),(0,y.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:L,onChange:e=>B(e.target.value),children:[(0,y.jsx)("option",{value:"vacation",children:c("requests.types.vacation")}),(0,y.jsx)("option",{value:"improvement_suggestion",children:c("requests.types.improvement_suggestion")}),(0,y.jsx)("option",{value:"sick_leave",children:c("requests.types.sick_leave")}),(0,y.jsx)("option",{value:"employment_certificate",children:c("requests.types.employment_certificate")}),(0,y.jsx)("option",{value:"other",children:c("requests.types.other")})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.dueDate")}),(0,y.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:O,onChange:e=>P(e.target.value)})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"is_private_edit",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:border-gray-600",checked:M,onChange:e=>F(e.target.checked)}),(0,y.jsx)("label",{htmlFor:"is_private_edit",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.isPrivate")})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"create_todo_edit",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:border-gray-600",checked:W,onChange:e=>z(e.target.checked)}),(0,y.jsx)("label",{htmlFor:"create_todo_edit",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:c("createRequest.editRequest.form.createTodo")})]}),(0,y.jsxs)("div",{className:"flex justify-between pt-4",children:[ue&&(0,y.jsx)("button",{type:"button",onClick:ve,className:"p-2 rounded-md ".concat(Y?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),title:c(Y?"createRequest.editRequest.form.confirmDelete":"createRequest.editRequest.form.delete"),children:Y?(0,y.jsx)(g.A,{className:"h-5 w-5"}):(0,y.jsx)(v.A,{className:"h-5 w-5"})}),(0,y.jsxs)("div",{className:"flex gap-2",children:[(0,y.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:c("createRequest.editRequest.form.cancel"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:c(G?"createRequest.editRequest.form.saving":"createRequest.editRequest.form.save"),disabled:G,children:G?(0,y.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,y.jsx)(g.A,{className:"h-5 w-5"})})]})]})]});return J?(0,y.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,y.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,y.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,y.jsxs)(m.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,y.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:c("createRequest.editRequest.title")}),(0,y.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,y.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,y.jsxs)("div",{className:"p-4",children:[Q&&(0,y.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Q}),je()]})]})})]}):(0,y.jsxs)(y.Fragment,{children:[t&&!N&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,y.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,y.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,y.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:c("createRequest.editRequest.title")}),(0,y.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,y.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,y.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Q&&(0,y.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Q}),je()]})]})]})};var k=r(8897),j=r(4426),N=r(7829),q=r(6400),A=r(1853),S=r(8662),R=r(2704),C=r(4850),E=r(1663),D=r(8010),_=r(1909),T=r(1252),L=r(9399),B=r(2811),M=r(3744),F=r(6238),O=r(4129),P=r(7988),W=r(2517),z=r(9837),I=r(887),U=r(957),H=r(637),V=r(1052);const Q=e=>{switch(e){case"vacation":return"\ud83c\udfd6\ufe0f";case"improvement_suggestion":return"\ud83d\udca1";case"sick_leave":return"\ud83e\udd12";case"employment_certificate":return"\ud83d\udcc4";default:return"\ud83d\udcdd"}},$=["title","requestedByResponsible","status","type","dueDate","branch","actions"],Y="requests-table",K={title:["title"],status:["status"],type:["type"],requestedByResponsible:["requestedBy","responsible"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},G={title:"title",status:"status",type:"type",requestedBy:"requestedByResponsible",responsible:"requestedByResponsible",branch:"branch",dueDate:"dueDate",description:"description"},Z=()=>{const{t:e}=(0,a.Bd)(),[t,r]=(0,s.useState)([]),[n,m]=(0,s.useState)(!0),[b,v]=(0,s.useState)(null),[Z,J]=(0,s.useState)(""),[X,ee]=(0,s.useState)([]),[te,re]=(0,s.useState)([]),[se,ae]=(0,s.useState)(""),[ne,le]=(0,s.useState)(null),[oe,ie]=(0,s.useState)(!1),[de,ce]=(0,s.useState)({key:"dueDate",direction:"asc"}),[ue,me]=(0,s.useState)(!1),[he,xe]=(0,s.useState)(!1),[ge,pe]=(0,s.useState)(null),{user:be}=(0,i.As)(),{hasPermission:ye}=(0,d.S)(),fe=(0,s.useMemo)((()=>[{id:"title",label:e("requests.columns.title"),shortLabel:e("requests.columns.title")},{id:"status",label:e("requests.columns.status"),shortLabel:e("requests.columns.status")},{id:"type",label:e("requests.columns.type"),shortLabel:e("requests.columns.type")},{id:"requestedByResponsible",label:e("requests.columns.requestedByResponsible"),shortLabel:e("requests.columns.requestedByResponsible").split("/")[0]},{id:"branch",label:e("requests.columns.branch"),shortLabel:e("requests.columns.branch").substring(0,5)},{id:"dueDate",label:e("requests.columns.dueDate"),shortLabel:e("requests.columns.dueDate").substring(0,5)},{id:"actions",label:e("requests.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),{settings:ve,isLoading:we,updateColumnOrder:ke,updateHiddenColumns:je,toggleColumnVisibility:Ne,isColumnVisible:qe,updateViewMode:Ae}=(0,c.F)("dashboard_requests",{defaultColumnOrder:$,defaultHiddenColumns:[],defaultViewMode:"cards"}),[Se,Re]=(0,s.useState)(null),[Ce,Ee]=(0,s.useState)(null),[De,_e]=(0,s.useState)(10),Te=ve.viewMode||"cards",[Le,Be]=(0,s.useState)((()=>({title:"asc",status:"asc",type:"asc",requestedBy:"asc",responsible:"asc",branch:"asc",dueDate:"asc",description:"asc"}))),Me=(0,s.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const r=K[e];r&&r.length>0&&t.push(...r)})),t.includes("type")||t.push("type"),t.includes("description")||t.push("description"),t})(ve.columnOrder||$)),[ve.columnOrder]),Fe=(0,s.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{"type"!==e&&(K[e]||[]).forEach((e=>{"type"!==e&&t.add(e)}))})),t})(ve.hiddenColumns||[])),[ve.hiddenColumns]),Oe=(0,s.useMemo)((()=>new Set(Me.filter((e=>!Fe.has(e))))),[Me,Fe]);(0,s.useEffect)((()=>{const e=document.querySelector(".dashboard-requests-wrapper");e&&("cards"===Te?e.classList.add("cards-mode"):e.classList.remove("cards-mode"))}),[Te]);const Pe=async()=>{try{m(!0);const e=await o.A.get("/requests"),t=e.data.map((e=>{const t=(e.attachments||[]).map((t=>({id:t.id,fileName:t.fileName,fileType:t.fileType,fileSize:t.fileSize,filePath:t.filePath,uploadedAt:t.uploadedAt,url:(0,u.S1)(e.id,t.id)})));return(0,l.A)((0,l.A)({},e),{},{attachments:t})}));r(t),v(null)}catch(s){console.error("Request Error:",s);const r=s;var e,t;if("ERR_NETWORK"===r.code)v("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft.");else v("Fehler beim Laden der Requests: ".concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}finally{m(!1)}};(0,s.useEffect)((()=>{Pe()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const t=localStorage.getItem("token");if(!t)return void console.error("Nicht authentifiziert");const r=(await o.A.get("".concat(u.Sn.SAVED_FILTERS.BY_TABLE(Y)),{headers:{Authorization:"Bearer ".concat(t)}})).data||[],s=r.some((t=>"Archiv"===t.name||t.name===e("requests.filters.archiv")||"Archivo"===t.name)),a=r.some((t=>"Aktuell"===t.name||t.name===e("requests.filters.aktuell")||"Actual"===t.name));if(!s){const e={tableId:Y,name:"Archiv",conditions:[{column:"status",operator:"equals",value:"approved"},{column:"status",operator:"equals",value:"denied"}],operators:["OR"]};await o.A.post("".concat(u.Sn.SAVED_FILTERS.BASE),e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),console.log("Archiv-Filter f\xfcr Requests erstellt")}if(!a){const e={tableId:Y,name:"Aktuell",conditions:[{column:"status",operator:"notEquals",value:"approved"},{column:"status",operator:"notEquals",value:"denied"}],operators:["AND"]};await o.A.post("".concat(u.Sn.SAVED_FILTERS.BASE),e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),console.log("Aktuell-Filter f\xfcr Requests erstellt")}}catch(b){console.error("Fehler beim Erstellen der Standard-Filter:",b)}})()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const e=await o.A.get(u.Sn.SAVED_FILTERS.BY_TABLE(Y)),t=e.data.find((e=>"Aktuell"===e.name||"Actual"===e.name));t&&(ae("Aktuell"),le(t.id),Qe(t.conditions,t.operators))}catch(b){console.error("Fehler beim Setzen des initialen Filters:",b)}})()}),[]);const We=async(e,s)=>{try{const a=t.find((t=>t.id===e));if(!a)return void v("Request nicht gefunden");r((t=>t.map((t=>t.id===e?(0,l.A)((0,l.A)({},t),{},{status:s}):t)))),await o.A.put("/requests/".concat(e),{status:s,create_todo:a.createTodo})}catch(i){var a,n;console.error("Status Update Error:",i),Pe();const e=i;v("Fehler beim Aktualisieren des Status: ".concat((null===(a=e.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten"))}},ze=(0,s.useCallback)(((e,t)=>{const r=[...ve.columnOrder],s=r[e];r.splice(e,1),r.splice(t,0,s),ke(r)}),[ve.columnOrder,ke]),Ie=e=>{Re(e)},Ue=(e,t)=>{e.preventDefault(),Se&&Se!==t&&Ee(t)},He=(e,t)=>{if(e.preventDefault(),Se&&Se!==t){const e=ve.columnOrder.indexOf(Se),r=ve.columnOrder.indexOf(t);e>-1&&r>-1&&ze(e,r)}Re(null),Ee(null)},Ve=()=>{Re(null),Ee(null)},Qe=(e,t)=>{ee(e),re(t)},$e=()=>{ee([]),re([]),ae(""),le(null)},Ye=()=>X.length,Ke=(0,s.useMemo)((()=>t.filter((e=>{if(Z){const t=Z.toLowerCase();if(!(e.title.toLowerCase().includes(t)||"".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName).toLowerCase().includes(t)||"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)))return!1}if(X.length>0){const t={title:(e,t)=>{const r=(t.value||"").toLowerCase(),s=e.title.toLowerCase();return"equals"===t.operator?e.title===t.value:"contains"===t.operator?s.includes(r):"startsWith"===t.operator?s.startsWith(r):"endsWith"===t.operator?s.endsWith(r):null},status:(e,t)=>"equals"===t.operator?e.status===t.value:"notEquals"===t.operator?e.status!==t.value:null,type:(e,t)=>{const r=e.type||"other";return"equals"===t.operator?r===t.value:"notEquals"===t.operator?r!==t.value:null},requestedBy:(e,t)=>{const r="".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName).toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},responsible:(e,t)=>{const r="".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},branch:(e,t)=>{const r=e.branch.name.toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},dueDate:(e,t)=>(0,q.J1)(e.dueDate,t)},r=(e,t)=>{switch(t){case"title":return e.title;case"status":return e.status;case"type":return e.type||"other";case"requestedBy":return"".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName);case"responsible":return"".concat(e.responsible.firstName," ").concat(e.responsible.lastName);case"branch":return e.branch.name;case"dueDate":return e.dueDate;default:return e[t]}};if(0===(0,q.W5)([e],X,te,r,t).length)return!1}return!0})).sort(((e,t)=>{var r,s,a,n;if("cards"===Te){const l=Me.filter((e=>Oe.has(e)));for(const o of l){let l,i;switch(o){case"title":l=e.title.toLowerCase(),i=t.title.toLowerCase();break;case"status":const o={approval:0,to_improve:1,approved:2,denied:3};l=null!==(r=o[e.status])&&void 0!==r?r:999,i=null!==(s=o[t.status])&&void 0!==s?s:999;break;case"type":const d={vacation:0,improvement_suggestion:1,sick_leave:2,employment_certificate:3,other:4};l=null!==(a=d[e.type||"other"])&&void 0!==a?a:999,i=null!==(n=d[t.type||"other"])&&void 0!==n?n:999;break;case"requestedBy":l="".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName).toLowerCase(),i="".concat(t.requestedBy.firstName," ").concat(t.requestedBy.lastName).toLowerCase();break;case"responsible":l="".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase(),i="".concat(t.responsible.firstName," ").concat(t.responsible.lastName).toLowerCase();break;case"branch":l=e.branch.name.toLowerCase(),i=t.branch.name.toLowerCase();break;case"dueDate":l=new Date(e.dueDate).getTime(),i=new Date(t.dueDate).getTime();break;case"description":l=(e.description||"").toLowerCase(),i=(t.description||"").toLowerCase();break;default:continue}const d=Le[o]||"asc";if(l<i)return"asc"===d?-1:1;if(l>i)return"asc"===d?1:-1}return 0}{let r=e[de.key],s=t[de.key];if("requestedBy.firstName"===de.key)r=e.requestedBy.firstName,s=t.requestedBy.firstName;else if("responsible.firstName"===de.key)r=e.responsible.firstName,s=t.responsible.firstName;else if("branch.name"===de.key)r=e.branch.name,s=t.branch.name;else if("type"===de.key){var l,o;const a={vacation:0,improvement_suggestion:1,sick_leave:2,employment_certificate:3,other:4};r=null!==(l=a[e.type||"other"])&&void 0!==l?l:999,s=null!==(o=a[t.type||"other"])&&void 0!==o?o:999}return r<s?"asc"===de.direction?-1:1:r>s?"asc"===de.direction?1:-1:0}}))),[t,Z,de,X,te,Te,Me,Oe,Le]),Ge=async e=>{try{if(!be)return void v("Benutzer nicht authentifiziert");const t={title:"".concat(e.title,"-Kopie"),responsible_id:e.responsible.id,branch_id:e.branch.id,type:e.type||"other",is_private:e.isPrivate||!1,due_date:e.dueDate?e.dueDate.split("T")[0]:"",create_todo:e.createTodo,requested_by_id:be.id},s=await o.A.post(u.Sn.REQUESTS.BASE,t);r((e=>[s.data,...e])),pe(s.data),xe(!0)}catch(a){var t,s;console.error("Fehler beim Kopieren des Requests:",a);const e=a;v((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}};if(n)return(0,y.jsx)("div",{className:"p-4",children:e("common.loading")});if(b)return(0,y.jsx)("div",{className:"p-4 text-red-600",children:b});const Ze=ve.columnOrder.filter((e=>qe(e)));return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(f,{isOpen:ue,onClose:()=>me(!1),onRequestCreated:e=>{r((t=>[e,...t])),xe(!0),pe(e)}}),ge&&(0,y.jsx)(w,{isOpen:he,onClose:()=>{xe(!1),pe(null)},onRequestUpdated:e=>{r((t=>t.map((t=>t.id===e.id?e:t)))),xe(!1),pe(null)},request:ge}),(0,y.jsxs)("div",{className:"cards"===Te?"":"border-0 rounded-lg","data-view-mode":Te,children:[(0,y.jsxs)("div",{className:"flex items-center mb-4 justify-between px-3 sm:px-4 md:px-6",children:[(0,y.jsx)("div",{className:"flex items-center",children:ye("requests","write","table")&&(0,y.jsx)("button",{onClick:()=>me(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("requests.createRequest"),"aria-label":e("requests.createRequest"),"data-onboarding":"create-request-button",children:(0,y.jsx)(S.A,{className:"h-4 w-4"})})}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)(R.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,y.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("requests.title")})]}),(0,y.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,y.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:Z,onChange:e=>J(e.target.value)}),(0,y.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Te?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Ae("table"===Te?"cards":"table"),title:e("table"===Te?"common.viewAsCards":"common.viewAsTable"),children:"table"===Te?(0,y.jsx)(C.A,{className:"h-5 w-5"}):(0,y.jsx)(E.A,{className:"h-5 w-5"})}),(0,y.jsxs)("button",{className:"p-2 rounded-md ".concat(Ye()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>ie(!oe),title:e("common.filter"),style:{position:"relative"},children:[(0,y.jsx)(D.A,{className:"h-5 w-5"}),Ye()>0&&(0,y.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",style:{position:"absolute",top:"-0.25rem",right:"-0.25rem"},children:Ye()})]}),(0,y.jsx)("div",{className:"ml-1",children:(0,y.jsx)(k.A,{columns:"cards"===Te?[{id:"title",label:e("requests.columns.title")},{id:"status",label:e("requests.columns.status")},{id:"type",label:e("requests.columns.type")},{id:"requestedBy",label:e("requests.columns.requestedBy")},{id:"responsible",label:e("requests.columns.responsible")},{id:"branch",label:e("requests.columns.branch")},{id:"dueDate",label:e("requests.columns.dueDate")},{id:"description",label:e("common.description")}]:fe,visibleColumns:"cards"===Te?Array.from(Oe):Ze,columnOrder:"cards"===Te?Me:ve.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Te){const t=G[e];if(t)if("requestedByResponsible"===t){const r="requestedBy"===e?"responsible":"requestedBy",s=Fe.has(r),a=ve.hiddenColumns.includes(t);a&&!s||!a&&s?Ne(t):a||Ne(t)}else Ne(t)}else Ne(e)},onMoveColumn:"cards"===Te?(e,t)=>{const r=[...Me],s=r[e];r.splice(e,1),r.splice(t,0,s);const a=[],n=new Set;r.forEach((e=>{const t=G[e];t&&!n.has(t)&&(a.push(t),n.add(t))})),ve.columnOrder.forEach((e=>{a.includes(e)||a.push(e)})),ke(a)}:ze,onClose:()=>{},buttonTitle:e("cards"===Te?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Te?"tableColumn.sortAndDisplay":"tableColumn.configure"),sortDirections:"cards"===Te?Le:void 0,onSortDirectionChange:"cards"===Te?(e,t)=>{Be((r=>(0,l.A)((0,l.A)({},r),{},{[e]:t})))}:void 0,showSortDirection:"cards"===Te})})]})]}),oe&&(0,y.jsx)("div",{className:"cards"===Te?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,y.jsx)(j.A,{columns:[{id:"title",label:e("requests.columns.title")},{id:"status",label:e("requests.columns.status")},{id:"type",label:e("requests.columns.type")},{id:"requestedBy",label:e("requests.columns.requestedBy")},{id:"responsible",label:e("requests.columns.responsible")},{id:"branch",label:e("requests.columns.branch")},{id:"dueDate",label:e("requests.columns.dueDate")}],onApply:Qe,onReset:$e,savedConditions:X,savedOperators:te,tableId:Y})}),(0,y.jsx)("div",{className:"cards"===Te?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,y.jsx)(N.A,{tableId:Y,onSelectFilter:Qe,onReset:$e,activeFilterName:se,selectedFilterId:ne,onFilterChange:(e,t,r,s)=>{ae(e),le(t),Qe(r,s)},defaultFilterName:"Aktuell"})}),"table"===Te?(0,y.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,y.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,y.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,y.jsx)("tr",{children:Ze.map((e=>{const t=fe.find((t=>t.id===e));if(!t)return null;if("requestedByResponsible"===e)return(0,y.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-move relative",draggable:!0,onDragStart:()=>Ie(e),onDragOver:t=>Ue(t,e),onDrop:t=>He(t,e),onDragEnd:Ve,children:(0,y.jsxs)("div",{className:"flex items-center ".concat(Ce===e?"border-l-2 pl-1 border-blue-500":""," ").concat(Se===e?"opacity-50":""),children:[(0,y.jsx)(_.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,y.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,y.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel})]})},e);let r;return"title"===e&&(r="title"),"status"===e&&(r="status"),"type"===e&&(r="type"),"branch"===e&&(r="branch.name"),"dueDate"===e&&(r="dueDate"),(0,y.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider relative ".concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==e?"cursor-move":""),onClick:r?()=>{return e=r,void ce((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})));var e}:void 0,draggable:"actions"!==e,onDragStart:"actions"!==e?()=>Ie(e):void 0,onDragOver:"actions"!==e?t=>Ue(t,e):void 0,onDrop:"actions"!==e?t=>He(t,e):void 0,onDragEnd:"actions"!==e?Ve:void 0,children:(0,y.jsxs)("div",{className:"flex items-center ".concat(Ce===e?"border-l-2 pl-1 border-blue-500":""," ").concat(Se===e?"opacity-50":""),children:["actions"!==e&&(0,y.jsx)(_.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,y.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,y.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel}),r&&de.key===r&&("asc"===de.direction?"\u2191":"\u2193")]})},e)}))})}),(0,y.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===Ke.length?(0,y.jsx)("tr",{children:(0,y.jsx)("td",{colSpan:Ze.length,className:"px-3 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,y.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,y.jsx)(R.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,y.jsx)("div",{className:"text-sm",children:"Keine Requests gefunden"})]})})}):(0,y.jsx)(y.Fragment,{children:Ke.slice(0,De).map((t=>{const r=(0,V.go)(t.dueDate,"request"),s=(0,V.F2)(r);return(0,y.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:Ze.map((r=>{switch(r){case"title":return(0,y.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,y.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,y.jsxs)("div",{className:"ml-2 relative group",children:[(0,y.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("common.description"),children:(0,y.jsx)(T.A,{className:"h-5 w-5"})}),(0,y.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,y.jsx)(p.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,A.qY)(t.status,"request")," dark:bg-opacity-30 status-col"),children:(s=t.status,(0,A.Iw)(s,"request",e))})},r);case"type":return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-900 dark:text-gray-200",children:[(0,y.jsx)("span",{className:"text-lg",children:Q(t.type)}),(0,y.jsx)("span",{children:t.type?e("requests.types.".concat(t.type)):e("requests.types.other")}),t.isPrivate&&(0,y.jsx)("span",{className:"ml-1 text-xs text-gray-500 dark:text-gray-400",title:e("createRequest.form.isPrivate"),children:"\ud83d\udd12"})]})},r);case"requestedByResponsible":return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex flex-col",children:[(0,y.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,y.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.requestedBy"),":"]}),(0,y.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.requestedBy").substring(0,5),":"]}),(0,y.jsx)("br",{}),"".concat(t.requestedBy.firstName," ").concat(t.requestedBy.lastName)]}),(0,y.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,y.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.responsible"),":"]}),(0,y.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.responsible").substring(0,4),":"]}),(0,y.jsx)("br",{}),"".concat(t.responsible.firstName," ").concat(t.responsible.lastName)]})]})},r);case"branch":return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const a=(0,V.go)(t.dueDate,"request"),n=(0,V.F2)(a);return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"text-sm ".concat("none"!==a?n.textClass:"text-gray-900 dark:text-gray-200"),children:[new Date(t.dueDate).toLocaleDateString(),"none"!==a&&(0,y.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,y.jsxs)("div",{className:"status-buttons",children:["approval"===t.status&&ye("requests","write","table")&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:()=>We(t.id,"approved"),className:"p-1 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",title:e("requests.actions.approve"),children:(0,y.jsx)(g.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>We(t.id,"to_improve"),className:"p-1 bg-orange-600 dark:bg-orange-500 text-white rounded hover:bg-orange-700 dark:hover:bg-orange-600",title:e("requests.actions.improve"),children:(0,y.jsx)(L.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>We(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("requests.actions.deny"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})})]}),"to_improve"===t.status&&ye("requests","write","table")&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:()=>We(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",title:e("requests.actions.recheck"),children:(0,y.jsx)(x.A,{className:"h-5 w-5"})}),(0,y.jsx)("button",{onClick:()=>We(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("requests.actions.deny"),children:(0,y.jsx)(h.A,{className:"h-5 w-5"})})]}),("approved"===t.status||"denied"===t.status)&&ye("requests","write","table")&&(0,y.jsx)("button",{onClick:()=>We(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",title:e("requests.actions.recheck"),children:(0,y.jsx)(x.A,{className:"h-5 w-5"})})]}),ye("requests","write","table")&&(0,y.jsx)("button",{onClick:()=>{pe(t),xe(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 edit-button ml-0.5",children:(0,y.jsx)(B.A,{className:"h-5 w-5"})}),ye("requests","both","table")&&(0,y.jsx)("button",{onClick:()=>Ge(t),className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300 copy-button ml-0.5",title:e("requests.actions.copy"),children:(0,y.jsx)(M.A,{className:"h-5 w-5"})})]})},r);default:return null}var s}))},t.id)}))})})]})}):(0,y.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:0===Ke.length?(0,y.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,y.jsx)(R.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,y.jsx)("div",{className:"text-sm",children:e("requests.createRequest.noRequestsFound")})]}):(0,y.jsx)(H.A,{children:Ke.slice(0,De).map((t=>{const r=[];if(Oe.has("branch")&&r.push({icon:(0,y.jsx)(F.A,{className:"h-4 w-4"}),label:e("requests.columns.branch"),value:t.branch.name,section:"left"}),Oe.has("type")){const s=Q(t.type),a=t.type?e("requests.types.".concat(t.type)):e("requests.types.other");r.push({label:"",value:"".concat(s," ").concat(a).concat(t.isPrivate?" \ud83d\udd12":""),section:"main"})}if(Oe.has("requestedBy")){const s="".concat(t.requestedBy.firstName," ").concat(t.requestedBy.lastName),a=s.length>4?s.substring(0,4):s;r.push({icon:(0,y.jsx)(O.A,{className:"h-4 w-4"}),label:e("requests.columns.requestedBy"),value:a,section:"main-second"})}if(Oe.has("responsible")){const s="".concat(t.responsible.firstName," ").concat(t.responsible.lastName),a=s.length>4?s.substring(0,4):s;r.push({icon:(0,y.jsx)(O.A,{className:"h-4 w-4"}),label:e("requests.columns.responsible"),value:a,section:"main-third"})}if(Oe.has("dueDate")){const s=(0,V.Rj)(t.dueDate,"request",void 0,void 0,(0,y.jsx)(P.A,{className:"h-4 w-4"}),e("requests.columns.dueDate"),(e=>(0,z.GP)(e,"dd.MM.yyyy",{locale:I.de})),!1);r.push((0,l.A)((0,l.A)({},s),{},{section:"right-inline"}))}Oe.has("description")&&t.description&&r.push({label:e("common.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const s=(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:["approval"===t.status&&ye("requests","write","table")&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"approved")},className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700",title:e("requests.actions.approve"),children:(0,y.jsx)(g.A,{className:"h-4 w-4"})}),(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"to_improve")},className:"p-1.5 bg-orange-600 text-white rounded hover:bg-orange-700",title:e("requests.actions.improve"),children:(0,y.jsx)(L.A,{className:"h-4 w-4"})}),(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:e("requests.actions.deny"),children:(0,y.jsx)(h.A,{className:"h-4 w-4"})})]}),"to_improve"===t.status&&ye("requests","write","table")&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",title:e("requests.actions.recheck"),children:(0,y.jsx)(x.A,{className:"h-4 w-4"})}),(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:e("requests.actions.deny"),children:(0,y.jsx)(h.A,{className:"h-4 w-4"})})]}),("approved"===t.status||"denied"===t.status)&&ye("requests","write","table")&&(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),We(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",title:e("requests.actions.recheck"),children:(0,y.jsx)(x.A,{className:"h-4 w-4"})}),ye("requests","write","table")&&(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),pe(t),xe(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,y.jsx)(B.A,{className:"h-4 w-4"})}),ye("requests","both","table")&&(0,y.jsx)("button",{onClick:e=>{e.stopPropagation(),Ge(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("requests.actions.copy"),children:(0,y.jsx)(M.A,{className:"h-4 w-4"})})]}),a=(e=>{switch(e){case"to_improve":case"approved":case"denied":return"approval";default:return null}})(t.status),n=(e=>{switch(e){case"approval":return["approved","to_improve","denied"];case"to_improve":return["denied"];default:return[]}})(t.status),o=n.length>0?n[0]:null;return(0,y.jsx)(U.A,{title:t.title,status:{label:(0,A.Iw)(t.status,"request",e),color:(0,A.qY)(t.status,"request"),onPreviousClick:a&&ye("requests","write","table")?()=>We(t.id,a):void 0,onNextClick:o&&ye("requests","write","table")?()=>We(t.id,o):void 0},metadata:r,actions:s},t.id)}))})}),Ke.length>De&&(0,y.jsx)("div",{className:"mt-4 flex justify-center",children:(0,y.jsx)("button",{className:"p-2 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>_e((e=>e+10)),title:"".concat(e("common.showMore")," (").concat(Ke.length-De," ").concat(e("common.remaining"),")"),children:(0,y.jsx)(W.A,{className:"h-5 w-5"})})})]})]})};var J=r(2316);function X(e,t){return(0,J.a)(e,null===t||void 0===t?void 0:t.in).getFullYear()}var ee=r(2750),te=r(1620),re=r(4057),se=r(6511),ae=r(5648),ne=r(3315),le=r(8416),oe=r(8658),ie=r(1713),de=r(2395);const ce=(e,t)=>{const[r,s,a]=e.split("-").map((e=>parseInt(e))),n=new Date(r,s-1,a,12,0,0);return n.setDate(n.getDate()+t),(0,z.GP)(n,"yyyy-MM-dd")},ue=()=>{var e;const{t:t,i18n:r}=(0,a.Bd)(),{activeLanguage:n}=(0,ae.o)(),{user:d}=(0,i.As)(),{organization:c}=(0,de.Z)(),[m,h]=(0,s.useState)(null),[x,g]=(0,s.useState)(!0),[p,b]=(0,s.useState)(null),[f,v]=(0,s.useState)(8),w=(0,s.useMemo)((()=>{const e="CO"===(null===d||void 0===d?void 0:d.country),t="CO"===(null===c||void 0===c?void 0:c.country),r=e||t;return console.log("Quinzena-Check:",{userCountry:null===d||void 0===d?void 0:d.country,orgCountry:null===c||void 0===c?void 0:c.country,isColombia:r}),r}),[null===d||void 0===d?void 0:d.country,null===c||void 0===c?void 0:c.country]),k=(0,s.useRef)(!1),[j,N]=(0,s.useState)((()=>"CO"===(null===d||void 0===d?void 0:d.country))),q=(0,s.useMemo)((()=>{switch(n||r.language||"de"){case"es":return re.es;case"en":return se.c;default:return I.de}}),[n,r.language]),A=new Date,S=(0,s.useMemo)((()=>"".concat(X(A),"-W").concat(String((0,ee.N)(A,{locale:q})).padStart(2,"0"))),[q]),R=(0,s.useMemo)((()=>(0,ie.VY)()),[]),[C,E]=(0,s.useState)(S),[D,_]=(0,s.useState)(R);(0,s.useEffect)((()=>{j?_(R):E(S)}),[S,R,j]);const T=(0,te.k)(A,{weekStartsOn:1}),L=(0,ie.M9)(R),[B,M]=(0,s.useState)((0,z.GP)(T,"yyyy-MM-dd")),[F,O]=(0,s.useState)(L),P=(0,s.useMemo)((()=>{const e=j?F||(0,ie.M9)((0,ie.VY)()):B||(0,z.GP)((0,te.k)(A,{weekStartsOn:1}),"yyyy-MM-dd");return console.log("selectedDate calculated:",{useQuinzena:j,selectedQuinzenaDate:F,selectedWeekDate:B,result:e}),e}),[j,F,B]),[W,U]=(0,s.useState)(!1),[H,V]=(0,s.useState)("");(0,s.useEffect)((()=>{d&&$()}),[P,d,j]);const Q=async(e,r)=>{try{if(g(!0),!e)return console.error("Kein Datum zum Senden verf\xfcgbar"),b("Kein Datum verf\xfcgbar"),void g(!1);console.log("Fetch Stats:",{isQuinzena:r,dateToSend:e});const s=r?"".concat(u.Sn.WORKTIME.STATS,"?quinzena=").concat(e):"".concat(u.Sn.WORKTIME.STATS,"?week=").concat(e);console.log("API Endpoint:",s);const a=(await o.A.get(s)).data;if(console.log("API Response:",a),a&&a.weeklyData)if(r){console.log("Quinzena-Daten vom Backend:",{totalHours:a.totalHours,weeklyDataLength:a.weeklyData.length,weeklyData:a.weeklyData});const e=(0,l.A)((0,l.A)({},a),{},{weeklyData:a.weeklyData.map((e=>(0,l.A)((0,l.A)({},e),{},{date:e.date||"",hours:e.hours||0}))).sort(((e,t)=>e.date&&t.date?e.date.localeCompare(t.date):0))});console.log("Validierte Quinzena-Daten:",e),h(e)}else{const r={Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7,[t("worktime.days.monday")]:1,[t("worktime.days.tuesday")]:2,[t("worktime.days.wednesday")]:3,[t("worktime.days.thursday")]:4,[t("worktime.days.friday")]:5,[t("worktime.days.saturday")]:6,[t("worktime.days.sunday")]:7},s=[];for(let t=0;t<7;t++)s.push(ce(e,t));const n=(0,l.A)((0,l.A)({},a),{},{weeklyData:a.weeklyData.map((e=>{const t=r[e.day];if(void 0===t)return console.error("Unbekannter Wochentag: ".concat(e.day)),e;const a=s[t-1];return(0,l.A)((0,l.A)({},e),{},{date:a})}))});h(n)}else h(a);b(null)}catch(n){var s,a;console.error("Fehler beim Abrufen der Statistikdaten:",n),b((null===n||void 0===n||null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Fehler beim Laden der Daten")}finally{g(!1)}},$=async()=>{Q(P,j)},Y=e=>{let t,r;if(k.current=!0,N(e),e){const e=(0,ie.VY)();r=e,t=(0,ie.M9)(e),_(r),O(t)}else r=S,t=(0,ie.pg)(S),E(r),M(t);queueMicrotask((()=>{Q(t,e),setTimeout((()=>{k.current=!1}),100)}))};(0,s.useEffect)((()=>{if(!k.current)if(w&&!j){const e=(0,ie.VY)();_(e);const t=(0,ie.M9)(e);O(t),N(!0),queueMicrotask((()=>{Q(t,!0)}))}else if(!w&&j){const e=(0,ie.pg)(S);E(S),M(e),N(!1),queueMicrotask((()=>{Q(e,!1)}))}}),[w,j]);const K=e=>{e?e.match(/^\d{4}-\d{2}-\d{2}$/)?(V(e),U(!0)):console.error("Ung\xfcltiges Datum f\xfcr Modal: ".concat(e)):console.error("Kein Datum f\xfcr Modal angegeben")};if((0,s.useEffect)((()=>{if(!x&&m&&m.weeklyData){const e=m.weeklyData.reduce(((e,t)=>{const r="number"===typeof t.hours?t.hours:parseFloat(t.hours);return r>e?r:e}),0);v(e)}}),[x,m]),x)return(0,y.jsx)("div",{className:"p-4",children:t("common.loading")});if(p)return(0,y.jsx)("div",{className:"p-4 text-red-600",children:p});if(!m)return null;j?(0,ie.lK)(F):(0,ie._2)(B);const G=Math.max(8,Math.ceil(1.1*f)),Z=null!==(e=null===d||void 0===d?void 0:d.normalWorkingHours)&&void 0!==e?e:7.6;return(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,y.jsxs)("div",{className:"flex items-center pl-2 sm:pl-0",children:[(0,y.jsx)(ne.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,y.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:t("worktime.stats.title")})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-4",children:[w&&(0,y.jsxs)("div",{className:"flex items-center gap-4",children:[(0,y.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,y.jsx)("input",{type:"radio",name:"periodType",checked:!j,onChange:()=>Y(!1),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"}),(0,y.jsx)("span",{className:"text-sm dark:text-white",children:t("worktime.stats.week")})]}),(0,y.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,y.jsx)("input",{type:"radio",name:"periodType",checked:j,onChange:()=>Y(!0),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"}),(0,y.jsx)("span",{className:"text-sm dark:text-white",children:t("worktime.stats.quinzena")})]})]}),j?(0,y.jsx)("input",{type:"text",pattern:"\\d{4}-\\d{2}-Q[12]",placeholder:"YYYY-MM-Q1",value:D,onChange:e=>{const t=e.target.value;if((/^\d{4}-\d{2}-Q[12]$/.test(t)||""===t)&&(_(t),t.match(/^\d{4}-\d{2}-Q[12]$/))){const e=(0,ie.M9)(t);O(e),queueMicrotask((()=>{Q(e,!0)}))}},className:"border border-gray-300 dark:border-gray-600 rounded-md text-base sm:text-sm h-8 sm:h-10 px-3 dark:bg-gray-700 dark:text-white w-28",title:t("worktime.stats.quinzenaFormat")}):(0,y.jsx)("input",{type:"week",value:C,onChange:e=>{const t=e.target.value;if(!t)return;E(t);const r=(0,ie.pg)(t);M(r),queueMicrotask((()=>{Q(r,!1)}))},max:S,className:"border border-gray-300 dark:border-gray-600 rounded-md text-base sm:text-sm h-8 sm:h-10 px-3 dark:bg-gray-700 dark:text-white"}),(0,y.jsx)("button",{onClick:async()=>{try{localStorage.getItem("token");const e=await o.A.get("".concat(u.Sn.WORKTIME.BASE,"/export?week=").concat(B),{responseType:"blob"}),r=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=t("worktime.stats.exportFilename",{week:C.split("W")[1]}),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a)}catch(p){console.error("Fehler beim Exportieren:",p),b(t("worktime.stats.export")+": "+t("common.error"))}},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center min-w-8 min-h-8 w-8 h-8",title:t("worktime.stats.export"),"aria-label":t("worktime.stats.exportTitle"),style:{marginTop:"1px",marginBottom:"1px"},children:(0,y.jsx)(le.A,{className:"h-4 w-4"})})]})]}),(0,y.jsxs)("div",{className:"flex flex-row gap-2 mb-8 overflow-x-auto",children:[(0,y.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,y.jsx)("h3",{className:"text-lg font-medium text-blue-900 dark:text-blue-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.totalHours")}),(0,y.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap text-center",children:[m.totalHours,t("worktime.stats.hourShort")]})]}),(0,y.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,y.jsx)("h3",{className:"text-lg font-medium text-green-900 dark:text-green-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.averagePerDay")}),(0,y.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-green-600 dark:text-green-400 whitespace-nowrap text-center",children:[m.averageHoursPerDay,t("worktime.stats.hourShort")]})]}),(0,y.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,y.jsx)("h3",{className:"text-lg font-medium text-purple-900 dark:text-purple-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.workDays")}),(0,y.jsx)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-purple-600 dark:text-purple-400 whitespace-nowrap text-center",children:m.daysWorked})]})]}),(0,y.jsxs)("div",{className:"mt-8",children:[(0,y.jsx)("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:t(j?"worktime.stats.quinzenaProgress":"worktime.stats.weeklyProgress")}),(0,y.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,y.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,y.jsxs)("span",{children:[G,"h"]}),(0,y.jsxs)("span",{children:[Math.round(.75*G),"h"]}),(0,y.jsxs)("span",{children:[Math.round(.5*G),"h"]}),(0,y.jsxs)("span",{children:[Math.round(.25*G),"h"]}),(0,y.jsx)("span",{children:"0h"})]}),(0,y.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,y.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,y.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,y.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,y.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,y.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})]}),Z<=G&&(0,y.jsx)("div",{className:"absolute w-full border-t-2 border-red-600 dark:border-red-500 z-10 pr-8",style:{bottom:"".concat(Z/G*100,"%"),borderStyle:"dashed"},children:(0,y.jsxs)("span",{className:"absolute -top-3 right-8 text-xs text-red-600 dark:text-red-500 font-medium",children:[t("worktime.stats.target"),": ",Z,t("worktime.stats.hourShort")]})}),(0,y.jsxs)("div",{className:"absolute top-0 left-0 text-xs flex items-center gap-2",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"w-3 h-3 bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 rounded-sm mr-1"}),(0,y.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["\u2264 ",Z,t("worktime.stats.hourShort")]})]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"w-3 h-3 bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 rounded-sm mr-1"}),(0,y.jsxs)("span",{className:"text-red-600 dark:text-red-400",children:["> ",Z,t("worktime.stats.hourShort")]})]})]}),(0,y.jsx)("div",{className:"absolute inset-0 pr-8 flex items-end",children:(0,y.jsx)("div",{className:"w-full h-full flex justify-between",children:m.weeklyData.map(((e,r)=>{const s="number"===typeof e.hours?e.hours:parseFloat(e.hours),a=s>Z?(s-Z)/G*100:0,n=Math.min(s,Z)/G*100,l=e.date,o=j?(0,ie.lK)(F).length:7,i=j?"".concat(100/o,"%"):"13%",d=j?"w-3/12":"w-5/12";return(0,y.jsx)("div",{className:"flex flex-col items-center",style:{width:i},children:(0,y.jsxs)("div",{className:"relative ".concat(d," h-full flex flex-col justify-end cursor-pointer"),title:t("worktime.stats.clickToView"),children:[a>0&&(0,y.jsx)("div",{className:"w-full bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 hover:bg-red-200 dark:hover:bg-red-900/70 cursor-pointer",onClick:()=>K(l),style:{height:"".concat(a,"%"),minHeight:"2px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomWidth:a>0&&n>0?"0":"2px"}}),n>0&&(0,y.jsx)("div",{className:"w-full bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/70 cursor-pointer",onClick:()=>K(l),style:{height:"".concat(n,"%"),minHeight:s>0?"4px":"0",borderTopLeftRadius:a>0?"0":"8px",borderTopRightRadius:a>0?"0":"8px",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px",borderTopWidth:a>0?"0":"2px"}})]})},r)}))})}),(0,y.jsx)("div",{className:"absolute bottom-0 left-0 right-8 pt-8 flex justify-between",children:m.weeklyData.map(((e,r)=>{const s=j?(0,ie.lK)(F).length:7,a=j?"".concat(100/s,"%"):"13%";return(0,y.jsxs)("div",{className:"flex flex-col items-center",style:{width:a},children:[(0,y.jsx)("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:(()=>{const r=e.day.toLowerCase();return r.includes("montag")||r.includes("mo")?t("worktime.days.monday").substring(0,2):r.includes("dienstag")||r.includes("di")?t("worktime.days.tuesday").substring(0,2):r.includes("mittwoch")||r.includes("mi")?t("worktime.days.wednesday").substring(0,2):r.includes("donnerstag")||r.includes("do")?t("worktime.days.thursday").substring(0,2):r.includes("freitag")||r.includes("fr")?t("worktime.days.friday").substring(0,2):r.includes("samstag")||r.includes("sa")?t("worktime.days.saturday").substring(0,2):r.includes("sonntag")||r.includes("so")?t("worktime.days.sunday").substring(0,2):e.day.substring(0,2)})()}),(0,y.jsxs)("div",{className:"text-xs sm:text-sm font-medium dark:text-gray-300",children:[e.hours.toFixed(1),t("worktime.stats.hourShort")]})]},r)}))})]})]}),W&&(0,y.jsx)(oe.G,{isOpen:W,onClose:()=>{U(!1)},selectedDate:H})]})};var me=r(5475),he=r(9130),xe=r(6287);const ge=()=>{const{t:e}=(0,a.Bd)();return(0,y.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 shadow-sm",children:(0,y.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center mb-4 md:mb-0",children:[(0,y.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full mr-4",children:(0,y.jsx)(he.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:e("appDownload.title")}),(0,y.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("appDownload.description")})]})]}),(0,y.jsxs)(me.N_,{to:"/mobile-app",className:"inline-flex items-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:[e("appDownload.download"),(0,y.jsx)(xe.A,{className:"ml-2 -mr-1 h-4 w-4"})]})]})})},pe=()=>{const{t:e}=(0,a.Bd)(),t=(0,n.Zp)(),[r,l]=(0,s.useState)(null),[o,i]=(0,s.useState)(!0);(0,s.useEffect)((()=>{localStorage.getItem("token")?(l({id:1,username:"testuser",email:"test@example.com",first_name:"Test",last_name:"User"}),i(!1)):t("/login")}),[t]);return o?(0,y.jsx)("div",{className:"flex items-center justify-center min-h-screen text-gray-700 dark:text-gray-300",children:e("common.loading")}):(0,y.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,y.jsxs)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6","data-onboarding":"dashboard-header",children:[(0,y.jsx)("div",{"data-onboarding":"worktime-stats",children:(0,y.jsx)(ue,{})}),(0,y.jsxs)("div",{className:"mt-2 sm:mt-4 md:mt-6 grid grid-cols-1 gap-4",children:[(0,y.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full","data-onboarding":"requests-section",children:(0,y.jsx)(Z,{})}),(0,y.jsx)("div",{className:"mt-4",children:(0,y.jsx)(ge,{})})]})]})})}},6400:(e,t,r)=>{r.d(t,{J1:()=>n,W5:()=>a});const s=(e,t)=>{const{operator:r,value:s}=t;if(null==e&&null==s)return"equals"===r;if(null==e||null==s)return"notEquals"===r;const a=String(e).toLowerCase(),n=String(s).toLowerCase();switch(r){case"equals":return a===n;case"notEquals":return a!==n;case"contains":return a.includes(n);case"startsWith":return a.startsWith(n);case"endsWith":return a.endsWith(n);case"before":case"after":{const t=new Date(e),a=new Date(s);return!isNaN(t.getTime())&&!isNaN(a.getTime())&&("before"===r?t<a:t>a)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),a=parseFloat(String(s));return!isNaN(t)&&!isNaN(a)&&("greaterThan"===r?t>a:t<a)}default:return!0}},a=(e,t,r,a,n)=>0===t.length?e:e.filter((e=>{let l=!0;for(let o=0;o<t.length;o++){const i=t[o];let d=!1;if(n&&n[i.column]){const t=n[i.column](e,i);if(null!==t)d=t;else{const t=a(e,i.column);d=s(t,i)}}else{const t=a(e,i.column);d=s(t,i)}if(0===o)l=d;else{l="AND"===(r[o-1]||"AND")?l&&d:l||d}}return l})),n=(e,t)=>{if(!e)return!1;const r=new Date(e);if(isNaN(r.getTime()))return!1;const s=new Date(t.value);if(isNaN(s.getTime()))return!1;switch(t.operator){case"equals":return r.toDateString()===s.toDateString();case"before":return r<s;case"after":return r>s;default:return!0}}},8416:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=a.forwardRef(l)},9130:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function l(e,t){let{title:r,titleId:l}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"}))}const o=a.forwardRef(l)}}]);
//# sourceMappingURL=450.ed551476.chunk.js.map