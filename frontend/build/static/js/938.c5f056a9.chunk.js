"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[938],{1052:(e,t,r)=>{r.d(t,{F2:()=>n,Rj:()=>o,go:()=>l});const a={request:{criticalHours:24},todo:{criticalHours:24}};const s={hourly:{criticalHours:2},daily:{criticalHours:6},standard:{criticalHours:24}};function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"request",r=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!e)return"none";const o=new Date,i=new Date(e),d=(o.getTime()-i.getTime())/36e5;if(d<=0)return"none";let c;if(r)c=r;else if("todo"===t&&l){const e=function(e,t){const r=e.toLowerCase(),a=(t||"").toLowerCase();return r.includes("st\xfcndlich")||a.includes("st\xfcndlich")?"hourly":r.includes("t\xe4glich")||a.includes("t\xe4glich")?"daily":"standard"}(l,n);c=s[e]}else c=a[t];return d>=c.criticalHours?"critical":"expired"}function n(e){switch(e){case"expired":return{borderClass:"border-orange-500 dark:border-orange-600",bgClass:"bg-orange-50 dark:bg-orange-900/20",textClass:"text-orange-700 dark:text-orange-300",badgeClass:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"};case"critical":return{borderClass:"border-red-500 dark:border-red-600",bgClass:"bg-red-50 dark:bg-red-900/20",textClass:"text-red-700 dark:text-red-700",badgeClass:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"};default:return{borderClass:"",bgClass:"",textClass:"",badgeClass:""}}}function o(e){let t=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F\xe4lligkeit",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e=>e.toLocaleDateString(),s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const o=l(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"request",void 0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),i=n(o);return{icon:t,label:r,value:e?a(new Date(e)):"-",className:"none"!==o?s?i.badgeClass:i.textClass:void 0}}},1252:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const l=a.forwardRef(s)},1663:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"}))}const l=a.forwardRef(s)},1853:(e,t,r)=>{r.d(t,{Iw:()=>s,qY:()=>a});r(5043),r(579);const a=(e,t)=>{if("task"===t)switch(e){case"open":default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"improval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"quality_control":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"done":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}if("request"===t)switch(e){case"approval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"to_improve":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"denied":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}if("invoice"===t)switch(e){case"DRAFT":default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";case"SENT":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"PAID":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"OVERDUE":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"CANCELLED":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},s=(e,t,r)=>{if(r){if("task"===t){const t=`tasks.status.${e}`,a=r(t);if(a!==t)return a}if("request"===t){const t=`requests.status.${e}`,a=r(t);if(a!==t)return a}if("invoice"===t){const t=`invoices.status.${e.toLowerCase()}`,a=r(t);if(a!==t)return a}}if("task"===t)switch(e){case"open":return"Offen";case"in_progress":return"In Bearbeitung";case"improval":return"Nachbesserung";case"quality_control":return"Qualit\xe4tskontrolle";case"done":return"Erledigt";default:return e}if("request"===t)switch(e){case"approval":return"Offen";case"approved":return"Genehmigt";case"to_improve":return"Nachbesserung";case"denied":return"Abgelehnt";default:return e}if("invoice"===t)switch(e){case"DRAFT":return"Entwurf";case"SENT":return"Gesendet";case"PAID":return"Bezahlt";case"OVERDUE":return"\xdcberf\xe4llig";case"CANCELLED":return"Storniert";default:return e}return e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}},1909:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"}))}const l=a.forwardRef(s)},2311:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}const l=a.forwardRef(s)},2517:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const l=a.forwardRef(s)},3744:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const l=a.forwardRef(s)},4129:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const l=a.forwardRef(s)},4538:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const l=a.forwardRef(s)},4832:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const l=a.forwardRef(s)},4850:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const l=a.forwardRef(s)},6238:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const l=a.forwardRef(s)},6365:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const l=a.forwardRef(s)},6714:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ne});var a=r(5043),s=r(4117),l=r(3216),n=r(2672),o=r(2760),i=r(2023),d=r(8897),c=r(5442),u=r(6287),m=r(8662),g=r(4538),h=r(4850),x=r(1663),b=r(8010),p=r(1909),k=r(1369),f=r(1252),y=r(2811),v=r(3744),w=r(6238),j=r(4129),N=r(7988),C=r(1923),A=r(6443),S=r(7591),T=r(1816),E=r(9422),D=r(1801),L=r(579);const $=e=>{let{onArticleSelected:t,excludeArticleIds:r=[],selectedArticles:s,onArticleRemove:l}=e;const[n,o]=(0,a.useState)([]),[i,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[m,g]=(0,a.useState)(!1),[h,x]=(0,a.useState)(null);(0,a.useEffect)((()=>{(async()=>{try{g(!0),x(null);const e=(await C.A.get(D.Sn.CEREBRO.ARTICLES.BASE)).data.filter((e=>!r.includes(e.id)));o(e)}catch(a){var e,t;console.error("Fehler beim Abrufen der Artikel:",a);const r=a;x((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{g(!1)}})()}),[r]);return(0,L.jsxs)("div",{className:"mt-4",children:[(0,L.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cerebro-Artikel verkn\xfcpfen"}),(0,L.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,L.jsxs)("div",{className:"flex items-center gap-2",children:[(0,L.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:i||"",onChange:e=>{const t=parseInt(e.target.value,10);if(isNaN(t))d(null),u(null);else{d(t);n.find((e=>e.id===t))&&(async e=>{try{g(!0);const t=await C.A.get(D.Sn.CEREBRO.ARTICLES.BY_ID(e));u(t.data)}catch(t){console.error("Fehler beim Abrufen der Artikeldetails:",t)}finally{g(!1)}})(t)}},children:[(0,L.jsx)("option",{value:"",children:"-- Artikel ausw\xe4hlen --"}),n.map((e=>(0,L.jsx)("option",{value:e.id,children:e.title},e.id)))]}),(0,L.jsx)("button",{type:"button",onClick:()=>{if(null!==i){const e=n.find((e=>e.id===i));e&&(t(e),d(null),u(null))}},disabled:null===i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Verkn\xfcpfen"})]}),m&&(0,L.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Artikel..."}),h&&(0,L.jsx)("div",{className:"text-sm text-red-600",children:h}),c&&(0,L.jsxs)("div",{className:"mt-2 p-4 border border-gray-300 rounded-md bg-gray-50",children:[(0,L.jsx)("h4",{className:"font-medium text-lg mb-2",children:c.title}),(0,L.jsx)("div",{className:"prose prose-sm max-w-none",children:c.content?(0,L.jsxs)("div",{className:"text-sm text-gray-700 max-h-40 overflow-y-auto",children:[c.content.substring(0,300),c.content.length>300&&"..."]}):(0,L.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Kein Inhalt verf\xfcgbar"})}),(0,L.jsx)("div",{className:"mt-2",children:(0,L.jsx)("a",{href:`/cerebro/articles/${c.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"Artikel \xf6ffnen"})})]})]})]})};var I=r(6896),R=r(5657);const q=e=>{let{error:t,title:r,setTitle:l,description:n,setDescription:o,assigneeType:i,setAssigneeType:d,responsibleId:c,setResponsibleId:u,roleId:m,setRoleId:g,qualityControlId:h,setQualityControlId:x,branchId:b,setBranchId:p,dueDate:k,setDueDate:f,users:y,roles:v,branches:w,loading:j,handleSubmit:N,handleClose:C,selectedArticles:A,onArticleSelect:D,onArticleRemove:R,uploading:q=!1,temporaryAttachments:F=[],onFileUpload:M,onRemoveAttachment:O,textareaRef:B,fileInputRef:W,handlePaste:_,handleDrop:z,handleDragOver:K}=e;const{t:V}=(0,s.Bd)(),[P,H]=(0,a.useState)("data");return(0,L.jsxs)("form",{onSubmit:N,className:"space-y-4",noValidate:!0,children:[t&&(0,L.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 dark:border-red-700 text-red-700 dark:text-red-300 p-4 mb-4",children:(0,L.jsx)("p",{children:t})}),(0,L.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,L.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,L.jsx)("button",{type:"button",className:("data"===P?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",onClick:()=>H("data"),children:"Daten"}),(0,L.jsx)("button",{type:"button",className:("cerebro"===P?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",onClick:()=>H("cerebro"),children:"Cerebro Artikel"})]})}),"data"===P&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[V("tasks.createTask.form.title")," *"]}),(0,L.jsx)("input",{type:"text",id:"title",value:r,onChange:e=>l(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,L.jsx)("div",{className:"space-y-4",children:(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"description_sidepane",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:V("tasks.createTask.form.description")}),(0,L.jsxs)("div",{className:"relative",children:[(0,L.jsx)("textarea",{ref:B,id:"description_task_create",rows:6,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",value:n,onChange:e=>o(e.target.value),onPaste:_,onDrop:z,onDragOver:K,placeholder:V("tasks.createTask.form.descriptionPlaceholder")}),(0,L.jsx)("button",{type:"button",onClick:()=>{var e;return null===W||void 0===W||null===(e=W.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:V("tasks.createTask.form.fileUpload"),children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,L.jsx)("input",{ref:W,type:"file",onChange:M,className:"hidden"}),q&&(0,L.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,L.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:V("tasks.createTask.form.uploading")})})]}),F&&F.length>0&&(0,L.jsx)("div",{className:"mt-2",children:(0,L.jsx)("ul",{className:"flex flex-wrap gap-2",children:F.map(((e,t)=>(0,L.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,L.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,L.jsx)("div",{className:"flex ml-2",children:(0,L.jsx)("button",{type:"button",onClick:()=>null===O||void 0===O?void 0:O(t),className:"text-red-600 hover:text-red-900 ml-1",title:V("tasks.createTask.form.remove"),children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,L.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-700",children:(0,L.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},t)))})}),n&&(0,L.jsx)("div",{className:"mt-3",children:(0,L.jsx)(I.A,{content:n,temporaryAttachments:F})})]})}),(0,L.jsxs)("div",{className:"space-y-2",children:[(0,L.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[V("tasks.createTask.form.responsibleFor")," *"]}),(0,L.jsxs)("div",{className:"flex space-x-4",children:[(0,L.jsxs)("label",{className:"inline-flex items-center",children:[(0,L.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===i,onChange:()=>{d("user"),g("")}}),(0,L.jsx)("span",{className:"ml-2 dark:text-gray-300",children:V("tasks.createTask.form.user")})]}),(0,L.jsxs)("label",{className:"inline-flex items-center",children:[(0,L.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===i,onChange:()=>{d("role"),u("")}}),(0,L.jsx)("span",{className:"ml-2 dark:text-gray-300",children:V("tasks.createTask.form.role")})]})]})]}),"user"===i?(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[V("tasks.createTask.form.responsibleUser")," *"]}),(0,L.jsxs)("select",{id:"responsible",value:c,onChange:e=>u(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,L.jsx)("option",{value:"",children:V("tasks.createTask.form.pleaseSelect")}),Array.isArray(y)&&y.map((e=>(0,L.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[V("tasks.createTask.form.responsibleRole")," *"]}),(0,L.jsxs)("select",{id:"role",value:m,onChange:e=>g(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,L.jsx)("option",{value:"",children:V("tasks.createTask.form.pleaseSelect")}),Array.isArray(v)&&v.map((e=>(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:V("tasks.createTask.form.qualityControl")}),(0,L.jsxs)("select",{id:"qualityControl",value:h,onChange:e=>x(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,L.jsx)("option",{value:"",children:V("tasks.createTask.form.noQualityControl")}),Array.isArray(y)&&y.map((e=>(0,L.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[V("tasks.createTask.form.branch")," *"]}),(0,L.jsxs)("select",{id:"branch",value:b,onChange:e=>p(Number(e.target.value)),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,L.jsx)("option",{value:"",children:"Bitte w\xe4hlen"}),Array.isArray(w)&&w.map((e=>(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:V("tasks.createTask.form.dueDate")}),(0,L.jsx)("input",{type:"date",id:"dueDate",value:k,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===P&&(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{className:"mb-4",children:[(0,L.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Verkn\xfcpfte Cerebro-Artikel"}),A.length>0?(0,L.jsx)("ul",{className:"mt-2 space-y-2",children:A.map((e=>(0,L.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,L.jsx)("span",{className:"dark:text-gray-300",children:e.title}),(0,L.jsx)("button",{type:"button",onClick:()=>R(e.id),className:"text-red-600 hover:text-red-800",children:"Entfernen"})]},e.id)))}):(0,L.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Keine Artikel verkn\xfcpft"})]}),(0,L.jsx)($,{onArticleSelected:D,excludeArticleIds:A.map((e=>e.id)),selectedArticles:A,onArticleRemove:R})]}),(0,L.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,L.jsx)("button",{type:"button",onClick:C,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:V("tasks.createTask.form.cancel"),children:(0,L.jsx)(S.A,{className:"h-5 w-5"})}),(0,L.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:V(j?"tasks.createTask.form.creating":"tasks.createTask.form.create"),disabled:j,children:j?(0,L.jsx)(T.A,{className:"h-5 w-5 animate-spin"}):(0,L.jsx)(E.A,{className:"h-5 w-5"})})]})]})},F=e=>{let{isOpen:t,onClose:r,onTaskCreated:l}=e;const{t:o}=(0,s.Bd)(),{user:i}=(0,n.As)(),{openSidepane:d,closeSidepane:c}=(0,R.N)(),[u,m]=(0,a.useState)(window.innerWidth>1070),[g,h]=(0,a.useState)(""),[x,b]=(0,a.useState)(""),[p,k]=(0,a.useState)("user"),[f,y]=(0,a.useState)(""),[v,w]=(0,a.useState)(""),[j,N]=(0,a.useState)(""),[T,E]=(0,a.useState)(""),[$,I]=(0,a.useState)(""),[F,M]=(0,a.useState)([]),[O,B]=(0,a.useState)([]),[W,_]=(0,a.useState)([]),[z,K]=(0,a.useState)(null),[V,P]=(0,a.useState)(!1),[H,Z]=(0,a.useState)(window.innerWidth<640),[U,G]=(0,a.useState)([]),[Q,Y]=(0,a.useState)("data"),[X,J]=(0,a.useState)([]),[ee,te]=(0,a.useState)(!1),re=(0,a.useRef)(null),ae=(0,a.useRef)(null);(0,a.useEffect)((()=>{t&&(se(),le(),ne(),i&&N(i.id),I((()=>{const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]})()))}),[t,i]),(0,a.useEffect)((()=>{W.length>0&&""===T&&(1===W.length||W.length>1)&&E(W[0].id)}),[W,T]),(0,a.useEffect)((()=>{const e=()=>{Z(window.innerWidth<640),m(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]);const se=async()=>{try{K(null);if(!localStorage.getItem("token"))return void K("Nicht authentifiziert");console.log("Lade Benutzer f\xfcr CreateTaskModal...");const e=await C.A.get(D.Sn.USERS.DROPDOWN);console.log("Benutzer geladen:",e.data.length),M(e.data||[])}catch(r){console.error("Fehler beim Laden der Benutzer:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)K(o("tasks.createTask.errors.connectionError"));else K(`${o("tasks.createTask.errors.loadUsersError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},le=async()=>{try{K(null);if(!localStorage.getItem("token"))return void K("Nicht authentifiziert");const e=await C.A.get(D.Sn.ROLES.BASE);B(e.data||[])}catch(r){console.error("Fehler beim Laden der Rollen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)K(o("tasks.createTask.errors.connectionError"));else K(`${o("tasks.createTask.errors.loadRolesError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},ne=async()=>{try{K(null);if(!localStorage.getItem("token"))return void K("Nicht authentifiziert");console.log("Lade Niederlassungen f\xfcr CreateTaskModal...");const e=await C.A.get(D.Sn.BRANCHES.BASE);console.log("Niederlassungen geladen:",e.data.length),_(e.data||[])}catch(r){console.error("Fehler beim Laden der Niederlassungen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)K(o("tasks.createTask.errors.connectionError"));else K(`${o("tasks.createTask.errors.loadBranchesError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},oe=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const a=t[r];if(0===a.type.indexOf("image")){e.preventDefault();const t=a.getAsFile();return void(t&&await ce(t))}}},ie=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await ce(t)}},de=e=>{e.preventDefault(),e.stopPropagation()},ce=async e=>{te(!0),K(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};J((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?`\n![${e.name}](${o("tasks.createTask.form.uploadAfterCreate")})\n`:`\n[${e.name}](${o("tasks.createTask.form.uploadAfterCreate")})\n`,ae.current){const e=ae.current.selectionStart,t=x.substring(0,e),a=x.substring(e);b(t+r+a),setTimeout((()=>{if(ae.current){const t=e+r.length;ae.current.selectionStart=t,ae.current.selectionEnd=t,ae.current.focus()}}),0)}else b(x+r)}catch(a){var t,r;console.error("Fehler beim Verarbeiten der Datei:",a);const e=a;K((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{te(!1)}},ue=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await ce(r),re.current&&(re.current.value="")},me=e=>{const t=X[e];if(t&&(J(X.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=o("tasks.createTask.form.uploadAfterCreate"),a=new RegExp(`!\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),s=new RegExp(`\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),l=x.replace(a,"").replace(s,"").replace(/\n{3,}/g,"\n\n");b(l)}},ge=async e=>{e.preventDefault(),K(null),P(!0);try{if(!g||!f&&!v||!T)return K(o("tasks.createTask.errors.fillAllFields")),void P(!1);if(f&&v)return K(o("tasks.createTask.errors.chooseUserOrRole")),void P(!1);if(!localStorage.getItem("token"))return K("Nicht authentifiziert"),void P(!1);const e=Number(T),t=j?Number(j):null,r=f?Number(f):null,a=v?Number(v):null;if(f&&isNaN(r)||v&&isNaN(a)||isNaN(e)||j&&isNaN(t))return K(o("tasks.createTask.errors.invalidIds")),void P(!1);const s={title:g,description:x,status:"open",qualityControlId:t,branchId:e,dueDate:$};"user"===p&&f?s.responsibleId=f:"role"===p&&v&&(s.roleId=v);const n=await C.A.post(D.Sn.TASKS.BASE,s),i=n.data.id;U.length>0&&await Promise.all(U.map((e=>C.A.post(D.Sn.TASKS.LINK_CARTICLE(i,e.id))))),await(async e=>{if(0!==X.length)try{P(!0);for(const t of X){if(!t.file)continue;const r=new FormData;r.append("file",t.file),await C.A.post(D.Sn.TASKS.ATTACHMENTS(e),r,{headers:{"Content-Type":"multipart/form-data"}})}console.log(`${X.length} Anh\xe4nge erfolgreich hochgeladen.`)}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{P(!1)}})(i),console.log("Task erfolgreich erstellt:",n.data),l(n.data),he()}catch(a){var t,r;console.error("Fehler beim Erstellen des Tasks:",a);const e=a;K((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.error)||e.message||o("tasks.createTask.errors.createError"))}finally{P(!1)}},he=()=>{h(""),b(""),k("user"),y(""),w(""),N(""),E(""),I(""),K(null),G([]),J([]),r()},xe=e=>{G((t=>[...t,e]))},be=e=>{G((t=>t.filter((t=>t.id!==e))))};return H?(0,L.jsxs)(A.lG,{open:t,onClose:he,className:"relative z-50",children:[(0,L.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,L.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,L.jsxs)(A.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,L.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,L.jsx)(A.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("tasks.createTask.title")}),(0,L.jsx)("button",{onClick:he,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,L.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,L.jsx)(q,{error:z,title:g,setTitle:h,description:x,setDescription:b,assigneeType:p,setAssigneeType:k,responsibleId:f,setResponsibleId:y,roleId:v,setRoleId:w,qualityControlId:j,setQualityControlId:N,branchId:T,setBranchId:E,dueDate:$,setDueDate:I,users:F,roles:O,branches:W,loading:V,handleSubmit:ge,handleClose:he,selectedArticles:U,onArticleSelect:xe,onArticleRemove:be,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:ae,fileInputRef:re,handlePaste:oe,handleDrop:ie,handleDragOver:de})]})})]}):(0,L.jsxs)(L.Fragment,{children:[t&&!u&&(0,L.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,L.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,L.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,L.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neue Aufgabe erstellen"}),(0,L.jsx)("button",{onClick:he,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,L.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,L.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,L.jsx)(q,{error:z,title:g,setTitle:h,description:x,setDescription:b,assigneeType:p,setAssigneeType:k,responsibleId:f,setResponsibleId:y,roleId:v,setRoleId:w,qualityControlId:j,setQualityControlId:N,branchId:T,setBranchId:E,dueDate:$,setDueDate:I,users:F,roles:O,branches:W,loading:V,handleSubmit:ge,handleClose:he,selectedArticles:U,onArticleSelect:xe,onArticleRemove:be,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:ae,fileInputRef:re,handlePaste:oe,handleDrop:ie,handleDragOver:de})})]})]})};var M=r(9248);const O=e=>{var t,r;let{isOpen:l,onClose:i,onTaskUpdated:d,task:c}=e;const{t:u}=(0,s.Bd)(),{hasPermission:m}=(0,o.S)(),{user:g}=(0,n.As)(),{openSidepane:h,closeSidepane:x}=(0,R.N)(),[b,p]=(0,a.useState)(window.innerWidth>1070),[k,f]=(0,a.useState)(c.title||""),[y,v]=(0,a.useState)(c.description||""),[w,j]=(0,a.useState)(c.status||"open"),[N,I]=(0,a.useState)(c.roleId?"role":"user"),[q,F]=(0,a.useState)(c.responsibleId||null),[O,B]=(0,a.useState)(c.roleId||null),[W,_]=(0,a.useState)((null===(t=c.qualityControl)||void 0===t?void 0:t.id)||null),[z,K]=(0,a.useState)((null===(r=c.branch)||void 0===r?void 0:r.id)||0),[V,P]=(0,a.useState)(c.attachments||[]),[H,Z]=(0,a.useState)([]),[U,G]=(0,a.useState)(!1),Q=(0,a.useRef)(null),Y=(0,a.useRef)(null),[X,J]=(0,a.useState)((e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]})(c.dueDate)),[ee,te]=(0,a.useState)([]),[re,ae]=(0,a.useState)([]),[se,le]=(0,a.useState)([]),[ne,oe]=(0,a.useState)(null),[ie,de]=(0,a.useState)(!1),[ce,ue]=(0,a.useState)(!1),[me,ge]=(0,a.useState)(window.innerWidth<640),[he,xe]=(0,a.useState)([]),[be,pe]=(0,a.useState)("data"),ke=m("tasks","both","table");(0,a.useEffect)((()=>{const e=()=>{ge(window.innerWidth<640),p(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(l?h():x(),()=>{x()})),[l,h,x]),(0,a.useEffect)((()=>{l&&(fe(),ye(),ve(),we(),je())}),[l,c.id]);const fe=async()=>{try{oe(null);if(!localStorage.getItem("token"))return void oe("Nicht authentifiziert");const e=await C.A.get(D.Sn.USERS.DROPDOWN);te(e.data||[])}catch(r){console.error("Fehler beim Laden der Benutzer:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)oe(u("tasks.editTask.errors.connectionError"));else oe(`${u("tasks.editTask.errors.loadUsersError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},ye=async()=>{try{oe(null);if(!localStorage.getItem("token"))return void oe("Nicht authentifiziert");const e=await C.A.get(D.Sn.ROLES.BASE);ae(e.data||[])}catch(r){console.error("Fehler beim Laden der Rollen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)oe(u("tasks.editTask.errors.connectionError"));else oe(`${u("tasks.editTask.errors.loadRolesError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},ve=async()=>{try{oe(null);if(!localStorage.getItem("token"))return void oe("Nicht authentifiziert");const e=await C.A.get(D.Sn.BRANCHES.BASE);le(e.data||[])}catch(r){console.error("Fehler beim Laden der Niederlassungen:",r);const a=r;var e,t;if("ERR_NETWORK"===a.code)oe(u("tasks.editTask.errors.connectionError"));else oe(`${u("tasks.editTask.errors.loadBranchesError")}: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}},we=async()=>{try{oe(null);const e=await C.A.get(D.Sn.TASKS.CARTICLES(c.id));xe(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der verkn\xfcpften Artikel:",r);const a=r;oe((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}},je=async()=>{try{oe(null);const e=await C.A.get(D.Sn.TASKS.ATTACHMENTS(c.id));P(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",r);const a=r;oe((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten"),P([])}},Ne=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const a=t[r];if(0===a.type.indexOf("image")){e.preventDefault();const t=a.getAsFile();return void(t&&await Se(t))}}},Ce=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await Se(t)}},Ae=e=>{e.preventDefault(),e.stopPropagation()},Se=async e=>{G(!0),oe(null);try{const t=new FormData;t.append("file",e);const r=(await C.A.post(D.Sn.TASKS.ATTACHMENTS(c.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;P([...V,r]);let a="";if(a=r.fileType.startsWith("image/")?`\n![${r.fileName}](${window.location.origin}/api${D.Sn.TASKS.ATTACHMENT(c.id,r.id)})\n`:`\n[${r.fileName}](${window.location.origin}/api${D.Sn.TASKS.ATTACHMENT(c.id,r.id)})\n`,Y.current){const e=Y.current.selectionStart,t=y.substring(0,e),r=y.substring(e);v(t+a+r),setTimeout((()=>{if(Y.current){const t=e+a.length;Y.current.selectionStart=t,Y.current.selectionEnd=t,Y.current.focus()}}),0)}else v(y+a)}catch(a){var t,r;console.error("Fehler beim Verarbeiten der Datei:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{G(!1)}},Te=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await Se(r),Q.current&&(Q.current.value="")},Ee=async e=>{e.preventDefault(),oe(null),de(!0);try{if(!k||!w||!z)return oe(u("tasks.editTask.errors.fillAllFields")),void de(!1);if("user"===N&&!q)return oe(u("tasks.editTask.form.chooseUser")),void de(!1);if("role"===N&&!O)return oe(u("tasks.editTask.form.chooseRole")),void de(!1);const e={title:k,description:y,status:w,qualityControlId:W,branchId:z,dueDate:X};"user"===N?(e.responsibleId=q,e.roleId=null):"role"===N&&(e.roleId=O,e.responsibleId=null);const t=await C.A.put(`${D.Sn.TASKS.BASE}/${c.id}`,e);console.log("Task aktualisiert:",t.data),d(t.data),i()}catch(a){var t,r;console.error("Fehler beim Aktualisieren des Tasks:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{de(!1)}},De=async()=>{if(ce)try{if(!localStorage.getItem("token"))return void oe("Nicht authentifiziert");await C.A.delete(D.Sn.TASKS.BY_ID(c.id)),d(void 0),i()}catch(r){var e,t;console.error("Delete Error:",r);const a=r;oe((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}else ue(!0)},Le=async e=>{try{oe(null),await C.A.post(D.Sn.TASKS.LINK_CARTICLE(c.id,e.id)),xe((t=>[...t,e]))}catch(a){var t,r;console.error("Fehler beim Verkn\xfcpfen des Artikels:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},$e=async e=>{try{oe(null),await C.A.delete(D.Sn.TASKS.UNLINK_CARTICLE(c.id,e)),xe((t=>t.filter((t=>t.id!==e))))}catch(a){var t,r;console.error("Fehler beim Entfernen der Artikelverkn\xfcpfung:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Ie=()=>(0,L.jsxs)("form",{onSubmit:Ee,className:"space-y-4",children:[(0,L.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,L.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,L.jsx)("button",{type:"button",className:("data"===be?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",onClick:()=>pe("data"),children:"Daten"}),(0,L.jsx)("button",{type:"button",className:("cerebro"===be?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600")+" whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",onClick:()=>pe("cerebro"),children:"Cerebro Artikel"})]})}),"data"===be&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.title")}),(0,L.jsx)("input",{type:"text",id:"title",value:k,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"description_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.description")}),(0,L.jsxs)("div",{className:"relative",children:[(0,L.jsx)("textarea",{ref:Y,id:"description_edit",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:y,onChange:e=>v(e.target.value),onPaste:Ne,onDrop:Ce,onDragOver:Ae,placeholder:u("tasks.editTask.form.descriptionPlaceholder")}),(0,L.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:u("tasks.editTask.form.fileUpload"),children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,L.jsx)("input",{ref:Q,type:"file",onChange:Te,className:"hidden"}),U&&(0,L.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,L.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("tasks.editTask.form.uploading")})})]}),Re(),qe()]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.status")}),(0,L.jsxs)("select",{id:"status",value:w,onChange:e=>j(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,L.jsx)("option",{value:"open",children:u("tasks.status.open")}),(0,L.jsx)("option",{value:"in_progress",children:u("tasks.status.in_progress")}),(0,L.jsx)("option",{value:"improval",children:u("tasks.status.improval")}),(0,L.jsx)("option",{value:"quality_control",children:u("tasks.status.quality_control")}),(0,L.jsx)("option",{value:"done",children:u("tasks.status.done")})]})]}),(0,L.jsxs)("div",{className:"space-y-2",children:[(0,L.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleFor")," *"]}),(0,L.jsxs)("div",{className:"flex space-x-4",children:[(0,L.jsxs)("label",{className:"inline-flex items-center",children:[(0,L.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===N,onChange:()=>{I("user"),B(null)}}),(0,L.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.user")})]}),(0,L.jsxs)("label",{className:"inline-flex items-center",children:[(0,L.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===N,onChange:()=>{I("role"),F(null)}}),(0,L.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.role")})]})]})]}),"user"===N?(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleUser")," *"]}),(0,L.jsxs)("select",{id:"responsible",value:null===q?"":q,onChange:e=>F(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"user"===N,children:[(0,L.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(ee)&&ee.map((e=>(0,L.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,L.jsxs)("div",{children:[(0,L.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleRole")," *"]}),(0,L.jsxs)("select",{id:"role",value:null===O?"":O,onChange:e=>B(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"role"===N,children:[(0,L.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(re)&&re.map((e=>(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.qualityControl")}),(0,L.jsxs)("select",{id:"qualityControl",value:null===W?"":W,onChange:e=>_(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,L.jsx)("option",{value:"",children:u("tasks.editTask.form.noQualityControl")}),Array.isArray(ee)&&ee.map((e=>(0,L.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.branch")}),(0,L.jsxs)("select",{id:"branch",value:0===z?"":z,onChange:e=>K(e.target.value?Number(e.target.value):0),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,L.jsx)("option",{value:"",children:"Bitte w\xe4hlen"}),Array.isArray(se)&&se.map((e=>(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.dueDate")}),(0,L.jsx)("input",{type:"date",id:"dueDate",value:X||"",onChange:e=>{e.target.value?J(e.target.value):J(null)},className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===be&&(0,L.jsxs)("div",{children:[he.length>0&&(0,L.jsxs)("div",{className:"mb-4",children:[(0,L.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:u("tasks.editTask.form.linkedCerebroArticles")}),(0,L.jsx)("ul",{className:"space-y-2",children:he.map((e=>(0,L.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,L.jsx)("a",{href:`/cerebro/articles/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:e.title}),(0,L.jsx)("button",{type:"button",onClick:()=>$e(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:u("tasks.editTask.form.remove")})]},e.id)))})]}),(0,L.jsx)($,{onArticleSelected:Le,excludeArticleIds:he.map((e=>e.id)),selectedArticles:he,onArticleRemove:$e})]}),(0,L.jsxs)("div",{className:"flex justify-between pt-4",children:[ke&&(0,L.jsx)("button",{type:"button",onClick:De,className:"p-2 rounded-md "+(ce?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),title:u(ce?"tasks.editTask.form.confirmDelete":"tasks.editTask.form.delete"),children:ce?(0,L.jsx)(E.A,{className:"h-5 w-5"}):(0,L.jsx)(M.A,{className:"h-5 w-5"})}),(0,L.jsxs)("div",{className:"flex gap-2",children:[(0,L.jsx)("button",{type:"button",onClick:i,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:u("tasks.editTask.form.cancel"),children:(0,L.jsx)(S.A,{className:"h-5 w-5"})}),(0,L.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:u(ie?"tasks.editTask.form.saving":"tasks.editTask.form.save"),disabled:ie,children:ie?(0,L.jsx)(T.A,{className:"h-5 w-5 animate-spin"}):(0,L.jsx)(E.A,{className:"h-5 w-5"})})]})]})]}),Re=()=>0===V.length?null:(0,L.jsx)("div",{className:"mt-2",children:(0,L.jsx)("ul",{className:"flex flex-wrap gap-2",children:V.map((e=>(0,L.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,L.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,L.jsxs)("div",{className:"flex ml-2",children:[(0,L.jsx)("button",{type:"button",onClick:()=>(async e=>{try{const t=await C.A.get(D.Sn.TASKS.ATTACHMENT(c.id,e.id),{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=r,a.setAttribute("download",e.fileName),document.body.appendChild(a),a.click(),a.remove()}catch(a){var t,r;console.error("Fehler beim Herunterladen des Anhangs:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-1",title:u("tasks.editTask.form.download"),children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,L.jsx)("button",{type:"button",onClick:()=>(async e=>{try{oe(null);const t=V.find((t=>t.id===e));if(t&&(await C.A.delete(D.Sn.TASKS.ATTACHMENT(c.id,e)),P(V.filter((t=>t.id!==e))),t.fileName)){const t=`${window.location.origin}/api${D.Sn.TASKS.ATTACHMENT(c.id,e)}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`!\\[(.*?)\\]\\(${t}\\)`,"g"),a=new RegExp(`\\[(.*?)\\]\\(${t}\\)`,"g"),s=y.replace(r,"").replace(a,"").replace(/\n{3,}/g,"\n\n");v(s)}}catch(a){var t,r;console.error("Fehler beim L\xf6schen des Anhangs:",a);const e=a;oe((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 ml-1",title:"Entfernen",children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.fileType.startsWith("image/")&&(0,L.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600",children:(0,L.jsx)("img",{src:`${window.location.origin}/api${D.Sn.TASKS.ATTACHMENT(c.id,e.id)}`,alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id)))})}),qe=()=>0===H.length?null:(0,L.jsx)("div",{className:"mt-2",children:(0,L.jsx)("ul",{className:"flex flex-wrap gap-2",children:H.map(((e,t)=>{var r;return(0,L.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,L.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,L.jsx)("div",{className:"flex ml-2",children:(0,L.jsx)("button",{type:"button",onClick:()=>(e=>{const t=H[e];if(t&&(Z(H.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=u("tasks.editTask.form.uploadAfterCreate"),a=new RegExp(`!\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),s=new RegExp(`\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),l=y.replace(a,"").replace(s,"").replace(/\n{3,}/g,"\n\n");v(l)}})(t),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 ml-1",title:"Entfernen",children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(null===(r=e.fileType)||void 0===r?void 0:r.startsWith("image/"))&&e.file&&(0,L.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600",children:(0,L.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},`temp-${t}`)}))})});return l?me?(0,L.jsxs)(A.lG,{open:l,onClose:i,className:"relative z-50",children:[(0,L.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,L.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,L.jsxs)(A.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,L.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,L.jsx)(A.lG.Title,{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,L.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,L.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,L.jsxs)("div",{className:"p-4",children:[ne&&(0,L.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:ne}),Ie()]})]})})]}):(0,L.jsxs)(L.Fragment,{children:[l&&!b&&(0,L.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:i,style:{opacity:l?1:0,transition:"opacity 300ms ease-out"}}),(0,L.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(l?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:l?"auto":"none"},"aria-hidden":!l,role:"dialog","aria-modal":l,children:[(0,L.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,L.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,L.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,L.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,L.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[ne&&(0,L.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:ne}),Ie()]})]})]}):null};var B=r(7012);function W(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const _=a.forwardRef(W);var z=r(7460),K=r(7952),V=r(8658);const P=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(null),[i,d]=(0,a.useState)("00:00:00"),[c,u]=(0,a.useState)(null),[m,g]=(0,a.useState)(!0),[h,x]=(0,a.useState)(!1),[b,p]=(0,a.useState)(null),{user:k}=(0,n.As)(),{updateTrackingStatus:f}=(0,z.S)(),{branches:y,selectedBranch:v,setSelectedBranch:w}=(0,K.O)(),j=(0,a.useCallback)((async()=>{try{g(!0),p(null),console.log("Pr\xfcfe aktive Zeiterfassung..."),console.log("Benutzer geladen:",null===k||void 0===k?void 0:k.id);const l=localStorage.getItem("token");if(console.log("Token vorhanden:",l?"Ja":"Nein"),!l)return console.error("Kein Authentifizierungstoken gefunden"),p(e("worktime.tracker.notAuthenticated")),void g(!1);try{const e=await C.A.get(D.Sn.WORKTIME.ACTIVE);console.log("API-Antwort Status:",e.status);const t=e.data;if(console.log("Aktive Zeiterfassung Daten:",t),t&&!0===t.active){console.log("Aktive Zeiterfassung gefunden:",t.id);const e=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,a=new Date(e),s=(new Date).getTime()-a.getTime(),l=Math.floor(s/1e3),n=Math.floor(l/3600),i=Math.floor(l%3600/60),c=l%60;u(t),o(a),d(`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`),r(!0),v!==t.branchId&&w(t.branchId),f(!0)}else console.log("Keine aktive Zeiterfassung vorhanden"),r(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(s){console.error("Fehler beim Abrufen der aktiven Zeiterfassung:",s);const r=s;var t,a;if("ERR_NETWORK"===r.code)p(e("worktime.tracker.connectionError"));else p(`${e("worktime.tracker.errorFetch")}: ${(null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r.message}`)}}finally{g(!1)}}),[null===k||void 0===k?void 0:k.id,f,v]);(0,a.useEffect)((()=>{k?(console.log("Benutzer geladen, pr\xfcfe aktive Zeiterfassung f\xfcr Benutzer-ID:",k.id),j()):(console.log("Warte auf Benutzer-Daten vor dem Pr\xfcfen der Zeiterfassung..."),g(!1))}),[k,j]),(0,a.useEffect)((()=>{let e;return t&&l&&(e=window.setInterval((()=>{const e=(new Date).getTime()-l.getTime(),t=Math.floor(e/1e3),r=Math.floor(t/3600),a=Math.floor(t%3600/60),s=t%60;d(`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`)}),1e3)),()=>{e&&clearInterval(e)}}),[t,l]);const N=async()=>{if(v)try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));const a=(await C.A.post(D.Sn.WORKTIME.START,{branchId:v,startTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data,s=a.startTime.endsWith("Z")?a.startTime.substring(0,a.startTime.length-1):a.startTime,l=new Date(s);u(a),o(l),d("00:00:00"),r(!0),f(!0)}catch(a){console.error("Fehler:",a);let r=e("worktime.tracker.errorStart");var t;if(a.response)r=(null===(t=a.response.data)||void 0===t?void 0:t.message)||`Fehler (Status: ${a.response.status})`;alert(r)}else alert(e("worktime.tracker.selectBranch"))},A=async()=>{try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await C.A.post(D.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});r(!1),u(null),o(null),d("00:00:00"),f(!1)}catch(a){console.error("Fehler:",a);let r=e("worktime.tracker.errorStop");var t;if(a.response)r=(null===(t=a.response.data)||void 0===t?void 0:t.message)||`Fehler (Status: ${a.response.status})`;alert(r)}},S=(0,a.useMemo)((()=>{var t;return c?(null===(t=y.find((e=>e.id===c.branchId)))||void 0===t?void 0:t.name)||e("worktime.tracker.unknown"):null}),[y,c]);return m?(0,L.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-6",children:(0,L.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})})}):(0,L.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 sm:mb-6",children:[(0,L.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,L.jsxs)("h2",{className:"text-xl font-semibold flex items-center dark:text-white",children:[(0,L.jsx)(B.A,{className:"h-6 w-6 mr-2"}),e("worktime.tracker.title")]})}),b&&(0,L.jsxs)("div",{className:"mb-4 p-2 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 border border-red-200 dark:border-red-700 rounded-md flex justify-between items-center",children:[(0,L.jsx)("span",{children:b}),b!==e("worktime.tracker.noActiveTracking")&&(0,L.jsxs)("button",{onClick:async()=>{if(window.confirm(e("worktime.tracker.forceStopConfirm")))try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await C.A.post(D.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),force:!0},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});r(!1),o(null),d("00:00:00"),u(null),p(null),alert(e("worktime.tracker.forceStopSuccess")),f(!1)}catch(a){var t;console.error("Fehler:",a),p(`Fehler beim Stoppen: ${(null===(t=a.response)||void 0===t?void 0:t.status)||"Netzwerkfehler"}`),alert(e("worktime.tracker.forceStopError"))}},className:"text-sm bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-800 dark:hover:bg-red-700 dark:text-red-300 px-2 py-1 rounded-md",children:[e("worktime.tracker.stop")," ",e("common.force","Erzwingen")]})]}),(0,L.jsxs)("div",{className:"flex items-start justify-center mb-4",children:[(0,L.jsxs)("div",{className:"flex flex-col items-center",children:[(0,L.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,L.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:t,onChange:async()=>{t?await A():await N()},disabled:!v&&!t}),(0,L.jsx)("div",{className:`w-20 h-10 rounded-full \n                            ${t?"bg-green-500 shadow-lg shadow-green-200 dark:shadow-green-900/20":"bg-gray-300 dark:bg-gray-600"}\n                            before:content-[''] before:absolute before:top-0 before:left-0 before:bottom-0 before:right-0 \n                            peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-700\n                            peer-checked:after:translate-x-10\n                            after:content-[''] after:absolute after:top-1 after:left-1\n                            after:bg-white dark:after:bg-gray-200 after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full\n                            after:h-8 after:w-8 after:transition-all after:duration-300 ease-in-out\n                            transition-colors duration-300`})]}),(0,L.jsx)("span",{className:"mt-2 text-sm font-medium",children:t?(0,L.jsx)("span",{className:"text-green-600 dark:text-green-400 font-bold",children:e("worktime.tracker.running")}):(0,L.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:e("worktime.tracker.start")})})]}),(0,L.jsx)("button",{onClick:()=>{x(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-2 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-blue-700 shadow-sm flex items-center justify-center ml-8 mt-1",title:e("worktime.tracker.showTimes"),children:(0,L.jsx)(_,{className:"h-6 w-6"})})]}),(0,L.jsx)("div",{className:"p-2 my-2 rounded-md text-sm "+(t&&c?"bg-green-50 dark:bg-green-900/20 dark:text-green-200":"bg-gray-50 dark:bg-gray-700 dark:text-gray-300"),children:t&&c?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("p",{children:[(0,L.jsx)("strong",{children:e("worktime.tracker.activeTracking")})," ",i]}),(0,L.jsxs)("p",{children:[(0,L.jsx)("strong",{children:e("worktime.tracker.started")})," ",(e=>{"string"===typeof e&&e.endsWith("Z")&&(e=e.substring(0,e.length-1));const t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}, ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`})(l||Date.now())]}),(0,L.jsxs)("p",{children:[(0,L.jsxs)("strong",{children:[e("worktime.tracker.selectBranchLabel"),":"]})," ",S||e("worktime.tracker.unknown")]})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("p",{children:"\xa0"}),(0,L.jsx)("p",{children:"\xa0"}),(0,L.jsx)("p",{children:"\xa0"})]})}),h&&(0,L.jsx)(V.G,{isOpen:h,onClose:()=>{x(!1)}})]})};var H=r(4426),Z=r(7829),U=r(7488),G=r(1052),Q=r(1853),Y=r(957),X=r(637),J=r(9837),ee=r(887);const te=["title","responsibleAndQualityControl","status","dueDate","branch","actions"],re="worktracker-todos",ae={title:"asc",status:"asc",responsible:"asc",qualityControl:"asc",branch:"asc",dueDate:"asc",description:"asc"},se={title:["title"],status:["status"],responsibleAndQualityControl:["responsible","qualityControl"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},le={title:"title",status:"status",responsible:"responsibleAndQualityControl",qualityControl:"responsibleAndQualityControl",branch:"branch",dueDate:"dueDate",description:"description"},ne=()=>{const{t:e}=(0,s.Bd)(),{user:t}=(0,n.As)(),{hasPermission:r}=(0,o.S)(),A=(0,l.zy)(),S=(0,a.useMemo)((()=>[{id:"title",label:e("tasks.columns.title"),shortLabel:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status"),shortLabel:e("tasks.columns.status")},{id:"responsibleAndQualityControl",label:e("tasks.columns.responsibleAndQualityControl"),shortLabel:e("tasks.columns.responsibleAndQualityControl").split("/")[0]},{id:"branch",label:e("tasks.columns.branch"),shortLabel:e("tasks.columns.branch").substring(0,5)},{id:"dueDate",label:e("tasks.columns.dueDate"),shortLabel:e("tasks.columns.dueDate").substring(0,5)},{id:"actions",label:e("tasks.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),T=(0,a.useMemo)((()=>[{id:"responsible",label:e("tasks.columns.responsible"),shortLabel:e("tasks.columns.responsible").substring(0,3)},{id:"qualityControl",label:e("tasks.columns.qualityControl"),shortLabel:e("tasks.columns.qualityControl").substring(0,2)}]),[e]),[E,$]=(0,a.useState)([]),[R,q]=(0,a.useState)(!0),[M,B]=(0,a.useState)(null),[W,_]=(0,a.useState)(""),[z,K]=(0,a.useState)("all"),[V,ne]=(0,a.useState)([]),[oe,ie]=(0,a.useState)([]),[de,ce]=(0,a.useState)(""),[ue,me]=(0,a.useState)(null),[ge,he]=(0,a.useState)(!1),[xe,be]=(0,a.useState)({key:"dueDate",direction:"asc"}),[pe,ke]=(0,a.useState)(!1),[fe,ye]=(0,a.useState)(!1),[ve,we]=(0,a.useState)(null),[je,Ne]=(0,a.useState)(null),{settings:Ce,isLoading:Ae,updateColumnOrder:Se,updateHiddenColumns:Te,toggleColumnVisibility:Ee,isColumnVisible:De,updateViewMode:Le}=(0,i.F)("worktracker_tasks",{defaultColumnOrder:te,defaultHiddenColumns:[],defaultViewMode:"cards"}),[$e,Ie]=(0,a.useState)(null),[Re,qe]=(0,a.useState)(null),[Fe,Me]=(0,a.useState)(10),Oe=Ce.viewMode||"cards",[Be,We]=(0,a.useState)((()=>ae)),_e=(0,a.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const r=se[e];r&&r.length>0&&t.push(...r)})),t.includes("description")||t.push("description"),t})(Ce.columnOrder||te)),[Ce.columnOrder]),ze=(0,a.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(se[e]||[]).forEach((e=>t.add(e)))})),t})(Ce.hiddenColumns||[])),[Ce.hiddenColumns]),Ke=(0,a.useMemo)((()=>new Set(_e.filter((e=>!ze.has(e))))),[_e,ze]);(0,a.useEffect)((()=>{document.querySelectorAll(".dashboard-tasks-wrapper").forEach((e=>{"cards"===Oe?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[Oe]);const Ve=(0,a.useRef)(!1),Pe=async()=>{try{q(!0);const e=await C.A.get(D.Sn.TASKS.BASE);$(e.data),B(null)}catch(M){console.error("Fehler beim Laden der Tasks:",M),B(e("worktime.messages.tasksLoadError"))}finally{q(!1)}};(0,a.useEffect)((()=>{Ve.current||(Ve.current=!0,Pe())}),[]),(0,a.useEffect)((()=>{if(E.length>0){const e=new URLSearchParams(A.search).get("editTask");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=E.find((e=>e.id===t));e&&(we(e),ye(!0))}}}}),[E,A.search]),(0,a.useEffect)((()=>{(async()=>{try{const e=await C.A.get(D.Sn.SAVED_FILTERS.BY_TABLE(re)),t=e.data.find((e=>"Aktuell"===e.name));t&&(ce("Aktuell"),me(t.id),Xe(t.conditions,t.operators))}catch(M){console.error("Fehler beim Setzen des initialen Filters:",M)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("Nicht authentifiziert");const t=(await C.A.get(`${D.Sn.SAVED_FILTERS.BY_TABLE(re)}`,{headers:{Authorization:`Bearer ${e}`}})).data||[],r=t.some((e=>"Archiv"===e.name)),a=t.some((e=>"Aktuell"===e.name));if(!r){const t={tableId:re,name:"Archiv",conditions:[{column:"status",operator:"equals",value:"done"}],operators:[]};await C.A.post(`${D.Sn.SAVED_FILTERS.BASE}`,t,{headers:{Authorization:`Bearer ${e}`}})}if(!a){const t={tableId:re,name:"Aktuell",conditions:[{column:"status",operator:"notEquals",value:"done"}],operators:[]};await C.A.post(`${D.Sn.SAVED_FILTERS.BASE}`,t,{headers:{Authorization:`Bearer ${e}`}})}}catch(M){console.error("Fehler beim Erstellen der Standard-Filter:",M)}})()}),[]);const He=async(t,r)=>{try{$((e=>e.map((e=>e.id===t?{...e,status:r}:e)))),await C.A.patch(D.Sn.TASKS.BY_ID(t),{status:r}),U.oR.success(e("worktime.messages.taskUpdated"))}catch(M){console.error("Fehler beim Aktualisieren des Status:",M),Pe(),U.oR.error(e("worktime.messages.taskUpdatedError"))}},Ze=e=>{return e.responsible?e.responsible.id===(null===t||void 0===t?void 0:t.id):e.role&&(null===t||void 0===t||null===(r=t.roles)||void 0===r?void 0:r.some((t=>{var r,a;return(null===(r=t.role)||void 0===r?void 0:r.id)===(null===(a=e.role)||void 0===a?void 0:a.id)})))||!1;var r},Ue=e=>{var r;return(null===(r=e.qualityControl)||void 0===r?void 0:r.id)===(null===t||void 0===t?void 0:t.id)},Ge=e=>{be((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},Qe=t=>{const a=[];return r("tasks","write","table")?("in_progress"===t.status&&Ze(t)?a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"open"),className:"p-2.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToOpen"),children:(0,L.jsx)(c.A,{className:"h-7 w-7"})},"back")):"quality_control"===t.status&&Ze(t)?a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"in_progress"),className:"p-2 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToInProgress"),children:(0,L.jsx)(c.A,{className:"h-6 w-6"})},"back")):"done"===t.status&&Ue(t)&&a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"quality_control"),className:"p-2 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToQualityControl"),children:(0,L.jsx)(c.A,{className:"h-6 w-6"})},"back")),"open"===t.status&&Ze(t)?a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"in_progress"),className:"p-2.5 bg-blue-600 dark:bg-blue-500 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-600",title:e("tasks.actions.setInProgress"),children:(0,L.jsx)(u.A,{className:"h-7 w-7"})},"forward")):"in_progress"===t.status&&Ze(t)?a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"quality_control"),className:"p-2.5 bg-purple-600 dark:bg-purple-500 text-white rounded hover:bg-purple-700 dark:hover:bg-purple-600",title:e("tasks.actions.setQualityControl"),children:(0,L.jsx)(u.A,{className:"h-7 w-7"})},"forward")):"quality_control"===t.status&&Ue(t)&&a.push((0,L.jsx)("button",{onClick:()=>He(t.id,"done"),className:"p-2.5 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",title:e("tasks.actions.markDone"),children:(0,L.jsx)(u.A,{className:"h-7 w-7"})},"forward")),a):a},Ye=()=>V.length,Xe=(e,t)=>{ne(e),ie(t)},Je=()=>{ne([]),ie([]),ce(""),me(null)},et=(e,t,r,a)=>{ce(e),me(t),Xe(r,a)},tt=e=>{switch(e){case"open":return 1;case"in_progress":return 2;case"improval":return 3;case"quality_control":return 4;case"done":return 5;default:return 99}},rt=(0,a.useMemo)((()=>E.filter((e=>{if(W){const t=W.toLowerCase();if(!(e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||!!e.responsible&&`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase().includes(t)||!!e.role&&e.role.name.toLowerCase().includes(t)||e.qualityControl&&`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)))return!1}if(V.length>0){let t=V.length>0;for(let r=0;r<V.length;r++){const a=V[r];let s=!1;switch(a.column){case"title":"equals"===a.operator?s=e.title===a.value:"contains"===a.operator?s=e.title.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator?s=e.title.toLowerCase().startsWith((a.value||"").toLowerCase()):"endsWith"===a.operator&&(s=e.title.toLowerCase().endsWith((a.value||"").toLowerCase()));break;case"status":"equals"===a.operator?s=e.status===a.value:"notEquals"===a.operator&&(s=e.status!==a.value);break;case"responsible":const t=a.value||"";if(t.startsWith("user-")){const r=parseInt(t.replace("user-",""));s=!!e.responsible&&e.responsible.id===r}else if(t.startsWith("role-")){const r=parseInt(t.replace("role-",""));s=!!e.role&&e.role.id===r}else if(""===t)s=!0;else if("equals"===a.operator){s=(e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase():e.role?e.role.name.toLowerCase():"")===t.toLowerCase()}else if("contains"===a.operator){s=(e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase():e.role?e.role.name.toLowerCase():"").includes(t.toLowerCase())}break;case"qualityControl":const r=a.value||"";if(r.startsWith("user-")){const t=parseInt(r.replace("user-",""));s=!!e.qualityControl&&e.qualityControl.id===t}else if(""===r)s=!0;else if("equals"===a.operator){s=(e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase():"")===r.toLowerCase()}else if("contains"===a.operator){s=(e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase():"").includes(r.toLowerCase())}break;case"responsibleAndQualityControl":const l=a.value||"";if(l.startsWith("user-")){const t=parseInt(l.replace("user-",""));s=!!e.responsible&&e.responsible.id===t||!!e.qualityControl&&e.qualityControl.id===t}else if(l.startsWith("role-")){const t=parseInt(l.replace("role-",""));s=!!e.role&&e.role.id===t}else if(""===l)s=!0;else if("equals"===a.operator){const t=e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase():e.role?e.role.name.toLowerCase():"",r=e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase():"";s=t===l.toLowerCase()||r===l.toLowerCase()}else if("contains"===a.operator){const t=e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase():e.role?e.role.name.toLowerCase():"",r=e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase():"";s=t.includes(l.toLowerCase())||r.includes(l.toLowerCase())}break;case"branch":const n=e.branch.name.toLowerCase();"equals"===a.operator?s=n===(a.value||"").toLowerCase():"contains"===a.operator&&(s=n.includes((a.value||"").toLowerCase()));break;case"dueDate":if(!e.dueDate){s=!1;break}const o=new Date(e.dueDate);if("equals"===a.operator){const e=new Date(a.value);s=o.toDateString()===e.toDateString()}else if("before"===a.operator){s=o<new Date(a.value)}else if("after"===a.operator){s=o>new Date(a.value)}}if(0===r)t=s;else{t="AND"===oe[r-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>{if("cards"===Oe){const r=_e.filter((e=>Ke.has(e)));for(const a of r){const r=Be[a]||"asc";let s,l;switch(a){case"title":s=e.title.toLowerCase(),l=t.title.toLowerCase();break;case"status":s=tt(e.status),l=tt(t.status);break;case"responsible":s=e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase():e.role?`Rolle: ${e.role.name}`.toLowerCase():"",l=t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`.toLowerCase():t.role?`Rolle: ${t.role.name}`.toLowerCase():"";break;case"qualityControl":s=e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`.toLowerCase():"",l=t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`.toLowerCase():"";break;case"branch":s=e.branch.name.toLowerCase(),l=t.branch.name.toLowerCase();break;case"dueDate":s=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,l=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;break;case"description":s=(e.description||"").toLowerCase(),l=(t.description||"").toLowerCase();break;default:continue}let n=0;if(n="number"===typeof s&&"number"===typeof l?s-l:String(s).localeCompare(String(l)),"desc"===r&&(n=-n),0!==n)return n}return 0}{if(xe.key){let r,a;switch(xe.key){case"title":r=e.title,a=t.title;break;case"status":r=tt(e.status),a=tt(t.status);break;case"responsible.firstName":r=e.responsible?`${e.responsible.firstName} ${e.responsible.lastName}`:e.role?`Rolle: ${e.role.name}`:"",a=t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`:t.role?`Rolle: ${t.role.name}`:"";break;case"qualityControl.firstName":r=e.qualityControl?`${e.qualityControl.firstName} ${e.qualityControl.lastName}`:"",a=t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`:"";break;case"branch.name":r=e.branch.name,a=t.branch.name;break;case"dueDate":r=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,a=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;break;default:r=e[xe.key],a=t[xe.key]}if("number"===typeof r&&"number"===typeof a)return"asc"===xe.direction?r-a:a-r;{const e=String(r).localeCompare(String(a));return"asc"===xe.direction?e:-e}}const r=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,a=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;if(r!==a)return r-a;const s=tt(e.status),l=tt(t.status);return s!==l?s-l:e.title.localeCompare(t.title)}}))),[E,W,xe,tt,V,oe,Oe,_e,Ke,Be]),at=(e,t)=>{const r=[...Ce.columnOrder],a=r[e];r.splice(e,1),r.splice(t,0,a),Se(r)},st=e=>{Ie(e)},lt=(e,t)=>{e.preventDefault(),$e&&$e!==t&&qe(t)},nt=(e,t)=>{if(e.preventDefault(),$e&&$e!==t){const e=Ce.columnOrder.indexOf($e),r=Ce.columnOrder.indexOf(t);e>-1&&r>-1&&at(e,r)}Ie(null),qe(null)},ot=()=>{Ie(null),qe(null)},it=Ce.columnOrder.filter((e=>De(e))),dt=async e=>{try{var t;const r={title:`${e.title}-Kopie`,description:e.description,status:"open",responsibleId:e.responsible?e.responsible.id:null,roleId:e.role?e.role.id:null,qualityControlId:(null===(t=e.qualityControl)||void 0===t?void 0:t.id)||null,branchId:e.branch.id,dueDate:e.dueDate},a=await C.A.post(D.Sn.TASKS.BASE,r);$((e=>[a.data,...e])),we(a.data),ye(!0)}catch(s){var r,a;console.error("Fehler beim Kopieren des Tasks:",s);const e=s;B((null===(r=e.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}};return(0,L.jsxs)("div",{className:"min-h-screen",children:[(0,L.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,L.jsxs)("div",{className:"w-full mb-4",children:[(0,L.jsxs)("div",{className:"block sm:hidden w-full",children:[(0,L.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 w-full mb-20",children:[(0,L.jsxs)("div",{className:"flex items-center justify-between",children:[(0,L.jsx)("div",{className:"flex items-center",children:r("tasks","write","table")&&(0,L.jsx)("button",{onClick:()=>ke(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("tasks.createTask"),"aria-label":e("tasks.createTask"),children:(0,L.jsx)(m.A,{className:"h-4 w-4"})})}),(0,L.jsxs)("div",{className:"flex items-center",children:[(0,L.jsx)(g.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,L.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("tasks.title")})]}),(0,L.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,L.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:W,onChange:e=>_(e.target.value)}),(0,L.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 "+("cards"===Oe?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Le("table"===Oe?"cards":"table"),title:e("table"===Oe?"common.viewAsCards":"common.viewAsTable"),children:"table"===Oe?(0,L.jsx)(h.A,{className:"h-5 w-5"}):(0,L.jsx)(x.A,{className:"h-5 w-5"})}),(0,L.jsxs)("button",{className:`p-2 rounded-md ${Ye()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"} ml-1 relative`,onClick:()=>he(!ge),title:e("common.filter"),children:[(0,L.jsx)(b.A,{className:"h-5 w-5"}),Ye()>0&&(0,L.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Ye()})]}),(0,L.jsx)("div",{className:"ml-1",children:(0,L.jsx)(d.A,{columns:"cards"===Oe?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:S,visibleColumns:"cards"===Oe?Array.from(Ke):it,columnOrder:"cards"===Oe?_e:Ce.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Oe){const t=le[e];t&&Ee(t)}else Ee(e)},onMoveColumn:"cards"===Oe?(e,t)=>{const r=[..._e],a=r[e];r.splice(e,1),r.splice(t,0,a);const s=[],l=new Set;r.forEach((e=>{const t=le[e];t&&!l.has(t)&&(l.add(t),s.push(t))})),S.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),Se(s)}:at,sortDirections:"cards"===Oe?Be:void 0,onSortDirectionChange:"cards"===Oe?(e,t)=>{We((r=>({...r,[e]:t})))}:void 0,showSortDirection:"cards"===Oe,buttonTitle:e("cards"===Oe?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Oe?"tableColumn.sortAndDisplay":"tableColumn.configure"),onClose:()=>{}})})]})]}),ge&&(0,L.jsx)(H.A,{columns:[...S,...T],onApply:Xe,onReset:Je,savedConditions:V,savedOperators:oe,tableId:re}),(0,L.jsx)(Z.A,{tableId:re,onSelectFilter:Xe,onReset:Je,activeFilterName:de,selectedFilterId:ue,onFilterChange:et,defaultFilterName:"Aktuell"}),"table"===Oe?(0,L.jsx)("div",{className:"overflow-x-auto",children:(0,L.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,L.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,L.jsx)("tr",{children:it.map((e=>{const t=S.find((t=>t.id===e));return t?(0,L.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider "+(e===Re?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>st(e),onDragOver:t=>lt(t,e),onDrop:t=>nt(t,e),onDragEnd:ot,children:(0,L.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,L.jsx)("button",{onClick:()=>Ge(e),className:"ml-1 focus:outline-none",children:(0,L.jsx)(p.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,L.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:R?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center",children:(0,L.jsx)("div",{className:"flex justify-center",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):M?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:M})}):0===rt.length?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,L.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,L.jsx)(k.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,L.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,L.jsx)(L.Fragment,{children:rt.slice(0,Fe).map((t=>{const a=(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,G.F2)(a);return(0,L.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 "+("none"!==a?`${s.bgClass} ${s.borderClass} border-l-4`:""),children:it.map((a=>{switch(a){case"title":return(0,L.jsx)("td",{className:"px-6 py-4",children:(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,L.jsxs)("div",{className:"ml-2 relative group",children:[(0,L.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("tasks.showDescription"),children:(0,L.jsx)(f.A,{className:"h-5 w-5"})}),(0,L.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,L.jsx)(I.A,{content:t.description,showImagePreview:!0})})]})]})},a);case"status":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${(0,Q.qY)(t.status,"task")} dark:bg-opacity-30 status-col`,children:t.status})},a);case"responsibleAndQualityControl":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:"flex flex-col",children:[(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:"Verantwortlich:"}),(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:"Ver.:"}),(0,L.jsx)("br",{}),t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`:t.role?t.role.name:"-"]}),(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,L.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,L.jsx)("br",{}),t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`:"-"]})]})},a);case"branch":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},a);case"dueDate":const s=(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description),l=(0,G.F2)(s);return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:`text-sm ${"none"!==s?l.textClass:"text-gray-900 dark:text-gray-200"}`,children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,L.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},a);case"actions":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,L.jsx)("div",{className:"status-buttons",children:Qe(t)}),r("tasks","write","table")&&(0,L.jsx)("button",{onClick:()=>{we(t),ye(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,L.jsx)(y.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,L.jsx)("button",{onClick:()=>dt(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,L.jsx)(v.A,{className:"h-4 w-4"})})]})},a);default:return null}}))},t.id)}))})})]})}):(0,L.jsx)("div",{className:"-mx-6",children:R?(0,L.jsx)("div",{className:"flex justify-center py-12",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):M?(0,L.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:M}):0===rt.length?(0,L.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,L.jsx)(k.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,L.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,L.jsx)(X.A,{children:rt.slice(0,Fe).map((t=>{(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description);const a=[];if(Ke.has("branch")&&a.push({icon:(0,L.jsx)(w.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ke.has("responsible")&&a.push({icon:(0,L.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`:t.role?t.role.name:"-",section:"main"}),Ke.has("qualityControl")&&a.push({icon:(0,L.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`:"-",section:"main-second"}),Ke.has("dueDate")){const r=(0,G.Rj)(t.dueDate,"todo",t.title,t.description,(0,L.jsx)(N.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,J.GP)(e,"dd.MM.yyyy",{locale:ee.de})),!1);a.push({...r,section:"right-inline"})}Ke.has("description")&&t.description&&a.push({icon:(0,L.jsx)(f.A,{className:"h-4 w-4"}),label:e("tasks.columns.description"),value:"",descriptionContent:t.description,section:"full"});const s=(0,L.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,L.jsx)("div",{className:"status-buttons",children:Qe(t)}),r("tasks","write","table")&&(0,L.jsx)("button",{onClick:e=>{e.stopPropagation(),we(t),ye(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,L.jsx)(y.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,L.jsx)("button",{onClick:e=>{e.stopPropagation(),dt(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,L.jsx)(v.A,{className:"h-4 w-4"})})]});return(0,L.jsx)(Y.A,{title:t.title,status:{label:(0,Q.Iw)(t.status,"task",e),color:(0,Q.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:a,actions:s},t.id)}))})}),rt.length>Fe&&(0,L.jsx)("div",{className:"mt-4 flex justify-center",children:(0,L.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Me((e=>e+10)),children:[e("common.showMore")," (",rt.length-Fe," ",e("common.remaining"),")"]})})]}),(0,L.jsx)("div",{className:"fixed bottom-13 left-0 right-0 w-full bg-white dark:bg-gray-800 z-9 shadow-lg border-t-0 dark:border-t dark:border-gray-700",children:(0,L.jsx)(P,{})})]}),(0,L.jsxs)("div",{className:"hidden sm:block",children:[(0,L.jsx)("div",{className:"mb-8",children:(0,L.jsx)(P,{})}),(0,L.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 w-full mb-20",children:[(0,L.jsxs)("div",{className:"flex items-center mb-4 justify-between",children:[(0,L.jsx)("div",{className:"flex items-center",children:r("tasks","write","table")&&(0,L.jsx)("button",{onClick:()=>ke(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("tasks.createTask"),"aria-label":e("tasks.createTask"),children:(0,L.jsx)(m.A,{className:"h-4 w-4"})})}),(0,L.jsxs)("div",{className:"flex items-center",children:[(0,L.jsx)(g.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,L.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("tasks.title")})]}),(0,L.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,L.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:W,onChange:e=>_(e.target.value)}),(0,L.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 "+("cards"===Oe?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Le("table"===Oe?"cards":"table"),title:e("table"===Oe?"common.viewAsCards":"common.viewAsTable"),children:"table"===Oe?(0,L.jsx)(h.A,{className:"h-5 w-5"}):(0,L.jsx)(x.A,{className:"h-5 w-5"})}),(0,L.jsxs)("button",{className:`p-2 rounded-md ${Ye()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"} ml-1 relative`,onClick:()=>he(!ge),title:e("common.filter"),children:[(0,L.jsx)(b.A,{className:"h-5 w-5"}),Ye()>0&&(0,L.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Ye()})]}),(0,L.jsx)("div",{className:"ml-1",children:(0,L.jsx)(d.A,{columns:"cards"===Oe?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:S,visibleColumns:"cards"===Oe?Array.from(Ke):it,columnOrder:"cards"===Oe?_e:Ce.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Oe){const t=le[e];t&&Ee(t)}else Ee(e)},onMoveColumn:"cards"===Oe?(e,t)=>{const r=[..._e],a=r[e];r.splice(e,1),r.splice(t,0,a);const s=[],l=new Set;r.forEach((e=>{const t=le[e];t&&!l.has(t)&&(l.add(t),s.push(t))})),S.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),Se(s)}:at,sortDirections:"cards"===Oe?Be:void 0,onSortDirectionChange:"cards"===Oe?(e,t)=>{We((r=>({...r,[e]:t})))}:void 0,showSortDirection:"cards"===Oe,buttonTitle:e("cards"===Oe?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Oe?"tableColumn.sortAndDisplay":"tableColumn.configure"),onClose:()=>{}})})]})]}),ge&&(0,L.jsx)(H.A,{columns:[...S,...T],onApply:Xe,onReset:Je,savedConditions:V,savedOperators:oe,tableId:re}),(0,L.jsx)(Z.A,{tableId:re,onSelectFilter:Xe,onReset:Je,activeFilterName:de,selectedFilterId:ue,onFilterChange:et,defaultFilterName:"Aktuell"}),"table"===Oe?(0,L.jsx)("div",{className:"overflow-x-auto",children:(0,L.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,L.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,L.jsx)("tr",{children:it.map((e=>{const t=S.find((t=>t.id===e));return t?(0,L.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider "+(e===Re?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>st(e),onDragOver:t=>lt(t,e),onDrop:t=>nt(t,e),onDragEnd:ot,children:(0,L.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,L.jsx)("button",{onClick:()=>Ge(e),className:"ml-1 focus:outline-none",children:(0,L.jsx)(p.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,L.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:R?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center",children:(0,L.jsx)("div",{className:"flex justify-center",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):M?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:M})}):0===rt.length?(0,L.jsx)("tr",{children:(0,L.jsx)("td",{colSpan:it.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,L.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,L.jsx)(k.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,L.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,L.jsx)(L.Fragment,{children:rt.slice(0,Fe).map((t=>{const a=(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,G.F2)(a);return(0,L.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 "+("none"!==a?`${s.bgClass} ${s.borderClass} border-l-4`:""),children:it.map((a=>{switch(a){case"title":return(0,L.jsx)("td",{className:"px-6 py-4",children:(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,L.jsxs)("div",{className:"ml-2 relative group",children:[(0,L.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("tasks.showDescription"),children:(0,L.jsx)(f.A,{className:"h-5 w-5"})}),(0,L.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,L.jsx)(I.A,{content:t.description,showImagePreview:!0})})]})]})},a);case"status":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${(0,Q.qY)(t.status,"task")} dark:bg-opacity-30 status-col`,children:t.status})},a);case"responsibleAndQualityControl":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:"flex flex-col",children:[(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:"Verantwortlich:"}),(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:"Ver.:"}),(0,L.jsx)("br",{}),t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`:t.role?t.role.name:"-"]}),(0,L.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,L.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,L.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,L.jsx)("br",{}),t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`:"-"]})]})},a);case"branch":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},a);case"dueDate":const s=(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description),l=(0,G.F2)(s);return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:`text-sm ${"none"!==s?l.textClass:"text-gray-900 dark:text-gray-200"}`,children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,L.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},a);case"actions":return(0,L.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,L.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,L.jsx)("div",{className:"status-buttons",children:Qe(t)}),r("tasks","write","table")&&(0,L.jsx)("button",{onClick:()=>{we(t),ye(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,L.jsx)(y.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,L.jsx)("button",{onClick:()=>dt(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,L.jsx)(v.A,{className:"h-4 w-4"})})]})},a);default:return null}}))},t.id)}))})})]})}):(0,L.jsx)("div",{className:"-mx-6",children:R?(0,L.jsx)("div",{className:"flex justify-center py-12",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):M?(0,L.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:M}):0===rt.length?(0,L.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,L.jsx)(k.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,L.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,L.jsx)(X.A,{children:rt.slice(0,Fe).map((t=>{(0,G.go)(t.dueDate,"todo",void 0,t.title,t.description);const a=[];if(Ke.has("branch")&&a.push({icon:(0,L.jsx)(w.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ke.has("responsible")&&a.push({icon:(0,L.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:t.responsible?`${t.responsible.firstName} ${t.responsible.lastName}`:t.role?t.role.name:"-",section:"main"}),Ke.has("qualityControl")&&a.push({icon:(0,L.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:t.qualityControl?`${t.qualityControl.firstName} ${t.qualityControl.lastName}`:"-",section:"main-second"}),Ke.has("dueDate")){const r=(0,G.Rj)(t.dueDate,"todo",t.title,t.description,(0,L.jsx)(N.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,J.GP)(e,"dd.MM.yyyy",{locale:ee.de})),!1);a.push({...r,section:"right-inline"})}Ke.has("description")&&t.description&&a.push({icon:(0,L.jsx)(f.A,{className:"h-4 w-4"}),label:e("tasks.columns.description"),value:"",descriptionContent:t.description,section:"full"});const s=(0,L.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,L.jsx)("div",{className:"status-buttons",children:Qe(t)}),r("tasks","write","table")&&(0,L.jsx)("button",{onClick:e=>{e.stopPropagation(),we(t),ye(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,L.jsx)(y.A,{className:"h-4 w-4"})}),r("tasks","both","table")&&(0,L.jsx)("button",{onClick:e=>{e.stopPropagation(),dt(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,L.jsx)(v.A,{className:"h-4 w-4"})})]});return(0,L.jsx)(Y.A,{title:t.title,status:{label:(0,Q.Iw)(t.status,"task",e),color:(0,Q.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:a,actions:s},t.id)}))})}),rt.length>Fe&&(0,L.jsx)("div",{className:"mt-4 flex justify-center",children:(0,L.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Me((e=>e+10)),children:[e("common.showMore")," (",rt.length-Fe," ",e("common.remaining"),")"]})})]})]})]})}),(0,L.jsx)(F,{isOpen:pe,onClose:()=>ke(!1),onTaskCreated:e=>{$((t=>[e,...t])),ye(!0),we(e)}}),ve&&(0,L.jsx)(O,{isOpen:fe,onClose:()=>{ye(!1),we(null)},onTaskUpdated:t=>{$((e=>e.map((e=>e.id===t.id?t:e)))),ye(!1),we(null),U.oR.success(e("worktime.messages.taskUpdated"))},task:ve})]})}},7012:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const l=a.forwardRef(s)},7030:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 9h16.5m-16.5 6.75h16.5"}))}const l=a.forwardRef(s)},7988:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const l=a.forwardRef(s)},8010:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const l=a.forwardRef(s)},8224:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const l=a.forwardRef(s)},8658:(e,t,r)=>{r.d(t,{G:()=>i});var a=r(5043),s=r(1923),l=r(1801),n=r(1713),o=r(579);const i=e=>{var t;let{isOpen:r,onClose:i,selectedDate:d}=e;const c=new Date,u=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")}`,[m,g]=(0,a.useState)([]),[h,x]=(0,a.useState)(d||u),[b,p]=(0,a.useState)(!0),[k,f]=(0,a.useState)("0h 0m"),[y,v]=(0,a.useState)(null),[w,j]=(0,a.useState)(null),N=()=>{if(!y)return!1;try{return y.startTime.split("T")[0]===h}catch(w){return console.error("Fehler beim Pr\xfcfen der Relevanz der aktiven Zeiterfassung:",w),!1}},C=(0,a.useCallback)((async()=>{try{j(null),p(!0);if(!localStorage.getItem("token"))return j("Nicht authentifiziert"),void p(!1);const e=h,t=[...(await s.A.get(`${l.Sn.WORKTIME.BASE}?date=${e}`)).data].sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime()));g(t);const r=await s.A.get(l.Sn.WORKTIME.ACTIVE);r.data&&Object.keys(r.data).length>0?v(r.data):v(null),p(!1)}catch(w){console.error("Fehler beim Laden der Zeiterfassungen:",w),j("Fehler beim Laden der Zeiterfassungen"),p(!1)}}),[h]);if((0,a.useEffect)((()=>{r&&C()}),[r,C]),(0,a.useEffect)((()=>{let e=0;if(m.filter((e=>(0,n.uT)(e,h))).forEach((t=>{if(t.endTime)try{const r=new Date(t.startTime),a=new Date(t.endTime).getTime()-r.getTime();if(a>0){const t=Math.floor(a/6e4);e+=t}}catch(w){console.error("Fehler bei der Berechnung:",w)}})),y&&N())try{const t=new Date(`${y.startTime.split("Z")[0]}`),r=(new Date).getTime()-t.getTime();if(r>0){const t=Math.floor(r/6e4);e+=t}}catch(w){console.error("Fehler bei der Berechnung der aktiven Zeiterfassung:",w)}const t=Math.floor(e/60);f(`${t}h ${e%60}m`)}),[m,y,h]),!r)return null;const A=m.filter((e=>(0,n.uT)(e,h)));return(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,o.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,o.jsxs)("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between",children:[(0,o.jsxs)("h2",{className:"text-xl font-semibold dark:text-white",children:["Zeiteintr\xe4ge f\xfcr ",(0,n.Yq)(h)]}),(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("input",{type:"date",value:h,onChange:e=>{x(e.target.value)},className:"border dark:border-gray-600 rounded-md px-3 py-2 dark:bg-gray-700 dark:text-white"}),(0,o.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"\u2715"})]})]}),(0,o.jsx)("div",{className:"overflow-y-auto flex-grow",children:b?(0,o.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})}):0===m.filter((e=>(0,n.uT)(e,h)&&(null!==e.endTime||N()))).length?(0,o.jsx)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Keine Zeiteintr\xe4ge f\xfcr diesen Tag gefunden."}):(0,o.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,o.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Start"}),(0,o.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ende"}),(0,o.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Dauer"}),(0,o.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Niederlassung"})]})}),(0,o.jsxs)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[A.filter((e=>null!==e.endTime)).sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime())).map((e=>(0,o.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.fU)(e.startTime)}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.endTime?(0,n.fU)(e.endTime):"-"}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.P0)(e.startTime,e.endTime)}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.branch.name})]},e.id))),N()&&(0,o.jsxs)("tr",{className:"bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50",children:[(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.fU)(y.startTime)}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,o.jsx)("span",{className:"italic",children:"Aktiv"})}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200 font-medium text-green-600 dark:text-green-400",children:(()=>{if(!y)return"-";const e=y.startTime.endsWith("Z")?y.startTime.substring(0,y.startTime.length-1):y.startTime,t=new Date(e),r=(new Date).getTime()-t.getTime(),a=Math.floor(r/6e4);return`${Math.floor(a/60)}h ${a%60}m (l\xe4uft)`})()}),(0,o.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(null===(t=y.branch)||void 0===t?void 0:t.name)||"Unbekannt"})]})]}),(0,o.jsx)("tfoot",{className:"bg-gray-100 dark:bg-gray-700",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{colSpan:2,className:"px-6 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300",children:"Gesamtdauer des Tages:"}),(0,o.jsx)("td",{className:"px-6 py-3 text-left text-sm font-bold text-gray-900 dark:text-white",children:k}),(0,o.jsx)("td",{})]})})]})})]})})}},9531:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const l=a.forwardRef(s)},9626:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(5043);function s(e,t){let{title:r,titleId:s,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),r?a.createElement("title",{id:s},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))}const l=a.forwardRef(s)}}]);
//# sourceMappingURL=938.c5f056a9.chunk.js.map