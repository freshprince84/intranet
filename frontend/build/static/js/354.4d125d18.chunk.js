"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[354],{1713:(e,t,r)=>{r.d(t,{DW:()=>k,I5:()=>g,IF:()=>f,P0:()=>d,Pg:()=>w,Yq:()=>i,_2:()=>u,c$:()=>x,fU:()=>c,h4:()=>y,pg:()=>h,uT:()=>m,vv:()=>p});var a=r(4653),n=r(9837),l=r(1620),s=r(6981),o=r(887);const i=e=>{if(!e)return"-";try{const t=e.split("-");if(3!==t.length)return"-";const r=parseInt(t[0]),a=parseInt(t[1])-1,n=parseInt(t[2]);return new Date(r,a,n,12,0,0).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Fehler beim Formatieren des Datums:",t),"-"}},c=e=>{if(!e)return"-";try{const t=(0,a.H)(e),r=t.getUTCHours().toString().padStart(2,"0"),n=t.getUTCMinutes().toString().padStart(2,"0");return"".concat(r,":").concat(n)}catch(t){return console.error("Fehler beim Formatieren der Zeit f\xfcr ".concat(e,":"),t),"-"}},d=(e,t)=>{if(!e||!t)return"-";try{const r=e.endsWith("Z")?e.substring(0,e.length-1):e,a=t.endsWith("Z")?t.substring(0,t.length-1):t,n=new Date(r),l=new Date(a).getTime()-n.getTime(),s=Math.floor(l/6e4),o=Math.floor(s/60),i=s%60;return"".concat(o,"h ").concat(i,"m")}catch(r){return console.error("Fehler bei der Dauerberechnung:",r),"-"}},h=e=>{try{const t=parseInt(e.substring(0,4)),r=parseInt(e.substring(6)),a=new Date(Date.UTC(t,0,1,12,0,0)).getUTCDay(),s=a<=4?4-a:11-a,i=new Date(Date.UTC(t,0,1+s,12,0,0)),c=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+7*(r-1),12,0,0)),d=new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()-3,12,0,0)),h=(0,n.GP)(d,"yyyy-MM-dd");if(console.log("Konvertierte Woche ".concat(e," zu Datum: ").concat(h," (Wochentag: ").concat((0,n.GP)(d,"EEEE",{locale:o.de}),")")),"Montag"!==(0,n.GP)(d,"EEEE",{locale:o.de})){console.warn("Berechnetes Datum ist kein Montag! Korrigiere...");const e=(0,l.k)(d,{weekStartsOn:1});return(0,n.GP)(e,"yyyy-MM-dd")}return h}catch(t){console.error("Fehler beim Konvertieren des Wochendatums:",t);const e=(0,l.k)(new Date,{weekStartsOn:1});return(0,n.GP)(e,"yyyy-MM-dd")}},m=(e,t)=>{try{if(!e||!e.startTime)return!1;return e.startTime.split("T")[0]===t}catch(r){return console.error("Fehler beim Pr\xfcfen der Relevanz eines Worktime-Eintrags:",r),!1}},u=e=>{if(!e)return[];const t=new Date(e),r=[];for(let a=0;a<7;a++){const e=(0,s.f)(t,a),l={date:(0,n.GP)(e,"yyyy-MM-dd"),day:(0,n.GP)(e,"EEEE",{locale:o.de})};r.push(l)}return r},g=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Fehler beim Formatieren des Datums und der Zeit:",t),"-"}},f=e=>{const t=new Date(e);return new Date(t.getTime()+6e4*t.getTimezoneOffset())},x=e=>{try{const t=e.reduce(((e,t)=>{if(!t.endTime)return e;const r=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,a=t.endTime.endsWith("Z")?t.endTime.substring(0,t.endTime.length-1):t.endTime,n=new Date(r),l=new Date(a).getTime()-n.getTime();return e+Math.floor(l/6e4)}),0),r=Math.floor(t/60),a=t%60;return"".concat(r,"h ").concat(a,"m")}catch(t){return console.error("Fehler bei der Formatierung der Gesamtdauer:",t),"0h 0m"}},p=e=>!!(e.invoiceItems&&e.invoiceItems.length>0),y=e=>{if(!e.invoiceItems||0===e.invoiceItems.length)return null;return e.invoiceItems[0].invoice},w=e=>({DRAFT:"Entwurf",SENT:"Gesendet",PAID:"Bezahlt",OVERDUE:"\xdcberf\xe4llig",CANCELLED:"Storniert"}[e]||e),k=e=>({DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",SENT:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",CANCELLED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}[e]||"bg-gray-100 text-gray-800")},6896:(e,t,r)=>{r.d(t,{A:()=>n});r(5043);var a=r(579);const n=e=>{let{content:t,className:r="",maxHeight:n="150px",temporaryAttachments:l=[],showImagePreview:s=!1,onlyAttachments:o=!1,attachmentMetadata:i=[]}=e;const c=()=>[...Array.from(t.matchAll(/!\[(.*?)\]\((.*?)\)/g)).map((e=>({type:"image",alt:e[1],url:e[2],isTemporary:"wird nach dem Erstellen hochgeladen"===e[2]}))),...Array.from(t.matchAll(/\[(.*?)\]\((.*?)\)/g)).filter((e=>!e[0].startsWith("!"))).map((e=>({type:"link",alt:e[1],url:e[2],isTemporary:"wird nach dem Erstellen hochgeladen"===e[2]})))].reduce(((e,t)=>{const r="".concat(t.type,"-").concat(t.alt,"-").concat(t.url);return e.some((e=>"".concat(e.type,"-").concat(e.alt,"-").concat(e.url)===r))||e.push(t),e}),[]),d=e=>{const t=l.find((t=>t.fileName===e));return null!==t&&void 0!==t&&t.file?URL.createObjectURL(t.file):null},h=e=>{let t=i.find((t=>t.fileName===e));return t||(t=i.find((t=>t.fileName.toLowerCase()===e.toLowerCase()))),!t&&i.length,t};if(o){const e=(()=>{const e=c();console.log("\ud83d\udce6 renderInlineAttachments aufgerufen:",{contentLength:t.length,attachmentsFound:e.length,attachmentMetadataCount:i.length,attachmentMetadata:i});const r=e.filter((e=>{let t=e.url;if(e.isTemporary){const r=d(e.alt);r&&(t=r)}return t&&"wird nach dem Erstellen hochgeladen"!==t}));if(0===r.length)return null;const n=r.map(((e,t)=>{var r,n;let l=h(e.alt);if(!l&&e.url){const t=e.url.match(/\/attachments\/(\d+)/);if(t){const e=parseInt(t[1]);l=i.find((t=>t.id===e))}}let s="";if(s=null!==(r=l)&&void 0!==r&&r.url?l.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(s=t)}if(!s||"wird nach dem Erstellen hochgeladen"===s)return null;const o=e.alt.toLowerCase();let c=!1,m=!1;if(console.log("\ud83d\udd0d Attachment Debug:",{alt:e.alt,fileName:o,url:s,metadata:l,attachmentType:e.type}),null!==(n=l)&&void 0!==n&&n.fileType&&(c=l.fileType.startsWith("image/"),m="application/pdf"===l.fileType,console.log("\u2705 Metadaten gefunden:",{fileType:l.fileType,isImage:c,isPdf:m})),l||"image"!==e.type||(c=!0),!l){const e=s&&s.toLowerCase().endsWith(".pdf"),t=s&&s.match(/\.pdf(\?|$)/i),r=o.endsWith(".pdf"),a=s&&(s.includes("/api/requests/attachments/")||s.includes("/api/tasks/attachments/"))&&r;m=e||t||r||a,console.log("\ud83d\udd0d PDF-Erkennung (ohne Metadaten):",{urlEndsWithPdf:e,urlMatchesPdf:t,fileNameEndsWithPdf:r,isApiAttachmentPdf:a,isPdf:m})}console.log("\ud83d\udcc4 Finale Entscheidung:",{isImage:c,isPdf:m,isExternalLink:s&&s.match(/^https?:\/\//)&&!c&&!m});const u=s&&s.match(/^https?:\/\//)&&!c&&!m;return(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:c?(0,a.jsx)("div",{children:(0,a.jsx)("img",{src:s,alt:e.alt,className:"w-full h-auto max-h-96 object-contain",style:{display:"block"}})}):m?(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("span",{className:"text-sm font-medium dark:text-gray-200",children:e.alt}),(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-blue-600 dark:text-blue-400 hover:underline text-sm",children:"\xd6ffnen"})]}),(0,a.jsx)("iframe",{src:"".concat(s,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:e.alt})]}):u?(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-all",children:e.alt||s})]}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 break-all",children:s})]}):(0,a.jsxs)("div",{className:"p-3 flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.alt})]})},t)})).filter((e=>null!==e));return 0===n.length?null:(0,a.jsx)("div",{className:"flex flex-col gap-3 mt-2",children:n})})();return e?(0,a.jsx)("div",{className:r,children:e}):(0,a.jsx)("div",{className:r})}if(s){const e={};"none"===n?e.overflowY="visible":(e.maxHeight="150px"!==n?n:"100%",e.overflowY="auto");const l=c().filter((e=>{let t=h(e.alt),r="";if(r=null!==t&&void 0!==t&&t.url?t.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(r=t)}if(!r||"wird nach dem Erstellen hochgeladen"===r)return!1;let a=!1,n=!1;return null!==t&&void 0!==t&&t.fileType?(a=t.fileType.startsWith("image/"),n="application/pdf"===t.fileType):"image"===e.type&&(a=!0),a&&!n}));let s=t;const o=/!\[([^\]]*)\]\(([^)]+)\)/g,i=/\[([^\]]+)\]\(([^)]+)\)/g;s=s.replace(o,(()=>"")),s=s.replace(/\n{3,}/g,"\n\n").trim(),s=s.replace(i,((e,t,r)=>e.startsWith("![")?e:"".concat(t," [Link]")));const m=()=>{if(0===l.length)return null;const e=l.reduce(((e,t)=>{const r="".concat(t.alt,"-").concat(t.url||"");return e.some((e=>"".concat(e.alt,"-").concat(e.url||"")===r))||e.push(t),e}),[]);return(0,a.jsx)("div",{className:"flex flex-col gap-3 mt-2",children:e.map(((e,t)=>{let r=h(e.alt),n="";if(n=null!==r&&void 0!==r&&r.url?r.url:e.url||"",e.isTemporary){const t=d(e.alt);t&&(n=t)}return n&&"wird nach dem Erstellen hochgeladen"!==n?(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,a.jsx)("img",{src:n,alt:e.alt,className:"w-full h-auto max-h-96 object-contain",style:{display:"block"}})},"img-".concat(e.alt,"-").concat(n,"-").concat(t)):null})).filter((e=>null!==e))})};return(0,a.jsxs)("div",{className:"markdown-preview ".concat(r," dark:text-gray-200"),style:e,children:[s&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:s.replace(/\n/g,"<br/>")}}),m()]})}return(0,a.jsx)("div",{className:"markdown-preview ".concat(r),children:(()=>{const e=c();return 0===e.length?null:(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.map(((e,t)=>{let r=e.url;if(e.isTemporary){const t=d(e.alt);t&&(r=t)}return(0,a.jsxs)("div",{className:"group relative",children:[(0,a.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded px-2 py-1 text-sm flex items-center dark:text-gray-200",children:[(0,a.jsx)("span",{className:"mr-1",children:"image"===e.type?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),e.alt]}),r&&"wird nach dem Erstellen hochgeladen"!==r&&(0,a.jsx)("div",{className:"hidden group-hover:block absolute z-10 bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-lg p-2 rounded-md -bottom-2 left-1/2 transform -translate-x-1/2 translate-y-full max-w-xs",children:"image"===e.type?(0,a.jsx)("img",{src:r,alt:e.alt,className:"max-w-full border rounded dark:border-gray-700",style:{maxHeight:"200px",objectFit:"contain"}}):r.match(/^(https?:\/\/|blob:)/)?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,a.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.alt})]}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("span",{className:"dark:text-gray-200",children:e.alt})]})})]},t)}))})})()})}}}]);
//# sourceMappingURL=354.4d125d18.chunk.js.map