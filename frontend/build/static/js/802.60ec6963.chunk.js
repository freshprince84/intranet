"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[802],{8802:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ie});var r=a(9379),s=a(5043),l=a(4117),n=a(3216),o=a(2672),i=a(2760),d=a(2023),c=a(8897),u=a(5442),m=a(6287),x=a(8662),h=a(4538),g=a(4850),b=a(1663),p=a(8010),k=a(1909),f=a(1369),y=a(1252),v=a(2811),w=a(3744),N=a(9248),j=a(6238),A=a(4129),C=a(7988),S=a(1923),T=a(6443),D=a(7591),E=a(1816),L=a(9422),I=a(1801),R=a(579);const F=e=>{let{onArticleSelected:t,excludeArticleIds:a=[],selectedArticles:r,onArticleRemove:l}=e;const[n,o]=(0,s.useState)([]),[i,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{try{x(!0),g(null);const e=(await S.A.get(I.Sn.CEREBRO.ARTICLES.BASE)).data.filter((e=>!a.includes(e.id)));o(e)}catch(r){var e,t;console.error("Fehler beim Abrufen der Artikel:",r);const a=r;g((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{x(!1)}})()}),[a]);return(0,R.jsxs)("div",{className:"mt-4",children:[(0,R.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cerebro-Artikel verkn\xfcpfen"}),(0,R.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,R.jsxs)("div",{className:"flex items-center gap-2",children:[(0,R.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:i||"",onChange:e=>{const t=parseInt(e.target.value,10);if(isNaN(t))d(null),u(null);else{d(t);n.find((e=>e.id===t))&&(async e=>{try{x(!0);const t=await S.A.get(I.Sn.CEREBRO.ARTICLES.BY_ID(e));u(t.data)}catch(t){console.error("Fehler beim Abrufen der Artikeldetails:",t)}finally{x(!1)}})(t)}},children:[(0,R.jsx)("option",{value:"",children:"-- Artikel ausw\xe4hlen --"}),n.map((e=>(0,R.jsx)("option",{value:e.id,children:e.title},e.id)))]}),(0,R.jsx)("button",{type:"button",onClick:()=>{if(null!==i){const e=n.find((e=>e.id===i));e&&(t(e),d(null),u(null))}},disabled:null===i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Verkn\xfcpfen"})]}),m&&(0,R.jsx)("div",{className:"text-sm text-gray-500",children:"Lade Artikel..."}),h&&(0,R.jsx)("div",{className:"text-sm text-red-600",children:h}),c&&(0,R.jsxs)("div",{className:"mt-2 p-4 border border-gray-300 rounded-md bg-gray-50",children:[(0,R.jsx)("h4",{className:"font-medium text-lg mb-2",children:c.title}),(0,R.jsx)("div",{className:"prose prose-sm max-w-none",children:c.content?(0,R.jsxs)("div",{className:"text-sm text-gray-700 max-h-40 overflow-y-auto",children:[c.content.substring(0,300),c.content.length>300&&"..."]}):(0,R.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Kein Inhalt verf\xfcgbar"})}),(0,R.jsx)("div",{className:"mt-2",children:(0,R.jsx)("a",{href:"/cerebro/articles/".concat(c.slug),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"Artikel \xf6ffnen"})})]})]})]})};var q=a(6896),O=a(5657);const z=e=>{let{error:t,title:a,setTitle:r,description:n,setDescription:o,assigneeType:i,setAssigneeType:d,responsibleId:c,setResponsibleId:u,roleId:m,setRoleId:x,qualityControlId:h,setQualityControlId:g,branchId:b,setBranchId:p,dueDate:k,setDueDate:f,users:y,roles:v,branches:w,loading:N,handleSubmit:j,handleClose:A,selectedArticles:C,onArticleSelect:S,onArticleRemove:T,uploading:I=!1,temporaryAttachments:O=[],onFileUpload:z,onRemoveAttachment:_,textareaRef:B,fileInputRef:M,handlePaste:W,handleDrop:K,handleDragOver:P}=e;const{t:U}=(0,l.Bd)(),[V,G]=(0,s.useState)("data");return(0,R.jsxs)("form",{onSubmit:j,className:"space-y-4",noValidate:!0,children:[t&&(0,R.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 dark:border-red-700 text-red-700 dark:text-red-300 p-4 mb-4",children:(0,R.jsx)("p",{children:t})}),(0,R.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,R.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,R.jsx)("button",{type:"button",className:"".concat("data"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>G("data"),children:"Daten"}),(0,R.jsx)("button",{type:"button",className:"".concat("cerebro"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>G("cerebro"),children:"Cerebro Artikel"})]})}),"data"===V&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[U("tasks.createTask.form.title")," *"]}),(0,R.jsx)("input",{type:"text",id:"title",value:a,onChange:e=>r(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,R.jsx)("div",{className:"space-y-4",children:(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"description_sidepane",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:U("tasks.createTask.form.description")}),(0,R.jsxs)("div",{className:"relative",children:[(0,R.jsx)("textarea",{ref:B,id:"description_task_create",rows:6,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",value:n,onChange:e=>o(e.target.value),onPaste:W,onDrop:K,onDragOver:P,placeholder:U("tasks.createTask.form.descriptionPlaceholder")}),(0,R.jsx)("button",{type:"button",onClick:()=>{var e;return null===M||void 0===M||null===(e=M.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:U("tasks.createTask.form.fileUpload"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,R.jsx)("input",{ref:M,type:"file",onChange:z,className:"hidden"}),I&&(0,R.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,R.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:U("tasks.createTask.form.uploading")})})]}),O&&O.length>0&&(0,R.jsx)("div",{className:"mt-2",children:(0,R.jsx)("ul",{className:"flex flex-wrap gap-2",children:O.map(((e,t)=>(0,R.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,R.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,R.jsx)("div",{className:"flex ml-2",children:(0,R.jsx)("button",{type:"button",onClick:()=>null===_||void 0===_?void 0:_(t),className:"text-red-600 hover:text-red-900 ml-1",title:U("tasks.createTask.form.remove"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,R.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-700",children:(0,R.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},t)))})}),n&&(0,R.jsx)("div",{className:"mt-3",children:(0,R.jsx)(q.A,{content:n,temporaryAttachments:O,showImagePreview:!0})})]})}),(0,R.jsxs)("div",{className:"space-y-2",children:[(0,R.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[U("tasks.createTask.form.responsibleFor")," *"]}),(0,R.jsxs)("div",{className:"flex space-x-4",children:[(0,R.jsxs)("label",{className:"inline-flex items-center",children:[(0,R.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===i,onChange:()=>{d("user"),x("")}}),(0,R.jsx)("span",{className:"ml-2 dark:text-gray-300",children:U("tasks.createTask.form.user")})]}),(0,R.jsxs)("label",{className:"inline-flex items-center",children:[(0,R.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===i,onChange:()=>{d("role"),u("")}}),(0,R.jsx)("span",{className:"ml-2 dark:text-gray-300",children:U("tasks.createTask.form.role")})]})]})]}),"user"===i?(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[U("tasks.createTask.form.responsibleUser")," *"]}),(0,R.jsxs)("select",{id:"responsible",value:c,onChange:e=>u(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,R.jsx)("option",{value:"",children:U("tasks.createTask.form.pleaseSelect")}),Array.isArray(y)&&y.map((e=>(0,R.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[U("tasks.createTask.form.responsibleRole")," *"]}),(0,R.jsxs)("select",{id:"role",value:m,onChange:e=>x(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,R.jsx)("option",{value:"",children:U("tasks.createTask.form.pleaseSelect")}),Array.isArray(v)&&v.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:U("tasks.createTask.form.qualityControl")}),(0,R.jsxs)("select",{id:"qualityControl",value:h,onChange:e=>g(e.target.value?Number(e.target.value):""),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,R.jsx)("option",{value:"",children:U("tasks.createTask.form.noQualityControl")}),Array.isArray(y)&&y.map((e=>(0,R.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[U("tasks.createTask.form.branch")," *"]}),(0,R.jsxs)("select",{id:"branch",value:b,onChange:e=>p(Number(e.target.value)),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,R.jsx)("option",{value:"",children:"Bitte w\xe4hlen"}),Array.isArray(w)&&w.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:U("tasks.createTask.form.dueDate")}),(0,R.jsx)("input",{type:"date",id:"dueDate",value:k,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===V&&(0,R.jsxs)("div",{children:[(0,R.jsxs)("div",{className:"mb-4",children:[(0,R.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Verkn\xfcpfte Cerebro-Artikel"}),C.length>0?(0,R.jsx)("ul",{className:"mt-2 space-y-2",children:C.map((e=>(0,R.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,R.jsx)("span",{className:"dark:text-gray-300",children:e.title}),(0,R.jsx)("button",{type:"button",onClick:()=>T(e.id),className:"text-red-600 hover:text-red-800",children:U("tasks.createTask.form.remove")})]},e.id)))}):(0,R.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:U("tasks.createTask.form.noArticlesLinked")})]}),(0,R.jsx)(F,{onArticleSelected:S,excludeArticleIds:C.map((e=>e.id)),selectedArticles:C,onArticleRemove:T})]}),(0,R.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,R.jsx)("button",{type:"button",onClick:A,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:U("tasks.createTask.form.cancel"),children:(0,R.jsx)(D.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:U(N?"tasks.createTask.form.creating":"tasks.createTask.form.create"),disabled:N,children:N?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(L.A,{className:"h-5 w-5"})})]})]})},_=e=>{let{isOpen:t,onClose:a,onTaskCreated:r}=e;const{t:n}=(0,l.Bd)(),{user:i}=(0,o.As)(),{openSidepane:d,closeSidepane:c}=(0,O.N)(),[u,m]=(0,s.useState)(window.innerWidth>1070),[x,h]=(0,s.useState)(""),[g,b]=(0,s.useState)(""),[p,k]=(0,s.useState)("user"),[f,y]=(0,s.useState)(""),[v,w]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[A,C]=(0,s.useState)(""),[E,L]=(0,s.useState)(""),[F,q]=(0,s.useState)([]),[_,B]=(0,s.useState)([]),[M,W]=(0,s.useState)([]),[K,P]=(0,s.useState)(null),[U,V]=(0,s.useState)(!1),[G,Q]=(0,s.useState)(window.innerWidth<640),[$,H]=(0,s.useState)([]),[Y,Z]=(0,s.useState)("data"),[X,J]=(0,s.useState)([]),[ee,te]=(0,s.useState)(!1),ae=(0,s.useRef)(null),re=(0,s.useRef)(null);(0,s.useEffect)((()=>{t&&(se(),le(),ne(),i&&j(i.id),L((()=>{const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]})()))}),[t,i]),(0,s.useEffect)((()=>{M.length>0&&""===A&&(1===M.length||M.length>1)&&C(M[0].id)}),[M,A]),(0,s.useEffect)((()=>{const e=()=>{Q(window.innerWidth<640),m(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]);const se=async()=>{try{P(null);if(!localStorage.getItem("token"))return void P("Nicht authentifiziert");console.log("Lade Benutzer f\xfcr CreateTaskModal...");const e=await S.A.get(I.Sn.USERS.DROPDOWN);console.log("Benutzer geladen:",e.data.length),q(e.data||[])}catch(a){console.error("Fehler beim Laden der Benutzer:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)P(n("tasks.createTask.errors.connectionError"));else P("".concat(n("tasks.createTask.errors.loadUsersError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},le=async()=>{try{P(null);if(!localStorage.getItem("token"))return void P("Nicht authentifiziert");const e=await S.A.get(I.Sn.ROLES.BASE);B(e.data||[])}catch(a){console.error("Fehler beim Laden der Rollen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)P(n("tasks.createTask.errors.connectionError"));else P("".concat(n("tasks.createTask.errors.loadRolesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},ne=async()=>{try{P(null);if(!localStorage.getItem("token"))return void P("Nicht authentifiziert");console.log("Lade Niederlassungen f\xfcr CreateTaskModal...");const e=await S.A.get(I.Sn.BRANCHES.BASE);console.log("Niederlassungen geladen:",e.data.length),W(e.data||[])}catch(a){console.error("Fehler beim Laden der Niederlassungen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)P(n("tasks.createTask.errors.connectionError"));else P("".concat(n("tasks.createTask.errors.loadBranchesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},oe=async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++){const r=t[a];if(0===r.type.indexOf("image")){e.preventDefault();const t=r.getAsFile();return void(t&&await ce(t))}}},ie=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await ce(t)}},de=e=>{e.preventDefault(),e.stopPropagation()},ce=async e=>{te(!0),P(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};J((e=>[...e,t]));let a="";if(a=e.type.startsWith("image/")?"\n![".concat(e.name,"](").concat(n("tasks.createTask.form.uploadAfterCreate"),")\n"):"\n[".concat(e.name,"](").concat(n("tasks.createTask.form.uploadAfterCreate"),")\n"),re.current){const e=re.current.selectionStart,t=g.substring(0,e),r=g.substring(e);b(t+a+r),setTimeout((()=>{if(re.current){const t=e+a.length;re.current.selectionStart=t,re.current.selectionEnd=t,re.current.focus()}}),0)}else b(g+a)}catch(r){var t,a;console.error("Fehler beim Verarbeiten der Datei:",r);const e=r;P((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{te(!1)}},ue=async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=t[0];await ce(a),ae.current&&(ae.current.value="")},me=e=>{const t=X[e];if(t&&(J(X.filter(((t,a)=>a!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=n("tasks.createTask.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),l=g.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");b(l)}},xe=async e=>{e.preventDefault(),P(null),V(!0);try{if(!x||!f&&!v||!A)return P(n("tasks.createTask.errors.fillAllFields")),void V(!1);if(f&&v)return P(n("tasks.createTask.errors.chooseUserOrRole")),void V(!1);if(!localStorage.getItem("token"))return P("Nicht authentifiziert"),void V(!1);const e=Number(A),t=N?Number(N):null,a=f?Number(f):null,s=v?Number(v):null;if(f&&isNaN(a)||v&&isNaN(s)||isNaN(e)||N&&isNaN(t))return P(n("tasks.createTask.errors.invalidIds")),void V(!1);const l={title:x,description:g,status:"open",qualityControlId:t,branchId:e,dueDate:E};"user"===p&&f?l.responsibleId=f:"role"===p&&v&&(l.roleId=v);const o=await S.A.post(I.Sn.TASKS.BASE,l),i=o.data.id;$.length>0&&await Promise.all($.map((e=>S.A.post(I.Sn.TASKS.LINK_CARTICLE(i,e.id))))),await(async e=>{if(0!==X.length)try{V(!0);for(const t of X){if(!t.file)continue;const a=new FormData;a.append("file",t.file),await S.A.post(I.Sn.TASKS.ATTACHMENTS(e),a,{headers:{"Content-Type":"multipart/form-data"}})}console.log("".concat(X.length," Anh\xe4nge erfolgreich hochgeladen."))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{V(!1)}})(i),console.log("Task erfolgreich erstellt:",o.data),r(o.data),he()}catch(s){var t,a;console.error("Fehler beim Erstellen des Tasks:",s);const e=s;P((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||e.message||n("tasks.createTask.errors.createError"))}finally{V(!1)}},he=()=>{h(""),b(""),k("user"),y(""),w(""),j(""),C(""),L(""),P(null),H([]),J([]),a()},ge=e=>{H((t=>[...t,e]))},be=e=>{H((t=>t.filter((t=>t.id!==e))))};return G?(0,R.jsxs)(T.lG,{open:t,onClose:he,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsxs)(T.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,R.jsx)(T.lG.Title,{className:"text-lg font-semibold dark:text-white",children:n("tasks.createTask.title")}),(0,R.jsx)("button",{onClick:he,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(D.A,{className:"h-6 w-6"})})]}),(0,R.jsx)(z,{error:K,title:x,setTitle:h,description:g,setDescription:b,assigneeType:p,setAssigneeType:k,responsibleId:f,setResponsibleId:y,roleId:v,setRoleId:w,qualityControlId:N,setQualityControlId:j,branchId:A,setBranchId:C,dueDate:E,setDueDate:L,users:F,roles:_,branches:M,loading:U,handleSubmit:xe,handleClose:he,selectedArticles:$,onArticleSelect:ge,onArticleRemove:be,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:re,fileInputRef:ae,handlePaste:oe,handleDrop:ie,handleDragOver:de})]})})]}):(0,R.jsxs)(R.Fragment,{children:[t&&!u&&(0,R.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,R.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,R.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:n("tasks.createTask.title")}),(0,R.jsx)("button",{onClick:he,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(D.A,{className:"h-6 w-6"})})]}),(0,R.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,R.jsx)(z,{error:K,title:x,setTitle:h,description:g,setDescription:b,assigneeType:p,setAssigneeType:k,responsibleId:f,setResponsibleId:y,roleId:v,setRoleId:w,qualityControlId:N,setQualityControlId:j,branchId:A,setBranchId:C,dueDate:E,setDueDate:L,users:F,roles:_,branches:M,loading:U,handleSubmit:xe,handleClose:he,selectedArticles:$,onArticleSelect:ge,onArticleRemove:be,uploading:ee,temporaryAttachments:X,onFileUpload:ue,onRemoveAttachment:me,textareaRef:re,fileInputRef:ae,handlePaste:oe,handleDrop:ie,handleDragOver:de})})]})]})},B=e=>{var t,a;let{isOpen:r,onClose:n,onTaskUpdated:d,task:c}=e;const{t:u}=(0,l.Bd)(),{hasPermission:m}=(0,i.S)(),{user:x}=(0,o.As)(),{openSidepane:h,closeSidepane:g}=(0,O.N)(),[b,p]=(0,s.useState)(window.innerWidth>1070),[k,f]=(0,s.useState)(c.title||""),[y,v]=(0,s.useState)((w=c.description||"")?w.replace(/!\[([^\]]*)\]\([^)]+\)/g,"").trim():"");var w;const j=c.description||"",[A,C]=(0,s.useState)(c.status||"open"),[q,z]=(0,s.useState)(c.roleId?"role":"user"),[_,B]=(0,s.useState)(c.responsibleId||null),[M,W]=(0,s.useState)(c.roleId||null),[K,P]=(0,s.useState)((null===(t=c.qualityControl)||void 0===t?void 0:t.id)||null),[U,V]=(0,s.useState)((null===(a=c.branch)||void 0===a?void 0:a.id)||0),[G,Q]=(0,s.useState)(c.attachments||[]),[$,H]=(0,s.useState)([]),[Y,Z]=(0,s.useState)(!1),[X,J]=(0,s.useState)([]),ee=(0,s.useRef)(null),te=(0,s.useRef)(null),[ae,re]=(0,s.useState)((e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]})(c.dueDate)),[se,le]=(0,s.useState)([]),[ne,oe]=(0,s.useState)([]),[ie,de]=(0,s.useState)([]),[ce,ue]=(0,s.useState)(null),[me,xe]=(0,s.useState)(!1),[he,ge]=(0,s.useState)(!1),[be,pe]=(0,s.useState)(window.innerWidth<640),[ke,fe]=(0,s.useState)([]),[ye,ve]=(0,s.useState)("data"),we=m("tasks","both","table");(0,s.useEffect)((()=>{const e=()=>{pe(window.innerWidth<640),p(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,s.useEffect)((()=>{if(!r&&X.length>0){(async()=>{for(const t of X)try{await S.A.delete(I.Sn.TASKS.ATTACHMENT(c.id,t)),console.log("Task Attachment ".concat(t," gel\xf6scht (Modal ohne Speichern geschlossen)"))}catch(e){console.error("Fehler beim L\xf6schen von Task Attachment ".concat(t,":"),e)}J([])})()}}),[r,X,c.id]),(0,s.useEffect)((()=>(r?h():g(),()=>{g()})),[r,h,g]),(0,s.useEffect)((()=>{r&&(Ne(),je(),Ae(),Ce(),Se())}),[r,c.id]);const Ne=async()=>{try{ue(null);if(!localStorage.getItem("token"))return void ue("Nicht authentifiziert");const e=await S.A.get(I.Sn.USERS.DROPDOWN);le(e.data||[])}catch(a){console.error("Fehler beim Laden der Benutzer:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)ue(u("tasks.editTask.errors.connectionError"));else ue("".concat(u("tasks.editTask.errors.loadUsersError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},je=async()=>{try{ue(null);if(!localStorage.getItem("token"))return void ue("Nicht authentifiziert");const e=await S.A.get(I.Sn.ROLES.BASE);oe(e.data||[])}catch(a){console.error("Fehler beim Laden der Rollen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)ue(u("tasks.editTask.errors.connectionError"));else ue("".concat(u("tasks.editTask.errors.loadRolesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},Ae=async()=>{try{ue(null);if(!localStorage.getItem("token"))return void ue("Nicht authentifiziert");const e=await S.A.get(I.Sn.BRANCHES.BASE);de(e.data||[])}catch(a){console.error("Fehler beim Laden der Niederlassungen:",a);const r=a;var e,t;if("ERR_NETWORK"===r.code)ue(u("tasks.editTask.errors.connectionError"));else ue("".concat(u("tasks.editTask.errors.loadBranchesError"),": ").concat((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message))}},Ce=async()=>{try{ue(null);const e=await S.A.get(I.Sn.TASKS.CARTICLES(c.id));fe(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der verkn\xfcpften Artikel:",a);const r=a;ue((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}},Se=async()=>{try{ue(null);const e=await S.A.get(I.Sn.TASKS.ATTACHMENTS(c.id));Q(e.data||[])}catch(a){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",a);const r=a;ue((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten"),Q([])}},Te=async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++){const r=t[a];if(0===r.type.indexOf("image")){e.preventDefault();const t=r.getAsFile();return void(t&&await Le(t))}}},De=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await Le(t)}},Ee=e=>{e.preventDefault(),e.stopPropagation()},Le=async e=>{Z(!0),ue(null);try{const t=new FormData;t.append("file",e);const a=(await S.A.post(I.Sn.TASKS.ATTACHMENTS(c.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;if(Q([...G,a]),J((e=>[...e,a.id])),!a.fileType.startsWith("image/")){const e="\n[".concat(a.fileName,"](").concat((0,I._y)(c.id,a.id),")\n");if(te.current){const t=te.current.selectionStart,a=y.substring(0,t),r=y.substring(t);v(a+e+r),setTimeout((()=>{if(te.current){const a=t+e.length;te.current.selectionStart=a,te.current.selectionEnd=a,te.current.focus()}}),0)}else v(y+e)}}catch(r){var t,a;console.error("Fehler beim Verarbeiten der Datei:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{Z(!1)}},Ie=async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=t[0];await Le(a),ee.current&&(ee.current.value="")},Re=async e=>{e.preventDefault(),ue(null),xe(!0);try{if(!k||!A||!U)return ue(u("tasks.editTask.errors.fillAllFields")),void xe(!1);if("user"===q&&!_)return ue(u("tasks.editTask.form.chooseUser")),void xe(!1);if("role"===q&&!M)return ue(u("tasks.editTask.form.chooseRole")),void xe(!1);let e=y||"";const t=G.filter((e=>{var t;return(null===(t=e.fileType)||void 0===t?void 0:t.startsWith("image/"))&&e.id})),a=/!\[([^\]]*)\]\([^)]+\)/g,r=[];let s;if(j)for(;null!==(s=a.exec(j));)r.push(s[0]);for(const n of t){const t=(0,I._y)(c.id,n.id),a="![".concat(n.fileName,"](").concat(t,")"),r=n.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp("!\\[".concat(r,"\\]\\([^)]+\\)"),"g").test(e)||(e=e?"".concat(e,"\n").concat(a):a)}for(const n of r)e.includes(n)||(e=e?"".concat(e,"\n").concat(n):n);const l={title:k,description:e,status:A,qualityControlId:K,branchId:U,dueDate:ae};"user"===q?(l.responsibleId=_,l.roleId=null):"role"===q&&(l.roleId=M,l.responsibleId=null);const o=await S.A.put("".concat(I.Sn.TASKS.BASE,"/").concat(c.id),l);console.log("Task aktualisiert:",o.data);const i=await S.A.get(I.Sn.TASKS.BY_ID(c.id));i.data.attachments?i.data.attachments=i.data.attachments.map((e=>({id:e.id,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,filePath:e.filePath,uploadedAt:e.uploadedAt,url:(0,I._y)(c.id,e.id)}))):i.data.attachments=[],J([]),d(i.data),n()}catch(r){var t,a;console.error("Fehler beim Aktualisieren des Tasks:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}finally{xe(!1)}},Fe=async()=>{if(he)try{if(!localStorage.getItem("token"))return void ue("Nicht authentifiziert");await S.A.delete(I.Sn.TASKS.BY_ID(c.id)),d(void 0),n()}catch(a){var e,t;console.error("Delete Error:",a);const r=a;ue((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||"Ein unerwarteter Fehler ist aufgetreten")}else ge(!0)},qe=async e=>{try{ue(null),await S.A.post(I.Sn.TASKS.LINK_CARTICLE(c.id,e.id)),fe((t=>[...t,e]))}catch(r){var t,a;console.error("Fehler beim Verkn\xfcpfen des Artikels:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},Oe=async e=>{try{ue(null),await S.A.delete(I.Sn.TASKS.UNLINK_CARTICLE(c.id,e)),fe((t=>t.filter((t=>t.id!==e))))}catch(r){var t,a;console.error("Fehler beim Entfernen der Artikelverkn\xfcpfung:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},ze=()=>(0,R.jsxs)("form",{onSubmit:Re,className:"space-y-4",children:[(0,R.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,R.jsxs)("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[(0,R.jsx)("button",{type:"button",className:"".concat("data"===ye?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>ve("data"),children:u("tasks.editTask.tabs.data")}),(0,R.jsx)("button",{type:"button",className:"".concat("cerebro"===ye?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),onClick:()=>ve("cerebro"),children:u("tasks.editTask.tabs.cerebro")})]})}),"data"===ye&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.title")}),(0,R.jsx)("input",{type:"text",id:"title",value:k,onChange:e=>f(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"description_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.description")}),(0,R.jsxs)("div",{className:"relative",children:[(0,R.jsx)("textarea",{ref:te,id:"description_edit",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:y,onChange:e=>v(e.target.value),onPaste:Te,onDrop:De,onDragOver:Ee,placeholder:u("tasks.editTask.form.descriptionPlaceholder")}),(0,R.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ee.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:u("tasks.editTask.form.fileUpload"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,R.jsx)("input",{ref:ee,type:"file",onChange:Ie,className:"hidden"}),Y&&(0,R.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,R.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("tasks.editTask.form.uploading")})})]}),_e(),Be()]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.status")}),(0,R.jsxs)("select",{id:"status",value:A,onChange:e=>C(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,R.jsx)("option",{value:"open",children:u("tasks.status.open")}),(0,R.jsx)("option",{value:"in_progress",children:u("tasks.status.in_progress")}),(0,R.jsx)("option",{value:"improval",children:u("tasks.status.improval")}),(0,R.jsx)("option",{value:"quality_control",children:u("tasks.status.quality_control")}),(0,R.jsx)("option",{value:"done",children:u("tasks.status.done")})]})]}),(0,R.jsxs)("div",{className:"space-y-2",children:[(0,R.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleFor")," *"]}),(0,R.jsxs)("div",{className:"flex space-x-4",children:[(0,R.jsxs)("label",{className:"inline-flex items-center",children:[(0,R.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"user",checked:"user"===q,onChange:()=>{z("user"),W(null)}}),(0,R.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.user")})]}),(0,R.jsxs)("label",{className:"inline-flex items-center",children:[(0,R.jsx)("input",{type:"radio",className:"form-radio text-blue-600 dark:bg-gray-700 dark:border-gray-600",name:"assigneeType",value:"role",checked:"role"===q,onChange:()=>{z("role"),B(null)}}),(0,R.jsx)("span",{className:"ml-2 dark:text-gray-300",children:u("tasks.editTask.form.role")})]})]})]}),"user"===q?(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"responsible",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleUser")," *"]}),(0,R.jsxs)("select",{id:"responsible",value:null===_?"":_,onChange:e=>B(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"user"===q,children:[(0,R.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(se)&&se.map((e=>(0,R.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}):(0,R.jsxs)("div",{children:[(0,R.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[u("tasks.editTask.form.responsibleRole")," *"]}),(0,R.jsxs)("select",{id:"role",value:null===M?"":M,onChange:e=>W(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:"role"===q,children:[(0,R.jsx)("option",{value:"",children:u("tasks.editTask.form.pleaseSelect")}),Array.isArray(ne)&&ne.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"qualityControl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.qualityControl")}),(0,R.jsxs)("select",{id:"qualityControl",value:null===K?"":K,onChange:e=>P(e.target.value?Number(e.target.value):null),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[(0,R.jsx)("option",{value:"",children:u("tasks.editTask.form.noQualityControl")}),Array.isArray(se)&&se.map((e=>(0,R.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"branch",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.branch")}),(0,R.jsxs)("select",{id:"branch",value:0===U?"":U,onChange:e=>V(e.target.value?Number(e.target.value):0),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[(0,R.jsx)("option",{value:"",children:"Bitte w\xe4hlen"}),Array.isArray(ie)&&ie.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:u("tasks.editTask.form.dueDate")}),(0,R.jsx)("input",{type:"date",id:"dueDate",value:ae||"",onChange:e=>{e.target.value?re(e.target.value):re(null)},className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),"cerebro"===ye&&(0,R.jsxs)("div",{children:[ke.length>0&&(0,R.jsxs)("div",{className:"mb-4",children:[(0,R.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:u("tasks.editTask.form.linkedCerebroArticles")}),(0,R.jsx)("ul",{className:"space-y-2",children:ke.map((e=>(0,R.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded",children:[(0,R.jsx)("a",{href:"/cerebro/articles/".concat(e.slug),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:e.title}),(0,R.jsx)("button",{type:"button",onClick:()=>Oe(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:u("tasks.editTask.form.remove")})]},e.id)))})]}),(0,R.jsx)(F,{onArticleSelected:qe,excludeArticleIds:ke.map((e=>e.id)),selectedArticles:ke,onArticleRemove:Oe})]}),(0,R.jsxs)("div",{className:"flex justify-between pt-4",children:[we&&(0,R.jsx)("button",{type:"button",onClick:Fe,className:"p-2 rounded-md ".concat(he?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),title:u(he?"tasks.editTask.form.confirmDelete":"tasks.editTask.form.delete"),children:he?(0,R.jsx)(L.A,{className:"h-5 w-5"}):(0,R.jsx)(N.A,{className:"h-5 w-5"})}),(0,R.jsxs)("div",{className:"flex gap-2",children:[(0,R.jsx)("button",{type:"button",onClick:n,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:u("tasks.editTask.form.cancel"),children:(0,R.jsx)(D.A,{className:"h-5 w-5"})}),(0,R.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:u(me?"tasks.editTask.form.saving":"tasks.editTask.form.save"),disabled:me,children:me?(0,R.jsx)(E.A,{className:"h-5 w-5 animate-spin"}):(0,R.jsx)(L.A,{className:"h-5 w-5"})})]})]})]}),_e=()=>0===G.length?null:(0,R.jsx)("div",{className:"mt-2",children:(0,R.jsx)("ul",{className:"flex flex-wrap gap-2",children:G.map((e=>(0,R.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,R.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,R.jsxs)("div",{className:"flex ml-2",children:[(0,R.jsx)("button",{type:"button",onClick:()=>(async e=>{try{const t=await S.A.get(I.Sn.TASKS.ATTACHMENT(c.id,e.id),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download",e.fileName),document.body.appendChild(r),r.click(),r.remove()}catch(r){var t,a;console.error("Fehler beim Herunterladen des Anhangs:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-1",title:u("tasks.editTask.form.download"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,R.jsx)("button",{type:"button",onClick:()=>(async e=>{try{ue(null);const t=G.find((t=>t.id===e));if(t&&(await S.A.delete(I.Sn.TASKS.ATTACHMENT(c.id,e)),Q(G.filter((t=>t.id!==e))),t.fileName)){const t=(0,I._y)(c.id,e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp("!\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),r=new RegExp("\\[(.*?)\\]\\(".concat(t,"\\)"),"g"),s=y.replace(a,"").replace(r,"").replace(/\n{3,}/g,"\n\n");v(s)}}catch(r){var t,a;console.error("Fehler beim L\xf6schen des Anhangs:",r);const e=r;ue((null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}})(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 ml-1",title:u("tasks.editTask.form.remove"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.fileType.startsWith("image/")&&(0,R.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600",children:(0,R.jsx)("img",{src:(0,I._y)(c.id,e.id),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id)))})}),Be=()=>0===$.length?null:(0,R.jsx)("div",{className:"mt-2",children:(0,R.jsx)("ul",{className:"flex flex-wrap gap-2",children:$.map(((e,t)=>{var a;return(0,R.jsxs)("li",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 relative group",children:[(0,R.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.fileName}),(0,R.jsx)("div",{className:"flex ml-2",children:(0,R.jsx)("button",{type:"button",onClick:()=>(e=>{const t=$[e];if(t&&(H($.filter(((t,a)=>a!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=u("tasks.editTask.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(e,"\\]\\(").concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),l=y.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");v(l)}})(t),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 ml-1",title:u("tasks.editTask.form.remove"),children:(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(null===(a=e.fileType)||void 0===a?void 0:a.startsWith("image/"))&&e.file&&(0,R.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white dark:bg-gray-800 p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 dark:border-gray-600",children:(0,R.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},"temp-".concat(t))}))})});return r?be?(0,R.jsxs)(T.lG,{open:r,onClose:n,className:"relative z-50",children:[(0,R.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,R.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,R.jsxs)(T.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,R.jsx)(T.lG.Title,{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,R.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(D.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"p-4",children:[ce&&(0,R.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:ce}),ze()]})]})})]}):(0,R.jsxs)(R.Fragment,{children:[r&&!b&&(0,R.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:n,style:{opacity:r?1:0,transition:"opacity 300ms ease-out"}}),(0,R.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(r?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:r?"auto":"none"},"aria-hidden":!r,role:"dialog","aria-modal":r,children:[(0,R.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,R.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:u("tasks.editTask.title")}),(0,R.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,R.jsx)(D.A,{className:"h-6 w-6"})})]}),(0,R.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[ce&&(0,R.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:ce}),ze()]})]})]}):null};var M=a(7012),W=a(9399),K=a(8526),P=a(7460),U=a(7952),V=a(2395),G=a(8658);const Q=()=>{const{t:e}=(0,l.Bd)(),[t,a]=(0,s.useState)(!1),[r,n]=(0,s.useState)(null),[i,d]=(0,s.useState)("00:00:00"),[c,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[h,g]=(0,s.useState)(!1),[b,p]=(0,s.useState)(null),{user:k}=(0,o.As)(),{updateTrackingStatus:f}=(0,P.S)(),{branches:y,selectedBranch:v,setSelectedBranch:w}=(0,U.O)(),{organization:N}=(0,V.Z)(),j=(0,s.useMemo)((()=>!(!c||!N)&&((null!==c.organizationId||void 0!==N.id)&&c.organizationId!==N.id)),[c,N]),A=(0,s.useCallback)((async()=>{try{x(!0),p(null),console.log("Pr\xfcfe aktive Zeiterfassung..."),console.log("Benutzer geladen:",null===k||void 0===k?void 0:k.id);const l=localStorage.getItem("token");if(console.log("Token vorhanden:",l?"Ja":"Nein"),!l)return console.error("Kein Authentifizierungstoken gefunden"),p(e("worktime.tracker.notAuthenticated")),void x(!1);try{const e=await S.A.get(I.Sn.WORKTIME.ACTIVE);console.log("API-Antwort Status:",e.status);const t=e.data;if(console.log("Aktive Zeiterfassung Daten:",t),t&&!0===t.active){console.log("Aktive Zeiterfassung gefunden:",t.id);const e=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,r=new Date(e),s=(new Date).getTime()-r.getTime(),l=Math.floor(s/1e3),o=Math.floor(l/3600),i=Math.floor(l%3600/60),c=l%60;u(t),n(r),d("".concat(o.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),":").concat(c.toString().padStart(2,"0"))),a(!0),v!==t.branchId&&w(t.branchId),f(!0)}else console.log("Keine aktive Zeiterfassung vorhanden"),a(!1),u(null),n(null),d("00:00:00"),f(!1)}catch(s){console.error("Fehler beim Abrufen der aktiven Zeiterfassung:",s);const a=s;var t,r;if("ERR_NETWORK"===a.code)p(e("worktime.tracker.connectionError"));else p("".concat(e("worktime.tracker.errorFetch"),": ").concat((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||a.message))}}finally{x(!1)}}),[null===k||void 0===k?void 0:k.id,f,v,N]);(0,s.useEffect)((()=>{k?(console.log("Benutzer geladen, pr\xfcfe aktive Zeiterfassung f\xfcr Benutzer-ID:",k.id),A()):(console.log("Warte auf Benutzer-Daten vor dem Pr\xfcfen der Zeiterfassung..."),x(!1))}),[k,A]),(0,s.useEffect)((()=>{let e;return t&&r&&(e=window.setInterval((()=>{const e=(new Date).getTime()-r.getTime(),t=Math.floor(e/1e3),a=Math.floor(t/3600),s=Math.floor(t%3600/60),l=t%60;d("".concat(a.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0")))}),1e3)),()=>{e&&clearInterval(e)}}),[t,r]);const C=async()=>{if(v)try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));const r=(await S.A.post(I.Sn.WORKTIME.START,{branchId:v,startTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data,s=r.startTime.endsWith("Z")?r.startTime.substring(0,r.startTime.length-1):r.startTime,l=new Date(s);u(r),n(l),d("00:00:00"),a(!0),f(!0)}catch(r){console.error("Fehler:",r);let a=e("worktime.tracker.errorStart");var t;if(r.response)a=(null===(t=r.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(r.response.status,")");alert(a)}else alert(e("worktime.tracker.selectBranch"))},T=async()=>{try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await S.A.post(I.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset())},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});a(!1),u(null),n(null),d("00:00:00"),f(!1)}catch(r){console.error("Fehler:",r);let a=e("worktime.tracker.errorStop");var t;if(r.response)a=(null===(t=r.response.data)||void 0===t?void 0:t.message)||"Fehler (Status: ".concat(r.response.status,")");alert(a)}},D=(0,s.useMemo)((()=>{var t;return c?(null===(t=y.find((e=>e.id===c.branchId)))||void 0===t?void 0:t.name)||e("worktime.tracker.unknown"):null}),[y,c]);return m?(0,R.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 mb-6",children:(0,R.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,R.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})})}):(0,R.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 sm:mb-6",children:[(0,R.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,R.jsxs)("h2",{className:"text-xl font-semibold flex items-center dark:text-white",children:[(0,R.jsx)(M.A,{className:"h-6 w-6 mr-2"}),e("worktime.tracker.title")]})}),b&&(0,R.jsxs)("div",{className:"mb-4 p-2 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 border border-red-200 dark:border-red-700 rounded-md flex justify-between items-center",children:[(0,R.jsx)("span",{children:b}),b!==e("worktime.tracker.noActiveTracking")&&(0,R.jsxs)("button",{onClick:async()=>{if(window.confirm(e("worktime.tracker.forceStopConfirm")))try{const t=localStorage.getItem("token");if(!t)return console.error("Kein Authentifizierungstoken gefunden"),void alert(e("worktime.tracker.notAuthenticatedMessage"));await S.A.post(I.Sn.WORKTIME.STOP,{endTime:new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),force:!0},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});a(!1),n(null),d("00:00:00"),u(null),p(null),alert(e("worktime.tracker.forceStopSuccess")),f(!1)}catch(r){var t;console.error("Fehler:",r),p("Fehler beim Stoppen: ".concat((null===(t=r.response)||void 0===t?void 0:t.status)||"Netzwerkfehler")),alert(e("worktime.tracker.forceStopError"))}},className:"text-sm bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-800 dark:hover:bg-red-700 dark:text-red-300 px-2 py-1 rounded-md",children:[e("worktime.tracker.stop")," ",e("common.force","Erzwingen")]})]}),t&&j&&(0,R.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 border border-yellow-200 dark:border-yellow-700 rounded-md flex items-start",children:[(0,R.jsx)(W.A,{className:"h-5 w-5 mr-2 mt-0.5 flex-shrink-0"}),(0,R.jsxs)("div",{className:"flex-1",children:[(0,R.jsx)("p",{className:"font-medium",children:e("worktime.tracker.differentOrganizationWarning.title","Hinweis: Andere Organisation")}),(0,R.jsx)("p",{className:"text-sm mt-1",children:e("worktime.tracker.differentOrganizationWarning.message","Diese Zeiterfassung wurde in einer anderen Organisation gestartet. Sie wird nach dem Stoppen der Organisation zugeordnet, in der sie gestartet wurde.")})]})]}),(0,R.jsxs)("div",{className:"flex items-start justify-center mb-4",children:[(0,R.jsxs)("div",{className:"flex flex-col items-center",children:[(0,R.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,R.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:t,onChange:async()=>{t?await T():await C()},disabled:!v&&!t}),(0,R.jsx)("div",{className:"w-20 h-10 rounded-full \n                            ".concat(t?"bg-green-500 shadow-lg shadow-green-200 dark:shadow-green-900/20":"bg-gray-300 dark:bg-gray-600","\n                            before:content-[''] before:absolute before:top-0 before:left-0 before:bottom-0 before:right-0 \n                            peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-700\n                            peer-checked:after:translate-x-10\n                            after:content-[''] after:absolute after:top-1 after:left-1\n                            after:bg-white dark:after:bg-gray-200 after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full\n                            after:h-8 after:w-8 after:transition-all after:duration-300 ease-in-out\n                            transition-colors duration-300")})]}),(0,R.jsx)("span",{className:"mt-2 text-sm font-medium",children:t?(0,R.jsx)("span",{className:"text-green-600 dark:text-green-400 font-bold",children:e("worktime.tracker.running")}):(0,R.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:e("worktime.tracker.start")})})]}),(0,R.jsx)("button",{onClick:()=>{g(!0)},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-2 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-blue-700 shadow-sm flex items-center justify-center ml-8 mt-1",title:e("worktime.tracker.showTimes"),children:(0,R.jsx)(K.A,{className:"h-6 w-6"})})]}),(0,R.jsx)("div",{className:"p-2 my-2 rounded-md text-sm ".concat(t&&c?"bg-green-50 dark:bg-green-900/20 dark:text-green-200":"bg-gray-50 dark:bg-gray-700 dark:text-gray-300"),children:t&&c?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("p",{children:[(0,R.jsx)("strong",{children:e("worktime.tracker.activeTracking")})," ",i]}),(0,R.jsxs)("p",{children:[(0,R.jsx)("strong",{children:e("worktime.tracker.started")})," ",(e=>{"string"===typeof e&&e.endsWith("Z")&&(e=e.substring(0,e.length-1));const t=new Date(e),a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),l=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0");return"".concat(a,".").concat(r,".").concat(s,", ").concat(l,":").concat(n,":").concat(o)})(r||Date.now())]}),(0,R.jsxs)("p",{children:[(0,R.jsxs)("strong",{children:[e("worktime.tracker.selectBranchLabel"),":"]})," ",D||e("worktime.tracker.unknown")]})]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("p",{children:"\xa0"}),(0,R.jsx)("p",{children:"\xa0"}),(0,R.jsx)("p",{children:"\xa0"})]})}),h&&(0,R.jsx)(G.G,{isOpen:h,onClose:()=>{g(!1)}})]})};var $=a(4426),H=a(7829),Y=a(7488),Z=a(1052),X=a(1853),J=a(957),ee=a(637),te=a(9837),ae=a(887);const re=["title","responsibleAndQualityControl","status","dueDate","branch","actions"],se="worktracker-todos",le={title:"asc",status:"asc",responsible:"asc",qualityControl:"asc",branch:"asc",dueDate:"asc",description:"asc"},ne={title:["title"],status:["status"],responsibleAndQualityControl:["responsible","qualityControl"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},oe={title:"title",status:"status",responsible:"responsibleAndQualityControl",qualityControl:"responsibleAndQualityControl",branch:"branch",dueDate:"dueDate",description:"description"},ie=()=>{const{t:e}=(0,l.Bd)(),{user:t}=(0,o.As)(),{hasPermission:a}=(0,i.S)(),T=(0,n.zy)(),D=(0,s.useMemo)((()=>[{id:"title",label:e("tasks.columns.title"),shortLabel:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status"),shortLabel:e("tasks.columns.status")},{id:"responsibleAndQualityControl",label:e("tasks.columns.responsibleAndQualityControl"),shortLabel:e("tasks.columns.responsibleAndQualityControl").split("/")[0]},{id:"branch",label:e("tasks.columns.branch"),shortLabel:e("tasks.columns.branch").substring(0,5)},{id:"dueDate",label:e("tasks.columns.dueDate"),shortLabel:e("tasks.columns.dueDate").substring(0,5)},{id:"actions",label:e("tasks.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),E=(0,s.useMemo)((()=>[{id:"responsible",label:e("tasks.columns.responsible"),shortLabel:e("tasks.columns.responsible").substring(0,3)},{id:"qualityControl",label:e("tasks.columns.qualityControl"),shortLabel:e("tasks.columns.qualityControl").substring(0,2)}]),[e]),[L,F]=(0,s.useState)([]),[O,z]=(0,s.useState)(!0),[M,W]=(0,s.useState)(null),[K,P]=(0,s.useState)(""),[U,V]=(0,s.useState)("all"),[G,ie]=(0,s.useState)([]),[de,ce]=(0,s.useState)([]),[ue,me]=(0,s.useState)(""),[xe,he]=(0,s.useState)(null),[ge,be]=(0,s.useState)(!1),[pe,ke]=(0,s.useState)({key:"dueDate",direction:"asc"}),[fe,ye]=(0,s.useState)(!1),[ve,we]=(0,s.useState)(!1),[Ne,je]=(0,s.useState)(null),[Ae,Ce]=(0,s.useState)(null),{settings:Se,isLoading:Te,updateColumnOrder:De,updateHiddenColumns:Ee,toggleColumnVisibility:Le,isColumnVisible:Ie,updateViewMode:Re}=(0,d.F)("worktracker_tasks",{defaultColumnOrder:re,defaultHiddenColumns:[],defaultViewMode:"cards"}),[Fe,qe]=(0,s.useState)(null),[Oe,ze]=(0,s.useState)(null),[_e,Be]=(0,s.useState)(10),Me=Se.viewMode||"cards",[We,Ke]=(0,s.useState)((()=>le)),Pe=(0,s.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const a=ne[e];a&&a.length>0&&t.push(...a)})),t.includes("description")||t.push("description"),t})(Se.columnOrder||re)),[Se.columnOrder]),Ue=(0,s.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(ne[e]||[]).forEach((e=>t.add(e)))})),t})(Se.hiddenColumns||[])),[Se.hiddenColumns]),Ve=(0,s.useMemo)((()=>new Set(Pe.filter((e=>!Ue.has(e))))),[Pe,Ue]);(0,s.useEffect)((()=>{document.querySelectorAll(".dashboard-tasks-wrapper").forEach((e=>{"cards"===Me?e.classList.add("cards-mode"):e.classList.remove("cards-mode")}))}),[Me]);const Ge=(0,s.useRef)(!1),Qe=async()=>{try{z(!0);const e=await S.A.get(I.Sn.TASKS.BASE),t=e.data.filter((e=>null!=e)).map((e=>{const t=(e.attachments||[]).filter((e=>null!=e)).map((t=>({id:t.id,fileName:t.fileName,fileType:t.fileType,fileSize:t.fileSize,filePath:t.filePath,uploadedAt:t.uploadedAt,url:(0,I._y)(e.id,t.id)})));return(0,r.A)((0,r.A)({},e),{},{attachments:t})}));console.log("\ud83d\udccb Tasks geladen:",t.length,"Tasks"),F(t),W(null)}catch(M){console.error("Fehler beim Laden der Tasks:",M),W(e("worktime.messages.tasksLoadError"))}finally{z(!1)}};(0,s.useEffect)((()=>{Ge.current||(Ge.current=!0,Qe())}),[]),(0,s.useEffect)((()=>{if(L.length>0){const e=new URLSearchParams(T.search).get("editTask");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=L.find((e=>e.id===t));e&&(je(e),we(!0))}}}}),[L,T.search]),(0,s.useEffect)((()=>{(async()=>{try{const t=await S.A.get(I.Sn.SAVED_FILTERS.BY_TABLE(se)),a=t.data.find((e=>"Aktuell"===e.name));a&&(me(e("tasks.filters.current")),he(a.id),et(a.conditions,a.operators))}catch(M){console.error("Fehler beim Setzen des initialen Filters:",M)}})()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("Nicht authentifiziert");const t=(await S.A.get("".concat(I.Sn.SAVED_FILTERS.BY_TABLE(se)),{headers:{Authorization:"Bearer ".concat(e)}})).data||[],a=t.some((e=>"Archiv"===e.name)),r=t.some((e=>"Aktuell"===e.name));if(!a){const t={tableId:se,name:"Archiv",conditions:[{column:"status",operator:"equals",value:"done"}],operators:[]};await S.A.post("".concat(I.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e)}})}if(!r){const t={tableId:se,name:"Aktuell",conditions:[{column:"status",operator:"notEquals",value:"done"}],operators:[]};await S.A.post("".concat(I.Sn.SAVED_FILTERS.BASE),t,{headers:{Authorization:"Bearer ".concat(e)}})}}catch(M){console.error("Fehler beim Erstellen der Standard-Filter:",M)}})()}),[]);const $e=async(t,a)=>{try{F((e=>e.filter((e=>null!=e)).map((e=>e.id===t?(0,r.A)((0,r.A)({},e),{},{status:a}):e)))),await S.A.patch(I.Sn.TASKS.BY_ID(t),{status:a}),Y.oR.success(e("worktime.messages.taskUpdated"))}catch(M){console.error("Fehler beim Aktualisieren des Status:",M),Qe(),Y.oR.error(e("worktime.messages.taskUpdatedError"))}},He=e=>{return e.responsible?e.responsible.id===(null===t||void 0===t?void 0:t.id):e.role&&(null===t||void 0===t||null===(a=t.roles)||void 0===a?void 0:a.some((t=>{var a,r;return(null===(a=t.role)||void 0===a?void 0:a.id)===(null===(r=e.role)||void 0===r?void 0:r.id)})))||!1;var a},Ye=e=>{var a;return(null===(a=e.qualityControl)||void 0===a?void 0:a.id)===(null===t||void 0===t?void 0:t.id)},Ze=e=>{ke((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},Xe=t=>{const r=[];return a("tasks","write","table")?("in_progress"===t.status&&He(t)?r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"open"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToOpen"),children:(0,R.jsx)(u.A,{className:"h-5 w-5"})},"back")):"quality_control"===t.status&&He(t)?r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"in_progress"),className:"p-1.5 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToInProgress"),children:(0,R.jsx)(u.A,{className:"h-5 w-5"})},"back")):"done"===t.status&&Ye(t)&&r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"quality_control"),className:"p-2 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("tasks.actions.backToQualityControl"),children:(0,R.jsx)(u.A,{className:"h-6 w-6"})},"back")),"open"===t.status&&He(t)?r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"in_progress"),className:"p-1.5 bg-blue-600 dark:bg-blue-500 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-600",title:e("tasks.actions.setInProgress"),children:(0,R.jsx)(m.A,{className:"h-5 w-5"})},"forward")):"in_progress"===t.status&&He(t)?r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"quality_control"),className:"p-1.5 bg-purple-600 dark:bg-purple-500 text-white rounded hover:bg-purple-700 dark:hover:bg-purple-600",title:e("tasks.actions.setQualityControl"),children:(0,R.jsx)(m.A,{className:"h-5 w-5"})},"forward")):"quality_control"===t.status&&Ye(t)&&r.push((0,R.jsx)("button",{onClick:()=>$e(t.id,"done"),className:"p-1.5 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",title:e("tasks.actions.markDone"),children:(0,R.jsx)(m.A,{className:"h-5 w-5"})},"forward")),r):r},Je=()=>G.length,et=(e,t)=>{ie(e),ce(t)},tt=()=>{ie([]),ce([]),me(""),he(null)},at=(e,t,a,r)=>{me(e),he(t),et(a,r)},rt=e=>{switch(e){case"open":return 1;case"in_progress":return 2;case"improval":return 3;case"quality_control":return 4;case"done":return 5;default:return 99}},st=(0,s.useMemo)((()=>{console.log("\ud83d\udd04 Filtere Tasks:",L.length,"Tasks vorhanden"),console.log("\ud83d\udd04 Filterbedingungen:",G);const e=L.filter((e=>null!=e)).filter((e=>{if(K){const t=K.toLowerCase();if(!(e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||!!e.responsible&&"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)||!!e.role&&e.role.name.toLowerCase().includes(t)||e.qualityControl&&"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)))return!1}if(G.length>0){let t=G.length>0;for(let a=0;a<G.length;a++){const r=G[a];let s=!1;switch(r.column){case"title":"equals"===r.operator?s=e.title===r.value:"contains"===r.operator?s=e.title.toLowerCase().includes((r.value||"").toLowerCase()):"startsWith"===r.operator?s=e.title.toLowerCase().startsWith((r.value||"").toLowerCase()):"endsWith"===r.operator&&(s=e.title.toLowerCase().endsWith((r.value||"").toLowerCase()));break;case"status":"equals"===r.operator?s=e.status===r.value:"notEquals"===r.operator&&(s=e.status!==r.value);break;case"responsible":const t=r.value||"";if(t.startsWith("user-")){const a=parseInt(t.replace("user-",""));s=!!e.responsible&&e.responsible.id===a}else if(t.startsWith("role-")){const a=parseInt(t.replace("role-",""));s=!!e.role&&e.role.id===a}else if(""===t)s=!0;else if("equals"===r.operator){s=(e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?e.role.name.toLowerCase():"")===t.toLowerCase()}else if("contains"===r.operator){s=(e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?e.role.name.toLowerCase():"").includes(t.toLowerCase())}break;case"qualityControl":const a=r.value||"";if(a.startsWith("user-")){const t=parseInt(a.replace("user-",""));s=!!e.qualityControl&&e.qualityControl.id===t}else if(""===a)s=!0;else if("equals"===r.operator){s=(e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"")===a.toLowerCase()}else if("contains"===r.operator){s=(e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"").includes(a.toLowerCase())}break;case"responsibleAndQualityControl":const l=r.value||"";if(l.startsWith("user-")){const t=parseInt(l.replace("user-",""));s=!!e.responsible&&e.responsible.id===t||!!e.qualityControl&&e.qualityControl.id===t}else if(l.startsWith("role-")){const t=parseInt(l.replace("role-",""));s=!!e.role&&e.role.id===t}else if(""===l)s=!0;else if("equals"===r.operator){const t=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?e.role.name.toLowerCase():"",a=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"";s=t===l.toLowerCase()||a===l.toLowerCase()}else if("contains"===r.operator){const t=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?e.role.name.toLowerCase():"",a=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"";s=t.includes(l.toLowerCase())||a.includes(l.toLowerCase())}break;case"branch":const n=e.branch.name.toLowerCase();"equals"===r.operator?s=n===(r.value||"").toLowerCase():"contains"===r.operator&&(s=n.includes((r.value||"").toLowerCase()));break;case"dueDate":if(!e.dueDate){s=!1;break}const o=new Date(e.dueDate);if("equals"===r.operator){const e=new Date(r.value);s=o.toDateString()===e.toDateString()}else if("before"===r.operator){s=o<new Date(r.value)}else if("after"===r.operator){s=o>new Date(r.value)}}if(0===a)t=s;else{t="AND"===de[a-1]?t&&s:t||s}}if(!t)return!1}return!0}));console.log("\u2705 Gefilterte Tasks:",e.length,"von",L.length);const t=e.sort(((e,t)=>{if("cards"===Me){const a=Pe.filter((e=>Ve.has(e)));for(const r of a){const a=We[r]||"asc";let s,l;switch(r){case"title":s=e.title.toLowerCase(),l=t.title.toLowerCase();break;case"status":s=rt(e.status),l=rt(t.status);break;case"responsible":s=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase():e.role?"Rolle: ".concat(e.role.name).toLowerCase():"",l=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName).toLowerCase():t.role?"Rolle: ".concat(t.role.name).toLowerCase():"";break;case"qualityControl":s=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName).toLowerCase():"",l=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName).toLowerCase():"";break;case"branch":s=e.branch.name.toLowerCase(),l=t.branch.name.toLowerCase();break;case"dueDate":s=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,l=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;break;case"description":s=(e.description||"").toLowerCase(),l=(t.description||"").toLowerCase();break;default:continue}let n=0;if(n="number"===typeof s&&"number"===typeof l?s-l:String(s).localeCompare(String(l)),"desc"===a&&(n=-n),0!==n)return n}return 0}{if(pe.key){let a,r;switch(pe.key){case"title":a=e.title,r=t.title;break;case"status":a=rt(e.status),r=rt(t.status);break;case"responsible.firstName":a=e.responsible?"".concat(e.responsible.firstName," ").concat(e.responsible.lastName):e.role?"Rolle: ".concat(e.role.name):"",r=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?"Rolle: ".concat(t.role.name):"";break;case"qualityControl.firstName":a=e.qualityControl?"".concat(e.qualityControl.firstName," ").concat(e.qualityControl.lastName):"",r=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"";break;case"branch.name":a=e.branch.name,r=t.branch.name;break;case"dueDate":a=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,r=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;break;default:a=e[pe.key],r=t[pe.key]}if("number"===typeof a&&"number"===typeof r)return"asc"===pe.direction?a-r:r-a;{const e=String(a).localeCompare(String(r));return"asc"===pe.direction?e:-e}}const a=e.dueDate?new Date(e.dueDate).getTime():Number.MAX_SAFE_INTEGER,r=t.dueDate?new Date(t.dueDate).getTime():Number.MAX_SAFE_INTEGER;if(a!==r)return a-r;const s=rt(e.status),l=rt(t.status);return s!==l?s-l:e.title.localeCompare(t.title)}}));return console.log("\u2705 Gefilterte und sortierte Tasks:",t.length),t}),[L,K,pe,rt,G,de,Me,Pe,Ve,We]),lt=(e,t)=>{const a=[...Se.columnOrder],r=a[e];a.splice(e,1),a.splice(t,0,r),De(a)},nt=e=>{qe(e)},ot=(e,t)=>{e.preventDefault(),Fe&&Fe!==t&&ze(t)},it=(e,t)=>{if(e.preventDefault(),Fe&&Fe!==t){const e=Se.columnOrder.indexOf(Fe),a=Se.columnOrder.indexOf(t);e>-1&&a>-1&&lt(e,a)}qe(null),ze(null)},dt=()=>{qe(null),ze(null)},ct=(0,s.useMemo)((()=>{const e=(Se.columnOrder||[]).filter((e=>null!=e&&"string"===typeof e)),t=re.filter((t=>!e.includes(t)));return[...e,...t]}),[Se.columnOrder]).filter((e=>null!=e&&"string"===typeof e&&Ie(e))),ut=async e=>{try{var t;const a={title:"".concat(e.title,"-Kopie"),description:e.description,status:"open",responsibleId:e.responsible?e.responsible.id:null,roleId:e.role?e.role.id:null,qualityControlId:(null===(t=e.qualityControl)||void 0===t?void 0:t.id)||null,branchId:e.branch.id,dueDate:e.dueDate},r=await S.A.post(I.Sn.TASKS.BASE,a);F((e=>[r.data,...e])),je(r.data),we(!0)}catch(s){var a,r;console.error("Fehler beim Kopieren des Tasks:",s);const e=s;W((null===(a=e.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}},mt=async t=>{if(window.confirm(e("worktime.messages.taskDeleteConfirm"))){console.log("\ud83d\uddd1\ufe0f Starte L\xf6schung von Task:",t),console.log("\ud83d\udccb Aktuelle Tasks vor L\xf6schung:",L.length),F((e=>{const a=e.filter((e=>null!=e&&e.id!==t));return console.log("\ud83d\udccb Tasks nach Filterung:",a.length,"von",e.length),a})),Y.oR.info("Test: Task wird gel\xf6scht...");try{console.log("\ud83d\udce1 Sende Delete-Request..."),await S.A.delete(I.Sn.TASKS.BY_ID(t)),console.log("\u2705 Delete erfolgreich"),Y.oR.success(e("worktime.messages.taskDeleted"))}catch(M){console.error("\u274c Fehler beim L\xf6schen der Aufgabe:",M),Qe(),Y.oR.error(e("worktime.messages.taskDeletedError"))}}};return(0,R.jsxs)("div",{className:"min-h-screen dark:bg-gray-900",children:[(0,R.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,R.jsxs)("div",{className:"w-full mb-4",children:[(0,R.jsxs)("div",{className:"block sm:hidden w-full",children:[(0,R.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,R.jsxs)("div",{className:"flex items-center justify-between px-3 sm:px-4 md:px-6",children:[(0,R.jsx)("div",{className:"flex items-center",children:a("tasks","write","table")&&(0,R.jsx)("button",{onClick:()=>ye(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("tasks.createTask"),"aria-label":e("tasks.createTask"),children:(0,R.jsx)(x.A,{className:"h-4 w-4"})})}),(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)(h.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,R.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("tasks.title")})]}),(0,R.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,R.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:K,onChange:e=>P(e.target.value)}),(0,R.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Me?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Re("table"===Me?"cards":"table"),title:e("table"===Me?"common.viewAsCards":"common.viewAsTable"),children:"table"===Me?(0,R.jsx)(g.A,{className:"h-5 w-5"}):(0,R.jsx)(b.A,{className:"h-5 w-5"})}),(0,R.jsxs)("button",{className:"p-2 rounded-md ".concat(Je()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>be(!ge),title:e("common.filter"),children:[(0,R.jsx)(p.A,{className:"h-5 w-5"}),Je()>0&&(0,R.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Je()})]}),(0,R.jsx)("div",{className:"ml-1",children:(0,R.jsx)(c.A,{columns:"cards"===Me?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:D,visibleColumns:"cards"===Me?Array.from(Ve):ct,columnOrder:"cards"===Me?Pe:Se.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Me){const t=oe[e];t&&Le(t)}else Le(e)},onMoveColumn:"cards"===Me?(e,t)=>{const a=[...Pe],r=a[e];a.splice(e,1),a.splice(t,0,r);const s=[],l=new Set;a.forEach((e=>{const t=oe[e];t&&!l.has(t)&&(l.add(t),s.push(t))})),D.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),De(s)}:lt,sortDirections:"cards"===Me?We:void 0,onSortDirectionChange:"cards"===Me?(e,t)=>{Ke((a=>(0,r.A)((0,r.A)({},a),{},{[e]:t})))}:void 0,showSortDirection:"cards"===Me,buttonTitle:e("cards"===Me?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Me?"tableColumn.sortAndDisplay":"tableColumn.configure"),onClose:()=>{}})})]})]}),ge&&(0,R.jsx)("div",{className:"cards"===Me?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,R.jsx)($.A,{columns:[...D,...E],onApply:et,onReset:tt,savedConditions:G,savedOperators:de,tableId:se})}),(0,R.jsx)("div",{className:"cards"===Me?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,R.jsx)(H.A,{tableId:se,onSelectFilter:et,onReset:tt,activeFilterName:ue,selectedFilterId:xe,onFilterChange:at,defaultFilterName:e("tasks.filters.current")})}),"table"===Me?(0,R.jsx)("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6",children:(0,R.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,R.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,R.jsx)("tr",{children:ct.map((e=>{const t=D.find((t=>t.id===e));return t?(0,R.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Oe?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>nt(e),onDragOver:t=>ot(t,e),onDrop:t=>it(t,e),onDragEnd:dt,children:(0,R.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,R.jsx)("button",{onClick:()=>Ze(e),className:"ml-1 focus:outline-none",children:(0,R.jsx)(k.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,R.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:O?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,R.jsx)("div",{className:"flex justify-center",children:(0,R.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):M?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:M})}):0===st.length?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,R.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,R.jsx)(f.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,R.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,R.jsx)(R.Fragment,{children:st.slice(0,_e).map((t=>{const r=(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,Z.F2)(r);return(0,R.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:ct.map((r=>{switch(r){case"title":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,R.jsxs)("div",{className:"ml-2 relative group",children:[(0,R.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("tasks.showDescription"),children:(0,R.jsx)(y.A,{className:"h-5 w-5"})}),(0,R.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,R.jsx)(q.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,X.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},r);case"responsibleAndQualityControl":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"flex flex-col",children:[(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,R.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,R.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,R.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},r);case"branch":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const s=(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description),l=(0,Z.F2)(s);return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"text-sm ".concat("none"!==s?l.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,R.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,R.jsx)("div",{className:"status-buttons",children:Xe(t)}),a("tasks","write","table")&&(0,R.jsx)("button",{onClick:()=>{je(t),we(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,R.jsx)(v.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,R.jsx)("button",{onClick:()=>ut(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,R.jsx)(w.A,{className:"h-4 w-4"})}),a("tasks","delete","table")&&(0,R.jsx)("button",{onClick:()=>mt(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:e("common.delete"),children:(0,R.jsx)(N.A,{className:"h-4 w-4"})})]})},r);default:return null}}))},t.id)}))})})]})}):(0,R.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:O?(0,R.jsx)("div",{className:"flex justify-center py-12",children:(0,R.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):M?(0,R.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:M}):0===st.length?(0,R.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,R.jsx)(f.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,R.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,R.jsx)(ee.A,{children:st.slice(0,_e).map((t=>{(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(Ve.has("branch")&&s.push({icon:(0,R.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ve.has("responsible")){const a=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,R.jsx)(A.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:r,section:"main"})}if(Ve.has("qualityControl")){const a=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,R.jsx)(A.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:r,section:"main-second"})}if(Ve.has("dueDate")){const a=(0,Z.Rj)(t.dueDate,"todo",t.title,t.description,(0,R.jsx)(C.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,te.GP)(e,"dd.MM.yyyy",{locale:ae.de})),!1);s.push((0,r.A)((0,r.A)({},a),{},{section:"right-inline"}))}Ve.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const l=(0,R.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,R.jsx)("div",{className:"status-buttons",children:Xe(t)}),a("tasks","write","table")&&(0,R.jsx)("button",{onClick:e=>{e.stopPropagation(),je(t),we(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,R.jsx)(v.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,R.jsx)("button",{onClick:e=>{e.stopPropagation(),ut(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,R.jsx)(w.A,{className:"h-4 w-4"})})]});return(0,R.jsx)(J.A,{title:t.title,status:{label:(0,X.Iw)(t.status,"task",e),color:(0,X.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:l},t.id)}))})}),st.length>_e&&(0,R.jsx)("div",{className:"mt-4 flex justify-center",children:(0,R.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Be((e=>e+10)),children:[e("common.showMore")," (",st.length-_e," ",e("common.remaining"),")"]})})]}),(0,R.jsx)("div",{className:"fixed bottom-13 left-0 right-0 w-full bg-white dark:bg-gray-800 z-9 shadow-lg border-t-0 dark:border-t dark:border-gray-700",children:(0,R.jsx)(Q,{})})]}),(0,R.jsxs)("div",{className:"hidden sm:block",children:[(0,R.jsx)("div",{className:"mb-8",children:(0,R.jsx)(Q,{})}),(0,R.jsxs)("div",{className:"dashboard-tasks-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full mb-20",children:[(0,R.jsxs)("div",{className:"flex items-center mb-4 justify-between px-3 sm:px-4 md:px-6",children:[(0,R.jsx)("div",{className:"flex items-center",children:a("tasks","write","table")&&(0,R.jsx)("button",{onClick:()=>ye(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("tasks.createTask"),"aria-label":e("tasks.createTask"),children:(0,R.jsx)(x.A,{className:"h-4 w-4"})})}),(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)(h.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,R.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("tasks.title")})]}),(0,R.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,R.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:K,onChange:e=>P(e.target.value)}),(0,R.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===Me?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>Re("table"===Me?"cards":"table"),title:e("table"===Me?"common.viewAsCards":"common.viewAsTable"),children:"table"===Me?(0,R.jsx)(g.A,{className:"h-5 w-5"}):(0,R.jsx)(b.A,{className:"h-5 w-5"})}),(0,R.jsxs)("button",{className:"p-2 rounded-md ".concat(Je()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>be(!ge),title:e("common.filter"),children:[(0,R.jsx)(p.A,{className:"h-5 w-5"}),Je()>0&&(0,R.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Je()})]}),(0,R.jsx)("div",{className:"ml-1",children:(0,R.jsx)(c.A,{columns:"cards"===Me?[{id:"title",label:e("tasks.columns.title")},{id:"status",label:e("tasks.columns.status")},{id:"responsible",label:e("tasks.columns.responsible")},{id:"qualityControl",label:e("tasks.columns.qualityControl")},{id:"branch",label:e("tasks.columns.branch")},{id:"dueDate",label:e("tasks.columns.dueDate")},{id:"description",label:e("tasks.columns.description")}]:D,visibleColumns:"cards"===Me?Array.from(Ve):ct,columnOrder:"cards"===Me?Pe:Se.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Me){const t=oe[e];t&&Le(t)}else Le(e)},onMoveColumn:"cards"===Me?(e,t)=>{const a=[...Pe],r=a[e];a.splice(e,1),a.splice(t,0,r);const s=[],l=new Set;a.forEach((e=>{const t=oe[e];t&&!l.has(t)&&(l.add(t),s.push(t))})),D.forEach((e=>{s.includes(e.id)||"actions"===e.id||s.push(e.id)})),De(s)}:lt,sortDirections:"cards"===Me?We:void 0,onSortDirectionChange:"cards"===Me?(e,t)=>{Ke((a=>(0,r.A)((0,r.A)({},a),{},{[e]:t})))}:void 0,showSortDirection:"cards"===Me,buttonTitle:e("cards"===Me?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Me?"tableColumn.sortAndDisplay":"tableColumn.configure"),onClose:()=>{}})})]})]}),ge&&(0,R.jsx)("div",{className:"cards"===Me?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,R.jsx)($.A,{columns:[...D,...E],onApply:et,onReset:tt,savedConditions:G,savedOperators:de,tableId:se})}),(0,R.jsx)(H.A,{tableId:se,onSelectFilter:et,onReset:tt,activeFilterName:ue,selectedFilterId:xe,onFilterChange:at,defaultFilterName:e("tasks.filters.current")}),"table"===Me?(0,R.jsx)("div",{className:"overflow-x-auto",children:(0,R.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,R.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,R.jsx)("tr",{children:ct.map((e=>{const t=D.find((t=>t.id===e));return t?(0,R.jsx)("th",{scope:"col",className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ".concat(e===Oe?"bg-blue-100 dark:bg-blue-800":""),draggable:!0,onDragStart:()=>nt(e),onDragOver:t=>ot(t,e),onDrop:t=>it(t,e),onDragEnd:dt,children:(0,R.jsxs)("div",{className:"flex items-center",children:[window.innerWidth<=640?t.shortLabel:t.label,"actions"!==e&&(0,R.jsx)("button",{onClick:()=>Ze(e),className:"ml-1 focus:outline-none",children:(0,R.jsx)(k.A,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})},e):null}))})}),(0,R.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:O?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-3 sm:px-4 md:px-6 py-4 text-center",children:(0,R.jsx)("div",{className:"flex justify-center",children:(0,R.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})})})}):M?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-6 py-4 text-center text-red-600 dark:text-red-400",children:M})}):0===st.length?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:ct.length,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,R.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,R.jsx)(f.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,R.jsx)("div",{className:"text-sm",children:e("tasks.noTasksFound")})]})})}):(0,R.jsx)(R.Fragment,{children:st.slice(0,_e).map((t=>{const r=(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description),s=(0,Z.F2)(r);return(0,R.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:ct.map((r=>{switch(r){case"title":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,R.jsxs)("div",{className:"ml-2 relative group",children:[(0,R.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("tasks.showDescription"),children:(0,R.jsx)(y.A,{className:"h-5 w-5"})}),(0,R.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,R.jsx)(q.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,X.qY)(t.status,"task")," dark:bg-opacity-30 status-col"),children:t.status})},r);case"responsibleAndQualityControl":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"flex flex-col",children:[(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("tasks.columns.responsible"),":"]}),(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.responsible").substring(0,3),":"]}),(0,R.jsx)("br",{}),t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-"]}),(0,R.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,R.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:e("tasks.qualityControlLabel")}),(0,R.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("tasks.columns.qualityControl").substring(0,2),":"]}),(0,R.jsx)("br",{}),t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-"]})]})},r);case"branch":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const s=(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description),l=(0,Z.F2)(s);return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"text-sm ".concat("none"!==s?l.textClass:"text-gray-900 dark:text-gray-200"),children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"-","none"!==s&&(0,R.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,R.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4 whitespace-nowrap",children:(0,R.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,R.jsx)("div",{className:"status-buttons",children:Xe(t)}),a("tasks","write","table")&&(0,R.jsx)("button",{onClick:()=>{je(t),we(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,R.jsx)(v.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,R.jsx)("button",{onClick:()=>ut(t),className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,R.jsx)(w.A,{className:"h-4 w-4"})}),a("tasks","delete","table")&&(0,R.jsx)("button",{onClick:()=>mt(t.id),className:"p-1.5 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:e("common.delete"),children:(0,R.jsx)(N.A,{className:"h-4 w-4"})})]})},r);default:return null}}))},t.id)}))})})]})}):(0,R.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:O?(0,R.jsx)("div",{className:"flex justify-center py-12",children:(0,R.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"})}):M?(0,R.jsx)("div",{className:"flex justify-center py-12 text-red-600 dark:text-red-400",children:M}):0===st.length?(0,R.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,R.jsx)(f.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,R.jsx)("div",{className:"text-sm",children:"Keine To Do's gefunden"})]}):(0,R.jsx)(ee.A,{children:st.slice(0,_e).map((t=>{(0,Z.go)(t.dueDate,"todo",void 0,t.title,t.description);const s=[];if(Ve.has("branch")&&s.push({icon:(0,R.jsx)(j.A,{className:"h-4 w-4"}),label:e("tasks.columns.branch"),value:t.branch.name,section:"left"}),Ve.has("responsible")){const a=t.responsible?"".concat(t.responsible.firstName," ").concat(t.responsible.lastName):t.role?t.role.name:"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,R.jsx)(A.A,{className:"h-4 w-4"}),label:e("tasks.columns.responsible"),value:r,section:"main"})}if(Ve.has("qualityControl")){const a=t.qualityControl?"".concat(t.qualityControl.firstName," ").concat(t.qualityControl.lastName):"-",r=a.length>4&&"-"!==a?a.substring(0,4):a;s.push({icon:(0,R.jsx)(A.A,{className:"h-4 w-4"}),label:e("tasks.columns.qualityControl"),value:r,section:"main-second"})}if(Ve.has("dueDate")){const a=(0,Z.Rj)(t.dueDate,"todo",t.title,t.description,(0,R.jsx)(C.A,{className:"h-4 w-4"}),e("tasks.columns.dueDate"),(e=>(0,te.GP)(e,"dd.MM.yyyy",{locale:ae.de})),!1);s.push((0,r.A)((0,r.A)({},a),{},{section:"right-inline"}))}Ve.has("description")&&t.description&&s.push({label:e("tasks.columns.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const l=(0,R.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,R.jsx)("div",{className:"status-buttons",children:Xe(t)}),a("tasks","write","table")&&(0,R.jsx)("button",{onClick:e=>{e.stopPropagation(),je(t),we(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,R.jsx)(v.A,{className:"h-4 w-4"})}),a("tasks","both","table")&&(0,R.jsx)("button",{onClick:e=>{e.stopPropagation(),ut(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("tasks.actions.copy"),children:(0,R.jsx)(w.A,{className:"h-4 w-4"})})]});return(0,R.jsx)(J.A,{title:t.title,status:{label:(0,X.Iw)(t.status,"task",e),color:(0,X.qY)(t.status,"task"),onPreviousClick:void 0,onNextClick:void 0},metadata:s,actions:l},t.id)}))})}),st.length>_e&&(0,R.jsx)("div",{className:"mt-4 flex justify-center",children:(0,R.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Be((e=>e+10)),children:[e("common.showMore")," (",st.length-_e," ",e("common.remaining"),")"]})})]})]})]})}),(0,R.jsx)(_,{isOpen:fe,onClose:()=>ye(!1),onTaskCreated:e=>{null!=e&&(F((t=>{const a=t.filter((e=>null!=e));return[e,...a]})),we(!0),je(e))}}),Ne&&(0,R.jsx)(B,{isOpen:ve,onClose:()=>{we(!1),je(null)},onTaskUpdated:t=>{null!=t&&(F((e=>e.filter((e=>null!=e)).map((e=>e.id===t.id?t:e)))),we(!1),je(null),Y.oR.success(e("worktime.messages.taskUpdated")))},task:Ne})]})}}}]);
//# sourceMappingURL=802.60ec6963.chunk.js.map