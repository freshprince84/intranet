"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[786],{1052:(e,t,r)=>{r.d(t,{F2:()=>n,Rj:()=>i,go:()=>l});const s={request:{criticalHours:24},todo:{criticalHours:24}};const a={hourly:{criticalHours:2},daily:{criticalHours:6},standard:{criticalHours:24}};function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"request",r=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!e)return"none";const i=new Date,o=new Date(e),d=(i.getTime()-o.getTime())/36e5;if(d<=0)return"none";let c;if(r)c=r;else if("todo"===t&&l){const e=function(e,t){const r=e.toLowerCase(),s=(t||"").toLowerCase();return r.includes("st\xfcndlich")||s.includes("st\xfcndlich")?"hourly":r.includes("t\xe4glich")||s.includes("t\xe4glich")?"daily":"standard"}(l,n);c=a[e]}else c=s[t];return d>=c.criticalHours?"critical":"expired"}function n(e){switch(e){case"expired":return{borderClass:"border-orange-500 dark:border-orange-600",bgClass:"bg-orange-50 dark:bg-orange-900/20",textClass:"text-orange-700 dark:text-orange-300",badgeClass:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"};case"critical":return{borderClass:"border-red-500 dark:border-red-600",bgClass:"bg-red-50 dark:bg-red-900/20",textClass:"text-red-700 dark:text-red-700",badgeClass:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"};default:return{borderClass:"",bgClass:"",textClass:"",badgeClass:""}}}function i(e){let t=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F\xe4lligkeit",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e=>e.toLocaleDateString(),a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const i=l(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"request",void 0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),o=n(i);return{icon:t,label:r,value:e?s(new Date(e)):"-",className:"none"!==i?a?o.badgeClass:o.textClass:void 0}}},1853:(e,t,r)=>{r.d(t,{Iw:()=>a,qY:()=>s});r(5043),r(579);const s=(e,t)=>{if("task"===t)switch(e){case"open":default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"improval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"quality_control":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"done":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}if("request"===t)switch(e){case"approval":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"to_improve":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"denied":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}if("invoice"===t)switch(e){case"DRAFT":default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";case"SENT":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"PAID":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"OVERDUE":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"CANCELLED":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},a=(e,t,r)=>{if(r){if("task"===t){const t=`tasks.status.${e}`,s=r(t);if(s!==t)return s}if("request"===t){const t=`requests.status.${e}`,s=r(t);if(s!==t)return s}if("invoice"===t){const t=`invoices.status.${e.toLowerCase()}`,s=r(t);if(s!==t)return s}}if("task"===t)switch(e){case"open":return"Offen";case"in_progress":return"In Bearbeitung";case"improval":return"Nachbesserung";case"quality_control":return"Qualit\xe4tskontrolle";case"done":return"Erledigt";default:return e}if("request"===t)switch(e){case"approval":return"Offen";case"approved":return"Genehmigt";case"to_improve":return"Nachbesserung";case"denied":return"Abgelehnt";default:return e}if("invoice"===t)switch(e){case"DRAFT":return"Entwurf";case"SENT":return"Gesendet";case"PAID":return"Bezahlt";case"OVERDUE":return"\xdcberf\xe4llig";case"CANCELLED":return"Storniert";default:return e}return e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}},2786:(e,t,r)=>{r.r(t),r.d(t,{default:()=>oe});var s=r(5043),a=r(4117),l=r(3216),n=r(1923),i=r(2672),o=r(2760),d=r(2023),c=r(1801),u=r(6443),m=r(7591),x=r(1816),g=r(9422),h=r(6896),b=r(5657),p=r(579);const f=e=>{let{isOpen:t,onClose:r,onRequestCreated:l}=e;const{t:o}=(0,a.Bd)(),{user:d}=(0,i.As)(),{openSidepane:f,closeSidepane:y}=(0,b.N)(),[v,w]=(0,s.useState)(window.innerWidth>1070),[k,j]=(0,s.useState)([]),[N,q]=(0,s.useState)([]),[S,R]=(0,s.useState)({title:"",description:"",responsible_id:"",branch_id:"",due_date:"",create_todo:!1}),[A,C]=(0,s.useState)(null),[T,E]=(0,s.useState)(!1),[D,$]=(0,s.useState)(window.innerWidth<640),[_,L]=(0,s.useState)([]),[B,F]=(0,s.useState)(!1),M=(0,s.useRef)(null),O=(0,s.useRef)(null);(0,s.useEffect)((()=>{t&&(async()=>{try{if(C(null),!localStorage.getItem("token"))return void C(o("createRequest.errors.notAuthenticated"));console.log("Lade Daten f\xfcr CreateRequestModal...");try{const[t,r]=await Promise.all([n.A.get(c.Sn.USERS.DROPDOWN),n.A.get(c.Sn.BRANCHES.BASE)]);if(console.log("Benutzer geladen:",t.data.length),console.log("Niederlassungen geladen:",r.data.length),j(t.data||[]),q(r.data||[]),d){if(R((e=>({...e,responsible_id:d.id.toString()}))),r.data&&r.data.length>0){var e;const t=null===(e=r.data[0])||void 0===e?void 0:e.id.toString();R((e=>({...e,branch_id:t})))}const t=new Date;t.setDate(t.getDate()+14);const s=t.toISOString().split("T")[0];R((e=>({...e,due_date:s})))}}catch(s){console.error("Fehler beim Laden der Daten:",s);const e=s;var t,r;"ERR_NETWORK"===e.code?C("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft."):C(`Fehler beim Laden der Daten: ${(null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message}`)}}catch(s){console.error("Unerwarteter Fehler:",s),C("Ein unerwarteter Fehler ist aufgetreten")}})()}),[t]),(0,s.useEffect)((()=>{const e=()=>{$(window.innerWidth<640),w(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?f():y(),()=>{y()})),[t,f,y]);const W=e=>{var t,r;const s=null===(t=e.firstName)||void 0===t?void 0:t.split(" ")[0],a=null===(r=e.username)||void 0===r?void 0:r.split(" ")[0];return s?`${s} (${a})`:a||o("createRequest.errors.unknownUser")},U=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await P(t))}}},I=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await P(t)}},z=e=>{e.preventDefault(),e.stopPropagation()},P=async e=>{F(!0),C(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};L((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?`\n![${e.name}](${o("createRequest.form.uploadAfterCreate")})\n`:`\n[${e.name}](${o("createRequest.form.uploadAfterCreate")})\n`,O.current){const e=O.current.selectionStart,t=S.description.substring(0,e),s=S.description.substring(e);R({...S,description:t+r+s}),setTimeout((()=>{if(O.current){const t=e+r.length;O.current.selectionStart=t,O.current.selectionEnd=t,O.current.focus()}}),0)}else R({...S,description:S.description+r})}catch(s){var t,r;console.error("Fehler beim Verarbeiten der Datei:",s);const e=s;C((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||o("createRequest.errors.unknownError"))}finally{F(!1)}},H=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await P(r),M.current&&(M.current.value="")},V=async e=>{e.preventDefault(),C(null),E(!0);try{if(!localStorage.getItem("token"))throw new Error(o("createRequest.errors.notAuthenticated"));if(null===d||void 0===d||!d.id)throw new Error(o("createRequest.errors.unknownUser"));const e=parseInt(S.responsible_id),t=parseInt(S.branch_id);if(isNaN(e)||isNaN(t))throw new Error(o("createRequest.errors.invalidIds"));const s=await n.A.post(c.Sn.REQUESTS.BASE,{title:S.title,description:S.description||"",responsible_id:e,branch_id:t,requested_by_id:d.id,due_date:S.due_date||null,create_todo:S.create_todo,status:"approval"});if(201!==s.status)throw new Error(o("createRequest.errors.createError"));await(async e=>{if(0!==_.length)try{E(!0);for(const t of _){if(!t.file)continue;const r=new FormData;r.append("file",t.file),await n.A.post(c.Sn.REQUESTS.ATTACHMENTS(e),r,{headers:{"Content-Type":"multipart/form-data"}})}console.log(o("createRequest.messages.attachmentsUploaded",{count:_.length}))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{E(!1)}})(s.data.id),l(s.data),r(),R({title:"",description:"",responsible_id:"",branch_id:"",due_date:"",create_todo:!1}),L([])}catch(a){var t,s;console.error("Create Request Error:",a);const e=a;C((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||o("createRequest.errors.createError"))}finally{E(!1)}},Q=()=>0===_.length?null:(0,p.jsx)("div",{className:"mt-2",children:(0,p.jsx)("ul",{className:"flex flex-wrap gap-2",children:_.map(((e,t)=>(0,p.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,p.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,p.jsx)("div",{className:"flex ml-2",children:(0,p.jsx)("button",{type:"button",onClick:()=>(e=>{const t=_[e];if(t&&(L((t=>t.filter(((t,r)=>r!==e)))),t.fileName)){const e=o("createRequest.form.uploadAfterCreate"),r=new RegExp(`!\\[${t.fileName}\\]\\(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),s=new RegExp(`\\[${t.fileName}\\]\\(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),a=S.description.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");R({...S,description:a})}})(t),className:"text-red-600 hover:text-red-900 ml-1",title:o("createRequest.form.remove"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,p.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,p.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},t)))})});return t?D?(0,p.jsxs)(u.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,p.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,p.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,p.jsxs)(u.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,p.jsx)(u.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("createRequest.title")}),(0,p.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,p.jsx)(m.A,{className:"h-6 w-6"})})]}),(0,p.jsxs)("div",{className:"p-4",children:[A&&(0,p.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A}),(0,p.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.title")}),(0,p.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.title,onChange:e=>R({...S,title:e.target.value})})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.description")}),(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)("textarea",{ref:O,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.description,onChange:e=>R({...S,description:e.target.value}),onPaste:U,onDrop:I,onDragOver:z,placeholder:o("createRequest.form.descriptionPlaceholder")}),(0,p.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:o("createRequest.form.addFile"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,p.jsx)("input",{ref:M,type:"file",onChange:H,className:"hidden"}),B&&(0,p.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,p.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o("createRequest.form.uploading")})})]}),Q(),S.description&&(0,p.jsx)("div",{className:"mt-3",children:(0,p.jsx)(h.A,{content:S.description,temporaryAttachments:_})})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.responsible")}),(0,p.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.responsible_id,onChange:e=>R({...S,responsible_id:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(k)&&k.map((e=>(0,p.jsx)("option",{value:e.id,children:W(e)},e.id)))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.branch")}),(0,p.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.branch_id,onChange:e=>R({...S,branch_id:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(N)&&N.map((e=>(0,p.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.dueDate")}),(0,p.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.due_date,onChange:e=>R({...S,due_date:e.target.value})})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("input",{type:"checkbox",id:"create_todo",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.create_todo,onChange:e=>R({...S,create_todo:e.target.checked})}),(0,p.jsx)("label",{htmlFor:"create_todo",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.createTodo")})]}),(0,p.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,p.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("createRequest.form.cancel"),children:(0,p.jsx)(m.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:o(T?"createRequest.form.creating":"createRequest.form.create"),disabled:T,children:T?(0,p.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,p.jsx)(g.A,{className:"h-5 w-5"})})]})]})]})]})})]}):(0,p.jsxs)(p.Fragment,{children:[t&&!v&&(0,p.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,p.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,p.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("createRequest.title")}),(0,p.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,p.jsx)(m.A,{className:"h-6 w-6"})})]}),(0,p.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[A&&(0,p.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A}),(0,p.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.title")}),(0,p.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.title,onChange:e=>R({...S,title:e.target.value})})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.description")}),(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)("textarea",{ref:O,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:S.description,onChange:e=>R({...S,description:e.target.value}),onPaste:U,onDrop:I,onDragOver:z,placeholder:o("createRequest.form.descriptionPlaceholder")}),(0,p.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:o("createRequest.form.addFile"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,p.jsx)("input",{ref:M,type:"file",onChange:H,className:"hidden"}),B&&(0,p.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,p.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o("createRequest.form.uploading")})})]}),Q(),S.description&&(0,p.jsx)("div",{className:"mt-3",children:(0,p.jsx)(h.A,{content:S.description,temporaryAttachments:_})})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.responsible")}),(0,p.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.responsible_id,onChange:e=>R({...S,responsible_id:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(k)&&k.map((e=>(0,p.jsx)("option",{value:e.id,children:W(e)},e.id)))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.branch")}),(0,p.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.branch_id,onChange:e=>R({...S,branch_id:e.target.value}),children:[(0,p.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(N)&&N.map((e=>(0,p.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.dueDate")}),(0,p.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:S.due_date,onChange:e=>R({...S,due_date:e.target.value})})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("input",{type:"checkbox",id:"create_todo_sidepane",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:S.create_todo,onChange:e=>R({...S,create_todo:e.target.checked})}),(0,p.jsx)("label",{htmlFor:"create_todo_sidepane",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.createTodo")})]}),(0,p.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,p.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("createRequest.form.cancel"),children:(0,p.jsx)(m.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:o(T?"createRequest.form.creating":"createRequest.form.create"),disabled:T,children:T?(0,p.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,p.jsx)(g.A,{className:"h-5 w-5"})})]})]})]})]})]}):null};var y=r(9248);const v=e=>{let{isOpen:t,onClose:r,onRequestUpdated:l,request:d}=e;const{t:h,i18n:f}=(0,a.Bd)(),{user:v}=(0,i.As)();(0,s.useEffect)((()=>{0}),[f.language,h]);const{openSidepane:w,closeSidepane:k}=(0,b.N)(),[j,N]=(0,s.useState)(window.innerWidth>1070),[q,S]=(0,s.useState)(d.title),[R,A]=(0,s.useState)(d.description||""),[C,T]=(0,s.useState)(d.responsible.id),[E,D]=(0,s.useState)(d.branch.id),[$,_]=(0,s.useState)(d.dueDate?d.dueDate.split("T")[0]:""),[L,B]=(0,s.useState)(d.createTodo),[F,M]=(0,s.useState)([]),[O,W]=(0,s.useState)([]),[U,I]=(0,s.useState)(null),[z,P]=(0,s.useState)(!1),[H,V]=(0,s.useState)(!1),[Q,G]=(0,s.useState)(window.innerWidth<640),[K,Y]=(0,s.useState)(d.attachments||[]),[Z,J]=(0,s.useState)(!1),[X,ee]=(0,s.useState)([]),te=(0,s.useRef)(null),re=(0,s.useRef)(null),{hasPermission:se}=(0,o.S)(),ae=se("requests","both","table");(0,s.useEffect)((()=>{const e=()=>{G(window.innerWidth<640),N(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>(t?w():k(),()=>{k()})),[t,w,k]),(0,s.useEffect)((()=>{t&&(le(),ne())}),[t]);const le=async()=>{try{I(null);if(!localStorage.getItem("token"))return void I(h("createRequest.editRequest.errors.notAuthenticated"));const[e,t]=await Promise.all([n.A.get(c.Sn.USERS.BASE),n.A.get(c.Sn.BRANCHES.BASE)]);M(e.data||[]),W(t.data||[])}catch(r){console.error("Unerwarteter Fehler:",r);const s=r;var e,t;if("ERR_NETWORK"===s.code)I(h("createRequest.editRequest.errors.connectionError"));else I(`${h("createRequest.editRequest.errors.loadError")}: ${(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message}`)}},ne=async()=>{try{I(null);const e=await n.A.get(c.Sn.REQUESTS.ATTACHMENTS(d.id));Y(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",r),Y([]);const s=r,a=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message;console.warn(`Anh\xe4nge konnten nicht geladen werden: ${a}`)}},ie=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await ce(t))}}},oe=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await ge(t)}},de=e=>{e.preventDefault(),e.stopPropagation()},ce=async e=>{J(!0),I(null);try{const t=new FormData;t.append("file",e);const r=(await n.A.post(c.Sn.REQUESTS.ATTACHMENTS(d.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;Y([...K,r]);let s="";if(s=r.fileType.startsWith("image/")?`\n![${r.fileName}](${window.location.origin}/api${c.Sn.REQUESTS.ATTACHMENT(d.id,r.id)})\n`:`\n[${r.fileName}](${window.location.origin}/api${c.Sn.REQUESTS.ATTACHMENT(d.id,r.id)})\n`,te.current){const e=te.current.selectionStart,t=R.substring(0,e),r=R.substring(e);A(t+s+r),setTimeout((()=>{if(te.current){const t=e+s.length;te.current.selectionStart=t,te.current.selectionEnd=t,te.current.focus()}}),0)}else A(R+s);const a=document.createElement("img");a.src=`${window.location.origin}/api${c.Sn.REQUESTS.ATTACHMENT(d.id,r.id)}`,a.alt=r.fileName,a.classList.add("hidden"),document.body.appendChild(a),a.onload=()=>{document.body.removeChild(a)}}catch(s){var t,r;console.error("Fehler beim Hochladen der Datei:",s);const e=s;I((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||h("createRequest.editRequest.errors.unknownError"))}finally{J(!1)}},ue=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await ge(r),re.current&&(re.current.value="")},me=async e=>{e.preventDefault(),I(null),V(!0);try{if(!localStorage.getItem("token"))throw new Error(h("createRequest.editRequest.errors.notAuthenticated"));await n.A.put(c.Sn.REQUESTS.BY_ID(d.id),{title:q,description:R||"",responsible_id:C,branch_id:E,due_date:$||null,create_todo:L}),await he();const e=await n.A.get(c.Sn.REQUESTS.BY_ID(d.id));r(),l&&l(e.data)}catch(a){var t,s;console.error("Fehler beim Aktualisieren des Requests:",a);const e=a;I((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||h("createRequest.editRequest.errors.unknownError"))}finally{V(!1)}},xe=async()=>{if(z)try{V(!0),await n.A.delete(c.Sn.REQUESTS.BY_ID(d.id)),r()}catch(s){var e,t;console.error("Delete Error:",s);const r=s;I((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||h("createRequest.editRequest.errors.unknownError"))}finally{V(!1)}else P(!0)},ge=async e=>{J(!0),I(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};ee((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?`\n![${e.name}](${h("createRequest.editRequest.form.uploadAfterCreate")})\n`:`\n[${e.name}](${h("createRequest.editRequest.form.uploadAfterCreate")})\n`,te.current){const e=te.current.selectionStart,t=R.substring(0,e),s=R.substring(e);A(t+r+s),setTimeout((()=>{if(te.current){const t=e+r.length;te.current.selectionStart=t,te.current.selectionEnd=t,te.current.focus()}}),0)}else A(R+r)}catch(s){var t,r;console.error("Fehler beim Verarbeiten der Datei:",s);const e=s;I((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||h("createRequest.editRequest.errors.unknownError"))}finally{J(!1)}},he=async()=>{if(0!==X.length)try{V(!0);for(const e of X){if(!e.file)continue;const t=new FormData;t.append("file",e.file),await n.A.post(c.Sn.REQUESTS.ATTACHMENTS(d.id),t,{headers:{"Content-Type":"multipart/form-data"}})}console.log(`${X.length} Anh\xe4nge erfolgreich hochgeladen.`),ee([])}catch(e){console.error("Fehler beim Hochladen der Anh\xe4nge:",e)}finally{V(!1)}},be=()=>0===K.length?null:(0,p.jsx)("div",{className:"mt-2",children:(0,p.jsx)("ul",{className:"flex flex-wrap gap-2",children:K.map((e=>(0,p.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,p.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,p.jsxs)("div",{className:"flex ml-2",children:[(0,p.jsx)("button",{type:"button",onClick:()=>(async e=>{try{if(void 0===e.id)throw new Error("Anhang-ID fehlt");const t=await n.A.get(c.Sn.REQUESTS.ATTACHMENT(d.id,e.id),{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=r,s.setAttribute("download",e.fileName),document.body.appendChild(s),s.click(),s.remove()}catch(s){var t,r;console.error("Fehler beim Herunterladen des Anhangs:",s);const e=s;I((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||h("createRequest.editRequest.errors.unknownError"))}})(e),className:"text-blue-600 hover:text-blue-900 mr-1",title:h("createRequest.editRequest.form.download"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,p.jsx)("button",{type:"button",onClick:()=>void 0!==e.id&&(async e=>{try{I(null);const t=K.find((t=>t.id===e));if(t&&(await n.A.delete(c.Sn.REQUESTS.ATTACHMENT(d.id,e)),Y(K.filter((t=>t.id!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`!\\[(.*?)\\]\\(${e}\\)`,"g"),s=new RegExp(`\\[(.*?)\\]\\(${e}\\)`,"g"),a=R.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");A(a)}}catch(s){var t,r;console.error("Fehler beim L\xf6schen des Anhangs:",s);const e=s;I((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||h("createRequest.editRequest.errors.unknownError"))}})(e.id),className:"text-red-600 hover:text-red-900 ml-1",title:h("createRequest.editRequest.form.remove"),disabled:void 0===e.id,children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.fileType.startsWith("image/")&&e.id&&(0,p.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,p.jsx)("img",{src:`${window.location.origin}/api${c.Sn.REQUESTS.ATTACHMENT(d.id,e.id)}`,alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id||`temp-${e.fileName}`)))})}),pe=()=>0===X.length?null:(0,p.jsx)("div",{className:"mt-2",children:(0,p.jsx)("ul",{className:"flex flex-wrap gap-2",children:X.map(((e,t)=>(0,p.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,p.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,p.jsx)("div",{className:"flex ml-2",children:(0,p.jsx)("button",{type:"button",onClick:()=>(e=>{const t=X[e];if(t&&(ee(X.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=h("createRequest.editRequest.form.uploadAfterCreate"),s=new RegExp(`!\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),a=new RegExp(`\\[${e}\\]\\(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`,"g"),l=R.replace(s,"").replace(a,"").replace(/\n{3,}/g,"\n\n");A(l)}})(t),className:"text-red-600 hover:text-red-900 ml-1",title:h("createRequest.editRequest.form.remove"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),e.fileType.startsWith("image/")&&e.file&&(0,p.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200",children:(0,p.jsx)("img",{src:URL.createObjectURL(e.file),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},`temp-${t}`)))})});if(!t)return null;const fe=()=>(0,p.jsxs)("form",{onSubmit:me,className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.title")}),(0,p.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:q,onChange:e=>S(e.target.value)})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"description_request_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.description")}),(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)("textarea",{ref:te,rows:Q?5:10,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:R,onChange:e=>A(e.target.value),onPaste:ie,onDrop:oe,onDragOver:de}),(0,p.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=re.current)||void 0===e?void 0:e.click()},className:"absolute bottom-2 left-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",title:h("createRequest.editRequest.form.fileUpload"),children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,p.jsx)("input",{ref:re,type:"file",onChange:ue,className:"hidden"}),Z&&(0,p.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,p.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:h("createRequest.editRequest.form.uploading")})})]}),be(),pe()]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.responsible")}),(0,p.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:C,onChange:e=>T(Number(e.target.value)),children:F.map((e=>(0,p.jsxs)("option",{value:e.id,children:[e.firstName," (",e.username,")"]},e.id)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.branch")}),(0,p.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:E,onChange:e=>D(Number(e.target.value)),children:O.map((e=>(0,p.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.dueDate")}),(0,p.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:$,onChange:e=>_(e.target.value)})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("input",{type:"checkbox",id:"create_todo_edit",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:border-gray-600",checked:L,onChange:e=>B(e.target.checked)}),(0,p.jsx)("label",{htmlFor:"create_todo_edit",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:h("createRequest.editRequest.form.createTodo")})]}),(0,p.jsxs)("div",{className:"flex justify-between pt-4",children:[ae&&(0,p.jsx)("button",{type:"button",onClick:xe,className:"p-2 rounded-md "+(z?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),title:h(z?"createRequest.editRequest.form.confirmDelete":"createRequest.editRequest.form.delete"),children:z?(0,p.jsx)(g.A,{className:"h-5 w-5"}):(0,p.jsx)(y.A,{className:"h-5 w-5"})}),(0,p.jsxs)("div",{className:"flex gap-2",children:[(0,p.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:h("createRequest.editRequest.form.cancel"),children:(0,p.jsx)(m.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:h(H?"createRequest.editRequest.form.saving":"createRequest.editRequest.form.save"),disabled:H,children:H?(0,p.jsx)(x.A,{className:"h-5 w-5 animate-spin"}):(0,p.jsx)(g.A,{className:"h-5 w-5"})})]})]})]});return Q?(0,p.jsxs)(u.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,p.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,p.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,p.jsxs)(u.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,p.jsx)(u.lG.Title,{className:"text-lg font-semibold dark:text-white",children:h("createRequest.editRequest.title")}),(0,p.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,p.jsx)(m.A,{className:"h-6 w-6"})})]}),(0,p.jsxs)("div",{className:"p-4",children:[U&&(0,p.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:U}),fe()]})]})})]}):(0,p.jsxs)(p.Fragment,{children:[t&&!j&&(0,p.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,p.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col "+(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,p.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:h("createRequest.editRequest.title")}),(0,p.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,p.jsx)(m.A,{className:"h-6 w-6"})})]}),(0,p.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[U&&(0,p.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:U}),fe()]})]})]})};var w=r(8897),k=r(4426),j=r(7829),N=r(6400),q=r(1853),S=r(8662),R=r(2704),A=r(4850),C=r(1663),T=r(8010),E=r(1909),D=r(1252),$=r(9399),_=r(2811),L=r(3744),B=r(6238),F=r(4129),M=r(7988),O=r(9837),W=r(887),U=r(957),I=r(637),z=r(1052);const P=["title","requestedByResponsible","status","dueDate","branch","actions"],H="requests-table",V={title:["title"],status:["status"],requestedByResponsible:["requestedBy","responsible"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},Q={title:"title",status:"status",requestedBy:"requestedByResponsible",responsible:"requestedByResponsible",branch:"branch",dueDate:"dueDate",description:"description"},G=()=>{const{t:e}=(0,a.Bd)(),[t,r]=(0,s.useState)([]),[l,u]=(0,s.useState)(!0),[b,y]=(0,s.useState)(null),[G,K]=(0,s.useState)(""),[Y,Z]=(0,s.useState)([]),[J,X]=(0,s.useState)([]),[ee,te]=(0,s.useState)(""),[re,se]=(0,s.useState)(null),[ae,le]=(0,s.useState)(!1),[ne,ie]=(0,s.useState)({key:"dueDate",direction:"asc"}),[oe,de]=(0,s.useState)(!1),[ce,ue]=(0,s.useState)(!1),[me,xe]=(0,s.useState)(null),{user:ge}=(0,i.As)(),{hasPermission:he}=(0,o.S)(),be=(0,s.useMemo)((()=>[{id:"title",label:e("requests.columns.title"),shortLabel:e("requests.columns.title")},{id:"status",label:e("requests.columns.status"),shortLabel:e("requests.columns.status")},{id:"requestedByResponsible",label:e("requests.columns.requestedByResponsible"),shortLabel:e("requests.columns.requestedByResponsible").split("/")[0]},{id:"branch",label:e("requests.columns.branch"),shortLabel:e("requests.columns.branch").substring(0,5)},{id:"dueDate",label:e("requests.columns.dueDate"),shortLabel:e("requests.columns.dueDate").substring(0,5)},{id:"actions",label:e("requests.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),{settings:pe,isLoading:fe,updateColumnOrder:ye,updateHiddenColumns:ve,toggleColumnVisibility:we,isColumnVisible:ke,updateViewMode:je}=(0,d.F)("dashboard_requests",{defaultColumnOrder:P,defaultHiddenColumns:[],defaultViewMode:"cards"}),[Ne,qe]=(0,s.useState)(null),[Se,Re]=(0,s.useState)(null),[Ae,Ce]=(0,s.useState)(10),Te=pe.viewMode||"cards",[Ee,De]=(0,s.useState)((()=>({title:"asc",status:"asc",requestedBy:"asc",responsible:"asc",branch:"asc",dueDate:"asc",description:"asc"}))),$e=(0,s.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const r=V[e];r&&r.length>0&&t.push(...r)})),t.includes("description")||t.push("description"),t})(pe.columnOrder||P)),[pe.columnOrder]),_e=(0,s.useMemo)((()=>(e=>{const t=new Set;return e.forEach((e=>{(V[e]||[]).forEach((e=>t.add(e)))})),t})(pe.hiddenColumns||[])),[pe.hiddenColumns]),Le=(0,s.useMemo)((()=>new Set($e.filter((e=>!_e.has(e))))),[$e,_e]);(0,s.useEffect)((()=>{const e=document.querySelector(".dashboard-requests-wrapper");e&&("cards"===Te?e.classList.add("cards-mode"):e.classList.remove("cards-mode"))}),[Te]);const Be=async()=>{try{u(!0);const e=await n.A.get("/requests");r(e.data),y(null)}catch(s){console.error("Request Error:",s);const r=s;var e,t;if("ERR_NETWORK"===r.code)y("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft.");else y(`Fehler beim Laden der Requests: ${(null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message}`)}finally{u(!1)}};(0,s.useEffect)((()=>{Be()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const t=localStorage.getItem("token");if(!t)return void console.error("Nicht authentifiziert");const r=(await n.A.get(`${c.Sn.SAVED_FILTERS.BY_TABLE(H)}`,{headers:{Authorization:`Bearer ${t}`}})).data||[],s=r.some((t=>"Archiv"===t.name||t.name===e("requests.filters.archiv")||"Archivo"===t.name)),a=r.some((t=>"Aktuell"===t.name||t.name===e("requests.filters.aktuell")||"Actual"===t.name));if(!s){const e={tableId:H,name:"Archiv",conditions:[{column:"status",operator:"equals",value:"approved"},{column:"status",operator:"equals",value:"denied"}],operators:["OR"]};await n.A.post(`${c.Sn.SAVED_FILTERS.BASE}`,e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("Archiv-Filter f\xfcr Requests erstellt")}if(!a){const e={tableId:H,name:"Aktuell",conditions:[{column:"status",operator:"notEquals",value:"approved"},{column:"status",operator:"notEquals",value:"denied"}],operators:["AND"]};await n.A.post(`${c.Sn.SAVED_FILTERS.BASE}`,e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("Aktuell-Filter f\xfcr Requests erstellt")}}catch(b){console.error("Fehler beim Erstellen der Standard-Filter:",b)}})()}),[]),(0,s.useEffect)((()=>{(async()=>{try{const e=await n.A.get(c.Sn.SAVED_FILTERS.BY_TABLE(H)),t=e.data.find((e=>"Aktuell"===e.name||"Actual"===e.name));t&&(te("Aktuell"),se(t.id),ze(t.conditions,t.operators))}catch(b){console.error("Fehler beim Setzen des initialen Filters:",b)}})()}),[]);const Fe=async(e,s)=>{try{const a=t.find((t=>t.id===e));if(!a)return void y("Request nicht gefunden");r((t=>t.map((t=>t.id===e?{...t,status:s}:t)))),await n.A.put(`/requests/${e}`,{status:s,create_todo:a.createTodo})}catch(i){var a,l;console.error("Status Update Error:",i),Be();const e=i;y(`Fehler beim Aktualisieren des Status: ${(null===(a=e.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten"}`)}},Me=(0,s.useCallback)(((e,t)=>{const r=[...pe.columnOrder],s=r[e];r.splice(e,1),r.splice(t,0,s),ye(r)}),[pe.columnOrder,ye]),Oe=e=>{qe(e)},We=(e,t)=>{e.preventDefault(),Ne&&Ne!==t&&Re(t)},Ue=(e,t)=>{if(e.preventDefault(),Ne&&Ne!==t){const e=pe.columnOrder.indexOf(Ne),r=pe.columnOrder.indexOf(t);e>-1&&r>-1&&Me(e,r)}qe(null),Re(null)},Ie=()=>{qe(null),Re(null)},ze=(e,t)=>{Z(e),X(t)},Pe=()=>{Z([]),X([]),te(""),se(null)},He=()=>Y.length,Ve=(0,s.useMemo)((()=>t.filter((e=>{if(G){const t=G.toLowerCase();if(!(e.title.toLowerCase().includes(t)||`${e.requestedBy.firstName} ${e.requestedBy.lastName}`.toLowerCase().includes(t)||`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase().includes(t)||e.branch.name.toLowerCase().includes(t)))return!1}if(Y.length>0){const t={title:(e,t)=>{const r=(t.value||"").toLowerCase(),s=e.title.toLowerCase();return"equals"===t.operator?e.title===t.value:"contains"===t.operator?s.includes(r):"startsWith"===t.operator?s.startsWith(r):"endsWith"===t.operator?s.endsWith(r):null},status:(e,t)=>"equals"===t.operator?e.status===t.value:"notEquals"===t.operator?e.status!==t.value:null,requestedBy:(e,t)=>{const r=`${e.requestedBy.firstName} ${e.requestedBy.lastName}`.toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},responsible:(e,t)=>{const r=`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},branch:(e,t)=>{const r=e.branch.name.toLowerCase(),s=(t.value||"").toLowerCase();return"contains"===t.operator?r.includes(s):"equals"===t.operator?r===s:null},dueDate:(e,t)=>(0,N.J1)(e.dueDate,t)},r=(e,t)=>{switch(t){case"title":return e.title;case"status":return e.status;case"requestedBy":return`${e.requestedBy.firstName} ${e.requestedBy.lastName}`;case"responsible":return`${e.responsible.firstName} ${e.responsible.lastName}`;case"branch":return e.branch.name;case"dueDate":return e.dueDate;default:return e[t]}};if(0===(0,N.W5)([e],Y,J,r,t).length)return!1}return!0})).sort(((e,t)=>{var r,s;if("cards"===Te){const a=$e.filter((e=>Le.has(e)));for(const l of a){let a,n;switch(l){case"title":a=e.title.toLowerCase(),n=t.title.toLowerCase();break;case"status":const l={approval:0,to_improve:1,approved:2,denied:3};a=null!==(r=l[e.status])&&void 0!==r?r:999,n=null!==(s=l[t.status])&&void 0!==s?s:999;break;case"requestedBy":a=`${e.requestedBy.firstName} ${e.requestedBy.lastName}`.toLowerCase(),n=`${t.requestedBy.firstName} ${t.requestedBy.lastName}`.toLowerCase();break;case"responsible":a=`${e.responsible.firstName} ${e.responsible.lastName}`.toLowerCase(),n=`${t.responsible.firstName} ${t.responsible.lastName}`.toLowerCase();break;case"branch":a=e.branch.name.toLowerCase(),n=t.branch.name.toLowerCase();break;case"dueDate":a=new Date(e.dueDate).getTime(),n=new Date(t.dueDate).getTime();break;case"description":a=(e.description||"").toLowerCase(),n=(t.description||"").toLowerCase();break;default:continue}const i=Ee[l]||"asc";if(a<n)return"asc"===i?-1:1;if(a>n)return"asc"===i?1:-1}return 0}{let r=e[ne.key],s=t[ne.key];return"requestedBy.firstName"===ne.key?(r=e.requestedBy.firstName,s=t.requestedBy.firstName):"responsible.firstName"===ne.key?(r=e.responsible.firstName,s=t.responsible.firstName):"branch.name"===ne.key&&(r=e.branch.name,s=t.branch.name),r<s?"asc"===ne.direction?-1:1:r>s?"asc"===ne.direction?1:-1:0}}))),[t,G,ne,Y,J,Te,$e,Le,Ee]),Qe=async e=>{try{if(!ge)return void y("Benutzer nicht authentifiziert");const t={title:`${e.title}-Kopie`,responsible_id:e.responsible.id,branch_id:e.branch.id,due_date:e.dueDate?e.dueDate.split("T")[0]:"",create_todo:e.createTodo,requested_by_id:ge.id},s=await n.A.post(c.Sn.REQUESTS.BASE,t);r((e=>[s.data,...e])),xe(s.data),ue(!0)}catch(a){var t,s;console.error("Fehler beim Kopieren des Requests:",a);const e=a;y((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}};if(l)return(0,p.jsx)("div",{className:"p-4",children:"L\xe4dt..."});if(b)return(0,p.jsx)("div",{className:"p-4 text-red-600",children:b});const Ge=pe.columnOrder.filter((e=>ke(e)));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(f,{isOpen:oe,onClose:()=>de(!1),onRequestCreated:e=>{r((t=>[e,...t])),ue(!0),xe(e)}}),me&&(0,p.jsx)(v,{isOpen:ce,onClose:()=>{ue(!1),xe(null)},onRequestUpdated:e=>{r((t=>t.map((t=>t.id===e.id?e:t)))),ue(!1),xe(null)},request:me}),(0,p.jsxs)("div",{className:"cards"===Te?"":"border-0 rounded-lg","data-view-mode":Te,children:[(0,p.jsxs)("div",{className:"flex items-center mb-4 justify-between "+("cards"===Te?"-mx-6 px-6":""),children:[(0,p.jsx)("div",{className:"flex items-center",children:he("requests","write","table")&&(0,p.jsx)("button",{onClick:()=>de(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:e("requests.createRequest"),"aria-label":e("requests.createRequest"),children:(0,p.jsx)(S.A,{className:"h-4 w-4"})})}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)(R.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,p.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("requests.title")})]}),(0,p.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,p.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:G,onChange:e=>K(e.target.value)}),(0,p.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 "+("cards"===Te?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>je("table"===Te?"cards":"table"),title:e("table"===Te?"common.viewAsCards":"common.viewAsTable"),children:"table"===Te?(0,p.jsx)(A.A,{className:"h-5 w-5"}):(0,p.jsx)(C.A,{className:"h-5 w-5"})}),(0,p.jsxs)("button",{className:`p-2 rounded-md ${He()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"} ml-1 relative`,onClick:()=>le(!ae),title:e("common.filter"),style:{position:"relative"},children:[(0,p.jsx)(T.A,{className:"h-5 w-5"}),He()>0&&(0,p.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",style:{position:"absolute",top:"-0.25rem",right:"-0.25rem"},children:He()})]}),(0,p.jsx)("div",{className:"ml-1",children:(0,p.jsx)(w.A,{columns:"cards"===Te?[{id:"title",label:e("requests.columns.title")},{id:"status",label:e("requests.columns.status")},{id:"requestedBy",label:e("requests.columns.requestedBy")},{id:"responsible",label:e("requests.columns.responsible")},{id:"branch",label:e("requests.columns.branch")},{id:"dueDate",label:e("requests.columns.dueDate")},{id:"description",label:e("common.description")}]:be,visibleColumns:"cards"===Te?Array.from(Le):Ge,columnOrder:"cards"===Te?$e:pe.columnOrder,onToggleColumnVisibility:e=>{if("cards"===Te){const t=Q[e];if(t)if("requestedByResponsible"===t){const r="requestedBy"===e?"responsible":"requestedBy",s=_e.has(r),a=pe.hiddenColumns.includes(t);a&&!s||!a&&s?we(t):a||we(t)}else we(t)}else we(e)},onMoveColumn:"cards"===Te?(e,t)=>{const r=[...$e],s=r[e];r.splice(e,1),r.splice(t,0,s);const a=[],l=new Set;r.forEach((e=>{const t=Q[e];t&&!l.has(t)&&(a.push(t),l.add(t))})),pe.columnOrder.forEach((e=>{a.includes(e)||a.push(e)})),ye(a)}:Me,onClose:()=>{},buttonTitle:e("cards"===Te?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===Te?"tableColumn.sortAndDisplay":"tableColumn.configure"),sortDirections:"cards"===Te?Ee:void 0,onSortDirectionChange:"cards"===Te?(e,t)=>{De((r=>({...r,[e]:t})))}:void 0,showSortDirection:"cards"===Te})})]})]}),ae&&(0,p.jsx)("div",{className:"cards"===Te?"-mx-6 px-6":"",children:(0,p.jsx)(k.A,{columns:[{id:"title",label:e("requests.columns.title")},{id:"status",label:e("requests.columns.status")},{id:"requestedBy",label:e("requests.columns.requestedBy")},{id:"responsible",label:e("requests.columns.responsible")},{id:"branch",label:e("requests.columns.branch")},{id:"dueDate",label:e("requests.columns.dueDate")}],onApply:ze,onReset:Pe,savedConditions:Y,savedOperators:J,tableId:H})}),(0,p.jsx)("div",{className:"cards"===Te?"-mx-6 px-6":"",children:(0,p.jsx)(j.A,{tableId:H,onSelectFilter:ze,onReset:Pe,activeFilterName:ee,selectedFilterId:re,onFilterChange:(e,t,r,s)=>{te(e),se(t),ze(r,s)},defaultFilterName:"Aktuell"})}),"table"===Te?(0,p.jsx)("div",{className:"overflow-x-auto",children:(0,p.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,p.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,p.jsx)("tr",{children:Ge.map((e=>{const t=be.find((t=>t.id===e));if(!t)return null;if("requestedByResponsible"===e)return(0,p.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-move relative",draggable:!0,onDragStart:()=>Oe(e),onDragOver:t=>We(t,e),onDrop:t=>Ue(t,e),onDragEnd:Ie,children:(0,p.jsxs)("div",{className:`flex items-center ${Se===e?"border-l-2 pl-1 border-blue-500":""} ${Ne===e?"opacity-50":""}`,children:[(0,p.jsx)(E.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,p.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,p.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel})]})},e);let r;return"title"===e&&(r="title"),"status"===e&&(r="status"),"branch"===e&&(r="branch.name"),"dueDate"===e&&(r="dueDate"),(0,p.jsx)("th",{className:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider relative ${r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""} ${"actions"!==e?"cursor-move":""}`,onClick:r?()=>{return e=r,void ie((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})));var e}:void 0,draggable:"actions"!==e,onDragStart:"actions"!==e?()=>Oe(e):void 0,onDragOver:"actions"!==e?t=>We(t,e):void 0,onDrop:"actions"!==e?t=>Ue(t,e):void 0,onDragEnd:"actions"!==e?Ie:void 0,children:(0,p.jsxs)("div",{className:`flex items-center ${Se===e?"border-l-2 pl-1 border-blue-500":""} ${Ne===e?"opacity-50":""}`,children:["actions"!==e&&(0,p.jsx)(E.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,p.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,p.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel}),r&&ne.key===r&&("asc"===ne.direction?"\u2191":"\u2193")]})},e)}))})}),(0,p.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===Ve.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:Ge.length,className:"px-3 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,p.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,p.jsx)(R.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,p.jsx)("div",{className:"text-sm",children:"Keine Requests gefunden"})]})})}):(0,p.jsx)(p.Fragment,{children:Ve.slice(0,Ae).map((t=>{const r=(0,z.go)(t.dueDate,"request"),s=(0,z.F2)(r);return(0,p.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 "+("none"!==r?`${s.bgClass} ${s.borderClass} border-l-4`:""),children:Ge.map((r=>{switch(r){case"title":return(0,p.jsx)("td",{className:"px-6 py-4",children:(0,p.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,p.jsxs)("div",{className:"ml-2 relative group",children:[(0,p.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:e("common.description"),children:(0,p.jsx)(D.A,{className:"h-5 w-5"})}),(0,p.jsx)("div",{className:"hidden group-hover:block absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10",children:(0,p.jsx)(h.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,p.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,p.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${(0,q.qY)(t.status,"request")} dark:bg-opacity-30 status-col`,children:(s=t.status,(0,q.Iw)(s,"request",e))})},r);case"requestedByResponsible":return(0,p.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,p.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.requestedBy"),":"]}),(0,p.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.requestedBy").substring(0,5),":"]}),(0,p.jsx)("br",{}),`${t.requestedBy.firstName} ${t.requestedBy.lastName}`]}),(0,p.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,p.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.responsible"),":"]}),(0,p.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.responsible").substring(0,4),":"]}),(0,p.jsx)("br",{}),`${t.responsible.firstName} ${t.responsible.lastName}`]})]})},r);case"branch":return(0,p.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,p.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const a=(0,z.go)(t.dueDate,"request"),l=(0,z.F2)(a);return(0,p.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,p.jsxs)("div",{className:`text-sm ${"none"!==a?l.textClass:"text-gray-900 dark:text-gray-200"}`,children:[new Date(t.dueDate).toLocaleDateString(),"none"!==a&&(0,p.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,p.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,p.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,p.jsxs)("div",{className:"status-buttons",children:["approval"===t.status&&he("requests","write","table")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{onClick:()=>Fe(t.id,"approved"),className:"p-1 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",title:e("requests.actions.approve"),children:(0,p.jsx)(g.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{onClick:()=>Fe(t.id,"to_improve"),className:"p-1 bg-orange-600 dark:bg-orange-500 text-white rounded hover:bg-orange-700 dark:hover:bg-orange-600",title:e("requests.actions.improve"),children:(0,p.jsx)($.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{onClick:()=>Fe(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("requests.actions.deny"),children:(0,p.jsx)(m.A,{className:"h-5 w-5"})})]}),"to_improve"===t.status&&he("requests","write","table")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{onClick:()=>Fe(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",title:e("requests.actions.recheck"),children:(0,p.jsx)(x.A,{className:"h-5 w-5"})}),(0,p.jsx)("button",{onClick:()=>Fe(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",title:e("requests.actions.deny"),children:(0,p.jsx)(m.A,{className:"h-5 w-5"})})]}),("approved"===t.status||"denied"===t.status)&&he("requests","write","table")&&(0,p.jsx)("button",{onClick:()=>Fe(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",title:e("requests.actions.recheck"),children:(0,p.jsx)(x.A,{className:"h-5 w-5"})})]}),he("requests","write","table")&&(0,p.jsx)("button",{onClick:()=>{xe(t),ue(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 edit-button ml-0.5",children:(0,p.jsx)(_.A,{className:"h-5 w-5"})}),he("requests","both","table")&&(0,p.jsx)("button",{onClick:()=>Qe(t),className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300 copy-button ml-0.5",title:e("requests.actions.copy"),children:(0,p.jsx)(L.A,{className:"h-5 w-5"})})]})},r);default:return null}var s}))},t.id)}))})})]})}):(0,p.jsx)("div",{className:"-mx-6",children:0===Ve.length?(0,p.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,p.jsx)(R.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,p.jsx)("div",{className:"text-sm",children:e("requests.createRequest.noRequestsFound")})]}):(0,p.jsx)(I.A,{children:Ve.slice(0,Ae).map((t=>{const r=[];if(Le.has("branch")&&r.push({icon:(0,p.jsx)(B.A,{className:"h-4 w-4"}),label:e("requests.columns.branch"),value:t.branch.name,section:"left"}),Le.has("requestedBy")&&r.push({icon:(0,p.jsx)(F.A,{className:"h-4 w-4"}),label:e("requests.columns.requestedBy"),value:`${t.requestedBy.firstName} ${t.requestedBy.lastName}`,section:"main"}),Le.has("responsible")&&r.push({icon:(0,p.jsx)(F.A,{className:"h-4 w-4"}),label:e("requests.columns.responsible"),value:`${t.responsible.firstName} ${t.responsible.lastName}`,section:"main-second"}),Le.has("dueDate")){const s=(0,z.Rj)(t.dueDate,"request",void 0,void 0,(0,p.jsx)(M.A,{className:"h-4 w-4"}),e("requests.columns.dueDate"),(e=>(0,O.GP)(e,"dd.MM.yyyy",{locale:W.de})),!1);r.push({...s,section:"right-inline"})}Le.has("description")&&t.description&&r.push({label:e("common.description"),value:"",descriptionContent:t.description,section:"full"});const s=(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:["approval"===t.status&&he("requests","write","table")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"approved")},className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700",title:e("requests.actions.approve"),children:(0,p.jsx)(g.A,{className:"h-4 w-4"})}),(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"to_improve")},className:"p-1.5 bg-orange-600 text-white rounded hover:bg-orange-700",title:e("requests.actions.improve"),children:(0,p.jsx)($.A,{className:"h-4 w-4"})}),(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:e("requests.actions.deny"),children:(0,p.jsx)(m.A,{className:"h-4 w-4"})})]}),"to_improve"===t.status&&he("requests","write","table")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",title:e("requests.actions.recheck"),children:(0,p.jsx)(x.A,{className:"h-4 w-4"})}),(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:e("requests.actions.deny"),children:(0,p.jsx)(m.A,{className:"h-4 w-4"})})]}),("approved"===t.status||"denied"===t.status)&&he("requests","write","table")&&(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Fe(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",title:e("requests.actions.recheck"),children:(0,p.jsx)(x.A,{className:"h-4 w-4"})}),he("requests","write","table")&&(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),xe(t),ue(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:e("common.edit"),children:(0,p.jsx)(_.A,{className:"h-4 w-4"})}),he("requests","both","table")&&(0,p.jsx)("button",{onClick:e=>{e.stopPropagation(),Qe(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:e("requests.actions.copy"),children:(0,p.jsx)(L.A,{className:"h-4 w-4"})})]}),a=(e=>{switch(e){case"to_improve":case"approved":case"denied":return"approval";default:return null}})(t.status),l=(e=>{switch(e){case"approval":return["approved","to_improve","denied"];case"to_improve":return["denied"];default:return[]}})(t.status),n=l.length>0?l[0]:null;return(0,p.jsx)(U.A,{title:t.title,status:{label:(0,q.Iw)(t.status,"request",e),color:(0,q.qY)(t.status,"request"),onPreviousClick:a&&he("requests","write","table")?()=>Fe(t.id,a):void 0,onNextClick:n&&he("requests","write","table")?()=>Fe(t.id,n):void 0},metadata:r,actions:s},t.id)}))})}),Ve.length>Ae&&(0,p.jsx)("div",{className:"mt-4 flex justify-center",children:(0,p.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-700 border border-blue-300 dark:border-gray-600 rounded-md hover:bg-blue-50 dark:hover:bg-gray-600",onClick:()=>Ce((e=>e+10)),children:[e("common.showMore")," (",Ve.length-Ae," ",e("common.remaining"),")"]})})]})]})};var K=r(3836),Y=r(2750),Z=r(1620),J=r(3315),X=r(8416),ee=r(8658),te=r(1713);const re=(e,t)=>{const[r,s,a]=e.split("-").map((e=>parseInt(e))),l=new Date(r,s-1,a,12,0,0);return l.setDate(l.getDate()+t),(0,O.GP)(l,"yyyy-MM-dd")},se=()=>{var e;const{t:t}=(0,a.Bd)(),{user:r}=(0,i.As)(),[l,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[g,h]=(0,s.useState)(8),b=new Date,f=`${(0,K.C)(b)}-W${String((0,Y.N)(b,{locale:W.de})).padStart(2,"0")}`,[y,v]=(0,s.useState)(f),w=(0,Z.k)(b,{weekStartsOn:1}),[k,j]=(0,s.useState)((0,O.GP)(w,"yyyy-MM-dd")),[N,q]=(0,s.useState)(!1),[S,R]=(0,s.useState)("");(0,s.useEffect)((()=>{A()}),[k,r]);const A=async()=>{try{localStorage.getItem("token");const e=k,r=(await n.A.get(`${c.Sn.WORKTIME.STATS}?week=${e}`)).data;if(r&&r.weeklyData){const e={Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7,[t("worktime.days.monday")]:1,[t("worktime.days.tuesday")]:2,[t("worktime.days.wednesday")]:3,[t("worktime.days.thursday")]:4,[t("worktime.days.friday")]:5,[t("worktime.days.saturday")]:6,[t("worktime.days.sunday")]:7},s=[k,re(k,1),re(k,2),re(k,3),re(k,4),re(k,5),re(k,6)],a={...r,weeklyData:r.weeklyData.map((t=>{const r=e[t.day];if(void 0===r)return console.error(`Unbekannter Wochentag: ${t.day}`),t;const a=s[r-1];return{...t,date:a}}))};o(a)}else o(r);x(null)}catch(s){var e,r;console.error("Fehler beim Abrufen der Statistikdaten:",s),x((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Fehler beim Laden der Daten")}finally{u(!1)}};if((0,s.useEffect)((()=>{if(!d&&l&&l.weeklyData){const e=l.weeklyData.reduce(((e,t)=>{const r="number"===typeof t.hours?t.hours:parseFloat(t.hours);return r>e?r:e}),0);h(e)}}),[d,l]),d)return(0,p.jsx)("div",{className:"p-4",children:t("common.loading")});if(m)return(0,p.jsx)("div",{className:"p-4 text-red-600",children:m});if(!l)return null;(0,te._2)(k);const C=Math.max(8,Math.ceil(1.1*g)),T=null!==(e=null===r||void 0===r?void 0:r.normalWorkingHours)&&void 0!==e?e:7.6;return(0,p.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,p.jsxs)("div",{className:"flex items-center pl-2 sm:pl-0",children:[(0,p.jsx)(J.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,p.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:t("worktime.stats.title")})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,p.jsx)("input",{type:"week",value:y,onChange:e=>{const t=e.target.value;if(!t)return;v(t);const r=(0,te.pg)(t);j(r)},max:f,className:"border border-gray-300 dark:border-gray-600 rounded-md text-base sm:text-sm h-8 sm:h-10 px-3 dark:bg-gray-700 dark:text-white"}),(0,p.jsx)("button",{onClick:async()=>{try{localStorage.getItem("token");const e=await n.A.get(`${c.Sn.WORKTIME.BASE}/export?week=${k}`,{responseType:"blob"}),r=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=t("worktime.stats.exportFilename",{week:y.split("W")[1]}),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a)}catch(m){console.error("Fehler beim Exportieren:",m),x(t("worktime.stats.export")+": "+t("common.error"))}},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center min-w-8 min-h-8 w-8 h-8",title:t("worktime.stats.export"),"aria-label":t("worktime.stats.exportTitle"),style:{marginTop:"1px",marginBottom:"1px"},children:(0,p.jsx)(X.A,{className:"h-4 w-4"})})]})]}),(0,p.jsxs)("div",{className:"flex flex-row gap-2 mb-8 overflow-x-auto",children:[(0,p.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-blue-900 dark:text-blue-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.totalHours")}),(0,p.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap text-center",children:[l.totalHours,t("worktime.stats.hourShort")]})]}),(0,p.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-green-900 dark:text-green-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.averagePerDay")}),(0,p.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-green-600 dark:text-green-400 whitespace-nowrap text-center",children:[l.averageHoursPerDay,t("worktime.stats.hourShort")]})]}),(0,p.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-purple-900 dark:text-purple-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:t("worktime.stats.workDays")}),(0,p.jsx)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-purple-600 dark:text-purple-400 whitespace-nowrap text-center",children:l.daysWorked})]})]}),(0,p.jsxs)("div",{className:"mt-8",children:[(0,p.jsx)("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:t("worktime.stats.weeklyProgress")}),(0,p.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,p.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,p.jsxs)("span",{children:[C,"h"]}),(0,p.jsxs)("span",{children:[Math.round(.75*C),"h"]}),(0,p.jsxs)("span",{children:[Math.round(.5*C),"h"]}),(0,p.jsxs)("span",{children:[Math.round(.25*C),"h"]}),(0,p.jsx)("span",{children:"0h"})]}),(0,p.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,p.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,p.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,p.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,p.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,p.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})]}),(0,p.jsx)("div",{className:"absolute w-full border-t-2 border-red-600 dark:border-red-500 z-10 pr-8",style:{bottom:T/C*100+"%",borderStyle:"dashed"},children:(0,p.jsxs)("span",{className:"absolute -top-3 right-8 text-xs text-red-600 dark:text-red-500 font-medium",children:[t("worktime.stats.target"),": ",T,t("worktime.stats.hourShort")]})}),(0,p.jsxs)("div",{className:"absolute top-0 left-0 text-xs flex items-center gap-2",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"w-3 h-3 bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 rounded-sm mr-1"}),(0,p.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:t("worktime.stats.belowTarget",{target:T})})]}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"w-3 h-3 bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 rounded-sm mr-1"}),(0,p.jsx)("span",{className:"text-red-600 dark:text-red-400",children:t("worktime.stats.aboveTarget",{target:T})})]})]}),(0,p.jsx)("div",{className:"absolute inset-0 pr-8 flex items-end",children:(0,p.jsx)("div",{className:"w-full h-full flex justify-between",children:l.weeklyData.map(((e,r)=>{const s="number"===typeof e.hours?e.hours:parseFloat(e.hours),a=s>T?(s-T)/C*100:0,l=Math.min(s,T)/C*100,n=e.date;return(0,p.jsx)("div",{className:"flex flex-col items-center",style:{width:"13%"},children:(0,p.jsxs)("div",{className:"relative w-5/12 h-full flex flex-col justify-end cursor-pointer",onClick:()=>{var e;(e=n)?e.match(/^\d{4}-\d{2}-\d{2}$/)?(R(e),q(!0)):console.error(`Ung\xfcltiges Datum f\xfcr Modal: ${e}`):console.error("Kein Datum f\xfcr Modal angegeben")},title:t("worktime.stats.clickToView"),children:[a>0&&(0,p.jsx)("div",{className:"w-full bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 hover:bg-red-200 dark:hover:bg-red-900/70",style:{height:`${a}%`,minHeight:"2px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomWidth:a>0&&l>0?"0":"2px"}}),l>0&&(0,p.jsx)("div",{className:"w-full bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/70",style:{height:`${l}%`,minHeight:s>0?"4px":"0",borderTopLeftRadius:a>0?"0":"8px",borderTopRightRadius:a>0?"0":"8px",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px",borderTopWidth:a>0?"0":"2px"}})]})},r)}))})}),(0,p.jsx)("div",{className:"absolute bottom-0 left-0 right-8 pt-8 flex justify-between",children:l.weeklyData.map(((e,r)=>(0,p.jsxs)("div",{className:"flex flex-col items-center",style:{width:"13%"},children:[(0,p.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:(()=>{const r=e.day.toLowerCase();return r.includes("montag")||r.includes("mo")?t("worktime.days.monday"):r.includes("dienstag")||r.includes("di")?t("worktime.days.tuesday"):r.includes("mittwoch")||r.includes("mi")?t("worktime.days.wednesday"):r.includes("donnerstag")||r.includes("do")?t("worktime.days.thursday"):r.includes("freitag")||r.includes("fr")?t("worktime.days.friday"):r.includes("samstag")||r.includes("sa")?t("worktime.days.saturday"):r.includes("sonntag")||r.includes("so")?t("worktime.days.sunday"):e.day.substring(0,2)})()}),(0,p.jsxs)("div",{className:"text-sm font-medium dark:text-gray-300",children:[e.hours.toFixed(1),t("worktime.stats.hourShort")]})]},r)))})]})]}),N&&(0,p.jsx)(ee.G,{isOpen:N,onClose:()=>{q(!1)},selectedDate:S})]})};var ae=r(5475),le=r(9130),ne=r(6287);const ie=()=>{const{t:e}=(0,a.Bd)();return(0,p.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 shadow-sm",children:(0,p.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center mb-4 md:mb-0",children:[(0,p.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full mr-4",children:(0,p.jsx)(le.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:e("appDownload.title")}),(0,p.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("appDownload.description")})]})]}),(0,p.jsxs)(ae.N_,{to:"/mobile-app",className:"inline-flex items-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:[e("appDownload.download"),(0,p.jsx)(ne.A,{className:"ml-2 -mr-1 h-4 w-4"})]})]})})},oe=()=>{const{t:e}=(0,a.Bd)(),t=(0,l.Zp)(),[r,n]=(0,s.useState)(null),[i,o]=(0,s.useState)(!0);(0,s.useEffect)((()=>{localStorage.getItem("token")?(n({id:1,username:"testuser",email:"test@example.com",first_name:"Test",last_name:"User"}),o(!1)):t("/login")}),[t]);return i?(0,p.jsx)("div",{className:"flex items-center justify-center min-h-screen text-gray-700 dark:text-gray-300",children:e("common.loading")}):(0,p.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,p.jsxs)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:[(0,p.jsx)("div",{className:"py-1",children:(0,p.jsx)(se,{})}),(0,p.jsxs)("div",{className:"mt-2 sm:mt-4 md:mt-6 grid grid-cols-1 gap-4",children:[(0,p.jsx)("div",{className:"dashboard-requests-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 w-full shadow-sm",children:(0,p.jsx)("div",{children:(0,p.jsx)(G,{})})}),(0,p.jsx)("div",{className:"mt-4",children:(0,p.jsx)(ie,{})})]})]})})}},6400:(e,t,r)=>{r.d(t,{J1:()=>l,W5:()=>a});const s=(e,t)=>{const{operator:r,value:s}=t;if(null==e&&null==s)return"equals"===r;if(null==e||null==s)return"notEquals"===r;const a=String(e).toLowerCase(),l=String(s).toLowerCase();switch(r){case"equals":return a===l;case"notEquals":return a!==l;case"contains":return a.includes(l);case"startsWith":return a.startsWith(l);case"endsWith":return a.endsWith(l);case"before":case"after":{const t=new Date(e),a=new Date(s);return!isNaN(t.getTime())&&!isNaN(a.getTime())&&("before"===r?t<a:t>a)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),a=parseFloat(String(s));return!isNaN(t)&&!isNaN(a)&&("greaterThan"===r?t>a:t<a)}default:return!0}},a=(e,t,r,a,l)=>0===t.length?e:e.filter((e=>{let n=!0;for(let i=0;i<t.length;i++){const o=t[i];let d=!1;if(l&&l[o.column]){const t=l[o.column](e,o);if(null!==t)d=t;else{const t=a(e,o.column);d=s(t,o)}}else{const t=a(e,o.column);d=s(t,o)}if(0===i)n=d;else{n="AND"===(r[i-1]||"AND")?n&&d:n||d}}return n})),l=(e,t)=>{if(!e)return!1;const r=new Date(e);if(isNaN(r.getTime()))return!1;const s=new Date(t.value);if(isNaN(s.getTime()))return!1;switch(t.operator){case"equals":return r.toDateString()===s.toDateString();case"before":return r<s;case"after":return r>s;default:return!0}}},8658:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(5043),a=r(1923),l=r(1801),n=r(1713),i=r(579);const o=e=>{var t;let{isOpen:r,onClose:o,selectedDate:d}=e;const c=new Date,u=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")}`,[m,x]=(0,s.useState)([]),[g,h]=(0,s.useState)(d||u),[b,p]=(0,s.useState)(!0),[f,y]=(0,s.useState)("0h 0m"),[v,w]=(0,s.useState)(null),[k,j]=(0,s.useState)(null),N=()=>{if(!v)return!1;try{return v.startTime.split("T")[0]===g}catch(k){return console.error("Fehler beim Pr\xfcfen der Relevanz der aktiven Zeiterfassung:",k),!1}},q=(0,s.useCallback)((async()=>{try{j(null),p(!0);if(!localStorage.getItem("token"))return j("Nicht authentifiziert"),void p(!1);const e=g,t=[...(await a.A.get(`${l.Sn.WORKTIME.BASE}?date=${e}`)).data].sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime()));x(t);const r=await a.A.get(l.Sn.WORKTIME.ACTIVE);r.data&&Object.keys(r.data).length>0?w(r.data):w(null),p(!1)}catch(k){console.error("Fehler beim Laden der Zeiterfassungen:",k),j("Fehler beim Laden der Zeiterfassungen"),p(!1)}}),[g]);if((0,s.useEffect)((()=>{r&&q()}),[r,q]),(0,s.useEffect)((()=>{let e=0;if(m.filter((e=>(0,n.uT)(e,g))).forEach((t=>{if(t.endTime)try{const r=new Date(t.startTime),s=new Date(t.endTime).getTime()-r.getTime();if(s>0){const t=Math.floor(s/6e4);e+=t}}catch(k){console.error("Fehler bei der Berechnung:",k)}})),v&&N())try{const t=new Date(`${v.startTime.split("Z")[0]}`),r=(new Date).getTime()-t.getTime();if(r>0){const t=Math.floor(r/6e4);e+=t}}catch(k){console.error("Fehler bei der Berechnung der aktiven Zeiterfassung:",k)}const t=Math.floor(e/60);y(`${t}h ${e%60}m`)}),[m,v,g]),!r)return null;const S=m.filter((e=>(0,n.uT)(e,g)));return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,i.jsxs)("div",{className:"p-4 border-b dark:border-gray-700 flex items-center justify-between",children:[(0,i.jsxs)("h2",{className:"text-xl font-semibold dark:text-white",children:["Zeiteintr\xe4ge f\xfcr ",(0,n.Yq)(g)]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("input",{type:"date",value:g,onChange:e=>{h(e.target.value)},className:"border dark:border-gray-600 rounded-md px-3 py-2 dark:bg-gray-700 dark:text-white"}),(0,i.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"\u2715"})]})]}),(0,i.jsx)("div",{className:"overflow-y-auto flex-grow",children:b?(0,i.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-300"})}):0===m.filter((e=>(0,n.uT)(e,g)&&(null!==e.endTime||N()))).length?(0,i.jsx)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Keine Zeiteintr\xe4ge f\xfcr diesen Tag gefunden."}):(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,i.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Start"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Ende"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Dauer"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Niederlassung"})]})}),(0,i.jsxs)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[S.filter((e=>null!==e.endTime)).sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime())).map((e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.fU)(e.startTime)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.endTime?(0,n.fU)(e.endTime):"-"}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.P0)(e.startTime,e.endTime)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:e.branch.name})]},e.id))),N()&&(0,i.jsxs)("tr",{className:"bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,n.fU)(v.startTime)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(0,i.jsx)("span",{className:"italic",children:"Aktiv"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200 font-medium text-green-600 dark:text-green-400",children:(()=>{if(!v)return"-";const e=v.startTime.endsWith("Z")?v.startTime.substring(0,v.startTime.length-1):v.startTime,t=new Date(e),r=(new Date).getTime()-t.getTime(),s=Math.floor(r/6e4);return`${Math.floor(s/60)}h ${s%60}m (l\xe4uft)`})()}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200",children:(null===(t=v.branch)||void 0===t?void 0:t.name)||"Unbekannt"})]})]}),(0,i.jsx)("tfoot",{className:"bg-gray-100 dark:bg-gray-700",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{colSpan:2,className:"px-6 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300",children:"Gesamtdauer des Tages:"}),(0,i.jsx)("td",{className:"px-6 py-3 text-left text-sm font-bold text-gray-900 dark:text-white",children:f}),(0,i.jsx)("td",{})]})})]})})]})})}}}]);
//# sourceMappingURL=786.5a958113.chunk.js.map