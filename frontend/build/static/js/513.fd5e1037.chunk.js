"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[513],{1713:(e,t,r)=>{r.d(t,{DW:()=>N,I5:()=>g,IF:()=>f,M9:()=>b,P0:()=>u,Pg:()=>j,VY:()=>p,Yq:()=>d,_2:()=>h,c$:()=>v,fU:()=>c,h4:()=>w,lK:()=>y,pg:()=>m,uT:()=>x,vv:()=>k});var a=r(4653),s=r(2415),n=r(1620),l=r(6981),o=r(887),i=r(8018);const d=e=>{if(!e)return"-";try{const t=e.split("-");if(3!==t.length)return"-";const r=parseInt(t[0]),a=parseInt(t[1])-1,s=parseInt(t[2]);return new Date(r,a,s,12,0,0).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Fehler beim Formatieren des Datums:",t),"-"}},c=e=>{if(!e)return"-";try{const t=(0,a.H)(e),r=t.getUTCHours().toString().padStart(2,"0"),s=t.getUTCMinutes().toString().padStart(2,"0");return"".concat(r,":").concat(s)}catch(t){return console.error("Fehler beim Formatieren der Zeit f\xfcr ".concat(e,":"),t),"-"}},u=(e,t)=>{if(!e||!t)return"-";try{const r=e.endsWith("Z")?e.substring(0,e.length-1):e,a=t.endsWith("Z")?t.substring(0,t.length-1):t,s=new Date(r),n=new Date(a).getTime()-s.getTime(),l=Math.floor(n/6e4),o=Math.floor(l/60),i=l%60;return"".concat(o,"h ").concat(i,"m")}catch(r){return console.error("Fehler bei der Dauerberechnung:",r),"-"}},m=e=>{try{const t=parseInt(e.substring(0,4)),r=parseInt(e.substring(6)),a=new Date(Date.UTC(t,0,1,12,0,0)).getUTCDay(),l=a<=4?4-a:11-a,d=new Date(Date.UTC(t,0,1+l,12,0,0)),c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()+7*(r-1),12,0,0)),u=new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()-3,12,0,0)),m=(0,s.GP)(u,"yyyy-MM-dd");if(i.v.log("Konvertierte Woche ".concat(e," zu Datum: ").concat(m," (Wochentag: ").concat((0,s.GP)(u,"EEEE",{locale:o.de}),")")),"Montag"!==(0,s.GP)(u,"EEEE",{locale:o.de})){console.warn("Berechnetes Datum ist kein Montag! Korrigiere...");const e=(0,n.k)(u,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}return m}catch(t){console.error("Fehler beim Konvertieren des Wochendatums:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},x=(e,t)=>{try{if(!e||!e.startTime)return!1;return e.startTime.split("T")[0]===t}catch(r){return console.error("Fehler beim Pr\xfcfen der Relevanz eines Worktime-Eintrags:",r),!1}},h=e=>{if(!e)return[];const t=new Date(e),r=[];for(let a=0;a<7;a++){const e=(0,l.f)(t,a),n={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};r.push(n)}return r},g=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Fehler beim Formatieren des Datums und der Zeit:",t),"-"}},b=e=>{try{let t,r,a;if(!e.includes("-Q"))throw new Error("Ung\xfcltiges Quinzena-Format");{const s=e.split("-Q"),n=s[0];if(a=parseInt(s[1]),n.includes("-")){const e=n.split("-");t=parseInt(e[0]),r=parseInt(e[1])}else t=parseInt(n),r=Math.ceil(a/2)}const n=1===a?1:16,l=new Date(Date.UTC(t,r-1,n,12,0,0));return(0,s.GP)(l,"yyyy-MM-dd")}catch(t){console.error("Fehler beim Konvertieren der Quinzena:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},y=e=>{if(!e)return[];const t=new Date(e),r=t.getFullYear(),a=t.getMonth();let n;if(1===t.getDate())n=15;else{n=new Date(r,a+1,0).getDate()-15}const i=[];for(let d=0;d<n;d++){const e=(0,l.f)(t,d),r={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};i.push(r)}return i},p=()=>{const e=new Date;return(e=>{try{const t=new Date(e+"T12:00:00"),r=t.getFullYear(),a=t.getMonth()+1,s=t.getDate()<=15?1:2;return"".concat(r,"-").concat(String(a).padStart(2,"0"),"-Q").concat(s)}catch(t){console.error("Fehler beim Berechnen der Quinzena:",t);const e=new Date,r=e.getFullYear(),a=e.getMonth()+1;return"".concat(r,"-").concat(String(a).padStart(2,"0"),"-Q1")}})((0,s.GP)(e,"yyyy-MM-dd"))},f=e=>{const t=new Date(e);return new Date(t.getTime()+6e4*t.getTimezoneOffset())},v=e=>{try{const t=e.reduce(((e,t)=>{if(!t.endTime)return e;const r=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,a=t.endTime.endsWith("Z")?t.endTime.substring(0,t.endTime.length-1):t.endTime,s=new Date(r),n=new Date(a).getTime()-s.getTime();return e+Math.floor(n/6e4)}),0),r=Math.floor(t/60),a=t%60;return"".concat(r,"h ").concat(a,"m")}catch(t){return console.error("Fehler bei der Formatierung der Gesamtdauer:",t),"0h 0m"}},k=e=>!!(e.invoiceItems&&e.invoiceItems.length>0),w=e=>{if(!e.invoiceItems||0===e.invoiceItems.length)return null;return e.invoiceItems[0].invoice},j=e=>({DRAFT:"Entwurf",SENT:"Gesendet",PAID:"Bezahlt",OVERDUE:"\xdcberf\xe4llig",CANCELLED:"Storniert"}[e]||e),N=e=>({DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",SENT:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",CANCELLED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}[e]||"bg-gray-100 text-gray-800")},6400:(e,t,r)=>{r.d(t,{Ac:()=>m,J1:()=>u,W5:()=>c});var a=r(1620),s=r(8605),n=r(4912),l=r(3695),o=r(8621),i=r(7744);const d=(e,t)=>{const{operator:r,value:a}=t;if(void 0===a)return console.error("evaluateCondition: value ist undefined",t),!1;if(null==e&&null==a)return"equals"===r;if(null==e||null==a)return"notEquals"===r;let s="",n="";try{const t=null==e?"":"string"===typeof e?e:String(e);if("string"!==typeof t)return!1;const r=t.toLowerCase();if(void 0===r||null===r||"string"!==typeof r)return!1;s=r;const l=null==a?"":"string"===typeof a?a:String(a);if("string"!==typeof l)return!1;const o=l.toLowerCase();if(void 0===o||null===o||"string"!==typeof o)return!1;n=o}catch(l){return!1}if("string"!==typeof s||"string"!==typeof n||void 0===s||void 0===n||null===s||null===n)return!1;switch(r){case"equals":return s===n;case"notEquals":return s!==n;case"contains":return s.includes(n);case"startsWith":return s.startsWith(n);case"endsWith":if(void 0===s||null===s)return console.error("endsWith: strField ist undefined/null",{strField:s,strValue:n,fieldValue:e,value:a,condition:t}),!1;if(void 0===n||null===n)return console.error("endsWith: strValue ist undefined/null",{strField:s,strValue:n,fieldValue:e,value:a,condition:t}),!1;if("string"!==typeof s)return console.error("endsWith: strField ist kein String",{strField:s,typeof:typeof s,strValue:n,fieldValue:e,value:a,condition:t}),!1;if("string"!==typeof n)return console.error("endsWith: strValue ist kein String",{strField:s,strValue:n,typeof:typeof n,fieldValue:e,value:a,condition:t}),!1;try{return s.endsWith(n)}catch(l){return console.error("endsWith: Fehler bei endsWith-Aufruf",l,{strField:s,strValue:n,fieldValue:e,value:a,condition:t}),!1}case"before":case"after":{const t=new Date(e),s=new Date(a);return!isNaN(t.getTime())&&!isNaN(s.getTime())&&("before"===r?t<s:t>s)}case"greaterThan":case"lessThan":{const t=parseFloat(String(e)),s=parseFloat(String(a));return!isNaN(t)&&!isNaN(s)&&("greaterThan"===r?t>s:t<s)}default:return!0}},c=(e,t,r,a,s)=>0===t.length?e:e.filter((e=>{let n=!0;for(let l=0;l<t.length;l++){const o=t[l];let i=!1;if(s&&s[o.column]){const t=s[o.column](e,o);if(null!==t)i=t;else{const t=a(e,o.column);i=d(t,o)}}else{const t=a(e,o.column);i=d(t,o)}if(0===l)n=i;else{n="AND"===(r[l-1]||"AND")?n&&i:n||i}}return n})),u=(e,t)=>{if(!e)return!1;const r=new Date(e);if(isNaN(r.getTime()))return!1;const d=r.getUTCFullYear(),c=r.getUTCMonth(),u=r.getUTCDate(),m=new Date(d,c,u);try{if("__THIS_WEEK__"===t.value){if("equals"===t.operator){const e=(0,a.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const t=(0,s.$)(new Date,{weekStartsOn:1});return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,a.k)(new Date,{weekStartsOn:1});e.setHours(0,0,0,0);const r=(0,s.$)(new Date,{weekStartsOn:1});return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}if("__THIS_MONTH__"===t.value){if("equals"===t.operator){const e=(0,n.w)(new Date);e.setHours(0,0,0,0);const t=(0,l.p)(new Date);return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,n.w)(new Date);e.setHours(0,0,0,0);const r=(0,l.p)(new Date);return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}if("__THIS_YEAR__"===t.value){if("equals"===t.operator){const e=(0,o.D)(new Date);e.setHours(0,0,0,0);const t=(0,i.Q)(new Date);return t.setHours(23,59,59,999),m>=e&&m<=t}const e=(0,o.D)(new Date);e.setHours(0,0,0,0);const r=(0,i.Q)(new Date);return r.setHours(23,59,59,999),"before"===t.operator?m<r:"after"===t.operator&&m>e}let e;if("__TODAY__"===t.value){const t=new Date;t.setHours(0,0,0,0),e=t}else if("__WEEK_START__"===t.value){const t=(0,a.k)(new Date,{weekStartsOn:1});t.setHours(0,0,0,0),e=t}else if("__WEEK_END__"===t.value){const t=(0,s.$)(new Date,{weekStartsOn:1});t.setHours(23,59,59,999),e=t}else if("__MONTH_START__"===t.value){const t=(0,n.w)(new Date);t.setHours(0,0,0,0),e=t}else if("__MONTH_END__"===t.value){const t=(0,l.p)(new Date);t.setHours(23,59,59,999),e=t}else if("__YEAR_START__"===t.value){const t=(0,o.D)(new Date);t.setHours(0,0,0,0),e=t}else if("__YEAR_END__"===t.value){const t=(0,i.Q)(new Date);t.setHours(23,59,59,999),e=t}else{const r=new Date(t.value);if(isNaN(r.getTime()))return!1;const a=r.getUTCFullYear(),s=r.getUTCMonth(),n=r.getUTCDate();e=new Date(a,s,n)}switch(t.operator){case"equals":return m.getTime()===e.getTime();case"before":return m<e;case"after":return m>e;default:return!0}}catch(x){return console.error("[evaluateDateCondition] Error with placeholder ".concat(t.value,":"),x),!1}},m=(e,t,r,a)=>{const s=r.value||"";if(s.startsWith("user-")){const t=parseInt(s.replace("user-",""),10);if(isNaN(t))return!1;const a=e===t;return"notEquals"===r.operator?!a:a}if(s.startsWith("role-")){const e=parseInt(s.replace("role-",""),10);if(isNaN(e))return!1;const a=t===e;return"notEquals"===r.operator?!a:a}if(""===s)return!0;if(void 0!==a){const e=a.toLowerCase(),t=s.toLowerCase();if("equals"===r.operator)return e===t;if("notEquals"===r.operator)return e!==t;if("contains"===r.operator)return e.includes(t)}return!1}},8513:(e,t,r)=>{r.r(t),r.d(t,{default:()=>se});var a=r(5043),s=r(4117),n=r(3800),l=r(7504),o=r(7012),i=r(2302),d=r(8662),c=r(8552),u=r(9422),m=r(1801),x=r(1923),h=r(1713),g=r(2672),b=r(8018),y=r(7952),p=r(568),f=r(7488),v=r(6443),k=r(7591),w=r(7449),j=r(2811),N=r(9248);const S=async e=>{try{return(await x.A.delete(m.Sn.CLIENTS.BY_ID(e))).data}catch(t){throw console.error("Fehler beim L\xf6schen des Clients:",t),t}},C=async()=>{try{return(await x.A.get(m.Sn.CLIENTS.RECENT)).data}catch(e){throw console.error("Fehler beim Laden der zuletzt beratenen Clients:",e),e}};var T=r(9379),A=r(1816),E=r(7855),D=r(5657),F=r(579);const _=e=>{let{isOpen:t,onClose:r,onClientUpdated:n,onClientDeleted:l,client:o}=e;const{t:i}=(0,s.Bd)(),{showMessage:d}=(0,E.A)(),{openSidepane:c,closeSidepane:h}=(0,D.N)(),[g,b]=(0,a.useState)(window.innerWidth>1070),[y,p]=(0,a.useState)({name:"",company:"",email:"",phone:"",address:"",notes:"",isActive:!0}),[f,w]=(0,a.useState)({}),[j,C]=(0,a.useState)(!1),[_,R]=(0,a.useState)(!1),[I,L]=(0,a.useState)(window.innerWidth<640);(0,a.useEffect)((()=>{t&&o&&(p({name:o.name||"",company:o.company||"",email:o.email||"",phone:o.phone||"",address:o.address||"",notes:o.notes||"",isActive:void 0===o.isActive||o.isActive}),R(!1),w({}))}),[t,o]),(0,a.useEffect)((()=>{const e=()=>{L(window.innerWidth<640),b(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?c():h(),()=>{h()})),[t,c,h]);const O=async e=>{if(e.preventDefault(),(()=>{const e={};return y.name.trim()||(e.name="Name ist erforderlich"),y.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),w(e),0===Object.keys(e).length})()&&o)try{C(!0);const e=await(async(e,t)=>{try{return(await x.A.put(m.Sn.CLIENTS.BY_ID(e),t)).data}catch(r){throw console.error("Fehler beim Aktualisieren des Clients:",r),r}})(o.id,{name:y.name,company:y.company||void 0,email:y.email||void 0,phone:y.phone||void 0,address:y.address||void 0,notes:y.notes||void 0,isActive:y.isActive});d(i("client.updateSuccess",{defaultValue:"Client erfolgreich aktualisiert"}),"success"),null===n||void 0===n||n(e)}catch(a){var t,r;d((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||i("client.updateError",{defaultValue:"Fehler beim Aktualisieren des Clients"}),"error")}finally{C(!1)}},M=async()=>{if(_){if(o)try{C(!0),await S(o.id),d(i("client.deleteSuccess",{defaultValue:"Client erfolgreich gel\xf6scht"}),"success"),null===l||void 0===l||l(o.id),r()}catch(m){var e,t,a,s,n,c,u;const r=(null===(e=m.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||i("client.deleteError",{defaultValue:"Fehler beim L\xf6schen des Clients"}),l=null===(a=m.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.details,o=null===(n=m.response)||void 0===n||null===(c=n.data)||void 0===c?void 0:c.suggestion;if(409===(null===(u=m.response)||void 0===u?void 0:u.status)&&l){const e=Object.entries(l).filter((e=>{let[t,r]=e;return r>0})).map((e=>{let[t,r]=e;const a="workTimes"===t?"client.workTimes":"consultationInvoices"===t?"client.consultationInvoices":"client.monthlyReports";return"".concat(r," ").concat(i(a,{defaultValue:"workTimes"===t?"Zeiteintr\xe4ge":"consultationInvoices"===t?"Rechnungen":"Monatsberichte"}))})).join(", ");d("".concat(r,". ").concat(i("client.links",{defaultValue:"Verkn\xfcpfungen"}),": ").concat(e,". ").concat(o||""),"error")}else d(r,"error");R(!1)}finally{C(!1)}}else R(!0)},B=e=>{const{name:t,value:r,type:a}=e.target,s=e.target.checked;p((e=>(0,T.A)((0,T.A)({},e),{},{[t]:"checkbox"===a?s:r}))),f[t]&&w((e=>(0,T.A)((0,T.A)({},e),{},{[t]:""})))},P=()=>{R(!1),w({}),r()};return o?I?(0,F.jsxs)(v.lG,{open:t,onClose:P,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(v.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(v.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,F.jsx)("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:O,className:"p-4",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,F.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:y.name,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,F.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:y.company,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,F.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:y.email,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.email&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.email})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,F.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:y.phone,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,F.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:y.address,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,F.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:y.notes,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",id:"isActive_mobile",name:"isActive",checked:y.isActive,onChange:B,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,F.jsx)("label",{htmlFor:"isActive_mobile",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]})]}),(0,F.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,F.jsxs)("button",{type:"button",onClick:M,disabled:j,className:"inline-flex items-center px-4 py-2 border ".concat(_?"border-red-300 text-red-700 bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-red-900/20":"border-red-300 text-red-700 bg-white hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-gray-700 dark:hover:bg-gray-600"," text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,F.jsx)(N.A,{className:"h-5 w-5 mr-2"}),_?"Wirklich l\xf6schen?":"L\xf6schen"]}),(0,F.jsxs)("div",{className:"flex space-x-3",children:[(0,F.jsx)("button",{type:"button",onClick:P,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:j?"Speichere...":"Speichern",children:j?(0,F.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(u.A,{className:"h-5 w-5"})})]})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!g&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:P,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,F.jsx)("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(f).length>0&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(f).map(((e,t)=>(0,F.jsx)("p",{children:e},t)))}),(0,F.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,F.jsx)("input",{type:"text",id:"name",name:"name",value:y.name,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,F.jsx)("input",{type:"text",id:"company",name:"company",value:y.company,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,F.jsx)("input",{type:"email",id:"email",name:"email",value:y.email,onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(f.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),f.email&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.email})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,F.jsx)("input",{type:"tel",id:"phone",name:"phone",value:y.phone,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,F.jsx)("input",{type:"text",id:"address",name:"address",value:y.address,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,F.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:y.notes,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",id:"isActive",name:"isActive",checked:y.isActive,onChange:B,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,F.jsx)("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]}),(0,F.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,F.jsx)("button",{type:"button",onClick:M,disabled:j,className:"p-2 rounded-md ".concat(_?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"," disabled:opacity-50 disabled:cursor-not-allowed"),title:_?"L\xf6schen best\xe4tigen":"Client l\xf6schen",children:_?(0,F.jsx)(u.A,{className:"h-5 w-5"}):(0,F.jsx)(N.A,{className:"h-5 w-5"})}),(0,F.jsxs)("div",{className:"flex gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:P,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:j,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:j?"Speichere...":"Speichern",children:j?(0,F.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(u.A,{className:"h-5 w-5"})})]})]})]})]})]})]}):null},R=e=>{let{isOpen:t,onClose:r,onSelect:n,onCreateNew:l}=e;const{t:o}=(0,s.Bd)(),[i,c]=(0,a.useState)([]),[u,h]=(0,a.useState)([]),[g,b]=(0,a.useState)(""),[y,p]=(0,a.useState)(!0),[C,T]=(0,a.useState)(null),[A,E]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t&&D()}),[t]),(0,a.useEffect)((()=>{if(g){const e=i.filter((e=>e.name.toLowerCase().includes(g.toLowerCase())||e.company&&e.company.toLowerCase().includes(g.toLowerCase())||e.email&&e.email.toLowerCase().includes(g.toLowerCase())));h(e)}else h(i)}),[g,i]);const D=async()=>{try{p(!0);const e=await x.A.get(m.Sn.CLIENTS.BASE);c(e.data),h(e.data)}catch(e){}finally{p(!1)}};return(0,F.jsxs)(v.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(v.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,F.jsxs)("div",{className:"p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)(v.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Client ausw\xe4hlen"}),(0,F.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"relative mb-4",children:[(0,F.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,F.jsx)(w.A,{className:"h-5 w-5 text-gray-400"})}),(0,F.jsx)("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Client suchen...",autoFocus:!0})]}),(0,F.jsx)("div",{className:"max-h-96 overflow-y-auto",children:y?(0,F.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"Lade Clients..."}):0===u.length?(0,F.jsxs)("div",{className:"text-center py-8",children:[(0,F.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:g?"Keine Clients gefunden":"Noch keine Clients vorhanden"}),(0,F.jsx)("button",{onClick:l,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600",title:"Neuen Client anlegen",children:(0,F.jsx)(d.A,{className:"h-5 w-5"})})]}):(0,F.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:u.map((e=>(0,F.jsx)("li",{children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("button",{onClick:()=>n(e),className:"flex-1 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-left transition-colors",children:(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),e.company&&(0,F.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.company}),e.email&&(0,F.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),(0,F.jsxs)("div",{className:"flex items-center space-x-2 px-2",children:[(0,F.jsx)("button",{onClick:t=>((e,t)=>{t.stopPropagation(),T(e),E(!0)})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:"Client bearbeiten",children:(0,F.jsx)(j.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:t=>(async(e,t)=>{if(t.stopPropagation(),window.confirm(o("client.deleteConfirm",{name:e.name})))try{await S(e.id),f.oR.success(o("client.deleteSuccess")),D()}catch(s){var r,a;f.oR.error((null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||o("client.deleteError"))}})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:o("client.deleteTitle"),children:(0,F.jsx)(N.A,{className:"h-5 w-5"})})]})]})},e.id)))})}),u.length>0&&(0,F.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,F.jsx)("button",{onClick:l,className:"w-full flex items-center justify-center p-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Neuen Client anlegen",children:(0,F.jsx)(d.A,{className:"h-5 w-5"})})})]})})}),C&&(0,F.jsx)(_,{isOpen:A,onClose:()=>{E(!1),T(null)},onClientUpdated:e=>{const t=i.findIndex((t=>t.id===e.id));if(-1!==t){const r=[...i];r[t]=e,c(r),h(r)}E(!1),T(null)},onClientDeleted:e=>{D(),E(!1),T(null)},client:C})]})},I=e=>{let{isOpen:t,onClose:r,onSave:n}=e;const{t:l}=(0,s.Bd)(),{showMessage:o}=(0,E.A)(),{openSidepane:i,closeSidepane:d}=(0,D.N)(),[c,h]=(0,a.useState)(window.innerWidth>1070),[g,b]=(0,a.useState)({name:"",company:"",email:"",phone:"",address:"",notes:""}),[y,p]=(0,a.useState)({}),[f,w]=(0,a.useState)(!1),[j,N]=(0,a.useState)(window.innerWidth<640),S=async e=>{if(e.preventDefault(),(()=>{const e={};return g.name.trim()||(e.name="Name ist erforderlich"),g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),p(e),0===Object.keys(e).length})())try{w(!0);const e=await x.A.post(m.Sn.CLIENTS.BASE,(0,T.A)((0,T.A)({},g),{},{company:g.company||null,email:g.email||null,phone:g.phone||null,address:g.address||null,notes:g.notes||null}));o(l("client.createSuccess",{defaultValue:"Client erfolgreich angelegt"}),"success"),n(e.data),b({name:"",company:"",email:"",phone:"",address:"",notes:""})}catch(a){var t,r;o((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("client.createError",{defaultValue:"Fehler beim Anlegen des Clients"}),"error")}finally{w(!1)}};(0,a.useEffect)((()=>{const e=()=>{N(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?i():d(),()=>{d()})),[t,i,d]);const C=e=>{const{name:t,value:r}=e.target;b((e=>(0,T.A)((0,T.A)({},e),{},{[t]:r}))),y[t]&&p((e=>(0,T.A)((0,T.A)({},e),{},{[t]:""})))},_=()=>{b({name:"",company:"",email:"",phone:"",address:"",notes:""}),p({}),r()};return j?(0,F.jsxs)(v.lG,{open:t,onClose:_,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(v.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,F.jsx)(v.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,F.jsx)("button",{onClick:_,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:S,className:"p-4",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,F.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:g.name,onChange:C,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,F.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:g.company,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,F.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:g.email,onChange:C,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.email&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,F.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:g.phone,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,F.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:g.address,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,F.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:g.notes,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:_,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:f,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:f?"Speichere...":"Speichern",children:f?(0,F.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(u.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,F.jsxs)(F.Fragment,{children:[t&&!c&&(0,F.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:_,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,F.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,F.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,F.jsx)("button",{onClick:_,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(y).length>0&&(0,F.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(y).map(((e,t)=>(0,F.jsx)("p",{children:e},t)))}),(0,F.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,F.jsx)("input",{type:"text",id:"name",name:"name",value:g.name,onChange:C,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.name&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.name})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,F.jsx)("input",{type:"text",id:"company",name:"company",value:g.company,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,F.jsx)("input",{type:"email",id:"email",name:"email",value:g.email,onChange:C,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(y.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),y.email&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,F.jsx)("input",{type:"tel",id:"phone",name:"phone",value:g.phone,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,F.jsx)("input",{type:"text",id:"address",name:"address",value:g.address,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,F.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:g.notes,onChange:C,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,F.jsx)("button",{type:"button",onClick:_,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:f,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:f?"Speichere...":"Speichern",children:f?(0,F.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(u.A,{className:"h-5 w-5"})})]})]})]})]})]})},L=async e=>{try{return(await x.A.post(m.Sn.CONSULTATIONS.START,e)).data}catch(t){throw console.error("Fehler beim Starten der Beratung:",t),t}},O=async e=>{try{return(await x.A.post(m.Sn.CONSULTATIONS.STOP,e)).data}catch(t){throw console.error("Fehler beim Stoppen der Beratung:",t),t}},M=async(e,t)=>{try{return(await x.A.patch(m.Sn.CONSULTATIONS.UPDATE_NOTES(e),t)).data}catch(r){throw console.error("Fehler beim Aktualisieren der Notizen:",r),r}},B=e=>"isPlaceholder"in e&&!0===e.isPlaceholder,P=e=>{var t,r;let{onConsultationChange:n,onConsultationStarted:v}=e;const{t:k}=(0,s.Bd)(),{user:w}=(0,g.As)(),{selectedBranch:j}=(0,y.O)(),[N,S]=(0,a.useState)(null),[T,A]=(0,a.useState)(!0),[E,D]=(0,a.useState)(!1),[_,P]=(0,a.useState)(!1),[U,W]=(0,a.useState)(!1),[z,V]=(0,a.useState)(null),[G,H]=(0,a.useState)([]),[Y,K]=(0,a.useState)(""),[q,Z]=(0,a.useState)(null),Q=(0,a.useRef)(null),[$,J]=(0,a.useState)(3),[X,ee]=(0,a.useState)(0),[te,re]=(0,a.useState)(!1),[ae,se]=(0,a.useState)(""),[ne,le]=(0,a.useState)("");(0,a.useEffect)((()=>{oe(),ie()}),[]);const oe=async()=>{try{const e=await x.A.get(m.Sn.WORKTIME.ACTIVE);e.data&&e.data.clientId&&(S(e.data),K(e.data.notes||""))}catch(e){}finally{A(!1)}},ie=async()=>{try{b.v.log("=== FRONTEND: loadRecentClients() called ===");const e=await C();b.v.log("=== FRONTEND: received clients:",e),H(e||[])}catch(e){console.error("=== FRONTEND: loadRecentClients() ERROR ===",e)}},de=async(e,t)=>{if(j)try{var r;D(!0);const a=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),s=await L({branchId:j,clientId:e,notes:t||"",startTime:a.toISOString()});S(s),K(t||""),V(null),P(!1),Z(e),window.dispatchEvent(new CustomEvent("consultationChanged")),ie(),null===n||void 0===n||n(s),v&&null!==(r=s.client)&&void 0!==r&&r.name&&v(s.client.name),f.oR.success(k("consultations.started"))}catch(a){console.error("Fehler beim Starten der Beratung:",a),f.oR.error(k("consultations.startError"))}finally{D(!1)}else f.oR.error(k("consultations.selectBranch"))},ce=async()=>{if(N)try{await M(N.id,{notes:Y})}catch(e){}};(0,a.useEffect)((()=>{if(!N||!Y)return;const e=setTimeout((()=>{ce()}),3e4);return()=>clearTimeout(e)}),[Y,N]),(0,a.useEffect)((()=>{const e=()=>{ie()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[]);const ue=(0,a.useMemo)((()=>0===G.length?85:G.reduce(((e,t)=>e+(6*t.name.length+24)),0)/G.length),[G]),me=(0,a.useCallback)((()=>{if(!Q.current||0===G.length)return;const e=Q.current.clientWidth;if(Math.abs(e-X)<40)return;ee(e);const t=e-32-(e<768?8:20)-12,r=Math.max(1,Math.floor(t/ue));J(Math.min(r,G.length))}),[G,ue,X]);(0,p.w)(Q,me,{debounceMs:150}),(0,a.useLayoutEffect)((()=>{me()}),[me]);const xe=0===G.length&&T,he=(0,a.useMemo)((()=>xe?Array(3).fill(null).map(((e,t)=>({id:"placeholder-".concat(t),name:"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",isPlaceholder:!0,status:void 0,lastConsultationDate:void 0}))):[]),[xe]),ge=xe?he:G,be=xe?he.length:$,ye=(0,a.useMemo)((()=>{if(xe||!q)return ge;const e=ge.find((e=>e.id===q));if(!e)return ge;return[e,...ge.filter((e=>e.id!==q))]}),[ge,q,xe]);return T?(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:(0,F.jsxs)("div",{className:"animate-pulse",children:[(0,F.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),(0,F.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),(0,F.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"})]})}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center pl-2 sm:pl-0",children:[(0,F.jsx)(l.A,{className:"h-6 w-6 mr-2 sm:h-6 sm:w-6 sm:mr-2"}),k("consultations.trackerTitle")]}),N&&(0,F.jsxs)("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[(0,F.jsx)(o.A,{className:"h-5 w-5 mr-2 animate-pulse"}),(0,F.jsxs)("span",{className:"font-medium",children:[(0,h.P0)(N.startTime,null)," - ",null===(t=N.client)||void 0===t?void 0:t.name]})]})]}),N?(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,F.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:k("consultations.activeWith")}),(0,F.jsx)("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:null===(r=N.client)||void 0===r?void 0:r.name}),(0,F.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[k("consultations.startedAt"),": ",(0,h.fU)(N.startTime)]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:k("consultations.notesForConsultation")}),(0,F.jsx)("textarea",{value:Y,onChange:e=>K(e.target.value),onBlur:ce,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:k("consultations.notesPlaceholder")})]}),(0,F.jsxs)("button",{onClick:async()=>{try{const e=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),t=await O({endTime:e.toISOString(),notes:Y||void 0});S(null),K(""),f.oR.success(k("consultations.stopped")),ie(),null===n||void 0===n||n(t),b.v.log("\ud83d\uded1 ConsultationTracker: Sending consultationChanged event (stop)"),window.dispatchEvent(new CustomEvent("consultationChanged"))}catch(r){var e,t;f.oR.error((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||k("consultations.stopError"))}},className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[(0,F.jsx)(i.A,{className:"h-5 w-5 mr-2"}),k("consultations.stop")]})]}):(0,F.jsxs)("div",{className:"space-y-4",children:[ye.length>0&&!te&&(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:ye.some((e=>!B(e)&&"planned"===e.status))?k("consultations.recentAndPlanned"):k("consultations.recent")}),(0,F.jsxs)("div",{ref:Q,className:"flex items-center gap-0.5 md:gap-6",children:[(0,F.jsx)("button",{onClick:()=>W(!0),disabled:xe,className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center flex-shrink-0 ".concat(xe?"opacity-50 cursor-not-allowed":""),style:{width:"30.19px",height:"30.19px"},title:k("consultations.createClient"),"aria-label":k("consultations.createClient"),children:(0,F.jsx)(d.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:ye.slice(0,be).map(((e,t)=>{!B(e)&&e.status;const r=!B(e)&&"planned"===e.status;return(0,F.jsxs)("button",{onClick:()=>!B(e)&&de(Number(e.id),Y),disabled:B(e),className:"inline-flex items-center px-3 py-2 rounded-full text-sm font-medium flex-shrink-0 transition-colors ".concat(B(e)?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 animate-pulse cursor-default":r?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 hover:bg-blue-200 dark:hover:bg-blue-900/50 cursor-pointer border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer"),title:B(e)?k("common.loading"):r?k("consultations.plannedWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""}):k("consultations.startWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE"):""}),children:[r&&!B(e)&&(0,F.jsx)("svg",{className:"h-3 w-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,F.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,F.jsx)("span",{className:"truncate max-w-[120px]",children:B(e)?(0,F.jsx)("span",{className:"inline-block w-16 h-4 bg-gray-300 dark:bg-gray-500 rounded animate-pulse"}):e.name})]},e.id)}))})]})]}),(0,F.jsxs)("div",{className:"flex gap-6",children:[(0,F.jsx)("button",{onClick:()=>P(!0),className:"w-2/3 flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:k("consultations.start"),children:(0,F.jsx)(c.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:()=>{re(!te),V(null),se(""),le(""),K("")},className:"w-1/3 flex items-center justify-center px-4 py-3 border text-base font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(te?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"),title:k("consultations.plan"),children:(0,F.jsx)(o.A,{className:"h-5 w-5"})})]}),te&&(0,F.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:k("consultations.planConsultation")}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:k("consultations.columns.client")}),z?(0,F.jsxs)("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2",children:[(0,F.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:z.name}),(0,F.jsx)("button",{onClick:()=>P(!0),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:k("consultations.change")})]}):(0,F.jsx)("button",{onClick:()=>P(!0),className:"w-full text-left bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700",children:k("consultations.selectClientPlaceholder")})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:k("consultations.columns.startTime")}),(0,F.jsx)("input",{type:"datetime-local",value:ae,onChange:e=>se(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:k("consultations.columns.endTime")}),(0,F.jsx)("input",{type:"datetime-local",value:ne,onChange:e=>le(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:k("consultations.columns.notes")}),(0,F.jsx)("textarea",{value:Y,onChange:e=>K(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",rows:2,placeholder:k("consultations.optionalNotes")})]}),(0,F.jsx)("div",{className:"flex justify-end",children:(0,F.jsx)("button",{onClick:async()=>{if(z)if(ae&&ne)if(j)try{D(!0);const e=new Date(ae),t=new Date(e.getTime()-6e4*e.getTimezoneOffset()),r=new Date(ne),a=new Date(r.getTime()-6e4*r.getTimezoneOffset()),s=(await L({branchId:j,clientId:z.id,notes:Y||"",startTime:t.toISOString()}),await O({endTime:a.toISOString(),notes:Y||""}));re(!1),se(""),le(""),K(""),V(null),Z(z.id),b.v.log("\ud83d\ude80 ConsultationTracker: Sending consultationChanged event (start)"),window.dispatchEvent(new CustomEvent("consultationChanged")),ie(),null===n||void 0===n||n(s),v&&z.name&&v(z.name),f.oR.success(k("consultations.manualSaveSuccess"))}catch(e){console.error("Fehler beim Erfassen der Beratung:",e),f.oR.error(k("consultations.manualSaveError"))}finally{D(!1)}else f.oR.error(k("consultations.selectBranch"));else f.oR.error("Bitte geben Sie Start- und Endzeit an");else f.oR.error("Bitte w\xe4hlen Sie einen Client aus")},disabled:!z||!ae||!ne,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:k("consultations.saveConsultation"),children:(0,F.jsx)(u.A,{className:"h-5 w-5"})})})]})]})]}),(0,F.jsx)(R,{isOpen:_,onClose:()=>P(!1),onSelect:e=>{V(e),P(!1),te||de(e.id,Y)},onCreateNew:()=>{P(!1),W(!0)}}),(0,F.jsx)(I,{isOpen:U,onClose:()=>W(!1),onSave:e=>{W(!1),V(e),ie()}})]})};var U=r(8010),W=r(2704),z=r(3315),V=r(9670),G=r(3216);const H=e=>{let{isOpen:t,onClose:r,consultationId:n,onTaskLinked:l}=e;const{t:o}=(0,s.Bd)(),[i,d]=(0,a.useState)([]),[c,u]=(0,a.useState)([]),[h,g]=(0,a.useState)(""),[b,y]=(0,a.useState)(!0),[p,j]=(0,a.useState)(null);(0,a.useEffect)((()=>{t&&N()}),[t]),(0,a.useEffect)((()=>{if(h){const e=i.filter((e=>e.title.toLowerCase().includes(h.toLowerCase())));u(e)}else u(i)}),[h,i]);const N=async()=>{try{y(!0);const e=(await x.A.get(m.Sn.TASKS.BASE)).data.filter((e=>"open"===e.status||"in_progress"===e.status));d(e),u(e)}catch(e){f.oR.error(o("consultations.linkTask.loadError"))}finally{y(!1)}};return(0,F.jsxs)(v.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(v.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,F.jsxs)("div",{className:"p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)(v.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("consultations.linkTask.title")}),(0,F.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"relative mb-4",children:[(0,F.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,F.jsx)(w.A,{className:"h-5 w-5 text-gray-400"})}),(0,F.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:o("consultations.linkTask.searchPlaceholder"),autoFocus:!0})]}),(0,F.jsx)("div",{className:"max-h-96 overflow-y-auto",children:b?(0,F.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:o("common.loading")}):0===c.length?(0,F.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("consultations.linkTask.noTasksFound")}):(0,F.jsx)("div",{className:"space-y-2",children:c.map((e=>(0,F.jsxs)("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",children:[(0,F.jsx)("input",{type:"radio",name:"task",value:e.id,checked:p===e.id,onChange:()=>j(e.id),className:"mr-3"}),(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),e.responsible&&(0,F.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o("tasks.columns.responsible"),": ",e.responsible.firstName," ",e.responsible.lastName]})]}),(0,F.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("open"===e.status?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"),children:"open"===e.status?o("tasks.status.open"):o("tasks.status.in_progress")})]},e.id)))})}),(0,F.jsxs)("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[(0,F.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:async()=>{if(p)try{await x.A.post(m.Sn.CONSULTATIONS.LINK_TASK(n),{taskId:p}),f.oR.success(o("consultations.linkTask.success")),l(),r()}catch(a){var e,t;f.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||o("consultations.linkTask.error"))}else f.oR.error(o("consultations.linkTask.selectTask"))},disabled:!p,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",title:o("consultations.linkTask.link"),children:(0,F.jsx)(V.A,{className:"h-5 w-5"})})]})]})})})]})};var Y=r(4426),K=r(7829),q=r(6400),Z=r(2415),Q=r(887),$=r(4538),J=r(8416),X=r(9531);const ee=e=>{let{isOpen:t,onClose:r,invoiceId:n,invoiceNumber:l,totalAmount:o,clientName:i}=e;const{t:d}=(0,s.Bd)(),{showMessage:c}=(0,E.A)(),[u,h]=(0,a.useState)(!1);return t?(0,F.jsxs)(v.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(v.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,F.jsxs)("div",{className:"p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)($.A,{className:"h-8 w-8 text-green-500 mr-3"}),(0,F.jsx)(v.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellt"})]}),(0,F.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,F.jsx)("h3",{className:"font-medium text-green-800 dark:text-green-200 mb-2",children:"Rechnung erfolgreich erstellt"}),(0,F.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-300 space-y-1",children:[(0,F.jsxs)("p",{children:[(0,F.jsx)("strong",{children:"Rechnungsnummer:"})," ",l]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("strong",{children:"Kunde:"})," ",i]}),(0,F.jsxs)("p",{children:[(0,F.jsx)("strong",{children:"Betrag:"})," CHF ",o]})]})]}),(0,F.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,F.jsx)("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"N\xe4chste Schritte"}),(0,F.jsxs)("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,F.jsx)("li",{children:"\u2022 PDF herunterladen und an Kunde senden"}),(0,F.jsx)("li",{children:"\u2022 Beratungen sind nun als abgerechnet markiert"}),(0,F.jsx)("li",{children:"\u2022 Rechnung in der Rechnungsverwaltung verwalten"})]})]})]}),(0,F.jsxs)("div",{className:"mt-6 flex flex-col space-y-3",children:[(0,F.jsx)("button",{onClick:async()=>{try{h(!0);const e=await x.A.get(m.Sn.CONSULTATION_INVOICES.GENERATE_PDF(n),{responseType:"blob",headers:{Accept:"application/pdf"}}),t=new Blob([e.data],{type:"application/pdf"}),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="Rechnung_".concat(l,".pdf"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r),c(d("invoice.downloadSuccess",{defaultValue:"PDF erfolgreich heruntergeladen"}),"success")}catch(r){var e,t;console.error("Fehler beim Download der PDF:",r),c((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||d("invoice.downloadError",{defaultValue:"Fehler beim Download der PDF"}),"error")}finally{h(!1)}},disabled:u,className:"w-full flex items-center justify-center p-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",title:u?"PDF wird generiert...":"PDF herunterladen",children:u?(0,F.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,F.jsx)(J.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:()=>{c(d("invoice.invoiceManagementPhase5",{defaultValue:"Rechnungsverwaltung wird in Phase 5 implementiert"}),"info"),r()},className:"w-full flex items-center justify-center p-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",title:"Zur Rechnungsverwaltung",children:(0,F.jsx)(X.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{onClick:r,className:"w-full p-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Schlie\xdfen",children:(0,F.jsx)(k.A,{className:"h-5 w-5"})})]})]})})})]}):null},te=e=>{let{isOpen:t,onClose:r,consultations:s,onInvoiceCreated:l}=e;const{t:o}=useTranslation(),{showMessage:i}=(0,E.A)(),{hasPermission:d}=(0,n.S)(),[c,u]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null),[y,p]=(0,a.useState)(null),[f,w]=(0,a.useState)(!1),[j,N]=(0,a.useState)({issueDate:(0,Z.GP)(new Date,"yyyy-MM-dd"),dueDate:(0,Z.GP)(new Date(Date.now()+2592e6),"yyyy-MM-dd"),hourlyRate:0,vatRate:0,notes:""}),S=d("invoice_create","write","button"),C=(0,a.useCallback)((async()=>{try{u(!0);const e=(await x.A.get(m.Sn.INVOICE_SETTINGS.BASE)).data;b(e),N((t=>(0,T.A)((0,T.A)({},t),{},{hourlyRate:e.defaultHourlyRate||0,vatRate:e.defaultVatRate||0})))}catch(t){var e;console.error("Fehler beim Laden der Rechnungseinstellungen:",t),404===(null===(e=t.response)||void 0===e?void 0:e.status)?i(o("invoice.settingsNotConfigured",{defaultValue:"Bitte konfigurieren Sie zuerst Ihre Rechnungseinstellungen"}),"error"):i(o("invoice.loadSettingsError",{defaultValue:"Fehler beim Laden der Rechnungseinstellungen"}),"error")}finally{u(!1)}}),[]);if((0,a.useEffect)((()=>{t&&C()}),[t,C]),!S)return(0,F.jsxs)(v.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(v.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:(0,F.jsxs)("div",{className:"text-center",children:[(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Keine Berechtigung"}),(0,F.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Sie haben keine Berechtigung, Rechnungen zu erstellen."}),(0,F.jsx)("button",{onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Schlie\xdfen",children:(0,F.jsx)(k.A,{className:"h-5 w-5"})})]})})})]});const D=e=>{const{name:t,value:r}=e.target;N((e=>(0,T.A)((0,T.A)({},e),{},{[t]:r})))},_=s.reduce(((e,t)=>{if(t.endTime){const r=(0,h.P0)(t.startTime,t.endTime);return e+parseFloat(r.replace("h","").replace(",","."))}return e}),0),R=_*j.hourlyRate,I=j.vatRate>0?R*j.vatRate/100:0,L=R+I;return t?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(v.lG,{open:t&&!f,onClose:r,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsx)(v.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,F.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!g)return void i(o("invoice.settingsNotLoaded",{defaultValue:"Rechnungseinstellungen konnten nicht geladen werden"}),"error");if(0===s.length)return void i(o("invoice.noConsultations",{defaultValue:"Keine Beratungen zum Abrechnen vorhanden"}),"error");const t=[...new Set(s.map((e=>e.clientId)))];if(t.length>1)return void i(o("invoice.differentClients",{defaultValue:"Alle Beratungen m\xfcssen den gleichen Kunden haben"}),"error");const r=t[0];if(r)try{var a,n;u(!0);const e=(await x.A.post(m.Sn.CONSULTATION_INVOICES.CREATE_FROM_CONSULTATIONS,{consultationIds:s.map((e=>e.id)),clientId:r,issueDate:j.issueDate,dueDate:j.dueDate,hourlyRate:j.hourlyRate,vatRate:j.vatRate||0,notes:j.notes})).data,t=(null===(a=s[0])||void 0===a||null===(n=a.client)||void 0===n?void 0:n.name)||"Unbekannt";p({id:e.id,invoiceNumber:e.invoiceNumber,total:e.total,clientName:t}),w(!0),l(e.id)}catch(h){var d,c;i((null===(d=h.response)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.message)||o("invoice.createError",{defaultValue:"Fehler beim Erstellen der Rechnung"}),"error")}finally{u(!1)}else i(o("invoice.noValidClient",{defaultValue:"Kein g\xfcltiger Kunde in den Beratungen gefunden"}),"error")},className:"p-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,F.jsx)(v.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellen"}),(0,F.jsx)("button",{type:"button",onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,F.jsx)(k.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,F.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Zu verrechnende Beratungen"}),(0,F.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:s.map((e=>{var t;return(0,F.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,F.jsx)("div",{children:(0,F.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[null===(t=e.client)||void 0===t?void 0:t.name," - ",(0,h.fU)(e.startTime)]})}),(0,F.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:(0,h.P0)(e.startTime,e.endTime)})]},e.id)}))}),(0,F.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 flex justify-between text-sm font-medium",children:[(0,F.jsx)("span",{children:"Gesamtdauer:"}),(0,F.jsxs)("span",{children:[_.toFixed(2),"h"]})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rechnungsdatum"}),(0,F.jsx)("input",{type:"date",name:"issueDate",value:j.issueDate,onChange:D,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"F\xe4lligkeitsdatum"}),(0,F.jsx)("input",{type:"date",name:"dueDate",value:j.dueDate,onChange:D,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stundensatz (CHF)"}),(0,F.jsx)("input",{type:"number",name:"hourlyRate",value:j.hourlyRate,onChange:D,step:"0.01",min:"0",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"MwSt.-Satz (%)"}),(0,F.jsx)("input",{type:"number",name:"vatRate",value:j.vatRate,onChange:D,step:"0.1",min:"0",max:"100",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,F.jsxs)("div",{className:"mb-6",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zus\xe4tzliche Notizen"}),(0,F.jsx)("textarea",{name:"notes",value:j.notes,onChange:D,rows:3,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Optionale Notizen zur Rechnung..."})]}),(0,F.jsxs)("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,F.jsx)("h3",{className:"font-medium text-blue-800 dark:text-blue-200 mb-3",children:"Kosten\xfcbersicht"}),(0,F.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsxs)("span",{children:["Beratungszeit (",_.toFixed(2),"h \xd7 CHF ",j.hourlyRate,"):"]}),(0,F.jsxs)("span",{children:["CHF ",R.toFixed(2)]})]}),j.vatRate>0&&(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsxs)("span",{children:["MwSt. (",j.vatRate,"%):"]}),(0,F.jsxs)("span",{children:["CHF ",I.toFixed(2)]})]}),(0,F.jsxs)("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between font-medium",children:[(0,F.jsx)("span",{children:"Gesamtbetrag:"}),(0,F.jsxs)("span",{children:["CHF ",L.toFixed(2)]})]})]})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,F.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel"),children:(0,F.jsx)(k.A,{className:"h-5 w-5"})}),(0,F.jsx)("button",{type:"submit",disabled:c||!g||0===_,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:c?"Erstelle Rechnung...":"Rechnung erstellen",children:c?(0,F.jsx)(A.A,{className:"h-5 w-5 animate-spin"}):(0,F.jsx)(W.A,{className:"h-5 w-5"})})]})]})})})]}),f&&y&&(0,F.jsx)(ee,{isOpen:f,onClose:()=>{w(!1),p(null),r()},invoiceId:y.id,invoiceNumber:y.invoiceNumber,totalAmount:Number(y.total).toFixed(2),clientName:y.clientName})]}):null},re="consultations-table",ae=(0,a.forwardRef)(((e,t)=>{let{onConsultationChange:r}=e;const{t:l}=(0,s.Bd)(),{hasPermission:i}=(0,n.S)(),d=(0,G.Zp)(),[c,g]=(0,a.useState)([]),[y,p]=(0,a.useState)([]),[v,w]=(0,a.useState)(!0),[j,S]=(0,a.useState)(null),[A,E]=(0,a.useState)(""),[D,_]=(0,a.useState)(!1),[R,I]=(0,a.useState)([]),[L,O]=(0,a.useState)([]),[B,P]=(0,a.useState)(null),[$,J]=(0,a.useState)(""),[X,ee]=(0,a.useState)(null),[ae,se]=(0,a.useState)(null),[ne,le]=(0,a.useState)(""),[oe,ie]=(0,a.useState)(!1),[de,ce]=(0,a.useState)(null),[ue,me]=(0,a.useState)(l("consultations.filters.today")),[xe,he]=(0,a.useState)(null),[ge,be]=(0,a.useState)(!1),ye=async()=>{try{w(!0);const e=await(async(e,t,r)=>{try{const a=new URLSearchParams;e&&a.append("clientId",e.toString()),t&&a.append("from",t),r&&a.append("to",r);const s=a.toString()?"".concat(m.Sn.CONSULTATIONS.BASE,"?").concat(a):m.Sn.CONSULTATIONS.BASE;return(await x.A.get(s)).data}catch(j){throw console.error("Fehler beim Laden der Beratungen:",j),j}})();g(e||[]),S(null)}catch(j){console.error("Fehler beim Laden der Beratungen:",j),S(l("consultations.loadError"))}finally{w(!1)}};(0,a.useImperativeHandle)(t,(()=>({refresh:ye,addConsultation:e=>{g((t=>[e,...t]))},updateConsultation:e=>{g((t=>t.map((t=>t.id===e.id?e:t))))},removeConsultation:e=>{g((t=>t.filter((t=>t.id!==e))))},activateClientFilter:pe}))),(0,a.useEffect)((()=>{ye(),(async()=>{try{const e=await C();p(e||[])}catch(j){}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await x.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(re)),t=e.data.find((e=>"Heute"===e.name));t&&(me(l("consultations.filters.today")),he(t.id),fe(t.conditions,t.operators))}catch(j){console.error("Fehler beim Setzen des initialen Filters:",j)}})()}),[]);const pe=async e=>{try{const t=await x.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(re));let r=t.data.find((t=>t.name===e));if(!r){const t={tableId:re,name:e,conditions:[{column:"client",operator:"equals",value:e}],operators:[]};r=(await x.A.post(m.Sn.SAVED_FILTERS.BASE,t)).data,window.refreshSavedFilters&&window.refreshSavedFilters()}r&&(me(e),he(r.id),fe(r.conditions,r.operators))}catch(j){console.error("Fehler beim Erstellen/Aktivieren des Client-Filters:",j)}};(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return;const e=(await x.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(re))).data,t=e.find((e=>"Alle"===e.name));if(t)try{await x.A.delete(m.Sn.SAVED_FILTERS.BY_ID(t.id)),b.v.log('Veralteter "Alle" Filter gel\xf6scht')}catch(j){console.error('Fehler beim L\xf6schen des "Alle" Filters:',j)}const r=e.find((e=>"Diese Woche"===e.name));if(r)try{await x.A.delete(m.Sn.SAVED_FILTERS.BY_ID(r.id)),b.v.log('Veralteter "Diese Woche" Filter gel\xf6scht')}catch(j){console.error('Fehler beim L\xf6schen des "Diese Woche" Filters:',j)}const a=e.some((e=>"Archiv"===e.name)),s=e.some((e=>"Heute"===e.name)),n=e.some((e=>"Woche"===e.name)),o=e.some((e=>"Nicht abgerechnet"===e.name));if(!a){const e=(new Date).toISOString().split("T")[0],t={tableId:re,name:"Archiv",conditions:[{column:"startTime",operator:"before",value:e}],operators:[]};try{await x.A.post(m.Sn.SAVED_FILTERS.BASE,t)}catch(j){console.error("Fehler beim Erstellen des Archiv-Filters:",j)}}if(!s){const e={tableId:re,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]};try{await x.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(j){console.error("Fehler beim Erstellen des Heute-Filters:",j)}}if(!n){const e={tableId:re,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]};try{await x.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(j){console.error("Fehler beim Erstellen des Woche-Filters:",j)}}if(!o){const e={tableId:re,name:l("consultations.filters.unbilled"),conditions:[{column:"invoiceStatus",operator:"equals",value:"nicht abgerechnet"}],operators:[]};try{await x.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(j){console.error("Fehler beim Erstellen des Nicht abgerechnet-Filters:",j)}}}catch(j){console.error("Fehler beim Erstellen der Standard-Filter:",j)}})()}),[]),(0,a.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{try{const e=(await x.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(re))).data,t=e.find((e=>"Heute"===e.name));if(t&&t.conditions.length>0){const e=t.conditions[0];e.value&&"__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)&&(b.v.log("Aktualisiere Heute-Filter mit dynamischem Marker..."),await x.A.post(m.Sn.SAVED_FILTERS.BASE,{tableId:re,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]}))}const r=e.find((e=>"Woche"===e.name));if(r&&r.conditions.length>=2){const e=r.conditions[0],t=r.conditions[1];("__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)||"__WEEK_FROM_TODAY__"!==t.value&&/^\d{4}-\d{2}-\d{2}$/.test(t.value))&&(b.v.log("Aktualisiere Woche-Filter mit dynamischen Markern..."),await x.A.post(m.Sn.SAVED_FILTERS.BASE,{tableId:re,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]}))}}catch(j){console.error("Fehler beim Aktualisieren bestehender Filter:",j)}})()}),1e3);return()=>clearTimeout(e)}),[]),(0,a.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{if(0!==y.length)try{if(!localStorage.getItem("token"))return;const e=(await x.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(re))).data,t=e.filter((e=>![l("consultations.filters.archive"),l("consultations.filters.today"),l("consultations.filters.week")].includes(e.name))),r=y.map((e=>e.name));for(const a of t)if(!r.includes(a.name))try{await x.A.delete(m.Sn.SAVED_FILTERS.BY_ID(a.id)),b.v.log("Veralteter Client-Filter gel\xf6scht: ".concat(a.name))}catch(j){console.error("Fehler beim L\xf6schen des veralteten Client-Filters ".concat(a.name,":"),j)}for(const a of y){const t=a.name;if(!e.some((e=>e.name===t))){const e={tableId:re,name:t,conditions:[{column:"client",operator:"equals",value:a.name}],operators:[]};await x.A.post(m.Sn.SAVED_FILTERS.BASE,e),b.v.log("Neuer Client-Filter erstellt: ".concat(t))}}}catch(j){console.error("Fehler beim Aktualisieren der Client-Filter:",j)}})()}),500);return()=>clearTimeout(e)}),[y]);const fe=(e,t)=>{I(e),O(t)},ve=()=>{I([]),O([])},ke=()=>R.length,we=e=>{(async(e,t)=>{try{await M(e,{notes:t}),g((r=>r.map((r=>r.id===e?(0,T.A)((0,T.A)({},r),{},{notes:t}):r)))),f.oR.success(l("consultations.notesUpdated"))}catch(j){console.error("Fehler beim Aktualisieren der Notizen:",j),f.oR.error(l("consultations.notesUpdateError"))}})(e,$),P(null)},je=()=>{P(null),J("")},Ne=(e,t)=>{ee(e.id),se(t);const r="startTime"===t?e.startTime:e.endTime;if(r){const e=new Date(r),t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),s=String(e.getUTCDate()).padStart(2,"0"),n=String(e.getUTCHours()).padStart(2,"0"),l=String(e.getUTCMinutes()).padStart(2,"0"),o="".concat(t,"-").concat(a,"-").concat(s,"T").concat(n,":").concat(l);b.v.log("\ud83d\udd27 DEBUG handleTimeEdit (KORRIGIERT):"),b.v.log("- DB Zeit (UTC):",r),b.v.log("- Extrahierte UTC-Komponenten:","".concat(n,":").concat(l)),b.v.log("- inputValue f\xfcr datetime-local:",o),le(o)}},Se=async e=>{if(ae&&ne)try{const t="".concat(ne,":00.000Z");b.v.log("\ud83d\udd27 DEBUG handleTimeSave (REFACTORED):"),b.v.log("- editingTimeValue (Input):",ne),b.v.log("- timeString f\xfcr API (UTC):",t),b.v.log("- editingTimeType:",ae);await(async(e,t)=>{try{return(await x.A.put("".concat(m.Sn.WORKTIME.BASE,"/").concat(e),t)).data}catch(j){throw console.error("Fehler beim Aktualisieren der Zeit:",j),j}})(e,{[ae]:t});g((r=>r.map((r=>r.id===e?(0,T.A)((0,T.A)({},r),{},{[ae]:t}):r)))),f.oR.success(l("consultations.timeUpdated")),ee(null),se(null),le("")}catch(j){var t,r;console.error("Fehler beim Aktualisieren der Zeit:",j),f.oR.error("".concat(l("consultations.timeUpdateError"),": ").concat((null===(t=j.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||j.message))}},Ce=()=>{ee(null),se(null),le("")},Te=async e=>{if(window.confirm(l("consultations.confirmDelete")))try{await(async e=>{try{return(await x.A.delete(m.Sn.CONSULTATIONS.BY_ID(e))).data}catch(j){throw console.error("Fehler beim L\xf6schen der Beratung:",j),j}})(e),g((t=>t.filter((t=>t.id!==e)))),f.oR.success(l("consultations.deleteSuccess")),null===r||void 0===r||r()}catch(j){var t,a;console.error("Fehler beim L\xf6schen der Beratung:",j);const r=(null===(t=j.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||l("consultations.deleteError");f.oR.error(r)}},Ae=(0,a.useCallback)((e=>{let t=e;if(A){const e=A.toLowerCase();t=t.filter((t=>{var r,a,s,n,l;return!(null===(r=t.client)||void 0===r||null===(a=r.name)||void 0===a||!a.toLowerCase().includes(e))||(!(null===(s=t.branch)||void 0===s||null===(n=s.name)||void 0===n||!n.toLowerCase().includes(e))||!(null===(l=t.notes)||void 0===l||!l.toLowerCase().includes(e)))}))}if(R.length>0){const e={client:(e,t)=>{var r,a;const s=(null===(r=e.client)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase())||"",n=(t.value||"").toLowerCase();return"contains"===t.operator?s.includes(n):"equals"===t.operator?s===n:"startsWith"===t.operator?s.startsWith(n):"endsWith"===t.operator?s.endsWith(n):null},branch:(e,t)=>{var r,a;const s=(null===(r=e.branch)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase())||"",n=(t.value||"").toLowerCase();return"contains"===t.operator?s.includes(n):"equals"===t.operator?s===n:"startsWith"===t.operator?s.startsWith(n):"endsWith"===t.operator?s.endsWith(n):null},notes:(e,t)=>{var r;const a=(null===(r=e.notes)||void 0===r?void 0:r.toLowerCase())||"",s=(t.value||"").toLowerCase();return"contains"===t.operator?a.includes(s):"equals"===t.operator?a===s:"startsWith"===t.operator?a.startsWith(s):"endsWith"===t.operator?a.endsWith(s):null},startTime:(e,t)=>(0,q.J1)(e.startTime,t),duration:(e,t)=>{const r=Ee(e.startTime,e.endTime),a=60*Number(t.value);return"greater_than"===t.operator?r>a:"less_than"===t.operator?r<a:"equals"===t.operator?Math.abs(r-a)<30:null},invoiceStatus:(e,t)=>{const r=(0,h.vv)(e),a=Re(e),s=String(t.value).toLowerCase();if("abgerechnet"===s||"invoiced"===s||"ja"===s)return r||a;if("nicht abgerechnet"===s||"not invoiced"===s||"nein"===s)return!r&&!a;if("einzelrechnung"===s||"invoice"===s)return r;if("monatsbericht"===s||"monthly report"===s)return a;if(r){const t=(0,h.h4)(e);return(t?(0,h.Pg)(t.status).toLowerCase():"").includes(s)}if(a){const t=Ie(e);if(t){return("GENERATED"===t.status?"erstellt":"SENT"===t.status?"gesendet":"archiviert").includes(s)}return!1}return!1}},r=(e,t)=>{var r,a;switch(t){case"client":return(null===(r=e.client)||void 0===r?void 0:r.name)||"";case"branch":return(null===(a=e.branch)||void 0===a?void 0:a.name)||"";case"notes":return e.notes||"";case"startTime":return e.startTime;case"duration":return Ee(e.startTime,e.endTime);case"invoiceStatus":{const t=(0,h.vv)(e),r=Re(e);return t?"invoiced":r?"monthly_report":"not_invoiced"}default:return e[t]}};t=(0,q.W5)(t,R,L,r,e)}return t}),[c,A,R,L]),Ee=(e,t)=>{if(!t)return 0;const r=new Date(e);return(new Date(t).getTime()-r.getTime())/6e4},De=(0,a.useMemo)((()=>Ae(c).sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime()))),[c,R,L]),Fe=(0,a.useMemo)((()=>(0,h.c$)(De)),[De]),_e=(0,a.useMemo)((()=>(e=>{const t=[];return e.forEach(((r,a)=>{const s=new Date(r.startTime),n=(0,Z.GP)(s,"yyyy-MM-dd",{locale:Q.de}),o=s.getUTCHours();if(a>0){const r=new Date(e[a-1].startTime);n!==(0,Z.GP)(r,"yyyy-MM-dd",{locale:Q.de})&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Z.GP)(s,"EEE, dd.MM.",{locale:Q.de}),position:a})}else 0===a&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Z.GP)(s,"EEE, dd.MM.",{locale:Q.de}),position:a});if(a>0){const r=new Date(e[a-1].startTime),s=r.getUTCHours();n===(0,Z.GP)(r,"yyyy-MM-dd",{locale:Q.de})&&s<12&&o>=12&&t.push({id:"midday-".concat(n),type:"midday",date:n,label:l("consultations.midday"),position:a})}})),t})(De)),[De]),Re=e=>null!==e.monthlyReportId&&void 0!==e.monthlyReportId,Ie=e=>e.monthlyReport,Le=e=>{const t=e?"/payroll?tab=monthly-reports&reportId=".concat(e):"/payroll?tab=monthly-reports";d(t)},Oe=e=>{const t=e?"/payroll?tab=invoices&invoiceId=".concat(e):"/payroll?tab=invoices";d(t)},Me=e=>{d("/worktracker?editTask=".concat(e))};return v?(0,F.jsx)("div",{className:"p-4",children:l("common.loading")}):j?(0,F.jsx)("div",{className:"p-4 text-red-600",children:j}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,F.jsxs)("div",{className:"flex items-center mb-6 justify-between px-2 sm:px-0",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)(o.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:l("consultations.listTitle")}),(0,F.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[l("consultations.count",{count:De.length})," - ",l("consultations.total"),": ",Fe]})]})]}),(0,F.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,F.jsx)("input",{type:"text",placeholder:l("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:A,onChange:e=>E(e.target.value)}),(0,F.jsxs)("div",{className:"relative group ml-1",children:[(0,F.jsxs)("button",{className:"p-2 rounded-md ".concat(ke()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>_(!D),children:[(0,F.jsx)(U.A,{className:"h-5 w-5"}),ke()>0&&(0,F.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:ke()})]}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.advancedFilters")})]}),(()=>{if(!i("invoice_create","write","button"))return!1;if(!(De.length>0))return!1;if(!(R.length>0||""!==A.trim()))return!1;if(!De.every((e=>e.endTime)))return!1;return!De.some((e=>(0,h.vv)(e)))})()&&(0,F.jsxs)("div",{className:"relative group ml-2",children:[(0,F.jsx)("button",{onClick:()=>{be(!0)},className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors",children:(0,F.jsx)(W.A,{className:"h-5 w-5"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.createInvoiceFromFiltered")})]})]})]}),D&&(0,F.jsx)("div",{className:"px-2 sm:px-0",children:(0,F.jsx)(Y.A,{columns:[{id:"client",label:l("consultations.columns.client")},{id:"branch",label:l("consultations.columns.branch")},{id:"notes",label:l("consultations.columns.notes")},{id:"startTime",label:l("consultations.columns.date")},{id:"duration",label:l("consultations.columns.durationHours")},{id:"invoiceStatus",label:l("consultations.columns.invoiceStatus")}],onApply:fe,onReset:ve,savedConditions:R,savedOperators:L,tableId:re})}),(0,F.jsx)("div",{className:"px-2 sm:px-0",children:(0,F.jsx)(K.A,{tableId:re,onSelectFilter:fe,onReset:ve,activeFilterName:ue,selectedFilterId:xe,onFilterChange:(e,t,r,a)=>{me(e),he(t),fe(r,a)}})}),(0,F.jsx)("div",{className:"space-y-0.5 sm:space-y-1",children:0===De.length?(0,F.jsxs)("div",{className:"text-center py-12 px-2 sm:px-0",children:[(0,F.jsx)(o.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:l("consultations.noConsultationsFound")}),(0,F.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:A||R.length>0?l("consultations.tryOtherFilters"):l("consultations.noConsultationsYet")})]})]}):De.map(((e,t)=>{var r,a;const s=_e.find((e=>"day"===e.type&&e.position===t)),n=_e.find((e=>"midday"===e.type&&e.position===t));return(0,F.jsxs)("div",{className:"relative",children:[s&&(0,F.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 dark:bg-blue-400 border-2 border-white dark:border-gray-800"}),(0,F.jsx)("div",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:s.label})]}),(0,F.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-200 dark:bg-gray-600"})]}),n&&(0,F.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 dark:bg-gray-500"}),(0,F.jsx)("div",{className:"ml-3 text-xs text-gray-500 dark:text-gray-400",children:n.label})]}),(0,F.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-300 dark:bg-gray-600"})]}),(0,F.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg md:border md:border-gray-200 md:dark:border-gray-700 hover:shadow-md transition-shadow",children:(0,F.jsx)("div",{className:"p-4",children:(0,F.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,F.jsxs)("div",{className:"col-span-1 space-y-3",children:[(0,F.jsx)("div",{className:"flex items-center space-x-2",children:(0,F.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,F.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:null===(r=e.client)||void 0===r?void 0:r.name}),(null===(a=e.client)||void 0===a?void 0:a.company)&&(0,F.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.client.company})]})}),(()=>{const t=(e=>{const t=(0,h.vv)(e),r=Re(e);if(t){const t=(0,h.h4)(e);return{type:"invoice",status:l("consultations.invoice"),info:t}}if(r){const t=Ie(e);return{type:"monthly",status:l("consultations.monthlyReport"),info:t}}return null})(e);if(t){if("invoice"===t.type)return(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(W.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,F.jsx)("button",{onClick:()=>{var e;return Oe(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.invoice")})]}),t.info&&"invoiceNumber"in t.info&&(0,F.jsx)("div",{className:"flex items-center space-x-1",children:(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>{var e;return Oe(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium hover:opacity-80 cursor-pointer ".concat((0,h.DW)(t.info.status)),children:(0,h.Pg)(t.info.status)}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Rechnung ".concat(t.info.invoiceNumber," vom ").concat((0,Z.GP)(new Date(t.info.issueDate),"dd.MM.yyyy",{locale:Q.de}))})]})})]});if("monthly"===t.type)return(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(z.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,F.jsx)("button",{onClick:()=>{var e;return Le(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.monthlyReport")})]}),t.info&&"reportNumber"in t.info&&(0,F.jsx)("div",{className:"flex items-center space-x-1",children:(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>{var e;return Le(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 hover:opacity-80 cursor-pointer",children:"GENERATED"===t.info.status?l("analytics.monthlyReports.status.generated"):"SENT"===t.info.status?l("analytics.monthlyReports.status.sent"):l("analytics.monthlyReports.status.archived")}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:"Monatsbericht ".concat(t.info.reportNumber)})]})})]})}return null})(),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.time")}),(0,F.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:X===e.id&&"startTime"===ae||X===e.id&&"endTime"===ae?(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("input",{type:"datetime-local",value:ne,onChange:e=>le(e.target.value),className:"text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full"}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>Se(e.id),className:"p-0.5 text-green-600 hover:text-green-700",children:(0,F.jsx)("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.save")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:Ce,className:"p-0.5 text-red-600 hover:text-red-700",children:(0,F.jsx)(k.A,{className:"h-3 w-3"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.cancel")})]})]}):(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("button",{onClick:()=>Ne(e,"startTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,h.fU)(e.startTime)}),(0,F.jsx)("span",{className:"text-gray-400",children:"-"}),e.endTime?(0,F.jsx)("button",{onClick:()=>Ne(e,"endTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,h.fU)(e.endTime)}):(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-1 animate-pulse"}),(0,F.jsx)("span",{className:"text-green-600 dark:text-green-400 text-xs",children:l("consultations.active")})]})]})})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.duration")}),(0,F.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(0,h.P0)(e.startTime,e.endTime)})]}),e.taskLinks&&e.taskLinks.length>0&&(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.tasks",{count:e.taskLinks.length})}),(0,F.jsxs)("div",{className:"space-y-1",children:[e.taskLinks.slice(0,2).map((e=>(0,F.jsxs)("button",{onClick:()=>Me(e.task.id),className:"flex items-center text-xs text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 rounded px-2 py-1 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors cursor-pointer w-full text-left",children:[(0,F.jsx)(V.A,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,F.jsx)("span",{className:"truncate",children:e.task.title})]},e.id))),e.taskLinks.length>2&&(0,F.jsx)("button",{onClick:()=>{e.taskLinks&&e.taskLinks.length>0&&Me(e.taskLinks[0].task.id)},className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 cursor-pointer",children:l("consultations.moreTasks",{count:e.taskLinks.length-2})})]})]})]}),(0,F.jsxs)("div",{className:"col-span-2 relative",children:[(0,F.jsxs)("div",{className:"absolute top-0 right-0 flex items-center space-x-1 z-10",children:[i("consultations","write")&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>{return t=e.id,ce(t),void ie(!0);var t},className:"p-1 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded",children:(0,F.jsx)(V.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.linkTask")})]}),i("consultations","write")&&e.endTime&&(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>Te(e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded",children:(0,F.jsx)(N.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("consultations.delete")})]})]}),(0,F.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:l("consultations.columns.notes")}),B===e.id?(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)("textarea",{value:$,onChange:e=>J(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm resize-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:l("consultations.notesPlaceholder")}),(0,F.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:je,className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,F.jsx)(k.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.cancel")})]}),(0,F.jsxs)("div",{className:"relative group",children:[(0,F.jsx)("button",{onClick:()=>we(e.id),className:"p-1.5 bg-blue-600 text-white hover:bg-blue-700 rounded-md",children:(0,F.jsx)(u.A,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:l("common.save")})]})]})]}):(0,F.jsx)("div",{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded p-2 min-h-[60px] border border-dashed border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors",onClick:()=>(e=>{P(e.id),J(e.notes||"")})(e),children:e.notes?(0,F.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap leading-relaxed",children:e.notes}):(0,F.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,F.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:l("consultations.addNotes")})})})]})]})})})]},e.id)}))})]}),oe&&de&&(0,F.jsx)(H,{isOpen:oe,onClose:()=>{ie(!1),ce(null)},consultationId:de,onTaskLinked:e=>{ye(),null===r||void 0===r||r()}}),ge&&(0,F.jsx)(te,{isOpen:ge,onClose:()=>be(!1),consultations:De,onInvoiceCreated:e=>{be(!1),ye(),f.oR.success(l("consultations.invoiceCreated"))}})]})})),se=()=>{const{t:e}=(0,s.Bd)(),{hasPermission:t}=(0,n.S)(),r=(0,a.useRef)(null),l=(0,a.useCallback)((e=>{var t,a,s,n,l;e&&e.id?e.endTime?null===(t=r.current)||void 0===t||null===(a=t.updateConsultation)||void 0===a||a.call(t,e):null===(s=r.current)||void 0===s||null===(n=s.addConsultation)||void 0===n||n.call(s,e):null===(l=r.current)||void 0===l||l.refresh()}),[]),o=(0,a.useCallback)((e=>{var t,a,s;null===(t=r.current)||void 0===t||t.refresh(),null===(a=r.current)||void 0===a||null===(s=a.activateClientFilter)||void 0===s||s.call(a,e)}),[]);return t("consultations","read")?(0,F.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,F.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsx)(P,{onConsultationChange:l,onConsultationStarted:o}),(0,F.jsx)(ae,{ref:r,onConsultationChange:l})]})})}):(0,F.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,F.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:(0,F.jsx)("div",{className:"flex",children:(0,F.jsxs)("div",{className:"ml-3",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:e("consultations.noPermission")}),(0,F.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(0,F.jsx)("p",{children:e("consultations.noPermissionMessage")})})]})})})})}}}]);
//# sourceMappingURL=513.fd5e1037.chunk.js.map