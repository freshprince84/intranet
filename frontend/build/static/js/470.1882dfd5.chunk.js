"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[470],{840:(e,t,r)=>{r.r(t),r.d(t,{default:()=>je});var s=r(5043),a=r(4117),n=r(3216),i=r(9379),o=r(1637),l=r(1923),d=r(2672),c=r(2760),u=r(2023),m=r(9462),p=r(1801),x=r(6443),h=r(7591),g=r(1816),b=r(9422),y=r(5657),v=r(8018);const f=e=>{const t=new Date,r=new Date(t);switch(e){case"vacation":case"event":case"permit":r.setMonth(r.getMonth()+1);break;case"improvement_suggestion":case"sick_leave":case"employment_certificate":case"other":default:r.setDate(r.getDate()+7);case"buy_order":case"repair":}return r.toISOString().split("T")[0]},w=e=>f(e);var k=r(579);const j=e=>{let{file:t,alt:r,blobUrlsRef:a,className:n="max-w-[200px] max-h-[150px] object-contain"}=e;const[i,o]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=URL.createObjectURL(t);return a.current.add(e),o(e),()=>{URL.revokeObjectURL(e),a.current.delete(e)}}),[t,a]),i?(0,k.jsx)("img",{src:i,alt:r,className:n}):null},N=e=>{let{isOpen:t,onClose:r,onRequestCreated:n}=e;const{t:o}=(0,a.Bd)(),{user:c}=(0,d.As)(),{openSidepane:u,closeSidepane:m}=(0,y.N)(),[N,q]=(0,s.useState)(window.innerWidth>1070),[A,R]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[D,_]=(0,s.useState)({title:"",description:"",responsible_id:"",branch_id:"",type:"other",is_private:!1,due_date:"",create_todo:!1}),[E,T]=(0,s.useState)(null),[L,B]=(0,s.useState)(!1),[M,F]=(0,s.useState)(window.innerWidth<640),[z,O]=(0,s.useState)([]),[U,I]=(0,s.useState)(!1),P=(0,s.useRef)(null),W=(0,s.useRef)(null),H=(0,s.useRef)(new Set),V=(0,s.useRef)(null),$=e=>{const t=f(e),r=w(e);_((s=>{const a=s.due_date?new Date(s.due_date):null,n=new Date(t),o=a&&a>=n?s.due_date:r;return(0,i.A)((0,i.A)({},s),{},{type:e,due_date:o})}))};(0,s.useEffect)((()=>{t&&(async()=>{try{if(T(null),!localStorage.getItem("token"))return void T(o("createRequest.errors.notAuthenticated"));v.v.log("Lade Daten f\xfcr CreateRequestModal...");try{const[t,r]=await Promise.all([l.A.get(p.Sn.USERS.DROPDOWN),l.A.get(p.Sn.BRANCHES.BASE)]);if(v.v.log("Benutzer geladen:",t.data.length),v.v.log("Niederlassungen geladen:",r.data.length),R(t.data||[]),C(r.data||[]),c){if(_((e=>(0,i.A)((0,i.A)({},e),{},{responsible_id:c.id.toString()}))),r.data&&r.data.length>0){var e;const t=null===(e=r.data[0])||void 0===e?void 0:e.id.toString();_((e=>(0,i.A)((0,i.A)({},e),{},{branch_id:t})))}_((e=>{const t=w(e.type);return(0,i.A)((0,i.A)({},e),{},{due_date:t})}))}}catch(s){console.error("Fehler beim Laden der Daten:",s);const e=s;var t,r;"ERR_NETWORK"===e.code?T("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft."):T("Fehler beim Laden der Daten: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}catch(s){console.error("Unerwarteter Fehler:",s),T("Ein unerwarteter Fehler ist aufgetreten")}})()}),[t]),(0,s.useEffect)((()=>()=>{V.current&&(clearTimeout(V.current),V.current=null)}),[t]),(0,s.useEffect)((()=>{const e=()=>{F(window.innerWidth<640),q(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>()=>{H.current.forEach((e=>{URL.revokeObjectURL(e)})),H.current.clear()}),[]),(0,s.useEffect)((()=>(t?u():m(),()=>{m()})),[t,u,m]);const Y=e=>{var t,r;const s=null===(t=e.firstName)||void 0===t?void 0:t.split(" ")[0],a=null===(r=e.username)||void 0===r?void 0:r.split(" ")[0];return s?"".concat(s," (").concat(a,")"):a||o("createRequest.errors.unknownUser")},K=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await G(t))}}},Q=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await G(t)}},Z=e=>{e.preventDefault(),e.stopPropagation()},G=async e=>{I(!0),T(null);try{const t={fileName:e.name,fileType:e.type,fileSize:e.size,file:e};O((e=>[...e,t]));let r="";if(r=e.type.startsWith("image/")?"\n![".concat(e.name,"](").concat(o("createRequest.form.uploadAfterCreate"),")\n"):"\n[".concat(e.name,"](").concat(o("createRequest.form.uploadAfterCreate"),")\n"),W.current){const e=W.current.selectionStart,t=D.description.substring(0,e),s=D.description.substring(e);_((0,i.A)((0,i.A)({},D),{},{description:t+r+s})),V.current&&clearTimeout(V.current),V.current=setTimeout((()=>{if(W.current){const t=e+r.length;W.current.selectionStart=t,W.current.selectionEnd=t,W.current.focus()}V.current=null}),0)}else _((0,i.A)((0,i.A)({},D),{},{description:D.description+r}))}catch(s){var t,r;console.error("Fehler beim Verarbeiten der Datei:",s);const e=s;T((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||o("createRequest.errors.unknownError"))}finally{I(!1)}},J=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await G(r),P.current&&(P.current.value="")},X=async e=>{e.preventDefault(),T(null),B(!0);try{if(!localStorage.getItem("token"))throw new Error(o("createRequest.errors.notAuthenticated"));if(null===c||void 0===c||!c.id)throw new Error(o("createRequest.errors.unknownUser"));const e=parseInt(D.responsible_id),t=parseInt(D.branch_id);if(isNaN(e)||isNaN(t))throw new Error(o("createRequest.errors.invalidIds"));const s=await l.A.post(p.Sn.REQUESTS.BASE,{title:D.title,description:D.description||"",responsible_id:e,branch_id:t,requested_by_id:c.id,type:D.type,is_private:D.is_private,due_date:D.due_date||null,create_todo:D.create_todo,status:"approval"});if(201!==s.status)throw new Error(o("createRequest.errors.createError"));await(async e=>{if(0!==z.length)try{B(!0);for(const t of z){if(!t.file)continue;const r=new FormData;r.append("file",t.file),await l.A.post(p.Sn.REQUESTS.ATTACHMENTS(e),r,{headers:{"Content-Type":"multipart/form-data"}})}v.v.log(o("createRequest.messages.attachmentsUploaded",{count:z.length}))}catch(t){console.error("Fehler beim Hochladen der Anh\xe4nge:",t)}finally{B(!1)}})(s.data.id),n(s.data),r(),_({title:"",description:"",responsible_id:"",branch_id:"",type:"other",is_private:!1,due_date:"",create_todo:!1}),O([])}catch(a){var t,s;console.error("Create Request Error:",a);const e=a;T((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||o("createRequest.errors.createError"))}finally{B(!1)}},ee=()=>0===z.length?null:(0,k.jsx)("div",{className:"mt-2",children:(0,k.jsx)("ul",{className:"flex flex-wrap gap-2",children:z.map(((e,t)=>(0,k.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,k.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,k.jsx)("div",{className:"flex ml-2",children:(0,k.jsxs)("div",{className:"relative group ml-1",children:[(0,k.jsx)("button",{type:"button",onClick:()=>(e=>{const t=z[e];if(t&&(O((t=>t.filter(((t,r)=>r!==e)))),t.fileName)){const e=o("createRequest.form.uploadAfterCreate"),r=new RegExp("!\\[".concat(t.fileName,"\\]\\(").concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),s=new RegExp("\\[".concat(t.fileName,"\\]\\(").concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),a=D.description.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");_((0,i.A)((0,i.A)({},D),{},{description:a}))}})(t),className:"text-red-600 hover:text-red-900",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.form.remove")})]})}),e.fileType.startsWith("image/")&&e.file&&(0,k.jsx)("div",{className:"absolute z-10 bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,k.jsx)(j,{file:e.file,alt:e.fileName,blobUrlsRef:H})})]},t)))})});return t?M?(0,k.jsxs)(x.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(x.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,k.jsx)(x.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("createRequest.title")}),(0,k.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4",children:[E&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:E}),(0,k.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.title")}),(0,k.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:D.title,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{title:e.target.value}))})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.description")}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)("textarea",{ref:W,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:D.description,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{description:e.target.value})),onPaste:K,onDrop:Q,onDragOver:Z,placeholder:o("createRequest.form.descriptionPlaceholder")}),(0,k.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,k.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.form.addFile")})]}),(0,k.jsx)("input",{ref:P,type:"file",onChange:J,className:"hidden"}),U&&(0,k.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,k.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o("createRequest.form.uploading")})})]}),ee()]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.responsible")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.responsible_id,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{responsible_id:e.target.value})),children:[(0,k.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(A)&&A.map((e=>(0,k.jsx)("option",{value:e.id,children:Y(e)},e.id)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.branch")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.branch_id,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{branch_id:e.target.value})),children:[(0,k.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(S)&&S.map((e=>(0,k.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.type")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.type,onChange:e=>$(e.target.value),children:[(0,k.jsx)("option",{value:"event",children:o("requests.types.event")}),(0,k.jsx)("option",{value:"repair",children:o("requests.types.repair")}),(0,k.jsx)("option",{value:"improvement_suggestion",children:o("requests.types.improvement_suggestion")}),(0,k.jsx)("option",{value:"buy_order",children:o("requests.types.buy_order")}),(0,k.jsx)("option",{value:"employment_certificate",children:o("requests.types.employment_certificate")}),(0,k.jsx)("option",{value:"vacation",children:o("requests.types.vacation")}),(0,k.jsx)("option",{value:"permit",children:o("requests.types.permit")}),(0,k.jsx)("option",{value:"sick_leave",children:o("requests.types.sick_leave")}),(0,k.jsx)("option",{value:"other",children:o("requests.types.other")})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.dueDate")}),(0,k.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.due_date,min:f(D.type),onChange:e=>{const t=e.target.value,r=f(D.type);_(t&&t<r?(0,i.A)((0,i.A)({},D),{},{due_date:r}):(0,i.A)((0,i.A)({},D),{},{due_date:t}))}})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"is_private",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:D.is_private,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{is_private:e.target.checked}))}),(0,k.jsx)("label",{htmlFor:"is_private",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.isPrivate")})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"create_todo",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:D.create_todo,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{create_todo:e.target.checked}))}),(0,k.jsx)("label",{htmlFor:"create_todo",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.createTodo")})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.form.cancel")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:L,children:L?(0,k.jsx)(g.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o(L?"createRequest.form.creating":"createRequest.form.create")})]})]})]})]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[t&&!N&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("createRequest.title")}),(0,k.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[E&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:E}),(0,k.jsxs)("form",{onSubmit:X,className:"space-y-4","data-onboarding":"request-form",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.title")}),(0,k.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:D.title,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{title:e.target.value}))})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"description_request_create",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.description")}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)("textarea",{ref:W,id:"description_request_create",rows:6,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:D.description,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{description:e.target.value})),onPaste:K,onDrop:Q,onDragOver:Z,placeholder:o("createRequest.form.descriptionPlaceholder")}),(0,k.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,k.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.form.addFile")})]}),(0,k.jsx)("input",{ref:P,type:"file",onChange:J,className:"hidden"}),U&&(0,k.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,k.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o("createRequest.form.uploading")})})]}),ee()]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.responsible")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.responsible_id,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{responsible_id:e.target.value})),children:[(0,k.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(A)&&A.map((e=>(0,k.jsx)("option",{value:e.id,children:Y(e)},e.id)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.branch")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.branch_id,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{branch_id:e.target.value})),children:[(0,k.jsx)("option",{value:"",children:o("createRequest.form.select")}),Array.isArray(S)&&S.map((e=>(0,k.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.type")}),(0,k.jsxs)("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.type,onChange:e=>$(e.target.value),children:[(0,k.jsx)("option",{value:"event",children:o("requests.types.event")}),(0,k.jsx)("option",{value:"repair",children:o("requests.types.repair")}),(0,k.jsx)("option",{value:"improvement_suggestion",children:o("requests.types.improvement_suggestion")}),(0,k.jsx)("option",{value:"buy_order",children:o("requests.types.buy_order")}),(0,k.jsx)("option",{value:"employment_certificate",children:o("requests.types.employment_certificate")}),(0,k.jsx)("option",{value:"vacation",children:o("requests.types.vacation")}),(0,k.jsx)("option",{value:"permit",children:o("requests.types.permit")}),(0,k.jsx)("option",{value:"sick_leave",children:o("requests.types.sick_leave")}),(0,k.jsx)("option",{value:"other",children:o("requests.types.other")})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.form.dueDate")}),(0,k.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm",value:D.due_date,min:f(D.type),onChange:e=>{const t=e.target.value,r=f(D.type);_(t&&t<r?(0,i.A)((0,i.A)({},D),{},{due_date:r}):(0,i.A)((0,i.A)({},D),{},{due_date:t}))}})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"is_private_sidepane",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:D.is_private,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{is_private:e.target.checked}))}),(0,k.jsx)("label",{htmlFor:"is_private_sidepane",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.isPrivate")})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"create_todo_sidepane",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300",checked:D.create_todo,onChange:e=>_((0,i.A)((0,i.A)({},D),{},{create_todo:e.target.checked}))}),(0,k.jsx)("label",{htmlFor:"create_todo_sidepane",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.form.createTodo")})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.form.cancel")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",disabled:L,children:L?(0,k.jsx)(g.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o(L?"createRequest.form.creating":"createRequest.form.create")})]})]})]})]})]})]}):null};var q=r(9248);const A=e=>{let{file:t,alt:r,blobUrlsRef:a,className:n="max-w-[200px] max-h-[150px] object-contain"}=e;const[i,o]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=URL.createObjectURL(t);return a.current.add(e),o(e),()=>{URL.revokeObjectURL(e),a.current.delete(e)}}),[t,a]),i?(0,k.jsx)("img",{src:i,alt:r,className:n}):null},R=e=>{let{isOpen:t,onClose:r,onRequestUpdated:n,request:i}=e;const{t:o,i18n:u}=(0,a.Bd)(),{user:m}=(0,d.As)(),j=e=>e?e.replace(/!\[([^\]]*)\]\([^)]+\)/g,"").trim():"";(0,s.useEffect)((()=>{0}),[u.language,o]);const{openSidepane:N,closeSidepane:R}=(0,y.N)(),[S,C]=(0,s.useState)(window.innerWidth>1070),[D,_]=(0,s.useState)(i.title),[E,T]=(0,s.useState)(j(i.description||"")),[L,B]=(0,s.useState)(i.responsible.id),[M,F]=(0,s.useState)(i.branch.id),[z,O]=(0,s.useState)(i.type||"other"),[U,I]=(0,s.useState)(i.isPrivate||!1),[P,W]=(0,s.useState)(i.dueDate?i.dueDate.split("T")[0]:""),[H,V]=(0,s.useState)(i.createTodo),[$,Y]=(0,s.useState)([]),[K,Q]=(0,s.useState)([]),[Z,G]=(0,s.useState)(null),[J,X]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),[re,se]=(0,s.useState)(window.innerWidth<640),[ae,ne]=(0,s.useState)(i.attachments||[]),[ie,oe]=(0,s.useState)(!1),[le,de]=(0,s.useState)([]),[ce,ue]=(0,s.useState)([]),me=(0,s.useRef)(null),pe=(0,s.useRef)(null),xe=(0,s.useRef)(new Set),he=(0,s.useRef)(null),{hasPermission:ge}=(0,c.S)(),be=ge("requests","both","table");(0,s.useEffect)((()=>{if(!t&&ce.length>0){(async()=>{for(const t of ce)try{await l.A.delete(p.Sn.REQUESTS.ATTACHMENT(i.id,t)),v.v.log("Attachment ".concat(t," gel\xf6scht (Modal ohne Speichern geschlossen)"))}catch(e){console.error("Fehler beim L\xf6schen von Attachment ".concat(t,":"),e)}ue([])})()}}),[t,ce,i.id]),(0,s.useEffect)((()=>{const e=()=>{se(window.innerWidth<640),C(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,s.useEffect)((()=>()=>{xe.current.forEach((e=>{URL.revokeObjectURL(e)})),xe.current.clear()}),[]),(0,s.useEffect)((()=>()=>{he.current&&(clearTimeout(he.current),he.current=null)}),[t]),(0,s.useEffect)((()=>(t?N():R(),()=>{R()})),[t,N,R]),(0,s.useEffect)((()=>{if(t){ye(),ve();const e=i.type||"other",t=i.dueDate?i.dueDate.split("T")[0]:"";if(_(i.title),T(j(i.description||"")),B(i.responsible.id),F(i.branch.id),O(e),I(i.isPrivate||!1),V(i.createTodo),t){const r=f(e);W(t<r?w(e):t)}else W(w(e))}}),[t,i]);const ye=async()=>{try{G(null);if(!localStorage.getItem("token"))return void G(o("createRequest.editRequest.errors.notAuthenticated"));const[e,t]=await Promise.all([l.A.get(p.Sn.USERS.DROPDOWN),l.A.get(p.Sn.BRANCHES.BASE)]);Y(e.data||[]),Q(t.data||[])}catch(r){console.error("Unerwarteter Fehler:",r);const s=r;var e,t;if("ERR_NETWORK"===s.code)G(o("createRequest.editRequest.errors.connectionError"));else G("".concat(o("createRequest.editRequest.errors.loadError"),": ").concat((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message))}},ve=async()=>{try{G(null);const e=await l.A.get(p.Sn.REQUESTS.ATTACHMENTS(i.id));ne(e.data||[])}catch(r){var e,t;console.error("Fehler beim Laden der Anh\xe4nge:",r),ne([]);const s=r,a=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message;console.warn("Anh\xe4nge konnten nicht geladen werden: ".concat(a))}},fe=async e=>{const t=e.clipboardData.items;for(let r=0;r<t.length;r++){const s=t[r];if(0===s.type.indexOf("image")){e.preventDefault();const t=s.getAsFile();return void(t&&await je(t))}}},we=async e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];await je(t)}},ke=e=>{e.preventDefault(),e.stopPropagation()},je=async e=>{oe(!0),G(null);try{const t=new FormData;t.append("file",e);const r=(await l.A.post(p.Sn.REQUESTS.ATTACHMENTS(i.id),t,{headers:{"Content-Type":"multipart/form-data"}})).data;if(ne([...ae,r]),ue((e=>[...e,r.id])),!r.fileType.startsWith("image/")){const e="\n[".concat(r.fileName,"](").concat((0,p.S1)(i.id,r.id),")\n");if(me.current){const t=me.current.selectionStart,r=E.substring(0,t),s=E.substring(t);T(r+e+s),he.current&&clearTimeout(he.current),he.current=setTimeout((()=>{if(me.current){const r=t+e.length;me.current.selectionStart=r,me.current.selectionEnd=r,me.current.focus()}he.current=null}),0)}else T(E+e)}const s=document.createElement("img");s.src=(0,p.S1)(i.id,r.id),s.alt=r.fileName,s.classList.add("hidden"),document.body.appendChild(s),s.onload=()=>{document.body.removeChild(s)}}catch(s){var t,r;console.error("Fehler beim Hochladen der Datei:",s);const e=s;G((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||o("createRequest.editRequest.errors.unknownError"))}finally{oe(!1)}},Ne=async e=>{const t=e.target.files;if(!t||0===t.length)return;const r=t[0];await je(r),pe.current&&(pe.current.value="")},qe=async e=>{e.preventDefault(),G(null),te(!0);try{if(!localStorage.getItem("token"))throw new Error(o("createRequest.editRequest.errors.notAuthenticated"));const e=i.description||"";let t=E||"";const s=ae.filter((e=>{var t;return(null===(t=e.fileType)||void 0===t?void 0:t.startsWith("image/"))&&e.id})),a=/!\[([^\]]*)\]\([^)]+\)/g,d=[];let c;if(e)for(;null!==(c=a.exec(e));)d.push(c[0]);for(const r of s){const e=(0,p.S1)(i.id,r.id),s="![".concat(r.fileName,"](").concat(e,")"),a=r.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp("!\\[".concat(a,"\\]\\([^)]+\\)"),"g").test(t)||(t=t?"".concat(t,"\n").concat(s):s)}for(const r of d)t.includes(r)||(t=t?"".concat(t,"\n").concat(r):r);await l.A.put(p.Sn.REQUESTS.BY_ID(i.id),{title:D,description:t,responsible_id:L,branch_id:M,type:z,is_private:U,due_date:P||null,create_todo:H});const u=await l.A.get(p.Sn.REQUESTS.BY_ID(i.id));u.data.attachments?u.data.attachments=u.data.attachments.map((e=>({id:e.id,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,filePath:e.filePath,uploadedAt:e.uploadedAt,url:(0,p.S1)(i.id,e.id)}))):u.data.attachments=[],ue([]),r(),n&&n(u.data)}catch(a){var t,s;console.error("Fehler beim Aktualisieren des Requests:",a);const e=a;G((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||o("createRequest.editRequest.errors.unknownError"))}finally{te(!1)}},Ae=async()=>{if(J)try{te(!0),await l.A.delete(p.Sn.REQUESTS.BY_ID(i.id)),r()}catch(s){var e,t;console.error("Delete Error:",s);const r=s;G((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||r.message||o("createRequest.editRequest.errors.unknownError"))}finally{te(!1)}else X(!0)},Re=()=>0===ae.length?null:(0,k.jsx)("div",{className:"mt-2",children:(0,k.jsx)("ul",{className:"flex flex-wrap gap-2",children:ae.map((e=>(0,k.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,k.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,k.jsxs)("div",{className:"flex ml-2",children:[(0,k.jsxs)("div",{className:"relative group mr-1",children:[(0,k.jsx)("button",{type:"button",onClick:()=>(async e=>{try{if(void 0===e.id)throw new Error("Anhang-ID fehlt");const t=await l.A.get(p.Sn.REQUESTS.ATTACHMENT(i.id,e.id),{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=r,s.setAttribute("download",e.fileName),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(r)}catch(s){var t,r;console.error("Fehler beim Herunterladen des Anhangs:",s);const e=s;G((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||o("createRequest.editRequest.errors.unknownError"))}})(e),className:"text-blue-600 hover:text-blue-900",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.editRequest.form.download")})]}),(0,k.jsxs)("div",{className:"relative group ml-1",children:[(0,k.jsx)("button",{type:"button",onClick:()=>void 0!==e.id&&(async e=>{try{G(null);const t=ae.find((t=>t.id===e));if(t&&(await l.A.delete(p.Sn.REQUESTS.ATTACHMENT(i.id,e)),ne(ae.filter((t=>t.id!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp("!\\[(.*?)\\]\\(".concat(e,"\\)"),"g"),s=new RegExp("\\[(.*?)\\]\\(".concat(e,"\\)"),"g"),a=E.replace(r,"").replace(s,"").replace(/\n{3,}/g,"\n\n");T(a)}}catch(s){var t,r;console.error("Fehler beim L\xf6schen des Anhangs:",s);const e=s;G((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message||o("createRequest.editRequest.errors.unknownError"))}})(e.id),className:"text-red-600 hover:text-red-900",disabled:void 0===e.id,children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.editRequest.form.remove")})]})]}),e.fileType.startsWith("image/")&&e.id&&(0,k.jsx)("div",{className:"absolute z-10 bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,k.jsx)("img",{src:(0,p.S1)(i.id,e.id),alt:e.fileName,className:"max-w-[200px] max-h-[150px] object-contain"})})]},e.id||"temp-".concat(e.fileName))))})}),Se=()=>0===le.length?null:(0,k.jsx)("div",{className:"mt-2",children:(0,k.jsx)("ul",{className:"flex flex-wrap gap-2",children:le.map(((e,t)=>(0,k.jsxs)("li",{className:"inline-flex items-center bg-gray-100 rounded-md px-2 py-1 relative group",children:[(0,k.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.fileName}),(0,k.jsx)("div",{className:"flex ml-2",children:(0,k.jsxs)("div",{className:"relative group ml-1",children:[(0,k.jsx)("button",{type:"button",onClick:()=>(e=>{const t=le[e];if(t&&(de(le.filter(((t,r)=>r!==e))),t.fileName)){const e=t.fileName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=o("createRequest.editRequest.form.uploadAfterCreate"),s=new RegExp("!\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),a=new RegExp("\\[".concat(e,"\\]\\(").concat(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\)"),"g"),n=E.replace(s,"").replace(a,"").replace(/\n{3,}/g,"\n\n");T(n)}})(t),className:"text-red-600 hover:text-red-900",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.editRequest.form.remove")})]})}),e.fileType.startsWith("image/")&&e.file&&(0,k.jsx)("div",{className:"absolute z-10 bg-white p-2 rounded-md shadow-lg -top-32 left-0 border border-gray-200 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,k.jsx)(A,{file:e.file,alt:e.fileName,blobUrlsRef:xe})})]},"temp-".concat(t))))})});if(!t)return null;const Ce=()=>(0,k.jsxs)("form",{onSubmit:qe,className:"space-y-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.title")}),(0,k.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:D,onChange:e=>_(e.target.value)})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{htmlFor:"description_request_edit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.description")}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)("textarea",{ref:me,rows:re?5:10,className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:E,onChange:e=>T(e.target.value),onPaste:fe,onDrop:we,onDragOver:ke}),(0,k.jsxs)("div",{className:"relative group absolute bottom-2 left-2",children:[(0,k.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=pe.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400 focus:outline-none",children:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.editRequest.form.fileUpload")})]}),(0,k.jsx)("input",{ref:pe,type:"file",onChange:Ne,className:"hidden"}),ie&&(0,k.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-70 dark:bg-opacity-70",children:(0,k.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o("createRequest.editRequest.form.uploading")})})]}),Re(),Se()]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.responsible")}),(0,k.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:L,onChange:e=>B(Number(e.target.value)),children:$.map((e=>(0,k.jsxs)("option",{value:e.id,children:[e.firstName," (",e.username,")"]},e.id)))})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.branch")}),(0,k.jsx)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:M,onChange:e=>F(Number(e.target.value)),children:K.map((e=>(0,k.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.type")}),(0,k.jsxs)("select",{className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:z,onChange:e=>(e=>{const t=f(e),r=w(e);O(e);const s=P?new Date(P):null,a=new Date(t);(!s||s<a)&&W(r)})(e.target.value),children:[(0,k.jsx)("option",{value:"event",children:o("requests.types.event")}),(0,k.jsx)("option",{value:"repair",children:o("requests.types.repair")}),(0,k.jsx)("option",{value:"improvement_suggestion",children:o("requests.types.improvement_suggestion")}),(0,k.jsx)("option",{value:"buy_order",children:o("requests.types.buy_order")}),(0,k.jsx)("option",{value:"employment_certificate",children:o("requests.types.employment_certificate")}),(0,k.jsx)("option",{value:"vacation",children:o("requests.types.vacation")}),(0,k.jsx)("option",{value:"permit",children:o("requests.types.permit")}),(0,k.jsx)("option",{value:"sick_leave",children:o("requests.types.sick_leave")}),(0,k.jsx)("option",{value:"other",children:o("requests.types.other")})]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.dueDate")}),(0,k.jsx)("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",value:P,min:f(z),onChange:e=>{const t=e.target.value,r=f(z);W(t&&t<r?r:t)}})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"is_private_edit",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:border-gray-600",checked:U,onChange:e=>I(e.target.checked)}),(0,k.jsx)("label",{htmlFor:"is_private_edit",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.isPrivate")})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("input",{type:"checkbox",id:"create_todo_edit",className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:border-gray-600",checked:H,onChange:e=>V(e.target.checked)}),(0,k.jsx)("label",{htmlFor:"create_todo_edit",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:o("createRequest.editRequest.form.createTodo")})]}),(0,k.jsxs)("div",{className:"flex justify-between pt-4",children:[be&&(0,k.jsx)("button",{type:"button",onClick:Ae,className:"p-2 rounded-md ".concat(J?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"),title:o(J?"createRequest.editRequest.form.confirmDelete":"createRequest.editRequest.form.delete"),children:J?(0,k.jsx)(b.A,{className:"h-5 w-5"}):(0,k.jsx)(q.A,{className:"h-5 w-5"})}),(0,k.jsxs)("div",{className:"flex gap-2",children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o("createRequest.editRequest.form.cancel")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:ee,children:ee?(0,k.jsx)(g.A,{className:"h-5 w-5 animate-spin"}):(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:o(ee?"createRequest.editRequest.form.saving":"createRequest.editRequest.form.save")})]})]})]})]});return re?(0,k.jsxs)(x.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,k.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,k.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,k.jsxs)(x.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,k.jsx)(x.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("createRequest.editRequest.title")}),(0,k.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4",children:[Z&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Z}),Ce()]})]})})]}):(0,k.jsxs)(k.Fragment,{children:[t&&!S&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,k.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,k.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("createRequest.editRequest.title")}),(0,k.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,k.jsx)(h.A,{className:"h-6 w-6"})})]}),(0,k.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Z&&(0,k.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Z}),Ce()]})]})]})};var S=r(8897),C=r(4426),D=r(7829),_=r(1853),E=r(8662),T=r(2704),L=r(4850),B=r(1663),M=r(8010),F=r(1909),z=r(1252),O=r(9399),U=r(2811),I=r(3744),P=r(6238),W=r(4129),H=r(7988),V=r(2415),$=r(887),Y=r(6896),K=r(957),Q=r(637),Z=r(1052);const G=e=>{switch(e){case"vacation":return"\ud83c\udfd6\ufe0f";case"improvement_suggestion":return"\ud83d\udca1";case"sick_leave":return"\ud83e\udd12";case"employment_certificate":return"\ud83d\udcc4";case"event":return"\ud83d\udcc5";case"permit":return"\ud83d\udccb";case"buy_order":return"\ud83d\uded2";case"repair":return"\ud83d\udd27";default:return"\ud83d\udcdd"}},J=["title","requestedByResponsible","status","type","dueDate","branch","actions"],X="requests-table",ee=200,te={title:["title"],status:["status"],type:["type"],requestedByResponsible:["requestedBy","responsible"],branch:["branch"],dueDate:["dueDate"],actions:[],description:["description"]},re={title:"title",status:"status",type:"type",requestedBy:"requestedByResponsible",responsible:"requestedByResponsible",branch:"branch",dueDate:"dueDate",description:"description"},se=()=>{const{t:e}=(0,a.Bd)(),[t,r]=(0,s.useState)([]),[n,x]=(0,s.useState)(0),[y,v]=(0,s.useState)(!0),[f,w]=(0,s.useState)(!1),[j,q]=(0,s.useState)(!1),[A,se]=(0,s.useState)(null),[ae,ne]=(0,s.useState)(""),[ie,oe]=(0,s.useState)([]),[le,de]=(0,s.useState)([]),[ce,ue]=(0,s.useState)(""),[me,pe]=(0,s.useState)(null),[xe,he]=(0,s.useState)(!1),[ge,be]=(0,s.useState)(!1),[ye,ve]=(0,s.useState)(!1),[fe,we]=(0,s.useState)(null),{user:ke}=(0,d.As)(),{hasPermission:je}=(0,c.S)(),Ne=(0,s.useMemo)((()=>[{id:"title",label:e("requests.columns.title"),shortLabel:e("requests.columns.title")},{id:"status",label:e("requests.columns.status"),shortLabel:e("requests.columns.status")},{id:"type",label:e("requests.columns.type"),shortLabel:e("requests.columns.type")},{id:"requestedByResponsible",label:e("requests.columns.requestedByResponsible"),shortLabel:e("requests.columns.requestedByResponsible").split("/")[0]},{id:"branch",label:e("requests.columns.branch"),shortLabel:e("requests.columns.branch").substring(0,5)},{id:"dueDate",label:e("requests.columns.dueDate"),shortLabel:e("requests.columns.dueDate").substring(0,5)},{id:"actions",label:e("requests.columns.actions"),shortLabel:e("common.actions").substring(0,3)}]),[e]),{settings:qe,isLoading:Ae,updateColumnOrder:Re,updateHiddenColumns:Se,toggleColumnVisibility:Ce,isColumnVisible:De,updateViewMode:_e,updateSortConfig:Ee}=(0,u.F)("dashboard_requests",{defaultColumnOrder:J,defaultHiddenColumns:[],defaultViewMode:"cards"}),[Te,Le]=(0,s.useState)(null),[Be,Me]=(0,s.useState)(null),Fe=(0,s.useRef)(!1),ze=qe.viewMode||"cards",Oe=(0,s.useMemo)((()=>qe.sortConfig||{key:"dueDate",direction:"asc"}),[qe.sortConfig]),Ue=(0,s.useCallback)(((e,t)=>{Ee({key:e,direction:t})}),[Ee]),Ie=(0,s.useMemo)((()=>(e=>{const t=[];return e.forEach((e=>{const r=te[e];r&&r.length>0&&t.push(...r)})),t.includes("type")||t.push("type"),e.includes("requestedByResponsible")&&(t.includes("requestedBy")||t.push("requestedBy"),t.includes("responsible")||t.push("responsible")),t.includes("description")||t.push("description"),t})(qe.columnOrder||J)),[qe.columnOrder]),[Pe,We]=(0,s.useState)((()=>{const e=(qe.hiddenColumns||[]).includes("requestedByResponsible");return{requestedBy:!e,responsible:!e}}));(0,s.useEffect)((()=>{if(Fe.current)return void(Fe.current=!1);const e=(qe.hiddenColumns||[]).includes("requestedByResponsible");We((t=>{if(e){if(!0===t.requestedBy||!0===t.responsible)return{requestedBy:!1,responsible:!1}}else if(!1===t.requestedBy&&!1===t.responsible)return{requestedBy:!0,responsible:!0};return t}))}),[qe.hiddenColumns]);const He=(0,s.useMemo)((()=>{const e=(e=>{const t=new Set,r=e.includes("requestedByResponsible");return e.forEach((e=>{"type"!==e&&("requestedByResponsible"!==e?(te[e]||[]).forEach((e=>{"type"!==e&&t.add(e)})):r&&(t.add("requestedBy"),t.add("responsible")))})),t})(qe.hiddenColumns||[]);return Pe.requestedBy?e.delete("requestedBy"):e.add("requestedBy"),Pe.responsible?e.delete("responsible"):e.add("responsible"),e}),[qe.hiddenColumns,Pe]),Ve=(0,s.useMemo)((()=>new Set(Ie.filter((e=>!He.has(e))))),[Ie,He]);(0,s.useEffect)((()=>{const e=document.querySelector(".dashboard-requests-wrapper");e&&("cards"===ze?e.classList.add("cards-mode"):e.classList.remove("cards-mode"))}),[ze]);const $e=(0,s.useCallback)((async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;try{s?q(!0):w(!0);const d={limit:a,offset:n,includeAttachments:"true"};e?d.filterId=e:t&&t.length>0&&(d.filterConditions=JSON.stringify({conditions:t,operators:o||[]}));const c=(await l.A.get("/requests",{params:d})).data;let u=[],m=0,h=!1;if(!c||"object"!==typeof c)throw new Error("Ung\xfcltige Response-Struktur: responseData ist kein Objekt (Typ: ".concat(typeof c,")"));if(Array.isArray(c.data))u=c.data,m=c.totalCount||u.length,h=void 0!==c.hasMore?c.hasMore:n+u.length<m;else{if(!Array.isArray(c))throw new Error("Ung\xfcltige Response-Struktur: responseData.data ist kein Array (Typ: ".concat(typeof c.data,")"));u=c,m=u.length,h=!1}if(!Array.isArray(u))throw new Error("Ung\xfcltige Response-Struktur: requestsData ist kein Array (Typ: ".concat(typeof u,")"));const g=u.map((e=>{const t=(e.attachments||[]).map((t=>({id:t.id,fileName:t.fileName,fileType:t.fileType,fileSize:t.fileSize,filePath:t.filePath,uploadedAt:t.uploadedAt,url:(0,p.S1)(e.id,t.id)})));return(0,i.A)((0,i.A)({},e),{},{attachments:t})}));r(s?e=>{const t=[...e,...g];return t.length>ee?t.slice(-200):t}:g),x(m),v(h),se(null)}catch(h){0;const e=h;if(!s)if("ERR_NETWORK"===e.code)se("Verbindung zum Server konnte nicht hergestellt werden. Bitte stellen Sie sicher, dass der Server l\xe4uft.");else{var d,c,u,m;const t=(null===(d=e.response)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.message)||(null===(u=e.response)||void 0===u||null===(m=u.data)||void 0===m?void 0:m.error)||e.message||"Unbekannter Fehler";se("Fehler beim Laden der Requests: ".concat(t))}}finally{s?q(!1):w(!1)}}),[]),Ye=(0,s.useRef)(null),Ke=(0,s.useRef)(t.length);(0,s.useEffect)((()=>{Ke.current=t.length}),[t.length]);const Qe=(0,s.useCallback)((e=>{const t=qe.sortConfig||{key:"dueDate",direction:"asc"},r=t.key===e&&"asc"===t.direction?"desc":"asc";Ee({key:e,direction:r})}),[qe.sortConfig,Ee]),Ze=async(e,s)=>{try{const a=t.find((t=>t.id===e));if(!a)return void se("Request nicht gefunden");r((t=>t.map((t=>t.id===e?(0,i.A)((0,i.A)({},t),{},{status:s}):t)))),await l.A.put("/requests/".concat(e),{status:s,create_todo:a.createTodo})}catch(o){var a,n;0,$e();const e=o;se("Fehler beim Aktualisieren des Status: ".concat((null===(a=e.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten"))}},Ge=(0,s.useCallback)(((e,t)=>{const r=[...qe.columnOrder],s=r[e];r.splice(e,1),r.splice(t,0,s),Re(r)}),[qe.columnOrder,Re]),Je=e=>{Le(e)},Xe=(e,t)=>{e.preventDefault(),Te&&Te!==t&&Me(t)},et=(e,t)=>{if(e.preventDefault(),Te&&Te!==t){const e=qe.columnOrder.indexOf(Te),r=qe.columnOrder.indexOf(t);e>-1&&r>-1&&Ge(e,r)}Le(null),Me(null)},tt=()=>{Le(null),Me(null)},rt=(0,s.useCallback)((async(e,t)=>{oe(e),de(t),pe(null),ue(""),Ee({key:"dueDate",direction:"asc"}),e.length>0?await $e(void 0,e,!1,20,0,t):await $e(void 0,void 0,!1,20,0,[])}),[$e,Ee]),st=()=>{oe([]),de([]),ue(""),pe(null)},at=(0,s.useRef)(!1),nt=(0,s.useCallback)((async(e,t,r,s)=>{ue(e),pe(t),Ee({key:"dueDate",direction:"asc"}),t?(oe(r),de(s),await $e(t,void 0,!1,20,0)):await rt(r,s)}),[$e,Ee,rt]),it=(0,m.b)(),{loadFilters:ot}=it;(0,s.useEffect)((()=>{if(at.current)return;(async()=>{at.current=!0;try{const e=(await ot(X)).find((e=>"Aktuell"===e.name));if(e)return void await nt(e.name,e.id,e.conditions,e.operators);await $e(void 0,void 0,!1,20,0)}catch(A){at.current=!1}})()}),[]);const lt=(0,s.useMemo)((()=>t.filter((e=>{if(ae){const t=ae.toLowerCase();if(e.title.toLowerCase().includes(t))return!0;if(e.branch.name.toLowerCase().includes(t))return!0;if("".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName).toLowerCase().includes(t))return!0;return!!"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase().includes(t)}return!0})).sort(((e,t)=>{const r=(e,t)=>{var r,s;switch(t){case"title":return e.title.toLowerCase();case"status":return null!==(r={approval:0,to_improve:1,approved:2,denied:3}[e.status])&&void 0!==r?r:999;case"type":return null!==(s={vacation:0,improvement_suggestion:1,sick_leave:2,employment_certificate:3,other:4}[e.type||"other"])&&void 0!==s?s:999;case"requestedBy":case"requestedByResponsible":return"".concat(e.requestedBy.firstName," ").concat(e.requestedBy.lastName).toLowerCase();case"responsible":return"".concat(e.responsible.firstName," ").concat(e.responsible.lastName).toLowerCase();case"branch":case"branch.name":return e.branch.name.toLowerCase();case"dueDate":return new Date(e.dueDate).getTime();case"description":return(e.description||"").toLowerCase();default:return""}};if(Oe.key){const s=r(e,Oe.key),a=r(t,Oe.key);let n=0;if("number"===typeof s&&"number"===typeof a)n=s-a;else{const e="string"===typeof s?s:String(s),t="string"===typeof a?a:String(a);n=e.localeCompare(t)}if(0!==n)return"asc"===Oe.direction?n:-n}return 0}))),[t,me,ae,Oe]),dt=(0,s.useRef)(le);(0,s.useEffect)((()=>{dt.current=le}),[le]),(0,s.useEffect)((()=>{const e=new IntersectionObserver((e=>{if(e[0].isIntersecting&&y&&!j&&!f){const e=Ke.current;$e(me||void 0,ie.length>0?ie:void 0,!0,20,e,dt.current)}}),{threshold:.1});return Ye.current&&e.observe(Ye.current),()=>{e.disconnect()}}),[y,j,f,me,ie,$e]);const ct=async e=>{try{if(!ke)return void se("Benutzer nicht authentifiziert");const t={title:"".concat(e.title,"-Kopie"),responsible_id:e.responsible.id,branch_id:e.branch.id,type:e.type||"other",is_private:e.isPrivate||!1,due_date:e.dueDate?e.dueDate.split("T")[0]:"",create_todo:e.createTodo,requested_by_id:ke.id},s=await l.A.post(p.Sn.REQUESTS.BASE,t);r((e=>{const t=[s.data,...e];return t.length>ee?t.slice(0,ee):t})),we(s.data),ve(!0)}catch(a){var t,s;0;const e=a;se((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message||"Ein unerwarteter Fehler ist aufgetreten")}};if(f&&0===t.length)return(0,k.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:(0,k.jsx)(Q.A,{children:Array(3).fill(null).map(((e,t)=>(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,k.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,k.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))})});if(A)return(0,k.jsx)("div",{className:"p-4 text-red-600",children:A});const ut=qe.columnOrder.filter((e=>De(e)));return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(N,{isOpen:ge,onClose:()=>be(!1),onRequestCreated:e=>{r((t=>{const r=[e,...t];return r.length>ee?r.slice(0,ee):r})),ve(!0),we(e)}}),fe&&(0,k.jsx)(R,{isOpen:ye,onClose:()=>{ve(!1),we(null)},onRequestUpdated:e=>{r((t=>t.map((t=>t.id===e.id?e:t)))),ve(!1),we(null)},request:fe}),(0,k.jsxs)("div",{className:"flex items-center mb-4 justify-between px-3 sm:px-4 md:px-6",children:[(0,k.jsx)("div",{className:"flex items-center",children:je("requests","write","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>be(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},"aria-label":e("requests.createRequest"),"data-onboarding":"create-request-button",children:(0,k.jsx)(E.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.createRequest")})]})}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)(T.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,k.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("requests.title")})]}),(0,k.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,k.jsx)("input",{type:"text",placeholder:e("common.search")+"...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:ae,onChange:e=>ne(e.target.value)}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 ".concat("cards"===ze?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":""),onClick:()=>_e("table"===ze?"cards":"table"),children:"table"===ze?(0,k.jsx)(L.A,{className:"h-5 w-5"}):(0,k.jsx)(B.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("table"===ze?"common.viewAsCards":"common.viewAsTable")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsxs)("button",{className:"p-2 rounded-md ".concat(ie.length>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1"),onClick:()=>he(!xe),children:[(0,k.jsx)(M.A,{className:"h-5 w-5"}),ie.length>0&&(0,k.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center z-10",style:{position:"absolute",top:"-0.25rem",right:"-0.25rem"},children:ie.length})]}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.filter")})]}),(0,k.jsx)("div",{className:"ml-1",children:(0,k.jsx)(S.A,{columns:"cards"===ze?[{id:"title",label:e("requests.columns.title")},{id:"status",label:e("requests.columns.status")},{id:"type",label:e("requests.columns.type")},{id:"requestedBy",label:e("requests.columns.requestedBy")},{id:"responsible",label:e("requests.columns.responsible")},{id:"branch",label:e("requests.columns.branch")},{id:"dueDate",label:e("requests.columns.dueDate")},{id:"description",label:e("common.description")}]:Ne,visibleColumns:"cards"===ze?Array.from(Ve):ut,columnOrder:"cards"===ze?Ie:qe.columnOrder,onToggleColumnVisibility:e=>{if("cards"===ze){const t=re[e];if(t)if("requestedByResponsible"===t){const r=(0,i.A)({},Pe);"requestedBy"===e?r.requestedBy=!r.requestedBy:"responsible"===e&&(r.responsible=!r.responsible),We(r);const s=[...qe.hiddenColumns],a=s.indexOf(t);r.requestedBy||r.responsible?-1!==a&&(s.splice(a,1),Fe.current=!0,Se(s)):-1===a&&(s.push(t),Fe.current=!0,Se(s))}else Ce(t)}else Ce(e)},buttonTitle:e("cards"===ze?"tableColumn.sortAndDisplay":"tableColumn.configure"),modalTitle:e("cards"===ze?"tableColumn.sortAndDisplay":"tableColumn.configure"),mainSortConfig:Oe,onMainSortChange:Ue,showMainSort:!0})})]})]}),xe&&(0,k.jsx)("div",{className:"cards"===ze?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,k.jsx)(C.A,{columns:[{id:"title",label:e("requests.columns.title")},{id:"type",label:e("requests.columns.type")},{id:"requestedBy",label:e("requests.columns.requestedBy").replace(":","")},{id:"responsible",label:e("requests.columns.responsible").replace(":","")},{id:"dueDate",label:e("requests.columns.dueDate")},{id:"status",label:e("requests.columns.status")},{id:"branch",label:e("requests.columns.branch")}],onApply:rt,onReset:st,savedConditions:ie,savedOperators:le,tableId:X})}),(0,k.jsx)("div",{className:"cards"===ze?"-mx-3 sm:-mx-4 md:-mx-6 px-3 sm:px-4 md:px-6":"px-3 sm:px-4 md:px-6",children:(0,k.jsx)(D.A,{tableId:X,onSelectFilter:(e,t)=>rt(e,t),onReset:st,activeFilterName:ce,selectedFilterId:me,onFilterChange:(e,t,r,s)=>nt(e,t,r,s),defaultFilterName:"Aktuell"})}),"table"===ze?(0,k.jsx)("div",{className:"overflow-x-auto",children:(0,k.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,k.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,k.jsx)("tr",{children:ut.map((e=>{const t=Ne.find((t=>t.id===e));if(!t)return null;if("requestedByResponsible"===e)return(0,k.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-move relative",draggable:!0,onDragStart:()=>Je(e),onDragOver:t=>Xe(t,e),onDrop:t=>et(t,e),onDragEnd:tt,children:(0,k.jsxs)("div",{className:"flex items-center ".concat(Be===e?"border-l-2 pl-1 border-blue-500":""," ").concat(Te===e?"opacity-50":""),children:[(0,k.jsx)(F.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,k.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,k.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel})]})},e);let r;return"title"===e&&(r="title"),"status"===e&&(r="status"),"type"===e&&(r="type"),"branch"===e&&(r="branch.name"),"dueDate"===e&&(r="dueDate"),(0,k.jsx)("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider relative ".concat(r?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""," ").concat("actions"!==e?"cursor-move":""),onClick:r?()=>Qe(r):void 0,draggable:"actions"!==e,onDragStart:"actions"!==e?()=>Je(e):void 0,onDragOver:"actions"!==e?t=>Xe(t,e):void 0,onDrop:"actions"!==e?t=>et(t,e):void 0,onDragEnd:"actions"!==e?tt:void 0,children:(0,k.jsxs)("div",{className:"flex items-center ".concat(Be===e?"border-l-2 pl-1 border-blue-500":""," ").concat(Te===e?"opacity-50":""),children:["actions"!==e&&(0,k.jsx)(F.A,{className:"h-3 w-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,k.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,k.jsx)("span",{className:"inline sm:hidden",children:t.shortLabel}),r&&Oe.key===r&&("asc"===Oe.direction?"\u2191":"\u2193")]})},e)}))})}),(0,k.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===lt.length?(0,k.jsx)("tr",{children:(0,k.jsx)("td",{colSpan:ut.length,className:"px-3 py-4 text-center text-gray-500 dark:text-gray-400",children:(0,k.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,k.jsx)(T.A,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"}),(0,k.jsx)("div",{className:"text-sm",children:"Keine Requests gefunden"})]})})}):(0,k.jsx)(k.Fragment,{children:lt.map((t=>{const r=(0,Z.go)(t.dueDate,"request"),s=(0,Z.F2)(r);return(0,k.jsx)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 ".concat("none"!==r?"".concat(s.bgClass," ").concat(s.borderClass," border-l-4"):""),children:ut.map((r=>{switch(r){case"title":return(0,k.jsx)("td",{className:"px-3 sm:px-4 md:px-6 py-4",children:(0,k.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 break-words flex items-center",children:[t.title,t.description&&(0,k.jsxs)("div",{className:"ml-2 relative group",children:[(0,k.jsx)("button",{className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:(0,k.jsx)(z.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-0 mt-2 p-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-lg rounded-md border border-gray-200 dark:border-gray-700 w-144 max-h-96 overflow-y-auto min-w-[36rem] z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,k.jsx)(Y.A,{content:t.description,showImagePreview:!0})})]})]})},r);case"status":return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((0,_.qY)(t.status,"request")," dark:bg-opacity-30 status-col"),children:(0,_.Iw)(t.status,"request",e)})},r);case"type":return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-900 dark:text-gray-200",children:[(0,k.jsx)("span",{className:"text-lg",children:G(t.type)}),(0,k.jsx)("span",{children:t.type?e("requests.types.".concat(t.type)):e("requests.types.other")}),t.isPrivate&&(0,k.jsxs)("div",{className:"relative group inline-block ml-1",children:[(0,k.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"\ud83d\udd12"}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("createRequest.form.isPrivate")})]})]})},r);case"requestedByResponsible":return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.requestedBy"),":"]}),(0,k.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.requestedBy").substring(0,5),":"]}),(0,k.jsx)("br",{}),"".concat(t.requestedBy.firstName," ").concat(t.requestedBy.lastName)]}),(0,k.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-200 mt-1",children:[(0,k.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:[e("requests.columns.responsible"),":"]}),(0,k.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 inline sm:hidden",children:[e("requests.columns.responsible").substring(0,4),":"]}),(0,k.jsx)("br",{}),"".concat(t.responsible.firstName," ").concat(t.responsible.lastName)]})]})},r);case"branch":return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:t.branch.name})},r);case"dueDate":const s=(0,Z.go)(t.dueDate,"request"),a=(0,Z.F2)(s);return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"text-sm ".concat("none"!==s?a.textClass:"text-gray-900 dark:text-gray-200"),children:[new Date(t.dueDate).toLocaleDateString(),"none"!==s&&(0,k.jsx)("span",{className:"ml-2 text-xs",children:"\u26a0"})]})},r);case"actions":return(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"flex space-x-2 action-buttons",children:[(0,k.jsxs)("div",{className:"status-buttons",children:["approval"===t.status&&je("requests","write","table")&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"approved"),className:"p-1 bg-green-600 dark:bg-green-500 text-white rounded hover:bg-green-700 dark:hover:bg-green-600",children:(0,k.jsx)(b.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.approve")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"to_improve"),className:"p-1 bg-orange-600 dark:bg-orange-500 text-white rounded hover:bg-orange-700 dark:hover:bg-orange-600",children:(0,k.jsx)(O.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.improve")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.deny")})]})]}),"to_improve"===t.status&&je("requests","write","table")&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",children:(0,k.jsx)(g.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.recheck")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"denied"),className:"p-1 bg-red-600 dark:bg-red-500 text-white rounded hover:bg-red-700 dark:hover:bg-red-600",children:(0,k.jsx)(h.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.deny")})]})]}),("approved"===t.status||"denied"===t.status)&&je("requests","write","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>Ze(t.id,"approval"),className:"p-1 bg-yellow-600 dark:bg-yellow-500 text-white rounded hover:bg-yellow-700 dark:hover:bg-yellow-600",children:(0,k.jsx)(g.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.recheck")})]})]}),je("requests","write","table")&&(0,k.jsx)("button",{onClick:()=>{we(t),ve(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 edit-button ml-0.5",children:(0,k.jsx)(U.A,{className:"h-5 w-5"})}),je("requests","both","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:()=>ct(t),className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300 copy-button ml-0.5",children:(0,k.jsx)(I.A,{className:"h-5 w-5"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.copy")})]})]})},r);default:return null}}))},t.id)}))})})]})}):(0,k.jsx)("div",{className:"-mx-3 sm:-mx-4 md:-mx-6",children:f&&0===t.length?(0,k.jsx)(Q.A,{children:Array(3).fill(null).map(((e,t)=>(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-3 sm:p-4 md:p-5 lg:p-6 shadow-sm",children:(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-12"}),(0,k.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded flex-1 min-w-0"})]}),(0,k.jsx)("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),(0,k.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]})},"skeleton-".concat(t))))}):0===lt.length?(0,k.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[(0,k.jsx)(T.A,{className:"h-10 w-10 mb-4 text-gray-400 dark:text-gray-500"}),(0,k.jsx)("div",{className:"text-sm",children:e("requests.createRequest.noRequestsFound")})]}):(0,k.jsx)(Q.A,{children:lt.map((t=>{const r=[];if(Ve.has("branch")&&r.push({icon:(0,k.jsx)(P.A,{className:"h-4 w-4"}),label:e("requests.columns.branch"),value:t.branch.name,section:"left"}),Ve.has("type")){const s=G(t.type),a=t.type?e("requests.types.".concat(t.type)):e("requests.types.other");r.push({label:"",value:"".concat(s," ").concat(a).concat(t.isPrivate?" \ud83d\udd12":""),section:"main"})}if(Ve.has("requestedBy")){const s="".concat(t.requestedBy.firstName," ").concat(t.requestedBy.lastName),a=s.length>4?s.substring(0,4):s;r.push({icon:(0,k.jsx)(W.A,{className:"h-4 w-4"}),label:e("requests.columns.requestedBy"),value:a,section:"main-second"})}if(Ve.has("responsible")){const s="".concat(t.responsible.firstName," ").concat(t.responsible.lastName),a=s.length>4?s.substring(0,4):s;r.push({icon:(0,k.jsx)(W.A,{className:"h-4 w-4"}),label:e("requests.columns.responsible"),value:a,section:"main-third"})}if(Ve.has("dueDate")){const s=(0,Z.Rj)(t.dueDate,"request",void 0,void 0,(0,k.jsx)(H.A,{className:"h-4 w-4"}),e("requests.columns.dueDate"),(e=>(0,V.GP)(e,"dd.MM.yyyy",{locale:$.de})),!1);r.push((0,i.A)((0,i.A)({},s),{},{section:"right-inline"}))}Ve.has("description")&&t.description&&r.push({label:e("common.description"),value:"",descriptionContent:t.description,attachmentMetadata:t.attachments||[],section:"full"});const s=(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:["approval"===t.status&&je("requests","write","table")&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"approved")},className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700",children:(0,k.jsx)(b.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.approve")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"to_improve")},className:"p-1.5 bg-orange-600 text-white rounded hover:bg-orange-700",children:(0,k.jsx)(O.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.improve")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",children:(0,k.jsx)(h.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.deny")})]})]}),"to_improve"===t.status&&je("requests","write","table")&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",children:(0,k.jsx)(g.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.recheck")})]}),(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"denied")},className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",children:(0,k.jsx)(h.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.deny")})]})]}),("approved"===t.status||"denied"===t.status)&&je("requests","write","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),Ze(t.id,"approval")},className:"p-1.5 bg-yellow-600 text-white rounded hover:bg-yellow-700",children:(0,k.jsx)(g.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.recheck")})]}),je("requests","write","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),we(t),ve(!0)},className:"p-1.5 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:(0,k.jsx)(U.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("common.edit")})]}),je("requests","both","table")&&(0,k.jsxs)("div",{className:"relative group",children:[(0,k.jsx)("button",{onClick:e=>{e.stopPropagation(),ct(t)},className:"p-1.5 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:(0,k.jsx)(I.A,{className:"h-4 w-4"})}),(0,k.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-50",children:e("requests.actions.copy")})]})]}),a=(e=>{switch(e){case"to_improve":case"approved":case"denied":return"approval";default:return null}})(t.status),n=(e=>{switch(e){case"approval":return["approved","to_improve","denied"];case"to_improve":return["denied"];default:return[]}})(t.status),o=n.length>0?n[0]:null;return(0,k.jsx)(K.A,{title:(0,k.jsxs)("span",{children:[(0,k.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[t.id,":"]})," ",(0,k.jsx)("span",{children:t.title})]}),status:{label:(0,_.Iw)(t.status,"request",e),color:(0,_.qY)(t.status,"request"),onPreviousClick:a&&je("requests","write","table")?()=>Ze(t.id,a):void 0,onNextClick:o&&je("requests","write","table")?()=>Ze(t.id,o):void 0},metadata:r,actions:s},t.id)}))})}),y&&(0,k.jsx)("div",{ref:Ye,className:"flex justify-center py-4",children:j&&(0,k.jsx)(o.A,{size:24})})]})};var ae=r(2316);function ne(e,t){return(0,ae.a)(e,null===t||void 0===t?void 0:t.in).getFullYear()}var ie=r(2750),oe=r(1620),le=r(4057),de=r(6511),ce=r(5648),ue=r(3315),me=r(7012),pe=r(8416),xe=r(8658),he=r(1713),ge=r(2395);const be=(e,t)=>{const[r,s,a]=e.split("-").map((e=>parseInt(e))),n=new Date(r,s-1,a,12,0,0);return n.setDate(n.getDate()+t),(0,V.GP)(n,"yyyy-MM-dd")},ye=()=>{var e,t,r,n;const{t:o,i18n:c}=(0,a.Bd)(),{activeLanguage:u}=(0,ce.o)(),{user:m}=(0,d.As)(),{organization:x}=(0,ge.Z)(),[h,g]=(0,s.useState)(null),[b,y]=(0,s.useState)(null),[v,f]=(0,s.useState)(!0),[w,j]=(0,s.useState)(null),[N,q]=(0,s.useState)(8),[A,R]=(0,s.useState)("worktime"),[S,C]=(0,s.useState)(null),[D,_]=(0,s.useState)(!1),E=(0,s.useRef)(null),T=(0,s.useRef)(null),L=(0,s.useMemo)((()=>{const e="CO"===(null===m||void 0===m?void 0:m.country),t="CO"===(null===x||void 0===x?void 0:x.country);return e||t}),[null===m||void 0===m?void 0:m.country,null===x||void 0===x?void 0:x.country]),B=(0,s.useRef)(!1),[M,F]=(0,s.useState)((()=>"CO"===(null===m||void 0===m?void 0:m.country))),z=(0,s.useMemo)((()=>{switch(u||c.language||"de"){case"es":return le.es;case"en":return de.c;default:return $.de}}),[u,c.language]),O=new Date,U=(0,s.useMemo)((()=>"".concat(ne(O),"-W").concat(String((0,ie.N)(O,{locale:z})).padStart(2,"0"))),[z]),I=(0,s.useMemo)((()=>(0,he.VY)()),[]),[P,W]=(0,s.useState)(U),[Y,K]=(0,s.useState)(I);(0,s.useEffect)((()=>{M?K(I):W(U)}),[U,I,M]);const Q=(0,oe.k)(O,{weekStartsOn:1}),Z=(0,he.M9)(I),[G,J]=(0,s.useState)((0,V.GP)(Q,"yyyy-MM-dd")),[X,ee]=(0,s.useState)(Z),te=(0,s.useMemo)((()=>M?X||(0,he.M9)((0,he.VY)()):G||(0,V.GP)((0,oe.k)(O,{weekStartsOn:1}),"yyyy-MM-dd")),[M,X,G]),[re,se]=(0,s.useState)(!1),[ae,ye]=(0,s.useState)("");(0,s.useEffect)((()=>()=>{E.current&&(clearTimeout(E.current),E.current=null),T.current&&(clearTimeout(T.current),T.current=null),g(null),y(null),C(null)}),[]),(0,s.useEffect)((()=>{m&&fe()}),[te,m,M]);const ve=async(e,t)=>{try{if(f(!0),!e)return console.error("Kein Datum zum Senden verf\xfcgbar"),j("Kein Datum verf\xfcgbar"),void f(!1);const r=t?"".concat(p.Sn.WORKTIME.STATS,"?quinzena=").concat(e):"".concat(p.Sn.WORKTIME.STATS,"?week=").concat(e),s=(await l.A.get(r)).data;if(s&&s.weeklyData)if(t){const e=(0,i.A)((0,i.A)({},s),{},{weeklyData:s.weeklyData.map((e=>(0,i.A)((0,i.A)({},e),{},{date:e.date||"",hours:e.hours||0}))).sort(((e,t)=>e.date&&t.date?e.date.localeCompare(t.date):0))}),t=(0,i.A)((0,i.A)({},e),{},{weeklyData:e.weeklyData.slice(0,5)});g(t),y(e)}else{const t={Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7,[o("worktime.days.monday")]:1,[o("worktime.days.tuesday")]:2,[o("worktime.days.wednesday")]:3,[o("worktime.days.thursday")]:4,[o("worktime.days.friday")]:5,[o("worktime.days.saturday")]:6,[o("worktime.days.sunday")]:7},r=[];for(let s=0;s<7;s++)r.push(be(e,s));const a=(0,i.A)((0,i.A)({},s),{},{weeklyData:s.weeklyData.map((e=>{const s=t[e.day];if(void 0===s)return console.error("Unbekannter Wochentag: ".concat(e.day)),e;const a=r[s-1];return(0,i.A)((0,i.A)({},e),{},{date:a})}))}),n=(0,i.A)((0,i.A)({},a),{},{weeklyData:a.weeklyData.slice(0,5)});g(n),y(a)}else{const e=s.weeklyData?(0,i.A)((0,i.A)({},s),{},{weeklyData:s.weeklyData.slice(0,5)}):s;g(e),y(s)}E.current&&clearTimeout(E.current),E.current=setTimeout((()=>{null===b&&s&&s.weeklyData&&g(s),E.current=null}),200),j(null)}catch(a){var r,s;console.error("Fehler beim Abrufen der Statistikdaten:",a),j((null===a||void 0===a||null===(r=a.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||"Fehler beim Laden der Daten")}finally{f(!1)}},fe=async()=>{ve(te,M)},we=e=>{let t,r;if(B.current=!0,F(e),e){const e=(0,he.VY)();r=e,t=(0,he.M9)(e),K(r),ee(t)}else r=U,t=(0,he.pg)(U),W(r),J(t);queueMicrotask((()=>{ve(t,e),T.current&&clearTimeout(T.current),T.current=setTimeout((()=>{B.current=!1,T.current=null}),100)}))};(0,s.useEffect)((()=>{if(!B.current)if(L&&!M){const e=(0,he.VY)();K(e);const t=(0,he.M9)(e);ee(t),F(!0),queueMicrotask((()=>{ve(t,!0)}))}else if(!L&&M){const e=(0,he.pg)(U);W(U),J(e),F(!1),queueMicrotask((()=>{ve(e,!1)}))}}),[L,M]);const ke=e=>{e?e.match(/^\d{4}-\d{2}-\d{2}$/)?(ye(e),se(!0)):console.error("Ung\xfcltiges Datum f\xfcr Modal: ".concat(e)):console.error("Kein Datum f\xfcr Modal angegeben")};(0,s.useEffect)((()=>{if(!v&&h&&h.weeklyData){const e=h.weeklyData.reduce(((e,t)=>{const r="number"===typeof t.hours?t.hours:parseFloat(t.hours);return r>e?r:e}),0);q(e)}}),[v,h]);const je=(0,s.useCallback)((async()=>{if(null!==m&&void 0!==m&&m.id)try{_(!0);const e=new Date((new Date).getFullYear(),0,1),t=new Date,r=await l.A.get(p.Sn.TOUR_BOOKINGS.COMMISSIONS(m.id),{params:{startDate:e.toISOString(),endDate:t.toISOString()}});r.data.success&&C(r.data.data)}catch(e){console.error("Fehler beim Laden der Kommissions-Daten:",e)}finally{_(!1)}}),[null===m||void 0===m?void 0:m.id]);if((0,s.useEffect)((()=>{"commissions"===A&&null!==m&&void 0!==m&&m.id&&je()}),[A,null===m||void 0===m?void 0:m.id,je]),v&&"worktime"===A)return(0,k.jsx)("div",{className:"p-4",children:o("common.loading")});if(w&&"worktime"===A)return(0,k.jsx)("div",{className:"p-4 text-red-600",children:w});if(!h&&"worktime"===A)return null;M?(0,he.lK)(X):(0,he._2)(G);const Ne=Math.max(8,Math.ceil(1.1*N)),qe=null!==(e=null===m||void 0===m?void 0:m.normalWorkingHours)&&void 0!==e?e:7.6;return(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,k.jsxs)("div",{className:"flex items-center pl-2 sm:pl-0 flex-shrink min-w-0",children:[(0,k.jsx)(ue.A,{className:"h-5 w-5 sm:h-6 sm:w-6 mr-2 dark:text-white flex-shrink-0"}),(0,k.jsx)("h2",{className:"text-base sm:text-lg md:text-xl font-semibold dark:text-white truncate",children:o("worktime.stats.title")})]}),(0,k.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-200 dark:border-gray-700",children:[(0,k.jsx)("button",{onClick:()=>R("worktime"),className:"py-2 px-3 border-b-2 font-medium text-sm ".concat("worktime"===A?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:o("worktime.stats.tabs.worktime","Arbeitszeit")}),(0,k.jsx)("button",{onClick:()=>R("commissions"),className:"py-2 px-3 border-b-2 font-medium text-sm ".concat("commissions"===A?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:o("worktime.stats.tabs.commissions","Kommissionen")})]}),(0,k.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[L&&(0,k.jsxs)("div",{className:"flex items-center rounded-lg border border-gray-300 dark:border-gray-600 p-0.5 sm:p-1 bg-gray-50 dark:bg-gray-800",children:[(0,k.jsxs)("button",{type:"button",onClick:()=>we(!1),className:"flex items-center gap-1 sm:gap-2 px-1.5 sm:px-3 py-1 sm:py-1.5 rounded-md text-sm font-medium transition-all duration-200 ".concat(M?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200":"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm"),children:[(0,k.jsx)(H.A,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),(0,k.jsx)("span",{className:"hidden sm:inline whitespace-nowrap",children:o("worktime.stats.week")}),(0,k.jsx)("span",{className:"sm:hidden whitespace-nowrap",children:"7d"})]}),(0,k.jsxs)("button",{type:"button",onClick:()=>we(!0),className:"flex items-center gap-1 sm:gap-2 px-1.5 sm:px-3 py-1 sm:py-1.5 rounded-md text-sm font-medium transition-all duration-200 ".concat(M?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:[(0,k.jsx)(me.A,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),(0,k.jsx)("span",{className:"hidden sm:inline whitespace-nowrap",children:o("worktime.stats.quinzena")}),(0,k.jsx)("span",{className:"sm:hidden whitespace-nowrap",children:"15d"})]})]}),M?(0,k.jsx)("input",{type:"text",pattern:"\\d{4}-\\d{2}-Q[12]",placeholder:"YYYY-MM-Q1",value:Y,onChange:e=>{const t=e.target.value;if((/^\d{4}-\d{2}-Q[12]$/.test(t)||""===t)&&(K(t),t.match(/^\d{4}-\d{2}-Q[12]$/))){const e=(0,he.M9)(t);ee(e),queueMicrotask((()=>{ve(e,!0)}))}},className:"border border-gray-300 dark:border-gray-600 rounded-md text-sm h-7 sm:h-10 px-1.5 sm:px-3 dark:bg-gray-700 dark:text-white min-w-28 w-28 sm:w-28",title:o("worktime.stats.quinzenaFormat")}):(0,k.jsx)("input",{type:"text",pattern:"\\d{4}-W\\d{2}",placeholder:"YYYY-Www",value:P,onChange:e=>{const t=e.target.value;if((/^\d{4}-W\d{1,2}$/.test(t)||""===t)&&(W(t),t.match(/^\d{4}-W\d{2}$/))){const e=(0,he.pg)(t);J(e),queueMicrotask((()=>{ve(e,!1)}))}},className:"border border-gray-300 dark:border-gray-600 rounded-md text-sm h-7 sm:h-10 px-1.5 sm:px-3 dark:bg-gray-700 dark:text-white min-w-28 w-28 sm:w-28",title:o("worktime.stats.weekFormat")}),(0,k.jsx)("button",{onClick:async()=>{try{localStorage.getItem("token");const e=await l.A.get("".concat(p.Sn.WORKTIME.BASE,"/export?week=").concat(G),{responseType:"blob"}),t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=o("worktime.stats.exportFilename",{week:P.split("W")[1]}),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s)}catch(w){console.error("Fehler beim Exportieren:",w),j(o("worktime.stats.export")+": "+o("common.error"))}},className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1 sm:p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center min-w-7 min-h-7 sm:min-w-8 sm:min-h-8 w-7 h-7 sm:w-8 sm:h-8",title:o("worktime.stats.export"),"aria-label":o("worktime.stats.exportTitle"),style:{marginTop:"1px",marginBottom:"1px"},children:(0,k.jsx)(pe.A,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]}),"worktime"===A&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"flex flex-row gap-2 mb-8 overflow-x-auto",children:[(0,k.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-blue-900 dark:text-blue-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:o("worktime.stats.totalHours")}),(0,k.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap text-center",children:[h.totalHours,o("worktime.stats.hourShort")]})]}),(0,k.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-green-900 dark:text-green-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:o("worktime.stats.averagePerDay")}),(0,k.jsxs)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-green-600 dark:text-green-400 whitespace-nowrap text-center",children:[h.averageHoursPerDay,o("worktime.stats.hourShort")]})]}),(0,k.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg flex-1 min-w-0",children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-purple-900 dark:text-purple-100 mb-2 whitespace-nowrap text-sm sm:text-base md:text-lg text-center",children:o("worktime.stats.workDays")}),(0,k.jsx)("p",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-purple-600 dark:text-purple-400 whitespace-nowrap text-center",children:h.daysWorked})]})]}),(0,k.jsxs)("div",{className:"mt-8",children:[(0,k.jsx)("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:o(M?"worktime.stats.quinzenaProgress":"worktime.stats.weeklyProgress")}),(0,k.jsxs)("div",{className:"relative",style:{height:"200px"},children:[(0,k.jsxs)("div",{className:"absolute right-0 h-full flex flex-col justify-between text-xs text-gray-500 dark:text-gray-400 pr-1",children:[(0,k.jsxs)("span",{children:[Ne,"h"]}),(0,k.jsxs)("span",{children:[Math.round(.75*Ne),"h"]}),(0,k.jsxs)("span",{children:[Math.round(.5*Ne),"h"]}),(0,k.jsxs)("span",{children:[Math.round(.25*Ne),"h"]}),(0,k.jsx)("span",{children:"0h"})]}),(0,k.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none pr-8",children:[(0,k.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,k.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,k.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,k.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"}),(0,k.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})]}),qe<=Ne&&(0,k.jsx)("div",{className:"absolute w-full border-t-2 border-red-600 dark:border-red-500 z-10 pr-8",style:{bottom:"".concat(qe/Ne*100,"%"),borderStyle:"dashed"},children:(0,k.jsxs)("span",{className:"absolute -top-3 right-8 text-xs text-red-600 dark:text-red-500 font-medium",children:[o("worktime.stats.target"),": ",qe,o("worktime.stats.hourShort")]})}),(0,k.jsxs)("div",{className:"absolute top-0 left-0 text-xs flex items-center gap-2",children:[(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-3 h-3 bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 rounded-sm mr-1"}),(0,k.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["\u2264 ",qe,o("worktime.stats.hourShort")]})]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-3 h-3 bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 rounded-sm mr-1"}),(0,k.jsxs)("span",{className:"text-red-600 dark:text-red-400",children:["> ",qe,o("worktime.stats.hourShort")]})]})]}),(0,k.jsx)("div",{className:"absolute inset-0 pr-8 flex items-end",children:(0,k.jsx)("div",{className:"w-full h-full flex justify-between",children:h.weeklyData.map(((e,t)=>{const r="number"===typeof e.hours?e.hours:parseFloat(e.hours),s=r>qe?(r-qe)/Ne*100:0,a=Math.min(r,qe)/Ne*100,n=e.date,i=M?(0,he.lK)(X).length:7,l=M?"".concat(100/i,"%"):"13%",d=M?"w-3/12":"w-5/12";return(0,k.jsx)("div",{className:"flex flex-col items-center",style:{width:l},children:(0,k.jsxs)("div",{className:"relative ".concat(d," h-full flex flex-col justify-end cursor-pointer"),title:o("worktime.stats.clickToView"),children:[s>0&&(0,k.jsx)("div",{className:"w-full bg-red-100 dark:bg-red-900/50 border-2 border-red-600 dark:border-red-400 hover:bg-red-200 dark:hover:bg-red-900/70 cursor-pointer",onClick:()=>ke(n),style:{height:"".concat(s,"%"),minHeight:"2px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomWidth:s>0&&a>0?"0":"2px"}}),a>0&&(0,k.jsx)("div",{className:"w-full bg-blue-100 dark:bg-blue-900/50 border-2 border-blue-600 dark:border-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/70 cursor-pointer",onClick:()=>ke(n),style:{height:"".concat(a,"%"),minHeight:r>0?"4px":"0",borderTopLeftRadius:s>0?"0":"8px",borderTopRightRadius:s>0?"0":"8px",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px",borderTopWidth:s>0?"0":"2px"}})]})},t)}))})}),(0,k.jsx)("div",{className:"absolute bottom-0 left-0 right-8 pt-8 flex justify-between pointer-events-none",children:h.weeklyData.map(((e,t)=>{const r=M?(0,he.lK)(X).length:7,s=M?"".concat(100/r,"%"):"13%";return(0,k.jsxs)("div",{className:"flex flex-col items-center",style:{width:s},children:[(0,k.jsx)("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:(()=>{const t=e.day.toLowerCase();return t.includes("montag")||t.includes("mo")?o("worktime.days.monday").substring(0,2):t.includes("dienstag")||t.includes("di")?o("worktime.days.tuesday").substring(0,2):t.includes("mittwoch")||t.includes("mi")?o("worktime.days.wednesday").substring(0,2):t.includes("donnerstag")||t.includes("do")?o("worktime.days.thursday").substring(0,2):t.includes("freitag")||t.includes("fr")?o("worktime.days.friday").substring(0,2):t.includes("samstag")||t.includes("sa")?o("worktime.days.saturday").substring(0,2):t.includes("sonntag")||t.includes("so")?o("worktime.days.sunday").substring(0,2):e.day.substring(0,2)})()}),(0,k.jsxs)("div",{className:"text-xs sm:text-sm font-medium dark:text-gray-300",children:[e.hours.toFixed(1),o("worktime.stats.hourShort")]})]},t)}))})]})]}),re&&(0,k.jsx)(xe.G,{isOpen:re,onClose:()=>{se(!1)},selectedDate:ae})]}),"commissions"===A&&(0,k.jsx)("div",{className:"space-y-6",children:D?(0,k.jsx)("div",{className:"p-4 text-center",children:o("common.loading")}):S?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,k.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg",children:[(0,k.jsx)("h3",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:o("worktime.stats.commissions.total","Gesamtkommissionen")}),(0,k.jsx)("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"COP"}).format(S.totalCommissions||0)})]}),(0,k.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg",children:[(0,k.jsx)("h3",{className:"text-sm font-medium text-green-900 dark:text-green-100 mb-2",children:o("worktime.stats.commissions.totalBookings","Anzahl Buchungen")}),(0,k.jsx)("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:S.totalBookings||0})]}),(0,k.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg",children:[(0,k.jsx)("h3",{className:"text-sm font-medium text-purple-900 dark:text-purple-100 mb-2",children:o("worktime.stats.commissions.average","Durchschnitt")}),(0,k.jsx)("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"COP"}).format(S.averageCommission||0)})]})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold mb-3 dark:text-white",children:o("worktime.stats.commissions.byTourType","Nach Tour-Typ")}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("tours.typeOwn","Eigene Touren")}),(0,k.jsx)("span",{className:"font-semibold dark:text-white",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"COP"}).format((null===(t=S.byTourType)||void 0===t?void 0:t.own)||0)})]}),(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("tours.typeExternal","Externe Touren")}),(0,k.jsx)("span",{className:"font-semibold dark:text-white",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"COP"}).format((null===(r=S.byTourType)||void 0===r?void 0:r.external)||0)})]})]})]}),(0,k.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold mb-3 dark:text-white",children:o("worktime.stats.commissions.tourSales","Tour-Verk\xe4ufe")}),(0,k.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(null===(n=S.tourSales)||void 0===n?void 0:n.length)>0?S.tourSales.map((e=>(0,k.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600 last:border-0",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"font-medium dark:text-white",children:e.tourTitle}),(0,k.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.salesCount," ",o("worktime.stats.commissions.sales","Verk\xe4ufe")]})]}),(0,k.jsx)("span",{className:"font-semibold dark:text-white",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"COP"}).format(e.totalCommission||0)})]},e.tourId))):(0,k.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:o("worktime.stats.commissions.noSales","Keine Verk\xe4ufe")})})]})]})]}):(0,k.jsx)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:o("worktime.stats.commissions.noData","Keine Kommissions-Daten verf\xfcgbar")})})]})};var ve=r(5475),fe=r(9130),we=r(6287);const ke=()=>{const{t:e}=(0,a.Bd)();return(0,k.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6 shadow-sm",children:(0,k.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,k.jsxs)("div",{className:"flex items-center mb-4 md:mb-0",children:[(0,k.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full mr-4",children:(0,k.jsx)(fe.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,k.jsxs)("div",{children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:e("appDownload.title")}),(0,k.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e("appDownload.description")})]})]}),(0,k.jsxs)(ve.N_,{to:"/mobile-app",className:"inline-flex items-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:[e("appDownload.download"),(0,k.jsx)(we.A,{className:"ml-2 -mr-1 h-4 w-4"})]})]})})},je=()=>{const{t:e}=(0,a.Bd)(),t=(0,n.Zp)(),[r,i]=(0,s.useState)(null),[o,l]=(0,s.useState)(!0);(0,s.useEffect)((()=>{localStorage.getItem("token")?(i({id:1,username:"testuser",email:"test@example.com",first_name:"Test",last_name:"User"}),l(!1)):t("/login")}),[t]);return o?(0,k.jsx)("div",{className:"flex items-center justify-center min-h-screen text-gray-700 dark:text-gray-300",children:e("common.loading")}):(0,k.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,k.jsxs)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6","data-onboarding":"dashboard-header",children:[(0,k.jsx)("div",{"data-onboarding":"worktime-stats",children:(0,k.jsx)(ye,{})}),(0,k.jsxs)("div",{className:"mt-2 sm:mt-4 md:mt-6 grid grid-cols-1 gap-4",children:[(0,k.jsx)("div",{className:"dashboard-requests-wrapper bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 w-full","data-onboarding":"requests-section",children:(0,k.jsx)(se,{})}),(0,k.jsx)("div",{className:"mt-4",children:(0,k.jsx)(ke,{})})]})]})})}},1252:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const o=a.forwardRef(i)},2704:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=a.forwardRef(i)},3315:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const o=a.forwardRef(i)},3744:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const o=a.forwardRef(i)},4653:(e,t,r)=>{r.d(t,{H:()=>i});var s=r(4524),a=r(2440),n=r(2316);function i(e,t){var r;const i=()=>(0,a.w)(null===t||void 0===t?void 0:t.in,NaN),h=null!==(r=null===t||void 0===t?void 0:t.additionalDigits)&&void 0!==r?r:2,g=function(e){const t={},r=e.split(o.dateTimeDelimiter);let s;if(r.length>2)return t;/:/.test(r[0])?s=r[0]:(t.date=r[0],s=r[1],o.timeZoneDelimiter.test(t.date)&&(t.date=e.split(o.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length)));if(s){const e=o.timezone.exec(s);e?(t.time=s.replace(e[1],""),t.timezone=e[1]):t.time=s}return t}(e);let b;if(g.date){const e=function(e,t){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(r);if(!s)return{year:NaN,restDateString:""};const a=s[1]?parseInt(s[1]):null,n=s[2]?parseInt(s[2]):null;return{year:null===n?a:100*n,restDateString:e.slice((s[1]||s[2]).length)}}(g.date,h);b=function(e,t){if(null===t)return new Date(NaN);const r=e.match(l);if(!r)return new Date(NaN);const s=!!r[4],a=u(r[1]),n=u(r[2])-1,i=u(r[3]),o=u(r[4]),d=u(r[5])-1;if(s)return function(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}(0,o,d)?function(e,t,r){const s=new Date(0);s.setUTCFullYear(e,0,4);const a=s.getUTCDay()||7,n=7*(t-1)+r+1-a;return s.setUTCDate(s.getUTCDate()+n),s}(t,o,d):new Date(NaN);{const e=new Date(0);return function(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(p[t]||(x(e)?29:28))}(t,n,i)&&function(e,t){return t>=1&&t<=(x(e)?366:365)}(t,a)?(e.setUTCFullYear(t,n,Math.max(a,i)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!b||isNaN(+b))return i();const y=+b;let v,f=0;if(g.time&&(f=function(e){const t=e.match(d);if(!t)return NaN;const r=m(t[1]),a=m(t[2]),n=m(t[3]);if(!function(e,t,r){if(24===e)return 0===t&&0===r;return r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}(r,a,n))return NaN;return r*s.s0+a*s.Cg+1e3*n}(g.time),isNaN(f)))return i();if(!g.timezone){const e=new Date(y+f),r=(0,n.a)(0,null===t||void 0===t?void 0:t.in);return r.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),r.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),r}return v=function(e){if("Z"===e)return 0;const t=e.match(c);if(!t)return 0;const r="+"===t[1]?-1:1,a=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,n))return NaN;return r*(a*s.s0+n*s.Cg)}(g.timezone),isNaN(v)?i():(0,n.a)(y+f+v,null===t||void 0===t?void 0:t.in)}const o={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},l=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,d=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,c=/^([+-])(\d{2})(?::?(\d{2}))?$/;function u(e){return e?parseInt(e):1}function m(e){return e&&parseFloat(e.replace(",","."))||0}const p=[31,null,31,30,31,30,31,31,30,31,30,31];function x(e){return e%400===0||e%4===0&&e%100!==0}},6981:(e,t,r)=>{r.d(t,{f:()=>n});var s=r(2440),a=r(2316);function n(e,t,r){const n=(0,a.a)(e,null===r||void 0===r?void 0:r.in);return isNaN(t)?(0,s.w)((null===r||void 0===r?void 0:r.in)||e,NaN):t?(n.setDate(n.getDate()+t),n):n}},8416:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const o=a.forwardRef(i)},9130:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(45),a=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,o=(0,s.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},o),r?a.createElement("title",{id:i},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"}))}const o=a.forwardRef(i)}}]);
//# sourceMappingURL=470.1882dfd5.chunk.js.map