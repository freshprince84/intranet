"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[931],{7931:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ge});var a=r(5043),s=r(4117),n=r(2760),l=r(7504),i=r(4129),o=r(8153),d=r(7459),c=r(9379),m=r(6443),u=r(542),g=r(8662),x=r(6009),b=r(2704),h=r(6238),y=r(7591),p=r(9422),f=r(7855),k=r(4736),v=r(1923),j=r(1801),N=r(6287),w=r(4538),A=r(2811),S=r(7012),C=r(7988),z=r(4791),R=r(1816),E=r(2672),L=r(5657),D=r(579);const F=e=>{let{isOpen:t,onClose:r,onCertificateCreated:l,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:u}=(0,E.As)(),{isHR:g,isAdmin:x,loading:h}=(0,n.S)(),{openSidepane:k,closeSidepane:N}=(0,L.N)(),{showMessage:w}=(0,f.A)(),[A,S]=(0,a.useState)(window.innerWidth<640),[z,F]=(0,a.useState)(window.innerWidth>1070),[T,I]=(0,a.useState)("data"),[P,_]=(0,a.useState)(!1),[O,q]=(0,a.useState)(null),[V,U]=(0,a.useState)(null),[B,M]=(0,a.useState)((new Date).toISOString().split("T")[0]),[G,W]=(0,a.useState)("employment"),[H,J]=(0,a.useState)(null),[K,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(!1),[$,Q]=(0,a.useState)([]),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(!1),se=(0,a.useRef)(null);(0,a.useEffect)((()=>{h||g()||x()||(w("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse erstellen","error"),r())}),[g,x,h,r,w]),(0,a.useEffect)((()=>{const e=()=>{S(window.innerWidth<640),F(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(k(),le(),ne()):N(),()=>{N()})),[t,k,N]);const ne=async()=>{try{const e=(await v.A.get(j.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentCertificate&&t.push({type:"employmentCertificate",version:e.employmentCertificate.version,path:e.employmentCertificate.path}),Q(t),t.length>0&&(te(t[0].type),ae(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},le=async()=>{try{const[e,t]=await Promise.all([v.A.get(j.Sn.USERS.BY_ID(o)),v.A.get(j.Sn.LIFECYCLE.BY_USER(o))]),r=e.data,a=t.data.lifecycle,s={firstName:r.firstName||"",lastName:r.lastName||"",identificationNumber:r.identificationNumber||null,contractStartDate:(null===a||void 0===a?void 0:a.contractStartDate)||null,contractEndDate:(null===a||void 0===a?void 0:a.contractEndDate)||null,contractType:(null===a||void 0===a?void 0:a.contractType)||null,salary:r.salary||null,position:null};U(s),B&&B!==(new Date).toISOString().split("T")[0]||M((new Date).toISOString().split("T")[0])}catch(e){console.error("Fehler beim Laden der User-Daten:",e),q("Fehler beim Laden der Daten")}};(0,a.useEffect)((()=>()=>{K&&URL.revokeObjectURL(K)}),[K]);return g()||x()?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(!z||A)&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,D.jsxs)(m.lG.Panel,{className:"\n            ".concat(A?"w-full h-full":"w-[600px]","\n            ").concat(A?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(A?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),style:{animation:A?"none":"slideIn 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94)"},children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,D.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,D.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis erstellen"})]}),(0,D.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,D.jsx)("div",{className:"mb-4",children:(0,D.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,D.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,D.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,D.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,D.jsx)("button",{type:"button",onClick:()=>I("data"),className:"".concat("data"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Daten"}),(0,D.jsx)("button",{type:"button",onClick:()=>I("text"),className:"".concat("text"===T?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),O&&(0,D.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:O})}),"data"===T&&(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,D.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,D.jsx)("div",{className:"space-y-2 text-sm",children:V&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,D.jsxs)("span",{className:"dark:text-white",children:[V.firstName," ",V.lastName]})]}),V.identificationNumber&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(b.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,D.jsx)("span",{className:"dark:text-white",children:V.identificationNumber})]}),V.contractStartDate&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(C.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Eintrittsdatum:"}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(V.contractStartDate).toLocaleDateString("de-DE")})]}),V.contractEndDate&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(C.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Austrittsdatum:"}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(V.contractEndDate).toLocaleDateString("de-DE")})]})]})})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Ausstellungsdatum ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"date",value:B,onChange:e=>{const t=e.target.value;M(t),t&&new Date(t)>new Date?q("Ausstellungsdatum darf nicht in der Zukunft liegen"):q(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&B&&new Date(B)>new Date||O&&!B?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!(B&&!(B&&new Date(B)>new Date))||void 0,"aria-describedby":!B||B&&new Date(B)>new Date?"issueDate-error":void 0}),O&&(!B||B&&new Date(B)>new Date)&&(0,D.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O}),!O&&(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Zertifikat-Typ ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("select",{value:G,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0,children:[(0,D.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,D.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,D.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]})]}),"text"===T&&(0,D.jsxs)("div",{className:"space-y-4",children:[$.length>0&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,D.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,D.jsx)("input",{type:"checkbox",checked:re,onChange:e=>{ae(e.target.checked),e.target.checked&&H&&(J(null),K&&(URL.revokeObjectURL(K),Y(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,D.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),re&&(0,D.jsx)("select",{value:ee||"",onChange:e=>te(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:$.map((e=>(0,D.jsxs)("option",{value:e.type,children:["Arbeitszeugnis (Version ",e.version,")"]},e.type)))})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[re?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!re&&(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,D.jsx)("input",{ref:se,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void w("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void w("Datei ist zu gro\xdf (max. 10MB)","error");J(r),ae(!1);const e=URL.createObjectURL(r);Y(e)}},className:"hidden"}),H?(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,D.jsx)("p",{className:"text-sm font-medium dark:text-white",children:H.name}),(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(H.size/1024/1024).toFixed(2)," MB"]}),(0,D.jsx)("button",{type:"button",onClick:()=>{J(null),K&&(URL.revokeObjectURL(K),Y(null)),se.current&&(se.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,D.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=se.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,D.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),K&&(0,D.jsxs)("div",{className:"mt-4",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,D.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,D.jsx)("iframe",{src:"".concat(K,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!re&&!H)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!B)return"Bitte geben Sie ein Ausstellungsdatum an";const e=new Date(B);return isNaN(e.getTime())?"Ung\xfcltiges Ausstellungsdatum":e>new Date?"Ausstellungsdatum darf nicht in der Zukunft liegen":null})();if(t)return q(t),void w(t,"error");_(!0),q(null);try{let e,t=null,a=null;if(re&&ee&&!H){const e=$.find((e=>e.type===ee));e&&(t=e.type,a=e.version)}else{if(!H)return w("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(H.name)}const s={certificateType:G,issueDate:new Date(B),pdfPath:e,templateUsed:t,templateVersion:a};await v.A.post(j.Sn.LIFECYCLE.CERTIFICATES(o),s),w("Arbeitszeugnis erfolgreich erstellt","success"),l(),r(),K&&(URL.revokeObjectURL(K),Y(null)),J(null),M((new Date).toISOString().split("T")[0]),se.current&&(se.current.value="")}catch(n){var a,s;console.error("Fehler beim Erstellen des Arbeitszeugnisses:",n),q((null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitszeugnisses"),w("Fehler beim Erstellen des Arbeitszeugnisses","error")}finally{_(!1)}},disabled:P||!H&&!re,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:P?"Wird erstellt...":"Erstellen",children:P?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]}):null};var T=r(2683);const I=e=>{let{isOpen:t,onClose:r,onContractCreated:l,userId:o,userName:d}=e;const{t:c}=(0,s.Bd)(),{user:u}=(0,E.As)(),{isHR:g,isAdmin:x,loading:h}=(0,n.S)(),{openSidepane:k,closeSidepane:N}=(0,L.N)(),{showMessage:w}=(0,f.A)(),[A,S]=(0,a.useState)(window.innerWidth<640),[C,z]=(0,a.useState)(window.innerWidth>1070),[F,I]=(0,a.useState)("data"),[P,_]=(0,a.useState)(!1),[O,q]=(0,a.useState)(null),[V,U]=(0,a.useState)(null),[B,M]=(0,a.useState)("employment"),[G,W]=(0,a.useState)((new Date).toISOString().split("T")[0]),[H,J]=(0,a.useState)(""),[K,Y]=(0,a.useState)(""),[Z,X]=(0,a.useState)(""),[$,Q]=(0,a.useState)(""),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(null),[se,ne]=(0,a.useState)([]),[le,ie]=(0,a.useState)(null),[oe,de]=(0,a.useState)(!1),ce=(0,a.useRef)(null);(0,a.useEffect)((()=>{h||g()||x()||(w("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge erstellen","error"),r())}),[g,x,h,r,w]),(0,a.useEffect)((()=>{const e=()=>{S(window.innerWidth<640),z(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(k(),ue(),me()):N(),()=>{N()})),[t,k,N]);const me=async()=>{try{const e=(await v.A.get(j.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentContract&&t.push({type:"employmentContract",version:e.employmentContract.version,path:e.employmentContract.path}),ne(t),t.length>0&&(ie(t[0].type),de(!0))}catch(e){console.error("Fehler beim Laden der Templates:",e)}},ue=async()=>{try{const[e,t]=await Promise.all([v.A.get(j.Sn.USERS.BY_ID(o)),v.A.get(j.Sn.LIFECYCLE.BY_USER(o))]),r=e.data,a=t.data.lifecycle,s={firstName:r.firstName||"",lastName:r.lastName||"",identificationNumber:r.identificationNumber||null,contractStartDate:(null===a||void 0===a?void 0:a.contractStartDate)||null,contractEndDate:(null===a||void 0===a?void 0:a.contractEndDate)||null,contractType:(null===a||void 0===a?void 0:a.contractType)||null,salary:r.salary||null,position:null};U(s),s.contractStartDate&&W(new Date(s.contractStartDate).toISOString().split("T")[0]),s.contractEndDate&&J(new Date(s.contractEndDate).toISOString().split("T")[0]),s.salary&&Y(s.salary.toString()),s.contractType&&M(s.contractType)}catch(e){console.error("Fehler beim Laden der User-Daten:",e),q("Fehler beim Laden der Daten")}};(0,a.useEffect)((()=>()=>{re&&URL.revokeObjectURL(re)}),[re]);return g()||x()?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(!C||A)&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,D.jsxs)(m.lG.Panel,{className:"\n            ".concat(A?"w-full h-full":"w-[600px]","\n            ").concat(A?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(A?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,D.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,D.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag erstellen"})]}),(0,D.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,D.jsx)("div",{className:"mb-4",children:(0,D.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["F\xfcr: ",(0,D.jsx)("span",{className:"font-medium dark:text-white",children:d})]})}),(0,D.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,D.jsxs)("nav",{className:"-mb-px flex space-x-4",children:[(0,D.jsx)("button",{type:"button",onClick:()=>I("data"),className:"".concat("data"===F?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"Vertragsdaten"}),(0,D.jsx)("button",{type:"button",onClick:()=>I("text"),className:"".concat("text"===F?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"PDF hochladen"})]})}),O&&(0,D.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:O})}),"data"===F&&(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:[(0,D.jsx)("h3",{className:"text-sm font-semibold dark:text-white mb-3",children:"Automatisch erkannte Daten"}),(0,D.jsx)("div",{className:"space-y-2 text-sm",children:V&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(i.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Name:"}),(0,D.jsxs)("span",{className:"dark:text-white",children:[V.firstName," ",V.lastName]})]}),V.identificationNumber&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(b.A,{className:"h-4 w-4 text-gray-400"}),(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"C\xe9dula:"}),(0,D.jsx)("span",{className:"dark:text-white",children:V.identificationNumber})]})]})})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("select",{value:B,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,D.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,D.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"date",value:G,onChange:e=>{W(e.target.value),q(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&!G?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!G,"aria-describedby":G?void 0:"startDate-error"}),O&&!G&&(0,D.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,D.jsx)("input",{type:"date",value:H,onChange:e=>{J(e.target.value),e.target.value&&G&&new Date(e.target.value)<new Date(G)?q("Enddatum muss nach dem Startdatum liegen"):q(null)},min:G||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&H&&G&&new Date(H)<new Date(G)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(H&&G&&new Date(H)<new Date(G))||void 0,"aria-describedby":H&&G&&new Date(H)<new Date(G)?"endDate-error":void 0}),O&&H&&G&&new Date(H)<new Date(G)&&(0,D.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,D.jsx)("input",{type:"text",value:$,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)(T.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,D.jsx)("input",{type:"number",value:K,onChange:e=>{const t=e.target.value;Y(t),t&&parseFloat(t)<0?q("Gehalt darf nicht negativ sein"):q(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&K&&parseFloat(K)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(K&&parseFloat(K)<0)||void 0,"aria-describedby":K&&parseFloat(K)<0?"salary-error":void 0})]}),O&&K&&parseFloat(K)<0&&(0,D.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,D.jsx)("input",{type:"number",value:Z,onChange:e=>{const t=e.target.value;X(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?q("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):q(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(O&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!Z||!(parseFloat(Z)<0||parseFloat(Z)>168))||void 0,"aria-describedby":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"workingHours-error":void 0}),O&&Z&&(parseFloat(Z)<0||parseFloat(Z)>168)&&(0,D.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:O}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]})]}),"text"===F&&(0,D.jsxs)("div",{className:"space-y-4",children:[se.length>0&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template verwenden"}),(0,D.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,D.jsx)("input",{type:"checkbox",checked:oe,onChange:e=>{de(e.target.checked),e.target.checked&&ee&&(te(null),re&&(URL.revokeObjectURL(re),ae(null)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,D.jsx)("label",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Template f\xfcr automatische PDF-Generierung verwenden"})]}),oe&&(0,D.jsx)("select",{value:le||"",onChange:e=>ie(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white mb-4",children:se.map((e=>(0,D.jsxs)("option",{value:e.type,children:["Arbeitsvertrag (Version ",e.version,")"]},e.type)))})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[oe?"ODER PDF-Datei hochladen":"PDF-Datei hochladen"," ",!oe&&(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,D.jsx)("input",{ref:ce,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void w("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void w("Datei ist zu gro\xdf (max. 10MB)","error");te(r),de(!1);const e=URL.createObjectURL(r);ae(e)}},className:"hidden"}),ee?(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,D.jsx)("p",{className:"text-sm font-medium dark:text-white",children:ee.name}),(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(ee.size/1024/1024).toFixed(2)," MB"]}),(0,D.jsx)("button",{type:"button",onClick:()=>{te(null),re&&(URL.revokeObjectURL(re),ae(null)),ce.current&&(ce.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,D.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=ce.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"PDF-Datei ausw\xe4hlen"}),(0,D.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]})]}),re&&(0,D.jsxs)("div",{className:"mt-4",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,D.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,D.jsx)("iframe",{src:"".concat(re,"#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault();const t=(()=>{if(!oe&&!ee)return"Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch";if(!G)return"Bitte geben Sie ein Startdatum an";const e=new Date(G);if(isNaN(e.getTime()))return"Ung\xfcltiges Startdatum";if(H){const t=new Date(H);if(isNaN(t.getTime()))return"Ung\xfcltiges Enddatum";if(t<e)return"Enddatum muss nach dem Startdatum liegen"}return K&&parseFloat(K)<0?"Gehalt darf nicht negativ sein":Z&&(parseFloat(Z)<0||parseFloat(Z)>168)?"Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen":null})();if(t)return q(t),void w(t,"error");_(!0),q(null);try{let e,t=null,a=null;if(oe&&le&&!ee){const e=se.find((e=>e.type===le));e&&(t=e.type,a=e.version)}else{if(!ee)return w("Bitte w\xe4hlen Sie ein Template oder laden Sie eine PDF-Datei hoch","error"),void _(!1);e="temp-".concat(Date.now(),"-").concat(ee.name)}const s={contractType:B,startDate:new Date(G),endDate:H?new Date(H):null,salary:K?parseFloat(K):null,workingHours:Z?parseFloat(Z):null,position:$||null,pdfPath:e,templateUsed:t,templateVersion:a};await v.A.post(j.Sn.LIFECYCLE.CONTRACTS(o),s),w("Arbeitsvertrag erfolgreich erstellt","success"),l(),r(),re&&(URL.revokeObjectURL(re),ae(null)),te(null),W((new Date).toISOString().split("T")[0]),J(""),Y(""),X(""),Q(""),ce.current&&(ce.current.value="")}catch(n){var a,s;console.error("Fehler beim Erstellen des Arbeitsvertrags:",n),q((null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Fehler beim Erstellen des Arbeitsvertrags"),w("Fehler beim Erstellen des Arbeitsvertrags","error")}finally{_(!1)}},disabled:P||!ee&&!oe||!G,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:P?"Wird erstellt...":"Erstellen",children:P?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]}):null},P=e=>{let{isOpen:t,onClose:r,onCertificateUpdated:l,userId:i,certificate:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:g}=(0,n.S)(),{openSidepane:x,closeSidepane:h}=(0,L.N)(),{showMessage:k}=(0,f.A)(),[N,w]=(0,a.useState)(window.innerWidth<640),[A,S]=(0,a.useState)(window.innerWidth>1070),[C,z]=(0,a.useState)(!1),[E,F]=(0,a.useState)(null),[T,I]=(0,a.useState)(o.issueDate?new Date(o.issueDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[P,_]=(0,a.useState)(o.certificateType||"employment"),[O,q]=(0,a.useState)(null),[V,U]=(0,a.useState)(null),[B,M]=(0,a.useState)(null),G=(0,a.useRef)(null);(0,a.useEffect)((()=>{g||c()||u()||(k("Nur HR oder Admin k\xf6nnen Arbeitszeugnisse bearbeiten","error"),r())}),[c,u,g,r,k]),(0,a.useEffect)((()=>{const e=()=>{w(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(x(),o.id&&M(j.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id))):h(),()=>{h()})),[t,x,h,o.id,i]),(0,a.useEffect)((()=>()=>{V&&URL.revokeObjectURL(V)}),[V]);const W=async e=>{e.preventDefault(),z(!0),F(null);try{const e={issueDate:new Date(T),certificateType:P};O&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(O.name),e.templateVersion=o.templateVersion||"1.0"),await v.A.put(j.Sn.LIFECYCLE.CERTIFICATE(i,o.id),e),k("Arbeitszeugnis erfolgreich aktualisiert","success"),l(),r(),V&&(URL.revokeObjectURL(V),U(null)),q(null),G.current&&(G.current.value="")}catch(s){var t,a;console.error("Fehler beim Aktualisieren des Arbeitszeugnisses:",s),F((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Aktualisieren des Arbeitszeugnisses"),k("Fehler beim Aktualisieren des Arbeitszeugnisses","error")}finally{z(!1)}};return c()||u()?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(!A||N)&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,D.jsxs)(m.lG.Panel,{className:"\n            ".concat(N?"w-full h-full":"w-[600px]","\n            ").concat(N?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(N?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,D.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,D.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitszeugnis bearbeiten"})]}),(0,D.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[E&&(0,D.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:E})}),(0,D.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausstellungsdatum"}),(0,D.jsx)("input",{type:"date",value:T,onChange:e=>{const t=e.target.value;I(t),t&&new Date(t)>new Date?F("Ausstellungsdatum darf nicht in der Zukunft liegen"):F(null)},max:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(E&&T&&new Date(T)>new Date?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(T&&new Date(T)>new Date)||void 0,"aria-describedby":T&&new Date(T)>new Date?"issueDate-error":void 0}),E&&T&&new Date(T)>new Date&&(0,D.jsx)("p",{id:"issueDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:E}),!E&&(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Das Datum darf nicht in der Zukunft liegen"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zertifikat-Typ"}),(0,D.jsxs)("select",{value:P,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"employment",children:"Arbeitszeugnis"}),(0,D.jsx)("option",{value:"salary",children:"Gehaltsbescheinigung"}),(0,D.jsx)("option",{value:"work_experience",children:"Arbeitsbescheinigung"})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,D.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,D.jsx)("input",{ref:G,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void k("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void k("Datei ist zu gro\xdf (max. 10MB)","error");q(r);const e=URL.createObjectURL(r);U(e),M(null)}},className:"hidden"}),O?(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,D.jsx)("p",{className:"text-sm font-medium dark:text-white",children:O.name}),(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(O.size/1024/1024).toFixed(2)," MB"]}),(0,D.jsx)("button",{type:"button",onClick:()=>{q(null),V&&(URL.revokeObjectURL(V),U(null)),M(j.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(i,o.id)),G.current&&(G.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,D.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,D.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(V||B)&&(0,D.jsxs)("div",{className:"mt-4",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,D.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,D.jsx)("iframe",{src:"".concat(V||B).concat(V?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,D.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,D.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,D.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"button",onClick:W,disabled:C,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]}):null},_=e=>{let{isOpen:t,onClose:r,onContractUpdated:l,userId:i,contract:o}=e;const{t:d}=(0,s.Bd)(),{isHR:c,isAdmin:u,loading:g}=(0,n.S)(),{openSidepane:x,closeSidepane:h}=(0,L.N)(),{showMessage:k}=(0,f.A)(),[N,w]=(0,a.useState)(window.innerWidth<640),[A,S]=(0,a.useState)(window.innerWidth>1070),[C,z]=(0,a.useState)(!1),[E,F]=(0,a.useState)(null),[I,P]=(0,a.useState)(o.contractType||"employment"),[_,O]=(0,a.useState)(o.startDate?new Date(o.startDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[q,V]=(0,a.useState)(o.endDate?new Date(o.endDate).toISOString().split("T")[0]:""),[U,B]=(0,a.useState)(o.salary?o.salary.toString():""),[M,G]=(0,a.useState)(o.workingHours?o.workingHours.toString():""),[W,H]=(0,a.useState)(o.position||""),[J,K]=(0,a.useState)(null),[Y,Z]=(0,a.useState)(null),[X,$]=(0,a.useState)(null),Q=(0,a.useRef)(null);(0,a.useEffect)((()=>{g||c()||u()||(k("Nur HR oder Admin k\xf6nnen Arbeitsvertr\xe4ge bearbeiten","error"),r())}),[c,u,g,r,k]),(0,a.useEffect)((()=>{const e=()=>{w(window.innerWidth<640),S(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(x(),o.id&&$(j.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id))):h(),()=>{h()})),[t,x,h,o.id,i]),(0,a.useEffect)((()=>()=>{Y&&URL.revokeObjectURL(Y)}),[Y]);const ee=async e=>{if(e.preventDefault(),_){z(!0),F(null);try{const e={contractType:I,startDate:new Date(_),endDate:q?new Date(q):null,salary:U?parseFloat(U):null,workingHours:M?parseFloat(M):null,position:W||null};J&&(e.pdfPath="temp-".concat(Date.now(),"-").concat(J.name),e.templateVersion=o.templateVersion||"1.0"),await v.A.put(j.Sn.LIFECYCLE.CONTRACT(i,o.id),e),k("Arbeitsvertrag erfolgreich aktualisiert","success"),l(),r(),Y&&(URL.revokeObjectURL(Y),Z(null)),K(null),Q.current&&(Q.current.value="")}catch(s){var t,a;console.error("Fehler beim Aktualisieren des Arbeitsvertrags:",s),F((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Aktualisieren des Arbeitsvertrags"),k("Fehler beim Aktualisieren des Arbeitsvertrags","error")}finally{z(!1)}}else k("Bitte geben Sie ein Startdatum an","error")};return c()||u()?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(!A||N)&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-start justify-end p-0 sm:p-0",children:(0,D.jsxs)(m.lG.Panel,{className:"\n            ".concat(N?"w-full h-full":"w-[600px]","\n            ").concat(N?"":"top-16","\n            bg-white dark:bg-gray-800 shadow-xl\n            transform transition-transform duration-350 ease-out\n            ").concat(N?"rounded-none":"rounded-l-lg","\n            flex flex-col\n            max-h-[calc(100vh-4rem)]\n          "),children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,D.jsx)(b.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),(0,D.jsx)(m.lG.Title,{className:"text-xl font-semibold dark:text-white",children:"Arbeitsvertrag bearbeiten"})]}),(0,D.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[E&&(0,D.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:E})}),(0,D.jsxs)("form",{onSubmit:ee,className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Vertragstyp ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("select",{value:I,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"employment",children:"Arbeitsvertrag"}),(0,D.jsx)("option",{value:"amendment",children:"Vertrags\xe4nderung"}),(0,D.jsx)("option",{value:"extension",children:"Vertragsverl\xe4ngerung"})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Startdatum ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"date",value:_,onChange:e=>{const t=e.target.value;O(t),q&&t&&new Date(q)<new Date(t)?F("Enddatum muss nach dem Startdatum liegen"):F(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(E&&!_?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),required:!0,"aria-invalid":!_||void 0,"aria-describedby":_?void 0:"startDate-error"}),E&&!_&&(0,D.jsx)("p",{id:"startDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:E})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Enddatum (optional)"}),(0,D.jsx)("input",{type:"date",value:q,onChange:e=>{const t=e.target.value;V(t),t&&_&&new Date(t)<new Date(_)?F("Enddatum muss nach dem Startdatum liegen"):F(null)},min:_||void 0,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(E&&q&&_&&new Date(q)<new Date(_)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),"aria-invalid":!!(q&&_&&new Date(q)<new Date(_))||void 0,"aria-describedby":q&&_&&new Date(q)<new Date(_)?"endDate-error":void 0}),E&&q&&_&&new Date(q)<new Date(_)&&(0,D.jsx)("p",{id:"endDate-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:E})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Position"}),(0,D.jsx)("input",{type:"text",value:W,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. Frontend-Entwickler"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gehalt (optional)"}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)(T.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,D.jsx)("input",{type:"number",value:U,onChange:e=>{const t=e.target.value;B(t),t&&parseFloat(t)<0?F("Gehalt darf nicht negativ sein"):F(null)},className:"w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(E&&U&&parseFloat(U)<0?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0.00",step:"0.01",min:"0","aria-invalid":!!(U&&parseFloat(U)<0)||void 0,"aria-describedby":U&&parseFloat(U)<0?"salary-error":void 0})]}),E&&U&&parseFloat(U)<0&&(0,D.jsx)("p",{id:"salary-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:E})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arbeitsstunden/Woche (optional)"}),(0,D.jsx)("input",{type:"number",value:M,onChange:e=>{const t=e.target.value;G(t),t&&(parseFloat(t)<0||parseFloat(t)>168)?F("Arbeitsstunden m\xfcssen zwischen 0 und 168 liegen"):F(null)},className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(E&&M&&(parseFloat(M)<0||parseFloat(M)>168)?"border-red-500 dark:border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"40",step:"0.1",min:"0",max:"168","aria-invalid":!(!M||!(parseFloat(M)<0||parseFloat(M)>168))||void 0,"aria-describedby":M&&(parseFloat(M)<0||parseFloat(M)>168)?"workingHours-error":void 0}),E&&M&&(parseFloat(M)<0||parseFloat(M)>168)&&(0,D.jsx)("p",{id:"workingHours-error",className:"mt-1 text-xs text-red-600 dark:text-red-400",children:E}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximal 168 Stunden pro Woche (24h \xd7 7 Tage)"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Datei aktualisieren (optional)"}),(0,D.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[(0,D.jsx)("input",{ref:Q,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if("application/pdf"!==r.type)return void k("Nur PDF-Dateien sind erlaubt","error");if(r.size>10485760)return void k("Datei ist zu gro\xdf (max. 10MB)","error");K(r);const e=URL.createObjectURL(r);Z(e),$(null)}},className:"hidden"}),J?(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,D.jsx)("p",{className:"text-sm font-medium dark:text-white",children:J.name}),(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(J.size/1024/1024).toFixed(2)," MB"]}),(0,D.jsx)("button",{type:"button",onClick:()=>{K(null),Y&&(URL.revokeObjectURL(Y),Z(null)),$(j.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(i,o.id)),Q.current&&(Q.current.value="")},className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Datei entfernen"})]}):(0,D.jsxs)("div",{children:[(0,D.jsx)(b.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,D.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:"Neue PDF-Datei ausw\xe4hlen"}),(0,D.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"oder Datei hierher ziehen"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Max. 10MB"})]})]}),(Y||X)&&(0,D.jsxs)("div",{className:"mt-4",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PDF-Vorschau"}),(0,D.jsx)("div",{className:"border rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-700/50",children:(0,D.jsx)("iframe",{src:"".concat(Y||X).concat(Y?"#view=FitH":"?preview=true#view=FitH"),className:"w-full rounded border dark:border-gray-600",style:{height:"400px"},title:"PDF-Vorschau"})})]})]}),(0,D.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4",children:(0,D.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,D.jsx)("strong",{children:"Hinweis:"})," Wenn Sie eine neue PDF-Datei hochladen, wird die alte Version ersetzt. Eine neue Version wird erstellt (isLatest = true)."]})})]})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"button",onClick:ee,disabled:C||!_,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:C?"Wird aktualisiert...":"Aktualisieren",children:C?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]}):null};var O=r(7098);const q=e=>{let{userId:t,lifecycleId:r,onUpdate:l}=e;const{t:i}=(0,s.Bd)(),{isLegal:o,isAdmin:d,loading:m}=(0,n.S)(),{showMessage:u}=(0,f.A)(),[g,x]=(0,a.useState)({arl:null,eps:null,pension:null,caja:null}),[h,p]=(0,a.useState)(!0),[k,N]=(0,a.useState)(null),[C,z]=(0,a.useState)({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),[E,L]=(0,a.useState)(!1),F=(0,a.useRef)(!1),T=(0,a.useRef)(null),I=(0,a.useCallback)((async()=>{T.current&&T.current.abort();const e=new AbortController;T.current=e,F.current=!0,p(!0);try{const r=["arl","eps","pension","caja"].map((async r=>{if(e.signal.aborted)return{type:r,registration:null};try{return{type:r,registration:(await v.A.get(j.Sn.LIFECYCLE.SOCIAL_SECURITY(t,r),{timeout:5e3,signal:e.signal})).data}}catch(n){var a,s;return"AbortError"===n.name||"CanceledError"===n.name||e.signal.aborted||404===(null===(a=n.response)||void 0===a?void 0:a.status)?{type:r,registration:null}:"ERR_NETWORK"===n.code||"ECONNABORTED"===n.code||null!==(s=n.message)&&void 0!==s&&s.includes("ERR_INSUFFICIENT_RESOURCES")?(console.warn("Network error loading ".concat(r,", treating as not found")),{type:r,registration:null}):(console.error("Error loading ".concat(r,":"),n),{type:r,registration:null})}})),a=await Promise.all(r);if(e.signal.aborted)return;const s={arl:null,eps:null,pension:null,caja:null};a.forEach((e=>{let{type:t,registration:r}=e;r&&(s[t]={id:r.id||0,registrationType:t,registrationNumber:r.number||r.registrationNumber||null,provider:r.provider||null,registrationDate:r.registeredAt||r.registrationDate||null,status:r.status||"pending",notes:r.notes||null,completedAt:r.completedAt||null})})),x(s)}catch(r){if("AbortError"===r.name||"CanceledError"===r.name||e.signal.aborted)return;console.error("Error loading registrations:",r),u(i("socialSecurity.loadError"),"error")}finally{p(!1),F.current=!1}}),[t,i,u]);(0,a.useEffect)((()=>{if(m)return;if((o()||d())&&t&&r){if(!F.current)return I(),()=>{T.current&&T.current.abort(),F.current=!1}}else p(!1)}),[t,r,m]);const P=()=>{N(null),z({status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""})},_=async()=>{if(k)if(m)u(i("common.loading",{defaultValue:"Berechtigungen werden geladen..."}),"warning");else if(o()||d()){L(!0);try{await v.A.put(j.Sn.LIFECYCLE.SOCIAL_SECURITY(t,k),{status:C.status,number:C.registrationNumber||void 0,provider:C.provider||void 0,registrationDate:C.registrationDate?new Date(C.registrationDate).toISOString():void 0,notes:C.notes||void 0}),u("Sozialversicherung erfolgreich aktualisiert","success"),N(null),await new Promise((e=>setTimeout(e,200))),await I(),l&&"function"===typeof l&&l()}catch(a){var e,r;console.error("Error updating social security:",a),u((null===(e=a.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||i("socialSecurity.updateError"),"error")}finally{L(!1)}}else u(i("lifecycle.noPermission",{defaultValue:"Keine Berechtigung - nur Legal oder Admin"}),"error")},q=e=>{switch(e){case"registered":return(0,D.jsx)(w.A,{className:"h-5 w-5 text-green-500"});case"pending":return(0,D.jsx)(S.A,{className:"h-5 w-5 text-yellow-500"});case"failed":return(0,D.jsx)(O.A,{className:"h-5 w-5 text-red-500"});case"not_required":return(0,D.jsx)(w.A,{className:"h-5 w-5 text-gray-400"});case"deregistered":return(0,D.jsx)(O.A,{className:"h-5 w-5 text-gray-400"});default:return(0,D.jsx)(S.A,{className:"h-5 w-5 text-gray-400"})}},V=e=>{const t="lifecycle.socialSecurityStatus.".concat(e);return i(t)||e},U=e=>({arl:"ARL (Risiko-Arbeit)",eps:"EPS (Gesundheit)",pension:"Pension",caja:"Caja de Compensaci\xf3n"}[e]);if(m)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,D.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(!o()&&!d())return null;if(h)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,D.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});return(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,D.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,D.jsx)(b.A,{className:"h-5 w-5 mr-2"}),i("lifecycle.socialSecurity",{defaultValue:"Sozialversicherungen"})]})}),(0,D.jsx)("div",{className:"space-y-4",children:["arl","eps","pension","caja"].map((e=>{const t=g[e],r=k===e;return(0,D.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:r?(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)("h4",{className:"font-medium dark:text-white uppercase mb-3",children:i("socialSecurity.editType",{type:U(e)})}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("socialSecurity.status")," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("select",{value:C.status,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"not_required",children:"Nicht erforderlich"}),(0,D.jsx)("option",{value:"pending",children:"Ausstehend"}),(0,D.jsx)("option",{value:"registered",children:"Registriert"}),(0,D.jsx)("option",{value:"failed",children:"Fehlgeschlagen"}),(0,D.jsx)("option",{value:"deregistered",children:"Abgemeldet"})]})]}),"registered"===C.status&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationNumber")}),(0,D.jsx)("input",{type:"text",value:C.registrationNumber,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{registrationNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 123456789"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.provider")}),(0,D.jsx)("input",{type:"text",value:C.provider,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{provider:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. ARL Sura, EPS Sanitas"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.registrationDate")}),(0,D.jsx)("input",{type:"date",value:C.registrationDate,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{registrationDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("socialSecurity.notes")}),(0,D.jsx)("textarea",{value:C.notes,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",rows:3,placeholder:i("socialSecurity.additionalInfo")})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,D.jsx)("button",{onClick:P,disabled:E,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:i("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{onClick:_,disabled:E,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(E?"common.saving":"common.save"),children:E?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(w.A,{className:"h-5 w-5"})})]})]}):(0,D.jsxs)("div",{className:"flex items-start justify-between",children:[(0,D.jsxs)("div",{className:"flex items-start space-x-3 flex-1",children:[q((null===t||void 0===t?void 0:t.status)||"pending"),(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,D.jsx)("h4",{className:"font-medium dark:text-white uppercase",children:U(e)}),(0,D.jsx)("span",{className:"text-sm font-medium dark:text-white",children:V((null===t||void 0===t?void 0:t.status)||"pending")})]}),t&&(0,D.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[t.provider&&(0,D.jsxs)("div",{children:[(0,D.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.provider"),":"]})," ",t.provider]}),t.registrationNumber&&(0,D.jsxs)("div",{children:[(0,D.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.number"),":"]})," ",t.registrationNumber]}),t.registrationDate&&(0,D.jsxs)("div",{children:[(0,D.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.registrationDate"),":"]})," ",new Date(t.registrationDate).toLocaleDateString("de-DE")]}),t.notes&&(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsxs)("span",{className:"font-medium",children:[i("socialSecurity.notes"),":"]}),(0,D.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t.notes})]}),t.completedAt&&(0,D.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[i("socialSecurity.completedAt")," ",new Date(t.completedAt).toLocaleDateString("de-DE")]})]}),!t&&(0,D.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("socialSecurity.notRegistered")})]})]}),(0,D.jsx)("button",{onClick:()=>(e=>{const t=g[e];z(t?{status:t.status,registrationNumber:t.registrationNumber||"",provider:t.provider||"",registrationDate:t.registrationDate?new Date(t.registrationDate).toISOString().split("T")[0]:"",notes:t.notes||""}:{status:"pending",registrationNumber:"",provider:"",registrationDate:"",notes:""}),N(e)})(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition ml-4",title:i("lifecycle.edit",{defaultValue:"Bearbeiten"}),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})})]})},e)}))})]})};var V=r(9399);const U=e=>{let{isOpen:t,onClose:r,onOffboardingStarted:n,userId:l,userName:i}=e;const{t:o}=(0,s.Bd)(),{openSidepane:d,closeSidepane:u}=(0,L.N)(),{showMessage:g}=(0,f.A)(),[x,b]=(0,a.useState)(window.innerWidth<640),[h,p]=(0,a.useState)(window.innerWidth>1070),[k,w]=(0,a.useState)(!1),[A,S]=(0,a.useState)(null),[z,E]=(0,a.useState)(""),[F,T]=(0,a.useState)(""),[I,P]=(0,a.useState)({});(0,a.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),p(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>{if(t){d();const e=(new Date).toISOString().split("T")[0];E(e),T(""),S(null),P({})}else u();return()=>{u()}}),[t,d,u]);const _=async e=>{if(e.preventDefault(),(()=>{const e={};if(z){const t=new Date(z);(new Date).setHours(0,0,0,0);const r=new Date;r.setFullYear(r.getFullYear()+1),t>r&&(e.exitDate=o("lifecycle.offboarding.exitDateTooFar",{defaultValue:"Austrittsdatum darf nicht mehr als 1 Jahr in der Zukunft liegen"}))}else e.exitDate=o("lifecycle.offboarding.exitDateRequired",{defaultValue:"Austrittsdatum ist erforderlich"});return F&&0!==F.trim().length?F.trim().length<10&&(e.exitReason=o("lifecycle.offboarding.exitReasonTooShort",{defaultValue:"Austrittsgrund muss mindestens 10 Zeichen lang sein"})):e.exitReason=o("lifecycle.offboarding.exitReasonRequired",{defaultValue:"Austrittsgrund ist erforderlich"}),P(e),0===Object.keys(e).length})()){w(!0),S(null);try{await v.A.put(j.Sn.LIFECYCLE.STATUS(l),{status:"offboarding",exitDate:z,exitReason:F.trim()}),g(o("lifecycle.offboarding.started",{defaultValue:"Offboarding erfolgreich gestartet"}),"success"),n(),r()}catch(s){var t,a;console.error("Fehler beim Starten des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||o("lifecycle.offboarding.startError",{defaultValue:"Fehler beim Starten des Offboarding"});S(e),g(e,"error")}finally{w(!1)}}},O=()=>(0,D.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,D.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:(0,D.jsxs)("div",{className:"flex items-start",children:[(0,D.jsx)(V.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5 mr-3 flex-shrink-0"}),(0,D.jsxs)("div",{className:"text-sm text-orange-800 dark:text-orange-200",children:[(0,D.jsx)("p",{className:"font-medium mb-1",children:o("lifecycle.offboarding.warningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,D.jsx)("p",{children:o("lifecycle.offboarding.warningText",{defaultValue:"Durch das Starten des Offboarding-Prozesses werden automatisch Tasks erstellt. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})]})]})}),(0,D.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:o("lifecycle.offboarding.user",{defaultValue:"Mitarbeiter"})}),(0,D.jsx)("p",{className:"font-medium dark:text-white",children:i})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"exitDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitDate",{defaultValue:"Austrittsdatum"})," *"]}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,D.jsx)(C.A,{className:"h-5 w-5 text-gray-400"})}),(0,D.jsx)("input",{type:"date",id:"exitDate",value:z,onChange:e=>{E(e.target.value),I.exitDate&&P((e=>(0,c.A)((0,c.A)({},e),{},{exitDate:void 0})))},className:"block w-full pl-10 pr-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitDate?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),required:!0})]}),I.exitDate&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitDate}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitDateHint",{defaultValue:"Das Datum, an dem der Mitarbeiter die Organisation verl\xe4sst"})})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"exitReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.offboarding.exitReason",{defaultValue:"Austrittsgrund"})," *"]}),(0,D.jsx)("textarea",{id:"exitReason",value:F,onChange:e=>{T(e.target.value),I.exitReason&&P((e=>(0,c.A)((0,c.A)({},e),{},{exitReason:void 0})))},rows:4,className:"block w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white ".concat(I.exitReason?"border-red-300 dark:border-red-600 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500"),placeholder:o("lifecycle.offboarding.exitReasonPlaceholder",{defaultValue:"z.B. K\xfcndigung, Vertragsende, etc."}),required:!0}),I.exitReason&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:I.exitReason}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.offboarding.exitReasonHint",{defaultValue:"Mindestens 10 Zeichen. Beschreiben Sie den Grund f\xfcr den Austritt."})})]}),A&&(0,D.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,D.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:A})}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,D.jsx)("button",{type:"button",onClick:r,disabled:k,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",title:o("common.cancel",{defaultValue:"Abbrechen"}),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:k,className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed",title:k?o("common.saving",{defaultValue:"Speichern..."}):o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"}),children:k?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(N.A,{className:"h-5 w-5"})})]})]});return t?x?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,D.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsx)("div",{className:"p-4",children:O()})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!h&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o("lifecycle.offboarding.startTitle",{defaultValue:"Offboarding starten"})}),(0,D.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:O()})]})]}):null},B=e=>{let{isOpen:t,onClose:r,onOffboardingCompleted:n,userId:l,userName:i,offboardingTasks:o}=e;const{t:d}=(0,s.Bd)(),{openSidepane:c,closeSidepane:u}=(0,L.N)(),{showMessage:g}=(0,f.A)(),[x,b]=(0,a.useState)(window.innerWidth<640),[h,p]=(0,a.useState)(window.innerWidth>1070),[k,N]=(0,a.useState)(!1),[A,S]=(0,a.useState)(null),[C,z]=(0,a.useState)(""),E=o.filter((e=>"done"===e.status)),F=o.length>0&&E.length===o.length,T=i.trim().toLowerCase();(0,a.useEffect)((()=>{const e=()=>{b(window.innerWidth<640),p(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(t?(c(),z(""),S(null)):u(),()=>{u()})),[t,c,u]);const I=async e=>{if(e.preventDefault(),C.trim().toLowerCase()===T||(S(d("lifecycle.offboarding.complete.confirmTextMismatch",{defaultValue:"Best\xe4tigungstext stimmt nicht \xfcberein"})),0)){N(!0),S(null);try{await v.A.put(j.Sn.LIFECYCLE.STATUS(l),{status:"archived"}),g(d("lifecycle.offboarding.complete.success",{defaultValue:"Offboarding erfolgreich abgeschlossen"}),"success"),n(),r()}catch(s){var t,a;console.error("Fehler beim Abschlie\xdfen des Offboarding:",s);const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||d("lifecycle.offboarding.complete.error",{defaultValue:"Fehler beim Abschlie\xdfen des Offboarding"});S(e),g(e,"error")}finally{N(!1)}}},P=()=>(0,D.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,D.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md flex items-center space-x-3",children:[(0,D.jsx)(w.A,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),(0,D.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[d("lifecycle.offboarding.complete.user",{defaultValue:"Mitarbeiter"}),": ",i]})]}),o.length>0&&(0,D.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-md",children:[(0,D.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:d("lifecycle.offboarding.complete.tasksStatus",{defaultValue:"Status der Offboarding-Aufgaben"})}),(0,D.jsx)("div",{className:"space-y-2",children:o.map((e=>{const t="done"===e.status;return(0,D.jsxs)("div",{className:"flex items-center space-x-2 text-sm ".concat(t?"text-green-700 dark:text-green-300":"text-orange-700 dark:text-orange-300"),children:[t?(0,D.jsx)(w.A,{className:"h-4 w-4 flex-shrink-0"}):(0,D.jsx)(V.A,{className:"h-4 w-4 flex-shrink-0"}),(0,D.jsx)("span",{children:e.title}),(0,D.jsx)("span",{className:"ml-auto text-xs",children:"(".concat(t?d("common.done",{defaultValue:"Abgeschlossen"}):d("common.open",{defaultValue:"Offen"}),")")})]},e.id)}))})]}),!F&&o.length>0&&(0,D.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 p-4",children:(0,D.jsxs)("div",{className:"flex",children:[(0,D.jsx)("div",{className:"flex-shrink-0",children:(0,D.jsx)(V.A,{className:"h-5 w-5 text-orange-400","aria-hidden":"true"})}),(0,D.jsxs)("div",{className:"ml-3",children:[(0,D.jsx)("h3",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:d("lifecycle.offboarding.complete.warningTitle",{defaultValue:"Nicht alle Aufgaben abgeschlossen"})}),(0,D.jsx)("div",{className:"mt-2 text-sm text-orange-700 dark:text-orange-200",children:(0,D.jsx)("p",{children:d("lifecycle.offboarding.complete.warningText",{defaultValue:"Es sind noch nicht alle Offboarding-Aufgaben abgeschlossen. Sie k\xf6nnen das Offboarding trotzdem abschlie\xdfen, aber es wird empfohlen, alle Aufgaben zuerst zu erledigen."})})})]})]})}),F&&(0,D.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 p-4",children:(0,D.jsxs)("div",{className:"flex",children:[(0,D.jsx)("div",{className:"flex-shrink-0",children:(0,D.jsx)(w.A,{className:"h-5 w-5 text-green-400","aria-hidden":"true"})}),(0,D.jsxs)("div",{className:"ml-3",children:[(0,D.jsx)("h3",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:d("lifecycle.offboarding.complete.allTasksCompleted",{defaultValue:"Alle Aufgaben abgeschlossen"})}),(0,D.jsx)("div",{className:"mt-2 text-sm text-green-700 dark:text-green-200",children:(0,D.jsx)("p",{children:d("lifecycle.offboarding.complete.allTasksCompletedText",{defaultValue:"Alle Offboarding-Aufgaben sind abgeschlossen. Sie k\xf6nnen das Offboarding jetzt abschlie\xdfen."})})})]})]})}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"confirmText",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("lifecycle.offboarding.complete.confirmLabel",{userName:i})||'Best\xe4tigen Sie durch Eingabe des Namens: "'.concat(i,'"')," *"]}),(0,D.jsx)("input",{type:"text",id:"confirmText",value:C,onChange:e=>{z(e.target.value),S(null)},className:"w-full px-3 py-2 border ".concat(A&&A.includes("Best\xe4tigung")?"border-red-500":"border-gray-300"," dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"),placeholder:i,required:!0}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:d("lifecycle.offboarding.complete.confirmHint",{defaultValue:"Geben Sie den vollst\xe4ndigen Namen des Mitarbeiters ein, um das Offboarding abzuschlie\xdfen"})})]}),(0,D.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsxs)("div",{className:"flex",children:[(0,D.jsx)("div",{className:"flex-shrink-0",children:(0,D.jsx)(V.A,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),(0,D.jsxs)("div",{className:"ml-3",children:[(0,D.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:d("lifecycle.offboarding.complete.finalWarningTitle",{defaultValue:"Wichtiger Hinweis"})}),(0,D.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-200",children:(0,D.jsx)("p",{children:d("lifecycle.offboarding.complete.finalWarningText",{defaultValue:"Durch das Abschlie\xdfen des Offboarding wird der Mitarbeiter archiviert. Dieser Vorgang kann nicht r\xfcckg\xe4ngig gemacht werden."})})})]})]})}),(0,D.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,D.jsx)("button",{type:"button",onClick:r,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:k,title:d("common.cancel",{defaultValue:"Abbrechen"}),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:k||C.trim().toLowerCase()!==T,title:k?d("common.saving",{defaultValue:"Speichern..."}):d("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"}),children:k?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(w.A,{className:"h-5 w-5"})})]})]});return t?x?(0,D.jsxs)(m.lG,{open:t,onClose:r,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,D.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]})}),(0,D.jsxs)("div",{className:"p-6",children:[A&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A}),P()]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!h&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:r,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:d("lifecycle.offboarding.complete.title",{defaultValue:"Offboarding abschlie\xdfen"})}),(0,D.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[A&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:A}),P()]})]})]}):null},M=e=>{var t;let{userId:r,userName:l}=e;const{t:o}=(0,s.Bd)(),{isHR:d,isAdmin:c}=(0,n.S)(),{showMessage:m}=(0,f.A)(),[u,x]=(0,a.useState)(null),[y,p]=(0,a.useState)([]),[k,R]=(0,a.useState)([]),[E,L]=(0,a.useState)([]),[T,O]=(0,a.useState)(!0),[V,M]=(0,a.useState)(null),[G,W]=(0,a.useState)(!1),[H,J]=(0,a.useState)(!1),[K,Y]=(0,a.useState)(null),[Z,X]=(0,a.useState)(null),[$,Q]=(0,a.useState)(null),[ee,te]=(0,a.useState)(null),[re,ae]=(0,a.useState)(!1),[se,ne]=(0,a.useState)(!1),[le,ie]=(0,a.useState)(!1),[oe,de]=(0,a.useState)(""),[ce,me]=(0,a.useState)(""),ue=(0,a.useRef)(!1),ge=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!ue.current||e)try{var t,a,s,n,l,i;ue.current=!0,O(!0);const[e,o,d,c]=await Promise.all([v.A.get(j.Sn.LIFECYCLE.BY_USER(r)),v.A.get(j.Sn.LIFECYCLE.CERTIFICATES(r)),v.A.get(j.Sn.LIFECYCLE.CONTRACTS(r)),v.A.get(j.Sn.TASKS.BY_USER(r)).catch((()=>({data:[]})))]);x(e.data),p((null===(t=o.data)||void 0===t?void 0:t.certificates)||[]),R((null===(a=d.data)||void 0===a?void 0:a.contracts)||[]);const m=c.data||[],u=["Crear certificado laboral","Realizar liquidaci\xf3n final","Desafiliar de seguridad social"],g=m.filter((e=>u.includes(e.title)));L(g),"onboarding"===(null===(s=e.data)||void 0===s||null===(n=s.lifecycle)||void 0===n?void 0:n.status)&&100===(null===(l=e.data)||void 0===l||null===(i=l.progress)||void 0===i?void 0:i.percent)&&setTimeout((()=>{ge()}),1e3),M(null)}catch(c){var o,d;console.error("Fehler beim Laden der Lebenszyklus-Daten:",c),M((null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.message)||"Fehler beim Laden der Daten"),m("Fehler beim Laden der Daten","error")}finally{O(!1),ue.current=!1}else setTimeout((()=>{ue.current||ge(!0)}),500)}),[r]);(0,a.useEffect)((()=>{ue.current=!1,ge()}),[ge]);const xe=()=>{null!==u&&void 0!==u&&u.lifecycle&&(de(u.lifecycle.contractStartDate?new Date(u.lifecycle.contractStartDate).toISOString().split("T")[0]:""),me(u.lifecycle.contractEndDate?new Date(u.lifecycle.contractEndDate).toISOString().split("T")[0]:""),ie(!0))},be=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric"});if(T)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,D.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(V)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,D.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",children:(0,D.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:V})})});if(!u)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:(0,D.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:o("lifecycle.noData",{defaultValue:"Keine Lebenszyklus-Daten verf\xfcgbar"})})});(null===(t=u.lifecycle)||void 0===t?void 0:t.socialSecurityRegistrations)||u.socialSecurityRegistrations;const{lifecycle:he,progress:ye}=u;return(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,D.jsx)(h.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.statusTitle")]}),(0,D.jsxs)("div",{className:"flex items-center space-x-3",children:[function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r={onboarding:{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",labelKey:"lifecycle.status.onboarding"},active:{color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",labelKey:"lifecycle.status.active"},contract_change:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",labelKey:"lifecycle.status.contract_change"},offboarding:{color:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",labelKey:"lifecycle.status.offboarding"},archived:{color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",labelKey:"lifecycle.status.archived"}}[e]||{color:"bg-gray-100 text-gray-800",labelKey:e};return(0,D.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(r.color," ").concat(t?"cursor-pointer hover:opacity-80":""),children:o(r.labelKey)||e})}(he.status),(d()||c())&&"active"===he.status&&(0,D.jsx)("button",{onClick:()=>ae(!0),className:"p-2 bg-orange-600 dark:bg-orange-700 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",title:o("lifecycle.offboarding.startButton",{defaultValue:"Offboarding starten"}),children:(0,D.jsx)(N.A,{className:"h-5 w-5"})}),(d()||c())&&"offboarding"===he.status&&(0,D.jsx)("button",{onClick:()=>ne(!0),className:"p-2 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",title:o("lifecycle.offboarding.complete.button",{defaultValue:"Offboarding abschlie\xdfen"}),children:(0,D.jsx)(w.A,{className:"h-5 w-5"})})]})]}),(0,D.jsxs)("div",{className:"space-y-2 text-sm",children:[he.onboardingStartedAt&&(0,D.jsxs)("div",{className:"flex justify-between",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingStarted")}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.onboardingStartedAt).toLocaleDateString("de-DE")})]}),he.onboardingCompletedAt&&(0,D.jsxs)("div",{className:"flex justify-between",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.onboardingCompleted")}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.onboardingCompletedAt).toLocaleDateString("de-DE")})]}),(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractStart")}),(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[he.contractStartDate?(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.contractStartDate).toLocaleDateString("de-DE")}):(0,D.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,D.jsx)("button",{onClick:()=>xe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",title:o("lifecycle.edit",{defaultValue:"Bearbeiten"}),children:(0,D.jsx)(A.A,{className:"h-4 w-4"})})]})]}),(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.contractEnd")}),(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[he.contractEndDate?(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.contractEndDate).toLocaleDateString("de-DE")}):(0,D.jsx)("span",{className:"text-gray-400 italic text-sm",children:o("lifecycle.notSet",{defaultValue:"Nicht gesetzt"})}),(d()||c())&&(0,D.jsx)("button",{onClick:()=>xe(),className:"p-1 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition",title:o("lifecycle.edit",{defaultValue:"Bearbeiten"}),children:(0,D.jsx)(A.A,{className:"h-4 w-4"})})]})]}),he.offboardingStartedAt&&(0,D.jsxs)("div",{className:"flex justify-between",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboardingStarted")}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.offboardingStartedAt).toLocaleDateString("de-DE")})]}),he.exitDate&&(0,D.jsxs)("div",{className:"flex justify-between",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitDate")}),(0,D.jsx)("span",{className:"dark:text-white",children:new Date(he.exitDate).toLocaleDateString("de-DE")})]}),he.exitReason&&(0,D.jsxs)("div",{className:"flex justify-between",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.exitReason")}),(0,D.jsx)("span",{className:"dark:text-white",children:he.exitReason})]})]})]}),"onboarding"===he.status&&(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.progressTitle")}),(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.progressSteps",{completed:ye.completed,total:ye.total})}),(0,D.jsxs)("span",{className:"font-medium dark:text-white",children:[ye.percent,"%"]})]}),(0,D.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,D.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(ye.percent,"%")}})})]})]}),"offboarding"===he.status&&(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold dark:text-white mb-4",children:o("lifecycle.offboarding.progressTitle",{defaultValue:"Offboarding-Fortschritt"})}),(0,D.jsxs)("div",{className:"space-y-4",children:[(()=>{const e=E.filter((e=>"done"===e.status)).length,t=E.length||3,r=t>0?Math.round(e/t*100):0;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,D.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:o("lifecycle.offboarding.progressSteps",{completed:e,total:t})||"".concat(e," von ").concat(t," Schritten abgeschlossen")}),(0,D.jsxs)("span",{className:"font-medium dark:text-white",children:[r,"%"]})]}),(0,D.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,D.jsx)("div",{className:"bg-orange-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(r,"%")}})})]})})(),E.length>0&&(0,D.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,D.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("lifecycle.offboarding.tasksTitle",{defaultValue:"Offboarding-Aufgaben"})}),E.map((e=>{const t="done"===e.status;return(0,D.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border ".concat(t?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600"),children:[(0,D.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[t?(0,D.jsx)(w.A,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):(0,D.jsx)(S.A,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 flex-shrink-0"}),(0,D.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,D.jsx)("p",{className:"text-sm font-medium ".concat(t?"text-green-800 dark:text-green-200":"text-gray-800 dark:text-gray-200"),children:e.title}),e.description&&(0,D.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 truncate",children:e.description})]})]}),(0,D.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(t?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200"),children:t?o("common.done",{defaultValue:"Abgeschlossen"}):o("common.open",{defaultValue:"Offen"})})]},e.id)}))]})]})]}),(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,D.jsx)(b.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.certificates")]}),(d()||c())&&(0,D.jsx)("button",{onClick:()=>W(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:o("lifecycle.createCertificate"),"aria-label":o("lifecycle.createCertificate"),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})})]}),0===y.length?(0,D.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,D.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,D.jsx)("p",{children:o("lifecycle.noCertificates")})]}):(0,D.jsx)("div",{className:"space-y-4",children:y.map((e=>(0,D.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,D.jsxs)("div",{className:"flex items-start justify-between",children:[(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,D.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.certificate"),"employment"!==e.certificateType&&" (".concat(e.certificateType,")")]}),e.isLatest&&(0,D.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,D.jsx)(w.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,D.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(C.A,{className:"h-4 w-4"}),(0,D.jsxs)("span",{children:[o("lifecycle.issuedOn")," ",be(e.issueDate)]})]}),e.generatedByUser&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(i.A,{className:"h-4 w-4"}),(0,D.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,D.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,D.jsx)("button",{onClick:()=>Y(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",title:o("lifecycle.edit"),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{onClick:()=>(async e=>{Q(e);try{const t=await v.A.get(j.Sn.LIFECYCLE.CERTIFICATE_DOWNLOAD(r,e),{responseType:"blob"}),a=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download="arbeitszeugnis-".concat(e,".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),m("Arbeitszeugnis erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitszeugnisses","error")}finally{Q(null)}})(e.id),disabled:$===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",title:o("lifecycle.download"),children:$===e.id?(0,D.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,D.jsx)(z.A,{className:"h-5 w-5"})})]})]})},e.id)))})]}),(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center mb-4",children:[(d()||c())&&(0,D.jsx)("button",{onClick:()=>J(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center mr-3",style:{width:"30.19px",height:"30.19px"},title:o("lifecycle.createContract"),"aria-label":o("lifecycle.createContract"),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})}),(0,D.jsxs)("h3",{className:"text-lg font-semibold dark:text-white flex items-center",children:[(0,D.jsx)(b.A,{className:"h-5 w-5 mr-2"}),o("lifecycle.contracts")]})]}),0===k.length?(0,D.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,D.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,D.jsx)("p",{children:o("lifecycle.noContracts")})]}):(0,D.jsx)("div",{className:"space-y-4",children:k.map((e=>(0,D.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:(0,D.jsxs)("div",{className:"flex items-start justify-between",children:[(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,D.jsxs)("h4",{className:"font-medium dark:text-white",children:[o("lifecycle.contract"),"employment"!==e.contractType&&" (".concat(e.contractType,")")]}),e.isLatest&&(0,D.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 flex items-center",children:[(0,D.jsx)(w.A,{className:"h-3 w-3 mr-1"}),o("lifecycle.current")]})]}),(0,D.jsxs)("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(C.A,{className:"h-4 w-4"}),(0,D.jsxs)("span",{children:[be(e.startDate),e.endDate&&" - ".concat(be(e.endDate))]})]}),e.position&&(0,D.jsxs)("div",{children:[o("lifecycle.position")," ",e.position]}),e.salary&&(0,D.jsxs)("div",{children:[o("lifecycle.salary")," ",e.salary.toLocaleString("de-DE",{style:"currency",currency:"EUR"})]}),e.workingHours&&(0,D.jsxs)("div",{children:[o("lifecycle.workingHours")," ",e.workingHours,"h/Woche"]}),e.generatedByUser&&(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsx)(i.A,{className:"h-4 w-4"}),(0,D.jsxs)("span",{children:[o("lifecycle.createdBy")," ",e.generatedByUser.firstName," ",e.generatedByUser.lastName]})]})]})]}),(0,D.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(d()||c())&&(0,D.jsx)("button",{onClick:()=>X(e),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition",title:o("lifecycle.edit"),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{onClick:()=>(async e=>{te(e);try{const t=await v.A.get(j.Sn.LIFECYCLE.CONTRACT_DOWNLOAD(r,e),{responseType:"blob"}),a=new Blob([t.data],{type:"application/pdf"}),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download="arbeitsvertrag-".concat(e,".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),m("Arbeitsvertrag erfolgreich heruntergeladen","success")}catch(t){console.error("Fehler beim Herunterladen:",t),m("Fehler beim Herunterladen des Arbeitsvertrags","error")}finally{te(null)}})(e.id),disabled:ee===e.id,className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",title:o("lifecycle.download"),children:ee===e.id?(0,D.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,D.jsx)(z.A,{className:"h-5 w-5"})})]})]})},e.id)))})]}),(null===u||void 0===u?void 0:u.lifecycle)&&(0,D.jsx)(q,{userId:r,lifecycleId:u.lifecycle.id,onUpdate:()=>ge(!0)}),(0,D.jsx)(F,{isOpen:G,onClose:()=>W(!1),onCertificateCreated:()=>{ge(),W(!1)},userId:r,userName:l}),(0,D.jsx)(I,{isOpen:H,onClose:()=>J(!1),onContractCreated:()=>{ge(),J(!1)},userId:r,userName:l}),K&&(0,D.jsx)(P,{isOpen:!!K,onClose:()=>Y(null),onCertificateUpdated:()=>{ge(),Y(null)},userId:r,certificate:K}),Z&&(0,D.jsx)(_,{isOpen:!!Z,onClose:()=>X(null),onContractUpdated:()=>{ge(),X(null)},userId:r,contract:Z}),(0,D.jsx)(U,{isOpen:re,onClose:()=>ae(!1),onOffboardingStarted:()=>{ge(),ae(!1)},userId:r,userName:l}),(0,D.jsx)(B,{isOpen:se,onClose:()=>ne(!1),onOffboardingCompleted:()=>{ge(),ne(!1)},userId:r,userName:l,offboardingTasks:E}),le&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[(0,D.jsx)("h2",{className:"text-xl font-semibold dark:text-white mb-4",children:o("lifecycle.editContractDates",{defaultValue:"Vertragsdaten bearbeiten"})}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractStart",{defaultValue:"Vertragsbeginn"})," *"]}),(0,D.jsx)("input",{type:"date",value:oe,onChange:e=>de(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[o("lifecycle.contractEnd",{defaultValue:"Vertragsende"})," (optional)"]}),(0,D.jsx)("input",{type:"date",value:ce,onChange:e=>me(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:o("lifecycle.contractEndHint",{defaultValue:"Nur bei befristeten Vertr\xe4gen ausf\xfcllen"})})]})]}),(0,D.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,D.jsx)("button",{onClick:()=>ie(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:o("common.cancel",{defaultValue:"Abbrechen"})}),(0,D.jsx)("button",{onClick:async()=>{try{await v.A.put(j.Sn.LIFECYCLE.STATUS(r),{status:(null===u||void 0===u?void 0:u.lifecycle.status)||"active",contractStartDate:oe||null,contractEndDate:ce||null}),m("Vertragsdaten erfolgreich aktualisiert","success"),ie(!1),ge()}catch(e){console.error("Fehler beim Speichern der Vertragsdaten:",e),m("Fehler beim Speichern der Vertragsdaten","error")}},disabled:!oe,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o("common.save",{defaultValue:"Speichern"})})]})]})})]})},G=[{code:"tiempo_completo",name:"Tiempo Completo (>21 Tage/Monat)"},{code:"tiempo_parcial_7",name:"Tiempo Parcial (\u22647 Tage/Monat)"},{code:"tiempo_parcial_14",name:"Tiempo Parcial (\u226414 Tage/Monat)"},{code:"tiempo_parcial_21",name:"Tiempo Parcial (\u226421 Tage/Monat)"},{code:"prestacion_de_servicios",name:"Prestaci\xf3n de Servicios"},{code:"externo",name:"Externo"}],W=e=>{let{onError:t}=e;const{t:r}=(0,s.Bd)(),l=[{code:"CO",name:r("countries.CO")},{code:"CH",name:r("countries.CH")},{code:"DE",name:r("countries.DE")},{code:"AT",name:r("countries.AT")}],i=[{code:"CH",name:r("countries.CH")},{code:"CO",name:r("countries.CO")}],d=[{code:"es",name:r("languages.es")},{code:"de",name:r("languages.de")},{code:"en",name:r("languages.en")}],[v,j]=(0,a.useState)([]),[N,w]=(0,a.useState)(null),[A,S]=(0,a.useState)({}),[C,z]=(0,a.useState)(!1),[R,E]=(0,a.useState)([]),[F,T]=(0,a.useState)(0),[I,P]=(0,a.useState)(!1),[_,O]=(0,a.useState)(null),{showMessage:q}=(0,f.A)(),{isAdmin:V}=(0,n.S)(),[U,B]=(0,a.useState)([]),[W,H]=(0,a.useState)(!1),[J,K]=(0,a.useState)("details"),[Y,Z]=(0,a.useState)("active"),[X,$]=(0,a.useState)(!1),[Q,ee]=(0,a.useState)(window.innerWidth<640),[te,re]=(0,a.useState)(window.innerWidth>1070),{openSidepane:ae,closeSidepane:se}=(0,L.N)(),[ne,le]=(0,a.useState)({email:"",password:"",firstName:"",lastName:""});(0,a.useEffect)((()=>{const e=()=>{ee(window.innerWidth<640),re(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(X?ae():se(),()=>{se()})),[X,ae,se]);const[ie,oe]=(0,a.useState)([]);(0,a.useEffect)((()=>{de()}),[]);const de=async()=>{try{const e=await u.i$.getAll();oe(e.data),ce("active",e.data)}catch(e){ue(e)}},ce=function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie).filter((t=>{const r=void 0===t.active||t.active;return"active"===e?r:!r})).sort(((e,t)=>{const r=(e.username||"").toLowerCase(),a=(t.username||"").toLowerCase(),s=(e.firstName||"").toLowerCase(),n=(t.firstName||"").toLowerCase();return r!==a?r.localeCompare(a):s.localeCompare(n)}));j(t)};(0,a.useEffect)((()=>{ie.length>0&&ce(Y,ie)}),[Y]);const me=async e=>{try{if(!e||isNaN(e))return void w(null);console.log("Lade Benutzerdetails f\xfcr ID:",e);const t=await u.i$.getById(e),r=(0,c.A)((0,c.A)({},t.data),{},{active:void 0===t.data.active||t.data.active,birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});let a=[];t.data.roles&&Array.isArray(t.data.roles)?(console.log("Rollenstruktur (Typ):",typeof t.data.roles,"L\xe4nge:",t.data.roles.length),t.data.roles.length>0&&t.data.roles[0].role?(a=t.data.roles.map((e=>e.role.id)),console.log("Extrahierte Rollen-IDs aus verschachtelter Struktur:",a)):t.data.roles.length>0&&("number"===typeof t.data.roles[0]?a=t.data.roles:t.data.roles[0].roleId?a=t.data.roles.map((e=>e.roleId)):t.data.roles[0].id&&(a=t.data.roles.map((e=>e.id))))):console.warn("Rollen fehlen oder sind kein Array:",t.data.roles),0===a.length&&t.data.role&&(console.log("Versuche Rollen aus role-Eigenschaft zu extrahieren:",t.data.role),Array.isArray(t.data.role)?a=t.data.role.map((e=>e.id)):"object"===typeof t.data.role&&null!==t.data.role&&(a=[t.data.role.id])),console.log("Endg\xfcltige extrahierte Rollen-IDs:",a),w(r),S(r),E(a),0===U.length&&await(async()=>{try{H(!0);const t=[{id:1,name:"admin",description:"Administrator mit allen Rechten",permissions:[]},{id:2,name:"user",description:"Standardbenutzer",permissions:[]},{id:999,name:"hamburger",description:"Hamburger-Rolle f\xfcr neue Benutzer",permissions:[]}];try{const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&e.data.length>0?(B(e.data),console.log("".concat(e.data.length," Rollen erfolgreich geladen"))):(console.warn("Keine Rollen vom Server erhalten, verwende Fallback"),B(t))}catch(e){console.warn("Fehler beim Laden der Rollen, verwende Fallback:",e),B(t)}}finally{H(!1)}})()}catch(t){console.error("Fehler beim Laden der Benutzerdetails:",t),ue(t)}},ue=e=>{var r,a;let s="Ein Fehler ist aufgetreten";null!==(r=e.response)&&void 0!==r&&null!==(a=r.data)&&void 0!==a&&a.message?s=e.response.data.message:e instanceof Error&&(s=e.message),!s.includes("Ung\xfcltige Rollen-ID")||N?t(s):console.warn("Fehler unterdr\xfcckt, da kein Benutzer ausgew\xe4hlt ist:",s)},ge=e=>{const{name:t,value:r,type:a}=e.target;let s=r;"number"===a&&(s=""===r?null:Number(r)),S((0,c.A)((0,c.A)({},A),{},{[t]:s})),z(!0)},xe=async e=>{if(e&&N)if(1===e&&1===N.id&&R.includes(e))q("Die Admin-Rolle kann vom Admin-Benutzer nicht entfernt werden","warning");else try{console.log("Toggle Rolle:",e,"f\xfcr Benutzer:",N.id),console.log("Aktuelle ausgew\xe4hlte Rollen:",R);const t=R.includes(e),r=t?R.filter((t=>t!==e)):[...R,e];console.log("Neue ausgew\xe4hlte Rollen:",r),E(r),console.log("Sende Rollenaktualisierung an API:",{userId:N.id,roleIds:r});const a=await u.i$.updateRoles(N.id,r);console.log("API-Antwort bei Rollenaktualisierung:",a.data),await me(N.id),q(t?"Rolle erfolgreich entfernt":"Rolle erfolgreich zugewiesen","success")}catch(t){console.error("Fehler beim Aktualisieren der Rollen:",t),me(N.id),ue(t),q("Fehler beim Aktualisieren der Rollen","error")}};(0,a.useEffect)((()=>{N&&(S((0,c.A)((0,c.A)({},N),{},{birthday:N.birthday?new Date(N.birthday).toISOString().split("T")[0]:null})),z(!1))}),[N]);const be=e=>{const{name:t,value:r}=e.target;le((0,c.A)((0,c.A)({},ne),{},{[t]:r}))},he=async e=>{if(e.preventDefault(),ne.email&&ne.password&&ne.firstName&&ne.lastName)if(ne.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/))try{const e=await u.i$.create(ne);if(e.data){const t=(0,c.A)((0,c.A)({},e.data),{},{active:void 0===e.data.active||e.data.active});oe((e=>[t,...e])),"active"===Y&&t.active&&j((e=>[t,...e]))}q("Benutzer erfolgreich erstellt","success"),$(!1),le({email:"",password:"",firstName:"",lastName:""})}catch(s){var r,a;await de();const e=(null===(r=s.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Fehler beim Erstellen des Benutzers";q(e,"error"),t(e)}else q("Ung\xfcltiges E-Mail-Format","error");else q("Bitte f\xfcllen Sie alle Felder aus","error")};return(0,D.jsxs)("div",{className:"container mx-auto px-4 pb-6",children:[(0,D.jsx)("div",{className:"mb-6",children:(0,D.jsxs)("div",{className:"flex items-start gap-4",children:[(0,D.jsx)("div",{className:"flex items-center pt-8",children:V()&&(0,D.jsx)("button",{onClick:()=>$(!0),className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:r("users.create"),"aria-label":r("users.create"),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})})}),(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,D.jsx)("button",{type:"button",onClick:()=>Z("active"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("active"===Y?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:r("users.active")}),(0,D.jsx)("button",{type:"button",onClick:()=>Z("inactive"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors ".concat("inactive"===Y?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"),children:r("users.inactive")})]}),(0,D.jsxs)("select",{id:"userSelect",onChange:e=>{const t=parseInt(e.target.value,10);t&&!isNaN(t)?me(t):(w(null),S({}),E([]))},className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",children:[(0,D.jsxs)("option",{value:"",children:["-- ",r("common.select")," --"]}),v.map((e=>(0,D.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.username,")"]},e.id)))]})]})]})}),N&&(0,D.jsx)("div",{children:(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 mb-6",children:[(0,D.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,D.jsxs)("nav",{className:"flex -mb-px",children:[(0,D.jsxs)("button",{onClick:()=>K("details"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("details"===J?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,D.jsx)(x.A,{className:"h-5 w-5 inline mr-2"}),r("users.title")]}),(0,D.jsxs)("button",{onClick:()=>K("documents"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("documents"===J?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,D.jsx)(b.A,{className:"h-5 w-5 inline mr-2"}),r("profile.documents")]}),(0,D.jsxs)("button",{onClick:()=>K("roles"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("roles"===J?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,D.jsx)(o.A,{className:"h-5 w-5 inline mr-2"}),r("roles.title")]}),(0,D.jsxs)("button",{onClick:()=>K("lifecycle"),className:"py-4 px-6 text-center border-b-2 font-medium text-sm ".concat("lifecycle"===J?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,D.jsx)(h.A,{className:"h-5 w-5 inline mr-2"}),r("lifecycle.tabTitle")]})]})}),"details"===J&&(0,D.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!N||!N.id)return t("Kein Benutzer ausgew\xe4hlt"),void q("Kein Benutzer ausgew\xe4hlt","error");try{var r,a,s,n;if(null===(r=A.username)||void 0===r||!r.trim())throw new Error("Benutzername ist erforderlich");if(null===(a=A.email)||void 0===a||!a.trim())throw new Error("E-Mail ist erforderlich");if(null===(s=A.firstName)||void 0===s||!s.trim())throw new Error("Vorname ist erforderlich");if(null===(n=A.lastName)||void 0===n||!n.trim())throw new Error("Nachname ist erforderlich");const e=(0,c.A)((0,c.A)({},A),{},{salary:null===A.salary||void 0===A.salary||""===A.salary?null:"string"===typeof A.salary?parseFloat(A.salary):A.salary,normalWorkingHours:null===A.normalWorkingHours||void 0===A.normalWorkingHours||""===A.normalWorkingHours?7.6:"string"===typeof A.normalWorkingHours?parseFloat(A.normalWorkingHours):A.normalWorkingHours,hourlyRate:null===A.hourlyRate||void 0===A.hourlyRate||""===A.hourlyRate?null:"string"===typeof A.hourlyRate?A.hourlyRate:A.hourlyRate.toString(),monthlySalary:null===A.monthlySalary||void 0===A.monthlySalary||""===A.monthlySalary?null:"string"===typeof A.monthlySalary?parseFloat(A.monthlySalary):A.monthlySalary,birthday:A.birthday||null});console.log("Sende Daten zum Server:",e);const t=await u.i$.update(N.id,e);if(t.data){const r=(0,c.A)((0,c.A)({},t.data),{},{birthday:t.data.birthday?new Date(t.data.birthday).toISOString().split("T")[0]:null});w(r),S((0,c.A)((0,c.A)({},r),{},{birthday:r.birthday?new Date(r.birthday).toISOString().split("T")[0]:null})),oe((e=>e.map((e=>e.id===r.id?r:e)))),ce(Y,ie.map((e=>e.id===r.id?r:e))),q("Benutzerprofil erfolgreich aktualisiert","success"),z(!1),void 0!==e.contract&&T((e=>e+1))}}catch(m){var l,i;if(console.error("Fehler beim Speichern der Benutzerdaten:",m),await de(),400===(null===(l=m.response)||void 0===l?void 0:l.status)){var o,d;const e="Validierungsfehler: ".concat((null===(o=m.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.message)||"Bitte \xfcberpr\xfcfe die eingegebenen Daten");t(e),q(e,"error")}else 404===(null===(i=m.response)||void 0===i?void 0:i.status)?(t("Benutzer wurde nicht gefunden"),q("Benutzer wurde nicht gefunden","error")):ue(m)}},className:"p-6",children:[(0,D.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.username")}),(0,D.jsx)("input",{type:"text",name:"username",value:A.username||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.email")}),(0,D.jsx)("input",{type:"email",name:"email",value:A.email||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.firstName")}),(0,D.jsx)("input",{type:"text",name:"firstName",value:A.firstName||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.lastName")}),(0,D.jsx)("input",{type:"text",name:"lastName",value:A.lastName||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.birthday")}),(0,D.jsx)("input",{type:"date",name:"birthday",value:A.birthday||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.bankDetails")}),(0,D.jsx)("input",{type:"text",name:"bankDetails",value:A.bankDetails||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.contract")}),(0,D.jsxs)("select",{name:"contract",value:A.contract||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"",children:r("common.pleaseSelect",{defaultValue:"Bitte ausw\xe4hlen..."})}),G.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.salary")}),(0,D.jsx)("input",{type:"number",name:"salary",value:null===A.salary||void 0===A.salary?"":A.salary,onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.normalWorkingHours")}),(0,D.jsx)("input",{type:"number",step:"0.1",name:"normalWorkingHours",value:null===A.normalWorkingHours||void 0===A.normalWorkingHours?"7.6":A.normalWorkingHours,onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.country")}),(0,D.jsx)("select",{name:"country",value:A.country||"CO",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:l.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("profile.language")}),(0,D.jsx)("select",{name:"language",value:A.language||"es",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:d.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))})]})]}),(0,D.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:r("users.form.payrollSettings")}),(0,D.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.payrollCountry")}),(0,D.jsx)("select",{name:"payrollCountry",value:A.payrollCountry||N.payrollCountry||"CH",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:i.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))})]}),("CO"===A.payrollCountry||"CO"===N.payrollCountry&&!A.payrollCountry)&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("users.form.contractType")}),(0,D.jsxs)("select",{name:"contractType",value:A.contractType||"",onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"",children:"Bitte ausw\xe4hlen"}),G.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))]})]})]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("users.form.hourlyRate")," (","CH"===(A.payrollCountry||N.payrollCountry)?"CHF":"COP",")"]}),(0,D.jsx)("input",{type:"number",name:"hourlyRate",min:"0",step:"CH"===(A.payrollCountry||N.payrollCountry)?"0.05":"1",value:null===A.hourlyRate||void 0===A.hourlyRate?"":A.hourlyRate,onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"CH"===(A.payrollCountry||N.payrollCountry)?"z.B. 45.00":"z.B. 50000"})]}),("CO"===A.payrollCountry||"CO"===N.payrollCountry)&&"servicios_externos"!==A.contractType&&"servicios_externos"!==N.contractType&&(A.contractType||N.contractType)&&(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("users.form.monthlySalary")," (COP)"]}),(0,D.jsx)("input",{type:"number",name:"monthlySalary",min:"0",step:"1000",value:null===A.monthlySalary||void 0===A.monthlySalary?"":A.monthlySalary,onChange:ge,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"z.B. 3500000"})]})]})]}),C&&(0,D.jsxs)("div",{className:"mt-4 flex justify-end gap-3",children:[(0,D.jsx)("button",{type:"button",onClick:()=>{N&&S((0,c.A)((0,c.A)({},N),{},{birthday:N.birthday?new Date(N.birthday).toISOString().split("T")[0]:null})),z(!1)},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:r("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:r("common.save"),children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,D.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[void 0!==N.active&&(0,D.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(N.active?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"),children:N.active?r("users.active"):r("users.inactive")}),V()&&(0,D.jsx)("button",{onClick:async()=>{if(!N||!N.id)return void q("Kein Benutzer ausgew\xe4hlt","error");const e=parseInt(localStorage.getItem("userId")||"0",10);if(N.id!==e)try{const e=void 0===N.active||N.active,t=!e;console.log("Toggle active:",{currentActiveStatus:e,newActiveStatus:t,selectedUser:N,selectedUserActive:N.active,userId:N.id});const r={active:t};console.log("Sending update payload:",r,"Type of active:",typeof t);const a=await u.i$.update(N.id,r);if(console.log("Update response:",a.data),a.data){const e=(0,c.A)((0,c.A)({},a.data),{},{active:void 0===a.data.active||a.data.active,birthday:a.data.birthday?new Date(a.data.birthday).toISOString().split("T")[0]:null});console.log("Updated user data:",e),w(e),S((0,c.A)((0,c.A)({},e),{},{birthday:e.birthday?new Date(e.birthday).toISOString().split("T")[0]:null})),oe((t=>t.map((t=>t.id===e.id?e:t)))),ce(Y,ie.map((t=>t.id===e.id?e:t))),await de(),q(t?"Benutzer erfolgreich aktiviert":"Benutzer erfolgreich deaktiviert","success")}}catch(t){console.error("Fehler beim Aktivieren/Deaktivieren des Benutzers:",t),ue(t),await de()}else q("Du kannst dich nicht selbst deaktivieren","warning")},className:"flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(N.active?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/20 dark:text-green-400 dark:hover:bg-green-900/30"),title:N.active?r("users.deactivate"):r("users.activate"),children:N.active?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(y.A,{className:"h-5 w-5"}),r("users.deactivate")]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(p.A,{className:"h-5 w-5"}),r("users.activate")]})})]})]}),"documents"===J&&(0,D.jsx)("div",{className:"p-6",children:(0,D.jsx)(k.A,{userId:N.id,isAdmin:!0})}),"roles"===J&&(0,D.jsx)("div",{className:"p-6",children:W?(0,D.jsxs)("div",{className:"mt-4 mb-4",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:r("roleAssignment.title")}),(0,D.jsx)("p",{className:"dark:text-gray-300",children:r("roleAssignment.loading")})]}):U.length>0&&(0,D.jsxs)("div",{children:[(0,D.jsx)("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:r("roleAssignment.title")}),R.some((e=>!U.some((t=>t.id===e))))&&(0,D.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-4",children:[(0,D.jsx)("p",{className:"font-bold",children:r("roleAssignment.unknownRolesWarning")}),(0,D.jsx)("p",{children:r("roleAssignment.unknownRolesMessage",{ids:R.filter((e=>!U.some((t=>t.id===e)))).join(", ")})}),(0,D.jsx)("p",{className:"mt-2 text-sm",children:r("roleAssignment.availableRoleIds",{ids:U.map((e=>e.id)).join(", ")})})]}),(0,D.jsxs)("div",{className:"mb-4",children:[(0,D.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("roleAssignment.currentRoles")}),0===R.length?(0,D.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:r("roleAssignment.noRolesAssigned")}):(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[U.filter((e=>R.includes(e.id))).map((e=>{const t=1===e.id&&N&&1===N.id;return(0,D.jsx)("div",{className:"border rounded-lg p-4 ".concat(t?"border-green-500 bg-green-50 dark:bg-green-900/20 dark:border-green-700 cursor-not-allowed":"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-700 cursor-pointer"),onClick:()=>!t&&xe(e.id),children:(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("h4",{className:"font-medium flex items-center dark:text-white",children:[e.name,t&&(0,D.jsx)("span",{className:"ml-2 text-xs bg-green-600 text-white px-2 py-0.5 rounded-full",children:r("roleAssignment.fixed")})]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,D.jsxs)("div",{className:"flex items-center ".concat(t?"text-gray-400 dark:text-gray-500":"text-blue-600 dark:text-blue-400"),children:[(0,D.jsx)("span",{className:"mr-2 text-sm",children:r(t?"roleAssignment.fixedAssigned":"roleAssignment.remove")}),(0,D.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,D.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})]})]})},e.id)})),R.filter((e=>!U.some((t=>t.id===e)))).map((e=>(0,D.jsx)("div",{className:"border border-orange-500 bg-orange-50 rounded-lg p-4",children:(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium",children:r("roleAssignment.unknownRole",{id:e})}),(0,D.jsx)("p",{className:"text-sm text-orange-600",children:r("roleAssignment.unknownRoleDescription")})]}),(0,D.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,D.jsx)("span",{className:"mr-2 text-sm",children:r("roleAssignment.remove")}),(0,D.jsx)("button",{onClick:()=>xe(e),className:"focus:outline-none",children:(0,D.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,D.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]})]})},"unknown-".concat(e))))]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("roleAssignment.availableRoles")}),0===U.filter((e=>!R.includes(e.id))).length?(0,D.jsx)("p",{className:"text-gray-500 dark:text-gray-400 italic",children:r("roleAssignment.noRolesAvailable")}):(0,D.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.filter((e=>!R.includes(e.id))).map((e=>(0,D.jsx)("div",{className:"border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50",onClick:()=>xe(e.id),children:(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium",children:e.name}),(0,D.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,D.jsxs)("div",{className:"flex items-center text-gray-500 hover:text-blue-600",children:[(0,D.jsx)("span",{className:"mr-2 text-sm",children:r("roleAssignment.add")}),(0,D.jsx)(g.A,{className:"h-5 w-5"})]})]})},e.id)))})]})]})}),"lifecycle"===J&&N&&(0,D.jsx)("div",{className:"p-6",children:(0,D.jsx)(M,{userId:N.id,userName:"".concat(N.firstName," ").concat(N.lastName)},"lifecycle-".concat(N.id,"-").concat(F))})]})}),X&&(0,D.jsx)(D.Fragment,{children:Q?(0,D.jsxs)(m.lG,{open:X,onClose:()=>$(!1),className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:r("organisation.createUser.title")}),(0,D.jsx)("button",{onClick:()=>$(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]})}),(0,D.jsxs)("form",{onSubmit:he,className:"p-6",children:[(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.email")," *"]}),(0,D.jsx)("input",{type:"email",name:"email",value:ne.email,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.password")," *"]}),(0,D.jsx)("input",{type:"password",name:"password",value:ne.password,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.firstName")," *"]}),(0,D.jsx)("input",{type:"text",name:"firstName",value:ne.firstName,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.lastName")," *"]}),(0,D.jsx)("input",{type:"text",name:"lastName",value:ne.lastName,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,D.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,D.jsx)("button",{type:"button",onClick:()=>$(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:r("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:r("organisation.createUser.create"),children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[X&&!te&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:X?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(X?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:X?"auto":"none"},"aria-hidden":!X,role:"dialog","aria-modal":X,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:r("organisation.createUser.title")}),(0,D.jsx)("button",{onClick:()=>$(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsx)("div",{className:"flex flex-col flex-1 min-h-0",children:(0,D.jsxs)("form",{onSubmit:he,className:"flex flex-col flex-1 min-h-0",children:[(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0 space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.email")," *"]}),(0,D.jsx)("input",{type:"email",name:"email",value:ne.email,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.password")," *"]}),(0,D.jsx)("input",{type:"password",name:"password",value:ne.password,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.firstName")," *"]}),(0,D.jsx)("input",{type:"text",name:"firstName",value:ne.firstName,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("organisation.createUser.lastName")," *"]}),(0,D.jsx)("input",{type:"text",name:"lastName",value:ne.lastName,onChange:be,className:"w-full rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 dark:bg-gray-700 dark:text-white",required:!0})]})]}),(0,D.jsxs)("div",{className:"flex justify-end gap-3 border-t dark:border-gray-700 pt-4 px-4 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:()=>$(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:r("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800",title:r("organisation.createUser.create"),children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]})]})})]})};var H=r(3744),J=r(9248),K=r(2517),Y=r(8010),Z=r(4426),X=r(7829),$=r(6507),Q=r(5365);const ee=["dashboard","worktracker","cerebro","settings","profile"],te=["dashboard","worktracker","consultations","team_worktime_control","payroll","organization_management","cerebro","settings","profile"],re=["requests","tasks","users","roles","organization","organization_join_requests","organization_users","team_worktime","worktime","clients","consultation_invoices","branches","notifications","settings","monthly_reports"],ae=["database_reset_table","database_logs","invoice_create","invoice_download","invoice_mark_paid","invoice_settings","todo_create","todo_edit","todo_delete","task_create","task_edit","task_delete","user_create","user_edit","user_delete","role_assign","role_create","role_edit","role_delete","organization_create","organization_edit","organization_delete","worktime_start","worktime_stop","worktime_edit","worktime_delete","cerebro","consultation_start","consultation_stop","consultation_edit","client_create","client_edit","client_delete","settings_system","settings_notifications","settings_profile","payroll_generate","payroll_export","payroll_edit"],se={requests:"dashboard",tasks:"worktracker",users:"organization_management",roles:"organization_management",organization:"organization_management",organization_join_requests:"organization_management",organization_users:"organization_management",team_worktime:"team_worktime_control",worktime:"worktracker",clients:"consultations",consultation_invoices:"consultations",branches:"settings",notifications:"general",settings:"settings",monthly_reports:"consultations"},ne={database_reset_table:"settings",database_logs:"settings",invoice_create:"consultations",invoice_download:"consultations",invoice_mark_paid:"consultations",invoice_settings:"consultations",todo_create:"worktracker",todo_edit:"worktracker",todo_delete:"worktracker",task_create:"worktracker",task_edit:"worktracker",task_delete:"worktracker",user_create:"organization_management",user_edit:"organization_management",user_delete:"organization_management",role_assign:"organization_management",role_create:"organization_management",role_edit:"organization_management",role_delete:"organization_management",organization_create:"organization_management",organization_edit:"organization_management",organization_delete:"organization_management",worktime_start:"worktracker",worktime_stop:"worktracker",worktime_edit:"worktracker",worktime_delete:"worktracker",cerebro:"cerebro",consultation_start:"consultations",consultation_stop:"consultations",consultation_edit:"consultations",client_create:"consultations",client_edit:"consultations",client_delete:"consultations",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",payroll_generate:"payroll",payroll_export:"payroll",payroll_edit:"payroll"},le={worktime_start:"worktime",worktime_stop:"worktime",worktime_edit:"worktime",worktime_delete:"worktime",task_create:"tasks",task_edit:"tasks",task_delete:"tasks",todo_create:"tasks",todo_edit:"tasks",todo_delete:"tasks",client_create:"clients",client_edit:"clients",client_delete:"clients",consultation_start:"clients",consultation_stop:"clients",consultation_edit:"clients",invoice_create:"consultation_invoices",invoice_download:"consultation_invoices",invoice_mark_paid:"consultation_invoices",invoice_settings:"consultation_invoices",user_create:"users",user_edit:"users",user_delete:"users",role_assign:"roles",role_create:"roles",role_edit:"roles",role_delete:"roles",organization_create:"organization",organization_edit:"organization",organization_delete:"organization",settings_system:"settings",settings_notifications:"settings",settings_profile:"settings",database_reset_table:null,database_logs:null,cerebro:null,payroll_generate:null,payroll_export:null,payroll_edit:null},ie="roles-table",oe=[1,2,999],de=["Admin","User","Hamburger"],ce=(e,t)=>!!oe.includes(e)||!(!t||!de.includes(t)),me=e=>{let{role:t,onEdit:r,onDelete:a,onCopy:n,canEdit:l,canDelete:i,canCopy:o}=e;const{t:d}=(0,s.Bd)();return(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:[(0,D.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,D.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,D.jsxs)("div",{className:"flex space-x-2",children:[o&&(0,D.jsx)("button",{onClick:()=>n(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:d("roles.actions.copy"),children:(0,D.jsx)(H.A,{className:"h-5 w-5"})}),l&&(0,D.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:d("roles.actions.edit"),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})}),i&&(0,D.jsx)("button",{onClick:()=>a(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",title:d("roles.actions.delete"),children:(0,D.jsx)(J.A,{className:"h-5 w-5"})})]})]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description||d("roles.noDescription")}),(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsxs)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:[d("roles.permissions"),":"]}),(0,D.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.permissions.filter((e=>"none"!==e.accessLevel)).slice(0,8).map((e=>(0,D.jsxs)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:[e.entity,": ",e.accessLevel]},"".concat(e.entity,"-").concat(e.entityType)))),t.permissions.filter((e=>"none"!==e.accessLevel)).length>8&&(0,D.jsxs)("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-300 px-2 py-1 rounded",children:["+",t.permissions.filter((e=>"none"!==e.accessLevel)).length-8," ",d("common.showMore")]})]})]})]})},ue=e=>{let{onRolesChange:t,onError:r,readOnly:l=!1}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)(!1),[x,b]=(0,a.useState)(null),[h,f]=(0,a.useState)([]),[k,N]=(0,a.useState)(!0),w=(0,a.useMemo)((()=>({dashboard:i("roles.pages.dashboard"),worktracker:i("roles.pages.worktracker"),consultations:i("roles.pages.consultations"),team_worktime_control:i("roles.pages.team_worktime_control"),payroll:i("roles.pages.payroll"),organization_management:i("roles.pages.organization_management"),cerebro:i("roles.pages.cerebro"),settings:i("roles.pages.settings"),profile:i("roles.pages.profile")})),[i]),A=(0,a.useMemo)((()=>({tasks:i("roles.tables.tasks"),worktime:i("roles.tables.worktime"),users:i("roles.tables.users"),roles:i("roles.tables.roles"),organization:i("roles.tables.organization"),organization_join_requests:i("roles.tables.organization_join_requests"),organization_users:i("roles.tables.organization_users"),clients:i("roles.tables.clients"),consultation_invoices:i("roles.tables.consultation_invoices"),requests:i("roles.tables.requests"),team_worktime:i("roles.tables.team_worktime"),settings:i("roles.tables.settings"),notifications:i("roles.tables.notifications"),branches:i("roles.tables.branches"),monthly_reports:i("roles.tables.monthly_reports")})),[i]),S=(0,a.useMemo)((()=>({worktime_start:i("roles.buttons.worktime_start"),worktime_stop:i("roles.buttons.worktime_stop"),worktime_edit:i("roles.buttons.worktime_edit"),worktime_delete:i("roles.buttons.worktime_delete"),task_create:i("roles.buttons.task_create"),task_edit:i("roles.buttons.task_edit"),task_delete:i("roles.buttons.task_delete"),todo_create:i("roles.buttons.todo_create"),todo_edit:i("roles.buttons.todo_edit"),todo_delete:i("roles.buttons.todo_delete"),client_create:i("roles.buttons.client_create"),client_edit:i("roles.buttons.client_edit"),client_delete:i("roles.buttons.client_delete"),consultation_start:i("roles.buttons.consultation_start"),consultation_stop:i("roles.buttons.consultation_stop"),consultation_edit:i("roles.buttons.consultation_edit"),invoice_create:i("roles.buttons.invoice_create"),invoice_download:i("roles.buttons.invoice_download"),invoice_mark_paid:i("roles.buttons.invoice_mark_paid"),invoice_settings:i("roles.buttons.invoice_settings"),user_create:i("roles.buttons.user_create"),user_edit:i("roles.buttons.user_edit"),user_delete:i("roles.buttons.user_delete"),role_assign:i("roles.buttons.role_assign"),role_create:i("roles.buttons.role_create"),role_edit:i("roles.buttons.role_edit"),role_delete:i("roles.buttons.role_delete"),organization_create:i("roles.buttons.organization_create"),organization_edit:i("roles.buttons.organization_edit"),organization_delete:i("roles.buttons.organization_delete"),settings_system:i("roles.buttons.settings_system"),settings_notifications:i("roles.buttons.settings_notifications"),settings_profile:i("roles.buttons.settings_profile"),database_reset_table:i("roles.buttons.database_reset_table"),database_logs:i("roles.buttons.database_logs"),payroll_generate:i("roles.buttons.payroll_generate"),payroll_export:i("roles.buttons.payroll_export"),payroll_edit:i("roles.buttons.payroll_edit"),cerebro:i("roles.buttons.cerebro")})),[i]),[C,z]=(0,a.useState)({name:"",description:"",permissions:[...te.map((e=>({entity:e,entityType:"page",accessLevel:"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...ae.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]}),[R,E]=(0,a.useState)(null),{hasPermission:F}=(0,n.S)(),[T,I]=(0,a.useState)(""),[P,_]=(0,a.useState)(!1),[O,q]=(0,a.useState)([]),[V,U]=(0,a.useState)([]),[B,M]=(0,a.useState)("Alle"),[G,W]=(0,a.useState)(null),[H,J]=(0,a.useState)(window.innerWidth<640),[oe,de]=(0,a.useState)(window.innerWidth>1070),{openSidepane:ue,closeSidepane:ge}=(0,L.N)(),{handleError:xe,handleValidationError:be}=(0,$.qz)(),[he,ye]=(0,a.useState)(!1),[pe,fe]=(0,a.useState)(null),[ke,ve]=(0,a.useState)(10);(0,a.useEffect)((()=>{const e=()=>{J(window.innerWidth<640),de(window.innerWidth>1070)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>(o?ue():ge(),()=>{ge()})),[o,ue,ge]);const je=(0,a.useCallback)((async()=>{N(!0),console.log("DEBUGAUSGABE: Hole Rollen vom Server...");try{const e=await u.Zj.getAll();console.log("DEBUGAUSGABE: Rollen erfolgreich geholt:",e.data),f(e.data),E(null)}catch(R){console.error("DEBUGAUSGABE: Fehler beim Abrufen der Rollen:",R),xe(R,{component:"RoleManagementTab",action:"fetchRoles"}),r&&r("Fehler beim Laden der Rollen")}finally{N(!1)}}),[xe,r]);(0,a.useEffect)((()=>{je()}),[je]);const Ne=async e=>{if(e.preventDefault(),E(null),C.name){if(x){const e=C.permissions.map((e=>"page"===e.entityType&&ee.includes(e.entity)?(0,c.A)((0,c.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));if(!x.id||isNaN(x.id))return console.warn("DEBUGAUSGABE: Ung\xfcltige Rollen-ID erkannt, Bearbeitung abgebrochen"),void xe("Ung\xfcltige Rollen-ID, Bearbeitung abgebrochen",{component:"RoleManagementTab",roleId:x.id});if(ce(x.id,x.name))return console.warn("DEBUGAUSGABE: Versuch, gesch\xfctzte Rolle mit ID ".concat(x.id," zu bearbeiten")),xe({message:"Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",name:"PermissionError"},{component:"RoleManagementTab",roleId:x.id,category:Q.h.PERMISSION}),void d(!1);if(!h.some((e=>e.id===x.id)))return console.error("DEBUGAUSGABE: Rolle mit ID ".concat(x.id," existiert nicht in der aktuellen Liste")),xe("Rolle mit ID ".concat(x.id," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:x.id}),d(!1),void await je();console.log("DEBUGAUSGABE: Bearbeite Rolle mit ID ".concat(x.id));try{console.log("DEBUGAUSGABE: Sende Aktualisierung an API:",{name:C.name,description:C.description,permissions:e});const t={name:C.name,description:C.description,permissions:e};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.update");const r=await u.Zj.update(x.id,t);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.update"),console.log("DEBUGAUSGABE: API-Antwort bei Rollenaktualisierung:",r),await je()}catch(r){return console.error("DEBUGAUSGABE: Fehler bei Rollenaktualisierung:",r),void(r.response?r.response.data.meta&&"Record to update not found."===r.response.data.meta.cause?(xe("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:x.id}),d(!1),await je()):xe(r.response.data.message||"Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:x.id}):xe("Fehler beim Aktualisieren der Rolle",{component:"RoleManagementTab",roleId:x.id}))}}else try{const e=C.permissions.map((e=>"page"===e.entityType&&ee.includes(e.entity)?(0,c.A)((0,c.A)({},e),{},{accessLevel:"both"}):e)).filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})));console.log("DEBUGAUSGABE: Sende Daten an API f\xfcr neue Rolle:",{name:C.name,description:C.description,permissions:e});const t={name:C.name,description:C.description,permissions:e};console.log("DEBUGAUSGABE: Vor dem API-Aufruf roleApi.create");const r=await u.Zj.create(t);console.log("DEBUGAUSGABE: Nach dem API-Aufruf roleApi.create"),console.log("DEBUGAUSGABE: API-Antwort beim Erstellen der Rolle:",r),await je()}catch(a){return console.error("DEBUGAUSGABE: Fehler bei API-Anfrage zum Erstellen der Rolle:",a),void(a.response?xe(a.response.data.message||"Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}):xe("Fehler beim Erstellen der Rolle",{component:"RoleManagementTab"}))}t&&t(),d(!1),Ce()}else be("Rollenname darf nicht leer sein",{name:"Rollenname ist erforderlich"})},we=async e=>{if(!e||isNaN(e))return console.warn("Ung\xfcltige Rollen-ID erkannt, L\xf6schvorgang abgebrochen"),void xe("Ung\xfcltige Rollen-ID, L\xf6schvorgang abgebrochen",{component:"RoleManagementTab",roleId:e});const r=h.find((t=>t.id===e));if(r&&ce(e,r.name))return console.warn("Versuch, gesch\xfctzte Rolle mit ID ".concat(e," (").concat(r.name,") zu l\xf6schen")),void xe("Gesch\xfctzte Systemrollen k\xf6nnen nicht gel\xf6scht werden",{component:"RoleManagementTab",roleId:e});if(window.confirm("M\xf6chten Sie diese Rolle wirklich l\xf6schen?"))try{console.log("Starte L\xf6schvorgang f\xfcr Rolle mit ID ".concat(e));if(!h.some((t=>t.id===e)))return console.error("Rolle mit ID ".concat(e," existiert nicht in der aktuellen Liste")),xe("Rolle mit ID ".concat(e," existiert nicht mehr. Bitte aktualisieren Sie die Seite."),{component:"RoleManagementTab",roleId:e}),void await je();console.log("Sende L\xf6schanfrage an API");try{const t=await u.Zj.delete(e);console.log("API-Antwort beim L\xf6schen der Rolle:",t),await je(),console.log("Rollenliste nach L\xf6schen aktualisiert")}catch(a){return console.error("API-Fehler beim L\xf6schen der Rolle:",a),void(a.response?(console.error("API-Fehlerdaten:",a.response.data),a.response.data.meta&&"Record to delete does not exist."===a.response.data.meta.cause?(xe("Diese Rolle existiert nicht mehr in der Datenbank. Die Anzeige wird aktualisiert.",{component:"RoleManagementTab",roleId:e}),await je()):xe(a.response.data.message||i("roleManagement.deleteError"),{component:"RoleManagementTab",roleId:e})):xe(i("roleManagement.networkError"),{component:"RoleManagementTab",roleId:e}))}console.log("Rolle erfolgreich gel\xf6scht"),t&&t()}catch(s){console.error(i("roleManagement.unhandledError"),s),xe(s);try{await je()}catch(n){console.error("Fehler beim Aktualisieren der Rollenliste nach fehlgeschlagenem L\xf6schvorgang:",n)}}},Ae=async e=>{try{if(!e||!e.id)return void xe("Ung\xfcltige Rolle zum Kopieren",{component:"RoleManagementTab"});const r={name:"".concat(e.name,"-Kopie"),description:e.description||"",permissions:e.permissions.filter((e=>"none"!==e.accessLevel)).map((e=>({entity:e.entity,entityType:e.entityType,accessLevel:e.accessLevel})))};console.log("DEBUGAUSGABE: Kopiere Rolle:",e.name,"mit Daten:",r);const a=await u.Zj.create(r);console.log("DEBUGAUSGABE: Rolle erfolgreich kopiert:",a.data),f((e=>[a.data,...e])),Se(a.data),t&&t()}catch(r){console.error("DEBUGAUSGABE: Fehler beim Kopieren der Rolle:",r),xe(r,{component:"RoleManagementTab",roleId:e.id})}},Se=e=>{if(ce(e.id,e.name))return void xe("Gesch\xfctzte Systemrollen k\xf6nnen nicht bearbeitet werden",{component:"RoleManagementTab",roleId:e.id});const t=[...te.map((e=>({entity:e,entityType:"page",accessLevel:ee.includes(e)?"both":"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...ae.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))];e.permissions.forEach((e=>{const r=t.findIndex((t=>t.entity===e.entity&&t.entityType===e.entityType));-1!==r&&("page"===e.entityType&&ee.includes(e.entity)?t[r].accessLevel="both":t[r].accessLevel=e.accessLevel)})),z({name:e.name,description:e.description||"",permissions:t}),b(e),d(!0)},Ce=()=>{b(null),z({name:"",description:"",permissions:[...te.map((e=>({entity:e,entityType:"page",accessLevel:ee.includes(e)?"both":"none"}))),...re.map((e=>({entity:e,entityType:"table",accessLevel:"none"}))),...ae.map((e=>({entity:e,entityType:"button",accessLevel:"none"})))]})},ze=e=>{const t=[...C.permissions];C.permissions.filter((e=>"page"===e.entityType&&!ee.includes(e.entity))).forEach((r=>{const a=C.permissions.indexOf(r);t[a]=(0,c.A)((0,c.A)({},r),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},Re=e=>{const t=[...C.permissions];C.permissions.filter((e=>"table"===e.entityType)).forEach((r=>{const a=C.permissions.indexOf(r);t[a]=(0,c.A)((0,c.A)({},r),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},Ee=e=>{const t=[...C.permissions];C.permissions.filter((e=>"button"===e.entityType)).forEach((r=>{const a=C.permissions.indexOf(r);t[a]=(0,c.A)((0,c.A)({},r),{},{accessLevel:e})})),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))},Le=()=>O.length,De=(0,a.useMemo)((()=>h.filter((e=>{if(T){const t=T.toLowerCase();if(!(e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)))return!1}if(O.length>0){let t=O.length>0;for(let r=0;r<O.length;r++){const a=O[r];let s=!1;switch(a.column){case"name":"equals"===a.operator?s=e.name.toLowerCase()===(a.value||"").toLowerCase():"contains"===a.operator?s=e.name.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator&&(s=e.name.toLowerCase().startsWith((a.value||"").toLowerCase()));break;case"description":if(!e.description){s=!1;break}"equals"===a.operator?s=e.description.toLowerCase()===(a.value||"").toLowerCase():"contains"===a.operator?s=e.description.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator&&(s=e.description.toLowerCase().startsWith((a.value||"").toLowerCase()));break;case"permissions":const t=a.value,r=e.permissions.filter((e=>e.accessLevel===t)).length;("greaterThan"===a.operator||"equals"===a.operator)&&(s=r>0)}if(0===r)t=s;else{t="AND"===V[r-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.localeCompare(t.name)))),[h,T,O,V]);(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(ie))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:ie,name:"Alle",conditions:[],operators:[]};await v.A.post(j.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Rollen erstellt")}}catch(R){console.error("Fehler beim Erstellen der Standard-Filter:",R)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(ie)),t=e.data.find((e=>"Alle"===e.name));t&&(M("Alle"),W(t.id),Fe(t.conditions,t.operators))}catch(R){console.error("Fehler beim Setzen des initialen Filters:",R)}})()}),[]);const Fe=(e,t)=>{q(e),U(t)},Te=()=>{q([]),U([]),M(""),W(null)};return(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsx)("div",{className:"flex items-center",children:!l&&F("roles","write","table")&&(0,D.jsx)("button",{onClick:()=>d(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:i("roles.createRole"),"aria-label":i("roles.createRole"),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})})}),(0,D.jsx)("div",{}),(0,D.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,D.jsx)("input",{type:"text",placeholder:"Suchen...",className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:T,onChange:e=>I(e.target.value)}),(0,D.jsxs)("button",{className:"p-2 rounded-md ".concat(Le()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"," ml-1 relative"),onClick:()=>_(!P),title:"Filter",children:[(0,D.jsx)(Y.A,{className:"w-5 h-5"}),Le()>0&&(0,D.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:Le()})]})]})]}),P&&(0,D.jsx)(Z.A,{columns:[{id:"name",label:"Name"},{id:"description",label:"Beschreibung"},{id:"permissions",label:"Berechtigungen"}],onApply:Fe,onReset:Te,savedConditions:O,savedOperators:V,tableId:ie}),(0,D.jsx)(X.A,{tableId:ie,onSelectFilter:Fe,onReset:Te,activeFilterName:B,selectedFilterId:G,onFilterChange:(e,t,r,a)=>{M(e),W(t),Fe(r,a)},defaultFilterName:"Alle"}),k?(0,D.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,D.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===h.length?(0,D.jsx)("div",{className:"p-4 bg-gray-50 rounded text-center",children:(0,D.jsx)("p",{children:"Keine Rollen gefunden. Erstellen Sie eine neue Rolle mit dem Button oben."})}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{className:"space-y-4",children:De.slice(0,ke).map((e=>(0,D.jsx)(me,{role:e,onEdit:Se,onDelete:we,onCopy:Ae,canEdit:!l&&F("roles","write","table")&&!ce(e.id,e.name),canDelete:!l&&F("roles","write","table")&&!ce(e.id,e.name),canCopy:!l&&F("roles","write","table")&&ce(e.id,e.name)},e.id)))}),De.length>ke&&(0,D.jsx)("div",{className:"mt-4 flex justify-center",children:(0,D.jsx)("button",{className:"p-2 text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>ve((e=>e+10)),title:"Mehr anzeigen (".concat(De.length-ke," verbleibend)"),children:(0,D.jsx)(K.A,{className:"h-5 w-5"})})})]})]}),o&&(0,D.jsx)(D.Fragment,{children:H?(0,D.jsxs)(m.lG,{open:o,onClose:()=>d(!1),className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[(0,D.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i(x?"roles.editRole":"roles.createRole")}),(0,D.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]})}),(0,D.jsxs)("form",{onSubmit:Ne,className:"flex flex-col flex-1 min-h-0",children:[(0,D.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,D.jsxs)("div",{className:"p-6 space-y-5",children:[(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,D.jsx)("input",{type:"text",value:C.name,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Beschreibung"}),(0,D.jsx)("input",{type:"text",value:C.description,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.detailedPermissions")}),(0,D.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,D.jsx)("button",{type:"button",onClick:()=>ze("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",title:i("roles.form.activateAllPages"),children:i("roles.form.pagesChecked")}),(0,D.jsx)("button",{type:"button",onClick:()=>ze("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:i("roles.form.deactivateAllPages"),children:i("roles.form.pagesUnchecked")}),(0,D.jsx)("button",{type:"button",onClick:()=>Re("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",title:i("roles.form.activateAllTables"),children:i("roles.form.tablesChecked")}),(0,D.jsx)("button",{type:"button",onClick:()=>Re("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:i("roles.form.deactivateAllTables"),children:i("roles.form.tablesUnchecked")}),(0,D.jsx)("button",{type:"button",onClick:()=>Ee("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",title:i("roles.form.activateAllButtons"),children:i("roles.form.buttonsChecked")}),(0,D.jsx)("button",{type:"button",onClick:()=>Ee("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:i("roles.form.deactivateAllButtons"),children:i("roles.form.buttonsUnchecked")})]})]}),(0,D.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600",children:C.permissions.filter((e=>"page"===e.entityType)).map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel;return(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:w[e.entity]||e.entity}),(0,D.jsxs)("label",{className:"inline-flex items-center ".concat(ee.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,disabled:ee.includes(e.entity),onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-11 h-6 ".concat(ee.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"," peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"),children:ee.includes(e.entity)&&(0,D.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),C.permissions.filter((t=>"table"===t.entityType&&se[t.entity]===e.entity)).sort(((e,t)=>{const r=A[e.entity]||e.entity,a=A[t.entity]||t.entity,s=["users","roles","organization"],n=s.indexOf(e.entity),l=s.indexOf(t.entity);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:r.localeCompare(a)})).map(((t,r)=>{const a=C.permissions.indexOf(t),s="both"===t.accessLevel,n=t.entity,l=A[n]||n,o=C.permissions.filter((t=>"button"===t.entityType&&ne[t.entity]===e.entity&&le[t.entity]===n&&!("tasks"===n&&t.entity.startsWith("todo_")))).sort(((e,t)=>{const r=S[e.entity]||e.entity,a=S[t.entity]||t.entity,s=[i("roleManagement.buttonOrder.start"),i("roleManagement.buttonOrder.stop"),i("roleManagement.buttonOrder.create"),i("roleManagement.buttonOrder.edit"),i("roleManagement.buttonOrder.delete")],n=s.indexOf(r),l=s.indexOf(a);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:r.localeCompare(a)}));return(0,D.jsxs)("div",{className:"mt-3",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,D.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...C.permissions];e[a]=(0,c.A)((0,c.A)({},t),{},{accessLevel:s?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:e}))}}),(0,D.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),o.map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,D.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,D.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-".concat(e.entity,"-").concat(t))}))]},"table-permission-".concat(n,"-").concat(r))})),C.permissions.filter((t=>"button"===t.entityType&&ne[t.entity]===e.entity&&!le[t.entity])).sort(((e,t)=>{const r=S[e.entity]||e.entity,a=S[t.entity]||t.entity;return r.localeCompare(a)})).map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,D.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,D.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-".concat(e.entity,"-").concat(t))}))]},"permission-page-".concat(e.entity,"-").concat(t))}))})]})]})}),(0,D.jsxs)("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-end gap-2 border-t dark:border-gray-600 flex-shrink-0",children:[(0,D.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800",title:x?"Aktualisieren":"Erstellen",children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[o&&!oe&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",style:{opacity:o?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-2xl w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(o?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:o?"auto":"none"},"aria-hidden":!o,role:"dialog","aria-modal":o,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:x?"Rolle bearbeiten":"Neue Rolle erstellen"}),(0,D.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsx)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:(0,D.jsxs)("form",{onSubmit:Ne,className:"space-y-5",children:[(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.name")}),(0,D.jsx)("input",{type:"text",value:C.name,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:i("roles.form.description")}),(0,D.jsx)("input",{type:"text",value:C.description,onChange:e=>z((0,c.A)((0,c.A)({},C),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,D.jsxs)("div",{className:"mt-2",children:[(0,D.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Detaillierte Berechtigungen"}),(0,D.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,D.jsx)("button",{type:"button",onClick:()=>ze("both"),className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800",title:"Alle Seiten aktivieren",children:"Seiten \u2713"}),(0,D.jsx)("button",{type:"button",onClick:()=>ze("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Seiten deaktivieren",children:"Seiten \u2717"}),(0,D.jsx)("button",{type:"button",onClick:()=>Re("both"),className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800",title:"Alle Tabellen aktivieren",children:"Tabellen \u2713"}),(0,D.jsx)("button",{type:"button",onClick:()=>Re("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Tabellen deaktivieren",children:"Tabellen \u2717"}),(0,D.jsx)("button",{type:"button",onClick:()=>Ee("both"),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-800",title:"Alle Buttons aktivieren",children:"Buttons \u2713"}),(0,D.jsx)("button",{type:"button",onClick:()=>Ee("none"),className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600",title:"Alle Buttons deaktivieren",children:"Buttons \u2717"})]})]}),(0,D.jsx)("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto border rounded-lg p-4 dark:border-gray-600 max-h-[60vh]",children:C.permissions.filter((e=>"page"===e.entityType)).map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel;return(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:w[e.entity]||e.entity}),(0,D.jsxs)("label",{className:"inline-flex items-center ".concat(ee.includes(e.entity)?"cursor-not-allowed opacity-80":"cursor-pointer"),children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,disabled:ee.includes(e.entity),onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-11 h-6 ".concat(ee.includes(e.entity)?"bg-blue-600 dark:bg-blue-700":"bg-gray-200 dark:bg-gray-700"," peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"),children:ee.includes(e.entity)&&(0,D.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-xs text-white font-medium",children:"Fix"})})]})]}),C.permissions.filter((t=>"table"===t.entityType&&se[t.entity]===e.entity)).sort(((e,t)=>{const r=A[e.entity]||e.entity,a=A[t.entity]||t.entity;return r.localeCompare(a)})).map(((t,r)=>{const a=C.permissions.indexOf(t),s="both"===t.accessLevel,n=t.entity,l=A[n]||n,o=C.permissions.filter((t=>"button"===t.entityType&&ne[t.entity]===e.entity&&le[t.entity]===n&&!("tasks"===n&&t.entity.startsWith("todo_")))).sort(((e,t)=>{const r=S[e.entity]||e.entity,a=S[t.entity]||t.entity,s=[i("roleManagement.buttonOrder.start"),i("roleManagement.buttonOrder.stop"),i("roleManagement.buttonOrder.create"),i("roleManagement.buttonOrder.edit"),i("roleManagement.buttonOrder.delete")],n=s.indexOf(r),l=s.indexOf(a);return-1!==n&&-1!==l?n-l:-1!==n?-1:-1!==l?1:r.localeCompare(a)}));return(0,D.jsxs)("div",{className:"mt-3",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between pl-6 border-l-2 border-blue-300 dark:border-blue-600",children:[(0,D.jsxs)("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["\u2514 ",l]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:()=>{const e=[...C.permissions];e[a]=(0,c.A)((0,c.A)({},t),{},{accessLevel:s?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:e}))}}),(0,D.jsx)("div",{className:"relative w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]}),o.map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,D.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-12 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,D.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-desktop-".concat(e.entity,"-").concat(t))}))]},"table-permission-desktop-".concat(n,"-").concat(r))})),C.permissions.filter((t=>"button"===t.entityType&&ne[t.entity]===e.entity&&!le[t.entity])).sort(((e,t)=>{const r=S[e.entity]||e.entity,a=S[t.entity]||t.entity;return r.localeCompare(a)})).map(((e,t)=>{const r=C.permissions.indexOf(e),a="both"===e.accessLevel,s=S[e.entity]||e.entity;return(0,D.jsxs)("div",{className:"flex items-center justify-between mt-2 pl-6 border-l-2 border-gray-300 dark:border-gray-600",children:[(0,D.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["\u2514 ",s]}),(0,D.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,D.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:a,onChange:()=>{const t=[...C.permissions];t[r]=(0,c.A)((0,c.A)({},e),{},{accessLevel:a?"none":"both"}),z((0,c.A)((0,c.A)({},C),{},{permissions:t}))}}),(0,D.jsx)("div",{className:"relative w-9 h-5 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:start-[1px] after:bg-white after:border-gray-300 dark:after:border-gray-600 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600 dark:peer-checked:bg-blue-700"})]})]},"button-permission-desktop-".concat(e.entity,"-").concat(t))}))]},"permission-page-desktop-".concat(e.entity,"-").concat(t))}))})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:()=>d(!1),className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:"Abbrechen",children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:x?"Aktualisieren":"Erstellen",children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})})]})]})})]})},ge=e=>{let{branch:t,onEdit:r,onDelete:a,canEdit:n,canDelete:l}=e;const{t:i}=(0,s.Bd)();return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4 mb-4",children:(0,D.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,D.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.name}),(0,D.jsxs)("div",{className:"flex space-x-2",children:[n&&(0,D.jsx)("button",{onClick:()=>r(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:i("common.edit",{defaultValue:"Bearbeiten"}),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})}),l&&(0,D.jsx)("button",{onClick:()=>a(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1",title:i("common.delete",{defaultValue:"L\xf6schen"}),children:(0,D.jsx)(J.A,{className:"h-5 w-5"})})]})]})})},xe="branches-table",be=e=>{let{onError:t}=e;const{t:r}=(0,s.Bd)(),[l,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(null),[u,x]=(0,a.useState)([]),[b,h]=(0,a.useState)(!0),[f,k]=(0,a.useState)({name:""}),[N,w]=(0,a.useState)(""),[A,S]=(0,a.useState)(!1),[C,z]=(0,a.useState)([]),[R,E]=(0,a.useState)([]),[F,T]=(0,a.useState)(""),[I,P]=(0,a.useState)(null),[_,O]=(0,a.useState)(10),{hasPermission:q}=(0,n.S)(),{openSidepane:V,closeSidepane:U}=(0,L.N)(),B=q("branches","write","table"),M=q("branches","write","table"),G=q("branches","write","table"),W=(0,a.useCallback)((async()=>{h(!0);try{const e=await v.A.get(j.Sn.BRANCHES.BASE);x(e.data)}catch(s){var e,a;console.error("Fehler beim Laden der Niederlassungen:",s);const n=(null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||r("branches.loadError");t(n)}finally{h(!1)}}),[t]);(0,a.useEffect)((()=>{W()}),[W]),(0,a.useEffect)((()=>(l?V():U(),()=>{U()})),[l,V,U]);const H=()=>{k({name:""}),d(null)},J=e=>{d(e),k({name:e.name}),i(!0)},K=()=>{i(!1),H()},$=async e=>{if(e.preventDefault(),f.name.trim())try{o?await v.A.put(j.Sn.BRANCHES.UPDATE(o.id),{name:f.name.trim()}):await v.A.post(j.Sn.BRANCHES.CREATE,{name:f.name.trim()}),await W(),K()}catch(n){var a,s;console.error("Fehler beim Speichern der Niederlassung:",n);const e=(null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||r("branches.saveError");t(e)}else t(r("branches.nameRequired"))},Q=async e=>{if(window.confirm(r("branches.deleteConfirm",{defaultValue:"M\xf6chten Sie diese Niederlassung wirklich l\xf6schen?"})))try{await v.A.delete(j.Sn.BRANCHES.DELETE(e)),await W()}catch(n){var a,s;console.error("Fehler beim L\xf6schen der Niederlassung:",n);const e=(null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||r("branches.deleteError");t(e)}},ee=()=>C.length,te=(0,a.useMemo)((()=>u.filter((e=>{if(N){const t=N.toLowerCase();if(!e.name.toLowerCase().includes(t))return!1}if(C.length>0){let t=C.length>0;for(let r=0;r<C.length;r++){const a=C[r];let s=!1;if("name"===a.column)"equals"===a.operator?s=e.name.toLowerCase()===(a.value||"").toLowerCase():"contains"===a.operator?s=e.name.toLowerCase().includes((a.value||"").toLowerCase()):"startsWith"===a.operator&&(s=e.name.toLowerCase().startsWith((a.value||"").toLowerCase()));if(0===r)t=s;else{t="AND"===R[r-1]?t&&s:t||s}}if(!t)return!1}return!0})).sort(((e,t)=>e.name.localeCompare(t.name)))),[u,N,C,R]),re=(e,t)=>{z(e),E(t)},ae=()=>{z([]),E([]),T(""),P(null)};(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error(r("common.notAuthenticated"));const e=(await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(xe))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:xe,name:"Alle",conditions:[],operators:[]};await v.A.post(j.Sn.SAVED_FILTERS.BASE,e),console.log(r("branches.filterCreated"))}}catch(e){console.error(r("branches.createStandardFiltersError"),e)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{const e=await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(xe)),t=e.data.find((e=>"Alle"===e.name));t&&(T("Alle"),P(t.id),re(t.conditions,t.operators))}catch(e){console.error(r("branches.setInitialFilterError"),e)}})()}),[]);const[se,ne]=(0,a.useState)(window.innerWidth<640);return(0,a.useEffect)((()=>{const e=()=>{ne(window.innerWidth<640)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsx)("div",{className:"flex items-center",children:B&&(0,D.jsx)("button",{onClick:()=>{H(),i(!0)},className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:r("branches.create",{defaultValue:"Neue Niederlassung"}),"aria-label":r("branches.create",{defaultValue:"Neue Niederlassung"}),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})})}),(0,D.jsx)("div",{}),(0,D.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,D.jsx)("input",{type:"text",placeholder:r("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:N,onChange:e=>w(e.target.value)}),(0,D.jsxs)("button",{className:"p-2 rounded-md ".concat(ee()>0?"bg-blue-50 text-blue-600":"hover:bg-gray-100"," ml-1 relative"),onClick:()=>S(!A),title:r("common.filter",{defaultValue:"Filter"}),children:[(0,D.jsx)(Y.A,{className:"w-5 h-5"}),ee()>0&&(0,D.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 text-white rounded-full text-xs flex items-center justify-center",children:ee()})]})]})]}),A&&(0,D.jsx)(Z.A,{columns:[{id:"name",label:r("branches.name",{defaultValue:"Name"})}],onApply:re,onReset:ae,savedConditions:C,savedOperators:R,tableId:xe}),(0,D.jsx)(X.A,{tableId:xe,onSelectFilter:re,onReset:ae,activeFilterName:F,selectedFilterId:I,onFilterChange:(e,t,r,a)=>{T(e),P(t),re(r,a)},defaultFilterName:"Alle"}),b?(0,D.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,D.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===te.length?(0,D.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded text-center",children:(0,D.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:r("branches.noBranches",{defaultValue:"Keine Niederlassungen gefunden. Erstellen Sie eine neue Niederlassung mit dem Button oben."})})}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{className:"space-y-4",children:te.slice(0,_).map((e=>(0,D.jsx)(ge,{branch:e,onEdit:J,onDelete:Q,canEdit:M,canDelete:G},e.id)))}),te.length>_&&(0,D.jsx)("div",{className:"mt-4 flex justify-center",children:(0,D.jsxs)("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 dark:bg-gray-800 dark:text-blue-400 dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>O((e=>e+10)),children:[r("common.showMore",{defaultValue:"Mehr anzeigen"})," (",te.length-_," ",r("common.remaining",{defaultValue:"verbleibend"}),")"]})})]})]}),l&&(0,D.jsx)(D.Fragment,{children:se?(0,D.jsxs)(m.lG,{open:l,onClose:K,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:o?r("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):r("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,D.jsx)("button",{onClick:K,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]})}),(0,D.jsxs)("form",{onSubmit:$,className:"p-6 space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("branches.name",{defaultValue:"Name"})}),(0,D.jsx)("input",{type:"text",value:f.name,onChange:e=>k((0,c.A)((0,c.A)({},f),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:K,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:r("common.cancel",{defaultValue:"Abbrechen"}),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:o?r("common.update",{defaultValue:"Aktualisieren"}):r("common.create",{defaultValue:"Erstellen"}),children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)("div",{className:"fixed inset-y-0 right-0 w-full sm:w-96 bg-white dark:bg-gray-800 shadow-xl z-50 flex flex-col",children:[(0,D.jsx)("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex-shrink-0",children:(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:o?r("branches.edit",{defaultValue:"Niederlassung bearbeiten"}):r("branches.create",{defaultValue:"Neue Niederlassung"})}),(0,D.jsx)("button",{onClick:K,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]})}),(0,D.jsxs)("form",{onSubmit:$,className:"flex flex-col flex-1 min-h-0",children:[(0,D.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,D.jsx)("div",{className:"p-6 space-y-4",children:(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("branches.name",{defaultValue:"Name"})}),(0,D.jsx)("input",{type:"text",value:f.name,onChange:e=>k((0,c.A)((0,c.A)({},f),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",required:!0,autoFocus:!0})]})})}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2 px-6 pb-6 border-t dark:border-gray-700",children:[(0,D.jsx)("button",{type:"button",onClick:K,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:r("common.cancel",{defaultValue:"Abbrechen"}),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors",title:o?r("common.update",{defaultValue:"Aktualisieren"}):r("common.create",{defaultValue:"Erstellen"}),children:(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]})};var he=r(7629),ye=r(8682),pe=r(3315),fe=r(8673),ke=r(2395);const ve=e=>{let{isOpen:t,onClose:r,onSuccess:n}=e;const{t:l}=(0,s.Bd)(),[i,o]=(0,a.useState)({name:"",displayName:"",domain:""}),[d,u]=(0,a.useState)(!1),[g,x]=(0,a.useState)({}),[b,h]=(0,a.useState)(window.innerWidth<640),[k,v]=(0,a.useState)(window.innerWidth>1070),{openSidepane:j,closeSidepane:N}=(0,L.N)(),{showMessage:w}=(0,f.A)(),{fetchCurrentUser:A}=(0,E.As)();(0,a.useEffect)((()=>{const e=()=>{h(window.innerWidth<640),v(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?j():N(),()=>{N()})),[t,j,N]);const S=e=>{const{name:t,value:r}=e.target;o((e=>(0,c.A)((0,c.A)({},e),{},{[t]:r}))),g[t]&&x((e=>(0,c.A)((0,c.A)({},e),{},{[t]:""})))},C=async e=>{if(e.preventDefault(),(()=>{const e={};return i.name.trim()||(e.name=l("organization.create.nameRequired")),i.displayName.trim()||(e.displayName=l("organization.create.displayNameRequired")),x(e),0===Object.keys(e).length})())try{u(!0),await fe.h.createOrganization(i),x({}),w(l("organization.create.createSuccess"),"success"),await A(),o({name:"",displayName:"",domain:""}),r(),n&&n()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||l("organization.create.createError");w(e,"error"),x({submit:e})}finally{u(!1)}else w(l("joinRequest.fillRequired"),"error")},z=()=>{o({name:"",displayName:"",domain:""}),x({}),r()};return b?(0,D.jsxs)(m.lG,{open:t,onClose:z,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:l("organization.create.title")}),(0,D.jsx)("button",{onClick:z,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("form",{onSubmit:C,className:"p-4",children:[g.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:g.submit}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.name")}),(0,D.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.displayName")}),(0,D.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.displayName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.displayName})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.domain")}),(0,D.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:z,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("joinRequest.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!k&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:z,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("organization.create.title")}),(0,D.jsx)("button",{onClick:z,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[g.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:g.submit}),(0,D.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.name")}),(0,D.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.displayName")}),(0,D.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:i.displayName,onChange:S,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(g.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.displayName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.displayName})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.create.domain")}),(0,D.jsx)("input",{type:"text",id:"domain",name:"domain",value:i.domain,onChange:S,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:z,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.create.creating":"organization.create.createButton"),children:d?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})]})]})},je=e=>{let{isOpen:t,onClose:r,onSuccess:n}=e;const{t:l}=(0,s.Bd)(),[i,o]=(0,a.useState)({organizationName:"",message:""}),[d,u]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[b,h]=(0,a.useState)({}),[k,v]=(0,a.useState)(window.innerWidth<640),[j,N]=(0,a.useState)(window.innerWidth>1070),{openSidepane:w,closeSidepane:A}=(0,L.N)(),[S,C]=(0,a.useState)([]),[z,E]=(0,a.useState)(!1),[F,T]=(0,a.useState)(null),I=(0,a.useRef)(null),P=(0,a.useRef)(null),{showMessage:_}=(0,f.A)();(0,a.useEffect)((()=>{const e=()=>{v(window.innerWidth<640),N(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?w():A(),()=>{A()})),[t,w,A]),(0,a.useEffect)((()=>{const e=e=>{P.current&&!P.current.contains(e.target)&&E(!1)};return z&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[z]);const O=e=>{const t=e.target.value;o((e=>(0,c.A)((0,c.A)({},e),{},{organizationName:t}))),T(null),b.organizationName&&h((e=>(0,c.A)((0,c.A)({},e),{},{organizationName:""}))),I.current&&clearTimeout(I.current),I.current=setTimeout((()=>{(async e=>{if(e.length<2)return C([]),void E(!1);try{x(!0);const t=await fe.h.searchOrganizations(e);C(t),E(!0)}catch(t){console.error("Fehler bei der Organisationen-Suche:",t),C([])}finally{x(!1)}})(t)}),300)},q=e=>{T(e),o((t=>(0,c.A)((0,c.A)({},t),{},{organizationName:e.name}))),E(!1),C([])},V=e=>{o((t=>(0,c.A)((0,c.A)({},t),{},{message:e.target.value}))),b.message&&h((e=>(0,c.A)((0,c.A)({},e),{},{message:""})))},U=async e=>{if(e.preventDefault(),(()=>{const e={};return i.organizationName.trim()?F||(e.organizationName=l("organization.join.selectFromList")):e.organizationName=l("organization.join.nameRequired"),h(e),0===Object.keys(e).length})())try{u(!0),await fe.h.createJoinRequest(i),h({}),_(l("organization.join.sendSuccess"),"success"),o({organizationName:"",message:""}),T(null),C([]),r(),n&&n()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||l("organization.join.sendError");_(e,"error"),h({submit:e})}finally{u(!1)}else _(l("joinRequest.fillRequired"),"error")},B=()=>{o({organizationName:"",message:""}),T(null),C([]),h({}),E(!1),I.current&&clearTimeout(I.current),r()};return k?(0,D.jsxs)(m.lG,{open:t,onClose:B,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:l("organization.join.title")}),(0,D.jsx)("button",{onClick:B,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("form",{onSubmit:U,className:"p-4",children:[b.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"relative",ref:P,children:[(0,D.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.search")}),(0,D.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:O,placeholder:l("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),z&&(S.length>0||g)&&(0,D.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:g?(0,D.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.searching")}):S.length>0?S.map((e=>(0,D.jsxs)("button",{type:"button",onClick:()=>q(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,D.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,D.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,D.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.noOrganizations")})})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.message")}),(0,D.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:V,rows:3,placeholder:l("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:B,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("joinRequest.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.join.sending":"organization.join.send"),children:d?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!j&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:B,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:l("organization.join.title")}),(0,D.jsx)("button",{onClick:B,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[b.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:b.submit}),(0,D.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,D.jsxs)("div",{className:"relative",ref:P,children:[(0,D.jsx)("label",{htmlFor:"organizationName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.search")}),(0,D.jsx)("input",{type:"text",id:"organizationName",name:"organizationName",value:i.organizationName,onChange:O,placeholder:l("organization.join.searchPlaceholder"),className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(b.organizationName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),b.organizationName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:b.organizationName}),z&&(S.length>0||g)&&(0,D.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:g?(0,D.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.searching")}):S.length>0?S.map((e=>(0,D.jsxs)("button",{type:"button",onClick:()=>q(e),className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700 focus:outline-none",children:[(0,D.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.displayName||e.name}),e.displayName&&(0,D.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]},e.id))):(0,D.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:l("organization.join.noOrganizations")})})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.join.message")}),(0,D.jsx)("textarea",{id:"message",name:"message",value:i.message||"",onChange:V,rows:3,placeholder:l("organization.join.messagePlaceholder"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:B,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:d,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(d?"organization.join.sending":"organization.join.send"),children:d?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})]})]})};var Ne=r(5648);const we=e=>{let{organization:t,onSave:r}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,a.useState)([]),[d,m]=(0,a.useState)({}),[g,x]=(0,a.useState)(!1),[b,h]=(0,a.useState)(!1),[y,k]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t&&(N(),w())}),[t]);const N=async()=>{k(!0);try{const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&o(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),l(n("lifecycle.loadRolesError",{defaultValue:"Fehler beim Laden der Rollen"}),"error")}finally{k(!1)}},w=async()=>{x(!0);try{const e=await v.A.get(j.Sn.ORGANIZATION_LIFECYCLE.LIFECYCLE_ROLES);m(e.data.lifecycleRoles||{})}catch(a){var e,t,r;if(console.error("Fehler beim Laden der Lebenszyklus-Rollen:",a),404!==(null===(e=a.response)||void 0===e?void 0:e.status))l((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||n("lifecycle.loadLifecycleRolesError",{defaultValue:"Fehler beim Laden der Konfiguration"}),"error")}finally{x(!1)}};return g&&!d?(0,D.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,D.jsx)(R.A,{className:"h-6 w-6 animate-spin text-gray-400"})}):(0,D.jsx)("div",{className:"space-y-6",children:(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:n("organization.lifecycleRoles.title",{defaultValue:"Lebenszyklus-Rollen"})}),(0,D.jsx)("button",{onClick:()=>{const e=i.find((e=>e.name.toLowerCase().includes("admin")||e.name.toLowerCase().includes("administrator"))),t=i.find((e=>e.name.toLowerCase().includes("hr")||e.name.toLowerCase().includes("human"))),r=i.find((e=>"derecho"===e.name.toLowerCase()||e.name.toLowerCase().includes("legal")));m((0,c.A)((0,c.A)({},d),{},{adminRoleId:(null===e||void 0===e?void 0:e.id)||null,hrRoleId:(null===t||void 0===t?void 0:t.id)||null,legalRoleId:(null===r||void 0===r?void 0:r.id)||null})),l(n("lifecycle.standardRolesAssigned",{defaultValue:"Standard-Rollen zugewiesen"}),"success")},className:"px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:n("lifecycle.assignStandardRoles",{defaultValue:"Standard-Rollen zuweisen"})})]}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.admin",{defaultValue:"Admin-Rolle"})}),(0,D.jsxs)("select",{value:d.adminRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{adminRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:[(0,D.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,D.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.hr",{defaultValue:"HR-Rolle"})}),(0,D.jsxs)("select",{value:d.hrRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{hrRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:[(0,D.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,D.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.lifecycleRoles.legal",{defaultValue:"Legal-Rolle"})}),(0,D.jsxs)("select",{value:d.legalRoleId||"",onChange:e=>{const t=e.target.value;m((0,c.A)((0,c.A)({},d),{},{legalRoleId:t&&""!==t&&!isNaN(parseInt(t,10))?parseInt(t,10):null}))},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:[(0,D.jsx)("option",{value:"",children:n("common.pleaseSelect")}),i.map((e=>(0,D.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,D.jsx)("div",{className:"mt-6 flex justify-end",children:(0,D.jsx)("button",{onClick:async()=>{h(!0);try{const e=e=>null===e||void 0===e||0===e?null:Number(e);await v.A.put(j.Sn.ORGANIZATION_LIFECYCLE.LIFECYCLE_ROLES,{adminRoleId:e(d.adminRoleId),hrRoleId:e(d.hrRoleId),legalRoleId:e(d.legalRoleId),employeeRoleIds:(d.employeeRoleIds||[]).map(e).filter((e=>null!==e))}),l(n("lifecycle.rolesSaved",{defaultValue:"Rollen-Konfiguration erfolgreich gespeichert"}),"success"),r&&r()}catch(a){var e,t;console.error("Fehler beim Speichern:",a),l((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n("lifecycle.saveError",{defaultValue:"Fehler beim Speichern"}),"error")}finally{h(!1)}},disabled:b||y,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:b?n("common.saving",{defaultValue:"Speichere..."}):n("common.save",{defaultValue:"Speichern"}),children:b?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})})]})})},Ae=e=>{let{organization:t,onUpload:r}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[g,x]=(0,a.useState)("certificate"),[b,h]=(0,a.useState)(""),[y,p]=(0,a.useState)(""),[k,N]=(0,a.useState)("400"),[w,A]=(0,a.useState)("100"),[S,C]=(0,a.useState)("1"),z=a.useRef(null);(0,a.useEffect)((()=>{t&&E()}),[t]);const E=async()=>{c(!0);try{const e=(await v.A.get(j.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_SIGNATURES)).data.documentSignatures||{},t=[];e.employmentCertificate&&t.push({type:"certificate",signerName:e.employmentCertificate.signerName,signerPosition:e.employmentCertificate.signerPosition,path:e.employmentCertificate.path,position:e.employmentCertificate.position}),e.employmentContract&&t.push({type:"contract",signerName:e.employmentContract.signerName,signerPosition:e.employmentContract.signerPosition,path:e.employmentContract.path,position:e.employmentContract.position}),o(t)}catch(a){var e,t,r;if(console.error("Fehler beim Laden der Signaturen:",a),404!==(null===(e=a.response)||void 0===e?void 0:e.status))l((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||n("lifecycle.loadSignaturesError",{defaultValue:"Fehler beim Laden der Signaturen"}),"error");o([])}finally{c(!1)}};return d?(0,D.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin text-gray-400"})}):(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-4",children:(0,D.jsxs)("div",{className:"space-y-3",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("lifecycle.signatureType",{defaultValue:"Signatur-Typ"})}),(0,D.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,D.jsx)("option",{value:"certificate",children:n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"})}),(0,D.jsx)("option",{value:"contract",children:n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"})})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("lifecycle.signerName",{defaultValue:"Name des Unterzeichners"})," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"text",value:b,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:n("lifecycle.signerNamePlaceholder",{defaultValue:"z.B. Stefan Bossart"})})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("lifecycle.signerPosition",{defaultValue:"Position"})}),(0,D.jsx)("input",{type:"text",value:y,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:n("lifecycle.signerPositionPlaceholder",{defaultValue:"z.B. Gesch\xe4ftsf\xfchrer"})})]}),(0,D.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[(0,D.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:n("lifecycle.signaturePosition",{defaultValue:"Signatur-Position im PDF"})}),(0,D.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionX",{defaultValue:"X (horizontal)"})}),(0,D.jsx)("input",{type:"number",value:k,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"400",min:"0"}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionXHint",{defaultValue:"0 = links"})})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionY",{defaultValue:"Y (vertikal)"})}),(0,D.jsx)("input",{type:"number",value:w,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"100",min:"0"}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionYHint",{defaultValue:"0 = unten"})})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.positionPage",{defaultValue:"Seite"})}),(0,D.jsx)("input",{type:"number",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",placeholder:"1",min:"1"}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("lifecycle.positionPageHint",{defaultValue:"Seitennummer"})})]})]}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:n("lifecycle.signaturePositionHint",{defaultValue:"Koordinaten in PDF-Punkten (1 Punkt = 1/72 Zoll). A4: 595 x 842 Punkte. Standard: X=400, Y=100, Seite=1"})})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("lifecycle.signatureFile",{defaultValue:"Signatur-Datei"})," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[(0,D.jsx)("input",{ref:z,type:"file",accept:"image/jpeg,image/png,image/gif,application/pdf",onChange:async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(["image/jpeg","image/png","image/gif","application/pdf"].includes(a.type))if(b.trim()){u(!0);try{const e=new FormData;e.append("file",a),e.append("type","certificate"===g?"employmentCertificate":"employmentContract"),e.append("signerName",b),y&&e.append("signerPosition",y),e.append("positionX",k||"400"),e.append("positionY",w||"100"),e.append("page",S||"1");const t=await v.A.post(j.Sn.ORGANIZATION_LIFECYCLE.UPLOAD_SIGNATURE,e,{headers:{"Content-Type":"multipart/form-data"}});l(t.data.message||n("lifecycle.signatureUploaded",{defaultValue:"Signatur erfolgreich hochgeladen"}),"success"),h(""),p(""),N("400"),A("100"),C("1"),E(),r()}catch(o){var s,i;console.error("Fehler beim Hochladen:",o),l((null===(s=o.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||n("lifecycle.uploadError",{defaultValue:"Fehler beim Hochladen"}),"error")}finally{u(!1),z.current&&(z.current.value="")}}else l(n("lifecycle.signerNameRequired",{defaultValue:"Name des Unterzeichners ist erforderlich"}),"error");else l(n("lifecycle.onlyImageOrPdfAllowed",{defaultValue:"Nur Bilder (JPEG, PNG, GIF) oder PDF-Dateien sind erlaubt"}),"error")},className:"hidden"}),(0,D.jsx)("button",{onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},disabled:m||!b.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?(0,D.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,D.jsx)(R.A,{className:"h-4 w-4 animate-spin"}),(0,D.jsx)("span",{children:n("common.uploading",{defaultValue:"Lade hoch..."})})]}):n("lifecycle.selectSignatureFile",{defaultValue:"Datei ausw\xe4hlen"})}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:n("lifecycle.signatureFileHint",{defaultValue:"JPEG, PNG, GIF oder PDF (max. 5MB)"})})]})]})]})}),i.length>0&&(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("lifecycle.uploadedSignatures",{defaultValue:"Hochgeladene Signaturen"})}),i.map((e=>(0,D.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"font-medium dark:text-white",children:"certificate"===e.type?n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"}):n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"})}),(0,D.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.signerName,e.signerPosition&&" - ".concat(e.signerPosition)]}),e.position&&(0,D.jsxs)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[n("lifecycle.position",{defaultValue:"Position"}),": X=",e.position.x,", Y=",e.position.y,", ",n("lifecycle.page",{defaultValue:"Seite"})," ",e.position.page]})]}),(0,D.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(n("lifecycle.deleteSignatureConfirm",{defaultValue:"Signatur wirklich l\xf6schen?"})))try{const t=(await v.A.get(j.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};if(t.documentSignatures){const r="certificate"===e?"employmentCertificate":"employmentContract";delete t.documentSignatures[r],await v.A.put(j.Sn.ORGANIZATIONS.CURRENT,{settings:t})}l(n("lifecycle.signatureDeleted",{defaultValue:"Signatur erfolgreich gel\xf6scht"}),"success"),E()}catch(a){var t,r;console.error("Fehler beim L\xf6schen:",a),l((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||n("lifecycle.deleteError",{defaultValue:"Fehler beim L\xf6schen"}),"error")}})(e.type),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-md",title:n("common.delete",{defaultValue:"L\xf6schen"}),children:(0,D.jsx)(J.A,{className:"h-5 w-5"})})]},e.type)))]})]})},Se=e=>{let{organization:t,onSave:r}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,a.useState)("certificate"),[d,m]=(0,a.useState)({}),[u,g]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1),h=["userName","organizationName","currentDate","identificationNumber","startDate","endDate"],y=["userName","organizationName","currentDate","identificationNumber","startDate","endDate","position","salary","workingHours"];(0,a.useEffect)((()=>{t&&k()}),[t,i]);const k=async()=>{try{var e;const r=null===t||void 0===t?void 0:t.settings,a=null===r||void 0===r||null===(e=r.documentTemplates)||void 0===e?void 0:e["certificate"===i?"employmentCertificate":"employmentContract"],s=(null===a||void 0===a?void 0:a.fields)||{},n=50,l=20;let o=841.89-n-30;const d={},c="certificate"===i?h:y,u={userName:{x:n,y:o,fontSize:14},organizationName:{x:n,y:o-l,fontSize:12},currentDate:{x:n,y:o-2*l,fontSize:12},identificationNumber:{x:n,y:o-3*l,fontSize:12},startDate:{x:n,y:o-4*l,fontSize:12},endDate:{x:n,y:o-5*l,fontSize:12}};"contract"===i&&(u.position={x:n,y:o-6*l,fontSize:12},u.salary={x:n,y:o-7*l,fontSize:12},u.workingHours={x:n,y:o-8*l,fontSize:12}),c.forEach((e=>{d[e]=s[e]||u[e]||{x:n,y:o,fontSize:"userName"===e?14:12}})),m(d)}catch(r){console.error("Fehler beim Laden der Felder:",r)}},N=(e,t,r)=>{m((a=>(0,c.A)((0,c.A)({},a),{},{[e]:(0,c.A)((0,c.A)({},a[e]),{},{[t]:"fontSize"===t?parseFloat(r)||12:parseFloat(r)||0})})))},w="certificate"===i?h:y,A={userName:n("lifecycle.fieldUserName",{defaultValue:"Benutzername"}),organizationName:n("lifecycle.fieldOrganizationName",{defaultValue:"Organisationsname"}),currentDate:n("lifecycle.fieldCurrentDate",{defaultValue:"Aktuelles Datum"}),identificationNumber:n("lifecycle.fieldIdentificationNumber",{defaultValue:"Ausweisnummer"}),startDate:n("lifecycle.fieldStartDate",{defaultValue:"Startdatum"}),endDate:n("lifecycle.fieldEndDate",{defaultValue:"Enddatum"}),position:n("lifecycle.fieldPosition",{defaultValue:"Position"}),salary:n("lifecycle.fieldSalary",{defaultValue:"Gehalt"}),workingHours:n("lifecycle.fieldWorkingHours",{defaultValue:"Arbeitsstunden"})};return(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold dark:text-white",children:n("organization.fieldPositions",{defaultValue:"Feld-Positionen konfigurieren"})}),(0,D.jsx)("div",{className:"flex items-center space-x-2",children:(0,D.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",children:[(0,D.jsx)("option",{value:"certificate",children:n("lifecycle.certificate",{defaultValue:"Certificado Laboral"})}),(0,D.jsx)("option",{value:"contract",children:n("lifecycle.contract",{defaultValue:"Contrato de Trabajo"})})]})})]}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[(0,D.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium mb-1",children:n("lifecycle.fieldPositionsInfo",{defaultValue:"Konfigurieren Sie die Positionen der Felder im Template-PDF."})}),(0,D.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:n("lifecycle.fieldPositionsHint",{defaultValue:"Koordinaten in PDF-Punkten. A4: 595 x 842 Punkte. Y=0 ist unten, Y=842 ist oben. X=0 ist links, X=595 ist rechts."})})]}),(0,D.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:w.map((e=>{var t,r,a;return(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:[(0,D.jsx)("div",{className:"font-medium text-sm dark:text-white mb-2",children:A[e]||e}),(0,D.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"X"}),(0,D.jsx)("input",{type:"number",value:(null===(t=d[e])||void 0===t?void 0:t.x)||0,onChange:t=>N(e,"x",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"0"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Y"}),(0,D.jsx)("input",{type:"number",value:(null===(r=d[e])||void 0===r?void 0:r.y)||0,onChange:t=>N(e,"y",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"0"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:n("lifecycle.fontSize",{defaultValue:"Schriftgr\xf6\xdfe"})}),(0,D.jsx)("input",{type:"number",value:(null===(a=d[e])||void 0===a?void 0:a.fontSize)||12,onChange:t=>N(e,"fontSize",t.target.value),className:"w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",min:"8",max:"72"})]})]})]},e)}))}),(0,D.jsxs)("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[(0,D.jsx)("button",{onClick:async()=>{if(window.confirm(n("lifecycle.resetFieldPositionsConfirm",{defaultValue:"Positionen auf Standardwerte zur\xfccksetzen?"}))){const e=50,t=20;let r=841.89-e-30;const a={userName:{x:e,y:r,fontSize:14},organizationName:{x:e,y:r-t,fontSize:12},currentDate:{x:e,y:r-2*t,fontSize:12},identificationNumber:{x:e,y:r-3*t,fontSize:12},startDate:{x:e,y:r-4*t,fontSize:12},endDate:{x:e,y:r-5*t,fontSize:12}};"contract"===i&&(a.position={x:e,y:r-6*t,fontSize:12},a.salary={x:e,y:r-7*t,fontSize:12},a.workingHours={x:e,y:r-8*t,fontSize:12});const s={};("certificate"===i?h:y).forEach((t=>{s[t]=a[t]||{x:e,y:r,fontSize:"userName"===t?14:12}})),m(s)}},className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white",title:n("common.reset",{defaultValue:"Zur\xfccksetzen"}),children:(0,D.jsx)(R.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{onClick:async()=>{b(!0);try{const e=(await v.A.get(j.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};e.documentTemplates||(e.documentTemplates={});const t="certificate"===i?"employmentCertificate":"employmentContract";e.documentTemplates[t]||(e.documentTemplates[t]={}),e.documentTemplates[t].fields=d,await fe.h.updateOrganization({settings:e}),l(n("lifecycle.fieldPositionsSaved",{defaultValue:"Feld-Positionen erfolgreich gespeichert"}),"success"),r&&r()}catch(a){var e,t;console.error("Fehler beim Speichern:",a),l((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||n("lifecycle.saveError",{defaultValue:"Fehler beim Speichern"}),"error")}finally{b(!1)}},disabled:x,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-700 dark:hover:bg-blue-800",title:x?n("common.saving",{defaultValue:"Speichern..."}):n("common.save",{defaultValue:"Speichern"}),children:x?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})},Ce=e=>{let{organization:t,onSave:r}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[x,h]=(0,a.useState)(!1),[y,p]=(0,a.useState)("certificate"),k=a.useRef(null);(0,a.useEffect)((()=>{t&&N()}),[t]);const N=async()=>{c(!0);try{const e=(await v.A.get(j.Sn.ORGANIZATION_LIFECYCLE.DOCUMENT_TEMPLATES)).data.documentTemplates||{},t=[];e.employmentCertificate&&t.push({name:"Arbeitszeugnis",type:"certificate",filePath:e.employmentCertificate.path,version:e.employmentCertificate.version}),e.employmentContract&&t.push({name:"Arbeitsvertrag",type:"contract",filePath:e.employmentContract.path,version:e.employmentContract.version}),o(t)}catch(a){var e,t,r;if(console.error("Fehler beim Laden der Templates:",a),404!==(null===(e=a.response)||void 0===e?void 0:e.status))l((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||n("lifecycle.loadTemplatesError",{defaultValue:"Fehler beim Laden der Templates"}),"error");o([])}finally{c(!1)}};return d?(0,D.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,D.jsx)(R.A,{className:"h-6 w-6 animate-spin text-gray-400"})}):(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,D.jsx)(b.A,{className:"h-5 w-5 mr-2"}),n("organization.documentTemplates",{defaultValue:"Dokumenten-Templates"})]}),(0,D.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,D.jsxs)("select",{value:y,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm",children:[(0,D.jsx)("option",{value:"certificate",children:"Arbeitszeugnis"}),(0,D.jsx)("option",{value:"contract",children:"Arbeitsvertrag"})]}),(0,D.jsx)("button",{onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},disabled:x,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:x?n("common.uploading",{defaultValue:"Lade hoch..."}):n("lifecycle.uploadTemplate",{defaultValue:"Template hochladen"}),children:x?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(g.A,{className:"h-5 w-5"})})]}),(0,D.jsx)("input",{ref:k,type:"file",accept:".pdf",onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r)if("application/pdf"===r.type){h(!0);try{const e=new FormData;e.append("file",r),e.append("type","certificate"===y?"employmentCertificate":"employmentContract");const t=await v.A.post(j.Sn.ORGANIZATION_LIFECYCLE.UPLOAD_TEMPLATE,e,{headers:{"Content-Type":"multipart/form-data"}});l(t.data.message||n("lifecycle.templateUploaded",{defaultValue:"Template erfolgreich hochgeladen"}),"success"),N()}catch(i){var a,s;console.error("Fehler beim Hochladen:",i),l((null===(a=i.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||n("lifecycle.uploadError",{defaultValue:"Fehler beim Hochladen"}),"error")}finally{h(!1),k.current&&(k.current.value="")}}else l(n("lifecycle.onlyPdfAllowed",{defaultValue:"Nur PDF-Dateien sind erlaubt"}),"error")},className:"hidden"})]}),0===i.length?(0,D.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,D.jsx)(b.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,D.jsx)("p",{children:n("lifecycle.noTemplates",{defaultValue:"Keine Templates vorhanden"})}),(0,D.jsx)("p",{className:"text-sm mt-2",children:n("lifecycle.uploadFirstTemplate",{defaultValue:"Laden Sie Ihr erstes Template hoch"})})]}):(0,D.jsx)("div",{className:"space-y-2",children:i.map((e=>(0,D.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"font-medium dark:text-white",children:e.name}),(0,D.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["certificate"===e.type?n("lifecycle.certificate",{defaultValue:"Arbeitszeugnis"}):n("lifecycle.contract",{defaultValue:"Arbeitsvertrag"}),e.version&&" - Version ".concat(e.version)]}),e.filePath&&(0,D.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:e.filePath})]}),(0,D.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(n("lifecycle.deleteTemplateConfirm",{defaultValue:"Template wirklich l\xf6schen?"})))try{const t=(await v.A.get(j.Sn.ORGANIZATIONS.CURRENT)).data.settings||{};if(t.documentTemplates){const r="certificate"===e?"employmentCertificate":"employmentContract";delete t.documentTemplates[r],await v.A.put(j.Sn.ORGANIZATIONS.CURRENT,{settings:t})}l(n("lifecycle.templateDeleted",{defaultValue:"Template erfolgreich gel\xf6scht"}),"success"),N()}catch(a){var t,r;console.error("Fehler beim L\xf6schen:",a),l((null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||n("lifecycle.deleteError",{defaultValue:"Fehler beim L\xf6schen"}),"error")}})(e.type),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-md",title:n("common.delete",{defaultValue:"L\xf6schen"}),children:(0,D.jsx)(J.A,{className:"h-5 w-5"})})]},e.type)))})]}),(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,D.jsxs)("h3",{className:"text-lg font-semibold flex items-center dark:text-white",children:[(0,D.jsx)(b.A,{className:"h-5 w-5 mr-2"}),n("organization.documentSignatures",{defaultValue:"Dokumenten-Signaturen"})]})}),(0,D.jsx)(Ae,{organization:t,onUpload:N})]}),(0,D.jsx)(Se,{organization:t,onSave:r})]})},ze=e=>{let{organization:t,onSave:r}=e;const{t:n}=(0,s.Bd)(),{showMessage:l}=(0,f.A)(),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)({smtpHost:"",smtpPort:"587",smtpUser:"",smtpPass:"",smtpFromEmail:"",smtpFromName:""}),[u,g]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(null!==t&&void 0!==t&&t.settings){var e;const r=t.settings;m({smtpHost:r.smtpHost||"",smtpPort:(null===(e=r.smtpPort)||void 0===e?void 0:e.toString())||"587",smtpUser:r.smtpUser||"",smtpPass:r.smtpPass||"",smtpFromEmail:r.smtpFromEmail||(null!==t&&void 0!==t&&t.domain?"noreply@".concat(t.domain):""),smtpFromName:r.smtpFromName||(null===t||void 0===t?void 0:t.displayName)||""})}}),[t]);const x=e=>{const{name:t,value:r}=e.target;m((e=>(0,c.A)((0,c.A)({},e),{},{[t]:r})))};return(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,D.jsx)(ye.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),(0,D.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("organization.smtp.title")})]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:n("organization.smtp.description")}),(0,D.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d.smtpHost&&d.smtpUser&&d.smtpPass)try{o(!0);const e=(0,c.A)((0,c.A)({},(null===t||void 0===t?void 0:t.settings)||{}),{},{smtpHost:d.smtpHost,smtpPort:parseInt(d.smtpPort)||587,smtpUser:d.smtpUser,smtpPass:d.smtpPass,smtpFromEmail:d.smtpFromEmail,smtpFromName:d.smtpFromName});await fe.h.updateOrganization({settings:e}),l(n("organization.smtp.saveSuccess"),"success"),r&&r()}catch(i){var a,s;const e=(null===(a=i.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||n("organization.smtp.saveError");l(e,"error")}finally{o(!1)}else l(n("organization.smtp.requiredFields"),"error")},className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"smtpHost",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.host")," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"text",id:"smtpHost",name:"smtpHost",value:d.smtpHost,onChange:x,placeholder:"smtp.example.com",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.hostHint")})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"smtpPort",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.port")," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"number",id:"smtpPort",name:"smtpPort",value:d.smtpPort,onChange:x,placeholder:"587",required:!0,min:"1",max:"65535",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.portHint")})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"smtpUser",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.user")," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsx)("input",{type:"text",id:"smtpUser",name:"smtpUser",value:d.smtpUser,onChange:x,placeholder:"noreply@example.com",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.userHint")})]}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:"smtpPass",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("organization.smtp.password")," ",(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)("input",{type:u?"text":"password",id:"smtpPass",name:"smtpPass",value:d.smtpPass,onChange:x,placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,D.jsx)("button",{type:"button",onClick:()=>g(!u),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:u?(0,D.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,D.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.passwordHint")})]}),(0,D.jsxs)("div",{className:"border-t pt-4",children:[(0,D.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:n("organization.smtp.fromSettings")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"smtpFromEmail",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.smtp.fromEmail")}),(0,D.jsx)("input",{type:"email",id:"smtpFromEmail",name:"smtpFromEmail",value:d.smtpFromEmail,onChange:x,placeholder:"noreply@example.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.fromEmailHint")})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"smtpFromName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("organization.smtp.fromName")}),(0,D.jsx)("input",{type:"text",id:"smtpFromName",name:"smtpFromName",value:d.smtpFromName,onChange:x,placeholder:(null===t||void 0===t?void 0:t.displayName)||"Intranet",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n("organization.smtp.fromNameHint")})]})]})]}),(0,D.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4",children:[(0,D.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:(0,D.jsx)("strong",{children:n("organization.smtp.infoTitle")})}),(0,D.jsxs)("ul",{className:"mt-2 text-sm text-blue-700 dark:text-blue-300 list-disc list-inside space-y-1",children:[(0,D.jsx)("li",{children:n("organization.smtp.info1")}),(0,D.jsx)("li",{children:n("organization.smtp.info2")}),(0,D.jsx)("li",{children:n("organization.smtp.info3")})]})]}),(0,D.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,D.jsx)("button",{type:"button",onClick:()=>{m({smtpHost:"",smtpPort:"587",smtpUser:"",smtpPass:"",smtpFromEmail:null!==t&&void 0!==t&&t.domain?"noreply@".concat(t.domain):"",smtpFromName:(null===t||void 0===t?void 0:t.displayName)||""})},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",title:n("organization.smtp.clear"),children:(0,D.jsx)(R.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:i,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:n(i?"organization.saving":"common.save"),children:i?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})};var Re=r(6693);const Ee={lobbyPms:["app.lobbypms.com"],ttlock:["open.ttlock.com","euopen.ttlock.com","api.sciener.com"],sire:["api.sire.gov.co"],boldPayment:["api.bold.co","sandbox.bold.co"]},Le=(e,t)=>{if(!e||"string"!==typeof e)return!1;try{const r=new URL(e);return Ee[t].some((e=>r.hostname===e||!!r.hostname.endsWith(".".concat(e))))}catch(r){return!1}},De=e=>{let{organization:t,onSave:r}=e;const{t:l}=(0,s.Bd)(),{showMessage:i}=(0,f.A)(),{canManageOrganization:o,loading:d}=(0,n.S)(),[m,u]=(0,a.useState)(!1),[g,x]=(0,a.useState)({lobbyPmsApiKey:"",lobbyPmsPropertyId:"",lobbyPmsSyncEnabled:!1,lobbyPmsAutoCreateTasks:!1,lobbyPmsLateCheckInThreshold:"22:00",ttlockClientId:"",ttlockClientSecret:"",ttlockApiUrl:"https://open.ttlock.com",ttlockUsername:"",ttlockPassword:"",ttlockPasscodeType:"auto",sireApiUrl:"",sireApiKey:"",sireApiSecret:"",sireEnabled:!1,sireAutoRegisterOnCheckIn:!1,sirePropertyCode:"",boldPaymentApiKey:"",boldPaymentMerchantId:"",boldPaymentEnvironment:"sandbox",whatsappProvider:"twilio",whatsappApiKey:"",whatsappApiSecret:"",whatsappPhoneNumberId:""}),[b,h]=(0,a.useState)({});(0,a.useEffect)((()=>{if(null!==t&&void 0!==t&&t.settings){const e=t.settings,r=e.lobbyPms||{},a=e.doorSystem||{},s=e.sire||{},n=e.boldPayment||{},l=e.whatsapp||{};x({lobbyPmsApiKey:r.apiKey||"",lobbyPmsPropertyId:r.propertyId||"",lobbyPmsSyncEnabled:r.syncEnabled||!1,lobbyPmsAutoCreateTasks:r.autoCreateTasks||!1,lobbyPmsLateCheckInThreshold:r.lateCheckInThreshold||"22:00",ttlockClientId:a.clientId||"",ttlockClientSecret:a.clientSecret||"",ttlockApiUrl:a.apiUrl||"https://open.ttlock.com",ttlockUsername:a.username||"",ttlockPassword:"",ttlockPasscodeType:a.passcodeType||"auto",sireApiUrl:s.apiUrl||"",sireApiKey:s.apiKey||"",sireApiSecret:s.apiSecret||"",sireEnabled:s.enabled||!1,sireAutoRegisterOnCheckIn:s.autoRegisterOnCheckIn||!1,sirePropertyCode:s.propertyCode||"",boldPaymentApiKey:n.apiKey||"",boldPaymentMerchantId:n.merchantId||"",boldPaymentEnvironment:n.environment||"sandbox",whatsappProvider:l.provider||"twilio",whatsappApiKey:l.apiKey||"",whatsappApiSecret:l.apiSecret||"",whatsappPhoneNumberId:l.phoneNumberId||""})}}),[t]);const y=e=>{const{name:t,value:r,type:a}=e.target,s=e.target.checked;x((e=>(0,c.A)((0,c.A)({},e),{},{[t]:"checkbox"===a?s:r})))},k=e=>{let{name:t,value:r,onChange:a,placeholder:s,label:n,required:l=!1}=e;const i=b[t]||!1;return(0,D.jsxs)("div",{children:[(0,D.jsxs)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n," ",l&&(0,D.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)("input",{type:i?"text":"password",id:t,name:t,value:r,onChange:a,placeholder:s||"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:l,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 pr-10"}),(0,D.jsx)("button",{type:"button",onClick:()=>{return e=t,void h((t=>(0,c.A)((0,c.A)({},t),{},{[e]:!t[e]})));var e},className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:i?(0,D.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L3 3m3.29 3.29L12 12m-5.71-5.71L12 12"})}):(0,D.jsxs)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,D.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]})};return d?(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)(R.A,{className:"h-6 w-6 animate-spin text-gray-400"}),(0,D.jsx)("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:l("common.loadingPermissions")})]}):o()?(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,D.jsx)(Re.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),(0,D.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("organization.api.title")})]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:l("organization.api.description")}),(0,D.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!g.lobbyPmsSyncEnabled||g.lobbyPmsApiKey)if(!g.ttlockApiUrl||Le(g.ttlockApiUrl,"ttlock"))if(!g.sireApiUrl||Le(g.sireApiUrl,"sire"))if(!g.lobbyPmsLateCheckInThreshold||/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/.test(g.lobbyPmsLateCheckInThreshold))try{u(!0);const e=(null===t||void 0===t?void 0:t.settings)||{},a=(0,c.A)((0,c.A)({},e),{},{lobbyPms:(0,c.A)((0,c.A)({},e.lobbyPms),{},{apiUrl:"https://app.lobbypms.com/api",apiKey:g.lobbyPmsApiKey||void 0,propertyId:g.lobbyPmsPropertyId||void 0,syncEnabled:g.lobbyPmsSyncEnabled,autoCreateTasks:g.lobbyPmsAutoCreateTasks,lateCheckInThreshold:g.lobbyPmsLateCheckInThreshold||void 0}),doorSystem:(0,c.A)((0,c.A)({},e.doorSystem),{},{provider:"ttlock",apiUrl:g.ttlockApiUrl||void 0,clientId:g.ttlockClientId||void 0,clientSecret:g.ttlockClientSecret||void 0,username:g.ttlockUsername||void 0,password:g.ttlockPassword||void 0,passcodeType:g.ttlockPasscodeType||"auto"}),sire:(0,c.A)((0,c.A)({},e.sire),{},{apiUrl:g.sireApiUrl||void 0,apiKey:g.sireApiKey||void 0,apiSecret:g.sireApiSecret||void 0,enabled:g.sireEnabled,autoRegisterOnCheckIn:g.sireAutoRegisterOnCheckIn,propertyCode:g.sirePropertyCode||void 0}),boldPayment:(0,c.A)((0,c.A)({},e.boldPayment),{},{apiKey:g.boldPaymentApiKey||void 0,merchantId:g.boldPaymentMerchantId||void 0,environment:g.boldPaymentEnvironment}),whatsapp:(0,c.A)((0,c.A)({},e.whatsapp),{},{provider:g.whatsappProvider,apiKey:g.whatsappApiKey||void 0,apiSecret:g.whatsappApiSecret||void 0,phoneNumberId:g.whatsappPhoneNumberId||void 0})});await fe.h.updateOrganization({settings:a}),i(l("organization.api.saveSuccess"),"success"),r&&r()}catch(s){var a;console.error("Error saving API settings:",s);let e=l("organization.api.saveError");if(null!==(a=s.response)&&void 0!==a&&a.data){const t=s.response.data;if(t.message&&(e=t.message),t.errors&&Array.isArray(t.errors)){const r=t.errors.map((e=>{var t;return"".concat((null===(t=e.path)||void 0===t?void 0:t.join("."))||"",": ").concat(e.message||"")})).filter((e=>e)).join(", ");r&&(e+=" (".concat(r,")")),t.errors.length>0&&"string"===typeof t.errors[0]&&(e=t.errors.join(", "))}}else s.message&&(e=s.message);i(e,"error")}finally{u(!1)}else i(l("organization.api.validation.invalidTimeFormat"),"error");else i(l("organization.api.validation.invalidUrl"),"error");else i(l("organization.api.validation.invalidUrl"),"error");else i(l("organization.api.validation.apiKeyRequired"),"error")},className:"space-y-6",children:[(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,D.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.lobbyPms.title")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)(k,{name:"lobbyPmsApiKey",value:g.lobbyPmsApiKey,onChange:y,label:l("organization.api.lobbyPms.apiKey"),placeholder:"API Token"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"lobbyPmsPropertyId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.lobbyPms.propertyId")}),(0,D.jsx)("input",{type:"text",id:"lobbyPmsPropertyId",name:"lobbyPmsPropertyId",value:g.lobbyPmsPropertyId,onChange:y,placeholder:"Property ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"checkbox",name:"lobbyPmsSyncEnabled",checked:g.lobbyPmsSyncEnabled,onChange:y,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.lobbyPms.syncEnabled")})]}),(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"checkbox",name:"lobbyPmsAutoCreateTasks",checked:g.lobbyPmsAutoCreateTasks,onChange:y,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.lobbyPms.autoCreateTasks")})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"lobbyPmsLateCheckInThreshold",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.lobbyPms.lateCheckInThreshold")}),(0,D.jsx)("input",{type:"time",id:"lobbyPmsLateCheckInThreshold",name:"lobbyPmsLateCheckInThreshold",value:g.lobbyPmsLateCheckInThreshold,onChange:y,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,D.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.ttlock.title")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"ttlockApiUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.apiUrl")}),(0,D.jsx)("input",{type:"text",id:"ttlockApiUrl",name:"ttlockApiUrl",value:g.ttlockApiUrl,onChange:y,placeholder:"https://open.ttlock.com",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"ttlockClientId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.clientId")}),(0,D.jsx)("input",{type:"text",id:"ttlockClientId",name:"ttlockClientId",value:g.ttlockClientId,onChange:y,placeholder:"Client ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsx)(k,{name:"ttlockClientSecret",value:g.ttlockClientSecret,onChange:y,label:l("organization.api.ttlock.clientSecret"),placeholder:"Client Secret"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"ttlockUsername",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.username")}),(0,D.jsx)("input",{type:"text",id:"ttlockUsername",name:"ttlockUsername",value:g.ttlockUsername,onChange:y,placeholder:"TTLock App Username (z.B. +573024498991)",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("organization.api.ttlock.usernameHint")})]}),(0,D.jsx)(k,{name:"ttlockPassword",value:g.ttlockPassword,onChange:y,label:l("organization.api.ttlock.password"),placeholder:"TTLock App Password"}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2",children:l("organization.api.ttlock.passwordHint")}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"ttlockPasscodeType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.ttlock.passcodeType")}),(0,D.jsxs)("select",{id:"ttlockPasscodeType",name:"ttlockPasscodeType",value:g.ttlockPasscodeType,onChange:y,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,D.jsx)("option",{value:"auto",children:l("organization.api.ttlock.passcodeTypeAuto")}),(0,D.jsx)("option",{value:"custom",children:l("organization.api.ttlock.passcodeTypeCustom")})]}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("organization.api.ttlock.passcodeTypeHint")})]})]})]}),(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,D.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.sire.title")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"sireApiUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.sire.apiUrl")}),(0,D.jsx)("input",{type:"text",id:"sireApiUrl",name:"sireApiUrl",value:g.sireApiUrl,onChange:y,placeholder:"https://api.sire.gov.co",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsx)(k,{name:"sireApiKey",value:g.sireApiKey,onChange:y,label:l("organization.api.sire.apiKey"),placeholder:"API Key"}),(0,D.jsx)(k,{name:"sireApiSecret",value:g.sireApiSecret,onChange:y,label:l("organization.api.sire.apiSecret"),placeholder:"API Secret"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"sirePropertyCode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.sire.propertyCode")}),(0,D.jsx)("input",{type:"text",id:"sirePropertyCode",name:"sirePropertyCode",value:g.sirePropertyCode,onChange:y,placeholder:"Property Code",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"checkbox",name:"sireEnabled",checked:g.sireEnabled,onChange:y,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.sire.enabled")})]}),(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"checkbox",name:"sireAutoRegisterOnCheckIn",checked:g.sireAutoRegisterOnCheckIn,onChange:y,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:l("organization.api.sire.autoRegisterOnCheckIn")})]})]})]})]}),(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,D.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.boldPayment.title")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)(k,{name:"boldPaymentApiKey",value:g.boldPaymentApiKey,onChange:y,label:l("organization.api.boldPayment.apiKey"),placeholder:"API Key"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"boldPaymentMerchantId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.boldPayment.merchantId")}),(0,D.jsx)("input",{type:"text",id:"boldPaymentMerchantId",name:"boldPaymentMerchantId",value:g.boldPaymentMerchantId,onChange:y,placeholder:"Merchant ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"boldPaymentEnvironment",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.boldPayment.environment")}),(0,D.jsxs)("select",{id:"boldPaymentEnvironment",name:"boldPaymentEnvironment",value:g.boldPaymentEnvironment,onChange:y,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,D.jsx)("option",{value:"sandbox",children:l("organization.api.boldPayment.sandbox")}),(0,D.jsx)("option",{value:"production",children:l("organization.api.boldPayment.production")})]})]})]})]}),(0,D.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,D.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:l("organization.api.whatsapp.title")}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"whatsappProvider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.whatsapp.provider")}),(0,D.jsxs)("select",{id:"whatsappProvider",name:"whatsappProvider",value:g.whatsappProvider,onChange:y,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,D.jsx)("option",{value:"twilio",children:l("organization.api.whatsapp.providerTwilio")}),(0,D.jsx)("option",{value:"whatsapp-business-api",children:l("organization.api.whatsapp.providerBusinessApi")})]})]}),(0,D.jsx)(k,{name:"whatsappApiKey",value:g.whatsappApiKey,onChange:y,label:l("organization.api.whatsapp.apiKey"),placeholder:"API Key / Access Token"}),(0,D.jsx)(k,{name:"whatsappApiSecret",value:g.whatsappApiSecret,onChange:y,label:l("organization.api.whatsapp.apiSecret"),placeholder:"API Secret (optional)"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"whatsappPhoneNumberId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("organization.api.whatsapp.phoneNumberId")}),(0,D.jsx)("input",{type:"text",id:"whatsappPhoneNumberId",name:"whatsappPhoneNumberId",value:g.whatsappPhoneNumberId,onChange:y,placeholder:"Phone Number ID",className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]})]}),(0,D.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,D.jsx)("button",{type:"button",onClick:()=>{x({lobbyPmsApiKey:"",lobbyPmsPropertyId:"",lobbyPmsSyncEnabled:!1,lobbyPmsAutoCreateTasks:!1,lobbyPmsLateCheckInThreshold:"22:00",ttlockClientId:"",ttlockClientSecret:"",ttlockApiUrl:"https://open.ttlock.com",ttlockUsername:"",ttlockPassword:"",ttlockPasscodeType:"auto",sireApiUrl:"",sireApiKey:"",sireApiSecret:"",sireEnabled:!1,sireAutoRegisterOnCheckIn:!1,sirePropertyCode:"",boldPaymentApiKey:"",boldPaymentMerchantId:"",boldPaymentEnvironment:"sandbox",whatsappProvider:"twilio",whatsappApiKey:"",whatsappApiSecret:"",whatsappPhoneNumberId:""})},className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",title:l("organization.api.clear"),children:(0,D.jsx)(R.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:m,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:l(m?"organization.saving":"common.save"),children:m?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]}):(0,D.jsx)("div",{className:"text-center py-8",children:(0,D.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:l("organization.api.noPermission")})})},Fe=e=>{let{isOpen:t,onClose:r,onSuccess:n,organization:l}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)({displayName:"",domain:"",logo:"",country:null,nit:null,settings:{}}),[u,g]=(0,a.useState)(""),[x,b]=(0,a.useState)(""),[h,k]=(0,a.useState)(!1),[v,j]=(0,a.useState)({}),[N,w]=(0,a.useState)(window.innerWidth<640),[A,S]=(0,a.useState)(window.innerWidth>1070),{openSidepane:C,closeSidepane:z}=(0,L.N)(),{showMessage:E}=(0,f.A)(),{organizationLanguage:F,setOrganizationLanguage:T}=(0,Ne.o)(),[I,P]=(0,a.useState)(""),[_,O]=(0,a.useState)(!1),[q,V]=(0,a.useState)("general"),U=[{code:"CO",name:i("countries.CO")},{code:"CH",name:i("countries.CH")},{code:"DE",name:i("countries.DE")},{code:"AT",name:i("countries.AT")}];(0,a.useEffect)((()=>{if(t&&l){const e=l.settings||{};d({displayName:l.displayName||"",domain:l.domain||"",logo:l.logo||"",country:l.country||null,nit:l.nit||null,settings:e}),g(l.country||""),b(l.nit||"");(async()=>{try{const e=await fe.h.getOrganizationLanguage();P(e.language||"")}catch(e){console.error(i("organization.loadLanguageError"),e),P("")}})()}}),[t,l,i]),(0,a.useEffect)((()=>{const e=()=>{w(window.innerWidth<640),S(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?C():z(),()=>{z()})),[t,C,z]);const B=e=>{const{name:t,value:r}=e.target;"country"===t?(g(r),d((e=>(0,c.A)((0,c.A)({},e),{},{country:r||null}))),"CO"!==r&&(b(""),d((e=>(0,c.A)((0,c.A)({},e),{},{nit:null}))))):"nit"===t?(b(r),d((e=>(0,c.A)((0,c.A)({},e),{},{nit:r||null})))):d((e=>(0,c.A)((0,c.A)({},e),{},{[t]:r}))),v[t]&&j((e=>(0,c.A)((0,c.A)({},e),{},{[t]:""})))},M=async e=>{e.preventDefault();try{k(!0),j({}),await fe.h.updateOrganization(o),E(i("organization.updateSuccess"),"success"),r(),n&&n()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("organization.updateError");E(e,"error"),j({submit:e})}finally{k(!1)}},G=()=>{if(l){const e=l.settings||{};d({displayName:l.displayName||"",domain:l.domain||"",logo:l.logo||"",country:l.country||null,nit:l.nit||null,settings:e}),g(l.country||""),b(l.nit||"")}j({}),r()};return N?(0,D.jsxs)(m.lG,{open:t,onClose:G,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,D.jsx)("button",{onClick:G,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("form",{onSubmit:M,className:"p-4",children:[v.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:v.submit}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,D.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:o.displayName||"",onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(v.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.displayName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.displayName})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,D.jsx)("input",{type:"text",id:"domain",name:"domain",value:o.domain||"",onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logoUrl")}),(0,D.jsx)("input",{type:"text",id:"logo",name:"logo",value:o.logo||"",onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"border-t pt-4",children:[(0,D.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,D.jsxs)("select",{id:"country",name:"country",value:u,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,D.jsx)("option",{value:"",children:i("organization.selectCountry")}),U.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),(0,D.jsxs)("div",{className:"border-t pt-4",children:[(0,D.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,D.jsxs)("select",{id:"organizationLanguage",value:I||F||"",onChange:async e=>{const t=e.target.value;if(P(t),t&&t!==F){O(!0);try{await T(t),E(i("common.save"),"success")}catch(r){console.error(i("organization.saveLanguageError"),r),E(i("worktime.messages.orgLanguageError"),"error")}finally{O(!1)}}},disabled:_||h,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,D.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,D.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,D.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,D.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:G,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:h,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(h?"organization.saving":"common.save"),children:h?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!A&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:G,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("organization.edit.title")}),(0,D.jsx)("button",{onClick:G,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,D.jsxs)("nav",{className:"-mb-px flex space-x-4 px-4","aria-label":"Tabs",children:[(0,D.jsx)("button",{type:"button",onClick:()=>V("general"),className:"".concat("general"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.general")}),(0,D.jsx)("button",{type:"button",onClick:()=>V("roles"),className:"".concat("roles"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.roles")}),(0,D.jsx)("button",{type:"button",onClick:()=>V("documents"),className:"".concat("documents"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.documents")}),(0,D.jsx)("button",{type:"button",onClick:()=>V("smtp"),className:"".concat("smtp"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.smtp")}),"CO"===u&&(0,D.jsx)("button",{type:"button",onClick:()=>V("api"),className:"".concat("api"===q?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:i("organization.tabs.api")})]})}),(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[v.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:v.submit}),"general"===q&&(0,D.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.displayName")}),(0,D.jsx)("input",{type:"text",id:"displayName",name:"displayName",value:o.displayName||"",onChange:B,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(v.displayName?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.displayName&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.displayName})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"domain",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.domain")}),(0,D.jsx)("input",{type:"text",id:"domain",name:"domain",value:o.domain||"",onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.logoUrl")}),(0,D.jsx)("input",{type:"text",id:"logo",name:"logo",value:o.logo||"",onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"border-t pt-4",children:[(0,D.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.country")}),(0,D.jsxs)("select",{id:"country",name:"country",value:u,onChange:B,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2",children:[(0,D.jsx)("option",{value:"",children:i("organization.selectCountry")}),U.map((e=>(0,D.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),"CO"===u&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"nit",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.nit")}),(0,D.jsx)("input",{type:"text",id:"nit",name:"nit",value:x,onChange:B,placeholder:i("organization.nitDescription"),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"}),(0,D.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:i("organization.nitDescription")})]}),(0,D.jsxs)("div",{className:"border-t pt-4",children:[(0,D.jsx)("label",{htmlFor:"organizationLanguage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("organization.language")}),(0,D.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:i("organization.languageDescription")}),(0,D.jsxs)("select",{id:"organizationLanguage",value:I||F||"",onChange:async e=>{const t=e.target.value;if(P(t),t&&t!==F){O(!0);try{await T(t),E(i("common.save"),"success")}catch(r){console.error("Fehler beim Speichern der Organisation-Sprache:",r),E(i("worktime.messages.orgLanguageError"),"error")}finally{O(!1)}}},disabled:_||h,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed",children:[(0,D.jsxs)("option",{value:"",children:[i("settings.useOrganizationLanguage")," (",i("worktime.language.fallback"),": ",i("worktime.language.german"),")"]}),(0,D.jsx)("option",{value:"de",children:i("worktime.language.german")}),(0,D.jsx)("option",{value:"es",children:i("worktime.language.spanish")}),(0,D.jsx)("option",{value:"en",children:i("worktime.language.english")})]})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:G,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:h,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:i(h?"organization.saving":"common.save"),children:h?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):(0,D.jsx)(p.A,{className:"h-5 w-5"})})]})]}),"roles"===q&&(0,D.jsx)(we,{organization:l,onSave:()=>{n&&n()}}),"documents"===q&&(0,D.jsx)(Ce,{organization:l,onSave:()=>{n&&n()}}),"smtp"===q&&(0,D.jsx)(ze,{organization:l,onSave:()=>{n&&n()}}),"api"===q&&"CO"===u&&(0,D.jsx)(De,{organization:l,onSave:()=>{n&&n()}})]})]})]})},Te=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Ie=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},Pe="my-join-requests-table",_e=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)([]),[n,l]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)([]),[x,b]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),{showMessage:k}=(0,f.A)(),N=(0,a.useRef)(!0),[w,A]=(0,a.useState)(null),[S,C]=(0,a.useState)("Alle"),[z,E]=(0,a.useState)(null);(0,a.useEffect)((()=>()=>{N.current=!1}),[]),(0,a.useEffect)((()=>{console.log("MyJoinRequestsList: useEffect called - component mounted"),console.log("MyJoinRequestsList: Resetting state on mount to prevent data leaks"),r([]),o(null),l(!0);let t=!0;return(async()=>{if(!t)return void console.log("MyJoinRequestsList: Component unmounted, skipping fetch");console.log("MyJoinRequestsList: Starting fetch");const a=setTimeout((()=>{t&&(console.error("Request timeout after 10 seconds"),o("Anfrage dauert zu lange. Bitte Seite neu laden."),l(!1))}),1e4);try{console.log("MyJoinRequestsList: Setting loading to true"),l(!0),o(null),console.log("MyJoinRequestsList: Fetching my join requests from:",j.Sn.ORGANIZATIONS.MY_JOIN_REQUESTS);const e=await fe.h.getMyJoinRequests();if(console.log("MyJoinRequestsList: Received requests:",e),console.log("MyJoinRequestsList: Requests type:",typeof e),console.log("MyJoinRequestsList: Requests isArray:",Array.isArray(e)),console.log("MyJoinRequestsList: Requests length:",(null===e||void 0===e?void 0:e.length)||0),!Array.isArray(e))throw console.error("\u274c MyJoinRequestsList: Response is not an array!",e),new Error("Ung\xfcltige Antwort vom Server");clearTimeout(a),t?(console.log("MyJoinRequestsList: Setting joinRequests state"),r(e),console.log("MyJoinRequestsList: State updated with",e.length,"requests")):(console.log("MyJoinRequestsList: Component was unmounted, but setting state anyway"),r(e))}catch(c){var s,n,i,d;if(clearTimeout(a),!t)return void console.log("MyJoinRequestsList: Component unmounted during error, skipping error handling");console.error("MyJoinRequestsList: Error fetching my join requests:",c),console.error("MyJoinRequestsList: Error response:",c.response),console.error("MyJoinRequestsList: Error status:",null===(s=c.response)||void 0===s?void 0:s.status),console.error("MyJoinRequestsList: Error data:",null===(n=c.response)||void 0===n?void 0:n.data);const r=(null===(i=c.response)||void 0===i||null===(d=i.data)||void 0===d?void 0:d.message)||c.message||e("myJoinRequests.loadError");o(r),setTimeout((()=>{k(r,"error")}),0)}finally{t?(console.log("MyJoinRequestsList: Setting loading to false"),l(!1)):(console.log("MyJoinRequestsList: Component unmounted, but setting loading to false anyway"),l(!1))}})(),()=>{console.log("MyJoinRequestsList: useEffect cleanup - component unmounting"),t=!1,N.current=!1,r([]),o(null)}}),[]);const L=e=>new Date(e).toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=(e,t)=>{g(e),b(t)},T=()=>{g([]),b([]),C(""),E(null)},I=()=>u.length;(0,a.useEffect)((()=>{(async()=>{try{const e=await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(Pe)),t=e.data.find((e=>"Alle"===e.name));t&&(C("Alle"),E(t.id),F(t.conditions,t.operators))}catch(i){console.error("Fehler beim Setzen des initialen Filters:",i)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(Pe))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:Pe,name:"Alle",conditions:[],operators:[]};await v.A.post(j.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Meine Beitrittsanfragen erstellt")}}catch(i){console.error("Fehler beim Erstellen der Standard-Filter:",i)}})()}),[]);const P=(0,a.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var r;const a=(e.organization.displayName||e.organization.name||"").toLowerCase(),s=(null===(r=e.message)||void 0===r?void 0:r.toLowerCase())||"";return a.includes(t)||s.includes(t)}))}return u.length>0&&(e=u.reduce(((e,t,r)=>{if(!t.column||null===t.value||""===t.value)return e;const a=t.operator,s=t.value;return e.filter((e=>{var r;switch(t.column){case"organization":const t=(e.organization.displayName||e.organization.name||"").toLowerCase(),n=String(s).toLowerCase();return"contains"===a?t.includes(n):"equals"===a?t===n:"startsWith"===a&&t.startsWith(n);case"message":const l=(null===(r=e.message)||void 0===r?void 0:r.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===a?l.includes(i):"equals"===a?l===i:"startsWith"===a&&l.startsWith(i);case"status":return"equals"===a&&e.status===s;default:return!0}}))}),e)),e}),[t,h,u,x]);return(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("myJoinRequests.title")}),(0,D.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,D.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>p(e.target.value)}),(0,D.jsxs)("button",{className:"p-2 rounded-md border ".concat(I()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>m(!d),title:e("common.filter"),children:[(0,D.jsx)(Y.A,{className:"h-5 w-5"}),I()>0&&(0,D.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:I()})]})]})]}),d&&(0,D.jsx)("div",{className:"mb-4",children:(0,D.jsx)(Z.A,{columns:[{id:"organization",label:e("myJoinRequests.filter.organization",{defaultValue:"Organisation"})},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:F,onReset:T,savedConditions:u,savedOperators:x,tableId:Pe})}),(0,D.jsx)(X.A,{tableId:Pe,onSelectFilter:F,onReset:T,activeFilterName:S,selectedFilterId:z,onFilterChange:(e,t,r,a)=>{C(e),E(t),F(r,a)},defaultFilterName:"Alle"}),i&&(0,D.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:i}),n?(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,D.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("myJoinRequests.loading")})]}):0===t.length?(0,D.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e("myJoinRequests.noRequests")}):(0,D.jsx)("div",{className:"space-y-4",children:P.map((t=>(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsx)("div",{className:"flex items-start justify-between",children:(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,D.jsxs)("div",{children:[(0,D.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.organization.displayName||t.organization.name}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:L(t.createdAt)})]}),(0,D.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(Te(t.status)),children:Ie(t.status,e)})]}),t.message&&(0,D.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,D.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,D.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,D.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,D.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,D.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),t.processor&&(0,D.jsxs)("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e("myJoinRequests.processedBy"),": ",t.processor.firstName," ",t.processor.lastName,t.processedAt&&" - ".concat(L(t.processedAt))]}),"pending"===t.status&&(0,D.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,D.jsx)("button",{onClick:()=>(async t=>{if(window.confirm(e("myJoinRequests.confirmWithdraw")))try{A(t),await fe.h.withdrawJoinRequest(t),r((e=>e.map((e=>e.id===t?(0,c.A)((0,c.A)({},e),{},{status:"withdrawn",processedAt:(new Date).toISOString()}):e)))),k(e("myJoinRequests.withdrawSuccess"),"success")}catch(n){var a,s;const t=(null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||e("myJoinRequests.withdrawError");k(t,"error")}finally{A(null)}})(t.id),disabled:w===t.id,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md dark:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:w===t.id?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(R.A,{className:"h-4 w-4 mr-1 animate-spin"}),e("myJoinRequests.withdrawing")]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(y.A,{className:"h-4 w-4 mr-1"}),e("myJoinRequests.withdraw")]})})})]})})},t.id)))})]})},Oe=()=>{const[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[m,u]=(0,a.useState)(!1),[x,b]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),[k,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),{canViewOrganization:w,canManageOrganization:S,loading:C}=(0,n.S)(),{showMessage:z}=(0,f.A)(),{t:R}=(0,s.Bd)(),{refreshOrganization:E}=(0,ke.Z)(),L=(0,a.useCallback)((async()=>{try{c(!0),b(null);const e=await fe.h.getCurrentOrganization();t(e);try{u(!0);const e=await fe.h.getOrganizationStats();i(e)}catch(l){console.error("Fehler beim Laden der Statistiken:",l)}finally{u(!1)}}catch(o){var e,r,a;if(404===(null===(e=o.response)||void 0===e?void 0:e.status)&&!1===(null===(r=o.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.hasOrganization))b(R("organization.notFound")),t(null),z(R("organization.notFound"),"info");else{var s,n;const e=(null===(s=o.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||R("organization.loadError");b(e),z(e,"error")}}finally{c(!1)}}),[]),F=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(C)return;if(F.current)return;w()?(F.current=!0,L()):(b(R("organization.noPermission")),c(!1),F.current=!0)}),[C]);if(C)return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,D.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingPermissions")})]})});if(!w())return(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,D.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:R("organization.noPermission")})});return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)("div",{className:"flex items-center mb-4 sm:mb-4",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("button",{onClick:()=>p(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center",style:{width:"30.19px",height:"30.19px"},title:R("organization.createOrganization"),"aria-label":R("organization.createOrganization"),children:(0,D.jsx)(g.A,{className:"h-4 w-4"})}),(0,D.jsx)("button",{onClick:()=>v(!0),className:"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 border border-blue-200 dark:border-gray-700 shadow-sm flex items-center justify-center ml-2",style:{width:"30.19px",height:"30.19px"},title:R("organization.joinOrganization"),"aria-label":R("organization.joinOrganization"),children:(0,D.jsx)(he.A,{className:"h-4 w-4"})})]})}),d?(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,D.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:R("common.loadingOrganization")})]}):(0,D.jsxs)(D.Fragment,{children:[x&&(0,D.jsx)("div",{className:"mb-4 p-4 border rounded ".concat(e?"bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300":"bg-blue-50 dark:bg-blue-900/30 border-blue-400 dark:border-blue-700 text-blue-700 dark:text-blue-300"),children:(0,D.jsxs)("div",{className:"flex items-start",children:[(0,D.jsx)("div",{className:"flex-shrink-0",children:e?(0,D.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"\u26a0\ufe0f"}):(0,D.jsx)(l.A,{className:"h-5 w-5"})}),(0,D.jsxs)("div",{className:"ml-3 flex-1",children:[(0,D.jsx)("p",{className:"font-medium",children:x}),!e&&(0,D.jsx)("p",{className:"mt-2 text-sm",children:R("organization.createOrJoinHint")})]})]})}),e?(0,D.jsx)(D.Fragment,{children:(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsx)("div",{className:"flex items-start justify-between",children:(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[(0,D.jsx)(h.A,{className:"h-5 w-5 mr-2"}),e.displayName||e.name]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.domain||R("organization.noDomain")})]}),S()&&(0,D.jsx)("button",{onClick:()=>N(!0),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1",title:R("organization.edit.title"),children:(0,D.jsx)(A.A,{className:"h-5 w-5"})})]}),(0,D.jsx)("div",{className:"space-y-3",children:e.subscriptionPlan&&(0,D.jsxs)("div",{children:[(0,D.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[R("organization.subscriptionPlan"),":"]}),(0,D.jsx)("span",{className:"ml-2 text-sm text-gray-900 dark:text-white capitalize",children:e.subscriptionPlan})]})}),r&&(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:R("organization.statistics")}),m?(0,D.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),(0,D.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:R("common.loadingStatistics")})]}):(0,D.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("div",{className:"flex-shrink-0 bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3",children:(0,D.jsx)(l.A,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,D.jsxs)("div",{className:"ml-4",children:[(0,D.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.users")}),(0,D.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[r.currentUsers," / ",r.maxUsers]}),void 0!==r.utilizationPercent&&(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.utilizationPercent,"% ",R("organization.utilizationPercent")]})]})]})}),(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("div",{className:"flex-shrink-0 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3",children:(0,D.jsx)(o.A,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,D.jsxs)("div",{className:"ml-4",children:[(0,D.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.roles")}),(0,D.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.roles})]})]})}),(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("div",{className:"flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3",children:(0,D.jsx)(ye.A,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),(0,D.jsxs)("div",{className:"ml-4",children:[(0,D.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.joinRequests")}),(0,D.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.joinRequests})]})]})}),void 0!==r._count.invitations&&(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("div",{className:"flex-shrink-0 bg-green-100 dark:bg-green-900/30 rounded-lg p-3",children:(0,D.jsx)(ye.A,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,D.jsxs)("div",{className:"ml-4",children:[(0,D.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.invitations")}),(0,D.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r._count.invitations})]})]})}),void 0!==r.utilizationPercent&&(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsxs)("div",{className:"flex items-center",children:[(0,D.jsx)("div",{className:"flex-shrink-0 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-3",children:(0,D.jsx)(pe.A,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),(0,D.jsxs)("div",{className:"ml-4",children:[(0,D.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:R("organization.utilization")}),(0,D.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:[r.utilizationPercent,"%"]}),(0,D.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.availableSlots," ",R("organization.availableSlots")]})]})]})})]})]})})]})})})}):(0,D.jsxs)("div",{className:"text-center py-8",children:[(0,D.jsx)(l.A,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),(0,D.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:R("organization.notFound")}),(0,D.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:R("organization.createOrJoinHint")})]})]})]}),(0,D.jsx)(_e,{}),(0,D.jsx)(ve,{isOpen:y,onClose:()=>p(!1),onSuccess:()=>{L()}}),(0,D.jsx)(je,{isOpen:k,onClose:()=>v(!1),onSuccess:()=>{L()}}),(0,D.jsx)(Fe,{isOpen:j,onClose:()=>N(!1),onSuccess:()=>{L(),E()},organization:e})]})},qe=e=>{let{isOpen:t,onClose:r,joinRequest:n,onSuccess:l}=e;const{t:i}=(0,s.Bd)(),[o,d]=(0,a.useState)("approve"),[g,x]=(0,a.useState)(null),[b,h]=(0,a.useState)(""),[k,v]=(0,a.useState)([]),[j,N]=(0,a.useState)(!1),[w,A]=(0,a.useState)(!1),[S,C]=(0,a.useState)({}),[z,E]=(0,a.useState)(window.innerWidth<640),[F,T]=(0,a.useState)(window.innerWidth>1070),{openSidepane:I,closeSidepane:P}=(0,L.N)(),{showMessage:_}=(0,f.A)();(0,a.useEffect)((()=>{const e=()=>{E(window.innerWidth<640),T(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,a.useEffect)((()=>(t?I():P(),()=>{P()})),[t,I,P]),(0,a.useEffect)((()=>{t&&n&&(d("approve"),x(null),h(""),C({}),n.organizationId&&q())}),[t,n]);const q=async()=>{try{N(!0);const e=await u.Zj.getAll();e.data&&Array.isArray(e.data)&&v(e.data)}catch(e){console.error("Fehler beim Laden der Rollen:",e),_(i("joinRequest.loadRolesError"),"error")}finally{N(!1)}},V=async e=>{if(e.preventDefault(),(()=>{const e={};return"approve"!==o||g||(e.roleId=i("joinRequest.selectRoleError")),C(e),0===Object.keys(e).length})()){if(n)try{A(!0);const e={action:o,response:b.trim()||void 0,roleId:"approve"===o&&g||void 0};await fe.h.processJoinRequest(n.id,e),_(i("approve"===o?"joinRequest.approveSuccess":"joinRequest.rejectSuccess"),"success"),d("approve"),x(null),h(""),C({}),r(),l()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||i("joinRequest.processError");_(e,"error"),C({submit:e})}finally{A(!1)}}else _(i("joinRequest.fillRequired"),"error")},U=()=>{d("approve"),x(null),h(""),C({}),r()};return n?z?(0,D.jsxs)(m.lG,{open:t,onClose:U,className:"relative z-50",children:[(0,D.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,D.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,D.jsxs)(m.lG.Panel,{className:"mx-auto max-w-lg w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,D.jsx)(m.lG.Title,{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,D.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("form",{onSubmit:V,className:"p-4",children:[S.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,D.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,D.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[n.requester.firstName," ",n.requester.lastName]}),(0,D.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.requester.email}),n.message&&(0,D.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,D.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,D.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.message})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,D.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,D.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,D.jsxs)("div",{className:"flex items-center py-2",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,D.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,D.jsxs)("select",{id:"roleId",value:g||"",onChange:e=>{x(Number(e.target.value)||null),S.roleId&&C((e=>(0,c.A)((0,c.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,D.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),k.map((e=>(0,D.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,D.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("joinRequest.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:w,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:i(w?"approve"===o?"joinRequest.approving":"joinRequest.rejecting":"approve"===o?"joinRequest.approve":"joinRequest.reject"),children:w?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,D.jsx)(p.A,{className:"h-5 w-5"}):(0,D.jsx)(O.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,D.jsxs)(D.Fragment,{children:[t&&!F&&(0,D.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:U,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,D.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,D.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,D.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:i("joinRequest.title")}),(0,D.jsx)("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,D.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,D.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[S.submit&&(0,D.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:S.submit}),(0,D.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,D.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[(0,D.jsxs)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.applicant"),":"]}),(0,D.jsxs)("p",{className:"text-sm text-gray-900 dark:text-white",children:[n.requester.firstName," ",n.requester.lastName]}),(0,D.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.requester.email}),n.message&&(0,D.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[(0,D.jsxs)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("joinRequest.message"),":"]}),(0,D.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:n.message})]})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.actionRequired")}),(0,D.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"radio",value:"approve",checked:"approve"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-blue-600 focus:ring-blue-500"}),(0,D.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.approve")})]}),(0,D.jsxs)("label",{className:"flex items-center",children:[(0,D.jsx)("input",{type:"radio",value:"reject",checked:"reject"===o,onChange:e=>{d(e.target.value),C({})},className:"mr-2 text-red-600 focus:ring-red-500"}),(0,D.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i("joinRequest.reject")})]})]})]}),"approve"===o&&(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"roleId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.assignRole")}),j?(0,D.jsxs)("div",{className:"flex items-center py-2",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,D.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("joinRequest.loadingRoles")})]}):(0,D.jsxs)("select",{id:"roleId",value:g||"",onChange:e=>{x(Number(e.target.value)||null),S.roleId&&C((e=>(0,c.A)((0,c.A)({},e),{},{roleId:""})))},className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2 ".concat(S.roleId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"),children:[(0,D.jsx)("option",{value:"",children:i("joinRequest.selectRole")}),k.map((e=>(0,D.jsxs)("option",{value:e.id,children:[e.name," ",e.description?"- ".concat(e.description):""]},e.id)))]}),S.roleId&&(0,D.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:S.roleId})]}),(0,D.jsxs)("div",{children:[(0,D.jsx)("label",{htmlFor:"response",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i("joinRequest.response")}),(0,D.jsx)("textarea",{id:"response",value:b,onChange:e=>h(e.target.value),rows:3,placeholder:i("joinRequest.addOptional",{type:i("approve"===o?"joinRequest.welcomeMessage":"joinRequest.rejectionReason")}),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white px-3 py-2"})]}),(0,D.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,D.jsx)("button",{type:"button",onClick:U,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:i("common.cancel"),children:(0,D.jsx)(y.A,{className:"h-5 w-5"})}),(0,D.jsx)("button",{type:"submit",disabled:w,className:"p-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ".concat("approve"===o?"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-green-500":"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500"),title:w?"approve"===o?"Genehmige...":"Lehne ab...":"approve"===o?"Genehmigen":"Ablehnen",children:w?(0,D.jsx)(R.A,{className:"h-5 w-5 animate-spin"}):"approve"===o?(0,D.jsx)(p.A,{className:"h-5 w-5"}):(0,D.jsx)(O.A,{className:"h-5 w-5"})})]})]})]})]})]}):null},Ve=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Ue=(e,t)=>{switch(e){case"pending":return t("joinRequestsList.status.pending");case"approved":return t("joinRequestsList.status.approved");case"rejected":return t("joinRequestsList.status.rejected");case"withdrawn":return t("joinRequestsList.status.withdrawn");default:return e}},Be="join-requests-table",Me=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),[c,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)([]),[x,b]=(0,a.useState)([]),[h,y]=(0,a.useState)(""),[p,k]=(0,a.useState)(!1),[N,w]=(0,a.useState)(null),[S,C]=(0,a.useState)("Alle"),[z,R]=(0,a.useState)(null),{canViewJoinRequests:E,canManageJoinRequests:L,loading:F}=(0,n.S)(),{showMessage:T}=(0,f.A)(),I=(0,a.useRef)(!0),P=(0,a.useRef)(!1);(0,a.useEffect)((()=>{console.log("[JoinRequestsList] permissionsLoading ge\xe4ndert:",F)}),[F]),(0,a.useEffect)((()=>(console.log("[JoinRequestsList] Component mounted, reset hasInitialLoadRef"),P.current=!1,I.current=!0,()=>{console.log("[JoinRequestsList] Component unmounting"),I.current=!1})),[]),(0,a.useEffect)((()=>{if(console.log("[JoinRequestsList] useEffect triggered",{permissionsLoading:F,hasInitialLoad:P.current,joinRequestsCount:t.length}),F)return void console.log("[JoinRequestsList] Warte auf Berechtigungen...");const a=E();if(console.log("[JoinRequestsList] Berechtigung gepr\xfcft:",a),!a)return console.log("[JoinRequestsList] Keine Berechtigung zum Anzeigen"),d(e("joinRequestsList.noPermission")),i(!1),void(P.current=!0);if(P.current)return void console.log("[JoinRequestsList] Bereits geladen, \xfcberspringe Fetch");console.log("[JoinRequestsList] Starte Fetch der Join Requests...");(async()=>{if(I.current)try{console.log("[JoinRequestsList] Setze loading auf true"),i(!0),d(null),console.log("[JoinRequestsList] Rufe organizationService.getJoinRequests() auf..."),console.log("[JoinRequestsList] API Endpoint:",j.Sn.ORGANIZATIONS.JOIN_REQUESTS);const e=await fe.h.getJoinRequests();if(console.log("[JoinRequestsList] Antwort erhalten:",e),console.log("[JoinRequestsList] Antwort Typ:",typeof e),console.log("[JoinRequestsList] Ist Array:",Array.isArray(e)),console.log("[JoinRequestsList] Ist null/undefined:",null===e||void 0===e),!I.current)return void console.log("[JoinRequestsList] Component w\xe4hrend Request unmounted");if(null===e||void 0===e)throw console.error("[JoinRequestsList] \u274c Antwort ist null oder undefined!"),new Error("Ung\xfcltige Antwort vom Server: Antwort ist null oder undefined");if(!Array.isArray(e))throw console.error("[JoinRequestsList] \u274c Antwort ist kein Array!",e),new Error("Ung\xfcltige Antwort vom Server: Erwartetes Array, erhalten: "+typeof e);console.log("[JoinRequestsList] \u2705 Setze",e.length,"Join Requests"),r(e),d(null),P.current=!0}catch(l){var t,a,s,n;if(console.error("[JoinRequestsList] \u274c Fehler beim Laden:",l),console.error("[JoinRequestsList] Fehler Details:",{message:l.message,response:l.response,status:null===(t=l.response)||void 0===t?void 0:t.status,data:null===(a=l.response)||void 0===a?void 0:a.data,stack:l.stack}),!I.current)return void console.log("[JoinRequestsList] Component w\xe4hrend Error-Handling unmounted");const r=(null===(s=l.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||l.message||e("joinRequestsList.loadError",{defaultValue:"Fehler beim Laden der Beitrittsanfragen"});console.log("[JoinRequestsList] Zeige Fehlermeldung:",r),d(r),setTimeout((()=>{T(r,"error")}),0)}finally{I.current&&(console.log("[JoinRequestsList] Setze loading auf false"),i(!1))}else console.log("[JoinRequestsList] Component unmounted, breche ab")})()}),[F]);const _=(e,t)=>{g(e),b(t)},O=()=>{g([]),b([]),C(""),R(null)},q=()=>u.length;(0,a.useEffect)((()=>{(async()=>{try{const e=await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(Be)),t=e.data.find((e=>"Alle"===e.name));t&&(C("Alle"),R(t.id),_(t.conditions,t.operators))}catch(o){console.error("Fehler beim Setzen des initialen Filters:",o)}})()}),[]),(0,a.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return void console.error("Nicht authentifiziert");const e=(await v.A.get(j.Sn.SAVED_FILTERS.BY_TABLE(Be))).data||[];if(!e.some((e=>"Alle"===e.name))){const e={tableId:Be,name:"Alle",conditions:[],operators:[]};await v.A.post(j.Sn.SAVED_FILTERS.BASE,e),console.log("Alle-Filter f\xfcr Join Requests erstellt")}}catch(o){console.error("Fehler beim Erstellen der Standard-Filter:",o)}})()}),[]);const V=(0,a.useMemo)((()=>{let e=[...t];if(h){const t=h.toLowerCase();e=e.filter((e=>{var r,a;const s="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),n=(null===(r=e.requester.email)||void 0===r?void 0:r.toLowerCase())||"",l=(null===(a=e.message)||void 0===a?void 0:a.toLowerCase())||"";return s.includes(t)||n.includes(t)||l.includes(t)}))}return u.length>0&&(e=u.reduce(((e,t,r)=>{if(!t.column||null===t.value||""===t.value)return e;const a=t.operator,s=t.value;return e.filter((e=>{var r,n;switch(t.column){case"requester":const t="".concat(e.requester.firstName," ").concat(e.requester.lastName).toLowerCase(),l=(null===(r=e.requester.email)||void 0===r?void 0:r.toLowerCase())||"",i=String(s).toLowerCase();return"contains"===a?t.includes(i)||l.includes(i):"equals"===a?t===i||l===i:"startsWith"===a&&(t.startsWith(i)||l.startsWith(i));case"message":const o=(null===(n=e.message)||void 0===n?void 0:n.toLowerCase())||"",d=String(s).toLowerCase();return"contains"===a?o.includes(d):"equals"===a?o===d:"startsWith"===a&&o.startsWith(d);case"status":return"equals"===a&&e.status===s;default:return!0}}))}),e)),e}),[t,h,u,x]);return F?(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,D.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loadingPermissions")})]})}):E()?(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 sm:p-6 mb-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-4",children:[(0,D.jsxs)("h2",{className:"text-xl sm:text-xl font-semibold flex items-center dark:text-white",children:[(0,D.jsx)(he.A,{className:"h-6 w-6 sm:h-6 sm:w-6 mr-2 sm:mr-2"}),e("joinRequestsList.title")]}),(0,D.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,D.jsx)("input",{type:"text",placeholder:e("common.search",{defaultValue:"Suchen..."}),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:h,onChange:e=>y(e.target.value)}),(0,D.jsxs)("button",{className:"p-2 rounded-md border ".concat(q()>0?"border-blue-300 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"," relative"),onClick:()=>m(!c),title:e("common.filter"),children:[(0,D.jsx)(Y.A,{className:"h-5 w-5"}),q()>0&&(0,D.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:q()})]})]})]}),c&&(0,D.jsx)("div",{className:"mb-4",children:(0,D.jsx)(Z.A,{columns:[{id:"requester",label:e("joinRequestsList.filter.requester")},{id:"message",label:e("joinRequestsList.filter.message")},{id:"status",label:e("joinRequestsList.status.title",{defaultValue:"Status"})}],onApply:_,onReset:O,savedConditions:u,savedOperators:x,tableId:Be})}),(0,D.jsx)(X.A,{tableId:Be,onSelectFilter:_,onReset:O,activeFilterName:S,selectedFilterId:z,onFilterChange:(e,t,r,a)=>{C(e),R(t),_(r,a)},defaultFilterName:"Alle"}),o&&(0,D.jsx)("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 rounded",children:o}),l?(0,D.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,D.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,D.jsx)("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:e("joinRequestsList.loading")})]}):0===V.length?(0,D.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:0===t.length?e("joinRequestsList.noRequests"):e("joinRequestsList.noMatching")}):(0,D.jsx)("div",{className:"space-y-4",children:V.map((t=>(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow hover:shadow-md transition-shadow",children:(0,D.jsx)("div",{className:"flex items-start justify-between",children:(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,D.jsxs)("div",{children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.requester.firstName," ",t.requester.lastName]}),(0,D.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.requester.email})]}),(0,D.jsx)("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(Ve(t.status)),children:Ue(t.status,e)})]}),t.message&&(0,D.jsx)("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:(0,D.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,D.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.filter.message"),":"]})," ",t.message]})}),t.response&&(0,D.jsx)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,D.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[(0,D.jsxs)("span",{className:"font-medium",children:[e("joinRequestsList.response"),":"]})," ",t.response]})}),"pending"===t.status&&L()&&(0,D.jsx)("div",{className:"mt-4 flex items-center gap-2",children:(0,D.jsxs)("button",{onClick:()=>(t=>{if(!L()){const t=e("joinRequestsList.noPermissionEdit");return d(t),void T(t,"error")}w(t),k(!0)})(t),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md dark:bg-blue-700 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center",children:[(0,D.jsx)(A.A,{className:"h-4 w-4 mr-1"}),e("joinRequestsList.edit")]})})]})})},t.id)))}),(0,D.jsx)(qe,{isOpen:p,onClose:()=>{k(!1),w(null)},joinRequest:N,onSuccess:async()=>{P.current=!1;try{i(!0);const e=await fe.h.getJoinRequests();r(e),d(null),P.current=!0}catch(a){var e,t;const r=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Laden der Beitrittsanfragen";d(r),P.current=!0}finally{i(!1)}}})]}):(0,D.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 shadow p-6 mb-6",children:(0,D.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("joinRequestsList.noPermission")})})},Ge=()=>{const{t:e}=(0,s.Bd)(),[t,r]=(0,a.useState)(!1),[c,m]=(0,a.useState)(null),{showMessage:u}=(0,f.A)(),{isAdmin:g,hasPermission:x,canViewOrganization:b,loading:h}=(0,n.S)(),y=x("organization_management","read","page"),p=x("users","read","table"),k=x("roles","read","table"),v=x("branches","read","table"),j=b(),[N,w]=(0,a.useState)("users"),A=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(!h&&!A.current){let e="organization";p?e="users":k?e="roles":v?e="branches":j&&(e="organization"),w(e),A.current=!0}}),[h,p,k,v,j]);const S=e=>{("users"!==e||p)&&("roles"!==e||k)&&("branches"!==e||v)&&("organization"!==e||j)&&(w(e),m(null))},C=t=>{var r,a;let s=e("errors.unknownError");null!==(r=t.response)&&void 0!==r&&null!==(a=r.data)&&void 0!==a&&a.message?s=t.response.data.message:t instanceof Error&&(s=t.message),m(s),u(s,"error")};return y?(0,D.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,D.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,D.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,D.jsxs)("div",{className:"flex items-center mb-6",children:[(0,D.jsx)(l.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,D.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:e("organisation.title")})]}),(0,D.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:(0,D.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,D.jsxs)("button",{className:"".concat("users"===N&&p?"border-blue-500 text-blue-600 dark:text-blue-400":p?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>p&&S("users"),disabled:!p,children:[(0,D.jsx)(i.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.users"),!p&&(0,D.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),(0,D.jsxs)("button",{className:"".concat("roles"===N&&k?"border-blue-500 text-blue-600 dark:text-blue-400":k?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>k&&S("roles"),disabled:!k,children:[(0,D.jsx)(o.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.roles"),!k&&(0,D.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),(0,D.jsxs)("button",{className:"".concat("branches"===N&&v?"border-blue-500 text-blue-600 dark:text-blue-400":v?"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600":"border-transparent text-gray-400 dark:text-gray-500 cursor-not-allowed opacity-60"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center relative"),onClick:()=>v&&S("branches"),disabled:!v,children:[(0,D.jsx)(d.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.branches",{defaultValue:"Niederlassungen"}),!v&&(0,D.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded",children:"PRO"})]}),j&&(0,D.jsxs)("button",{className:"".concat("organization"===N?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center"),onClick:()=>S("organization"),children:[(0,D.jsx)(l.A,{className:"h-5 w-5 mr-2"}),e("organisation.tabs.organization")]})]})}),c&&(0,D.jsxs)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded mb-4",children:[(0,D.jsx)("p",{className:"font-bold",children:e("organisation.error")}),(0,D.jsx)("p",{children:c})]}),t&&(0,D.jsx)("div",{className:"p-4 dark:text-gray-300",children:e("organisation.loading")}),(0,D.jsx)("div",{className:"mt-6",children:"users"===N?p?(0,D.jsx)(W,{onError:C}):(0,D.jsx)("div",{className:"p-8 text-center",children:(0,D.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,D.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,D.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.users")})]})}):"roles"===N?k?(0,D.jsx)(ue,{onError:C}):(0,D.jsx)("div",{className:"p-8 text-center",children:(0,D.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,D.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,D.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.roles")})]})}):"branches"===N?v?(0,D.jsx)(be,{onError:C}):(0,D.jsx)("div",{className:"p-8 text-center",children:(0,D.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6",children:[(0,D.jsx)("span",{className:"inline-block px-3 py-1 text-sm font-semibold bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded mb-4",children:"PRO"}),(0,D.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mt-4",children:e("organisation.proFeature.branches",{defaultValue:"Niederlassungs-Verwaltung ist eine PRO-Funktion"})})]})}):"organization"===N&&j?(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsx)(Oe,{}),(0,D.jsx)(Me,{})]}):(0,D.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("organisation.noPermissionForPage")})})]})})}):(0,D.jsx)("div",{className:"p-4 text-red-600 dark:text-red-400",children:e("organisation.noPermission")})}}}]);
//# sourceMappingURL=931.6c9b2664.chunk.js.map