"use strict";(self.webpackChunkintranet_frontend=self.webpackChunkintranet_frontend||[]).push([[513],{1713:(e,t,a)=>{a.d(t,{DW:()=>j,I5:()=>h,IF:()=>f,M9:()=>g,P0:()=>c,Pg:()=>w,VY:()=>y,Yq:()=>i,_2:()=>x,c$:()=>p,fU:()=>d,h4:()=>k,lK:()=>b,pg:()=>m,uT:()=>u,vv:()=>v});var r=a(4653),s=a(9837),n=a(1620),l=a(6981),o=a(887);const i=e=>{if(!e)return"-";try{const t=e.split("-");if(3!==t.length)return"-";const a=parseInt(t[0]),r=parseInt(t[1])-1,s=parseInt(t[2]);return new Date(a,r,s,12,0,0).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Fehler beim Formatieren des Datums:",t),"-"}},d=e=>{if(!e)return"-";try{const t=(0,r.H)(e),a=t.getUTCHours().toString().padStart(2,"0"),s=t.getUTCMinutes().toString().padStart(2,"0");return"".concat(a,":").concat(s)}catch(t){return console.error("Fehler beim Formatieren der Zeit f\xfcr ".concat(e,":"),t),"-"}},c=(e,t)=>{if(!e||!t)return"-";try{const a=e.endsWith("Z")?e.substring(0,e.length-1):e,r=t.endsWith("Z")?t.substring(0,t.length-1):t,s=new Date(a),n=new Date(r).getTime()-s.getTime(),l=Math.floor(n/6e4),o=Math.floor(l/60),i=l%60;return"".concat(o,"h ").concat(i,"m")}catch(a){return console.error("Fehler bei der Dauerberechnung:",a),"-"}},m=e=>{try{const t=parseInt(e.substring(0,4)),a=parseInt(e.substring(6)),r=new Date(Date.UTC(t,0,1,12,0,0)).getUTCDay(),l=r<=4?4-r:11-r,i=new Date(Date.UTC(t,0,1+l,12,0,0)),d=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+7*(a-1),12,0,0)),c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()-3,12,0,0)),m=(0,s.GP)(c,"yyyy-MM-dd");if(console.log("Konvertierte Woche ".concat(e," zu Datum: ").concat(m," (Wochentag: ").concat((0,s.GP)(c,"EEEE",{locale:o.de}),")")),"Montag"!==(0,s.GP)(c,"EEEE",{locale:o.de})){console.warn("Berechnetes Datum ist kein Montag! Korrigiere...");const e=(0,n.k)(c,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}return m}catch(t){console.error("Fehler beim Konvertieren des Wochendatums:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},u=(e,t)=>{try{if(!e||!e.startTime)return!1;return e.startTime.split("T")[0]===t}catch(a){return console.error("Fehler beim Pr\xfcfen der Relevanz eines Worktime-Eintrags:",a),!1}},x=e=>{if(!e)return[];const t=new Date(e),a=[];for(let r=0;r<7;r++){const e=(0,l.f)(t,r),n={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};a.push(n)}return a},h=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Fehler beim Formatieren des Datums und der Zeit:",t),"-"}},g=e=>{try{let t,a,r;if(!e.includes("-Q"))throw new Error("Ung\xfcltiges Quinzena-Format");{const s=e.split("-Q"),n=s[0];if(r=parseInt(s[1]),n.includes("-")){const e=n.split("-");t=parseInt(e[0]),a=parseInt(e[1])}else t=parseInt(n),a=Math.ceil(r/2)}const n=1===r?1:16,l=new Date(Date.UTC(t,a-1,n,12,0,0));return(0,s.GP)(l,"yyyy-MM-dd")}catch(t){console.error("Fehler beim Konvertieren der Quinzena:",t);const e=(0,n.k)(new Date,{weekStartsOn:1});return(0,s.GP)(e,"yyyy-MM-dd")}},b=e=>{if(!e)return[];const t=new Date(e),a=t.getFullYear(),r=t.getMonth();let n;if(1===t.getDate())n=15;else{n=new Date(a,r+1,0).getDate()-15}const i=[];for(let d=0;d<n;d++){const e=(0,l.f)(t,d),a={date:(0,s.GP)(e,"yyyy-MM-dd"),day:(0,s.GP)(e,"EEEE",{locale:o.de})};i.push(a)}return i},y=()=>{const e=new Date;return(e=>{try{const t=new Date(e+"T12:00:00"),a=t.getFullYear(),r=t.getMonth()+1,s=t.getDate()<=15?1:2;return"".concat(a,"-").concat(String(r).padStart(2,"0"),"-Q").concat(s)}catch(t){console.error("Fehler beim Berechnen der Quinzena:",t);const e=new Date,a=e.getFullYear(),r=e.getMonth()+1;return"".concat(a,"-").concat(String(r).padStart(2,"0"),"-Q1")}})((0,s.GP)(e,"yyyy-MM-dd"))},f=e=>{const t=new Date(e);return new Date(t.getTime()+6e4*t.getTimezoneOffset())},p=e=>{try{const t=e.reduce(((e,t)=>{if(!t.endTime)return e;const a=t.startTime.endsWith("Z")?t.startTime.substring(0,t.startTime.length-1):t.startTime,r=t.endTime.endsWith("Z")?t.endTime.substring(0,t.endTime.length-1):t.endTime,s=new Date(a),n=new Date(r).getTime()-s.getTime();return e+Math.floor(n/6e4)}),0),a=Math.floor(t/60),r=t%60;return"".concat(a,"h ").concat(r,"m")}catch(t){return console.error("Fehler bei der Formatierung der Gesamtdauer:",t),"0h 0m"}},v=e=>!!(e.invoiceItems&&e.invoiceItems.length>0),k=e=>{if(!e.invoiceItems||0===e.invoiceItems.length)return null;return e.invoiceItems[0].invoice},w=e=>({DRAFT:"Entwurf",SENT:"Gesendet",PAID:"Bezahlt",OVERDUE:"\xdcberf\xe4llig",CANCELLED:"Storniert"}[e]||e),j=e=>({DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",SENT:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",CANCELLED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}[e]||"bg-gray-100 text-gray-800")},8513:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ee});var r=a(5043),s=a(4117),n=a(2760),l=a(7504),o=a(7012),i=a(2302),d=a(8662),c=a(8552),m=a(1801),u=a(1923),x=a(1713),h=a(2672),g=a(7952),b=a(7488),y=a(6443),f=a(7591),p=a(7449),v=a(2811),k=a(9248);const w=async e=>{try{return(await u.A.delete(m.Sn.CLIENTS.BY_ID(e))).data}catch(t){throw console.error("Fehler beim L\xf6schen des Clients:",t),t}},j=async()=>{try{return(await u.A.get(m.Sn.CLIENTS.RECENT)).data}catch(e){throw console.error("Fehler beim Laden der zuletzt beratenen Clients:",e),e}};var N=a(9379),S=a(1816),C=a(9422),T=a(5657),A=a(579);const E=e=>{let{isOpen:t,onClose:a,onClientUpdated:n,onClientDeleted:l,client:o}=e;const{t:i}=(0,s.Bd)(),{openSidepane:d,closeSidepane:c}=(0,T.N)(),[x,h]=(0,r.useState)(window.innerWidth>1070),[g,p]=(0,r.useState)({name:"",company:"",email:"",phone:"",address:"",notes:"",isActive:!0}),[v,j]=(0,r.useState)({}),[E,F]=(0,r.useState)(!1),[D,R]=(0,r.useState)(!1),[_,I]=(0,r.useState)(window.innerWidth<640);(0,r.useEffect)((()=>{t&&o&&(p({name:o.name||"",company:o.company||"",email:o.email||"",phone:o.phone||"",address:o.address||"",notes:o.notes||"",isActive:void 0===o.isActive||o.isActive}),R(!1),j({}))}),[t,o]),(0,r.useEffect)((()=>{const e=()=>{I(window.innerWidth<640),h(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?d():c(),()=>{c()})),[t,d,c]);const L=async e=>{if(e.preventDefault(),(()=>{const e={};return g.name.trim()||(e.name="Name ist erforderlich"),g.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),j(e),0===Object.keys(e).length})()&&o)try{F(!0);const e=await(async(e,t)=>{try{return(await u.A.put(m.Sn.CLIENTS.BY_ID(e),t)).data}catch(a){throw console.error("Fehler beim Aktualisieren des Clients:",a),a}})(o.id,{name:g.name,company:g.company||void 0,email:g.email||void 0,phone:g.phone||void 0,address:g.address||void 0,notes:g.notes||void 0,isActive:g.isActive});b.oR.success("Client erfolgreich aktualisiert"),null===n||void 0===n||n(e)}catch(r){var t,a;b.oR.error((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Aktualisieren des Clients")}finally{F(!1)}},O=async()=>{if(D){if(o)try{F(!0),await w(o.id),b.oR.success("Client erfolgreich gel\xf6scht"),null===l||void 0===l||l(o.id),a()}catch(c){var e,t,r,s,n,i,d;const a=(null===(e=c.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim L\xf6schen des Clients",l=null===(r=c.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.details,o=null===(n=c.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.suggestion;if(409===(null===(d=c.response)||void 0===d?void 0:d.status)&&l){const e=Object.entries(l).filter((e=>{let[t,a]=e;return a>0})).map((e=>{let[t,a]=e;return"".concat(a," ").concat("workTimes"===t?"Zeiteintr\xe4ge":"consultationInvoices"===t?"Rechnungen":"Monatsberichte")})).join(", ");b.oR.error("".concat(a,". Verkn\xfcpfungen: ").concat(e,". ").concat(o||""))}else b.oR.error(a);R(!1)}finally{F(!1)}}else R(!0)},M=e=>{const{name:t,value:a,type:r}=e.target,s=e.target.checked;p((e=>(0,N.A)((0,N.A)({},e),{},{[t]:"checkbox"===r?s:a}))),v[t]&&j((e=>(0,N.A)((0,N.A)({},e),{},{[t]:""})))},B=()=>{R(!1),j({}),a()};return o?_?(0,A.jsxs)(y.lG,{open:t,onClose:B,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsxs)(y.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,A.jsx)(y.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,A.jsx)("button",{onClick:B,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("form",{onSubmit:L,className:"p-4",children:[(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,A.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:g.name,onChange:M,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(v.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.name&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.name})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,A.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:g.company,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,A.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:g.email,onChange:M,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(v.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.email&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.email})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,A.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:g.phone,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,A.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:g.address,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,A.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:g.notes,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("input",{type:"checkbox",id:"isActive_mobile",name:"isActive",checked:g.isActive,onChange:M,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,A.jsx)("label",{htmlFor:"isActive_mobile",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]})]}),(0,A.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,A.jsxs)("button",{type:"button",onClick:O,disabled:E,className:"inline-flex items-center px-4 py-2 border ".concat(D?"border-red-300 text-red-700 bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-red-900/20":"border-red-300 text-red-700 bg-white hover:bg-red-50 dark:border-red-600 dark:text-red-400 dark:bg-gray-700 dark:hover:bg-gray-600"," text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,A.jsx)(k.A,{className:"h-5 w-5 mr-2"}),D?"Wirklich l\xf6schen?":"L\xf6schen"]}),(0,A.jsxs)("div",{className:"flex space-x-3",children:[(0,A.jsx)("button",{type:"button",onClick:B,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{type:"submit",disabled:E,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:E?"Speichere...":"Speichern",children:E?(0,A.jsx)(S.A,{className:"h-5 w-5 animate-spin"}):(0,A.jsx)(C.A,{className:"h-5 w-5"})})]})]})]})]})})]}):(0,A.jsxs)(A.Fragment,{children:[t&&!x&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:B,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,A.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,A.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Client bearbeiten"}),(0,A.jsx)("button",{onClick:B,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(v).length>0&&(0,A.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(v).map(((e,t)=>(0,A.jsx)("p",{children:e},t)))}),(0,A.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,A.jsx)("input",{type:"text",id:"name",name:"name",value:g.name,onChange:M,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(v.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.name&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.name})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,A.jsx)("input",{type:"text",id:"company",name:"company",value:g.company,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,A.jsx)("input",{type:"email",id:"email",name:"email",value:g.email,onChange:M,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(v.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),v.email&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:v.email})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,A.jsx)("input",{type:"tel",id:"phone",name:"phone",value:g.phone,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,A.jsx)("input",{type:"text",id:"address",name:"address",value:g.address,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,A.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:g.notes,onChange:M,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("input",{type:"checkbox",id:"isActive",name:"isActive",checked:g.isActive,onChange:M,className:"rounded border-gray-300 text-blue-600 dark:bg-gray-700 dark:text-gray-300"}),(0,A.jsx)("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Aktiv"})]}),(0,A.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,A.jsx)("button",{type:"button",onClick:O,disabled:E,className:"p-2 rounded-md ".concat(D?"bg-red-600 text-white dark:bg-red-700 dark:text-white hover:bg-red-700 dark:hover:bg-red-600":"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"," disabled:opacity-50 disabled:cursor-not-allowed"),title:D?"L\xf6schen best\xe4tigen":"Client l\xf6schen",children:D?(0,A.jsx)(C.A,{className:"h-5 w-5"}):(0,A.jsx)(k.A,{className:"h-5 w-5"})}),(0,A.jsxs)("div",{className:"flex gap-2",children:[(0,A.jsx)("button",{type:"button",onClick:B,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",title:i("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{type:"submit",disabled:E,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:E?"Speichere...":"Speichern",children:E?(0,A.jsx)(S.A,{className:"h-5 w-5 animate-spin"}):(0,A.jsx)(C.A,{className:"h-5 w-5"})})]})]})]})]})]})]}):null},F=e=>{let{isOpen:t,onClose:a,onSelect:n,onCreateNew:l}=e;const{t:o}=(0,s.Bd)(),[i,c]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[g,j]=(0,r.useState)(""),[N,S]=(0,r.useState)(!0),[C,T]=(0,r.useState)(null),[F,D]=(0,r.useState)(!1);(0,r.useEffect)((()=>{t&&R()}),[t]),(0,r.useEffect)((()=>{if(g){const e=i.filter((e=>e.name.toLowerCase().includes(g.toLowerCase())||e.company&&e.company.toLowerCase().includes(g.toLowerCase())||e.email&&e.email.toLowerCase().includes(g.toLowerCase())));h(e)}else h(i)}),[g,i]);const R=async()=>{try{S(!0);const e=await u.A.get(m.Sn.CLIENTS.BASE);c(e.data),h(e.data)}catch(e){}finally{S(!1)}};return(0,A.jsxs)(y.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(y.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,A.jsxs)("div",{className:"p-6",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,A.jsx)(y.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Client ausw\xe4hlen"}),(0,A.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"relative mb-4",children:[(0,A.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,A.jsx)(p.A,{className:"h-5 w-5 text-gray-400"})}),(0,A.jsx)("input",{type:"text",value:g,onChange:e=>j(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Client suchen...",autoFocus:!0})]}),(0,A.jsx)("div",{className:"max-h-96 overflow-y-auto",children:N?(0,A.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"Lade Clients..."}):0===x.length?(0,A.jsxs)("div",{className:"text-center py-8",children:[(0,A.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:g?"Keine Clients gefunden":"Noch keine Clients vorhanden"}),(0,A.jsxs)("button",{onClick:l,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,A.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Neuen Client anlegen"]})]}):(0,A.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.map((e=>(0,A.jsx)("li",{children:(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("button",{onClick:()=>n(e),className:"flex-1 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-left transition-colors",children:(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),e.company&&(0,A.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.company}),e.email&&(0,A.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),(0,A.jsxs)("div",{className:"flex items-center space-x-2 px-2",children:[(0,A.jsx)("button",{onClick:t=>((e,t)=>{t.stopPropagation(),T(e),D(!0)})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:"Client bearbeiten",children:(0,A.jsx)(v.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{onClick:t=>(async(e,t)=>{if(t.stopPropagation(),window.confirm(o("client.deleteConfirm",{name:e.name})))try{await w(e.id),b.oR.success(o("client.deleteSuccess")),R()}catch(s){var a,r;b.oR.error((null===(a=s.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||o("client.deleteError"))}})(e,t),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:o("client.deleteTitle"),children:(0,A.jsx)(k.A,{className:"h-5 w-5"})})]})]})},e.id)))})}),x.length>0&&(0,A.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,A.jsxs)("button",{onClick:l,className:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,A.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Neuen Client anlegen"]})})]})})}),C&&(0,A.jsx)(E,{isOpen:F,onClose:()=>{D(!1),T(null)},onClientUpdated:e=>{const t=i.findIndex((t=>t.id===e.id));if(-1!==t){const a=[...i];a[t]=e,c(a),h(a)}D(!1),T(null)},onClientDeleted:e=>{R(),D(!1),T(null)},client:C})]})},D=e=>{let{isOpen:t,onClose:a,onSave:n}=e;const{t:l}=(0,s.Bd)(),{openSidepane:o,closeSidepane:i}=(0,T.N)(),[d,c]=(0,r.useState)(window.innerWidth>1070),[x,h]=(0,r.useState)({name:"",company:"",email:"",phone:"",address:"",notes:""}),[g,p]=(0,r.useState)({}),[v,k]=(0,r.useState)(!1),[w,j]=(0,r.useState)(window.innerWidth<640),E=async e=>{if(e.preventDefault(),(()=>{const e={};return x.name.trim()||(e.name="Name ist erforderlich"),x.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)&&(e.email="Ung\xfcltige E-Mail-Adresse"),p(e),0===Object.keys(e).length})())try{k(!0);const e=await u.A.post(m.Sn.CLIENTS.BASE,(0,N.A)((0,N.A)({},x),{},{company:x.company||null,email:x.email||null,phone:x.phone||null,address:x.address||null,notes:x.notes||null}));b.oR.success("Client erfolgreich angelegt"),n(e.data),h({name:"",company:"",email:"",phone:"",address:"",notes:""})}catch(r){var t,a;b.oR.error((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Fehler beim Anlegen des Clients")}finally{k(!1)}};(0,r.useEffect)((()=>{const e=()=>{j(window.innerWidth<640),c(window.innerWidth>1070)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,r.useEffect)((()=>(t?o():i(),()=>{i()})),[t,o,i]);const F=e=>{const{name:t,value:a}=e.target;h((e=>(0,N.A)((0,N.A)({},e),{},{[t]:a}))),g[t]&&p((e=>(0,N.A)((0,N.A)({},e),{},{[t]:""})))},D=()=>{h({name:"",company:"",email:"",phone:"",address:"",notes:""}),p({}),a()};return w?(0,A.jsxs)(y.lG,{open:t,onClose:D,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsxs)(y.lG.Panel,{className:"mx-auto max-w-xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,A.jsx)(y.lG.Title,{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,A.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("form",{onSubmit:E,className:"p-4",children:[(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"name_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,A.jsx)("input",{type:"text",id:"name_mobile",name:"name",value:x.name,onChange:F,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"company_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,A.jsx)("input",{type:"text",id:"company_mobile",name:"company",value:x.company,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"email_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,A.jsx)("input",{type:"email",id:"email_mobile",name:"email",value:x.email,onChange:F,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(g.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.email&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.email})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"phone_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,A.jsx)("input",{type:"tel",id:"phone_mobile",name:"phone",value:x.phone,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"address_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,A.jsx)("input",{type:"text",id:"address_mobile",name:"address",value:x.address,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"notes_mobile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,A.jsx)("textarea",{id:"notes_mobile",name:"notes",rows:3,value:x.notes,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,A.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,A.jsx)("button",{type:"button",onClick:D,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:v?"Speichere...":"Speichern",children:v?(0,A.jsx)(S.A,{className:"h-5 w-5 animate-spin"}):(0,A.jsx)(C.A,{className:"h-5 w-5"})})]})]})]})})]}):(0,A.jsxs)(A.Fragment,{children:[t&&!d&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black/10 transition-opacity sidepane-overlay sidepane-backdrop z-40","aria-hidden":"true",onClick:D,style:{opacity:t?1:0,transition:"opacity 300ms ease-out"}}),(0,A.jsxs)("div",{className:"fixed top-16 bottom-0 right-0 max-w-sm w-full bg-white dark:bg-gray-800 shadow-xl sidepane-panel sidepane-panel-container transform z-50 flex flex-col ".concat(t?"translate-x-0":"translate-x-full"),style:{transition:"transform 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94)",pointerEvents:t?"auto":"none"},"aria-hidden":!t,role:"dialog","aria-modal":t,children:[(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700 flex-shrink-0",children:[(0,A.jsx)("h2",{className:"text-lg font-semibold dark:text-white",children:"Neuen Client anlegen"}),(0,A.jsx)("button",{onClick:D,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:[Object.keys(g).length>0&&(0,A.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:Object.values(g).map(((e,t)=>(0,A.jsx)("p",{children:e},t)))}),(0,A.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name *"}),(0,A.jsx)("input",{type:"text",id:"name",name:"name",value:x.name,onChange:F,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(g.name?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.name&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.name})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Firma"}),(0,A.jsx)("input",{type:"text",id:"company",name:"company",value:x.company,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"E-Mail"}),(0,A.jsx)("input",{type:"email",id:"email",name:"email",value:x.email,onChange:F,className:"mt-1 block w-full rounded-md border shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white ".concat(g.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600")}),g.email&&(0,A.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:g.email})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Telefon"}),(0,A.jsx)("input",{type:"tel",id:"phone",name:"phone",value:x.phone,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adresse"}),(0,A.jsx)("input",{type:"text",id:"address",name:"address",value:x.address,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notizen"}),(0,A.jsx)("textarea",{id:"notes",name:"notes",rows:3,value:x.notes,onChange:F,className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{className:"flex justify-end pt-4 gap-2",children:[(0,A.jsx)("button",{type:"button",onClick:D,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{type:"submit",disabled:v,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:v?"Speichere...":"Speichern",children:v?(0,A.jsx)(S.A,{className:"h-5 w-5 animate-spin"}):(0,A.jsx)(C.A,{className:"h-5 w-5"})})]})]})]})]})]})},R=async e=>{try{return(await u.A.post(m.Sn.CONSULTATIONS.START,e)).data}catch(t){throw console.error("Fehler beim Starten der Beratung:",t),t}},_=async e=>{try{return(await u.A.post(m.Sn.CONSULTATIONS.STOP,e)).data}catch(t){throw console.error("Fehler beim Stoppen der Beratung:",t),t}},I=async(e,t)=>{try{return(await u.A.patch(m.Sn.CONSULTATIONS.UPDATE_NOTES(e),t)).data}catch(a){throw console.error("Fehler beim Aktualisieren der Notizen:",a),a}},L=e=>"isPlaceholder"in e&&!0===e.isPlaceholder,O=e=>{var t,a;let{onConsultationChange:n,onConsultationStarted:y}=e;const{t:f}=(0,s.Bd)(),{user:p}=(0,h.As)(),{selectedBranch:v}=(0,g.O)(),[k,w]=(0,r.useState)(null),[N,S]=(0,r.useState)(!0),[C,T]=(0,r.useState)(!1),[E,O]=(0,r.useState)(!1),[M,B]=(0,r.useState)(!1),[P,U]=(0,r.useState)(null),[z,G]=(0,r.useState)([]),[W,V]=(0,r.useState)(""),[Y,K]=(0,r.useState)(null),H=(0,r.useRef)(null),[Z,q]=(0,r.useState)(3),[Q,$]=(0,r.useState)(0),J=(0,r.useRef)(null),[X,ee]=(0,r.useState)(!1),[te,ae]=(0,r.useState)(""),[re,se]=(0,r.useState)("");(0,r.useEffect)((()=>{ne(),le()}),[]);const ne=async()=>{try{const e=await u.A.get(m.Sn.WORKTIME.ACTIVE);e.data&&e.data.clientId&&(w(e.data),V(e.data.notes||""))}catch(e){}finally{S(!1)}},le=async()=>{try{console.log("=== FRONTEND: loadRecentClients() called ===");const e=await j();console.log("=== FRONTEND: received clients:",e),G(e||[])}catch(e){console.error("=== FRONTEND: loadRecentClients() ERROR ===",e)}},oe=async(e,t)=>{if(v)try{var a;T(!0);const r=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),s=await R({branchId:v,clientId:e,notes:t||"",startTime:r.toISOString()});w(s),V(t||""),U(null),O(!1),K(e),window.dispatchEvent(new CustomEvent("consultationChanged")),le(),null===n||void 0===n||n(s),y&&null!==(a=s.client)&&void 0!==a&&a.name&&y(s.client.name),b.oR.success(f("consultations.started"))}catch(r){console.error("Fehler beim Starten der Beratung:",r),b.oR.error(f("consultations.startError"))}finally{T(!1)}else b.oR.error(f("consultations.selectBranch"))},ie=async()=>{if(k)try{await I(k.id,{notes:W})}catch(e){}};(0,r.useEffect)((()=>{if(!k||!W)return;const e=setTimeout((()=>{ie()}),3e4);return()=>clearTimeout(e)}),[W,k]),(0,r.useEffect)((()=>{const e=()=>{le()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[]);const de=(0,r.useMemo)((()=>0===z.length?85:z.reduce(((e,t)=>e+(6*t.name.length+24)),0)/z.length),[z]),ce=(0,r.useCallback)((()=>{if(!H.current||0===z.length)return;const e=H.current.clientWidth;if(Math.abs(e-Q)<40)return;$(e);const t=e-32-(e<768?8:20)-12,a=Math.max(1,Math.floor(t/de));q(Math.min(a,z.length))}),[z,de,Q]),me=(0,r.useCallback)((()=>{J.current&&clearTimeout(J.current),J.current=setTimeout((()=>{ce()}),150)}),[ce]);(0,r.useEffect)((()=>{if(!H.current)return;const e=new ResizeObserver(me);return e.observe(H.current),window.addEventListener("resize",me),()=>{e.disconnect(),window.removeEventListener("resize",me),J.current&&clearTimeout(J.current)}}),[me]),(0,r.useLayoutEffect)((()=>{ce()}),[ce]);const ue=0===z.length&&N,xe=(0,r.useMemo)((()=>ue?Array(3).fill(null).map(((e,t)=>({id:"placeholder-".concat(t),name:"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",isPlaceholder:!0,status:void 0,lastConsultationDate:void 0}))):[]),[ue]),he=ue?xe:z,ge=ue?xe.length:Z,be=(0,r.useMemo)((()=>{if(ue||!Y)return he;const e=he.find((e=>e.id===Y));if(!e)return he;return[e,...he.filter((e=>e.id!==Y))]}),[he,Y,ue]);return N?(0,A.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:(0,A.jsxs)("div",{className:"animate-pulse",children:[(0,A.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),(0,A.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),(0,A.jsx)("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"})]})}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,A.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center pl-2 sm:pl-0",children:[(0,A.jsx)(l.A,{className:"h-6 w-6 mr-2 sm:h-6 sm:w-6 sm:mr-2"}),f("consultations.trackerTitle")]}),k&&(0,A.jsxs)("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[(0,A.jsx)(o.A,{className:"h-5 w-5 mr-2 animate-pulse"}),(0,A.jsxs)("span",{className:"font-medium",children:[(0,x.P0)(k.startTime,null)," - ",null===(t=k.client)||void 0===t?void 0:t.name]})]})]}),k?(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,A.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:f("consultations.activeWith")}),(0,A.jsx)("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:null===(a=k.client)||void 0===a?void 0:a.name}),(0,A.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[f("consultations.startedAt"),": ",(0,x.fU)(k.startTime)]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:f("consultations.notesForConsultation")}),(0,A.jsx)("textarea",{value:W,onChange:e=>V(e.target.value),onBlur:ie,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:f("consultations.notesPlaceholder")})]}),(0,A.jsxs)("button",{onClick:async()=>{try{const e=new Date((new Date).getTime()-6e4*(new Date).getTimezoneOffset()),t=await _({endTime:e.toISOString(),notes:W||void 0});w(null),V(""),b.oR.success(f("consultations.stopped")),le(),null===n||void 0===n||n(t),console.log("\ud83d\uded1 ConsultationTracker: Sending consultationChanged event (stop)"),window.dispatchEvent(new CustomEvent("consultationChanged"))}catch(a){var e,t;b.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||f("consultations.stopError"))}},className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[(0,A.jsx)(i.A,{className:"h-5 w-5 mr-2"}),f("consultations.stop")]})]}):(0,A.jsxs)("div",{className:"space-y-4",children:[be.length>0&&!X&&(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:be.some((e=>!L(e)&&"planned"===e.status))?f("consultations.recentAndPlanned"):f("consultations.recent")}),(0,A.jsxs)("div",{ref:H,className:"flex items-center gap-0.5 md:gap-6",children:[(0,A.jsx)("button",{onClick:()=>B(!0),disabled:ue,className:"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600 shadow-sm flex items-center justify-center flex-shrink-0 ".concat(ue?"opacity-50 cursor-not-allowed":""),style:{width:"30.19px",height:"30.19px"},title:f("consultations.createClient"),"aria-label":f("consultations.createClient"),children:(0,A.jsx)(d.A,{className:"h-4 w-4"})}),(0,A.jsx)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:be.slice(0,ge).map(((e,t)=>{!L(e)&&e.status;const a=!L(e)&&"planned"===e.status;return(0,A.jsxs)("button",{onClick:()=>!L(e)&&oe(Number(e.id),W),disabled:L(e),className:"inline-flex items-center px-3 py-2 rounded-full text-sm font-medium flex-shrink-0 transition-colors ".concat(L(e)?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 animate-pulse cursor-default":a?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 hover:bg-blue-200 dark:hover:bg-blue-900/50 cursor-pointer border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer"),title:L(e)?f("common.loading"):a?f("consultations.plannedWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""}):f("consultations.startWith",{clientName:e.name,date:e.lastConsultationDate?new Date(e.lastConsultationDate).toLocaleDateString("de-DE"):""}),children:[a&&!L(e)&&(0,A.jsx)("svg",{className:"h-3 w-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,A.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,A.jsx)("span",{className:"truncate max-w-[120px]",children:L(e)?(0,A.jsx)("span",{className:"inline-block w-16 h-4 bg-gray-300 dark:bg-gray-500 rounded animate-pulse"}):e.name})]},e.id)}))})]})]}),(0,A.jsxs)("div",{className:"flex gap-6",children:[(0,A.jsx)("button",{onClick:()=>O(!0),className:"w-2/3 flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:f("consultations.start"),children:(0,A.jsx)(c.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{onClick:()=>{ee(!X),U(null),ae(""),se(""),V("")},className:"w-1/3 flex items-center justify-center px-4 py-3 border text-base font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(X?"border-blue-500 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"),title:f("consultations.plan"),children:(0,A.jsx)(o.A,{className:"h-5 w-5"})})]}),X&&(0,A.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:[(0,A.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:f("consultations.planConsultation")}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:f("consultations.columns.client")}),P?(0,A.jsxs)("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2",children:[(0,A.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:P.name}),(0,A.jsx)("button",{onClick:()=>O(!0),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:f("consultations.change")})]}):(0,A.jsx)("button",{onClick:()=>O(!0),className:"w-full text-left bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700",children:f("consultations.selectClientPlaceholder")})]}),(0,A.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:f("consultations.columns.startTime")}),(0,A.jsx)("input",{type:"datetime-local",value:te,onChange:e=>ae(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:f("consultations.columns.endTime")}),(0,A.jsx)("input",{type:"datetime-local",value:re,onChange:e=>se(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"})]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:f("consultations.columns.notes")}),(0,A.jsx)("textarea",{value:W,onChange:e=>V(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",rows:2,placeholder:f("consultations.optionalNotes")})]}),(0,A.jsx)("div",{className:"flex justify-end",children:(0,A.jsx)("button",{onClick:async()=>{if(P)if(te&&re)if(v)try{T(!0);const e=new Date(te),t=new Date(e.getTime()-6e4*e.getTimezoneOffset()),a=new Date(re),r=new Date(a.getTime()-6e4*a.getTimezoneOffset()),s=(await R({branchId:v,clientId:P.id,notes:W||"",startTime:t.toISOString()}),await _({endTime:r.toISOString(),notes:W||""}));ee(!1),ae(""),se(""),V(""),U(null),K(P.id),console.log("\ud83d\ude80 ConsultationTracker: Sending consultationChanged event (start)"),window.dispatchEvent(new CustomEvent("consultationChanged")),le(),null===n||void 0===n||n(s),y&&P.name&&y(P.name),b.oR.success(f("consultations.manualSaveSuccess"))}catch(e){console.error("Fehler beim Erfassen der Beratung:",e),b.oR.error(f("consultations.manualSaveError"))}finally{T(!1)}else b.oR.error(f("consultations.selectBranch"));else b.oR.error("Bitte geben Sie Start- und Endzeit an");else b.oR.error("Bitte w\xe4hlen Sie einen Client aus")},disabled:!P||!te||!re,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:f("consultations.saveConsultation")})})]})]})]}),(0,A.jsx)(F,{isOpen:E,onClose:()=>O(!1),onSelect:e=>{U(e),O(!1),X||oe(e.id,W)},onCreateNew:()=>{O(!1),B(!0)}}),(0,A.jsx)(D,{isOpen:M,onClose:()=>B(!1),onSave:e=>{B(!1),U(e),le()}})]})};var M=a(8010),B=a(2704),P=a(3315),U=a(9670),z=a(3216);const G=e=>{let{isOpen:t,onClose:a,consultationId:n,onTaskLinked:l}=e;const{t:o}=(0,s.Bd)(),[i,d]=(0,r.useState)([]),[c,x]=(0,r.useState)([]),[h,g]=(0,r.useState)(""),[v,k]=(0,r.useState)(!0),[w,j]=(0,r.useState)(null);(0,r.useEffect)((()=>{t&&N()}),[t]),(0,r.useEffect)((()=>{if(h){const e=i.filter((e=>e.title.toLowerCase().includes(h.toLowerCase())));x(e)}else x(i)}),[h,i]);const N=async()=>{try{k(!0);const e=(await u.A.get(m.Sn.TASKS.BASE)).data.filter((e=>"open"===e.status||"in_progress"===e.status));d(e),x(e)}catch(e){b.oR.error(o("consultations.linkTask.loadError"))}finally{k(!1)}};return(0,A.jsxs)(y.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(y.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,A.jsxs)("div",{className:"p-6",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,A.jsx)(y.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:o("consultations.linkTask.title")}),(0,A.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"relative mb-4",children:[(0,A.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,A.jsx)(p.A,{className:"h-5 w-5 text-gray-400"})}),(0,A.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:o("consultations.linkTask.searchPlaceholder"),autoFocus:!0})]}),(0,A.jsx)("div",{className:"max-h-96 overflow-y-auto",children:v?(0,A.jsx)("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:o("common.loading")}):0===c.length?(0,A.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:o("consultations.linkTask.noTasksFound")}):(0,A.jsx)("div",{className:"space-y-2",children:c.map((e=>(0,A.jsxs)("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",children:[(0,A.jsx)("input",{type:"radio",name:"task",value:e.id,checked:w===e.id,onChange:()=>j(e.id),className:"mr-3"}),(0,A.jsxs)("div",{className:"flex-1",children:[(0,A.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),e.responsible&&(0,A.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o("tasks.columns.responsible"),": ",e.responsible.firstName," ",e.responsible.lastName]})]}),(0,A.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("open"===e.status?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"),children:"open"===e.status?o("tasks.status.open"):o("tasks.status.in_progress")})]},e.id)))})}),(0,A.jsxs)("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[(0,A.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:o("common.cancel")}),(0,A.jsx)("button",{onClick:async()=>{if(w)try{await u.A.post(m.Sn.CONSULTATIONS.LINK_TASK(n),{taskId:w}),b.oR.success(o("consultations.linkTask.success")),l(),a()}catch(r){var e,t;b.oR.error((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||o("consultations.linkTask.error"))}else b.oR.error(o("consultations.linkTask.selectTask"))},disabled:!w,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o("consultations.linkTask.link")})]})]})})})]})};var W=a(4426),V=a(7829),Y=a(9837),K=a(887),H=a(4538),Z=a(8416),q=a(9531);const Q=e=>{let{isOpen:t,onClose:a,invoiceId:s,invoiceNumber:n,totalAmount:l,clientName:o}=e;const[i,d]=(0,r.useState)(!1);return t?(0,A.jsxs)(y.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(y.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,A.jsxs)("div",{className:"p-6",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)(H.A,{className:"h-8 w-8 text-green-500 mr-3"}),(0,A.jsx)(y.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellt"})]}),(0,A.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,A.jsx)("h3",{className:"font-medium text-green-800 dark:text-green-200 mb-2",children:"Rechnung erfolgreich erstellt"}),(0,A.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-300 space-y-1",children:[(0,A.jsxs)("p",{children:[(0,A.jsx)("strong",{children:"Rechnungsnummer:"})," ",n]}),(0,A.jsxs)("p",{children:[(0,A.jsx)("strong",{children:"Kunde:"})," ",o]}),(0,A.jsxs)("p",{children:[(0,A.jsx)("strong",{children:"Betrag:"})," CHF ",l]})]})]}),(0,A.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,A.jsx)("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"N\xe4chste Schritte"}),(0,A.jsxs)("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,A.jsx)("li",{children:"\u2022 PDF herunterladen und an Kunde senden"}),(0,A.jsx)("li",{children:"\u2022 Beratungen sind nun als abgerechnet markiert"}),(0,A.jsx)("li",{children:"\u2022 Rechnung in der Rechnungsverwaltung verwalten"})]})]})]}),(0,A.jsxs)("div",{className:"mt-6 flex flex-col space-y-3",children:[(0,A.jsx)("button",{onClick:async()=>{try{d(!0);const e=await u.A.get(m.Sn.CONSULTATION_INVOICES.GENERATE_PDF(s),{responseType:"blob",headers:{Accept:"application/pdf"}}),t=new Blob([e.data],{type:"application/pdf"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="Rechnung_".concat(n,".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),b.oR.success("PDF erfolgreich heruntergeladen")}catch(a){var e,t;console.error("Fehler beim Download der PDF:",a),b.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Fehler beim Download der PDF")}finally{d(!1)}},disabled:i,className:"w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"PDF wird generiert..."]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(Z.A,{className:"h-5 w-5 mr-2"}),"PDF herunterladen"]})}),(0,A.jsxs)("button",{onClick:()=>{b.oR.info("Rechnungsverwaltung wird in Phase 5 implementiert"),a()},className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,A.jsx)(q.A,{className:"h-5 w-5 mr-2"}),"Zur Rechnungsverwaltung"]}),(0,A.jsx)("button",{onClick:a,className:"w-full px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Schlie\xdfen"})]})]})})})]}):null},$=e=>{let{isOpen:t,onClose:a,consultations:s,onInvoiceCreated:l}=e;const{t:o}=useTranslation(),{hasPermission:i}=(0,n.S)(),[d,c]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[p,v]=(0,r.useState)(null),[k,w]=(0,r.useState)(!1),[j,C]=(0,r.useState)({issueDate:(0,Y.GP)(new Date,"yyyy-MM-dd"),dueDate:(0,Y.GP)(new Date(Date.now()+2592e6),"yyyy-MM-dd"),hourlyRate:0,vatRate:0,notes:""}),T=i("invoice_create","write","button"),E=(0,r.useCallback)((async()=>{try{c(!0);const e=(await u.A.get(m.Sn.INVOICE_SETTINGS.BASE)).data;g(e),C((t=>(0,N.A)((0,N.A)({},t),{},{hourlyRate:e.defaultHourlyRate||0,vatRate:e.defaultVatRate||0})))}catch(t){var e;console.error("Fehler beim Laden der Rechnungseinstellungen:",t),404===(null===(e=t.response)||void 0===e?void 0:e.status)?b.oR.error("Bitte konfigurieren Sie zuerst Ihre Rechnungseinstellungen"):b.oR.error("Fehler beim Laden der Rechnungseinstellungen")}finally{c(!1)}}),[]);if((0,r.useEffect)((()=>{t&&E()}),[t,E]),!T)return(0,A.jsxs)(y.lG,{open:t,onClose:a,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(y.lG.Panel,{className:"mx-auto max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:(0,A.jsxs)("div",{className:"text-center",children:[(0,A.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Keine Berechtigung"}),(0,A.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Sie haben keine Berechtigung, Rechnungen zu erstellen."}),(0,A.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Schlie\xdfen"})]})})})]});const F=e=>{const{name:t,value:a}=e.target;C((e=>(0,N.A)((0,N.A)({},e),{},{[t]:a})))},D=s.reduce(((e,t)=>{if(t.endTime){const a=(0,x.P0)(t.startTime,t.endTime);return e+parseFloat(a.replace("h","").replace(",","."))}return e}),0),R=D*j.hourlyRate,_=j.vatRate>0?R*j.vatRate/100:0,I=R+_;return t?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(y.lG,{open:t&&!k,onClose:a,className:"relative z-50",children:[(0,A.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(y.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:(0,A.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!h)return void b.oR.error("Rechnungseinstellungen konnten nicht geladen werden");if(0===s.length)return void b.oR.error("Keine Beratungen zum Abrechnen vorhanden");const t=[...new Set(s.map((e=>e.clientId)))];if(t.length>1)return void b.oR.error("Alle Beratungen m\xfcssen den gleichen Kunden haben");const a=t[0];if(a)try{var r,n;c(!0);const e=(await u.A.post(m.Sn.CONSULTATION_INVOICES.CREATE_FROM_CONSULTATIONS,{consultationIds:s.map((e=>e.id)),clientId:a,issueDate:j.issueDate,dueDate:j.dueDate,hourlyRate:j.hourlyRate,vatRate:j.vatRate||0,notes:j.notes})).data,t=(null===(r=s[0])||void 0===r||null===(n=r.client)||void 0===n?void 0:n.name)||"Unbekannt";v({id:e.id,invoiceNumber:e.invoiceNumber,total:e.total,clientName:t}),w(!0),l(e.id)}catch(d){var o,i;b.oR.error((null===(o=d.response)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.message)||"Fehler beim Erstellen der Rechnung")}finally{c(!1)}else b.oR.error("Kein g\xfcltiger Kunde in den Beratungen gefunden")},className:"p-6",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,A.jsx)(y.lG.Title,{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Rechnung erstellen"}),(0,A.jsx)("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,A.jsx)(f.A,{className:"h-6 w-6"})})]}),(0,A.jsxs)("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,A.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Zu verrechnende Beratungen"}),(0,A.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:s.map((e=>{var t;return(0,A.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,A.jsx)("div",{children:(0,A.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[null===(t=e.client)||void 0===t?void 0:t.name," - ",(0,x.fU)(e.startTime)]})}),(0,A.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:(0,x.P0)(e.startTime,e.endTime)})]},e.id)}))}),(0,A.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 flex justify-between text-sm font-medium",children:[(0,A.jsx)("span",{children:"Gesamtdauer:"}),(0,A.jsxs)("span",{children:[D.toFixed(2),"h"]})]})]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rechnungsdatum"}),(0,A.jsx)("input",{type:"date",name:"issueDate",value:j.issueDate,onChange:F,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"F\xe4lligkeitsdatum"}),(0,A.jsx)("input",{type:"date",name:"dueDate",value:j.dueDate,onChange:F,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stundensatz (CHF)"}),(0,A.jsx)("input",{type:"number",name:"hourlyRate",value:j.hourlyRate,onChange:F,step:"0.01",min:"0",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"MwSt.-Satz (%)"}),(0,A.jsx)("input",{type:"number",name:"vatRate",value:j.vatRate,onChange:F,step:"0.1",min:"0",max:"100",className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,A.jsxs)("div",{className:"mb-6",children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Zus\xe4tzliche Notizen"}),(0,A.jsx)("textarea",{name:"notes",value:j.notes,onChange:F,rows:3,className:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Optionale Notizen zur Rechnung..."})]}),(0,A.jsxs)("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,A.jsx)("h3",{className:"font-medium text-blue-800 dark:text-blue-200 mb-3",children:"Kosten\xfcbersicht"}),(0,A.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,A.jsxs)("div",{className:"flex justify-between",children:[(0,A.jsxs)("span",{children:["Beratungszeit (",D.toFixed(2),"h \xd7 CHF ",j.hourlyRate,"):"]}),(0,A.jsxs)("span",{children:["CHF ",R.toFixed(2)]})]}),j.vatRate>0&&(0,A.jsxs)("div",{className:"flex justify-between",children:[(0,A.jsxs)("span",{children:["MwSt. (",j.vatRate,"%):"]}),(0,A.jsxs)("span",{children:["CHF ",_.toFixed(2)]})]}),(0,A.jsxs)("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 flex justify-between font-medium",children:[(0,A.jsx)("span",{children:"Gesamtbetrag:"}),(0,A.jsxs)("span",{children:["CHF ",I.toFixed(2)]})]})]})]}),(0,A.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,A.jsx)("button",{type:"button",onClick:a,className:"p-2 text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:o("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-5 w-5"})}),(0,A.jsx)("button",{type:"submit",disabled:d||!h||0===D,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-700 dark:hover:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed",title:d?"Erstelle Rechnung...":"Rechnung erstellen",children:d?(0,A.jsx)(S.A,{className:"h-5 w-5 animate-spin"}):(0,A.jsx)(B.A,{className:"h-5 w-5"})})]})]})})})]}),k&&p&&(0,A.jsx)(Q,{isOpen:k,onClose:()=>{w(!1),v(null),a()},invoiceId:p.id,invoiceNumber:p.invoiceNumber,totalAmount:Number(p.total).toFixed(2),clientName:p.clientName})]}):null},J="consultations-table",X=(0,r.forwardRef)(((e,t)=>{let{onConsultationChange:a}=e;const{t:l}=(0,s.Bd)(),{hasPermission:i}=(0,n.S)(),d=(0,z.Zp)(),[c,h]=(0,r.useState)([]),[g,y]=(0,r.useState)([]),[p,v]=(0,r.useState)(!0),[w,S]=(0,r.useState)(null),[T,E]=(0,r.useState)(""),[F,D]=(0,r.useState)(!1),[R,_]=(0,r.useState)([]),[L,O]=(0,r.useState)([]),[H,Z]=(0,r.useState)(null),[q,Q]=(0,r.useState)(""),[X,ee]=(0,r.useState)(null),[te,ae]=(0,r.useState)(null),[re,se]=(0,r.useState)(""),[ne,le]=(0,r.useState)(!1),[oe,ie]=(0,r.useState)(null),[de,ce]=(0,r.useState)(l("consultations.filters.today")),[me,ue]=(0,r.useState)(null),[xe,he]=(0,r.useState)(!1),ge=async()=>{try{v(!0);const e=await(async(e,t,a)=>{try{const r=new URLSearchParams;e&&r.append("clientId",e.toString()),t&&r.append("from",t),a&&r.append("to",a);const s=r.toString()?"".concat(m.Sn.CONSULTATIONS.BASE,"?").concat(r):m.Sn.CONSULTATIONS.BASE;return(await u.A.get(s)).data}catch(w){throw console.error("Fehler beim Laden der Beratungen:",w),w}})();h(e||[]),S(null)}catch(w){console.error("Fehler beim Laden der Beratungen:",w),S(l("consultations.loadError"))}finally{v(!1)}};(0,r.useImperativeHandle)(t,(()=>({refresh:ge,addConsultation:e=>{h((t=>[e,...t]))},updateConsultation:e=>{h((t=>t.map((t=>t.id===e.id?e:t))))},removeConsultation:e=>{h((t=>t.filter((t=>t.id!==e))))},activateClientFilter:be}))),(0,r.useEffect)((()=>{ge(),(async()=>{try{const e=await j();y(e||[])}catch(w){}})()}),[]),(0,r.useEffect)((()=>{(async()=>{try{const e=await u.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(J)),t=e.data.find((e=>"Heute"===e.name));t&&(ce(l("consultations.filters.today")),ue(t.id),ye(t.conditions,t.operators))}catch(w){console.error("Fehler beim Setzen des initialen Filters:",w)}})()}),[]);const be=async e=>{try{const t=await u.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(J));let a=t.data.find((t=>t.name===e));if(!a){const t={tableId:J,name:e,conditions:[{column:"client",operator:"equals",value:e}],operators:[]};a=(await u.A.post(m.Sn.SAVED_FILTERS.BASE,t)).data,window.refreshSavedFilters&&window.refreshSavedFilters()}a&&(ce(e),ue(a.id),ye(a.conditions,a.operators))}catch(w){console.error("Fehler beim Erstellen/Aktivieren des Client-Filters:",w)}};(0,r.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return;const e=(await u.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(J))).data,t=e.find((e=>"Alle"===e.name));if(t)try{await u.A.delete(m.Sn.SAVED_FILTERS.BY_ID(t.id)),console.log('Veralteter "Alle" Filter gel\xf6scht')}catch(w){console.error('Fehler beim L\xf6schen des "Alle" Filters:',w)}const a=e.find((e=>"Diese Woche"===e.name));if(a)try{await u.A.delete(m.Sn.SAVED_FILTERS.BY_ID(a.id)),console.log('Veralteter "Diese Woche" Filter gel\xf6scht')}catch(w){console.error('Fehler beim L\xf6schen des "Diese Woche" Filters:',w)}const r=e.some((e=>"Archiv"===e.name)),s=e.some((e=>"Heute"===e.name)),n=e.some((e=>"Woche"===e.name)),o=e.some((e=>"Nicht abgerechnet"===e.name));if(!r){const e=(new Date).toISOString().split("T")[0],t={tableId:J,name:"Archiv",conditions:[{column:"startTime",operator:"before",value:e}],operators:[]};try{await u.A.post(m.Sn.SAVED_FILTERS.BASE,t)}catch(w){console.error("Fehler beim Erstellen des Archiv-Filters:",w)}}if(!s){const e={tableId:J,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]};try{await u.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(w){console.error("Fehler beim Erstellen des Heute-Filters:",w)}}if(!n){const e={tableId:J,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]};try{await u.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(w){console.error("Fehler beim Erstellen des Woche-Filters:",w)}}if(!o){const e={tableId:J,name:l("consultations.filters.unbilled"),conditions:[{column:"invoiceStatus",operator:"equals",value:"nicht abgerechnet"}],operators:[]};try{await u.A.post(m.Sn.SAVED_FILTERS.BASE,e)}catch(w){console.error("Fehler beim Erstellen des Nicht abgerechnet-Filters:",w)}}}catch(w){console.error("Fehler beim Erstellen der Standard-Filter:",w)}})()}),[]),(0,r.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{try{const e=(await u.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(J))).data,t=e.find((e=>"Heute"===e.name));if(t&&t.conditions.length>0){const e=t.conditions[0];e.value&&"__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)&&(console.log("Aktualisiere Heute-Filter mit dynamischem Marker..."),await u.A.post(m.Sn.SAVED_FILTERS.BASE,{tableId:J,name:l("consultations.filters.today"),conditions:[{column:"startTime",operator:"equals",value:"__TODAY__"}],operators:[]}))}const a=e.find((e=>"Woche"===e.name));if(a&&a.conditions.length>=2){const e=a.conditions[0],t=a.conditions[1];("__TODAY__"!==e.value&&/^\d{4}-\d{2}-\d{2}$/.test(e.value)||"__WEEK_FROM_TODAY__"!==t.value&&/^\d{4}-\d{2}-\d{2}$/.test(t.value))&&(console.log("Aktualisiere Woche-Filter mit dynamischen Markern..."),await u.A.post(m.Sn.SAVED_FILTERS.BASE,{tableId:J,name:l("consultations.filters.week"),conditions:[{column:"startTime",operator:"after",value:"__TODAY__"},{column:"startTime",operator:"before",value:"__WEEK_FROM_TODAY__"}],operators:["AND"]}))}}catch(w){console.error("Fehler beim Aktualisieren bestehender Filter:",w)}})()}),1e3);return()=>clearTimeout(e)}),[]),(0,r.useEffect)((()=>{const e=setTimeout((()=>{(async()=>{if(0!==g.length)try{if(!localStorage.getItem("token"))return;const e=(await u.A.get(m.Sn.SAVED_FILTERS.BY_TABLE(J))).data,t=e.filter((e=>![l("consultations.filters.archive"),l("consultations.filters.today"),l("consultations.filters.week")].includes(e.name))),a=g.map((e=>e.name));for(const r of t)if(!a.includes(r.name))try{await u.A.delete(m.Sn.SAVED_FILTERS.BY_ID(r.id)),console.log("Veralteter Client-Filter gel\xf6scht: ".concat(r.name))}catch(w){console.error("Fehler beim L\xf6schen des veralteten Client-Filters ".concat(r.name,":"),w)}for(const r of g){const t=r.name;if(!e.some((e=>e.name===t))){const e={tableId:J,name:t,conditions:[{column:"client",operator:"equals",value:r.name}],operators:[]};await u.A.post(m.Sn.SAVED_FILTERS.BASE,e),console.log("Neuer Client-Filter erstellt: ".concat(t))}}}catch(w){console.error("Fehler beim Aktualisieren der Client-Filter:",w)}})()}),500);return()=>clearTimeout(e)}),[g]);const ye=(e,t)=>{_(e),O(t)},fe=()=>{_([]),O([])},pe=()=>R.length,ve=e=>{(async(e,t)=>{try{await I(e,{notes:t}),h((a=>a.map((a=>a.id===e?(0,N.A)((0,N.A)({},a),{},{notes:t}):a)))),b.oR.success(l("consultations.notesUpdated"))}catch(w){console.error("Fehler beim Aktualisieren der Notizen:",w),b.oR.error(l("consultations.notesUpdateError"))}})(e,q),Z(null)},ke=()=>{Z(null),Q("")},we=(e,t)=>{ee(e.id),ae(t);const a="startTime"===t?e.startTime:e.endTime;if(a){const e=new Date(a),t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),s=String(e.getUTCDate()).padStart(2,"0"),n=String(e.getUTCHours()).padStart(2,"0"),l=String(e.getUTCMinutes()).padStart(2,"0"),o="".concat(t,"-").concat(r,"-").concat(s,"T").concat(n,":").concat(l);console.log("\ud83d\udd27 DEBUG handleTimeEdit (KORRIGIERT):"),console.log("- DB Zeit (UTC):",a),console.log("- Extrahierte UTC-Komponenten:","".concat(n,":").concat(l)),console.log("- inputValue f\xfcr datetime-local:",o),se(o)}},je=async e=>{if(te&&re)try{const t="".concat(re,":00.000Z");console.log("\ud83d\udd27 DEBUG handleTimeSave (REFACTORED):"),console.log("- editingTimeValue (Input):",re),console.log("- timeString f\xfcr API (UTC):",t),console.log("- editingTimeType:",te);await(async(e,t)=>{try{return(await u.A.put("".concat(m.Sn.WORKTIME.BASE,"/").concat(e),t)).data}catch(w){throw console.error("Fehler beim Aktualisieren der Zeit:",w),w}})(e,{[te]:t});h((a=>a.map((a=>a.id===e?(0,N.A)((0,N.A)({},a),{},{[te]:t}):a)))),b.oR.success(l("consultations.timeUpdated")),ee(null),ae(null),se("")}catch(w){var t,a;console.error("Fehler beim Aktualisieren der Zeit:",w),b.oR.error("".concat(l("consultations.timeUpdateError"),": ").concat((null===(t=w.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||w.message))}},Ne=()=>{ee(null),ae(null),se("")},Se=async e=>{if(window.confirm(l("consultations.confirmDelete")))try{await(async e=>{try{return(await u.A.delete(m.Sn.CONSULTATIONS.BY_ID(e))).data}catch(w){throw console.error("Fehler beim L\xf6schen der Beratung:",w),w}})(e),h((t=>t.filter((t=>t.id!==e)))),b.oR.success(l("consultations.deleteSuccess")),null===a||void 0===a||a()}catch(w){var t,r;console.error("Fehler beim L\xf6schen der Beratung:",w);const a=(null===(t=w.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||l("consultations.deleteError");b.oR.error(a)}},Ce=(0,r.useCallback)((e=>{let t=e;if(T){const e=T.toLowerCase();t=t.filter((t=>{var a,r,s,n,l;return(null===(a=t.client)||void 0===a||null===(r=a.name)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(s=t.notes)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(n=t.branch)||void 0===n||null===(l=n.name)||void 0===l?void 0:l.toLowerCase().includes(e))}))}return R.length>0&&(t=t.filter((e=>{var t,a,r,s,n;let l=!0;for(let o=0;o<R.length;o++){const i=R[o];let d=!1;switch(i.column){case"client":d=(null===(t=e.client)||void 0===t||null===(a=t.name)||void 0===a?void 0:a.toLowerCase().includes(String(i.value).toLowerCase()))||!1;break;case"branch":d=(null===(r=e.branch)||void 0===r||null===(s=r.name)||void 0===s?void 0:s.toLowerCase().includes(String(i.value).toLowerCase()))||!1;break;case"notes":d=(null===(n=e.notes)||void 0===n?void 0:n.toLowerCase().includes(String(i.value).toLowerCase()))||!1;break;case"startTime":const l=new Date(e.startTime).toISOString().split("T")[0];let o=String(i.value);if("__TODAY__"===o){const e=new Date;o=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]}else if("__WEEK_FROM_TODAY__"===o){const e=new Date,t=new Date(e.getTime()-6e4*e.getTimezoneOffset()),a=new Date(t);a.setDate(t.getDate()+7),o=a.toISOString().split("T")[0]}switch(i.operator){case"after":d=l>=o;break;case"before":d=l<o;break;case"equals":d=l===o;break;default:d=!1}break;case"duration":const c=Te(e.startTime,e.endTime),m=60*Number(i.value);switch(i.operator){case"greater_than":d=c>m;break;case"less_than":d=c<m;break;case"equals":d=Math.abs(c-m)<30;break;default:d=!1}break;case"invoiceStatus":const u=(0,x.vv)(e),h=De(e),g=String(i.value).toLowerCase();if("abgerechnet"===g||"invoiced"===g||"ja"===g)d=u||h;else if("nicht abgerechnet"===g||"not invoiced"===g||"nein"===g)d=!u&&!h;else if("einzelrechnung"===g||"invoice"===g)d=u;else if("monatsbericht"===g||"monthly report"===g)d=h;else if(u){const t=(0,x.h4)(e);d=(t?(0,x.Pg)(t.status).toLowerCase():"").includes(g)}else if(h){const t=Re(e);if(t){d=("GENERATED"===t.status?"erstellt":"SENT"===t.status?"gesendet":"archiviert").includes(g)}else d=!1}else d=!1;break;default:d=!1}if(0===o)l=d;else{l="AND"===L[o-1]?l&&d:l||d}}return l}))),t}),[c,T,R,L]),Te=(e,t)=>{if(!t)return 0;const a=new Date(e);return(new Date(t).getTime()-a.getTime())/6e4},Ae=(0,r.useMemo)((()=>Ce(c).sort(((e,t)=>new Date(e.startTime).getTime()-new Date(t.startTime).getTime()))),[c,R,L]),Ee=(0,r.useMemo)((()=>(0,x.c$)(Ae)),[Ae]),Fe=(0,r.useMemo)((()=>(e=>{const t=[];return e.forEach(((a,r)=>{const s=new Date(a.startTime),n=(0,Y.GP)(s,"yyyy-MM-dd",{locale:K.de}),o=s.getUTCHours();if(r>0){const a=new Date(e[r-1].startTime);n!==(0,Y.GP)(a,"yyyy-MM-dd",{locale:K.de})&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Y.GP)(s,"EEE, dd.MM.",{locale:K.de}),position:r})}else 0===r&&t.push({id:"day-".concat(n),type:"day",date:n,label:(0,Y.GP)(s,"EEE, dd.MM.",{locale:K.de}),position:r});if(r>0){const a=new Date(e[r-1].startTime),s=a.getUTCHours();n===(0,Y.GP)(a,"yyyy-MM-dd",{locale:K.de})&&s<12&&o>=12&&t.push({id:"midday-".concat(n),type:"midday",date:n,label:l("consultations.midday"),position:r})}})),t})(Ae)),[Ae]),De=e=>null!==e.monthlyReportId&&void 0!==e.monthlyReportId,Re=e=>e.monthlyReport,_e=e=>{const t=e?"/payroll?tab=monthly-reports&reportId=".concat(e):"/payroll?tab=monthly-reports";d(t)},Ie=e=>{const t=e?"/payroll?tab=invoices&invoiceId=".concat(e):"/payroll?tab=invoices";d(t)},Le=e=>{d("/worktracker?editTask=".concat(e))};return p?(0,A.jsx)("div",{className:"p-4",children:l("common.loading")}):w?(0,A.jsx)("div",{className:"p-4 text-red-600",children:w}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-700 p-6",children:[(0,A.jsxs)("div",{className:"flex items-center mb-6 justify-between px-2 sm:px-0",children:[(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)(o.A,{className:"h-6 w-6 mr-2 dark:text-white"}),(0,A.jsxs)("div",{children:[(0,A.jsx)("h2",{className:"text-xl font-semibold dark:text-white",children:l("consultations.listTitle")}),(0,A.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[l("consultations.count",{count:Ae.length})," - ",l("consultations.total"),": ",Ee]})]})]}),(0,A.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,A.jsx)("input",{type:"text",placeholder:l("common.searchPlaceholder"),className:"w-[200px] px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:T,onChange:e=>E(e.target.value)}),(0,A.jsxs)("button",{className:"p-2 rounded-md ".concat(pe()>0?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"hover:bg-gray-100 dark:hover:bg-gray-700"," ml-1 relative"),onClick:()=>D(!F),title:l("consultations.advancedFilters"),children:[(0,A.jsx)(M.A,{className:"h-5 w-5"}),pe()>0&&(0,A.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-600 dark:bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:pe()})]}),(()=>{if(!i("invoice_create","write","button"))return!1;if(!(Ae.length>0))return!1;if(!(R.length>0||""!==T.trim()))return!1;if(!Ae.every((e=>e.endTime)))return!1;return!Ae.some((e=>(0,x.vv)(e)))})()&&(0,A.jsx)("button",{onClick:()=>{he(!0)},className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors ml-2",title:l("consultations.createInvoiceFromFiltered"),children:(0,A.jsx)(B.A,{className:"h-5 w-5"})})]})]}),F&&(0,A.jsx)("div",{className:"px-2 sm:px-0",children:(0,A.jsx)(W.A,{columns:[{id:"client",label:l("consultations.columns.client")},{id:"branch",label:l("consultations.columns.branch")},{id:"notes",label:l("consultations.columns.notes")},{id:"startTime",label:l("consultations.columns.date")},{id:"duration",label:l("consultations.columns.durationHours")},{id:"invoiceStatus",label:l("consultations.columns.invoiceStatus")}],onApply:ye,onReset:fe,savedConditions:R,savedOperators:L,tableId:J})}),(0,A.jsx)("div",{className:"px-2 sm:px-0",children:(0,A.jsx)(V.A,{tableId:J,onSelectFilter:ye,onReset:fe,activeFilterName:de,selectedFilterId:me,onFilterChange:(e,t,a,r)=>{ce(e),ue(t),ye(a,r)}})}),(0,A.jsx)("div",{className:"space-y-0.5 sm:space-y-1",children:0===Ae.length?(0,A.jsxs)("div",{className:"text-center py-12 px-2 sm:px-0",children:[(0,A.jsx)(o.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:l("consultations.noConsultationsFound")}),(0,A.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:T||R.length>0?l("consultations.tryOtherFilters"):l("consultations.noConsultationsYet")})]})]}):Ae.map(((e,t)=>{var a,r;const s=Fe.find((e=>"day"===e.type&&e.position===t)),n=Fe.find((e=>"midday"===e.type&&e.position===t));return(0,A.jsxs)("div",{className:"relative",children:[s&&(0,A.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 dark:bg-blue-400 border-2 border-white dark:border-gray-800"}),(0,A.jsx)("div",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:s.label})]}),(0,A.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-200 dark:bg-gray-600"})]}),n&&(0,A.jsxs)("div",{className:"flex items-center mb-3 px-2 sm:px-0",children:[(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 dark:bg-gray-500"}),(0,A.jsx)("div",{className:"ml-3 text-xs text-gray-500 dark:text-gray-400",children:n.label})]}),(0,A.jsx)("div",{className:"flex-1 ml-4 h-px bg-gray-300 dark:bg-gray-600"})]}),(0,A.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg md:border md:border-gray-200 md:dark:border-gray-700 hover:shadow-md transition-shadow",children:(0,A.jsx)("div",{className:"p-4",children:(0,A.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,A.jsxs)("div",{className:"col-span-1 space-y-3",children:[(0,A.jsx)("div",{className:"flex items-center space-x-2",children:(0,A.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,A.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:null===(a=e.client)||void 0===a?void 0:a.name}),(null===(r=e.client)||void 0===r?void 0:r.company)&&(0,A.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.client.company})]})}),(()=>{const t=(e=>{const t=(0,x.vv)(e),a=De(e);if(t){const t=(0,x.h4)(e);return{type:"invoice",status:l("consultations.invoice"),info:t}}if(a){const t=Re(e);return{type:"monthly",status:l("consultations.monthlyReport"),info:t}}return null})(e);if(t){if("invoice"===t.type)return(0,A.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,A.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,A.jsx)(B.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,A.jsx)("button",{onClick:()=>{var e;return Ie(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.invoice")})]}),t.info&&"invoiceNumber"in t.info&&(0,A.jsx)("div",{className:"flex items-center space-x-1",children:(0,A.jsx)("button",{onClick:()=>{var e;return Ie(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium hover:opacity-80 cursor-pointer ".concat((0,x.DW)(t.info.status)),title:"Rechnung ".concat(t.info.invoiceNumber," vom ").concat((0,Y.GP)(new Date(t.info.issueDate),"dd.MM.yyyy",{locale:K.de})),children:(0,x.Pg)(t.info.status)})})]});if("monthly"===t.type)return(0,A.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,A.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,A.jsx)(P.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,A.jsx)("button",{onClick:()=>{var e;return _e(null===(e=t.info)||void 0===e?void 0:e.id)},className:"text-xs text-green-700 dark:text-green-400 font-medium hover:underline cursor-pointer",children:l("consultations.monthlyReport")})]}),t.info&&"reportNumber"in t.info&&(0,A.jsx)("div",{className:"flex items-center space-x-1",children:(0,A.jsx)("button",{onClick:()=>{var e;return _e(null===(e=t.info)||void 0===e?void 0:e.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 hover:opacity-80 cursor-pointer",title:"Monatsbericht ".concat(t.info.reportNumber),children:"GENERATED"===t.info.status?l("analytics.monthlyReports.status.generated"):"SENT"===t.info.status?l("analytics.monthlyReports.status.sent"):l("analytics.monthlyReports.status.archived")})})]})}return null})(),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.time")}),(0,A.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:X===e.id&&"startTime"===te||X===e.id&&"endTime"===te?(0,A.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,A.jsx)("input",{type:"datetime-local",value:re,onChange:e=>se(e.target.value),className:"text-xs rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full"}),(0,A.jsx)("button",{onClick:()=>je(e.id),className:"p-0.5 text-green-600 hover:text-green-700",title:l("common.save"),children:(0,A.jsx)("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,A.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,A.jsx)("button",{onClick:Ne,className:"p-0.5 text-red-600 hover:text-red-700",title:l("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-3 w-3"})})]}):(0,A.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,A.jsx)("button",{onClick:()=>we(e,"startTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,x.fU)(e.startTime)}),(0,A.jsx)("span",{className:"text-gray-400",children:"-"}),e.endTime?(0,A.jsx)("button",{onClick:()=>we(e,"endTime"),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 hover:underline",children:(0,x.fU)(e.endTime)}):(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-1 animate-pulse"}),(0,A.jsx)("span",{className:"text-green-600 dark:text-green-400 text-xs",children:l("consultations.active")})]})]})})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.columns.duration")}),(0,A.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(0,x.P0)(e.startTime,e.endTime)})]}),e.taskLinks&&e.taskLinks.length>0&&(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:l("consultations.tasks",{count:e.taskLinks.length})}),(0,A.jsxs)("div",{className:"space-y-1",children:[e.taskLinks.slice(0,2).map((e=>(0,A.jsxs)("button",{onClick:()=>Le(e.task.id),className:"flex items-center text-xs text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 rounded px-2 py-1 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors cursor-pointer w-full text-left",children:[(0,A.jsx)(U.A,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,A.jsx)("span",{className:"truncate",children:e.task.title})]},e.id))),e.taskLinks.length>2&&(0,A.jsx)("button",{onClick:()=>{e.taskLinks&&e.taskLinks.length>0&&Le(e.taskLinks[0].task.id)},className:"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 cursor-pointer",children:l("consultations.moreTasks",{count:e.taskLinks.length-2})})]})]})]}),(0,A.jsxs)("div",{className:"col-span-2 relative",children:[(0,A.jsxs)("div",{className:"absolute top-0 right-0 flex items-center space-x-1 z-10",children:[i("consultations","write")&&(0,A.jsx)("button",{onClick:()=>{return t=e.id,ie(t),void le(!0);var t},className:"p-1 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded",title:l("consultations.linkTask"),children:(0,A.jsx)(U.A,{className:"h-4 w-4"})}),i("consultations","write")&&e.endTime&&(0,A.jsx)("button",{onClick:()=>Se(e.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded",title:l("consultations.delete"),children:(0,A.jsx)(k.A,{className:"h-4 w-4"})})]}),(0,A.jsx)("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:l("consultations.columns.notes")}),H===e.id?(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("textarea",{value:q,onChange:e=>Q(e.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm resize-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:l("consultations.notesPlaceholder")}),(0,A.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,A.jsx)("button",{onClick:ke,className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",title:l("common.cancel"),children:(0,A.jsx)(f.A,{className:"h-4 w-4"})}),(0,A.jsx)("button",{onClick:()=>ve(e.id),className:"p-1.5 bg-blue-600 text-white hover:bg-blue-700 rounded-md",title:l("common.save"),children:(0,A.jsx)(C.A,{className:"h-4 w-4"})})]})]}):(0,A.jsx)("div",{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded p-2 min-h-[60px] border border-dashed border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors",onClick:()=>(e=>{Z(e.id),Q(e.notes||"")})(e),children:e.notes?(0,A.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap leading-relaxed",children:e.notes}):(0,A.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,A.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:l("consultations.addNotes")})})})]})]})})})]},e.id)}))})]}),ne&&oe&&(0,A.jsx)(G,{isOpen:ne,onClose:()=>{le(!1),ie(null)},consultationId:oe,onTaskLinked:e=>{ge(),null===a||void 0===a||a()}}),xe&&(0,A.jsx)($,{isOpen:xe,onClose:()=>he(!1),consultations:Ae,onInvoiceCreated:e=>{he(!1),ge(),b.oR.success(l("consultations.invoiceCreated"))}})]})})),ee=()=>{const{t:e}=(0,s.Bd)(),{hasPermission:t}=(0,n.S)(),a=(0,r.useRef)(null),l=(0,r.useCallback)((e=>{var t,r,s,n,l;e&&e.id?e.endTime?null===(t=a.current)||void 0===t||null===(r=t.updateConsultation)||void 0===r||r.call(t,e):null===(s=a.current)||void 0===s||null===(n=s.addConsultation)||void 0===n||n.call(s,e):null===(l=a.current)||void 0===l||l.refresh()}),[]),o=(0,r.useCallback)((e=>{var t,r,s;null===(t=a.current)||void 0===t||t.refresh(),null===(r=a.current)||void 0===r||null===(s=r.activateClientFilter)||void 0===s||s.call(r,e)}),[]);return t("consultations","read")?(0,A.jsx)("div",{className:"min-h-screen dark:bg-gray-900",children:(0,A.jsx)("div",{className:"max-w-7xl mx-auto py-0 px-2 -mt-6 sm:-mt-3 lg:-mt-3 sm:px-4 lg:px-6",children:(0,A.jsxs)("div",{className:"space-y-6",children:[(0,A.jsx)(O,{onConsultationChange:l,onConsultationStarted:o}),(0,A.jsx)(X,{ref:a,onConsultationChange:l})]})})}):(0,A.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,A.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:(0,A.jsx)("div",{className:"flex",children:(0,A.jsxs)("div",{className:"ml-3",children:[(0,A.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:e("consultations.noPermission")}),(0,A.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(0,A.jsx)("p",{children:e("consultations.noPermissionMessage")})})]})})})})}}}]);
//# sourceMappingURL=513.4e94da0a.chunk.js.map